<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[mongodb aggregate Âü∫‰∫éUNIXÊó∂Èó¥Êà≥ÁöÑËÅöÂêà]]></title>
    <url>%2F2019%2F05%2F20%2Fmongodb-aggregate%2F</url>
    <content type="text"><![CDATA[ÂØπ‰ªäÂ§©Ëß£ÂÜ≥‰∏ç‰∫ÜÁöÑ‰∫ãÊÉÖÔºå‰πü‰∏çË¶ÅÁùÄÊÄ•„ÄÇÂõ†‰∏∫ÊòéÂ§©‰πüÂèØËÉΩËøòÊòØËß£ÂÜ≥‰∏ç‰∫Ü„ÄÇ ÂâçÊèêÂºÄÂèëÊâæÊàëÈóÆMongoDB ÁöÑ aggregate ËÅöÂêàÁî®Ëøá‰∏çüò∞ „ÄÇÊàëËØ¥Êü•Êü•ËµÑÊñôÂêß üò®ÔºåÂèëÁé∞ÊòØaggregateËÅöÂêàÁÆ°ÈÅì ÊääSQL ‰∏é Aggergation ÂØπÊØî‰∏ãüòÇ SQL Terms, Functions, and Concepts MongoDB Aggregation Operators WHERE $match HAVING $match SELECT $project ORDER BY $sort LIMIT $limit SUM() $sum COUNT() $sum COUNT() $sortByCount join $lookup ÂºÄÂèëÁöÑÈúÄÊ±ÇÊòØ: ÊåâÁÖßÂ§©ÂàÜÁªÑÔºåÁªüËÆ°‰∏Ä‰∏ãÊï∞Èáè ÁªèËøáÊü•ÁúãMongoDBÂÆòÁΩëÁöÑaggregateËµÑÊñôÂÆûÁé∞ÂºÄÂèëÁöÑÈúÄÊ±Ç ÂÆûÁé∞Êü•ËØ¢Êï∞ÊçÆÁöÑÁä∂ÊÄÅ1db.antispam_image.find({"moduleId":5,createTs:{$gte:1554048000},createTs:{$lt:1556640000}}).pretty().limit(1); 1234567891011121314151617181920212223242526272829303132333435363738{ "_id" : ObjectId("5c125657372eecd7a0a54e5e"), "adRate" : 0, "assoId" : "223794113", "assoType" : 201, "clientIp" : "183.131.7.23", "clientType" : "", "confidence" : 12.655, "content" : "", "createTs" : NumberLong(1544705623), "emailStatus" : "verified", "handleTs" : NumberLong(1545036013), "hotScore" : 14.285, "inspectStatus" : 2, "message" : "", "moduleId" : NumberLong(5), "normalScore" : 73.25, "ocrKeyword" : [ ], "ocrText" : [ ], "opUser" : "fanyanning", "opUserId" : NumberLong(31648494), "pornScore" : 12.464, "qcode" : 0, "receiveTs" : NumberLong(1545035885), "regTs" : NumberLong(1475385061), "requestId" : "6f078c58-1235-4816-96a5-e876ea0cbcf2", "rotOcrKeyword" : [ ], "rotOcrText" : [ ], "ruleId" : NumberLong(10019), "sim" : 0, "status" : 1000, "trashType" : 0, "ts" : NumberLong(1544705623), "url" : "http://videoplayer.babytreeimg.com/lamavideo:2018/1213/Flb_T4qsxRcK7suNqaHo2JbD6zWJ_000001.jpg?id=-1", "userId" : NumberLong(56349617), "userLevel" : 3, "version" : "1.0.0"} ÂºÄÂèëÁªôÁöÑËÅöÂêàÁöÑÊü•ËØ¢1234db.antispam_image.aggregate([{ $match: {"moduleId":5,createTs:{$gte:1554048000},createTs:{$lt:1556640000}}},{ $group: {_id :{$dateToString: {format: "%Y-%m-%d", date: "$createTs" }},count: { $sum: 1 }}}]); 1234567891011121314151617181920212223242526mgset-11469021:SECONDARY> db.antispam_image.aggregate([{$match: {"moduleId":5, createTs:{$gte:1554048000},createTs:{$lt:1556640000}}}, {$group: {_id: {$dateToString: {format: "%Y-%m-%d", date: "$createTs"}}, count: {$sum: 1}}}]);assert: command failed: { "operationTime" : Timestamp(1558347069, 2), "ok" : 0, "errmsg" : "can't convert from BSON type long to Date", "code" : 16006, "codeName" : "Location16006"} : aggregate failed_getErrorWithCode@src/mongo/shell/utils.js:25:13doassert@src/mongo/shell/assert.js:16:14assert.commandWorked@src/mongo/shell/assert.js:370:5DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1319:5@(shell):1:12019-05-20T18:11:10.818+0800 E QUERY [thread1] Error: command failed: { "operationTime" : Timestamp(1558347069, 2), "ok" : 0, "errmsg" : "can't convert from BSON type long to Date", "code" : 16006, "codeName" : "Location16006"} : aggregate failed :_getErrorWithCode@src/mongo/shell/utils.js:25:13doassert@src/mongo/shell/assert.js:16:14assert.commandWorked@src/mongo/shell/assert.js:370:5DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1319:5@(shell):1:1 Êä•Èîô‰∫ÜÔºåÈóÆÂºÄÂèë„ÄÇÂºÄÂèëÂèàÁªô‰∫Ü‰∏Ä‰∏™Êü•ËØ¢ËØ≠Âè•12345678db.antispam_image.aggregate([{ $match: {"moduleId":5,createTs:{$gte:1554048000},createTs:{$lt:1556640000}}},{ $group: { _id :{ $dateToString: {format: "%Y-%m-%d", date:{"$add":[new Date(0),"$createTs"]}} }, count: { $sum: 1 } }}]); 12{ "_id" : "1970-01-19", "count" : 15131 }{ "_id" : "1970-01-18", "count" : 180400 } ÂèëÁé∞Êó∂Èó¥Êà≥ËΩ¨Âåñ‰∏çÂØπ ‰∫éÊòØÊü•ÁúãÂÆòÁΩëËµÑÊñôÔºåÁªßÁª≠ÊîπÂÜôÂÖàÊääUNIXÊó∂Èó¥Êà≥ËΩ¨Âåñ‰∏∫Êó•Êúü„ÄÇÂèØÊòØMongoDBÂèàÊ≤°ÊúâMySQLÈÇ£ÁßçFROM_UNIXTIME()‰∏éUNIX_TIMESTAMP()ÂáΩÊï∞„ÄÇÂè™ËÉΩËá™Â∑±ÈÄ† ÈÄöËøáÂ∞ÜÂÄº‰πò‰ª•1000Â∞ÜcreateTsÂ≠óÊÆµËΩ¨Êç¢‰∏∫ÊØ´ÁßíÊó∂Èó¥Êà≥1{ "$multiply": [1000, "$createTs"]} $multiply Â∞ÜÊï∞Â≠óÁõ∏‰πò‰ª•ËøîÂõû‰∫ßÂìÅ„ÄÇÊé•Âèó‰ªªÊÑèÊï∞ÈáèÁöÑÂèÇÊï∞Ë°®ËææÂºè„ÄÇ ÁÑ∂ÂêéËΩ¨Êç¢‰∏∫Êó•Êúü1"$add": [ new Date(0), { "$multiply": [1000, "$createTs"]} ] ÁªßÁª≠ÁªÑË£ÖÊü•ËØ¢1{"$group": { "_id": { "year": { "$year": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ]}}, "mmonth": { "$month": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ]}}, "day": { "$dayOfMonth": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ]}}}, "count" : { "$sum" : 1 }}} Âú®$projectÁÆ°ÈÅì‰∏≠ÂÆåÊàê,ÊñπÊ≥ïÊòØÂ∞ÜÊØ´ÁßíÊó∂Èó¥Ê∑ªÂä†Âà∞Èõ∂ÊØ´ÁßíDate(0)ÂØπË±°,ÁÑ∂Âêé‰ªéËΩ¨Êç¢ÂêéÁöÑÊó•Êúü‰∏≠ÊèêÂèñ$year,$month,$dayOfMonth‰∏™Èõ∂‰ª∂,ÂèØ‰ª•Âú®$groupÁÆ°ÈÅì‰∏≠‰ΩøÁî®Ëøô‰∫õÈõ∂‰ª∂ÂØπÊñáÊ°£ËøõË°åÂàÜÁªÑ ÂÆåÊï¥ÁöÑÊü•ËØ¢ËØ≠Âè•ÊãºÊé•Âá∫Êù•1db.antispam_image.aggregate([{ $match: {"moduleId":5,createTs:{$gte:1554048000},createTs:{$lt:1556640000}}}, {"$group": { "_id": { "year": { "$year": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ]}}, "mmonth": { "$month": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ]}}, "day": { "$dayOfMonth": { "$add": [ new Date(0), { "$multiply": [1000, "$createTs"] } ] }}}, "count" : { "$sum" : 1 }}}]); 12345678910111213141516171819202122{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 30 }, "count" : 624 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 28 }, "count" : 695 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 27 }, "count" : 683 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 26 }, "count" : 765 }{ "_id" : { "year" : 2019, "mmonth" : 1, "day" : 12 }, "count" : 610 }{ "_id" : { "year" : 2019, "mmonth" : 1, "day" : 4 }, "count" : 429 }{ "_id" : { "year" : 2019, "mmonth" : 1, "day" : 3 }, "count" : 475 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 29 }, "count" : 732 }{ "_id" : { "year" : 2018, "mmonth" : 12, "day" : 31 }, "count" : 592 }{ "_id" : { "year" : 2018, "mmonth" : 12, "day" : 30 }, "count" : 542 }{ "_id" : { "year" : 2019, "mmonth" : 3, "day" : 14 }, "count" : 1155 }{ "_id" : { "year" : 2019, "mmonth" : 3, "day" : 13 }, "count" : 1169 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 20 }, "count" : 945 }{ "_id" : { "year" : 2019, "mmonth" : 3, "day" : 15 }, "count" : 1062 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 24 }, "count" : 751 }{ "_id" : { "year" : 2018, "mmonth" : 10, "day" : 15 }, "count" : 721 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 18 }, "count" : 895 }{ "_id" : { "year" : 2018, "mmonth" : 10, "day" : 16 }, "count" : 713 }{ "_id" : { "year" : 2019, "mmonth" : 4, "day" : 14 }, "count" : 1278 }{ "_id" : { "year" : 2018, "mmonth" : 10, "day" : 17 }, "count" : 583 }Type "it" for moremgset-11469021:SECONDARY> ÊãøËøôÊ†∑Êü•ËØ¢Âá∫Êù•ÁöÑÊï∞ÊçÆÈóÆÂºÄÂèëÊòØÂê¶ÊòØËøôÊ†∑„ÄÅÂºÄÂèëÁ°ÆËÆ§ËøôÊ†∑ÂèØ‰ª•„ÄÇÈúÄÊ±ÇËß£ÂÜ≥„ÄÇ ÁªìËÆ∫ÈíàÂØπDBAËøô‰∏™Â≤ó‰ΩçÊù•ËØ¥„ÄÇÂ§ßÂ§öÊï∞ÈÉΩÊòØ‰ªé‰∫ãMongoDB ËøêÁª¥Â∑•‰Ωú üòÇ„ÄÇ ÂæàÂ∞ëË¥¥ËøëÂºÄÂèëÈúÄÊ±ÇÔºåËøôÊ¨°ÂºÄÂèëÈóÆ‰∫ÜÊàëËøô‰∏™ÈóÆÈ¢ò„ÄÇÊàëÂΩìÁÑ∂Êó†Ê≥ïÁ´ãÈ©¨ÁªôÂá∫Á≠îÊ°à„ÄÇÂè™ËÉΩ‰∏çÊñ≠ÁöÑÊü•ËØ¢„ÄÇÊãºÊé•ÔºåÊâçËÉΩÈ©¨È©¨ËôéËôéÁöÑÊª°Ë∂≥‰∫ÜÂºÄÂèëÁöÑÈúÄÊ±Ç ‚úÖ„ÄÇ ÂàöÊâçÈóÆ‰∏Ä‰∏™Êû∂ÊûÑÂ∏àÔºåÊû∂ÊûÑÂ∏àËØ¥Êúâ‰∏Ä‰∏™Êõ¥ÁÆÄÂçïÁöÑÊñπÂºèÔºö Êü•Âá∫ÊÄªÁªìÂá∫‰∏ÄÂ§©ÁöÑÊï∞ÊçÆÔºåÊîæÂà∞ÁÆ°ÈÅì‰∏≠‰∏¥Êó∂‰øùÂ≠òËµ∑Êù• Âú®Áî®Ââç‰∏ÄÊ¨°Êü•ËØ¢ÁöÑÁªìÊùüÊó∂Èó¥‰Ωú‰∏∫Á¨¨‰∫åÂ§©ÁöÑÂºÄÂßãÊó∂Èó¥ÔºåÂú®Âä†‰∏ä‰∏ÄÂ§©ÁöÑÊó∂Èó¥(86400s)ÂæóÂá∫ÁªìÂ∞æÊó∂Èó¥„ÄÇ Êü•ËØ¢ÂÆåÊàêÂú®Áªü‰∏ÄÊòæÁ§∫ÊâìÂç∞Âá∫Êù• ËøôÁßçÊñπÂºèÂ∞±ÈúÄË¶Å‰ΩøÁî®MongoDB forEachÊñπÂºèÂÆûÁé∞‰∫Ü„ÄÇ ÂºÄÂèëÂèàËØ¥‰∏çËÉΩÊåâÊó∂Èó¥ÊéíÂ∫èüò± , Â¶πÁöÑüòÇÂì™ÈáåÊù•ÁöÑËøô‰πàÂ§öË¶ÅÊ±Çüò± ÂèÇËÄÉ MongoDB ÂÆòÊñπËµÑÊñô: aggregateËµÑÊñô MongoDB ËÅöÂêàÊü•ËØ¢ - ÊåâÊó∂Èó¥ÂàÜÁªÑÁªüËÆ° document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodbÊï∞ÊçÆÂØºÂá∫CSVÊñá‰ª∂]]></title>
    <url>%2F2019%2F05%2F17%2Fmongodb-to-csv%2F</url>
    <content type="text"><![CDATA[Ë¶Å‰∏çÊòØÂõ†‰∏∫ÊàëÔºå‰Ω†ËÉΩÊúâ‰ªäÂ§©ÔºüË¶Å‰∏çÊòØÊàë‰º§ÂÆ≥‰Ω†Ôºå‰Ω†ËÉΩÊàêÈïøÔºü ÈúÄÊ±Ç‰∫ßÂìÅÈúÄË¶ÅÂàÜÊûêËææ‰∫∫ÊñáÁ´†ÁöÑÊ†áÁ≠æÔºåÈúÄË¶ÅÊää2019Âπ¥1Êúà1Âè∑Âà∞Áé∞Âú®ÁöÑÊ†áÁ≠æÔºå‰ªémongoÂØºÂá∫Êù•ÔºåÂØºÂá∫Ê†ºÂºè‰∏∫csvÔºåÊü•ËØ¢Êù°‰ª∂Â¶Ç‰∏ãÔºö1db.content_medium_hismatch.find({"content_type_id":"28","update_time":{"$gte":1546272000000},"is_delete":0}, {"content_id":1,"content_tags":1}); Êìç‰Ωú‰ΩøÁî®MongoDB‰∏≠ÁöÑmongoexportÂëΩ‰ª§1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859mongoexport --helpUsage: mongoexport Export data from MongoDB in CSV or JSON format.See http://docs.mongodb.org/manual/reference/program/mongoexport/ for more information.general options: --help print usage --version print the tool version and exitverbosity options: -v, --verbose= more detailed log output (include multiple times for more verbosity, e.g. -vvvvv, or specify a numeric value, e.g. --verbose=N) --quiet hide all log outputconnection options: -h, --host= mongodb host to connect to (setname/host1,host2 for replica sets) --port= server port (can also use --host hostname:port)ssl options: --ssl connect to a mongod or mongos that has ssl enabled --sslCAFile= the .pem file containing the root certificate chain from the certificate authority --sslPEMKeyFile= the .pem file containing the certificate and key --sslPEMKeyPassword= the password to decrypt the sslPEMKeyFile, if necessary --sslCRLFile= the .pem file containing the certificate revocation list --sslAllowInvalidCertificates bypass the validation for server certificates --sslAllowInvalidHostnames bypass the validation for server name --sslFIPSMode use FIPS mode of the installed openssl libraryauthentication options: -u, --username= username for authentication -p, --password= password for authentication --authenticationDatabase= database that holds the user's credentials --authenticationMechanism= authentication mechanism to usenamespace options: -d, --db= database to use -c, --collection= collection to useoutput options: -f, --fields=[,]* comma separated list of field names (required for exporting CSV) e.g. -f "name,age" --fieldFile= file with field names - 1 per line --type= the output format, either json or csv (defaults to 'json') (default: json) -o, --out= output file; if not specified, stdout is used --jsonArray output to a JSON array rather than one object per line --pretty output JSON formatted to be human-readable --noHeaderLine export CSV data without a list of field names at the first linequerying options: -q, --query= query filter, as a JSON string, e.g., '{x:{$gt:1}}' --queryFile= path to a file containing a query filter (JSON) -k, --slaveOk allow secondary reads if available (default true) (default: false) --readPreference=| specify either a preference name or a preference json object --forceTableScan force a table scan (do not use $snapshot) --skip= number of documents to skip --limit= limit the number of documents to export --sort= sort order, as a JSON string, e.g. '{x:1}' --assertExists if specified, export fails if the collection does not exist (default: false) Êìç‰ΩúÂëΩ‰ª§Â¶Ç‰∏ã:1/usr/local/mongodb/bin/mongoexport --port 29001 --host=localhost -user=*** --password=***** --authenticationDatabase=**** --db=db --collection=collection --query='{"content_type_id":"28","update_time":{"$gte":1546272000000},"is_delete":0}, {"content_id":1,"content_tags":1}' --type=csv --out=***.csv 122019-05-17T13:18:52.325+0800 error validating settings: query '[123 34 99 111 110 116 101 110 116 95 116 121 112 101 95 105 100 34 58 34 50 56 34 44 34 117 112 100 97 116 101 95 116 105 109 101 34 58 123 34 36 103 116 101 34 58 49 53 52 54 50 55 50 48 48 48 48 48 48 125 44 34 105 115 95 100 101 108 101 116 101 34 58 48 125 44 32 123 34 99 111 110 116 101 110 116 95 105 100 34 58 49 44 34 99 111 110 116 101 110 116 95 116 97 103 115 34 58 49 125]' is not valid JSON: invalid character ',' after top-level value2019-05-17T13:18:52.325+0800 try 'mongoexport --help' for more information ÂàùÊ≠•Âà§Êñ≠ÊòØÂØºÂá∫CSVÊñá‰ª∂‰∏≠ÈúÄË¶ÅÁöÑÈÄóÂè∑(,)ÂàÜÂâ≤„ÄÇÂ≠óÊÆµÂèëÁîüÈîôËØØ„ÄÇËØ≠Âè•Ê∑ªÂä†‚Äìfields _id,content_id,content_tags1/usr/local/mongodb/bin/mongoexport --port 29001 --host=localhost -user=*** --password=***** --authenticationDatabase=**** --db=db --collection=collection --query='{"content_type_id":"28","update_time":{"$gte":1546272000000},"is_delete":0}, {"content_id":1,"content_tags":1}' --type=csv --fields _id,content_id,content_tags --out=***.csv 12`2019-05-17T13:18:54.325+0800 error validating settings: query '[123 34 99 111 110 116 101 110 116 95 116 121 112 101 95 105 100 34 58 34 50 56 34 44 34 117 112 100 97 116 101 95 116 105 109 101 34 58 123 34 36 103 116 101 34 58 49 53 52 54 50 55 50 48 48 48 48 48 48 125 44 34 105 115 95 100 101 108 101 116 101 34 58 48 125 44 32 123 34 99 111 110 116 101 110 116 95 105 100 34 58 49 44 34 99 111 110 116 101 110 116 95 116 97 103 115 34 58 49 125]' is not valid JSON: invalid character ',' after top-level value 2019-05-17T13:18:54.325+0800 try 'mongoexport --help' for more information``bash ÂºÄÂßãÊéíÊü•‰∏∫‰ªÄ‰πàËøòÁªßÁª≠Êä•Èîô„ÄÇ‰ΩøÁî® mongo shell ËøûÊé•Âà∞mongodb‰∏≠Êü•ËØ¢ÂèëÁé∞ÊòØËÉΩËé∑ÂèñÂà∞Êï∞ÊçÆÁöÑ„ÄÇÂéªÊéâ‚Äìquery Êù°‰ª∂‰πãÂêéÂÜçÊâßË°å‰∏ÄÊ¨°ÂèëÁé∞ÊòØÊ≤°ÈóÆÈ¢ò1/usr/local/mongodb/bin/mongoexport --port 29001 --host=localhost -user=*** --password=***** --authenticationDatabase=**** --db=db --collection=collection --type=csv --fields _id,content_id,content_tags --out=***.csv 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556572019-05-17T13:24:18.176+0800 connected to: localhost:290012019-05-17T13:24:19.167+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:20.167+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:21.168+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:22.167+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:23.168+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:24.168+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:25.167+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)2019-05-17T13:24:26.168+0800 [........................] feeds.content_medium_hismatch 0/138863565 (0.0%)^C2019-05-17T13:24:26.900+0800 signal 'interrupt' received; forcefully terminatingpublic-ops-mongodb2 seclogin # lscontent_medium_hismatch.csvpublic-ops-mongodb2 seclogin # cat content_medium_hismatch.csv |more_id,content_id,content_tagsObjectId(5b0f598eaeeb42d8582db599),1229,"[""Â•∂Áì∂"",""ÂêÉÂ•∂"",""Âê∏ÂêÆ"",""‰π≥Â§¥Ê∑∑Ê∑Ü"",""ÊØç‰π≥""]"ObjectId(5b0f598eaeeb42d8582db5c8),1290,"[""Ë°£Êúç"",""‰∫åÊâãË°£Êúç"",""Ê∏ÖÊ¥ó"",""ÁöÆËÇ§"",""ÁªÜËèå""]"ObjectId(5b0f598eaeeb42d8582db5cd),1297,"[""Ë∫´Êùê"",""‰∫ßÂêéÂ¶àÂ¶à"",""Êñ∞Â¶àÂ¶à"",""Ë£ôÂ≠ê"",""Ë°£Êúç""]"ObjectId(5b0f598eaeeb42d8582db5e1),1325,"[""Êä§ËÇ§ÂìÅ"",""Âì∫‰π≥Êúü"",""ÁöÆËÇ§"",""ÂÅ•Â∫∑"",""Êä§ËÇ§""]"ObjectId(5b0f598eaeeb42d8582db5e8),1343,"[""Êî∂Á∫≥"",""ÂÆ∂ÂÖ∑"",""Â•∂Á≤â"",""ÂàÜ‰∫´"",""‰∏âËßíÂΩ¢""]"ObjectId(5b0f598eaeeb42d8582db618),1393,"[""ËÉåÂ∏¶"",""Â©¥ÂÑø"",""Â∏¶ÂÆùÂÆù"",""Âá∫Èó®"",""ËÇåËÇâÂèëËÇ≤""]"ObjectId(5b0f598eaeeb42d8582db65e),1465,"[""Áª¥ÁîüÁ¥†"",""È£üÁâ©"",""È™®È™º"",""ÁúºÁùõ"",""Â∏ÆÂä©""]"ObjectId(5b0f598eaeeb42d8582db660),1467,"[""ÊôíÂ§™Èò≥"",""Á¥´Â§ñÁ∫ø"",""Áª¥ÁîüÁ¥†"",""ÈªÑÁñ∏"",""ÁúºÁùõ""]"ObjectId(5b0f598eaeeb42d8582db666),1472,"[""‰ºûËΩ¶"",""Êé®ËΩ¶"",""Â©¥ÂÑø‰ºûËΩ¶"",""Â©¥ÂÑøÊé®ËΩ¶"",""‰ºòÁÇπ""]"ObjectId(5b0f598eaeeb42d8582db669),1474,"[""È£üÁâ©"",""Âë≥ËßâÂèëËÇ≤"",""Âè£Âë≥"",""È£üÁõê"",""È•ÆÈ£ü""]"ObjectId(5b0f598eaeeb42d8582db674),1490,"[""ÊÇ£ÁóÖ"",""Áà∂ÊØç"",""ÊåáÁî≤"",""ÂÅ•Â∫∑"",""ÊâìÂëºÂôú""]"ObjectId(5b0f598eaeeb42d8582db67a),1500,"[""Áù°Áú†"",""ÁñæÁóÖ"",""Áà∂ÊØç"",""ÁóáÁä∂"",""ÂåªÈô¢""]"ObjectId(5b0f598eaeeb42d8582db68c),1513,"[""Â£∞Èü≥"",""Â•∂Áù°"",""ÁæéÂõΩ"",""ÊëáÊôÉ"",""ÂÆùÂÆùÁù°Ëßâ""]"ObjectId(5b0f598eaeeb42d8582db6a0),1535,"[""ÂÆâÂÖ®"",""Ê∏ÖÊ¥ó"",""Âùê‰æøÂô®"",""È©¨Ê°∂"",""‰ºòÁÇπ""]"ObjectId(5b0f598eaeeb42d8582db746),2732,"[""ËçîÊûù"",""ËøõÈ£ü"",""Ëë°ËêÑÁ≥ñ"",""‰∏äÁÅ´"",""ÁóáÁä∂""]"ObjectId(5b0f598eaeeb42d8582db749),2733,"[""ÂÆùÂÆùÂñÇÂÖª"",""È£üÁâ©"",""ËæÖÈ£ü"",""ÊØç‰π≥"",""È•ÆÈ£ü""]"ObjectId(5b0f598eaeeb42d8582db752),2742,"[""‰π≥Â§¥"",""ÂñÇÂ•∂"",""‰π≥Â§¥Áö≤Ë£Ç"",""Âì∫‰π≥"",""‰π≥Êàø""]"ObjectId(5b0f598eaeeb42d8582db758),2745,"[""È£üÁâ©"",""ÊåëÈ£ü"",""ÂÅèÈ£ü"",""Áà∏Áà∏"",""Ëè†Ëèú""]"ObjectId(5b0f598eaeeb42d8582db75b),2746,"[""ÂêÉÈ•≠"",""Áà∏Áà∏"",""ÂíÄÂöº"",""È£üÁâ©"",""Êó∂Èó¥""]"ObjectId(5b0f598eaeeb42d8582db75f),2747,"[""ËæÖÈ£ü"",""Â∞èÂÆù"",""Ê†∏Ê°ÉÊ≤π"",""ÂÅ•Â∫∑"",""‰∫öÈ∫ªÈÖ∏""]"ObjectId(5b0f598eaeeb42d8582db761),2748,"[""Ê≤πÁÇ∏"",""ÂÅ•Â∫∑"",""È£üÂìÅ"",""È£üÁâ©"",""Ê≤πËÑÇ""]"ObjectId(5b0f598eaeeb42d8582db768),2751,"[""ËæÖÈ£ü"",""ËÜ≥È£üÁ∫§Áª¥"",""Ê∂àÂåñ‰∏çËâØ"",""È£üÁâ©"",""ËÇ†ÈÅì""]"ObjectId(5b0f598eaeeb42d8582db76d),2753,"[""ÂêÉÈ•≠"",""È•ÆÈ£ü‰π†ÊÉØ"",""Â∏ÆÂä©"",""‰π†ÊÉØ"",""Áà∏Áà∏""]"ObjectId(5b0f598eaeeb42d8582db770),2754,"[""ÂæÆÊ≥¢ÁÇâ"",""ËæÖÈ£ü"",""Ëê•ÂÖª"",""È£üÁâ©"",""Áª¥ÁîüÁ¥†""]"ObjectId(5b0f598eaeeb42d8582db773),2755,"[""Ëë°ËêÑÁ≥ñ"",""Ëê•ÂÖª"",""‰π†ÊÉØ"",""ÂÆ∂Èïø"",""ÂÆùÂÆùÁîüÁóÖ""]"ObjectId(5b0f598eaeeb42d8582db775),2756,"[""Á•õÊπø"",""È£üÁâ©"",""Â∏ÆÂä©"",""È£üË∞±"",""Á∫¢Ë±Ü""]"ObjectId(5b0f598eaeeb42d8582db778),2757,"[""Ê∞¥Êûú"",""Ëî¨Ëèú"",""ÊûúÊ±Å"",""ÈÖçÊñπÂ•∂"",""ÊØç‰π≥""]"ObjectId(5b0f598eaeeb42d8582db77e),2759,"[""ÊåëÈ£ü"",""Áª¥ÁîüÁ¥†"",""Ëê•ÂÖª"",""ÂÆùÂÆùÊåëÈ£ü"",""Áº∫Èîå""]"ObjectId(5b0f598eaeeb42d8582db781),2760,"[""ÂêÉËÇâ"",""ÂÅ•Â∫∑"",""Ê∞¥Êûú"",""È•±ÂíåËÑÇËÇ™ÈÖ∏"",""‰æøÁßò""]"ObjectId(5b0f598eaeeb42d8582db784),2761,"[""Ê∞¥Êûú"",""Ëê•ÂÖª"",""È£üÁâ©"",""ËÉ°ËêùÂçúÁ¥†"",""Áª¥ÁîüÁ¥†""]"ObjectId(5b0f598eaeeb42d8582db787),2762,"[""‰ΩìÈáç"",""ÂÆùÂÆùÁò¶"",""Ëê•ÂÖª‰∏çËâØ"",""ÂéüÂõ†"",""Áà∂ÊØç""]"ObjectId(5b0f598eaeeb42d8582db789),2763,"[""È£üÁâ©"",""Ëê•ÂÖª"",""ÂÆùÂÆùÂñÇÂÖª"",""ËøõÈ£ü"",""Êó∂Èó¥""]"ObjectId(5b0f598eaeeb42d8582db790),2765,"[""ËæÖÈ£ü"",""ÂÆùÂÆùÊñ≠Â•∂"",""Êñ≠Â•∂"",""‰øùÂ≠ò"",""ÂÜ∞ÁÆ±""]"ObjectId(5b0f598eaeeb42d8582db792),2766,"[""Êñ≠Â•∂"",""ÊØç‰π≥"",""ÁéØÂ¢É"",""Â§èÂ≠£"",""ÂÆùÂÆùÁîüÁóÖ""]"ObjectId(5b0f598eaeeb42d8582db795),2767,"[""ÁõäÁîüËèå"",""ËçØÁâ©"",""È£üÂìÅ"",""Âπ≥Ë°°"",""ÊäóÁîüÁ¥†""]"ObjectId(5b0f598eaeeb42d8582db798),2768,"[""È£üÁâ©"",""Âí≥ÂóΩ"",""ÂÆùÂÆùÂí≥ÂóΩ"",""È•ÆÈ£ü"",""ËæõËæ£""]"ObjectId(5b0f598eaeeb42d8582db79b),2769,"[""ËæÖÈ£ü"",""È•ÆÈ£ü"",""Êñ≠Â•∂"",""ÂÆùÂÆùÊñ≠Â•∂"",""‰øùÂ≠ò""]"ObjectId(5b0f598eaeeb42d8582db7a1),2773,"[""Ë°•Èíô"",""Áª¥ÁîüÁ¥†"",""ÂÆùÂÆùÁº∫Èíô"",""ÊØç‰π≥"",""ÈÖçÊñπÂ•∂""]"ObjectId(5b0f598faeeb42d8582db7a6),2775,"[""ÊûúÊ≥•"",""Ê∞¥Êûú"",""Áª¥ÁîüÁ¥†"",""ÂìàÂØÜÁìú"",""È¶ôËïâ""]"ObjectId(5b0f598faeeb42d8582db7a9),2776,"[""È•ÆÈ£ü"",""È£üÁâ©"",""ËæÖÈ£ü"",""ËøõÈ£ü"",""Ê∞¥Êûú""]"ObjectId(5b0f598faeeb42d8582db7ac),2777,"[""ÊúâÊú∫Ëî¨Ëèú"",""Ëî¨Ëèú"",""ÂÜúËçØ"",""ÊúâÊú∫"",""ÂÜúËçØÊÆãÁïô""]"ObjectId(5b0f598faeeb42d8582db7b4),2780,"[""Êñ≠Â•∂"",""‰π≥Â§¥"",""‰π≥Êàø"",""‰π≥ËÖ∫ÁÇé"",""ÂõûÂ•∂""]"ObjectId(5b0f598faeeb42d8582db7b8),2783,"[""Âè∂ÈªÑÁ¥†"",""Â§™Èò≥Èïú"",""ËÉ°ËêùÂçú"",""ÂçóÁìú"",""ËäíÊûú""]" Â∞±ËÉΩÁ°ÆÂÆöËøô‰πàÊâßË°åÊòØÊ≤°ÊúâÈóÆÈ¢ò„ÄÇÈáçÁÇπÊéíÊü•--queryÊù°‰ª∂„ÄÇÊ†πÊçÆ‰πãÂâçÊä•Èîô122019-05-17T13:25:56.341+0800 error validating settings: query '[123 99 111 110 116 101 110 116 95 116 121 112 101 95 105 100 58 50 56 44 117 112 100 97 116 101 95 116 105 109 101 58 123 36 103 116 101 58 49 53 52 54 50 55 50 48 48 48 48 48 48 125 44 105 115 95 100 101 108 101 116 101 58 48 125 44 123 99 111 110 116 101 110 116 95 105 100 58 49 44 99 111 110 116 101 110 116 95 116 97 103 115 58 49 125]' is not valid JSON: invalid character ',' after top-level value2019-05-17T13:25:56.341+0800 try 'mongoexport --help' for more information ÂèëÁé∞‰∏Ä‰∏™ÁÇπinvalid character ',' after top-level value‰∏≠ÊèêÁ§∫ÊúâÈÄóÂè∑,ÁöÑÈóÆÈ¢òÔºåÊéíÊü•‰∏Ä‰∏ã--queryÊù°‰ª∂ÂèëÁé∞Êúâ'{"content_type_id":"28","update_time":{"$gte":1546272000000},"is_delete":0}, {"content_id":1,"content_tags":1}'Êúâ‰∏Ä‰∏™ÈÄóÂè∑, ÂéªÊéâÈÄóÂè∑,ÂíåÂêéÈù¢ÁöÑÈÄóÂè∑‰πãÂêéÁöÑÊù°‰ª∂ÂèëÁé∞ÊâßË°åÊàêÂäü1/usr/local/mongodb/bin/mongoexport --port 29001 --host=localhost -user=*** --password=***** --authenticationDatabase=**** --db=db --collection=collection --query='{"content_type_id":"28","update_time":{"$gte":1546272000000},"is_delete":0}' --type=csv --fields _id,content_id,content_tags --out=***.csv 1234567892019-05-17T13:41:33.068+0800 connected to: localhost:290012019-05-17T13:41:34.067+0800 feeds.content_medium_hismatch 02019-05-17T13:41:35.067+0800 feeds.content_medium_hismatch 02019-05-17T13:41:36.067+0800 feeds.content_medium_hismatch 02019-05-17T13:41:36.656+0800 feeds.content_medium_hismatch 188702019-05-17T13:41:36.656+0800 exported 18870 recordspublic-ops-mongodb2 seclogin # cat content_medium_hismatch.csv |wc -l18871public-ops-mongodb2 seclogin # ÂíåÂºÄÂèëÁ°ÆËÆ§‰∏Ä‰∏ãËøô‰∏™Êù°‰ª∂ËÉΩÂê¶Âç¥ÊéâÔºåÂºÄÂèëÁ°ÆËÆ§ÂèØ‰ª•ÂéªÊéâ„ÄÇ ÊÄªÁªìmongoexportÂú®ÊâßË°åÊúâÊù°‰ª∂ÁöÑÂØºÂá∫Êñá‰ª∂Ôºå--query Êù°‰ª∂Ë¶ÅÂÜôÂú®‰∏Ä‰∏™Ëä±Êã¨Âè∑{}ÈáåÈù¢ÔºåÂ¶ÇÊûúË¶ÅÊúâ‰∏§‰∏™Ëä±Êã¨Âè∑{}ÁöÑÊù°‰ª∂Ôºå‰∏≠Èó¥Áî®ÈÄóÂè∑,ÂàÜÂâ≤ÔºåËøôÊ†∑ÊòØ‰∏çË°åÁöÑ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËØ¶ÁªÜÁöÑMySQLÈ´òÊÄßËÉΩ‰ºòÂåñÂÆûÊàòÊÄªÁªì]]></title>
    <url>%2F2019%2F05%2F16%2Fmysql-innodb%2F</url>
    <content type="text"><![CDATA[Âä™Âäõ‰∏ç‰∏ÄÂÆöÊàêÂäüÔºå‰ΩÜÊòØ‰∏çÂä™Âäõ‰ºöÂæàËàíÊúçÁöÑÂì¶! ÂâçË®ÄMySQL ÂØπ‰∫éÂæàÂ§ö Linux ‰ªé‰∏öËÄÖËÄåË®ÄÔºåÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Ê£òÊâãÁöÑÈóÆÈ¢òÔºåÂ§öÊï∞ÊÉÖÂÜµÈÉΩÊòØÂõ†‰∏∫ÂØπÊï∞ÊçÆÂ∫ìÂá∫Áé∞ÈóÆÈ¢òÁöÑÊÉÖÂÜµÂíåÂ§ÑÁêÜÊÄùË∑Ø‰∏çÊ∏ÖÊô∞„ÄÇ Âú®ËøõË°å MySQL ÁöÑ‰ºòÂåñ‰πãÂâçÂøÖÈ°ªË¶Å‰∫ÜËß£ÁöÑÂ∞±ÊòØ MySQL ÁöÑÊü•ËØ¢ËøáÁ®ãÔºåÂæàÂ§öÁöÑÊü•ËØ¢‰ºòÂåñÂ∑•‰ΩúÂÆûÈôÖ‰∏äÂ∞±ÊòØÈÅµÂæ™‰∏Ä‰∫õÂéüÂàôËÆ© MySQL ÁöÑ‰ºòÂåñÂô®ËÉΩÂ§üÊåâÁÖßÈ¢ÑÊÉ≥ÁöÑÂêàÁêÜÊñπÂºèËøêË°åËÄåÂ∑≤„ÄÇ ‰ºòÂåñ ‰ºòÂåñÁöÑÂì≤Â≠¶ Ê≥®Ôºö‰ºòÂåñÊúâÈ£éÈô©Ôºå‰øÆÊîπÈúÄË∞®ÊÖé„ÄÇ ‰ºòÂåñÂèØËÉΩÂ∏¶Êù•ÁöÑÈóÆÈ¢òÔºö ‰ºòÂåñ‰∏çÊÄªÊòØÂØπ‰∏Ä‰∏™ÂçïÁ∫ØÁöÑÁéØÂ¢ÉËøõË°åÔºåËøòÂæàÂèØËÉΩÊòØ‰∏Ä‰∏™Â§çÊùÇÁöÑÂ∑≤Êäï‰∫ßÁöÑÁ≥ªÁªü„ÄÇ ‰ºòÂåñÊâãÊÆµÊú¨Êù•Â∞±ÊúâÂæàÂ§ßÁöÑÈ£éÈô©ÔºåÂè™‰∏çËøá‰Ω†Ê≤°ËÉΩÂäõÊÑèËØÜÂà∞ÂíåÈ¢ÑËßÅÂà∞„ÄÇ ‰ªª‰ΩïÁöÑÊäÄÊúØÂèØ‰ª•Ëß£ÂÜ≥‰∏Ä‰∏™ÈóÆÈ¢òÔºå‰ΩÜÂøÖÁÑ∂Â≠òÂú®Â∏¶Êù•‰∏Ä‰∏™ÈóÆÈ¢òÁöÑÈ£éÈô©„ÄÇ ÂØπ‰∫é‰ºòÂåñÊù•ËØ¥Ëß£ÂÜ≥ÈóÆÈ¢òËÄåÂ∏¶Êù•ÁöÑÈóÆÈ¢òÔºåÊéßÂà∂Âú®ÂèØÊé•ÂèóÁöÑËåÉÂõ¥ÂÜÖÊâçÊòØÊúâÊàêÊûú„ÄÇ ‰øùÊåÅÁé∞Áä∂ÊàñÂá∫Áé∞Êõ¥Â∑ÆÁöÑÊÉÖÂÜµÈÉΩÊòØÂ§±Ë¥•„ÄÇ ‰ºòÂåñÁöÑÈúÄÊ±ÇÔºö Á®≥ÂÆöÊÄßÂíå‰∏öÂä°ÂèØÊåÅÁª≠ÊÄßÔºåÈÄöÂ∏∏ÊØîÊÄßËÉΩÊõ¥ÈáçË¶Å„ÄÇ ‰ºòÂåñ‰∏çÂèØÈÅøÂÖçÊ∂âÂèäÂà∞ÂèòÊõ¥ÔºåÂèòÊõ¥Â∞±ÊúâÈ£éÈô©„ÄÇ ‰ºòÂåñ‰ΩøÊÄßËÉΩÂèòÂ•ΩÔºåÁª¥ÊåÅÂíåÂèòÂ∑ÆÊòØÁ≠âÊ¶ÇÁéá‰∫ã‰ª∂„ÄÇ ÂàáËÆ∞‰ºòÂåñÔºåÂ∫îËØ•ÊòØÂêÑÈÉ®Èó®ÂçèÂêåÔºåÂÖ±ÂêåÂèÇ‰∏éÁöÑÂ∑•‰ΩúÔºå‰ªª‰ΩïÂçï‰∏ÄÈÉ®Èó®ÈÉΩ‰∏çËÉΩÂØπÊï∞ÊçÆÂ∫ìËøõË°å‰ºòÂåñ„ÄÇ ÊâÄ‰ª•‰ºòÂåñÂ∑•‰ΩúÔºåÊòØÁî±‰∏öÂä°ÈúÄÊ±ÇÈ©±‰ΩøÁöÑ! ‰ºòÂåñÁî±Ë∞ÅÂèÇ‰∏é?Âú®ËøõË°åÊï∞ÊçÆÂ∫ì‰ºòÂåñÊó∂ÔºåÂ∫îÁî±Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜÂëò„ÄÅ‰∏öÂä°ÈÉ®Èó®‰ª£Ë°®„ÄÅÂ∫îÁî®Á®ãÂ∫èÊû∂ÊûÑÂ∏à„ÄÅÂ∫îÁî®Á®ãÂ∫èËÆæËÆ°‰∫∫Âëò„ÄÅÂ∫îÁî®Á®ãÂ∫èÂºÄÂèë‰∫∫Âëò„ÄÅÁ°¨‰ª∂ÂèäÁ≥ªÁªüÁÆ°ÁêÜÂëò„ÄÅÂ≠òÂÇ®ÁÆ°ÁêÜÂëòÁ≠âÔºå‰∏öÂä°Áõ∏ÂÖ≥‰∫∫ÂëòÂÖ±ÂêåÂèÇ‰∏é„ÄÇ ‰ºòÂåñÊÄùË∑Ø‰ºòÂåñ‰ªÄ‰πàÂú®Êï∞ÊçÆÂ∫ì‰ºòÂåñ‰∏äÊúâ‰∏§‰∏™‰∏ªË¶ÅÊñπÈù¢Ôºö ÂÆâÂÖ®ÔºöÊï∞ÊçÆÂèØÊåÅÁª≠ÊÄß„ÄÇ ÊÄßËÉΩÔºöÊï∞ÊçÆÁöÑÈ´òÊÄßËÉΩËÆøÈóÆ„ÄÇ ‰ºòÂåñÁöÑËåÉÂõ¥ÊúâÂì™‰∫õÂ≠òÂÇ®„ÄÅ‰∏ªÊú∫ÂíåÊìç‰ΩúÁ≥ªÁªüÊñπÈù¢Ôºö ‰∏ªÊú∫Êû∂ÊûÑÁ®≥ÂÆöÊÄß I/O ËßÑÂàíÂèäÈÖçÁΩÆ Swap ‰∫§Êç¢ÂàÜÂå∫ OS ÂÜÖÊ†∏ÂèÇÊï∞ÂíåÁΩëÁªúÈóÆÈ¢ò Â∫îÁî®Á®ãÂ∫èÊñπÈù¢Ôºö Â∫îÁî®Á®ãÂ∫èÁ®≥ÂÆöÊÄß SQL ËØ≠Âè•ÊÄßËÉΩ ‰∏≤Ë°åËÆøÈóÆËµÑÊ∫ê ÊÄßËÉΩÊ¨†‰Ω≥‰ºöËØùÁÆ°ÁêÜ Ëøô‰∏™Â∫îÁî®ÈÄÇ‰∏çÈÄÇÂêàÁî® MySQL Êï∞ÊçÆÂ∫ì‰ºòÂåñÊñπÈù¢Ôºö ÂÜÖÂ≠ò Êï∞ÊçÆÂ∫ìÁªìÊûÑ(Áâ©ÁêÜ&ÈÄªËæë) ÂÆû‰æãÈÖçÁΩÆ ËØ¥ÊòéÔºö‰∏çÁÆ°ÊòØËÆæËÆ°Á≥ªÁªü„ÄÅÂÆö‰ΩçÈóÆÈ¢òËøòÊòØ‰ºòÂåñÔºåÈÉΩÂèØ‰ª•ÊåâÁÖßËøô‰∏™È°∫Â∫èÊâßË°å„ÄÇ ‰ºòÂåñÁª¥Â∫¶ Êï∞ÊçÆÂ∫ì‰ºòÂåñÁª¥Â∫¶ÊúâÂ¶Ç‰∏ãÂõõ‰∏™: Á°¨‰ª∂ Á≥ªÁªüÈÖçÁΩÆ Êï∞ÊçÆÂ∫ìË°®ÁªìÊûÑ SQL ÂèäÁ¥¢Âºï ‰ºòÂåñÈÄâÊã©: ‰ºòÂåñÊàêÊú¨ÔºöÁ°¨‰ª∂>Á≥ªÁªüÈÖçÁΩÆ>Êï∞ÊçÆÂ∫ìË°®ÁªìÊûÑ>SQL ÂèäÁ¥¢Âºï„ÄÇ ‰ºòÂåñÊïàÊûúÔºöÁ°¨‰ª∂Á≥ªÁªü>Â∫îÁî®>Êï∞ÊçÆÂ∫ì>Êû∂ÊûÑ(È´òÂèØÁî®„ÄÅËØªÂÜôÂàÜÁ¶ª„ÄÅÂàÜÂ∫ìÂàÜË°®)„ÄÇ Â§ÑÁêÜÊñπÂêëÔºöÊòéÁ°Æ‰ºòÂåñÁõÆÊ†á„ÄÅÊÄßËÉΩÂíåÂÆâÂÖ®ÁöÑÊäò‰∏≠„ÄÅÈò≤ÊÇ£Êú™ÁÑ∂„ÄÇ Á°¨‰ª∂‰ºòÂåñ‰∏ªÊú∫ÊñπÈù¢Ê†πÊçÆÊï∞ÊçÆÂ∫ìÁ±ªÂûãÔºå‰∏ªÊú∫ CPU ÈÄâÊã©„ÄÅÂÜÖÂ≠òÂÆπÈáèÈÄâÊã©„ÄÅÁ£ÅÁõòÈÄâÊã©Ôºö Âπ≥Ë°°ÂÜÖÂ≠òÂíåÁ£ÅÁõòËµÑÊ∫ê ÈöèÊú∫ÁöÑ I/O ÂíåÈ°∫Â∫èÁöÑ I/O ‰∏ªÊú∫ RAID Âç°ÁöÑ BBU(Battery Backup Unit)ÂÖ≥Èó≠ CPU ÁöÑÈÄâÊã©CPU ÁöÑ‰∏§‰∏™ÂÖ≥ÈîÆÂõ†Á¥†ÔºöÊ†∏Êï∞„ÄÅ‰∏ªÈ¢ë„ÄÇÊ†πÊçÆ‰∏çÂêåÁöÑ‰∏öÂä°Á±ªÂûãËøõË°åÈÄâÊã©Ôºö CPU ÂØÜÈõÜÂûãÔºöËÆ°ÁÆóÊØîËæÉÂ§öÔºåOLTP ‰∏ªÈ¢ëÂæàÈ´òÁöÑ CPU„ÄÅÊ†∏Êï∞ËøòË¶ÅÂ§ö„ÄÇ IO ÂØÜÈõÜÂûãÔºöÊü•ËØ¢ÊØîËæÉÔºåOLAP Ê†∏Êï∞Ë¶ÅÂ§öÔºå‰∏ªÈ¢ë‰∏ç‰∏ÄÂÆöÈ´òÁöÑ„ÄÇ ÂÜÖÂ≠òÁöÑÈÄâÊã©OLAP Á±ªÂûãÊï∞ÊçÆÂ∫ìÔºåÈúÄË¶ÅÊõ¥Â§öÂÜÖÂ≠òÔºåÂíåÊï∞ÊçÆËé∑ÂèñÈáèÁ∫ßÊúâÂÖ≥„ÄÇOLTP Á±ªÂûãÊï∞ÊçÆ‰∏ÄËà¨ÂÜÖÂ≠òÊòØ CPU Ê†∏ÂøÉÊï∞ÈáèÁöÑ 2 ÂÄçÂà∞ 4 ÂÄçÔºåÊ≤°ÊúâÊúÄ‰Ω≥ÂÆûË∑µ„ÄÇ Â≠òÂÇ®ÊñπÈù¢Ê†πÊçÆÂ≠òÂÇ®Êï∞ÊçÆÁßçÁ±ªÁöÑ‰∏çÂêåÔºåÈÄâÊã©‰∏çÂêåÁöÑÂ≠òÂÇ®ËÆæÂ§áÔºåÈÖçÁΩÆÂêàÁêÜÁöÑ RAID Á∫ßÂà´(raid5„ÄÅraid10„ÄÅÁÉ≠Â§áÁõò)„ÄÇ ÂØπ‰∫éÊìç‰ΩúÁ≥ªÁªüÊù•ËÆ≤Ôºå‰∏çÈúÄË¶ÅÂ§™ÁâπÊÆäÁöÑÈÄâÊã©ÔºåÊúÄÂ•ΩÂÅöÂ•ΩÂÜó‰Ωô(raid1)(ssd„ÄÅsas„ÄÅsata)„ÄÇ ‰∏ªÊú∫ raid Âç°ÈÄâÊã©Ôºö ÂÆûÁé∞Êìç‰ΩúÁ≥ªÁªüÁ£ÅÁõòÁöÑÂÜó‰Ωô(raid1) Âπ≥Ë°°ÂÜÖÂ≠òÂíåÁ£ÅÁõòËµÑÊ∫ê ÈöèÊú∫ÁöÑ I/O ÂíåÈ°∫Â∫èÁöÑ I/O ‰∏ªÊú∫ raid Âç°ÁöÑ BBU(Battery Backup Unit)Ë¶ÅÂÖ≥Èó≠ ÁΩëÁªúËÆæÂ§áÊñπÈù¢‰ΩøÁî®ÊµÅÈáèÊîØÊåÅÊõ¥È´òÁöÑÁΩëÁªúËÆæÂ§á(‰∫§Êç¢Êú∫„ÄÅË∑ØÁî±Âô®„ÄÅÁΩëÁ∫ø„ÄÅÁΩëÂç°„ÄÅHBA Âç°)„ÄÇÊ≥®ÊÑèÔºö‰ª•‰∏äËøô‰∫õËßÑÂàíÂ∫îËØ•Âú®ÂàùÂßãËÆæËÆ°Á≥ªÁªüÊó∂Â∞±Â∫îËØ•ËÄÉËôëÂ•Ω„ÄÇ ÊúçÂä°Âô®Á°¨‰ª∂‰ºòÂåñÊúçÂä°Âô®Á°¨‰ª∂‰ºòÂåñÂÖ≥ÈîÆÁÇπÔºö Áâ©ÁêÜÁä∂ÊÄÅÁÅØ Ëá™Â∏¶ÁÆ°ÁêÜËÆæÂ§áÔºöËøúÁ®ãÊéßÂà∂Âç°(FENCEËÆæÂ§áÔºöipmi ilo idarc)„ÄÅÂºÄÂÖ≥Êú∫„ÄÅÁ°¨‰ª∂ÁõëÊéß„ÄÇ Á¨¨‰∏âÊñπÁöÑÁõëÊéßËΩØ‰ª∂„ÄÅËÆæÂ§á(snmp„ÄÅagent)ÂØπÁâ©ÁêÜËÆæÊñΩËøõË°åÁõëÊéß„ÄÇ Â≠òÂÇ®ËÆæÂ§áÔºöËá™Â∏¶ÁöÑÁõëÊéßÂπ≥Âè∞„ÄÇEMC2(HP Êî∂Ë¥≠‰∫Ü)„ÄÅ Êó•Á´ã(HDS)„ÄÅIBM ‰ΩéÁ´Ø OEM HDS„ÄÅÈ´òÁ´ØÂ≠òÂÇ®ÊòØËá™Â∑±ÊäÄÊúØÔºåÂçé‰∏∫Â≠òÂÇ®„ÄÇ Á≥ªÁªü‰ºòÂåñCPUÔºöÂü∫Êú¨‰∏çÈúÄË¶ÅË∞ÉÊï¥ÔºåÂú®Á°¨‰ª∂ÈÄâÊã©ÊñπÈù¢‰∏ãÂäüÂ§´Âç≥ÂèØ„ÄÇ ÂÜÖÂ≠òÔºöÂü∫Êú¨‰∏çÈúÄË¶ÅË∞ÉÊï¥ÔºåÂú®Á°¨‰ª∂ÈÄâÊã©ÊñπÈù¢‰∏ãÂäüÂ§´Âç≥ÂèØ„ÄÇ SWAPÔºöMySQL Â∞ΩÈáèÈÅøÂÖç‰ΩøÁî® Swap„ÄÇÈòøÈáå‰∫ëÁöÑÊúçÂä°Âô®‰∏≠ÈªòËÆ§ swap ‰∏∫ 0„ÄÇ IO Ôºöraid„ÄÅno lvm„ÄÅext4 Êàñ xfs„ÄÅssd„ÄÅIO Ë∞ÉÂ∫¶Á≠ñÁï•„ÄÇ Swap Ë∞ÉÊï¥(‰∏ç‰ΩøÁî® swap ÂàÜÂå∫)Ôºö1/proc/sys/vm/swappinessÁöÑÂÜÖÂÆπÊîπÊàê0(‰∏¥Êó∂)Ôºå/etc/sysctl. conf‰∏äÊ∑ªÂä†vm.swappiness=0(Ê∞∏‰πÖ) Ëøô‰∏™ÂèÇÊï∞ÂÜ≥ÂÆö‰∫Ü Linux ÊòØÂÄæÂêë‰∫é‰ΩøÁî® SwapÔºåËøòÊòØÂÄæÂêë‰∫éÈáäÊîæÊñá‰ª∂Á≥ªÁªü Cache„ÄÇÂú®ÂÜÖÂ≠òÁ¥ßÂº†ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊï∞ÂÄºË∂ä‰ΩéË∂äÂÄæÂêë‰∫éÈáäÊîæÊñá‰ª∂Á≥ªÁªü Cache„ÄÇ ÂΩìÁÑ∂ÔºåËøô‰∏™ÂèÇÊï∞Âè™ËÉΩÂáèÂ∞ë‰ΩøÁî® Swap ÁöÑÊ¶ÇÁéáÔºåÂπ∂‰∏çËÉΩÈÅøÂÖç Linux ‰ΩøÁî® Swap„ÄÇ ‰øÆÊîπ MySQL ÁöÑÈÖçÁΩÆÂèÇÊï∞ innodb_flush_ methodÔºåÂºÄÂêØ O_DIRECT Ê®°Âºè„ÄÇ ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåInnoDB ÁöÑ buffer pool ‰ºöÁõ¥Êé•ÁªïËøáÊñá‰ª∂Á≥ªÁªü Cache Êù•ËÆøÈóÆÁ£ÅÁõòÔºå‰ΩÜÊòØ redo log ‰æùÊóß‰ºö‰ΩøÁî®Êñá‰ª∂Á≥ªÁªü Cache„ÄÇ ÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåRedo log ÊòØË¶ÜÂÜôÊ®°ÂºèÁöÑÔºåÂç≥‰Ωø‰ΩøÁî®‰∫ÜÊñá‰ª∂Á≥ªÁªüÁöÑ CacheÔºå‰πü‰∏ç‰ºöÂç†Áî®Â§™Â§ö„ÄÇ IO Ë∞ÉÂ∫¶Á≠ñÁï•Ôºö1#echo deadline>/sys/block/sda/queue/scheduler ‰∏¥Êó∂‰øÆÊîπ‰∏∫deadline Ê∞∏‰πÖ‰øÆÊîπ123vi /boot/grub/grub.conf Êõ¥ÊîπÂà∞Â¶Ç‰∏ãÂÜÖÂÆπ: kernel /boot/vmlinuz-2.6.18-8.el5 ro root=LABEL=/ elevator=deadline rhgb quiet Á≥ªÁªüÂèÇÊï∞Ë∞ÉÊï¥Linux Á≥ªÁªüÂÜÖÊ†∏ÂèÇÊï∞‰ºòÂåñ12345vim/etc/sysctl.conf net.ipv4.ip_local_port_range = 1024 65535Ôºö# Áî®Êà∑Á´ØÂè£ËåÉÂõ¥ net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.tcp_fin_timeout = 30 fs.file-max=65535Ôºö# Á≥ªÁªüÊúÄÂ§ßÊñá‰ª∂Âè•ÊüÑÔºåÊéßÂà∂ÁöÑÊòØËÉΩÊâìÂºÄÊñá‰ª∂ÊúÄÂ§ßÊï∞Èáè Áî®Êà∑ÈôêÂà∂ÂèÇÊï∞(MySQL ÂèØ‰ª•‰∏çËÆæÁΩÆ‰ª•‰∏ãÈÖçÁΩÆ)Ôºö12345vim/etc/security/limits.conf * soft nproc 65535 * hard nproc 65535 * soft nofile 65535 * hard nofile 65535 Â∫îÁî®‰ºòÂåñ‰∏öÂä°Â∫îÁî®ÂíåÊï∞ÊçÆÂ∫ìÂ∫îÁî®Áã¨Á´ã„ÄÇ Èò≤ÁÅ´Â¢ôÔºöiptables„ÄÅselinux Á≠âÂÖ∂‰ªñÊó†Áî®ÊúçÂä°(ÂÖ≥Èó≠)Ôºö123456789101112131415chkconfig --level 23456 acpid off chkconfig --level 23456 anacron off chkconfig --level 23456 autofs off chkconfig --level 23456 avahi-daemon off chkconfig --level 23456 bluetooth off chkconfig --level 23456 cups off chkconfig --level 23456 firstboot off chkconfig --level 23456 haldaemon off chkconfig --level 23456 hplip off chkconfig --level 23456 ip6tables off chkconfig --level 23456 iptables off chkconfig --level 23456 isdn off chkconfig --level 23456 pcscd off chkconfig --level 23456 sendmail off chkconfig --level 23456 yum-updatesd off ÂÆâË£ÖÂõæÂΩ¢ÁïåÈù¢ÁöÑÊúçÂä°Âô®‰∏çË¶ÅÂêØÂä®ÂõæÂΩ¢ÁïåÈù¢ runlevel 3„ÄÇ Âè¶Â§ñÔºåÊÄùËÄÉÂ∞ÜÊù•Êàë‰ª¨ÁöÑ‰∏öÂä°ÊòØÂê¶ÁúüÁöÑÈúÄË¶Å MySQLÔºåËøòÊòØ‰ΩøÁî®ÂÖ∂‰ªñÁßçÁ±ªÁöÑÊï∞ÊçÆÂ∫ì„ÄÇÁî®Êï∞ÊçÆÂ∫ìÁöÑÊúÄÈ´òÂ¢ÉÁïåÂ∞±ÊòØ‰∏çÁî®Êï∞ÊçÆÂ∫ì„ÄÇ Êï∞ÊçÆÂ∫ì‰ºòÂåñSQL ‰ºòÂåñÊñπÂêëÔºö ÊâßË°åËÆ°Âàí Á¥¢Âºï SQL ÊîπÂÜô Êû∂ÊûÑ‰ºòÂåñÊñπÂêëÔºö È´òÂèØÁî®Êû∂ÊûÑ È´òÊÄßËÉΩÊû∂ÊûÑ ÂàÜÂ∫ìÂàÜË°® Êï∞ÊçÆÂ∫ìÂèÇÊï∞‰ºòÂåñË∞ÉÊï¥ÂÆû‰æãÊï¥‰Ωì(È´òÁ∫ß‰ºòÂåñÔºåÊâ©Â±ï)Ôºö123456thread_concurrencyÔºö# Âπ∂ÂèëÁ∫øÁ®ãÊï∞Èáè‰∏™Êï∞ sort_buffer_sizeÔºö# ÊéíÂ∫èÁºìÂ≠ò read_buffer_sizeÔºö# È°∫Â∫èËØªÂèñÁºìÂ≠ò read_rnd_buffer_sizeÔºö# ÈöèÊú∫ËØªÂèñÁºìÂ≠ò key_buffer_sizeÔºö# Á¥¢ÂºïÁºìÂ≠ò thread_cache_sizeÔºö# (1G‚Äî>8, 2G‚Äî>16, 3G‚Äî>32, >3G‚Äî>64) ËøûÊé•Â±Ç(Âü∫Á°Ä‰ºòÂåñ)ËÆæÁΩÆÂêàÁêÜÁöÑËøûÊé•ÂÆ¢Êà∑ÂíåËøûÊé•ÊñπÂºèÔºö123456789101112131415161718192021222324252627282930max_connections # ÊúÄÂ§ßËøûÊé•Êï∞ÔºåÁúã‰∫§ÊòìÁ¨îÊï∞ËÆæÁΩÆ max_connect_errors # ÊúÄÂ§ßÈîôËØØËøûÊé•Êï∞ÔºåËÉΩÂ§ßÂàôÂ§ß connect_timeout # ËøûÊé•Ë∂ÖÊó∂ max_user_connections # ÊúÄÂ§ßÁî®Êà∑ËøûÊé•Êï∞ skip-name-resolve # Ë∑≥ËøáÂüüÂêçËß£Êûê wait_timeout # Á≠âÂæÖË∂ÖÊó∂ back_log # ÂèØ‰ª•Âú®Â†ÜÊ†à‰∏≠ÁöÑËøûÊé•Êï∞Èáè ``` ##### SQL Â±Ç(Âü∫Á°Ä‰ºòÂåñ)query_cache_sizeÔºö Êü•ËØ¢ÁºìÂ≠ò >>> OLAP Á±ªÂûãÊï∞ÊçÆÂ∫ìÔºåÈúÄË¶ÅÈáçÁÇπÂä†Â§ßÊ≠§ÂÜÖÂ≠òÁºìÂ≠òÔºå‰ΩÜÊòØ‰∏ÄËà¨‰∏ç‰ºöË∂ÖËøá GB„ÄÇÂØπ‰∫éÁªèÂ∏∏Ë¢´‰øÆÊîπÁöÑÊï∞ÊçÆÔºåÁºìÂ≠ò‰ºöÈ©¨‰∏äÂ§±Êïà„ÄÇÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®ÂÜÖÂ≠òÊï∞ÊçÆÂ∫ì(redis„ÄÅmemecache)ÔºåÊõø‰ª£ÂÆÉÁöÑÂäüËÉΩ„ÄÇ##### Â≠òÂÇ®ÂºïÊìéÂ±Ç‰ºòÂåñinnodb Âü∫Á°Ä‰ºòÂåñÂèÇÊï∞Ôºö```bashdefault-storage-engine innodb_buffer_pool_size # Ê≤°ÊúâÂõ∫ÂÆöÂ§ßÂ∞èÔºå50%ÊµãËØïÂÄºÔºåÁúãÁúãÊÉÖÂÜµÂÜçÂæÆË∞É„ÄÇ‰ΩÜÊòØÂ∞ΩÈáèËÆæÁΩÆ‰∏çË¶ÅË∂ÖËøáÁâ©ÁêÜÂÜÖÂ≠ò70% innodb_file_per_table=(1,0) innodb_flush_log_at_trx_commit=(0,1,2) # 1ÊòØÊúÄÂÆâÂÖ®ÁöÑÔºå0ÊòØÊÄßËÉΩÊúÄÈ´òÔºå2Êäò‰∏≠ binlog_sync Innodb_flush_method=(O_DIRECT, fdatasync) innodb_log_buffer_size # 100M‰ª•‰∏ã innodb_log_file_size # 100M ‰ª•‰∏ã innodb_log_files_in_group # 5‰∏™ÊàêÂëò‰ª•‰∏ã,‰∏ÄËà¨2-3‰∏™Â§üÁî®Ôºàiblogfile0-NÔºâ innodb_max_dirty_pages_pct # ËææÂà∞ÁôæÂàÜ‰πã75ÁöÑÊó∂ÂÄôÂà∑ÂÜô ÂÜÖÂ≠òËÑèÈ°µÂà∞Á£ÅÁõò„ÄÇ log_bin max_binlog_cache_size # ÂèØ‰ª•‰∏çËÆæÁΩÆ max_binlog_size # ÂèØ‰ª•‰∏çËÆæÁΩÆ innodb_additional_mem_pool_size #Â∞è‰∫é2GÂÜÖÂ≠òÁöÑÊú∫Âô®ÔºåÊé®ËçêÂÄºÊòØ20M„ÄÇ32GÂÜÖÂ≠ò‰ª•‰∏ä100M ÂèÇËÄÉÊñáÁ´†51CTO‰º†Â™í: ‰∏Ä‰ªΩË∂ÖËØ¶ÁªÜÁöÑMySQLÈ´òÊÄßËÉΩ‰ºòÂåñÂÆûÊàòÊÄªÁªì document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pt-table-checksum fails on older MySQL without utf8mb4-support]]></title>
    <url>%2F2019%2F05%2F14%2FPT-0%2F</url>
    <content type="text"><![CDATA[‚ÄúÂà´ÂÜçÊä±ÊÄ®‰Ω†Ê≠§ÁîüÊâæ‰∏çÂà∞‰∏Ä‰∏™ÂØπÁöÑ‰∫∫ÔºåÂΩìÂàùÁöÑÊï∞Â≠¶ÈÄâÊã©È¢òÂ∞±Âõõ‰∏™Ôºå‰Ω†‰πüÊâæ‰∏çÂà∞ÂØπÁöÑÁ≠îÊ°àÂïä‚Äù ÂâçË®ÄÊò®Â§©Â∏ÆÂêå‰∫ãËß£ÂÜ≥‰∏ª‰ªéÂêåÊ≠•ÁöÑÈóÆÈ¢ò„ÄÇ ÂéüÂõ†ÊòØÂêå‰∫ã‰ΩøÁî®DjangoÂºÄÂèë‰∫Ü‰∏ÄÂ•óËøêÁª¥Âπ≥Âè∞„ÄÇ‰ΩÜÊòØÈáåÈù¢ÁöÑË°®‰ΩøÁî®‰∫ÜFOREIGN KEYÔºåÂú®ÊèíÂÖ•ÁöÑÊòØÊä•Èîô„ÄÇÈÄ†Êàê‰∫Ü‰∏ª‰ªéÂêåÊ≠•ÈîôËØØÔºåÊï∞ÊçÆÈáè‰∏çÂ§ßÔºå‰ΩøÁî®pt-table-checksumÊù•Ê†°È™å‰∏ª‰ªéÊï∞ÊçÆ Êìç‰Ωú‰∏Ä„ÄÅÂÖàË∑≥Ëøá‰∏ª‰ªéÈîôËØØÔºå‰∏ª‰ªéÂêåÊ≠•ÂÖ≥Á≥ªÊÅ¢Â§çÊ≠£Â∏∏„ÄÇ1234STOP SLAVE sql_thread;SET GLOBAL sql_slave_skip_counter = 1;START SLAVE sql_thread;SHOW SLAVE STATUS\G ‰∫å„ÄÅ‰ΩøÁî® pt-table-checksum1pt-table-checksum --set-vars innodb_lock_wait_timeout=200 --nocheck-replication-filters --no-check-binlog-format --replicate=test.checksums --create-replicate-table --databases=***** --host=*** --port=*** --user=*** --password='*****' --recursion-method='processlist' 12345678910111213Error setting innodb_lock_wait_timeout: DBD::mysql::db do failed: Variable 'innodb_lock_wait_timeout' is a read only variable [for Statement "SET SESSION innodb_lock_wait_timeout=1"]. The current value for innodb_lock_wait_timeout is 50. If the variable is read only (not dynamic), specify --set-vars innodb_lock_wait_timeout=50 to avoid this warning, else manually set the variable and restart MySQL.Checking if all tables can be checksummed ...Starting checksum ...Error setting innodb_lock_wait_timeout: DBD::mysql::db do failed: Variable 'innodb_lock_wait_timeout' is a read only variable [for Statement "SET SESSION innodb_lock_wait_timeout=1"]. The current value for innodb_lock_wait_timeout is 50. If the variable is read only (not dynamic), specify --set-vars innodb_lock_wait_timeout=50 to avoid this warning, else manually set the variable and restart MySQL.05-13T18:42:19 Error executing EXPLAIN SELECT COUNT(*) AS cnt, COALESCE(LOWER(CONV(BIT_XOR(CAST(CRC32(CONCAT_WS('#', `id`, convert(`uuid` using utf8mb4), convert(`city` using utf8mb4), convert(`bassert` using utf8mb4), convert(`hostname` using utf8mb4), `idc_id`, `dp_id`, convert(`vlanip` using utf8mb4), convert(`wlanip` using utf8mb4), convert(`remote_ip` using utf8mb4), convert(`network_card` using utf8mb4), convert(`mac` using utf8mb4), convert(`serverown` using utf8mb4), convert(`status` using utf8mb4), convert(`rack` using utf8mb4), convert(`unit` using utf8mb4), convert(`sysversion` using utf8mb4), `order_time`, convert(`comment` using utf8mb4), `update_time`, `onlinetime`, `offlinetime`, convert(`roles` using utf8mb4), convert(`services` using utf8mb4), convert(`install_status` using utf8mb4), convert(`service_env` using utf8mb4), convert(`host_type` using utf8mb4), convert(`kvm_local` using utf8mb4), CONCAT(ISNULL(`order_time`), ISNULL(`onlinetime`), ISNULL(`offlinetime`), ISNULL(`roles`), ISNULL(`services`)))) AS UNSIGNED)), 10, 16)), 0) AS crc FROM `bportal`.`server_basic_info` /*explain checksum table*/: DBD::mysql::st execute failed: Unknown character set: 'utf8mb4' [for Statement "EXPLAIN SELECT COUNT(*) AS cnt, COALESCE(LOWER(CONV(BIT_XOR(CAST(CRC32(CONCAT_WS('#', `id`, convert(`uuid` using utf8mb4), convert(`city` using utf8mb4), convert(`bassert` using utf8mb4), convert(`hostname` using utf8mb4), `idc_id`, `dp_id`, convert(`vlanip` using utf8mb4), convert(`wlanip` using utf8mb4), convert(`remote_ip` using utf8mb4), convert(`network_card` using utf8mb4), convert(`mac` using utf8mb4), convert(`serverown` using utf8mb4), convert(`status` using utf8mb4), convert(`rack` using utf8mb4), convert(`unit` using utf8mb4), convert(`sysversion` using utf8mb4), `order_time`, convert(`comment` using utf8mb4), `update_time`, `onlinetime`, `offlinetime`, convert(`roles` using utf8mb4), convert(`services` using utf8mb4), convert(`install_status` using utf8mb4), convert(`service_env` using utf8mb4), convert(`host_type` using utf8mb4), convert(`kvm_local` using utf8mb4), CONCAT(ISNULL(`order_time`), ISNULL(`onlinetime`), ISNULL(`offlinetime`), ISNULL(`roles`), ISNULL(`services`)))) AS UNSIGNED)), 10, 16)), 0) AS crc FROM `bportal`.`server_basic_info` /*explain checksum table*/"] at /usr/bin/pt-table-checksum line 12302.05-13T18:42:19 Error checksumming table bportal.server_basic_info: Error executing checksum query: DBD::mysql::st execute failed: Unknown character set: 'utf8mb4' [for Statement "REPLACE INTO `test`.`checksums` (db, tbl, chunk, chunk_index, lower_boundary, upper_boundary, this_cnt, this_crc) SELECT ?, ?, ?, ?, ?, ?, COUNT(*) AS cnt, COALESCE(LOWER(CONV(BIT_XOR(CAST(CRC32(CONCAT_WS('#', `id`, convert(`uuid` using utf8mb4), convert(`city` using utf8mb4), convert(`bassert` using utf8mb4), convert(`hostname` using utf8mb4), `idc_id`, `dp_id`, convert(`vlanip` using utf8mb4), convert(`wlanip` using utf8mb4), convert(`remote_ip` using utf8mb4), convert(`network_card` using utf8mb4), convert(`mac` using utf8mb4), convert(`serverown` using utf8mb4), convert(`status` using utf8mb4), convert(`rack` using utf8mb4), convert(`unit` using utf8mb4), convert(`sysversion` using utf8mb4), `order_time`, convert(`comment` using utf8mb4), `update_time`, `onlinetime`, `offlinetime`, convert(`roles` using utf8mb4), convert(`services` using utf8mb4), convert(`install_status` using utf8mb4), convert(`service_env` using utf8mb4), convert(`host_type` using utf8mb4), convert(`kvm_local` using utf8mb4), CONCAT(ISNULL(`order_time`), ISNULL(`onlinetime`), ISNULL(`offlinetime`), ISNULL(`roles`), ISNULL(`services`)))) AS UNSIGNED)), 10, 16)), 0) AS crc FROM `bportal`.`server_basic_info` /*checksum table*/" with ParamValues: 0='bportal', 1='server_basic_info', 2=1, 3=undef, 4=undef, 5=undef] at /usr/bin/pt-table-checksum line 11691. TS ERRORS DIFFS ROWS DIFF_ROWS CHUNKS SKIPPED TIME TABLE05-13T18:42:19 2 0 0 0 1 0 0.008 bportal.server_basic_info ‰∫éÊòØÊéíÈô§ÈóÆÈ¢òÔºö Êü•ÁúãMySQL ÁâàÊú¨ Êü•ÁúãMySQL Â≠óÁ¨¶ÈõÜ Êü•ÁúãÊï∞ÊçÆÂ∫ìÂíåË°®ÁöÑÂ≠óÁ¨¶ÈõÜgoogleÊü•ÊâæÈóÆÈ¢òÂéüÂõ†ÂèëÁé∞ÁØáÊñáÁ´†ÂíåËØ•ÈîôËØØÂá†‰πé‰∏ÄËá¥„ÄÇËØ¥Âà∞pt-table-checksumÂ∑≤Áªè‰∏çÊîØÊåÅMySQL 5.1ÁâàÊú¨„ÄÇ12345Thank you for the report.The error is expected since character set utf8mb4 Unknown to the MySQL 5.1MySQL 5.1 is not a supported version: https://www.percona.com/services/support/mysql-support/percona-toolkit-supported-platforms-and-versions ÂÜô‰∫Ü‰∏Ä‰∏™patch pt-table-checksumÊâìË°•‰∏Å1patch pt-table-checksum < pt-table-checksum.utf8mb4.patch ÊâßË°åÂëΩ‰ª§1pt-table-checksum --set-vars innodb_lock_wait_timeout=200 --nocheck-replication-filters --no-check-binlog-format --replicate=test.checksums --create-replicate-table --databases=***** --host=*** --port=*** --user=*** --password='*****' --recursion-method='processlist' ÂèëÁé∞Ê≤°Êúâ‰∏äÈù¢ÁöÑÈóÆÈ¢òÔºå‰∏ÄÂàáÈÉΩÊ≠£Â∏∏„ÄÇÂú®ÊâßË°å1pt-table-sync --replicate=test.checksums --databases=***** --charset=utf8 h=****,P=****,u=****,p='****' --execute ÊÄªÁªì‰ΩøÁî®MySQL 5.1ÁâàÊú¨ÁöÑÊï∞ÊçÆÂ∫ìËµ∂Âø´ÂçáÁ∫ßÂêß„ÄÇÂ§™ÊäòËÖæ‰∫∫‰∫Ü„ÄÇ ÂèÇËÄÉ Percona: jira document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Toolkit</category>
      </categories>
      <tags>
        <tag>Toolkit</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂõæËß£GoÁöÑchannelÂ∫ïÂ±ÇÂéüÁêÜ]]></title>
    <url>%2F2019%2F05%2F05%2Fgo-channal-graphic%2F</url>
    <content type="text"><![CDATA[Âä™Âäõ‰∏ç‰∏ÄÂÆöÊàêÂäüÔºå‰ΩÜÊòØ‰∏çÂä™Âäõ‰ºöÂæàËàíÊúçÁöÑÂì¶! ÂâçË®ÄchannelÁöÑÊï¥‰ΩìÁªìÊûÑÂõæ ÁÆÄÂçïËØ¥ÊòéÔºö bufÊòØÊúâÁºìÂÜ≤ÁöÑchannelÊâÄÁâπÊúâÁöÑÁªìÊûÑÔºåÁî®Êù•Â≠òÂÇ®ÁºìÂ≠òÊï∞ÊçÆ„ÄÇÊòØ‰∏™Âæ™ÁéØÈìæË°® sendxÂíårecvxÁî®‰∫éËÆ∞ÂΩïbufËøô‰∏™Âæ™ÁéØÈìæË°®‰∏≠ÁöÑ~ÂèëÈÄÅÊàñËÄÖÊé•Êî∂ÁöÑ~index lockÊòØ‰∏™‰∫íÊñ•ÈîÅ„ÄÇ recvqÂíåsendqÂàÜÂà´ÊòØÊé•Êî∂(]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊúÄÂÖ®Oracle DBAÊó•Â∏∏Áª¥Êä§SQLËÑöÊú¨ÂëΩ‰ª§]]></title>
    <url>%2F2019%2F04%2F26%2Foracle-ops-sql%2F</url>
    <content type="text"><![CDATA[‚ÄúÂéüË∞Ö‰ªñ‰ª¨ÊòØ‰∏äÂ∏ùÁöÑ‰∫ãÔºåÊàë‰ª¨ÁöÑ‰ªªÂä°ÊòØË¥üË¥£ÈÄÅ‰ªñ‰ª¨ËßÅ‰∏äÂ∏ù„ÄÇ‚Äù SQL ËØ≠Âè•Êü•ËØ¢Á¢éÁâáÁ®ãÂ∫¶È´òÔºàÂÆûÈôÖ‰ΩøÁî®ÁéáÂ∞è‰∫é30%ÔºâÁöÑË°®ÂèØ‰ª•Êî∂Áº©ÁöÑË°®Êù°‰ª∂‰∏∫‰ªÄ‰πàblock>100ÔºåÂõ†‰∏∫‰∏Ä‰∫õÂæàÂ∞èÁöÑË°®ÔºåÂè™ÊúâÂá†Ë°åÊï∞ÊçÆÂÆûÈôÖÂ§ßÂ∞èÂæàÂ∞èÔºå‰ΩÜÊòØblock‰∏ÄÊ¨°ÊÄßÂàÜÈÖçÂ∞±ÊòØ5‰∏™Ôºà11gÂºÄÂßãÈªòËÆ§‰∏ÄÊ¨°ÊÄßÂàÜÈÖç1MÁöÑblockÂ§ßÂ∞è‰∫ÜÔºåËßÅcreate table storgedÁöÑNEXTÂèÇÊï∞ÔºâÔºå5‰∏™blockÁõ∏ÂØπ‰∫éÂá†Ë°åÂ∞èË°®Êï∞ÊçÆÊù•ËØ¥Â∞±Áõ∏Â∑ÆÂ§™Â§ß‰∫Ü„ÄÇ ÁÆóÊ≥ï‰∏≠/0.9ÊòØÂõ†‰∏∫ÂùóÁöÑpfree‰∏ÄËà¨‰∏∫10%ÔºåÊâÄ‰ª•‰∏Ä‰∏™ÂùóÊúÄÂ§öÂè™Áî®‰∫Ü90%ÔºåËÄå‰∏î‰∏ÄË°åÊï∞ÊçÆÂ§ß‰∫é8KBÊó∂ÂÆπÊòì‰∫ßÁîüË°åÈìæÊé•ÔºåÊää‰∏ÄË°åÂàÜÁâáÂ≠òÂÇ®Ôºå‰∏ÄÊ†∑ÁöÑ‰∏Ä‰∏™ÂùóËøû90%ÈÉΩÁî®‰∏çÊª° ÔºåAVG_ROW_LENËøòÊòØÊØîËæÉÂáÜÁöÑÔºåÊØîÂ¶Ç‰∏™‰∫∫ÂÆûÈ™åÊÉÖÂÜµ‰∏ÄË°®6‰∏™Â≠óÊÆµÔºå‰∏Ä‰∏™numberÔºåÂÖ∂‰ªñ5‰∏™ÈÉΩÊòØchar(100)‰ΩÜÊòØÂÆûÈôÖÊï∞ÊçÆÈÉΩÊòØ‚Äô1111111‚Äô7‰ΩçÔºåAVG_ROW_LENÊòæÁ§∫‰æùÁÑ∂‰∏∫513 „ÄÇ123456789SELECT TABLE_NAME, (BLOCKS * 8192/1024/1024) "ÁêÜËÆ∫Â§ßÂ∞èM", (NUM_ROWS * AVG_ROW_LEN/1024/1024/0.9) "ÂÆûÈôÖÂ§ßÂ∞èM", ROUND((NUM_ROWS * AVG_ROW_LEN/1024/1024/0.9)/(BLOCKS * 8192/1024/1024), 3) * 100|| '%' "ÂÆûÈôÖ‰ΩøÁî®Áéá%"FROM USER_TABLESWHERE blocks > 100 AND (NUM_ROWS * AVG_ROW_LEN/1024/1024/0.9)/(BLOCKS * 8192/1024/1024) < 0.3ORDER BY (NUM_ROWS * AVG_ROW_LEN/1024/1024/0.9)/(BLOCKS * 8192/1024/1024) DESC Êü•ËØ¢Á¥¢ÂºïÁ¢éÁâáÁöÑÊØî‰æãÁ¥¢ÂºïÂà†Èô§Ë°åÊï∞Èô§‰ª•Á¥¢ÂºïÊÄªË°åÊï∞ÁöÑÁôæÂàÜÊØî>30%Âç≥ËÆ§‰∏∫Á¥¢ÂºïÁ¢éÁâáÂ§ßÔºå‰πüÂ∞±ÊòØÈúÄË¶ÅÈáçÂª∫ÁöÑÁ¥¢Âºï12345678910SELECT name, del_lf_rows, lf_rows, ROUND(del_lf_rows/decode(lf_rows, 0, 1, lf_rows) * 100, 0)||'%' frag_pctFROM index_statsWHERE ROUND(del_lf_rows/decode(lf_rows, 0, 1, lf_rows) * 100,0) > 30; ÈõÜÁæ§Âõ†Â≠êclustering_factorÈ´òÁöÑË°®ÈõÜÁæ§Âõ†Â≠êË∂äÊé•ËøëÂùóÊï∞Ë∂äÂ•ΩÔºåÊé•ËøëË°åÊï∞ÂàôËØ¥ÊòéÁ¥¢ÂºïÂàóÁöÑÂàóÂÄºÁõ∏Á≠âÁöÑË°åÂàÜÂ∏ÉÊûÅÂ∫¶Êï£ÂàóÔºåÂèØËÉΩ‰∏çËµ∞Á¥¢ÂºïÊâ´ÊèèËÄåËµ∞ÂÖ®Ë°®Êâ´Êèè Ôºö ÊñπÊ≥ï‰∏ÄÔºö1234567891011121314151617SELECT tab.table_name, tab.blocks, tab.num_rows, ind.index_name, ind.clustering_factor, ROUND(nvl(ind.clustering_factor, 1)/decode(tab.num_rows, 0, 1, tab.num_rows), 3) * 100||'%' "ÈõÜÁæ§Âõ†Â≠êÊé•ËøëË°åÊï∞"FROM user_tables tab, user_indexes indWHERE tab.table_name = ind.table_name AND tab.blocks>100 AND nvl(ind.clustering_factor, 1)/decode(tab.num_rows, 0, 1, tab.num_rows) BETWEEN 0.35 AND 3 ÊñπÊ≥ï‰∫åÔºö12345678910111213141516171819SELECT tab.owner, tab.table_name, tab.blocks, tab.num_rows, ind.index_name, ind.clustering_factor, round(nvl(ind.clustering_factor, 1)/decode(tab.num_rows, 0, 1, tab.num_rows), 3)*100||'%' "ÈõÜÁæ§Âõ†Â≠êÊé•ËøëË°åÊï∞"FROM dba_tables tab, dba_indexes indWHERE tab.table_name=ind.table_name AND tab.owner NOT IN ('SYS', 'SYSTEM', 'WMSYS', 'DBSNMP', 'CTXSYS', 'XDB', 'ORDDATA', 'SYSMAN', 'CATALOG', 'APEX_030200', 'MDSYS', 'OLAPSYS', 'EXFSYS') AND tab.blocks > 100 AND nvl(ind.clustering_factor, 1)/decode(tab.num_rows, 0, 1, tab.num_rows) BETWEEN 0.35 AND 3 Ê†πÊçÆsidÊü•spidÊàñÊ†πÊçÆspidÊü•sid1234567891011121314151617SELECT s.sid, s.serial#, p.spid, s.terminal, s.LOGON_TIME, s.status, s.PROGRAM, s.CLIENT_IDENTIFIER, s.machine, s.action, s.MODULE, s.PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", s.osuserFROM v$session s, v$process pWHERE s.paddr=p.addr AND s.sid=XX OR p.spid=YY Ê†πÊçÆsidÊü•ÁúãÂÖ∑‰ΩìÁöÑsqlËØ≠Âè•Ôºå‰∏çË¶ÅÂä†Êù°‰ª∂v$session.status='ACTIVE'ÔºåÊØîÂ¶ÇtoadÂØπÂêå‰∏ÄÊï∞ÊçÆÂ∫ìÂºÄ‰∏§‰∏™ËøûÊé•‰ºöËØùÔºåÈÉΩÊâßË°å‰∫Ü‰∏Ä‰∫õËØ≠Âè•ÔºåÂÖ∂‰∏≠‰∏Ä‰∏™Á™óÂè£Êü•ËØ¢select * from v$sessionÊó∂‰ºöÂèëÁé∞Âè¶‰∏Ä‰∏™Á™óÂè£Âú®v$session.statusÊòØINACTIVEÔºåÂπ∂‰∏ç‰ª£Ë°®Âè¶‰∏Ä‰∏™Á™óÂè£Ê≤°ÊúâÊâßË°åËøásqlËØ≠Âè•ÔºåËÄåÂΩìÂâçÁ™óÂè£ÊòØactiveÁä∂ÊÄÅÔºåÂØπÂ∫îÁöÑsql_idÂØπÂ∫îÁöÑËØ≠Âè•Â∞±ÊòØselect * from v$sessionËÄå‰∏çÊòØ‰πãÂâçÊâßË°åËøáÁöÑsqlËØ≠Âè•ÔºåACTIVEË°®Á§∫ÂΩìÂâçÊ≠£Âú®ÊâßË°åsql„ÄÇ‰∏Ä‰∏™sidÂèØËÉΩÊâßË°åËøáÂæàÂ§ö‰∏™sqlÔºåÊâÄ‰ª•ÊúâÊó∂ÈúÄË¶ÅÁöÑsqlÈÄöËøáÂ¶Ç‰∏ãÊü•‰∏çÂà∞ÊòØÊ≠£Â∏∏ÁöÑÔºåÊØîÂ¶ÇÊü•ËØ¢Âà∞ÊüêÊ≠ªÈîÅÊ∫êsidÔºåÈÄöËøáÂ¶Ç‰∏ãÊü•ËØ¢ÂèØËÉΩÂè™ÊòØ‰∏™selectËØ≠Âè•ÔºåËÄåÁúüÊ≠£ÂºïËµ∑Ê≠ªÈîÅÁöÑsqlÂç¥Êü•‰∏çÂà∞ÔºåÊòØÂõ†‰∏∫ÂèØËÉΩËøô‰∏™sidÊåÅÁª≠‰∫ÜÂæàÈïøÊó∂Èó¥ÔºåËøô‰∏™sid‰πãÂâçÊâßË°åÁöÑ‰∏Ä‰∫õsqlÂú®v$sqlÂèØËÉΩÂ∑≤ÁªèË¢´Ê∏ÖÈô§‰∫Ü„ÄÇ ÊñπÊ≥ï‰∏ÄÔºö12345678910111213141516171819202122232425262728293031323334SELECT username, sid, SERIAL#, LOGON_TIME, status, PROGRAM, CLIENT_IDENTIFIER, machine, action, PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", osuser, sql_textFROM v$session a, v$sqltext_with_newlines bWHERE DECODE(a.sql_hash_value, 0, prev_hash_value, sql_hash_value) = b.hash_value AND a.sid=&sidORDER BY piece; ``` ##### ÊñπÊ≥ï‰∫å:```bashSELECT username, sid, SERIAL#, LOGON_TIME, status, sql_fulltext, PROGRAM, CLIENT_IDENTIFIER, machine, a.action, PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", osuserFROM v$session a, v$sql bWHERE DECODE(a.sql_hash_value, 0, prev_hash_value, sql_hash_value) = b.hash_value AND a.sid=&sid Â¶ÇÊûú‰∏äÈù¢ËØ≠Âè•ÊâßË°åÂ§™ÊÖ¢ÔºåÂàôÊåâÂ¶Ç‰∏ã‰∏§Ê≠•12345678910111213141516SELECT sql_hash_value, prev_hash_value, username, sid.SERIAL#, LOGON_TIME, status, PROGRAM, CLIENT_IDENTIFIER, machine, action, PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", osuserFROM v$sessionWHERE sid=&sidSELECT sql_fulltextFROM v$sqlWHERE hash_value=XX XX‰∏∫‰∏äÈù¢ sql_hash_valueÔºåÂ¶ÇÊûú sql_hash_value‰∏∫0ÔºåÂàôXX‰∏∫‰∏äÈù¢ prev_hash_value Ê†πÊçÆspidÊü•ËØ¢ÂÖ∑‰ΩìÁöÑsqlËØ≠Âè•(‰∏çË¶ÅÂä†Êù°‰ª∂v$session.status=‚Äô ACTIVE‚Äô,ÊØîÂ¶ÇtoadÂØπÂêå‰∏ÄÊï∞ÊçÆÂ∫ìÂºÄ‰∏§‰∏™ËøûÊé•‰ºöËØùÔºåÈÉΩÊâßË°å‰∫Ü‰∏Ä‰∫õËØ≠Âè•ÔºåÂÖ∂‰∏≠‰∏Ä‰∏™Á™óÂè£Êü•ËØ¢select from v$sessionÊó∂‰ºöÂèëÁé∞Âè¶‰∏Ä‰∏™Á™óÂè£Âú®v$session.statusÊòØINACTIVEÔºåÂπ∂‰∏ç‰ª£Ë°®Âè¶‰∏Ä‰∏™Á™óÂè£Ê≤°ÊúâÊâßË°åËøásqlËØ≠Âè•ÔºåËÄåÂΩìÂâçÁ™óÂè£ÊòØactiveÁä∂ÊÄÅÔºåÂØπÂ∫îÁöÑsql_idÂØπÂ∫îÁöÑËØ≠Âè•Â∞±ÊòØselect from v$sessionËÄå‰∏çÊòØ‰πãÂâçÊâßË°åËøáÁöÑsqlËØ≠Âè•ÔºåACTIVEË°®Á§∫ÂΩìÂâçÊ≠£Âú®ÊâßË°åsql„ÄÇ)123456789101112131415161718192021SELECT ss.SID, ss.SERIAL#, ss.LOGON_TIME, pr.SPID, sa.SQL_FULLTEXT, ss.machine, ss.TERMINAL, ss.PROGRAM, ss.USERNAME, ss.CLIENT_IDENTIFIER, ss.action, ss.PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", ss.STATUS, ss.OSUSER, ss.status, ss.last_call_et, sa.sql_textFROM v$process pr, v$session ss, v$sql saWHERE pr.ADDR = ss.PADDR AND DECODE(ss.sql_hash_value, 0, prev_hash_value, sql_hash_value)=sa.hash_value AND pr.spid=&spid Êü•ÁúãÂéÜÂè≤session_idÁöÑSQLÊù•Ëá™Âì™‰∏™IPÊü•ÁúãtraceÊñá‰ª∂ÂêçÂ∞±ÂèØ‰ª•Áü•ÈÅìspid,traceÊñá‰ª∂ÈáåÈù¢ÊúâsidÂíåÂÖ∑‰ΩìsqlÔºåÂ¶ÇÊûútraceÂ≠òÂú®incidentÔºåÈÇ£traceÂ∞±Áúã‰∏çÂà∞ÂÖ∑‰ΩìsqlÔºå‰ΩÜÊòØÂèØ‰ª•Âú®incidentÊñá‰ª∂‰∏≠ÁúãÂà∞ÂÖ∑‰ΩìÁöÑsqlÔºåÂ¶ÇDW_ora_17751.trc‰∏≠17751Â∞±ÊòØspidÔºåÈáåÈù¢ÊúâËøôÊ†∑ÁöÑÂÜÖÂÆπIncident 115 created, dump file: /XX/incident/incdir_115/DW_ora_17751_i115.trcÔºåÈÇ£‰πàÂú®DW_ora_17751_i115.trcÂ∞±ÂèØ‰ª•ÁúãÂà∞ÂÖ∑‰ΩìÁöÑsqlËØ≠Âè•) DB_ora_29349.trc‰∏≠Âá∫Áé∞1*** SESSION ID:(5057.12807) 2016-10-26 14:45:52.726 ÈÄöËøáË°®V$ACTIVE_SESSION_HISTORYÊù•Êü•123456SELECT a.sql_id, a.machine, a.*FROM V$ACTIVE_SESSION_HISTORY aWHERE a.session_id=5057 AND a.SESSION_SERIAL#=12807 Êü•ËØ¢‰∏äÈù¢ÁöÑmachineÁöÑIP123456789SELECT s.sid, s.serial#, s.LOGON_TIME, s.machine, p.spid, p.terminalFROM v$session s, v$process pWHERE s.paddr=p.addr AND s.machine='localhost' ÈÄöËøá‰∏äÈù¢ÁöÑspidÂú®oracleÊúçÂä°Âô®‰∏äÊâßË°ånetstat -anp |grep spidÂç≥ÂèØ123[oracle@dwdb trace]$ netstat -anp |grep 17630 tcp 210 0 192.168.64.228:11095 192.168.21.16:1521 ESTABLISHED 17630/oracleDB tcp 0 0 ::ffff:192.168.64.228:1521 ::ffff:192.168.64.220:59848 ESTABLISHED 17630/oracleDB Âá∫Áé∞‰∏§‰∏™ÔºåËØ¥ÊòéÊù•Ëá™220ÔºåËøûÊé•‰∫Ü228Êï∞ÊçÆÂ∫ìÊúçÂä°Âô®Ôºå‰ΩÜÊòØÂèàÈÄöËøá228ÊúçÂä°Âô®ÁöÑdblinkÂéªËøûÊé•‰∫Ü16ÊúçÂä°Âô® Êü•ËØ¢Ê≠ªÈîÅÂ†µÂ°ûÁöÑ‰ºöËØùsidÊúÄÁÆÄÂçïÁöÑ‰∏Ä‰∏™SQL1234select * from V$SESSION_BLOCKERS select * from dba_waiters ÊúÄÂ∏∏Áî®ÁöÑ‰∏Ä‰∏™SQL12345678910111213SELECT sid, status, LOGON_TIME, sql_id, blocking_session "Ê≠ªÈîÅÁõ¥Êé•Ê∫ê", FINAL_BLOCKING_SESSION "Ê≠ªÈîÅÊúÄÁªàÊ∫ê", event, seconds_in_wait "‰ºöËØùÈîÅ‰ΩèÊó∂Èó¥_S", LAST_CALL_ET "‰ºöËØùSTATUSÊåÅÁª≠Êó∂Èó¥_S"FROM v$sessionWHERE state='WAITING' AND BLOCKING_SESSION_STATUS='VALID' AND FINAL_BLOCKING_SESSION_STATUS='VALID' ÂèØ‰ª•Êää‰∏§ËÄÖSIDÊîæÂÖ•v$sessionÔºåÂèëÁé∞LOGON_TIMEÂ≠óÊÆµFINAL_BLOCKING_SESSIONÊØîSIDË¶ÅÊó© BLOCKING_SESSION:Session identifier of the blocking session. This column is valid only if BLOCKING_SESSION_STATUS has the value VALID. FINAL_BLOCKING_SESSION:Session identifier of the blocking session. This column is valid only if FINAL_BLOCKING_SESSION_STATUS has the value VALID. Â¶ÇÊûúÈÅáÂà∞RACÁéØÂ¢ÉÔºå‰∏ÄÂÆöË¶ÅÁî®gv$Êù•Êü•ÔºåÂπ∂‰∏îÊâßË°åalter system kill session 'sid,serial#'Ë¶ÅÂà∞RACÂØπÂ∫îÁöÑÂÆû‰æã‰∏äÂéªÊâßË°å Êää‰∏äÈù¢Ë¢´Â†µÂ°û‰ºöËØùÁöÑsid‰ª£ÂÖ•Â¶Ç‰∏ãËØ≠Âè•ÔºåÂèØ‰ª•ÂèëÁé∞ÈîÅ‰ΩèÁöÑÂØπË±°ÂíåÂØπË±°ÁöÑÂì™‰∏ÄË°å(Â¶ÇÊûúsidÊòØÂ†µÂ°ûÊ∫êÁöÑ‰ºöËØùÔºåÂàô row_wait_obj#=-1ÔºåË°®Á§∫ÈîÅÊåÅÊúâËÄÖÔºåÂ∞±ÊòØÊ≠ªÈîÅÊ∫ê‰∫Ü )1234567891011SELECT s.sid, s.username, d.owner, d.object_name, s.row_wait_obj#, s.row_wait_row#, s.row_wait_file#, s.row_wait_block#FROM v$session s, dba_objects dWHERE s.row_wait_obj# = d.object_id AND s.sid in(XX,XX) Êü•ËØ¢ÈîÅ‰ΩèÁöÑDDLÂØπË±°123456SELECT d.session_id, s.SERIAL#, d.nameFROM dba_ddl_locks d, v$session sWHERE d.owner = 'MKLMIGEM' AND d.SESSION_ID=s.sid Êü•ËØ¢Ë∂ÖËøá‰∏§‰∏™Â∞èÊó∂ÁöÑ‰∏çÊ¥ªÂä®‰ºöËØù12345678910111213141516171819202122SELECT s.sid, s.serial#, p.spid, s.LOGON_TIME, s.LAST_CALL_ET, s.status, s.PROGRAM, s.CLIENT_IDENTIFIER, s.machine, s.terminal, s.action, s.PROCESS "ÂÆ¢Êà∑Á´ØÊú∫Âô®ËøõÁ®ãÂè∑", s.osuserFROM v$session s, v$process pWHERE s.paddr=p.addr AND s.sid IN (SELECT sid FROM v$session WHERE machine &DBÊúçÂä°Âô®ÂêçÁß∞ AND status='INACTIVE' AND sql_id is null AND LAST_CALL_ET > 7200 ) Êü•ËØ¢Â†µÂ°ûÂà´ÁöÑ‰ºöËØùË∂ÖËøá30ÂàÜÈíü‰∏îËá™Ë∫´ÊòØ‰∏çÊ¥ªÂä®ÁöÑ‰ºöËØù12345678910111213141516SELECT username, sid, serial#, status, seconds_in_wait, LAST_CALL_ETFROM v$sessionWHERE sid IN (SELECT FINAL_BLOCKING_SESSION FROM v$session WHERE state='WAITING' AND BLOCKING_SESSION_STATUS='VALID' AND FINAL_BLOCKING_SESSION_STATUS='VALID') AND status='INACTIVE' AND sql_id is null AND seconds_in_wait>1800 Êü•ËØ¢ÂèØËÉΩÂ≠òÂú®ËøûÊé•Ê±†Á©∫Èó≤ÂàùÂßãÈÖçÁΩÆËøáÂ§ßÁöÑËøûÊé•ÔºàÊù•Ëá™Âêå‰∏ÄÂè∞Êú∫Âô®ÁöÑÂêå‰∏Ä‰∏™Á®ãÂ∫èÁöÑÁä∂ÊÄÅ‰∏∫INACTIVEÁöÑËøûÊé•ÈùûÂ∏∏Â§öÔºâ12345678910SELECT count(ss.SID), ss.machine, ss.status, ss.TERMINAL, ss.PROGRAM, ss.USERNAME, ss.CLIENT_IDENTIFIERFROM v$session ssGROUP BY ss.machine,ss.status,ss.TERMINAL,ss.PROGRAM,ss.USERNAME,ss.CLIENT_IDENTIFIERHAVING count(ss.SID)>10 Êü•ËØ¢ÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑsql1234567891011121314SELECT s.sid, s.serial#, s.username, spid, v$sql.sql_id, machine, s.terminal, s.program, sql_textFROM v$process,v$session s,v$sqlWHERE addr=paddr AND s.sql_id=v$sql.sql_id AND sql_hash_value=hash_value AND s.STATUS='ACTIVE' Êü•ËØ¢Ê≠£Âú®ÊâßË°åÁöÑSCHEDULER_JOB123456789SELECT owner, job_name, sid, b.SERIAL#, b.username, spidFROM ALL_SCHEDULER_RUNNING_JOBS,v$session b,v$processWHERE session_id=sid AND paddr=addr Êü•ËØ¢Ê≠£Âú®ÊâßË°åÁöÑdbms_job12345678SELECT job, b.sid, b.SERIAL#, b.username, spidFROM DBA_JOBS_RUNNING a ,v$session b,v$processWHERE a.sid=b.sid AND paddr=addr Êü•ËØ¢‰∏Ä‰∏™‰ºöËØùsession„ÄÅprocessÂπ≥ÂùáÊ∂àËÄóÂ§öÂ∞ëPGAÂÜÖÂ≠òÔºåÊü•Áúã‰∏ãÈù¢avg_used_MÂÄº123456789SELECT round(sum(pga_used_mem)/1024/1024, 0) total_used_M, round(sum(pga_used_mem)/count(1)/1024/1024, 0) avg_used_M, round(sum(pga_alloc_mem)/1024/1024, 0) total_alloc_M, round(sum(pga_alloc_mem)/count(1)/1024/1024, 0) avg_alloc_MFROM v$process; TOP 10 ÊâßË°åÊ¨°Êï∞ÊéíÂ∫è1234567891011SELECT *FROM (SELECT executions, username, PARSING_USER_ID, sql_id, sql_text FROM v$sql,dba_users WHERE user_id=PARSING_USER_ID ORDER BY executions desc)WHERE rownum sysdate-18 AND FIRST_TIME>ADD_MONTHS(SYSDATE,-1) ORDER BY FIRST_TIME)GROUP BY TO_CHAR(first_time, 'MM/DD')ORDER BY MIN(RN); Êü•ËØ¢lgwrËøõÁ®ãÂÜôÊó•ÂøóÊó∂ÊØèÊâßË°å‰∏ÄÊ¨°lgwrÈúÄË¶ÅÂ§öÂ∞ëÁßíÔºåÂú®stateÊòØwaitingÁöÑÊÉÖÂÜµ‰∏ãÔºåÊüê‰∏™Á≠âÂæÖÁºñÂè∑seq#‰∏ãÔºåseconds_in_waitËææÂ§öÂ∞ëÁßíÔºåÂ∞±ÊòØlgwrËøõÁ®ãÂÜô‰∏ÄÊ¨°IOÈúÄË¶ÅÂ§öÂ∞ëÁßí12345678SELECT event, state, seq#, seconds_in_wait, programFROM v$sessionWHERE program LIKE '%LGWR%' AND state='WAITING' Êü•ËØ¢Ê≤°ÊúâÁ¥¢ÂºïÁöÑË°®123456789101112SELECT table_nameFROM user_tablesWHERE table_name NOT IN (SELECT table_name FROM user_indexes)SELECT table_nameFROM user_tablesWHERE table_name NOT IN (SELECT table_name FROM user_ind_columns) Êü•ËØ¢‰∏Ä‰∏™AWRÂë®ÊúüÂÜÖÁöÑÂπ≥ÂùásessionÊï∞„ÄÅOSÂπ≥ÂùáË¥üËΩΩ„ÄÅÂπ≥Âùádb time„ÄÅÂπ≥ÂùáÊØèÁßíÂ§öÂ∞ë‰∫ãÂä°12345678910111213SELECT to_char(max(BEGIN_TIME), 'yyyy-mm-dd hh24:mi')||to_char(max(end_time),'* hh24:mi') time, snap_id, trunc(sum(case metric_name WHEN 'Session Count' THEN average end),2) sessions, trunc(sum(case metric_name WHEN 'Current OS Load' THEN average end),2) OS_LOAD, (trunc(sum(case metric_name WHEN 'Database Time Per Sec' THEN average end),2)/100)*(ceil((max(end_time)-max(BEGIN_TIME))*24*60*60)) Database_Time_second, trunc(sum(case metric_name WHEN 'User Transaction Per Sec' THEN average end),2) User_Transaction_Per_SecFROM dba_hist_sysmetric_summaryGROUP BY snap_idORDER BY snap_id; Database Time Per SecÂØπÂ∫îÂÄºÁöÑÂçï‰ΩçÊòØÁôæÂàÜ‰∏ÄÁßí/ÊØèÁßí (/100)(ceil((max(end_time)-max(BEGIN_TIME))246060))ÊòØ‰ª£Ë°®ÊØè‰∏™snapÂë®ÊúüÂÜÖÁöÑÊÄªÁßíÊï∞Ôºåoracle ‰∏§‰∏™Êó∂Èó¥Áõ∏ÂáèÈªòËÆ§ÁöÑÊòØÂ§©Êï∞,2460*60 ‰∏∫Áõ∏Â∑ÆÁöÑÁßíÊï∞ Ëøô‰∏™SQLÊü•Âà∞ÁöÑDB TIMEÊØîËæÉÂáÜÁ°ÆÔºåÂíåawr‰∏äÈù¢ÁöÑdb timeÊØîËæÉ‰∏ÄËá¥ Êü•ËØ¢‰∫ßÁîüÁÉ≠ÂùóËæÉÂ§öÁöÑÂØπË±°x$bh .tch(Touch)Ë°®Á§∫ËÆøÈóÆÊ¨°Êï∞Ë∂äÈ´òÔºåÁÉ≠ÁÇπÂø´Á´û‰∫âÈóÆÈ¢òÂ∞±Â≠òÂú®123456789101112131415161718SELECT e.owner, e.segment_name, e.segment_typeFROM dba_extents e, (SELECT * FROM (SELECT addr, ts#, file#, dbarfil, dbablk, tch FROM x$bh ORDER BY tch DESC) WHERE ROWNUM < 11) b WHERE e.relative_fno = b.dbarfil AND e.block_id b.dbablk; ÊâãÂ∑•ÂàõÂª∫Âø´ÁÖßÁöÑËØ≠Âè•1exec dbms_workload_repository.create_snapshot; AWRËÆæÁΩÆÊØèÈöî30ÂàÜÈíüÊî∂ÈõÜ‰∏ÄÊ¨°Êä•ÂëäÔºå‰øùÁïô14Â§©ÁöÑÊä•Âëä123exec DBMS_WORKLOAD_REPOSITORY.MODIFY_SNAPSHOT_SETTINGS(retention=>14*24*60, interval=>30); select * from dba_hist_wr_control; AWRÂü∫Á∫øÊü•ÁúãÂíåÂàõÂª∫123select * from dba_hist_baseline; exec DBMS_WORKLOAD_REPOSITORY.CREATE_BASELINE(start_snap_id=>7550,end_snap_id=>7660,baseline_name=>'am_baseline'); ÂØºÂá∫AWRÊä•ÂëäÁöÑSQLËØ≠Âè•12345678SELECT *FROM dba_hist_snapshotSELECT *FROM table(dbms_workload_repository.awr_report_html(DBID, INSTANCE_NUMBER, startsnapid,endsnapid))SELECT *FROM TABLE(DBMS_WORKLOAD_REPOSITORY.awr_diff_report_html(DBID, INSTANCE_NUMBER, startsnapid,endsnapid, DBID, INSTANCE_NUMBER, startsnapid,endsnapid)); ÂØºÂá∫ÊúÄÊñ∞ADDMÁöÑÊä•ÂëäÔºàÈúÄË¶ÅsysÁî®Êà∑Ôºâ1234567891011121314SELECT dbms_advisor.get_task_report(task_name)FROM dba_advisor_tasksWHERE task_id = (SELECT max(t.task_id) FROM dba_advisor_tasks t, dba_advisor_log l WHERE t.task_id=l.task_id AND t.advisor_name='ADDM' AND l.status='COMPLETED' );SELECT task_id, task_name, descriptionFROM dba_advisor_tasksORDER BY 1 DESCSELECT dbms_advisor.get_task_report(task_name)FROM dba_advisor_tasksWHERE task_id =XX Êü•ËØ¢Êüê‰∏™SQLÁöÑÊâßË°åËÆ°Âàí12SELECT *FROM table(dbms_xplan.display_cursor('sql_id',0,' advanced ')); ‰∏äÈù¢ÁöÑ0Ë°®Á§∫v$sql.child_number‰∏∫0ÔºåÂ¶ÇÊûú‰∏Ä‰∏™sql_idÂú®v$sql‰∏≠ÊúâÂ§öË°åËØ¥ÊòéÊúâÂ§ö‰∏™child_numberÔºåË¶ÅÁúãÂì™ÂÑøchild_numberÁöÑÊâßË°åËÆ°ÂàíÔºåÂ∞±ÂÜôÂì™‰∏™ÁöÑÂÄºÔºåÊØîÂ¶ÇË¶ÅÁúãchild_number‰∏∫2ÁöÑÊâßË°åËÆ°ÂàíÔºåÂ∞±Êää‰∏äÈù¢sqlÁöÑ0Êîπ‰∏∫2 „ÄÇ ÂÆòÊñπÊñáÊ°£ÂØπdisplay_cursorËøô‰∏™ÂáΩÊï∞ÁöÑËØ¥ÊòéÈáåÈù¢Ê≤°ÊúâadvancedËøô‰∏™ÂèÇÊï∞ÂÄºÔºåÂè™ÊúâBASIC„ÄÅTYPICAL„ÄÅALLËøôÂá†‰∏™Ôºå‰∏çËøáÂÆûË∑µ‰∏≠ÂèëÁé∞advancedËøô‰∏™ÂèÇÊï∞ÂÄºÊòæÁ§∫ÁöÑÂÜÖÂÆπÊØîËøôÂá†‰∏™ÂèÇÊï∞ÂÄºÊòæÁ§∫ÁöÑÈÉΩÂ§ö„ÄÇ12SELECT *FROM table(xplan.display_cursor('v$sql.sql_id',0,'advanced')); ÂàõÂª∫xplanÂåÖÔºåÂÜçÊâßË°å12SQL> CREATE PUBLIC SYNONYM XPLAN FOR SYS.XPLAN; SQL> grant execute on sys.xplan to public; Êü•ËØ¢RmanÁöÑÈÖçÁΩÆ‰ø°ÊÅØ123SELECT NAME, VALUEFROM V$RMAN_CONFIGURATION; Êü•ËØ¢RmanÂ§á‰ªΩÈõÜËØ¶ÁªÜ‰ø°ÊÅØÔºàÊú™ËøáÊúüÁöÑÔºåËøáÊúüÂπ∂Â∑≤Âà†Èô§ÁöÑÊü•‰∏çÂà∞Ôºâ123456789101112SELECT B.RECID BackupSet_ID, A.SET_STAMP, DECODE (B.INCREMENTAL_LEVEL, '', DECODE (BACKUP_TYPE, 'L', 'Archivelog', 'Full'), 1, 'Incr-1Á∫ß', 0, 'Incr-0Á∫ß', B.INCREMENTAL_LEVEL) "Type LV", B.CONTROLFILE_INCLUDED "ÂåÖÂê´CTL", DECODE (A.STATUS, 'A', 'AVAILABLE', 'D', 'DELETED', 'X', 'EXPIRED', 'ERROR') "STATUS", A.DEVICE_TYPE "Device Type", A.START_TIME "Start Time", A.COMPLETION_TIME "Completion Time", A.ELAPSED_SECONDS "Elapsed Seconds", A.BYTES/1024/1024/1024 "Size(G)", A.COMPRESSED, A.TAG "Tag", A.HANDLE "Path"FROM GV$BACKUP_PIECE A, GV$BACKUP_SET BWHERE A.SET_STAMP = B.SET_STAMP AND A.DELETED = 'NO'ORDER BY A.COMPLETION_TIME DESC; Êü•ËØ¢RmanÂ§á‰ªΩËøõÂ∫¶123456789SELECT SID, SERIAL#, opname, ROUND(SOFAR/TOTALWORK*100)||'%' "%_COMPLETE", TRUNC(elapsed_seconds/60) || ':' || MOD(elapsed_seconds,60) elapsed, TRUNC(time_remaining/60) || ':' || MOD(time_remaining,60) remaining, CONTEXT,target,SOFAR, TOTALWORKFROM V$SESSION_LONGOPSWHERE OPNAME LIKE 'RMAN%' AND OPNAME NOT LIKE '%aggregate%' AND TOTALWORK != 0 AND SOFAR TOTALWORK; Êü•ËØ¢ÊâßË°åËøáÂÖ®Ë°®Êâ´ÊèèÁöÑsqlËØ≠Âè•ÁöÑSQL_IDÂíåsql_fulltext12345678910111213141516SELECT s.sid, s.serial#, s.inst_id, s.sql_id, s.username, s.target, s.ELAPSED_SECONDS, s.START_TIME, s.LAST_UPDATE_TIME, v.sql_fulltextFROM gv$session_longops s,gv$sql vWHERE s.OPNAME = 'Table Scan' AND s.SQL_PLAN_OPERATION = 'TABLE ACCESS' AND s.SQL_PLAN_OPTIONS = 'FULL' AND s.sql_id=v.sql_idORDER BY s.LAST_UPDATE_TIME DESC Êü•ËØ¢Ê≠ª‰∫ãÂä°ÈúÄË¶ÅÂ§öÈïøÁöÑÂõûÊªöÊó∂Èó¥1X$KTUXEÔºö[K]ernel [T]ransaction [U]ndo Transa[x]tion [E]ntry (table)` X$KTUXEË°®ÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÂäüËÉΩÊòØÔºåÂèØ‰ª•Ëé∑ÂæóÊó†Ê≥ïÈÄöËøáv$transactionÊù•ËßÇÂØüÁöÑÊ≠ª‰∫ãÂä°‰ø°ÊÅØÔºåÂΩì‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìÂèëÁîüÂºÇÂ∏∏‰∏≠Êñ≠ÔºåÊàñËÄÖËøõË°åÂª∂Ëøü‰∫ãÂä°ÊÅ¢Â§çÊó∂ÔºåÊï∞ÊçÆÂ∫ìÂêØÂä®ÂêéÔºåÊó†Ê≥ïÈÄöËøáV$TRANSACTIONÊù•ËßÇÂØü‰∫ãÂä°‰ø°ÊÅØÔºå‰ΩÜÊòØX$KTUXEÂèØ‰ª•Â∏ÆÂä©Êàë‰ª¨Ëé∑ÂæóËøô‰∫õ‰ø°ÊÅØ„ÄÇËØ•Ë°®‰∏≠ÁöÑKTUXECFL‰ª£Ë°®‰∫Ü‰∫ãÂä°ÁöÑFlagÊ†áËÆ∞ÔºåÈÄöËøáËøô‰∏™Ê†áËÆ∞ÂèØ‰ª•ÊâæÂà∞ÈÇ£‰∫õDead‰∫ãÂä°Ôºö12345SQL> select distinct KTUXECFL,count(*) from x$ktuxe group by KTUXECFL; KTUXECFL COUNT(*) ------------------------ ---------- DEAD 1 NONE 2393 KTUXESIZÁî®Êù•ËÆ∞ÂΩï‰∫ãÂä°‰ΩøÁî®ÁöÑÂõûÊªöÊÆµÂùóÊï∞ÔºåÂèØ‰ª•ÈÄöËøáËßÇÂØüËøô‰∏™Â≠óÊÆµÊù•ËØÑ‰º∞ÊÅ¢Â§çËøõÂ∫¶,‰æãÂ¶ÇÂ¶Ç‰∏ã‰∫ãÂä°ÂõûÊªöÁªèËøáÊµãÁÆóÈúÄË¶ÅÂ§ßÁ∫¶3Â∞èÊó∂12345678910111213141516171819202122SQL> select ADDR,KTUXEUSN,KTUXESLT,KTUXESQN,KTUXESIZ from x$ktuxe where KTUXECFL ='DEAD'; ADDR KTUXEUSN KTUXESLT KTUXESQN KTUXESIZ ---------------- ---------- ---------- ---------- ---------- FFFFFFFF7D07B91C 10 39 2567412 1086075 SQL> select ADDR,KTUXEUSN,KTUXESLT,KTUXESQN,KTUXESIZ from x$ktuxe where KTUXECFL ='DEAD'; ADDR KTUXEUSN KTUXESLT KTUXESQN KTUXESIZ ---------------- ---------- ---------- ---------- ---------- FFFFFFFF7D07B91C 10 39 2567412 1086067 SQL> declare l_start number; l_end number; begin select ktuxesiz into l_start from x$ktuxe where KTUXEUSN=10 and KTUXESLT=39; dbms_lock.sleep(60); select ktuxesiz into l_end from x$ktuxe where KTUXEUSN=10 and KTUXESLT=39; dbms_output.put_line('time_H:'|| round(l_end/(l_start -l_end)/60,2)); end; / time_H:3 ÊääXXXÁî®Êà∑‰∏ãÈù¢ÁöÑÊüê‰∫õYYYË°®ËµãÊùÉÁªôuser,XXX\YYYË¶ÅÂ§ßÂÜô XXXË¶ÅÂ§ßÂÜô12345678declare tablename varchar2(200); begin for x IN (SELECT * FROM dba_tables where owner='XXX' and table_name like '%YYY%') loop tablename:=x.table_name; dbms_output.put_line('GRANT SELECT ON XXX.'||tablename||' to user'); EXECUTE IMMEDIATE 'GRANT SELECT ON XXX.'||tablename||' TO user'; end loop; end; OracleÊü•Âá∫‰∏Ä‰∏™Áî®Êà∑ÂÖ∑ÊúâÁöÑÊâÄÊúâÁ≥ªÁªüÊùÉÈôêÂíåÂØπË±°ÊùÉÈôêÁ≥ªÁªüÊùÉÈôêÔºàÂíåÁî®Êà∑Ëá™Â∑±Êü•ËØ¢select * from session_privsÁöÑÁªìÊûú‰∏ÄËá¥Ôºâ12345678910SELECT *FROM DBA_SYS_PRIVSWHERE GRANTEE = 'Áî®Êà∑Âêç'UNIONALLSELECT *FROM DBA_SYS_PRIVSWHERE GRANTEE IN (SELECT GRANTED_ROLE FROM DBA_ROLE_PRIVS WHERE GRANTEE = 'Áî®Êà∑Âêç'); ÂØπË±°ÊùÉÈôêÔºàÂíåÁî®Êà∑Ëá™Â∑±Êü•ËØ¢select * FROM TABLE_PRIVILEGES where GRANTEE='ÂΩìÂâçÁî®Êà∑'ÁöÑÁªìÊûú‰∏ÄËá¥Ôºâ12345678910SELECT *FROM DBA_TAB_PRIVSWHERE GRANTEE = 'Áî®Êà∑Âêç'UNIONALLSELECT *FROM DBA_TAB_PRIVSWHERE GRANTEE IN (SELECT GRANTED_ROLE FROM DBA_ROLE_PRIVS WHERE GRANTEE = 'Áî®Êà∑Âêç'); Êü•ËØ¢Êüê‰∏™Áî®Êà∑Êã•ÊúâÁöÑËßíËâ≤123SELECT *FROM dba_role_privsWHERE GRANTEE='Áî®Êà∑Âêç'; Êü•ËØ¢Êã•ÊúâDBAËßíËâ≤ÊùÉÈôêÁöÑÁî®Êà∑123SELECT *FROM dba_role_privsWHERE GRANTED_ROLE='DBA'; Êü•ËØ¢Êüê‰∏™ËßíËâ≤Êã•ÊúâÁöÑÁ≥ªÁªüÊùÉÈôê123SELECT *FROM ROLE_SYS_PRIVSWHERE role='ËßíËâ≤Âêç' Ê∏ÖÈô§Êüê‰∏™SQLÁöÑÊâßË°åËÆ°Âàí1Exec DBMS_SHARED_POOL.PURGE('v$sqlarea.ADDRESS,v$sqlarea.HASH_VALUE','c') Êü•ËØ¢ÂØÜÁ†ÅÊòØÂê¶ÊúâËøáÊúüÈôêÂà∂ÔºåÈªòËÆ§ÊòØ180Â§©Ôºå‰∏ÄËà¨‰øÆÊîπ‰∏∫unlimited1234567SELECT *FROM dba_profilesWHERE profile='DEFAULT' AND RESOURCE_NAME LIKE 'PASSWORD%'; ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED Êü•ËØ¢Âíå‰øÆÊîπÈöêÂê´ÂèÇÊï∞ÔºàÂøÖÈ°ªÂú®sysdbaÊùÉÈôê‰∏ãÊìç‰ΩúÔºâ123456789SELECT a.ksppinm name, b.ksppstvl value, a.ksppdesc descriptionFROM x$ksppi a, x$ksppcv bWHERE a.indx = b.indx AND a.ksppinm LIKE '%_small_table_threshold%' alter system set "_small_table_threshold"=value scope=both sid='*'; ‰∏çÂä†sidÂàôËØ¥ÊòéÂú®ÈªòËÆ§Âú®RACÁöÑÊâÄÊúâÂÆû‰æã‰∏≠‰øÆÊîπ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ‰∏ÄÂÆöË¶ÅÂä†‰∏äÂèåÂºïÂè∑, Âè¶Â§ñÂºïÂè∑ÂÜÖ‰∏çËÉΩÊúâÁ©∫Ê†º, Âè™ËÉΩÂåÖÂê´ÂèÇÊï∞ÁöÑÂêçÂ≠ó ËØÑ‰º∞SGAËØ•ËÆæÁΩÆÂ§öÂ∞ë1234567SELECT SGA_SIZEFROM (SELECT * FROM V$SGA_TARGET_ADVICE WHERE ESTD_DB_TIME_FACTOR=1 ORDER BY 1)WHERE rownum=1; Êü•Áúãshared poolËøòÂâ©Â§öÂ∞ë1234SELECT *FROM v$sgastatWHERE name='free memory' AND pool='shared pool'; ÁªüËÆ°ÊâÄÊúâË°®ÁöÑÂÆπÈáèÂ§ßÂ∞è(Âê´ÂàÜÂå∫Â≠óÊÆµ„ÄÅLOBÂ≠óÊÆµ)‰∏ÄËà¨ÂÖàÊâßË°åselect distinct SEGMENT_TYPE from dba_segments where owner'SYS' and tablespace_name'SYSAUX'Êü•ÁúãÂà∞ÊâÄÊúâÁöÑsegment_type123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960SELECT owner, table_name, TRUNC(sum(bytes)/1024/1024) MegFROM (SELECT segment_name table_name, owner, bytes FROM dba_segments WHERE segment_type = 'TABLE' UNION ALLSELECT s.segment_name table_name, pt.owner, s.bytes FROM dba_segments s, dba_part_tables pt WHERE s.segment_name = pt.table_name AND s.owner = pt.owner AND s.segment_type = 'TABLE PARTITION' UNION ALLSELECT i.table_name, i.owner, s.bytes FROM dba_indexes i, dba_segments s WHERE s.segment_name = i.index_name AND s.owner = i.owner AND s.segment_type = 'INDEX' UNION ALLSELECT pi.table_name, pi.owner, s.bytes FROM dba_part_indexes pi, dba_segments s WHERE s.segment_name = pi.index_name AND s.owner = pi.owner AND s.segment_type = 'INDEX PARTITION' UNION ALLSELECT l.table_name, l.owner, s.bytes FROM dba_lobs l, dba_segments s WHERE s.segment_name = l.segment_name AND s.owner = l.owner AND s.segment_type = 'LOBSEGMENT' UNION ALLSELECT l.table_name, l.owner, s.bytes FROM dba_lobs l, dba_segments s WHERE s.segment_name = l.index_name AND s.owner = l.owner AND s.segment_type = 'LOBINDEX' UNION allSELECT l.table_name, l.owner, s.bytes FROM dba_lobs l, dba_segments s WHERE s.segment_name = l.segment_name AND s.owner = l.owner AND s.segment_type = 'LOB PARTITION' )GROUP BY owner,table_nameHAVING SUM(bytes)/1024/1024 > 10ORDER BY SUM(bytes) DESC Êü•ÁúãÂΩìÂâç‰ºöËØùÁöÑSID123SELECT *FROM V$MYSTATWHERE rownumSELECT valueFROM v$dataguard_statsWHERE name='apply lag' Êàñ Â§áÂ∫ìsqlplus>SELECT ceil((sysdate-next_time)*24*60) "M"FROM v$archived_logWHERE applied='YES' AND SEQUENCE#= (SELECT MAX(SEQUENCE#) FROM V$ARCHIVED_LOG WHERE applied='YES'); Êü•ÁúãÊüê‰∏™ÂåÖÊàñÂ≠òÂÇ®ËøáÁ®ãÊòØÂê¶Ê≠£Âú®Ë¢´Ë∞ÉÁî®,Â¶ÇÊûúÂ¶Ç‰∏ãÊúâÁªìÊûúÔºåÂàôÊ≠§Êó∂‰∏çËÉΩÁºñËØëÔºåÂê¶Âàô‰ºöÈîÅ‰Ωè1234SELECT *FROM V$DB_OBJECT_CACHEWHERE pin>0 AND name=upper('XX') Êü•ËØ¢Êï∞ÊçÆÂ∫ìÊâìË°•‰∏ÅÁöÑËÆ∞ÂΩï12SELECT *FROM dba_registry_history; Êü•ËØ¢ÊüêË°®ÁöÑÁ¥¢ÂºïÂ≠óÊÆµÁöÑdistinctË°åÊï∞ÂíåCLUSTERING_FACTOR‰ø°ÊÅØ12345678910111213SELECT a.table_name, a.index_name, b.COLUMN_NAME, a.blevel, a.distinct_keys, A.CLUSTERING_FACTOR, A.NUM_ROWS, trunc((a.distinct_keys/A.NUM_ROWS), 2)*100||'%' "distinct%",trunc((a.CLUSTERING_FACTOR/A.NUM_ROWS),2)*100||'%' "CLUSTERING_FACTOR%"FROM DBA_IND_STATISTICS a,DBA_IND_COLUMNS bWHERE a.table_name='XX' AND a.INDEX_NAME=b.index_nameORDER BY 5 desc Êü•ËØ¢ÊüêË°®ÁöÑÊâÄÊúâÂ≠óÊÆµÁöÑdistinctË°åÊï∞123456789101112SELECT a.table_name, b.num_rows, a.column_name, a.data_type, a.data_length, a.num_distinct, trunc((a.num_distinct/b.num_rows), 2)*100||'%'FROM dba_TAB_COLS a,dba_tables bWHERE a.table_name='XX' AND a.table_name=b.table_nameORDER BY 6 DESC Êü•ËØ¢5G‰ª•‰∏äÁ©∫Èó≤Á©∫Èó¥ÂèØ‰ª•ËøõË°åÊî∂Áº©ÁöÑÊï∞ÊçÆÊñá‰ª∂123456789101112SELECT 'alter database datafile ''' || a.file_name || ''' resize ' || round(a.filesize -(a.filesize - c.hwmsize) * 0.8) || 'M;', a.filesize || 'M' AS "Êï∞ÊçÆÊñá‰ª∂ÁöÑÊÄªÂ§ßÂ∞è", c.hwmsize || 'M' AS "Êï∞ÊçÆÊñá‰ª∂ÁöÑÂÆûÁî®Â§ßÂ∞è"FROM (SELECT file_id, file_name, round(bytes / 1024 / 1024) AS filesize FROM dba_data_files) a, (SELECT file_id, round(max(block_id) * 8 / 1024) AS HWMsize FROM dba_extents GROUP BY file_id) cWHERE a.file_id = c.file_id AND a.filesize - c.hwmsize > 5000; ÂèÇËÄÉ ÂªñÂ≠¶Âº∫,DBAÊó•Â∏∏Áª¥Êä§SQLËÑöÊú¨ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Êï∞ÊçÆÂ∫ìÊãÜÂàÜ]]></title>
    <url>%2F2019%2F04%2F24%2FdatabaseSplitting%2F</url>
    <content type="text"><![CDATA[Á´•ËØùÈáåÁÅ∞ÂßëÂ®òÈÉΩÂæàÁ©∑Ôºå‰ΩÜÈÉΩÂæàÊºÇ‰∫ÆÔºå‰Ω†ÊºÇ‰∫ÆÂêóÔºü Êï∞ÊçÆÂ∫ìÊ∞¥Âπ≥ÂûÇÁõ¥ÊãÜÂàÜÂΩìÊï∞ÊçÆÂ∫ìÈáèÈùûÂ∏∏Â§ßÁöÑÊó∂ÂÄôÔºåDB Â∑≤ÁªèÊàê‰∏∫Á≥ªÁªüÁì∂È¢àÊó∂Â∞±ÂèØ‰ª•ËÄÉËôëËøõË°åÊ∞¥Âπ≥ÂûÇÁõ¥ÊãÜÂàÜ‰∫Ü„ÄÇ Ê∞¥Âπ≥ÊãÜÂàÜ‰∏ÄËà¨Ê∞¥Âπ≥ÊãÜÂàÜÊòØÊ†πÊçÆË°®‰∏≠ÁöÑÊüê‰∏ÄÂ≠óÊÆµ(ÈÄöÂ∏∏ÊòØ‰∏ªÈîÆ ID )ÂèñÊ®°Â§ÑÁêÜÔºåÂ∞Ü‰∏ÄÂº†Ë°®ÁöÑÊï∞ÊçÆÊãÜÂàÜÂà∞Â§ö‰∏™Ë°®‰∏≠„ÄÇËøôÊ†∑ÊØèÂº†Ë°®ÁöÑË°®ÁªìÊûÑÊòØÁõ∏ÂêåÁöÑ‰ΩÜÊòØÊï∞ÊçÆ‰∏çÂêå„ÄÇ ‰∏ç‰ΩÜÂèØ‰ª•ÈÄöËøá ID ÂèñÊ®°ÂàÜË°®ËøòÂèØ‰ª•ÈÄöËøáÊó∂Èó¥ÂàÜË°®ÔºåÊØîÂ¶ÇÊØèÊúàÁîüÊàê‰∏ÄÂº†Ë°®„ÄÇÊåâÁÖßËåÉÂõ¥ÂàÜË°®‰πüÊòØÂèØË°åÁöÑ:‰∏ÄÂº†Ë°®Âè™Â≠òÂÇ® 0~1000WÁöÑÊï∞ÊçÆÔºåË∂ÖËøáÂè™Â∞±ËøõË°åÂàÜË°®ÔºåËøôÊ†∑ÂàÜË°®ÁöÑ‰ºòÁÇπÊòØÊâ©Â±ïÁÅµÊ¥ªÔºå‰ΩÜÊòØÂ≠òÂú®ÁÉ≠ÁÇπÊï∞ÊçÆ„ÄÇ ÊåâÁÖßÂèñÊ®°ÂàÜË°®ÊãÜÂàÜ‰πãÂêéÊàë‰ª¨ÁöÑÊü•ËØ¢„ÄÅ‰øÆÊîπ„ÄÅÂà†Èô§‰πüÈÉΩÊòØÂèñÊ®°„ÄÇÊØîÂ¶ÇÊñ∞Â¢û‰∏ÄÊù°Êï∞ÊçÆÁöÑÊó∂ÂÄôÂæÄÂæÄÈúÄË¶Å‰∏ÄÂº†‰∏¥Êó∂Ë°®Êù•ÁîüÊàê ID,ÁÑ∂ÂêéÊ†πÊçÆÁîüÊàêÁöÑ ID ÂèñÊ®°ËÆ°ÁÆóÂá∫ÈúÄË¶ÅÂÜôÂÖ•ÁöÑÊòØÂì™Âº†Ë°®(‰πüÂèØ‰ª•‰ΩøÁî®ÂàÜÂ∏ÉÂºè ID ÁîüÊàêÂô®Êù•ÁîüÊàê ID)„ÄÇ ÂàÜË°®‰πãÂêé‰∏çËÉΩÈÅøÂÖçÁöÑÂ∞±ÊòØÊü•ËØ¢Ë¶ÅÊØî‰ª•ÂâçÂ§çÊùÇÔºåÈÄöÂ∏∏‰∏çÂª∫ËÆÆ join Ôºå‰∏ÄËà¨ÁöÑÂÅöÊ≥ïÊòØÂÅö‰∏§Ê¨°Êü•ËØ¢„ÄÇ ÂûÇÁõ¥ÊãÜÂàÜÂΩì‰∏ÄÂº†Ë°®ÁöÑÂ≠óÊÆµËøáÂ§öÊó∂ÂàôÂèØ‰ª•ËÄÉËôëÂûÇÁõ¥ÊãÜÂàÜ„ÄÇÈÄöÂ∏∏ÊòØÂ∞Ü‰∏ÄÂº†Ë°®ÁöÑÂ≠óÊÆµÊâçÂàÜ‰∏∫‰∏ªË°®‰ª•ÂèäÊâ©Â±ïË°®Ôºå‰ΩøÁî®È¢ëÊ¨°ËæÉÈ´òÁöÑÂ≠óÊÆµÂú®‰∏ÄÂº†Ë°®ÔºåÂÖ∂‰ΩôÁöÑÂú®‰∏ÄÂº†Ë°®„ÄÇ ËøôÈáåÁöÑÂ§öË°®Êü•ËØ¢‰πü‰∏çÂª∫ËÆÆ‰ΩøÁî® join Ôºå‰æùÁÑ∂Âª∫ËÆÆ‰ΩøÁî®‰∏§Ê¨°Êü•ËØ¢„ÄÇ ÊãÜÂàÜ‰πãÂêéÂ∏¶Êù•ÁöÑÈóÆÈ¢òÊãÜÂàÜ‰πãÂêéÁî±‰∏ÄÂº†Ë°®Âèò‰∏∫‰∫ÜÂ§öÂº†Ë°®Ôºå‰∏Ä‰∏™Â∫ìÂèò‰∏∫‰∫ÜÂ§ö‰∏™Â∫ì„ÄÇÊúÄÁ™ÅÂá∫ÁöÑ‰∏Ä‰∏™ÈóÆÈ¢òÂ∞±ÊòØ‰∫ãÂä°Â¶Ç‰Ωï‰øùËØÅ„ÄÇ ‰∏§ÊÆµÊèê‰∫§ÊúÄÁªà‰∏ÄËá¥ÊÄßÂ¶ÇÊûú‰∏öÂä°ÂØπÂº∫‰∏ÄËá¥ÊÄßË¶ÅÊ±Ç‰∏çÊòØÈÇ£‰πàÈ´òÈÇ£‰πàÊúÄÁªà‰∏ÄËá¥ÊÄßÂàôÊòØ‰∏ÄÁßçÊØîËæÉÂ•ΩÁöÑÊñπÊ°à„ÄÇ ÈÄöÂ∏∏ÁöÑÂÅöÊ≥ïÂ∞±ÊòØË°•ÂÅøÔºåÊØîÂ¶Ç ‰∏Ä‰∏™‰∏öÂä°ÊòØ A Ë∞ÉÁî® BÔºå‰∏§‰∏™ÊâßË°åÊàêÂäüÊâçÁÆóÊúÄÁªàÊàêÂäüÔºåÂΩì A ÊàêÂäü‰πãÂêéÔºåB ÊâßË°åÂ§±Ë¥•Â¶Ç‰ΩïÊù•ÈÄöÁü• A Âë¢„ÄÇ ÊØîËæÉÂ∏∏ËßÅÁöÑÂÅöÊ≥ïÊòØ Â§±Ë¥•Êó∂ B ÈÄöËøá MQ Â∞ÜÊ∂àÊÅØÂëäËØâ AÔºåA ÂÜçÊù•ËøõË°åÂõûÊªö„ÄÇËøôÁßçÁöÑÂâçÊèêÊòØ A ÁöÑÂõûÊªöÊìç‰ΩúÂæóÊòØÂπÇÁ≠âÁöÑÔºå‰∏çÁÑ∂ B ÈáçÂ§çÂèëÊ∂àÊÅØÂ∞±‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂàÜÂ∏ÉÂºè ID ÁîüÊàêÁ≠ñÁï•]]></title>
    <url>%2F2019%2F04%2F24%2FDistributed-ID-Generation%2F</url>
    <content type="text"><![CDATA[ËÉ∏Â∞èÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ§ßÔºåËÉ∏Â§ßÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ•ΩÔºåÂõ†‰∏∫Âè§ËØ≠Êúâ‰∫ëÔºöÁ©∑Âá∂ÊûÅÊÅ∂ÊúâÂÆπ‰πÉÂ§ßÔºÅ ÂâçË®ÄÂØπ‰∫éÁ≥ªÁªü‰∏≠ÁöÑ‰∏ÄÁªÑÊï∞ÊçÆËÄåË®ÄÔºåÂøÖ‰∏çÂèØÂ∞ëÂú∞ÂØπÂ∫îÊúâÂîØ‰∏ÄÊ†áËØÜ„ÄÇÁÆÄÂçïÁöÑÂçï‰ΩìÂ∫îÁî®ÂèØ‰ª•‰ΩøÁî®Êï∞ÊçÆÂ∫ìÁöÑËá™Â¢û ID ‰Ωú‰∏∫ÂîØ‰∏ÄÊ†áËØÜ„ÄÇËÄåÂú®Â§çÊùÇÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂ∞±ÈúÄË¶Å‰∏Ä‰∫õÁâπÂÆöÁöÑÁ≠ñÁï•ÂéªÁîüÊàêÂØπÂ∫îÁöÑÂàÜÂ∏ÉÂºè ID„ÄÇ Â∏∏ËßÅÁöÑÈ°πÁõÆ‰∏≠ ID ‰ºöÊúâ‰ª•‰∏ã‰∏§‰∏™ÁâπÁÇπÔºö ÂÖ®Â±ÄÂîØ‰∏ÄÊÄß„ÄÇ Ë∂ãÂäøÈÄíÂ¢ûÔºàÂØπ‰∫é‰ΩøÁî® MySQL ÁöÑÈ°πÁõÆËÄåË®ÄÔºâ„ÄÇ Âõ†‰∏∫‰∏ÄËà¨ ID ‰ºö‰Ωú‰∏∫Êï∞ÊçÆÂ∫ìÁöÑ‰∏ªÈîÆÂ≠òÂÇ®ÔºåËÄåÂú® MySQL InnoDB ‰∏≠‰ΩøÁî®ÁöÑÊòØËÅöÁ∞áÁ¥¢ÂºïÔºå‰ΩøÁî®ÊúâÂ∫èÁöÑ ID ÂèØ‰ª•‰øùËØÅÂÜôÂÖ•ÊÄßËÉΩ„ÄÇ ‰∏ÄËà¨Âú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠Ôºå‰ºöÊúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊúçÂä°Êù•ÁîüÊàê ID„ÄÇËÄåËøô‰∏™ÊúçÂä°ÂàôÈúÄË¶Å‰øùËØÅÈ´òÂèØÁî®ÊÄß„ÄÅÈ´òQPS ‰∏éÂÆâÂÖ®ÊÄß„ÄÇÂè¶Â§ñÁîüÊàêÁöÑ ID ÊòØ‰∏çÂ∫îËØ•ÂØπÂ§ñÊö¥Èú≤ÁöÑÔºåÂ¶ÇÊûúÈùûË¶ÅÂØπÂ§ñÂ±ïÁ§∫ÔºåÊúÄÂ•ΩÊòØÊó†ËßÑÂàô„ÄÅ‰∏çËßÑÂæãÁöÑÁºñÁ†Å„ÄÇ ÁîüÊàêÁ≠ñÁï•UUIDUUID (Universally Unique Identifier) ÁîüÊàêÁöÑÊòØ‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫ 32 ÁöÑ 16 ËøõÂà∂Ê†ºÂºèÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇUUID ÊúâÂ§ö‰∏™ÁâàÊú¨ÔºåÂêÑÁâàÊú¨ÁÆóÊ≥ï‰∏çÂêå„ÄÇ‰ΩÜÊ†∏ÂøÉÊÄùÊÉ≥ÊòØ‰∏ÄËá¥ÁöÑÔºåÂü∫Êú¨‰∏äÈÉΩÊòØÁªìÂêàÊú∫Âô®ÁöÑÁΩëÂç°„ÄÅÂΩìÂâçÊó∂Èó¥„ÄÅ‰∏Ä‰∏™ÈöèÊú∫Êï∞Êù•ÁîüÊàêÁâπÂÆöÈïøÂ∫¶ÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇ ‰ºòÁÇπÔºöÊÄßËÉΩÂ•Ω„ÄÅÈ´òÂèØÊâ©Â±ïÊÄßÔºöÊú¨Âú∞ÁîüÊàêÔºåÊó†ÁΩëÁªúÊ∂àËÄóÔºå‰∏çÈúÄË¶ÅËÄÉËôëÊÄßËÉΩÁì∂È¢à„ÄÇ Áº∫ÁÇπÔºö Êó†Ê≥ï‰øùËØÅË∂ãÂäøÈÄíÂ¢û„ÄÇ UUID ËøáÈïøÔºåÂ¶ÇÊûúÈúÄË¶ÅÂú®Êï∞ÊçÆÂ∫ìÂ≠òÂÇ®Ôºå‰Ωú‰∏∫‰∏ªÈîÆÂª∫Á´ãÁ¥¢ÂºïÊïàÁéá‰Ωé„ÄÇ ÈÄÇÁî®Âú∫ÊôØÔºö‰∏çÈúÄË¶ÅËÄÉËôëÁ©∫Èó¥Âç†Áî®Ôºå‰∏çÈúÄË¶ÅÁîüÊàêÊúâÈÄíÂ¢ûË∂ãÂäøÔºå‰∏î‰∏çÂú® MySQL ‰∏≠Â≠òÂÇ®„ÄÇ Snowflakesnowflake ÊòØ Twitter ÂºÄÊ∫êÁöÑ‰∏Ä‰∏™ ID ÁîüÊàêÁÆóÊ≥ï„ÄÇ È¶ñ‰ΩçÁ¨¶Âè∑‰ΩçÔºöÂõ†‰∏∫ ID ‰∏ÄËà¨‰∏∫Ê≠£Êï∞ÔºåËØ•ÂÄº‰∏∫ 0„ÄÇ 41 ‰ΩçÊó∂Èó¥Êà≥ÔºàÊØ´ÁßíÁ∫ßÔºâÔºö Êó∂Èó¥Êà≥‰∏çÊòØÂΩìÂâçÊó∂Èó¥ÁöÑÊó∂Èó¥Êà≥ÔºåËÄåÊòØÂ≠òÂÇ®Êó∂Èó¥Êà≥ÁöÑÂ∑ÆÂÄºÔºàÂΩìÂâçÊó∂Èó¥Êà≥ - Ëµ∑ÂßãÊó∂Èó¥Êà≥ÔºàËµ∑ÂßãÊó∂Èó¥Êà≥ÈúÄË¶ÅÁ®ãÂ∫èÊåáÂÆöÔºâÔºâÁêÜËÆ∫‰∏äÂèØ‰ª•ÊúÄÂ§ö‰ΩøÁî® (1 < 41) / (1000x60x60x24x365) = 69Âπ¥]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL Ê∞¥Âπ≥ÊãÜÂàÜË°®ÁöÑ‰∏ÄÊ¨°Ë∏©Âùë]]></title>
    <url>%2F2019%2F04%2F24%2Fmysql-sharding%2F</url>
    <content type="text"><![CDATA[ËÉ∏Â∞èÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ§ßÔºåËÉ∏Â§ßÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ•ΩÔºåÂõ†‰∏∫Âè§ËØ≠Êúâ‰∫ëÔºöÁ©∑Âá∂ÊûÅÊÅ∂ÊúâÂÆπ‰πÉÂ§ßÔºÅ ÂâçË®Ä‰πãÂâç‰∏çÂ∞ë‰∫∫ÈóÆÊàë‚ÄùËÉΩÂê¶ÂàÜ‰∫´‰∏Ä‰∫õÂàÜÂ∫ìÂàÜË°®Áõ∏ÂÖ≥ÁöÑÂÆûË∑µ‚ÄùÔºåÂÖ∂ÂÆû‰∏çÊòØÊàë‰∏çÂàÜ‰∫´ÔºåËÄåÊòØÁúüÁöÑÁªèÈ™å‰∏çÂ§öü§£ÔºõÂíåÂ§ßÈÉ®ÂàÜ‰∫∫‰∏ÄÊ†∑ÈÉΩÊòØÂÅúÁïôÂú®ÁêÜËÆ∫Èò∂ÊÆµ„ÄÇ ‰∏çËøáËøôÊ¨°Â§öÂ∞ëÊúâ‰∫õÂèØ‰ª•ËØ¥ÈÅì‰∫Ü„ÄÇ ÂÖàË∞àË∞àËÉåÊôØÔºåÊàë‰ª¨Áîü‰∫ßÊï∞ÊçÆÂ∫ìÈöèÁùÄ‰∏öÂä°ÂèëÂ±ïÈáè‰πüÈÄêÊ∏êËµ∑Êù•ÔºõÂ•ΩÂá†Âº†ÂçïË°®Â∑≤ÁªèÁ™ÅÁ†¥‰∫øÁ∫ßÊï∞ÊçÆÔºåÂπ∂‰∏î‰øùÊåÅÊØèÂ§© 200+W ÁöÑÊï∞ÊçÆÈáèÂ¢ûÂä†„ÄÇ ËÄåÊàë‰ª¨Êúâ‰∫õ‰∏öÂä°ÈúÄË¶ÅËøõË°åÂÖ≥ËÅîÊü•ËØ¢„ÄÅÊàñËÄÖÊòØÊä•Ë°®ÁªüËÆ°ÔºõÂú®ËøôÊ†∑ÁöÑËÉåÊôØ‰∏ãÂ§ßË°®ÁöÑÈóÆÈ¢òÊõ¥Âä†Á™ÅÂá∫ÔºàÊØîÂ¶Ç‰∏Ä‰∏™Êü•ËØ¢ÂäüËÉΩÈúÄË¶ÅË∑ëÂ•ΩÂá†ÂàÜÈíüÔºâ„ÄÇ ÂèØËÉΩÂæàÂ§ö‰∫∫‰ºöËØ¥Ôºö‰∏∫Âï•ÂçïË°®ÈÉΩËøá‰∫ø‰∫ÜÊâçÊÉ≥ÊñπÊ°àËß£ÂÜ≥ÔºüÂÖ∂ÂÆû‰∏çÊòØ‰∏çÊÉ≥ÔºåËÄåÊòØÁî±‰∫éÂéÜÂè≤ÂéüÂõ†Âä†‰∏äÈîôËØØÈ¢Ñ‰º∞‰∫ÜÊï∞ÊçÆÂ¢ûÈïøÊâçÂØºËá¥Ëøô‰∏™Â±ÄÈù¢„ÄÇÊÄª‰πãÂéüÂõ†ÊØîËæÉÂ§çÊùÇÔºå‰πü‰∏çÊòØÊú¨Ê¨°ËÆ®ËÆ∫ÁöÑÈáçÁÇπ„ÄÇ ‰∏¥Êó∂ÊñπÊ°àÁî±‰∫éÈúÄÊ±ÇÁ¥ß„ÄÅ‰∫∫ÊâãÁº∫ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊï¥‰∏™Â§ÑÁêÜÁöÑËøáÁ®ãÂàÜ‰∏∫Âá†‰∏™Èò∂ÊÆµ„ÄÇ Á¨¨‰∏ÄÈò∂ÊÆµÂ∫îËØ•ÊòØÂéªÂπ¥Â∫ïÔºåÂΩìÊó∂ËøêÁª¥ÂèçÂ∫î MySQL ÊâÄÂú®ÁöÑ‰∏ªÊú∫ÂÜÖÂ≠òÂç†Áî®ÂæàÈ´òÔºåÊï¥‰ΩìË¥üËΩΩ‰πüÂ±ÖÈ´ò‰∏ç‰∏ãÔºåÂØºËá¥Êï¥‰∏™ MySQL ÁöÑÂêûÂêêÈáèÊòéÊòæÈôç‰ΩéÔºàÂÜôÂÖ•„ÄÅÊü•ËØ¢Êï∞ÊçÆÈÉΩÊòéÊòæÂáèÊÖ¢Ôºâ„ÄÇ ‰∏∫Ê≠§Êàë‰ª¨ÊâæÂá∫‰∫ÜÊï∞ÊçÆÈáèÊúÄÂ§ßÁöÑÂá†Âº†Ë°®ÔºåÂèëÁé∞Â§ßÈÉ®ÂàÜÊï∞ÊçÆÈáèÂú®7/8000W Â∑¶Âè≥ÔºåÂ∞ëÊï∞ÁöÑÂ∑≤ÁªèÁ™ÅÁ†¥‰∏Ä‰∫ø„ÄÇ ÈÄöËøá‰∏öÂä°Â±ÇÈù¢ËøõË°åÂàÜÊûêÂèëÁé∞ÔºåËøô‰∫õÊï∞ÊçÆÂ§öÊï∞ÈÉΩÊòØÁî®Êà∑‰∫ßÁîüÁöÑ‰∏Ä‰∫õÊó•ÂøóÂûãÊï∞ÊçÆÔºåËÄå‰∏îËøô‰∫õÊï∞ÊçÆÂú®‰∏öÂä°‰∏äÂπ∂‰∏çÊòØÂº∫Áõ∏ÂÖ≥ÁöÑÔºåÁîöËá≥‰∏§‰∏â‰∏™ÊúàÂâçÁöÑÊï∞ÊçÆÂÖ∂ÂÆûÂ∑≤Áªè‰∏çÈúÄË¶ÅÂÆûÊó∂Êü•ËØ¢‰∫Ü„ÄÇ Âõ†‰∏∫Êé•ËøëÂπ¥Â∫ïÔºåÂ∞ΩÂèØËÉΩÁöÑ‰∏çÊÉ≥ÂéªÂä®Â∫îÁî®ÔºåËÄÉËôëÊòØÂê¶ÂèØ‰ª•Âú®ËøêÁª¥Â±ÇÈù¢ÁºìËß£ÂéãÂäõÔºõ‰∏ªË¶ÅÁöÑÁõÆÁöÑÂ∞±ÊòØÊääÂçïË°®ÁöÑÊï∞ÊçÆÈáèÈôç‰Ωé„ÄÇ ÂéüÊú¨ÊòØÊÉ≥Êää‰∏§‰∏™Êúà‰πãÂâçÁöÑÊï∞ÊçÆÁõ¥Êé•ËøÅÁßªÂá∫Êù•ÊîæÂà∞Â§á‰ªΩË°®‰∏≠Ôºå‰ΩÜÂú®ÂáÜÂ§áÂÆûÊñΩÁöÑËøáÁ®ã‰∏≠ÂèëÁé∞‰∏Ä‰∏™Â§ßÂùë„ÄÇ Ë°®‰∏≠Ê≤°Êúâ‰∏Ä‰∏™ÂèØ‰ª•ÊéíÂ∫èÁöÑÁ¥¢ÂºïÔºåÂØºËá¥Êàë‰ª¨Êó†Ê≥ïÂø´ÈÄüÁöÑÁ≠õÈÄâÂá∫‰∏ÄÈÉ®ÂàÜÊï∞ÊçÆÔºÅËøôÁúüÊòØ‰∏Ä‰∏™Ê∑±ÂùëÔºå‰∏∫ÂêéÈù¢ÁöÑ‰∏Ä‰∫õ‰ºòÂåñÂüã‰∫Ü‰∏™Âú∞Èõ∑ÔºõÂç≥‰æøÊòØÂä†Á¥¢Âºï‰πüÈúÄË¶ÅËä±Âá†‰∏™Â∞èÊó∂ÔºàÂÖ∑‰ΩìÂ§ö‰πÖÊ≤°Êï¢Âú®Áîü‰∫ßÊµãËØïÔºâ„ÄÇ Â¶ÇÊûúÊàë‰ª¨Âº∫Ë°åÊåâÁÖßÊó∂Èó¥ËøõË°åÁ≠õÈÄâÔºåÂèØËÉΩÊü•ËØ¢Âá∫ 4000W ÁöÑÊï∞ÊçÆÂ∞±ÂæóËä±‰∏äÂ•ΩÂá†‰∏™Â∞èÊó∂ÔºõËøôÊòæÁÑ∂ÊòØË°å‰∏çÈÄöÁöÑ„ÄÇ ‰∫éÊòØÊàë‰ª¨‰æøÊÉ≥Âà∞‰∫Ü‰∏Ä‰∏™Â§ßËÉÜÁöÑÊÉ≥Ê≥ïÔºöËøôÈÉ®ÂàÜÊï∞ÊçÆÊòØÂê¶ÂèØ‰ª•Áõ¥Êé•‰∏çË¶Å‰∫ÜÔºü ËøôÂèØËÉΩÊòØÊúÄÊúâÊïàÂèäÊúÄÂø´ÁöÑÊñπÂºè‰∫ÜÔºåÂíå‰∫ßÂìÅÊ≤üÈÄöÂêéÂæóÁü•ËøôÈÉ®ÂàÜÊï∞ÊçÆÁúüÁöÑÂè™ÊòØÊó•ÂøóÂûãÁöÑÊï∞ÊçÆÔºåÂç≥‰æøÊòØÊä•Ë°®Âá∫‰∏çÊù•‰ªäÂêéË°•‰∏ä‰πüÊòØÂèØ‰ª•ÁöÑ„ÄÇ ‰∫éÊòØÊàë‰ª¨Â∞±ÁÆÄÂçïÁ≤óÊö¥ÁöÑÂÅö‰∫Ü‰ª•‰∏ã‰∫ãÊÉÖÔºö ‰øÆÊîπÂéüÊúâË°®ÁöÑË°®ÂêçÔºåÊØîÂ¶ÇÂä†‰∏ä(_190416bak)„ÄÇ ÂÜçÊñ∞Âª∫‰∏ÄÂº†ÂíåÂéüÊúâË°®ÂêçÁß∞Áõ∏ÂêåÁöÑË°®„ÄÇ ËøôÊ†∑Êñ∞ÁöÑÊï∞ÊçÆÂ∞±ÂÜôÂà∞‰∫ÜÊñ∞Ë°®ÔºåÂêåÊó∂‰∏öÂä°‰∏ä‰πüÊòØ‰ΩøÁî®ÁöÑËøô‰∏™Êï∞ÊçÆÈáèËæÉÂ∞èÁöÑÊñ∞Ë°®„ÄÇ ËôΩËØ¥ËøáÁ®ã‰∏çÂ§™‰ºòÈõÖÔºå‰ΩÜËá≥Â∞ëÊòØËß£ÂÜ≥‰∫ÜÈóÆÈ¢òÂêåÊó∂‰πüÁªôÊàë‰ª¨ÂÅöÊäÄÊúØÊîπÈÄ†È¢ÑÁïô‰∫ÜÊó∂Èó¥„ÄÇ ÂàÜË°®ÊñπÊ°à‰πãÂâçÁöÑÊñπÊ°àËôΩËØ¥ÂèØ‰ª•ÁºìËß£ÂéãÂäõÔºå‰ΩÜ‰∏çËÉΩÊ†πÊú¨Ëß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ Êúâ‰∫õ‰∏öÂä°ÂøÖÈ°ªÂæóÊü•ËØ¢‰πãÂâçÁöÑÊï∞ÊçÆÔºåÂØºËá¥‰πãÂâçÈÇ£ÊãõË°å‰∏çÈÄö‰∫ÜÔºåÊâÄ‰ª•Ê≠£Â•ΩÊàë‰ª¨Â∞±ÂÄüÂä©Ëøô‰∏™Êú∫‰ºöÊääË°®ÂàÜ‰∫Ü„ÄÇ ÊàëÁõ∏‰ø°Â§ßÈÉ®ÂàÜ‰∫∫ËôΩËØ¥Ê≤°ÊúâÂÅöËøáÂÆûÈôÖÂÅöËøáÂàÜË°®Ôºå‰ΩÜ‰πüËßÅËøáÁå™Ë∑ëÔºõÁΩë‰∏ä‰∏ÄÊêúÂêÑÁßçÊñπÊ°àÂ±ÇÂá∫‰∏çÁ©∑„ÄÇ ÊàëËÆ§‰∏∫ÊúÄÈáçË¶ÅÁöÑ‰∏ÄÁÇπÊòØË¶ÅÁªìÂêàÂÆûÈôÖ‰∏öÂä°ÊâæÂá∫ÈúÄË¶Å sharding ÁöÑÂ≠óÊÆµÔºåÂêåÊó∂ËøòÊúâ‰∏äÁ∫øÈò∂ÊÆµÁöÑÊï∞ÊçÆËøÅÁßª‰πüÈùûÂ∏∏ÈáçË¶Å„ÄÇ Êó∂Èó¥ÂèØËÉΩÂ§ßÂÆ∂ÈÉΩ‰ºöËØ¥Áî® hash ÁöÑÊñπÂºèÂàÜÈÖçÂæóÊúÄÂùáÂåÄÔºå‰ΩÜÊàëËÆ§‰∏∫ËøôËøòÊòØÈúÄË¶Å‰ΩøÁî®ÂéÜÂè≤Êï∞ÊçÆÁöÑÂú∫ÊôØÊâçÁî®ÂìàÂ∏åÂàÜË°®„ÄÇ ËÄåÂØπ‰∫é‰∏çÈúÄË¶ÅÂéÜÂè≤Êï∞ÊçÆÁöÑÂú∫ÊôØÔºåÊØîÂ¶Ç‰∏öÂä°‰∏äÂè™Êü•ËØ¢Ëøë‰∏â‰∏™ÊúàÁöÑÊï∞ÊçÆ„ÄÇ ËøôÁ±ªÈúÄÊ±ÇÂÆåÊàêÂèØ‰ª•ÈááÂèñÊó∂Èó¥ÂàÜË°®ÔºåÊåâÁÖßÊúà‰ªΩËøõË°åÂàíÂàÜÔºåËøôÊ†∑ÊîπÂä®ÁÆÄÂçïÔºåÂêåÊó∂ÂØπÂéÜÂè≤Êï∞ÊçÆ‰πüÊØîËæÉÂ•ΩËøÅÁßª„ÄÇ ‰∫éÊòØÊàë‰ª¨È¶ñÂÖàÂ∞ÜËøôÁ±ªÈúÄÊ±ÇÁöÑË°®Á≠õÈÄâÂá∫Êù•ÔºåÊåâÁÖßÊúà‰ªΩËøõË°åÊãÜÂàÜÔºåÂè™ÊòØÂú®Êü•ËØ¢ÁöÑÊó∂ÂÄôÊãºÊé•Â•ΩË°®ÂêçÂç≥ÂèØÔºõ‰πüÊØîËæÉÂ•ΩÁêÜËß£„ÄÇ ÂìàÂ∏åÂàöÊâç‰πüÊèêÂà∞‰∫ÜÔºöÈúÄË¶ÅÊ†πÊçÆ‰∏öÂä°ÈúÄÊ±ÇËøõË°åÂàÜË°®Á≠ñÁï•„ÄÇ ËÄå‰∏ÄÊó¶ÊâÄÊúâÁöÑÊï∞ÊçÆÈÉΩÊúâÂèØËÉΩÊü•ËØ¢Êó∂ÔºåÊåâÁÖßÊó∂Èó¥ÂàÜË°®‰πüÂ∞±Ë°å‰∏çÈÄö‰∫Ü„ÄÇÔºà‰πüËÉΩÂÅöÔºåÂè™ÊòØÂ¶ÇÊûú‰∏çÊòØÊåâÁÖßÊó∂Èó¥ËøõË°åÊü•ËØ¢Êó∂ÈúÄË¶ÅÈÅçÂéÜÊâÄÊúâÁöÑË°®Ôºâ Âõ†Ê≠§Êàë‰ª¨ËÆ°ÂàíÈááÁî® hash ÁöÑÊñπÂºèÂàÜË°®ÔºåËøôÁÆóÊòØ‰∏öÁïåÊØîËæÉ‰∏ªÊµÅÁöÑÊñπÂºèÂ∞±‰∏çÂÜçËµòËø∞„ÄÇ ÈááÁî®ÂìàÂ∏åÊó∂ÈúÄË¶ÅÂ∞Ü sharding Â≠óÊÆµÈÄâÂ•ΩÔºåÁî±‰∫éÊàë‰ª¨ÁöÑ‰∏öÂä°ÊØîËæÉÂçïÁ∫ØÔºõÊòØ‰∏Ä‰∏™Áâ©ËÅîÁΩëÂ∫îÁî®ÔºåÊâÄÊúâÁöÑÊï∞ÊçÆÈÉΩÂåÖÂê´ÊúâÁâ©ËÅîÁΩëËÆæÂ§áÁöÑÂîØ‰∏ÄÊ†áËØÜÔºàIMEIÔºâÔºåÂπ∂‰∏îËøô‰∏™Â≠óÊÆµÂ§©ÁÑ∂ÁöÑÂ∞±‰øùÊåÅ‰∫ÜÂîØ‰∏ÄÊÄßÔºõÂ§ßÂ§öÊï∞ÁöÑ‰∏öÂä°‰πüÈÉΩÊòØÊ†πÊçÆËøô‰∏™Â≠óÊÆµÊù•ÁöÑÔºåÊâÄ‰ª•ÂÆÉÈùûÂ∏∏ÈÄÇÂêàÊù•ÂÅöËøô‰∏™ sharding Â≠óÊÆµ„ÄÇ Âú®ÂÅöÂàÜË°®‰πãÂâç‰πüË∞ÉÁ†îËøá MyCAT Âèä sharding-jdbc(Áé∞Â∑≤ÂçáÁ∫ß‰∏∫ shardingsphere)ÔºåÊúÄÁªàËÄÉËôëÂà∞ÂØπÂºÄÂèëÁöÑÂèãÂ•ΩÊÄßÂèä‰∏çÂ¢ûÂä†ËøêÁª¥Â§çÊùÇÂ∫¶ËøòÊòØÂÜ≥ÂÆöÂú® jdbc Â±Ç sharding ÁöÑÊñπÂºè„ÄÇ ‰ΩÜÁî±‰∫éÂéÜÂè≤ÂéüÂõ†Êàë‰ª¨Âπ∂‰∏çÂ§™Â•ΩÈõÜÊàê sharding-jdbcÔºå‰ΩÜÂü∫‰∫é sharding ÁöÑÁâπÁÇπËá™Â∑±ÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÂàÜË°®Á≠ñÁï•„ÄÇ Ëøô‰∏™ÁÆÄÂçï‰πüÂ•ΩÁêÜËß£Ôºö 123int index = hash(shardingÂ≠óÊÆµ) % ÂàÜË°®Êï∞Èáè ;select xx from 'busy_'+index where shardingÂ≠óÊÆµ = xxx; ÂÖ∂ÂÆûÂ∞±ÊòØÁÆóÂá∫‰∫ÜË°®ÂêçÔºåÁÑ∂ÂêéË∑ØÁî±ËøáÂéªÊü•ËØ¢Âç≥ÂèØ„ÄÇ Âè™ÊòØÊàë‰ª¨ÂÆûÁé∞ÁöÑÈùûÂ∏∏ÁÆÄÂçïÔºö‰øÆÊîπ‰∫ÜÊâÄÊúâÁöÑÂ∫ïÂ±ÇÊü•ËØ¢ÊñπÊ≥ïÔºåÊØè‰∏™ÊñπÊ≥ïÈÉΩÈáåÈÉΩÂÅö‰∫ÜËøôÊ†∑ÁöÑ‰∏Ä‰∏™Âà§Êñ≠„ÄÇ Âπ∂Ê≤°ÊúâÂÉè sharding-jdbc ‰∏ÄÊ†∑Ôºå‰ª£ÁêÜ‰∫ÜÊï∞ÊçÆÂ∫ìÁöÑÊü•ËØ¢ÊñπÊ≥ïÔºõÂÖ∂‰∏≠ËøòË¶ÅÂÅö SQLËß£Êûê-->SQLË∑ØÁî±-->ÊâßË°åSQL-->ÂêàÂπ∂ÁªìÊûú Ëøô‰∏ÄÁ≥ªÂàóÁöÑÊµÅÁ®ã„ÄÇ Â¶ÇÊûúËá™Â∑±ÂÜçÂÅö‰∏ÄÈÅçÊó†ÂºÇ‰∫éÈáçÊñ∞ÈÄ†‰∫Ü‰∏Ä‰∏™ËΩÆÂ≠êÔºåÂπ∂‰∏îÂπ∂‰∏ç‰∏ì‰∏öÔºåÂè™ÊòØÂú®Áé∞ÊúâÁöÑÊäÄÊúØÊù°‰ª∂‰∏ãÈÄâÊã©‰∫Ü‰∏Ä‰∏™Âø´ÈÄüÂÆûÁé∞ËææÊàêÊïàÊûúÁöÑÊñπÊ≥ï„ÄÇ ‰∏çËøáËøô‰∏™ËøáÁ®ã‰∏≠Êàë‰ª¨ËäÇÁúÅ‰∫ÜÂ∞Ü sharding Â≠óÊÆµÂìàÂ∏åÁöÑËøáÁ®ãÔºåÂõ†‰∏∫ÊØè‰∏Ä‰∏™ IMEI Âè∑ÂÖ∂ÂÆûÈÉΩÊòØ‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑÊï¥ÂûãÔºåÁõ¥Êé•Áî®ÂÆÉÂÅö mod ËøêÁÆóÂç≥ÂèØ„ÄÇ ËøòÊúâ‰∏Ä‰∏™ÊòØÈúÄË¶Å‰∏Ä‰∏™Áªü‰∏ÄÁöÑÁªÑ‰ª∂ÁîüÊàêËßÑÂàôÔºåÂàÜË°®Âêé‰∏çËÉΩÂÜç‰æùËµñ‰∫éÂçïË°®ÁöÑÂ≠óÊÆµËá™Â¢û‰∫ÜÔºõÊñπÊ≥ïËøòÊòØÊå∫Â§öÁöÑÔºö ÊØîÂ¶ÇÊó∂Èó¥Êà≥+ÈöèÊú∫Êï∞ÂèØÊª°Ë∂≥Â§ßÈÉ®ÂàÜ‰∏öÂä°„ÄÇ UUIDÔºåÁîüÊàêÁÆÄÂçïÔºå‰ΩÜÊ≤°Ê≥ïÂÅöÊéíÂ∫è„ÄÇ Èõ™Ëä±ÁÆóÊ≥ïÁªü‰∏ÄÁîüÊàê‰∏ªÈîÆID„ÄÇ Â§ßÂÆ∂ÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÂÆûÈôÖÊÉÖÂÜµÂÅöÈÄâÊã©„ÄÇ ‰∏öÂä°Ë∞ÉÊï¥Âõ†‰∏∫Êàë‰ª¨Âπ∂Ê≤°Êúâ‰ΩøÁî®Á¨¨‰∏âÊñπÁöÑ sharding-jdbc ÁªÑ‰ª∂ÔºåÊâÄÊúâÊ≤°ÊúâÂäûÊ≥ïÂÅöÂà∞ÂØπ‰ª£Á†ÅÁöÑ‰Ωé‰æµÂÖ•ÊÄßÔºõÊØè‰∏™Ê∂âÂèäÂà∞ÂàÜË°®ÁöÑ‰∏öÂä°‰ª£Á†ÅÈÉΩÈúÄË¶ÅÂÅöÂ∫ïÂ±ÇÊñπÊ≥ïÁöÑÊîπÈÄ†Ôºà‰πüÂ∞±ÊòØË∑ØÁî±Âà∞Ê≠£Á°ÆÁöÑË°®Ôºâ„ÄÇ ËÄÉËôëÂà∞ÂêéÁª≠‰∏öÂä°ÁöÑÂèëÂ±ïÔºåÊàë‰ª¨ÂÜ≥ÂÆöÂ∞ÜÊãÜÂàÜÁöÑË°®ÂàÜ‰∏∫ 64 Âº†ÔºõÂä†‰∏äÂêéÁª≠ÂºïÂÖ•Â§ßÊï∞ÊçÆÂπ≥Âè∞Ë∂≥‰ª•Â∫îÂØπÂá†Âπ¥ÁöÑÊï∞ÊçÆÂ¢ûÈïø„ÄÇ ËøôÈáåËøòÊúâ‰∏™Â∞èÁªÜËäÇÈúÄË¶ÅÊ≥®ÊÑèÔºöÂàÜË°®ÁöÑÊï∞ÈáèÈúÄË¶Å‰∏∫ 2‚àßN Ê¨°ÊñπÔºåÂõ†‰∏∫Âú®ÂèñÊ®°ÁöÑËøôÁßçÂàÜË°®ÊñπÂºè‰∏ãÔºåÂç≥‰æøÊòØ‰ªäÂêéÂÜçÈúÄË¶ÅÂàÜË°®ÂΩ±ÂìçÁöÑÊï∞ÊçÆ‰πü‰ºöÂ∞ΩÈáèÁöÑÂ∞è„ÄÇ ÂÜç‰øÆÊîπÊó∂Âè™ËÉΩÂ∞ÜË°®ÂêçÁß∞ËøõË°åÂÖ®Â±ÄÊêúÁ¥¢ÔºåÁÑ∂ÂêéÂä†‰ª•‰øÆÊîπÔºåÂêåÊó∂Ê†πÊçÆ‰øÆÊîπÁöÑÊñπÊ≥ïÂÄíÊé®Âà∞Ë°®Áé∞ÁöÑ‰∏öÂä°Âπ∂ËÆ∞ÂΩï‰∏ãÊù•ÔºåÊñπ‰æøÂêéÁª≠ÂõûÂΩíÊµãËØï„ÄÇ ÂΩìÁÑ∂Êó†Ê≥ïÈÅøÂÖçÊü•ËØ¢Êó∂Âà©Áî®Èùû sharding Â≠óÊÆµÂØºËá¥ÁöÑÂÖ®Ë°®Êâ´ÊèèÔºåËøôÊòØÊâÄÊúâÂàÜÁâáÂêéÈÉΩ‰ºöÈÅáÂà∞ÁöÑÈóÆÈ¢ò„ÄÇ Âõ†Ê≠§Êàë‰ª¨Âú®‰øÆÊîπÂàÜË°®ÊñπÊ≥ïÁöÑÂ∫ïÂ±ÇÊü•ËØ¢Êó∂ÂêåÊó∂‰πü‰ºöÊü•ÁúãÊòØÂê¶ÊúâËµ∞ÂàÜÁâáÂ≠óÊÆµÔºåÂ¶ÇÊûú‰∏çÊòØÔºåÈÇ£ÊòØÂê¶ÂèØ‰ª•Ë∞ÉÊï¥‰∏öÂä°„ÄÇ ÊØîÂ¶ÇÂØπ‰∫é‰∏Ä‰∏™‰∏ä‰∫øÁöÑÊï∞ÊçÆÊòØÂê¶ËøòÊúâÂøÖË¶ÅÂ≠òÂú®ÊåâÁÖßÂàÜÈ°µÊü•ËØ¢„ÄÅÊó•ÊúüÊü•ËØ¢ÔºüËøôÊ†∑ÁöÑ‰∏öÂä°ÊòØÂê¶ÁúüÁöÑÂÖ∑ÊúâÊÑè‰πâÔºü Êàë‰ª¨Â∞ΩÂèØËÉΩÁöÑÂºïÂØº‰∫ßÂìÅÊåâÁÖßËøôÊ†∑ÁöÑÊñπÂºèÊù•ËÆæËÆ°‰∫ßÂìÅÊàñËÄÖÂÅöÂá∫Ë∞ÉÊï¥„ÄÇ ‰ΩÜÂØπ‰∫éÊä•Ë°®ËøôÁ±ªÁöÑÈúÄÊ±ÇÁ°ÆÂÆû‰πüÊ≤°ÂäûÊ≥ïÔºåÊØîÂ¶ÇÁªüËÆ°Ë°®‰∏≠ÊüêÁßçÁ±ªÂûãÁöÑÊï∞ÊçÆÔºõËøôÁßçÊàë‰ª¨‰πüÂèØ‰ª•Âà©Áî®Â§öÁ∫øÁ®ãÁöÑÊñπÂºèÂéªÂπ∂Ë°åÊü•ËØ¢ÁÑ∂ÂêéÊ±áÊÄªÁªüËÆ°Êù•ÊèêÈ´òÊü•ËØ¢ÊïàÁéá„ÄÇ ÊúâÊó∂‰πüÊúâ‰∏Ä‰∫õÂè¶Á±ªÂú∫ÊôØÔºö ÊØîÂ¶Ç‰∏Ä‰∏™ÂçÉ‰∏áË°®‰∏≠ÊúâÊüê‰∏ÄÁâπÊÆäÁ±ªÂûãÁöÑÊï∞ÊçÆÂè™Âç†‰∫ÜÂæàÂ∞è‰∏ÄÈÉ®ÂàÜÔºåÊØîÂ¶ÇËØ¥Âá†ÂçÉ‰∏ä‰∏áÊù°„ÄÇ ËøôÊó∂È°µÈù¢‰∏äÈúÄË¶ÅÂØπÂÆÉËøõË°åÂàÜÈ°µÊü•ËØ¢ÊòØÊØîËæÉÊ≠£Â∏∏ÁöÑÔºàÊØîÂ¶ÇÊüêÁßçÊäïËØâÊ∂àÊÅØÔºåÂÆ¢Êà∑ÈúÄË¶Å‰∏ÄÊù°‰∏ÄÊù°ÁöÑÂçïÁã¨Â§ÑÁêÜÔºâÔºå‰ΩÜÂ¶ÇÊûúÊàë‰ª¨ÊåâÁÖß IMEI Âè∑ÊàñËÄÖÊòØ‰∏ªÈîÆËøõË°åÂàÜÁâáÂêéÂÜçÂàÜÈ°µÊü•ËØ¢ÈÇ£Â∞±ÊØîËæÉËõãÁñº‰∫Ü„ÄÇ ÊâÄ‰ª•ËøôÁ±ªÂûãÁöÑÊï∞ÊçÆÂª∫ËÆÆÂçïÁã¨Êñ∞Âª∫‰∏ÄÂº†Ë°®Êù•Áª¥Êä§Ôºå‰∏çË¶ÅÂíåÂÖ∂‰ªñÊï∞ÊçÆÊ∑∑ÂêàÂú®‰∏ÄËµ∑ÔºåËøôÊ†∑‰∏çÁÆ°ÊòØÂÅöÂàÜÈ°µËøòÊòØ like ÈÉΩÊØîËæÉÁÆÄÂçïÂíåÁã¨Á´ã„ÄÇ È™åËØÅ‰ª£Á†ÅÊîπÂÆåÔºåÂºÄÂèë‰πüÂçïÊµãÂÆåÊàêÂêéÊÄé‰πàÊù•È™åËØÅÂàÜË°®ÁöÑ‰∏öÂä°ÊòØÂê¶Ê≠£Â∏∏‰πüÊØîËæÉÈ∫ªÁÉ¶„ÄÇ ‰∏Ä‰∏™ÊòØÊµãËØïÈ∫ªÁÉ¶ÔºåÂÜç‰∏Ä‰∏™ÊòØ‰∏á‰∏ÄÂì™ÈáåÊîπÊºè‰∫ÜËøòÊòØÊü•ËØ¢ÁöÑÂéüË°®Ôºå‰ΩÜËøôÊ†∑Âú®ÊµãËØïÁéØÂ¢ÉÂπ∂‰∏ç‰ºöÊúâÂºÇÂ∏∏Ôºå‰∏ÄÊó¶‰∏äÁ∫ø‰∫ßÁîü‰∫ÜÁîü‰∫ßÊï∞ÊçÆÂà∞Êñ∞ÁöÑ 64 Âº†Ë°®ÂêéÊÉ≥Ë¶ÅÂÜç‰øÆÂ§çÂ∞±ÊØîËæÉÈ∫ªÁÉ¶‰∫Ü„ÄÇ ÊâÄ‰ª•Êàë‰ª¨Âèñ‰∫Ü‰∏™Â∑ßÔºåÁõ¥Êé•Â∞ÜÂéüË°®ÁöÑË°®Âêç‰øÆÊîπÔºåÊØîÂ¶ÇÂä†‰∏Ä‰∏™ÂêéÁºÄÔºõËøôÊ†∑Âú®ÊµãËØïËøáÁ®ã‰∏≠ËßÇÂØüÂâçÂêéÂè∞ÊúâÊó†Êä•ÈîôÂ∞±ÊØîËæÉÂÆπÊòìÊèêÂâçÂèëÁé∞Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ ‰∏äÁ∫øÊµÅÁ®ãÊµãËØïÈ™åÊî∂ÈÄöËøáÂêéÂè™ÊòØÂàÜË°®Ëøô‰∏™ÈúÄÊ±ÇÁöÑ80%ÔºåÂâ©‰∏ãÂ¶Ç‰Ωï‰∏äÁ∫ø‰πüÊòØÊØîËæÉÂ§¥Áñº„ÄÇ ‰∏ÄÊó¶Â∫îÁî®‰∏äÁ∫øÂêéÊâÄÊúâÁöÑÊü•ËØ¢„ÄÅÂÜôÂÖ•„ÄÅÂà†Èô§ÈÉΩ‰ºöÂÖàËµ∞Ë∑ØÁî±ÁÑ∂ÂêéÂà∞ËææÊñ∞Ë°®ÔºõËÄåËÄÅÊï∞ÊçÆÂú®ÂéüË°®ÈáåÊòØ‰∏ç‰ºöÂèëÁîüÊîπÂèòÁöÑ„ÄÇ Êï∞ÊçÆËøÅÁßªÊâÄ‰ª•Êàë‰ª¨‰∏äÁ∫øÂâçÁöÑÁ¨¨‰∏ÄÊ≠•Ëá™ÁÑ∂ÊòØÈúÄË¶ÅÂ∞ÜÂéüÊúâÁöÑÊï∞ÊçÆËøõË°åËøÅÁßªÔºåËøÅÁßªÁöÑÁõÆÁöÑÊòØË¶ÅÂàÜÁâáÂà∞Êñ∞ÁöÑ 64 Âº†Ë°®‰∏≠ÔºåËøôÊ†∑Êâç‰ºöÂØπÂéüÊúâÁöÑ‰∏öÂä°Êó†ÂΩ±Âìç„ÄÇ Âõ†Ê≠§Êàë‰ª¨ÈúÄË¶ÅÈ¢ùÂ§ñÂáÜÂ§á‰∏Ä‰∏™Á®ãÂ∫èÔºåÂÆÉÈúÄË¶ÅÂ∞ÜËÄÅË°®ÈáåÁöÑÊï∞ÊçÆÊåâÁÖßÂàÜÁâáËßÑÂàôÂ§çÂà∂Âà∞Êñ∞Ë°®‰∏≠Ôºõ Âú®Êàë‰ª¨Ëøô‰∏™Âú∫ÊôØ‰∏ãÔºåÁîü‰∫ßÊï∞ÊçÆÊúâ‰∫õÂ∑≤Áªè‰∏ä‰∫ø‰∫ÜÔºåËøô‰∏™ËøÅÁßªËøáÁ®ãÊàë‰ª¨Âú®ÊµãËØïÁéØÂ¢ÉÊ®°ÊãüÂèëÁé∞ËÄóÊó∂ÊòØÈùûÂ∏∏‰πÖÁöÑ„ÄÇËÄå‰∏îÊàë‰ª¨ËÄÅË°®‰∏≠ÂØπ‰∫é create_time ËøôÊ†∑Áî®‰∫éÁ≠õÈÄâÊï∞ÊçÆÁöÑÂ≠óÊÆµÊ≤°ÊúâÁ¥¢ÂºïÔºà‰ª•ÂâçÁöÑÊäÄÊúØÂÄ∫ÔºâÔºåÊâÄ‰ª•Êü•ËØ¢Ëµ∑Êù•Â∞±Êõ¥Âä†ÊÖ¢‰∫Ü„ÄÇ ÊúÄÂêéÊ≤°ÂäûÊ≥ïÔºåÊàë‰ª¨Âè™ËÉΩÂíå‰∫ßÂìÅÂçèÂïÜÂëäÁü•Áî®Êà∑ÂØπ‰∫é‰πãÂâç‰∫ßÁîüÁöÑÊï∞ÊçÆÁü≠ÊúüÂèØËÉΩ‰ºöÊü•ËØ¢‰∏çÂà∞ÔºåËøô‰∏™Êó∂Èó¥ÊúÄÂùèÂèØËÉΩ‰ºöÊåÅÁª≠Âá†Â§©ÔºàÊàë‰ª¨Âè™ËÉΩÂú®ÂáåÊô®ËøÅÁßªÔºåÁôΩÂ§©‰ºöÂΩ±ÂìçÂà∞Êï∞ÊçÆÂ∫ìË¥üËΩΩÔºâ„ÄÇ ÊÄªÁªìËøô‰æøÊòØÊàë‰ª¨ËøôÊ¨°ÁöÑÂàÜË°®ÂÆûË∑µÔºåËôΩËØ¥‰∏çÂ∞ëËøáÁ®ãÈÉΩ‰∏ç‰ºòÈõÖÔºå‰ΩÜÂèóÈôê‰∫éÊù°‰ª∂‰πüÂè™ËÉΩÊäò‰∏≠Â§ÑÁêÜ„ÄÇ ‰ΩÜÊàë‰ª¨ÂêéÁª≠ÁöÑËÆ°ÂàíÊòØÔºå‰øÆÊîπÊàë‰ª¨Â∫ïÂ±ÇÁöÑÊï∞ÊçÆËøûÊé•ÔºàÁõÆÂâçÊòØËá™Â∑±Â∞ÅË£ÖÁöÑ‰∏Ä‰∏™ jar ÂåÖÔºåÂØºËá¥ÈõÜÊàê sharding-jdbc ÊØîËæÉÈ∫ªÁÉ¶ÔºâÊúÄÁªàÈÄêÊ∏êËøÅÁßªÂà∞ sharding-jdbc . ÊúÄÂêéÂæóÂá∫‰∫ÜÂá†‰∏™ÁªìËÆ∫Ôºö ‰∏Ä‰∏™Â•ΩÁöÑ‰∫ßÂìÅËßÑÂàíÈùûÂ∏∏ÊúâÂøÖË¶ÅÔºåÂèØ‰ª•Âú®ÂêàÁêÜÁöÑÊó∂Èó¥ÂØπÊï∞ÊçÆÂ§ÑÁêÜÔºà‰∏çÁÆ°ÊòØÂàÜË°®ËøòÊòØÂàáÂÖ•ÂΩíÊ°£Ôºâ„ÄÇ ÊØèÂº†Ë°®ÈÉΩÈúÄË¶Å‰∏Ä‰∏™ÂèØ‰ª•Áî®‰∫éÊéíÂ∫èÊü•ËØ¢ÁöÑÂ≠óÊÆµÔºàËá™Â¢ûID„ÄÅÂàõÂª∫Êó∂Èó¥ÔºâÔºåÊï¥‰∏™ËøáÁ®ãÁî±‰∫éÊ≤°ÊúâËøô‰∏™Â≠óÊÆµÂØºËá¥ËÄΩÊêÅ‰∫ÜÂæàÈïøÊó∂Èó¥„ÄÇ ÂàÜË°®Â≠óÊÆµÈúÄË¶ÅË∞®ÊÖéÔºåË¶ÅÂÖ®ÁõòÁöÑËÄÉËôë‰∏öÂä°ÊÉÖÂÜµÔºåÂ∞ΩÈáèÈÅøÂÖçÂá∫Áé∞Êü•ËØ¢Êâ´Ë°®ÁöÑÊÉÖÂÜµ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL5.7 GTIDÂéüÁêÜ‰∏éÂÆûÊàò]]></title>
    <url>%2F2019%2F04%2F22%2Fmysql-GTID%2F</url>
    <content type="text"><![CDATA[Â∑•‰ΩúÂ§öÂπ¥ÔºåÂΩì‰∫∫ÂÆ∂ÈóÆ‰Ω†ÊòØ‰∏çÊòØÂàùÂÖ•Á§æ‰ºöÔºå‰∏çÊòØÂõ†‰∏∫‰Ω†ÁúãËµ∑Êù•Âπ¥ËΩªÔºåËÄåÊòØÂõ†‰∏∫ËßâÂæó‰Ω†ÊÄé‰πàËøô‰πàÁ¨®„ÄÇ ÂâçË®ÄGTIDÊòØ‰ªÄ‰πàÔºüGTID ÊòØGlobal Transaction IdentifiersÁöÑÁº©ÂÜôÔºåÁÆÄÁß∞GTID GTIDÁªÑÊàêÂíåÊû∂ÊûÑ1) GTID = source_id:transaction_id2) server_uuid Êù•Ê∫ê‰∫é auto.cnf13E11FA47-71CA-11E1-9E33-C80AA9429562 3) GTID: Âú®‰∏ÄÁªÑÂ§çÂà∂‰∏≠ÔºåÂÖ®Â±ÄÂîØ‰∏Ä The syntax for a GTID set is as follows:1234567891011121314151617gtid_set: uuid_set [, uuid_set] ... | ''uuid_set: uuid:interval[:interval]...uuid: hhhhhhhh-hhhh-hhhh-hhhh-hhhhhhhhhhhhh: [0-9|A-F]interval: n[-n] (n >= 1) mysql.gtid_executedË°®ÁöÑÂéãÁº©Áî±Âêç‰∏∫thread/sql/compress_gtid_tableÁöÑ‰∏ìÁî®ÂâçÂè∞Á∫øÁ®ãÊâßË°å„ÄÇ Ê≠§Á∫øÁ®ãÊú™Âú®SHOW PROCESSLISTÁöÑËæìÂá∫‰∏≠ÂàóÂá∫Ôºå‰ΩÜÂèØ‰ª•Â∞ÜÂÖ∂ËßÜ‰∏∫Á∫øÁ®ãË°®‰∏≠ÁöÑ‰∏ÄË°åÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö12345678910111213141516171819mysql> SELECT * FROM performance_schema.threads WHERE NAME LIKE '%gtid%'\G*************************** 1. row *************************** THREAD_ID: 26 NAME: thread/sql/compress_gtid_table TYPE: FOREGROUND PROCESSLIST_ID: 1 PROCESSLIST_USER: NULL PROCESSLIST_HOST: NULL PROCESSLIST_DB: NULLPROCESSLIST_COMMAND: Daemon PROCESSLIST_TIME: 1509 PROCESSLIST_STATE: Suspending PROCESSLIST_INFO: NULL PARENT_THREAD_ID: 1 ROLE: NULL INSTRUMENTED: YES HISTORY: YES CONNECTION_TYPE: NULL THREAD_OS_ID: 18677 GTIDÂíåBinlogÁöÑÂÖ≥Á≥ª GTIDÂú®binlog‰∏≠ÁöÑÁªìÊûÑ GTID event ÁªìÊûÑ Previous_gtid_log_event Previous_gtid_log_event Âú®ÊØè‰∏™binlog Â§¥ÈÉ®ÈÉΩ‰ºöÊúâ ÊØèÊ¨°binlog rotateÁöÑÊó∂ÂÄôÂ≠òÂÇ®Âú®binlogÂ§¥ÈÉ® Previous-GTIDsÂú®binlog‰∏≠Âè™‰ºöÂ≠òÂÇ®Âú®ËøôÂè∞Êú∫Âô®‰∏äÊâßË°åËøáÁöÑÊâÄÊúâbinlogÔºå‰∏çÂåÖÊã¨ÊâãÂä®ËÆæÁΩÆgtid_purgedÂÄº„ÄÇ Êç¢Âè•ËØùËØ¥ÔºåÂ¶ÇÊûú‰Ω†ÊâãÂä®set global gtid_purged=xx; ÈÇ£‰πàxxÊòØ‰∏ç‰ºöËÆ∞ÂΩïÂú®Previous_gtid_log_event‰∏≠ÁöÑ„ÄÇ GTIDÂíåBinlog‰πãÈó¥ÁöÑÂÖ≥Á≥ªÊòØÊÄé‰πàÂØπÂ∫îÁöÑÂë¢ Â¶Ç‰ΩïÊâçËÉΩÊâæÂà∞GTID=?ÂØπÂ∫îÁöÑbinlogÊñá‰ª∂Âë¢Ôºü12345678* ÂÅáËÆæÊúâ4‰∏™binlog: bin.001,bin.002,bin.003,bin.004* bin.001 : Previous-GTIDs=empty; binlog_eventÊúâÔºö1-40 * bin.002 : Previous-GTIDs=1-40; binlog_eventÊúâÔºö41-80 * bin.003 : Previous-GTIDs=1-80; binlog_eventÊúâÔºö81-120 * bin.004 : Previous-GTIDs=1-120; binlog_eventÊúâÔºö121-160 1. ÂÅáËÆæÁé∞Âú®Êàë‰ª¨Ë¶ÅÊâæGTID=$AÔºåÈÇ£‰πàMySQLÁöÑÊâ´ÊèèÈ°∫Â∫è‰∏∫Ôºö ‰ªéÊúÄÂêé‰∏Ä‰∏™binlogÂºÄÂßãÊâ´ÊèèÔºàÂç≥Ôºöbin.004Ôºâ 2. bin.004ÁöÑPrevious-GTIDs=1-120ÔºåÂ¶ÇÊûú$A=140 > Previous-GTIDs,ÈÇ£‰πàËÇØÂÆöÂú®bin.004‰∏≠ 3. bin.004ÁöÑPrevious-GTIDs=1-120ÔºåÂ¶ÇÊûú$A=88 ÂåÖÂê´Âú®Previous-GTIDs‰∏≠,ÈÇ£‰πàÁªßÁª≠ÂØπÊØî‰∏ä‰∏Ä‰∏™binlogÊñá‰ª∂ bin.003,ÁÑ∂ÂêéÂÜçÂæ™ÁéØÂâçÈù¢2‰∏™Ê≠•È™§ÔºåÁõ¥Âà∞ÊâæÂà∞‰∏∫Ê≠¢ ÈáçË¶ÅÂèÇÊï∞ÁöÑÊåÅ‰πÖÂåñ GTIDÁõ∏ÂÖ≥ÂèÇÊï∞ variables comment gtid_executed ÊâßË°åËøáÁöÑÊâÄÊúâGTID gtid_purged ‰∏¢ÂºÉÊéâÁöÑGTID gtid_mode gtidÊ®°Âºè gtid_next sessionÁ∫ßÂà´ÁöÑÂèòÈáèÔºå‰∏ã‰∏Ä‰∏™gtid gtid_owned Ê≠£Âú®ËøêË°åÁöÑgtid enforce_gtid_consistency ‰øùËØÅGTIDÂÆâÂÖ®ÁöÑÂèÇÊï∞ ÈáçË¶ÅÂèÇÊï∞Â¶Ç‰ΩïÊåÅ‰πÖÂåñ Â¶Ç‰ΩïÊåÅ‰πÖÂåñgtid_executed [ log-bin=on,log_slave_update=on ]123gtid_executed = mysql.gtid_executed #[normal]orgtid_executed = mysql.gtid_executed + last_binlog ‰∏≠ÊúÄÂêéÊ≤°ÂÜôÂà∞mysql.gtid_executed‰∏≠ÁöÑgtid_event #[recover] Â¶Ç‰ΩïÊåÅ‰πÖÂåñÈáçÁΩÆÁöÑgtid_purgedÂÄº?12reset master;set global gtid_purged='$A:a-b'; 12341. Áî±‰∫éÊúâÂèØËÉΩÊâãÂä®ËÆæÁΩÆËøágtid_purged=$A:a-b, binlog.index‰∏≠Ôºålast_binlogÁöÑPrevious-GTIDsÂπ∂‰∏ç‰ºöÂåÖÂê´$A:a-b 2. Áî±‰∫éÊúâÂèØËÉΩÊâãÂä®ËÆæÁΩÆËøágtid_purged=$A:a-b, binlog.index‰∏≠Ôºåfirst_binlogÁöÑPrevious-GTIDsËÇØÂÆö‰∏ç‰ºöÂá∫Áé∞$A:a-b 3. ÈáçÁΩÆÁöÑgtid_purged = @@global.gtid_executed(mysql.gtid_executed:Ê≥®ÊÑèÔºåËÄÉËôëÂà∞Ëøô‰∏™Ë°®ÁöÑÊõ¥Êñ∞Ëß¶ÂèëÊù°‰ª∂ÔºåÊâÄ‰ª•ËøôÈáåÁî®@@global.gtid_executed‰ª£Êõø) - last_binlogÁöÑPrevious-GTIDs - last_binlogÊâÄÊúâÁöÑgtid_event 4. ‰∏ãÈù¢Â∞±Áî® $reset_gtid_purged Êù•Ë°®Á§∫ÈáçÁΩÆÁöÑgtid Â¶Ç‰ΩïÊåÅ‰πÖÂåñgtid_purged [ log-bin=on,log_slave_update=on ]1gtid_purged=binlog.index:first_binlogÁöÑPrevious-GTIDs + $reset_gtid_purged ÂºÄÂêØGTIDÁöÑÂøÖÂ§áÊù°‰ª∂ MySQL 5.6 1234gtid_mode=ON (ÂøÖÈÄâ) log_bin=ON (ÂøÖÈÄâ) log-slave-updates=ON (ÂøÖÈÄâ) enforce-gtid-consistency (ÂøÖÈÄâ) MySQL 5.7 MySQL5.7.13 or higher 1234gtid_mode=ON (ÂøÖÈÄâ) enforce-gtid-consistency ÔºàÂøÖÈÄâÔºâlog_bin=ON ÔºàÂèØÈÄâÔºâ--È´òÂèØÁî®ÂàáÊç¢ÔºåÊúÄÂ•ΩËÆæÁΩÆON log-slave-updates=ON ÔºàÂèØÈÄâÔºâ--È´òÂèØÁî®ÂàáÊç¢ÔºåÊúÄÂ•ΩËÆæÁΩÆON Êñ∞ÁöÑÂ§çÂà∂ÂçèËÆÆ COM_BINLOG_DUMP_GTID slave‰ºöÂ∞ÜÂ∑≤ÁªèÊâßË°åËøáÁöÑgtidÔºå‰ª•Âèä‰ª•ÂèäÊé•ÂèóÂà∞relay log‰∏≠ÁöÑgtidÁöÑÂπ∂ÈõÜÂèëÈÄÅÁªômaster 12* http://dev.mysql.com/doc/refman/5.7/en/change-master-to.htmlUNION(@@global.gtid_executed, Retrieved_gtid_set - last_received_GTID) Master send all other transactions to slave ÂêåÊ†∑ÁöÑGTID‰∏çËÉΩË¢´ÊâßË°å‰∏§Ê¨°ÔºåÂ¶ÇÊûúÊúâÂêåÊ†∑ÁöÑGTIDÔºå‰ºöËá™Âä®Ë¢´skipÊéâ„ÄÇ - slave1 : Â∞ÜËá™Ë∫´ÁöÑUUID1:1 ÂèëÈÄÅÁªô masterÔºåÁÑ∂ÂêéÊé•Êî∂Âà∞‰∫Ü UUID1:2,UUID1:3 event - slave2 : Â∞ÜËá™Ë∫´ÁöÑUUID1:1,UUID1:2 ÂèëÈÄÅÁªô masterÔºåÁÑ∂ÂêéÊé•Êî∂Âà∞‰∫ÜUUID1:3 event GTIDÈáçË¶ÅÂáΩÊï∞ÂíåÊñ∞ËØ≠Ê≥ï ÈáçË¶ÅÂáΩÊï∞ Name Description GTID_SUBSET(subset, set) returns true (1) if all GTIDs in subset are also in set GTID_SUBTRACT(set,subset) returns only those GTIDs from set that are not in subset WAIT_FOR_EXECUTED_GTID_SET(gtid_set[, timeout]) Wait until the given GTIDs have executed on slave. WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS(gtid_set[, timeout][,channel]) Wait until the given GTIDs have executed on slave. Êñ∞ËØ≠Ê≥ï 12345678910START SLAVE [thread_types] [until_option] [connection_options]thread_types: [thread_type [, thread_type] ... ]thread_type: IO_THREAD | SQL_THREADuntil_option: UNTIL { {SQL_BEFORE_GTIDS | SQL_AFTER_GTIDS} = gtid_set | MASTER_LOG_FILE = 'log_name', MASTER_LOG_POS = log_pos | RELAY_LOG_FILE = 'log_name', RELAY_LOG_POS = log_pos | SQL_AFTER_MTS_GAPS } ‰∏æ‰∏™Ê†óÂ≠ê: START SLAVE SQL_THREAD UNTIL SQL_BEFORE_GTIDS = 3E11FA47-71CA-11E1-9E33-C80AA9429562:11-56 Ë°®Á§∫ÔºåÂΩìSQL_thread ÊâßË°åÂà∞3E11FA47-71CA-11E1-9E33-C80AA9429562:10 ÁöÑÊó∂ÂÄôÂÅúÊ≠¢Ôºå‰∏ã‰∏Ä‰∏™‰∫ãÂä°ÊòØ11 START SLAVE SQL_THREAD UNTIL SQL_AFTER_GTIDS = 3E11FA47-71CA-11E1-9E33-C80AA9429562:11-56 Ë°®Á§∫ÔºåÂΩìSQL_thread ÊâßË°åÂà∞3E11FA47-71CA-11E1-9E33-C80AA9429562:56 ÁöÑÊó∂ÂÄôÂÅúÊ≠¢Ôºå56ÊòØÊúÄÂêé‰∏Ä‰∏™Êèê‰∫§ÁöÑ‰∫ãÂä°„ÄÇ GTIDÊúâ‰ªÄ‰πàÂ•ΩÂ§Ñclassic replication [ËøêÁª¥‰πã‰º§] GTID replication [so easy] GTIDÁöÑLimitation ‰∏çÂÆâÂÖ®ÁöÑ‰∫ãÂä°1ËÆæÁΩÆenforce-gtid-consistency=ON 1231. CREATE TABLE ... SELECT statements 2. CREATE TEMPORARY TABLE or DROP TEMPORARY TABLE statements inside transactions3. ÂêåÊó∂Êõ¥Êñ∞ ‰∫ãÂä°ÂºïÊìé Âíå Èùû‰∫ãÂä°ÂºïÊìé„ÄÇ MySQL5.7 GTID crash-safeÂÖ≥‰∫é GTID crash safe ÂèØ‰ª•ÂèÇËÄÉÂÆòÊñπÊñáÊ°£ÂàóÂá∫ÁöÑÂÆâÂÖ®ÈÖçÁΩÆ ÂçïÁ∫øÁ®ãÂ§çÂà∂Non-GTID Êé®ËçêÈÖçÁΩÆ: relay_log_recovery=1 relay_log_info_repository=TABLE master_info_repository=TABLE GTID Êé®ËçêÈÖçÁΩÆ: * MASTER_AUTO_POSITION=on * relay_log_recovery=0 Â§öÁ∫øÁ®ãÂ§çÂà∂Non-GTID Êé®ËçêÈÖçÁΩÆ: relay_log_recovery=1 sync_relay_log=1 relay_log_info_repository=TABLE master_info_repository=TABLEGTID Êé®ËçêÈÖçÁΩÆ: MASTER_AUTO_POSITION=on relay_log_recovery=0 ÂÆûÊàò‰ΩøÁî®GTIDÊê≠Âª∫Replication‰ªé0ÂºÄÂßãÊê≠Âª∫ step 1: ËÆ©ÊâÄÊúâserverÂ§Ñ‰∫éÂêå‰∏Ä‰∏™ÁÇπ 1mysql> SET @@global.read_only = ON; step 2: ÂÖ≥Èó≠ÊâÄÊúâMySQL 1shell> mysqladmin -uusername -p shutdown step 3: ÈáçÂêØÊâÄÊúâMySQLÔºåÂπ∂ÂºÄÂêØGTID 1shell> mysqld --gtid-mode=ON --log-bin --enforce-gtid-consistency & ÂΩìÁÑ∂ÔºåÂú®my.cnf‰∏≠ÈÖçÁΩÆÂ•ΩÊúÄ‰Ω≥ step 4: change master 123mysql> CHANGE MASTER TO MASTER_HOST = host, MASTER_PORT = port, MASTER_USER = user, MASTER_PASSWORD = password, MASTER_AUTO_POSITION = 1, MASTER_CONNECT_RETRY=10; mysql> START SLAVE; step 5: ËÆ©master ÂèØËØªÂèØÂÜô 1mysql> SET @@global.read_only = OFF; ‰ªéÂ§á‰ªΩ‰∏≠ÊÅ¢Â§ç&Êê≠Âª∫ step 1: Â§á‰ªΩ 123mysqldump xx Ëé∑ÂèñÂπ∂‰∏îËÆ∞ÂΩïgtid_purgedÂÄº orÂÜ∑Â§á‰ªΩ --Ëé∑ÂèñÂπ∂‰∏îËÆ∞ÂΩïgtid_executedÂÄºÔºåËøô‰∏™Â∞±Áõ∏ÂΩì‰∫émysqldump‰∏≠ÂæóÂà∞ÁöÑgtid_purged step 2: Âú®Êñ∞ÊúçÂä°Âô®‰∏äreset masterÔºåÂØºÂÖ•Â§á‰ªΩ 123reset master; --Ê∏ÖÁ©∫gtid‰ø°ÊÅØ ÂØºÂÖ•Â§á‰ªΩÔºõ --Â¶ÇÊûúÊòØÈÄªËæëÂØºÂÖ•ÔºåËØ∑ËÆæÁΩÆsql_log_bin=off set global gtid_purged='xx'; step 3: change master 123mysql> CHANGE MASTER TO MASTER_HOST = host, MASTER_PORT = port, MASTER_USER = user, MASTER_PASSWORD = password, MASTER_AUTO_POSITION = 1, MASTER_CONNECT_RETRY=10; mysql> START SLAVE; Â¶Ç‰Ωï‰ªéclassic replication ÂçáÁ∫ßÊàê GTID replicationoffline ÊñπÂºèÂçáÁ∫ßoffline ÁöÑÊñπÂºèÂçáÁ∫ßÊúÄÁÆÄÂçï„ÄÇÂÖ®ÈÉ®ÂÖ≥Êú∫ÔºåÁÑ∂ÂêéÈÖçÁΩÆÂ•ΩGTIDÔºåÈáçÂêØÔºåCHANGE MASTER TO MASTER_AUTO_POSITION=1„ÄÇ online ÊñπÂºèÂçáÁ∫ßËøôÈáåÂÖà‰ªãÁªçÂá†‰∏™ÈáçË¶ÅGTID_MODEÁöÑvalue GTID_MODE = OFF ‰∏ç‰∫ßÁîüNormal_GTIDÔºåÂè™Êé•ÂèóÊù•Ëá™masterÁöÑANONYMOUS_GTID GTID_MODE = OFF_PERMISSIVE ‰∏ç‰∫ßÁîüNormal_GTIDÔºåÂèØ‰ª•Êé•ÂèóÊù•Ëá™masterÁöÑANONYMOUS_GTID & Normal_GTID GTID_MODE = ON_PERMISSIVE ‰∫ßÁîüNormal_GTIDÔºåÂèØ‰ª•Êé•ÂèóÊù•Ëá™masterÁöÑANONYMOUS_GTID & Normal_GTID GTID_MODE = ON ‰∫ßÁîüNormal_GTIDÔºåÂè™Êé•ÂèóÊù•Ëá™masterÁöÑNormal_GTID masterÂíåslaveÁöÑgtid_mode ÁªÑÂêàÊê≠ÈÖçÁü©ÈòµÂõæ Ê∞¥Âπ≥ÁöÑGTID_MODE‰∏∫Ôºömaster ÂûÇÁõ¥ÁöÑGTID_MODE‰∏∫Ôºöslave gtid_mode OFF(master) OFF_PERMISSIVE(master) ON_PERMISSIVE(master) ON(master) OFF(slave) Y Y N N OFF_PERMISSIVE(slave) Y Y Y Y(auto_positionÂèØ‰ª•ÂºÄÂêØ) ON_PERMISSIVE(slave) Y Y Y Y(auto_positionÂèØ‰ª•ÂºÄÂêØ) ON(slave) N N Y Y(auto_positionÂèØ‰ª•ÂºÄÂêØ) ÂΩíÁ∫≥ÊÄªÁªìÔºö ÂΩìmaster‰∫ßÁîüNormal_GTIDÁöÑÊó∂ÂÄôÔºàON_PERMISSIVEÔºåONÔºâÔºåÂ¶ÇÊûúslaveÁöÑgtid_modeÔºàOFFÔºâ‰∏çËÉΩÊé•ÂèóNormal_GTIDÔºåÈÇ£‰πàÂ∞±‰ºöÊä•Èîô ÂΩìmaster‰∫ßÁîüANONYMOUS_GTIDÁöÑÊó∂ÂÄôÔºàOFF_PERMISSIVEÔºåOFFÔºâÔºåÂ¶ÇÊûúslaveÁöÑgtid_modeÔºàONÔºâ‰∏çËÉΩÊé•ÂèóANONYMOUS_GTIDÔºåÈÇ£‰πàÂ∞±‰ºöÊä•Èîô ËÆæÁΩÆauto_positionÁöÑÊù°‰ª∂Ôºö ÂΩìmaster gtid_mode=ONÊó∂ÔºåslaveÂèØ‰ª•‰∏∫OFF_PERMISSIVEÔºåON_PERMISSIVEÔºåON„ÄÇÈô§Ê≠§‰πãÂ§ñÔºåÈÉΩ‰∏çËÉΩËÆæÁΩÆauto_position = on ‰∏ãÈù¢ÁΩóÂàó‰∏ãÔºåÂ¶Ç‰Ωïonline ÂçáÁ∫ß‰∏∫GTIDÊ®°Âºè„ÄÇ step 1: ÊØèÂè∞serverÊâßË°å Ê£ÄÊü•ÈîôËØØÊó•ÂøóÔºåÁõ¥Âà∞Ê≤°ÊúâÈîôËØØÂá∫Áé∞ÔºåÊâçËÉΩËøõË°å‰∏ã‰∏ÄÊ≠• 1SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = WARN; step 2: ÊØèÂè∞serverÊâßË°å 1SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = ON; step 3: ÊØèÂè∞serverÊâßË°å ‰∏çÁî®ÂÖ≥ÂøÉ‰∏ÄÁªÑÂ§çÂà∂ÈõÜÁæ§ÁöÑserverÁöÑÊâßË°åÈ°∫Â∫èÔºåÂè™ÈúÄË¶Å‰øùËØÅÊØè‰∏™ServerÈÉΩÊâßË°å‰∫ÜÔºåÊâçËÉΩËøõË°å‰∏ã‰∏ÄÊ≠• 1SET @@GLOBAL.GTID_MODE = OFF_PERMISSIVE; step 4: ÊØèÂè∞serverÊâßË°å ‰∏çÁî®ÂÖ≥ÂøÉ‰∏ÄÁªÑÂ§çÂà∂ÈõÜÁæ§ÁöÑserverÁöÑÊâßË°åÈ°∫Â∫èÔºåÂè™ÈúÄË¶Å‰øùËØÅÊØè‰∏™ServerÈÉΩÊâßË°å‰∫ÜÔºåÊâçËÉΩËøõË°å‰∏ã‰∏ÄÊ≠• 1SET @@GLOBAL.GTID_MODE = ON_PERMISSIVE; step 5: Âú®ÊØèÂè∞server‰∏äÊâßË°åÔºåÂ¶ÇÊûúONGOING_ANONYMOUS_TRANSACTION_COUNT=0Â∞±ÂèØ‰ª• ‰∏çÈúÄË¶Å‰∏ÄÁõ¥‰∏∫0ÔºåÂè™Ë¶ÅÂá∫Áé∞Ëøá0‰∏ÄÊ¨°ÔºåÂ∞±ok 1SHOW STATUS LIKE 'ONGOING_ANONYMOUS_TRANSACTION_COUNT'; step 6Ôºö Á°Æ‰øùÊâÄÊúâanonymous‰∫ãÂä°‰º†ÈÄíÂà∞slave‰∏ä‰∫Ü master 1SHOW MASTER STATUS; ÊØè‰∏™slave 1SELECT MASTER_POS_WAIT(file, position); ÊàñËÄÖÔºåÁ≠â‰∏ÄÊÆµÊó∂Èó¥ÔºåÂè™Ë¶Å‰∏çÊòØÂ§ßÁöÑÂª∂ËøüÔºå‰∏ÄËà¨ÈÉΩÊ≤°ÈóÆÈ¢ò step 7: ÊØèÂè∞Server‰∏äÊâßË°å 1SET @@GLOBAL.GTID_MODE = ON; step 8: Âú®ÊØèÂè∞server‰∏äÂ∞Ümy.cnf‰∏≠Ê∑ªÂä†Â•ΩgtidÈÖçÁΩÆ 1234gtid_mode=ON (ÂøÖÈÄâ) enforce-gtid-consistency (ÂøÖÈÄâ)log_bin=ON (ÂèØÈÄâ)--È´òÂèØÁî®ÂàáÊç¢ÔºåÊúÄÂ•ΩËÆæÁΩÆON log-slave-updates=ON (ÂèØÈÄâ)--È´òÂèØÁî®ÂàáÊç¢ÔºåÊúÄÂ•ΩËÆæÁΩÆON step 9: change master 123STOP SLAVE; CHANGE MASTER TO MASTER_AUTO_POSITION = 1; START SLAVE; GTID failoverMySQL crash> ÈÖçÁΩÆÂ•Ωloss-less semi-sync replicationÔºåÂèØ‰ª•Êõ¥ÂèØÈù†ÁöÑ‰øùËØÅÊï∞ÊçÆÈõ∂‰∏¢Â§±„ÄÇ ‰ª•‰∏ãËØ¥ÁöÑÈÉΩÊòØcrash ÂêéÔºåËµ∑‰∏çÊù•ÁöÑÊÉÖÂÜµ binlog Âú®masterËøòÊúâÊó•ÂøóÊ≤°Êúâ‰º†ÈÄíÂà∞ slave123456781. ÈÄâÂèñÊúÄÊñ∞ÁöÑslave, CHANGE MASTER TO maseter_auto_position ÂêåÊ≠•Â•Ω 2. mysqlbinlog Â∞ÜÊ≤°‰º†ÈÄíËøáÊù•ÁöÑbinlogÂú®Êñ∞master‰∏äreplay 3. ÊâìÂºÄÊñ∞ master ÁöÑ SET GLOBAL surper_read_only=off;``` * binlog Â∑≤Áªè‰º†ÈÄíÂà∞slave```bash1. ÈÄâÂèñÊúÄÊñ∞ÁöÑslave, CHANGE MASTER TO maseter_auto_positionÂêåÊ≠•Â•Ω 2. ÊâìÂºÄÊñ∞masterÁöÑ SET GLOBAL surper_read_only=off; OS crash121. ÈÄâÂèñÊúÄÊñ∞ÁöÑslave, CHANGE MASTER TO maseter_auto_positionÂêåÊ≠•Â•Ω 2. ÊâìÂºÄÊñ∞masterÁöÑ SET GLOBAL surper_read_only=off; ‰ª•‰∏äÊìç‰ΩúÔºåÂú®‰º†ÁªüÊ®°ÂºèÂ§çÂà∂‰∏ãÔºåÂè™ËÉΩÈÄöËøáMHAÊù•ÂÆûÁé∞ÔºåMHAÊØîËæÉÂ§çÊùÇ„ÄÇ Áé∞Âú®ÔºåÂú®GTIDÊ®°Âºè‰∏ãÔºåÂÆûÁé∞Ëµ∑Êù•ÈùûÂ∏∏ÁÆÄÂçïÔºå‰∏îÈùûÂ∏∏Êñπ‰æø„ÄÇ GTID ËøêÁª¥ÂíåÈîôËØØÂ§ÑÁêÜ ‰ΩøÁî®GTIDÂêéÔºåÂØπÂéüÊù•‰º†ÁªüÁöÑËøêÁª¥Êúâ‰∏çÂêå‰πãÂ§Ñ‰∫ÜÔºåÈúÄË¶ÅË∞ÉÊï¥ËøáÊù•„ÄÇ ‰ΩøÁî®RowÊ®°Âºè‰∏îÂ§çÂà∂ÈÖçÁΩÆÊ≠£Á°ÆÁöÑÊÉÖÂÜµ‰∏ãÔºåÂü∫Êú¨‰∏äÂæàÂ∞ëÂèëÁé∞ÊúâÂ§çÂà∂Âá∫ÈîôÁöÑÊÉÖÂÜµ„ÄÇ slave ËÆæÁΩÆ super_read_only=on ÈîôËØØÂú∫ÊôØ: Errant transactionÂá∫Áé∞ËøôÁßçÈóÆÈ¢òÂü∫Êú¨Êúâ‰∏§ÁßçÊÉÖÂÜµ Â§çÂà∂ÂèÇÊï∞Ê≤°ÊúâÈÖçÁΩÆÊ≠£Á°ÆÔºåÂΩìslave crashÂêéÔºå‰ºöÂá∫Áé∞ÈáçÂ§çÈîÆÈóÆÈ¢ò DBAÊìç‰Ωú‰∏çÊ≠£Á°ÆÔºå‰∏çÂ∞èÂøÉÂú®slave‰∏äÊâßË°å‰∫Ü‰∫ãÂä° ÂØπ‰∫éÁ¨¨‰∏Ä‰∏™ÈáçÂ§çÈîÆÈóÆÈ¢ò ÂØπ‰∫éÁ¨¨‰∏Ä‰∏™ÈáçÂ§çÈîÆÈóÆÈ¢ò 123* skip transation; SQL> SET GLOBAL SQL_SLAVE_SKIP_COUNTER=1;SQL> START SLAVE; GTIDÊ®°Âºè 1234SQL> SET GTID_NEXT='b9b4712a-df64-11e3-b391-60672090eb04:7'; --ËÆæÁΩÆÈúÄË¶ÅË∑≥ËøáÁöÑgtid eventSQL> BEGIN;COMMIT;SQL> SET GTID_NEXT='AUTOMATIC';SQL> START SLAVE; ÂØπ‰∫éÁ¨¨‰∫åÁßç‰∏çÂ∞èÂøÉÂ§öÊâßË°å‰∫Ü‰∫ãÂä° ËøôÁßçÊÉÖÂÜµÂ∞±ÊØîËæÉÈöæ‰∫ÜÔºåËøôÊ†∑Â∑≤ÁªèÂØºËá¥‰∫ÜÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµÔºåÂª∫ËÆÆslaveÈáçÂÅö Â¶Ç‰ΩïÈÅøÂÖçÔºö slave ËÆæÁΩÆ super_read_only=on; ÈáçÁÇπÔºö ÂΩìÂèëÁîüinject empty transctionÂêéÔºåÊúâÂèØËÉΩ‰ºö‰∏¢Â§±‰∫ãÂä° ËøôÈáåËØ¥‰∏ãinject empty transctionÁöÑÈöêÊÇ£ ÂΩìslave‰∏äinject empty transctionÔºåËØ¥ÊòéÊúâ‰∏Ä‰∏™masterÁöÑ‰∫ãÂä°Ë¢´ÂøΩÁï•‰∫ÜÔºàËøôÈáåÂÅáËÆæÊòØ $uuid:100Ôºâ ‰∫ãÂä°‰∏¢Â§±‰∏ÄÔºöÂ¶ÇÊûúÊ≠§Êó∂Ê≠§ÂàªmasterÊåÇ‰∫ÜÔºåËøô‰∏™slaveË¢´ÈÄâ‰∏æ‰∏∫Êñ∞masterÔºåÈÇ£‰πàÂÖ∂‰ªñÁöÑslaveÂ¶ÇÊûúËøòÊ≤°ÊúâÊâßË°åÂà∞$uuid:100,Â∞±‰ºö‰∏¢Â§±Êéâ$uuid:100Ëøô‰∏™‰∫ãÂä°„ÄÇ ‰∫ãÂä°‰∏¢Â§±‰∫åÔºöÂ¶ÇÊûú‰ªéÂ§á‰ªΩ‰∏≠ÈáçÊñ∞Êê≠Âª∫‰∏Ä‰∏™slaveÔºåÈúÄË¶ÅÈáçÊñ∞ÊâßË°å‰πãÂâçÁöÑÊâÄÊúâ‰∫ãÂä°ÔºåËÄåÊ≠§Êó∂ÔºåmasterÊåÇ‰∫ÜÔºå ÂèàÂõûÂà∞‰∫Ü‰∫ãÂä°‰∏¢Â§±‰∏ÄÁöÑÂú∫ÊôØ„ÄÇ QAÂ¶Ç‰ΩïÈáçÁΩÆgtid_executedÔºågtid_purged„ÄÇ ËÆæÁΩÆgtid_executed Áé∞Âú®Âè™ËÉΩÊâßË°å: 1mysql> reset master; ËÆæÁΩÆgtid_purged ÂΩìgtid_executed ÈùûÁ©∫ÁöÑÊó∂ÂÄôÔºå‰∏çËÉΩËÆæÁΩÆgtid_purged ÂΩìgtid_executed ‰∏∫Á©∫ÁöÑÊó∂ÂÄô(Âç≥ÂàöÂàöÂ§á‰ªΩÂ•ΩÁöÑÈïúÂÉèÔºåÂàöÊê≠Âª∫ÁöÑmysql)1mysql> SET @@GLOBAL.GTID_PURGED='0ad6eae9-2d66-11e6-864f-ecf4bbf1f42c:1-3'; Â¶ÇÊûúauto.cnf Ë¢´Âà†Êéâ‰∫ÜÔºåÂØπ‰∫éGTIDÁöÑÂ§çÂà∂‰ºöÊúâ‰ªÄ‰πàÂΩ±ÂìçÔºü> Â¶ÇÊûúË¢´Âà†ÊéâÔºåÈáçÂêØÂêéÔºåserver-uuid ‰ºöÂèò ÊâãÂä®ËÆæÁΩÆ set @@gtid_purged = xx:yy, mysql‰ºöÂéª‰∏ªÂä®‰øÆÊîπbinlogÁöÑÂ§¥‰πà> ‰∏ç‰ºö GTIDÂíåÂ§çÂà∂ËøáÊª§ËßÑÂàô‰πãÈó¥Â¶Ç‰ΩïÂçèÂêåÂ∑•‰ΩúÔºüMySQLÔºåtestËøòËÉΩÊÑâÂø´ÁöÑËøáÊª§ÊéâÂêóÔºü> ÂèØ‰ª•ÔºåÊîπËøáÊª§ÁöÑ‰ºöËá™Â∑±ËøáÊª§Ôºå‰∏çÁî®ÊãÖÂøÉ Automatic failover with mysqlfailover+GTIDmysqlfailover+GTID document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLÊü•ËØ¢ÈáçÂ§çËÆ∞ÂΩï,Âà†Èô§ÈáçÂ§çËÆ∞ÂΩïÊñπÊ≥ï]]></title>
    <url>%2F2019%2F04%2F22%2Fmysql-duplicate%2F</url>
    <content type="text"><![CDATA[ÂñÑËâØÊ≤°Áî®ÔºåÂõ†‰∏∫Âè™Êúâ‰Ω†ÂÖàÊºÇ‰∫ÆÔºåÂà´‰∫∫ÊâçËÉΩÁúãÂà∞‰Ω†ÁöÑÂñÑËâØ„ÄÇ ÂëΩ‰ª§Êü•ÊâæÂÖ®ÈÉ®ÈáçÂ§çËÆ∞ÂΩï1SELECT * FROM Ë°® WHERE ÈáçÂ§çÂ≠óÊÆµ IN (SELECT ÈáçÂ§çÂ≠óÊÆµ FROM Ë°® GROUP BY ÈáçÂ§çÂ≠óÊÆµ HAVING COUNT(*)>1); ËøáÊª§ÈáçÂ§çËÆ∞ÂΩï(Âè™ÊòæÁ§∫‰∏ÄÊù°)12SELECT * FROM Ë°® WHERE ID IN (SELECT MAX(ID) FROM Ë°® GROUP BY Title); #ÊòæÁ§∫IDÊúÄÂ§ß‰∏ÄÊù°ËÆ∞ÂΩïSELECT * FROM Ë°® WHERE ID IN (SELECT MIN(ID) FROM Ë°® GROUP BY Title); #ÊòæÁ§∫IDÊúÄÂ∞è‰∏ÄÊù°ËÆ∞ÂΩï Âà†Èô§ÂÖ®ÈÉ®ÈáçÂ§çËÆ∞ÂΩï1DELETE Ë°® WHERE ÈáçÂ§çÂ≠óÊÆµ IN (SELECT ÈáçÂ§çÂ≠óÊÆµ FROM Ë°® GROUP BY ÈáçÂ§çÂ≠óÊÆµ HAVING COUNT(*)>1); Âà†Èô§ÂÖ®ÈÉ®ÈáçÂ§çËÆ∞ÂΩï‰øùÁïôÊúÄÂ§ßIDÊúÄÂ§ß‰∏ÄÊù°ËÆ∞ÂΩï12DELETE FROM Ë°® WHERE ID NOT IN (SELECT MAX(ID) FROM Ë°® GROUP BY Title) #‰øùÁïôIDÊúÄÂ§ß‰∏ÄÊù°ËÆ∞ÂΩïDELETE FROM Ë°® WHERE ID NOT IN (SELECT MIN(ID) FROM Ë°® GROUP BY Title) #‰øùÁïôIDÊúÄÂ∞è‰∏ÄÊù°ËÆ∞ÂΩï Âà†Èô§Ë°®‰∏≠Â§ö‰ΩôÁöÑÈáçÂ§çËÆ∞ÂΩïÔºàÂ§ö‰∏™Â≠óÊÆµÔºâÔºåÂè™ÁïôÊúârowidÊúÄÂ∞èÁöÑËÆ∞ÂΩï1DELETE FROM vitae a WHERE (a.peopleId, a.seq) IN (SELECT peopleId, seq FROM vitae GROUP BY peopleId, seq HAVING COUNT(*) > 1) AND rowid NOT IN (SELECT MIN(rowid) FROM vitae GROUP BY peopleId, seq HAVING COUNT(*)>1) Êü•ÊâæË°®‰∏≠Â§ö‰ΩôÁöÑÈáçÂ§çËÆ∞ÂΩïÔºàÂ§ö‰∏™Â≠óÊÆµÔºâÔºå‰∏çÂåÖÂê´rowidÊúÄÂ∞èÁöÑËÆ∞ÂΩï1SELECT * FROM vitae a WHERE (a.peopleId, a.seq) IN (SELECT peopleId, seq FROM vitae GROUP BY peopleId, seq HAVING COUNT(*) > 1) AND rowid NOT IN (SELECT MIN(rowid) FROM vitae GROUP BY peopleId, seq HAVING COUNT(*)>1) Êü•ÊâæË°®‰∏≠Â§ö‰ΩôÁöÑÈáçÂ§çËÆ∞ÂΩïÔºàÂ§ö‰∏™Â≠óÊÆµÔºâ1SELECT * FROM vitae a WHERE (a.peopleId, a.seq) IN (SELECT peopleId, seq FROM vitae GROUP BY peopleId, seq HAVING COUNT(*) > 1) ÊÄªÁªìËØ¥ÊòéÔºö ÂçïË°®ÁöÑÂîØ‰∏ÄÊü•ËØ¢Áî®Ôºödistinct Â§öË°®ÁöÑÂîØ‰∏ÄÊü•ËØ¢Áî®Ôºögroup by distinct Êü•ËØ¢Â§öË°®Êó∂Ôºåleft join ËøòÊúâÊïàÔºåÂÖ®ËøûÊé•Êó†Êïà document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL‰øÆÊîπË°®„ÄÅÂ≠óÊÆµ„ÄÅÂ∫ìÁöÑÂ≠óÁ¨¶ÈõÜÂèäÂ≠óÁ¨¶ÈõÜ]]></title>
    <url>%2F2019%2F04%2F22%2Fmysql-character%2F</url>
    <content type="text"><![CDATA[‰∏ÄÁõ¥ÂØπÂèëÂûãÂíåË∫´Êùê‰∏çÊª°ÊÑèÁöÑ‰∫∫ÔºåÊúâ‰∏Ä‰∏™ÂÖ±ÂêåÁÇπÔºö‰∏çËÇØÊâøËÆ§ËøôÊòØËÑ∏ÁöÑÈóÆÈ¢ò„ÄÇ ÂëΩ‰ª§‰øÆÊîπÊï∞ÊçÆÂ∫ìÂ≠óÁ¨¶ÈõÜ1ALTER DATABASE db_name DEFAULT CHARACTER SET character_name [COLLATE ...]; ÊääË°®ÈªòËÆ§ÁöÑÂ≠óÁ¨¶ÈõÜÂíåÊâÄÊúâÂ≠óÁ¨¶ÂàóÔºàCHAR,VARCHAR,TEXTÔºâÊîπ‰∏∫Êñ∞ÁöÑÂ≠óÁ¨¶ÈõÜÔºö12ALTER TABLE tbl_name CONVERT TO CHARACTER SET character_name [COLLATE ...]Â¶ÇÔºöALTER TABLE logtest CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci; Âè™ÊòØ‰øÆÊîπË°®ÁöÑÈªòËÆ§Â≠óÁ¨¶ÈõÜ12ALTER TABLE tbl_name DEFAULT CHARACTER SET character_name [COLLATE...];Â¶ÇÔºöALTER TABLE logtest DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci; ‰øÆÊîπÂ≠óÊÆµÁöÑÂ≠óÁ¨¶ÈõÜ12ALTER TABLE tbl_name CHANGE c_name c_name CHARACTER SET character_name [COLLATE ...];Â¶ÇÔºöALTER TABLE logtest CHANGE title title VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci; Êü•ÁúãÂ≠óÊÆµÁºñÁ†Å1SHOW FULL COLUMNS FROM tbl_name; Êü•ÁúãÁ≥ªÁªüÁöÑÁºñÁ†ÅÂ≠óÁ¨¶1SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_name LIKE 'collation%'; MySQLÂ≠óÁ¨¶ÈõÜËÆæÁΩÆÁ≥ªÁªüÂèòÈáèÔºö1234567‚Äì character_set_serverÔºöÈªòËÆ§ÁöÑÂÜÖÈÉ®Êìç‰ΩúÂ≠óÁ¨¶ÈõÜ‚Äì character_set_clientÔºöÂÆ¢Êà∑Á´ØÊù•Ê∫êÊï∞ÊçÆ‰ΩøÁî®ÁöÑÂ≠óÁ¨¶ÈõÜ‚Äì character_set_connectionÔºöËøûÊé•Â±ÇÂ≠óÁ¨¶ÈõÜ‚Äì character_set_resultsÔºöÊü•ËØ¢ÁªìÊûúÂ≠óÁ¨¶ÈõÜ‚Äì character_set_databaseÔºöÂΩìÂâçÈÄâ‰∏≠Êï∞ÊçÆÂ∫ìÁöÑÈªòËÆ§Â≠óÁ¨¶ÈõÜ‚Äì character_set_systemÔºöÁ≥ªÁªüÂÖÉÊï∞ÊçÆ(Â≠óÊÆµÂêçÁ≠â)Â≠óÁ¨¶ÈõÜ‚Äì ËøòÊúâ‰ª•collation_ÂºÄÂ§¥ÁöÑÂêå‰∏äÈù¢ÂØπÂ∫îÁöÑÂèòÈáèÔºåÁî®Êù•ÊèèËø∞Â≠óÁ¨¶Â∫è„ÄÇ Áî®introducerÊåáÂÆöÊñáÊú¨Â≠óÁ¨¶‰∏≤ÁöÑÂ≠óÁ¨¶ÈõÜÊ†ºÂºè‰∏∫Ôºö1[_charset] ‚Äòstring‚Äô [COLLATE collation] ‰æãÂ≠ê:123SELECT _latin1 ‚Äòstring‚Äô;‚Ä¢ SELECT _utf8 ‚Äò‰Ω†Â•Ω‚Äô COLLATE utf8_general_ci;‚Äì Áî±introducer‰øÆÈ•∞ÁöÑÊñáÊú¨Â≠óÁ¨¶‰∏≤Âú®ËØ∑Ê±ÇËøáÁ®ã‰∏≠‰∏çÁªèËøáÂ§ö‰ΩôÁöÑËΩ¨Á†ÅÔºåÁõ¥Êé•ËΩ¨Êç¢‰∏∫ÂÜÖÈÉ®Â≠óÁ¨¶ÈõÜÂ§ÑÁêÜ„ÄÇ MySQL‰∏≠ÁöÑÂ≠óÁ¨¶ÈõÜËΩ¨Êç¢ËøáÁ®ã MySQL ServerÊî∂Âà∞ËØ∑Ê±ÇÊó∂Â∞ÜËØ∑Ê±ÇÊï∞ÊçÆ‰ªécharacter_set_clientËΩ¨Êç¢‰∏∫character_set_connectionÔºõ ËøõË°åÂÜÖÈÉ®Êìç‰ΩúÂâçÂ∞ÜËØ∑Ê±ÇÊï∞ÊçÆ‰ªécharacter_set_connectionËΩ¨Êç¢‰∏∫ÂÜÖÈÉ®Êìç‰ΩúÂ≠óÁ¨¶ÈõÜÔºåÂÖ∂Á°ÆÂÆöÊñπÊ≥ïÂ¶Ç‰∏ãÔºö ‰ΩøÁî®ÊØè‰∏™Êï∞ÊçÆÂ≠óÊÆµÁöÑCHARACTER SETËÆæÂÆöÂÄºÔºõ Ëã•‰∏äËø∞ÂÄº‰∏çÂ≠òÂú®ÔºåÂàô‰ΩøÁî®ÂØπÂ∫îÊï∞ÊçÆË°®ÁöÑDEFAULT CHARACTER SETËÆæÂÆöÂÄº(MySQLÊâ©Â±ïÔºåÈùûSQLÊ†áÂáÜ)Ôºõ Ëã•‰∏äËø∞ÂÄº‰∏çÂ≠òÂú®ÔºåÂàô‰ΩøÁî®ÂØπÂ∫îÊï∞ÊçÆÂ∫ìÁöÑDEFAULT CHARACTER SETËÆæÂÆöÂÄºÔºõ Ëã•‰∏äËø∞ÂÄº‰∏çÂ≠òÂú®ÔºåÂàô‰ΩøÁî®character_set_serverËÆæÂÆöÂÄº„ÄÇ Â∞ÜÊìç‰ΩúÁªìÊûú‰ªéÂÜÖÈÉ®Êìç‰ΩúÂ≠óÁ¨¶ÈõÜËΩ¨Êç¢‰∏∫character_set_results document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux SystemdËØ¶Ëß£]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-systemd%2F</url>
    <content type="text"><![CDATA[‰∏ÄÂú∫ËØ¥Ëµ∞Â∞±Ëµ∞ÁöÑÊóÖË°åÔºåÂõûÊù•Á≠âÁùÄ‰Ω†ÁöÑÂ∞±ÊòØ‰∏ÄÊÆµÂêÉÂúüÁöÑÊó•Â≠ê„ÄÇ ‰ªãÁªçSystemdÊòØLinuxÁ≥ªÁªüÂ∑•ÂÖ∑ÔºåÁî®Êù•ÂêØÂä®ÂÆàÊä§ËøõÁ®ãÔºåÂ∑≤Êàê‰∏∫Â§ßÂ§öÊï∞ÂèëË°åÁâàÁöÑÊ†áÈÖçÔºåPID‰∏∫1ÊúÄÂÖàÂêØÂä®Ôºõ ÂéÜÂè≤‰∏äÔºåLinux ÁöÑÂêØÂä®‰∏ÄÁõ¥ÈááÁî®initËøõÁ®ã„ÄÇ123$ /etc/init.d/apache2 startÊàñËÄÖ$ service apache2 start ËøôÁßçÊñπÊ≥ïÊúâ‰∏§‰∏™Áº∫ÁÇπ„ÄÇ ‰∏ÄÊòØÂêØÂä®Êó∂Èó¥Èïø„ÄÇinitËøõÁ®ãÊòØ‰∏≤Ë°åÂêØÂä®ÔºåÂè™ÊúâÂâç‰∏Ä‰∏™ËøõÁ®ãÂêØÂä®ÂÆåÔºåÊâç‰ºöÂêØÂä®‰∏ã‰∏Ä‰∏™ËøõÁ®ã„ÄÇ ‰∫åÊòØÂêØÂä®ËÑöÊú¨Â§çÊùÇ„ÄÇinitËøõÁ®ãÂè™ÊòØÊâßË°åÂêØÂä®ËÑöÊú¨Ôºå‰∏çÁÆ°ÂÖ∂‰ªñ‰∫ãÊÉÖ„ÄÇËÑöÊú¨ÈúÄË¶ÅËá™Â∑±Â§ÑÁêÜÂêÑÁßçÊÉÖÂÜµÔºåËøôÂæÄÂæÄ‰ΩøÂæóËÑöÊú¨ÂèòÂæóÂæàÈïø„ÄÇ Systemd Â∞±ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∫õÈóÆÈ¢òËÄåËØûÁîüÁöÑ„ÄÇÂÆÉÁöÑËÆæËÆ°ÁõÆÊ†áÊòØÔºå‰∏∫Á≥ªÁªüÁöÑÂêØÂä®ÂíåÁÆ°ÁêÜÊèê‰æõ‰∏ÄÂ•óÂÆåÊï¥ÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇÊ†πÊçÆ Linux ÊÉØ‰æãÔºåÂ≠óÊØçdÊòØÂÆàÊä§ËøõÁ®ãÔºàdaemonÔºâÁöÑÁº©ÂÜô„ÄÇ Systemd Ëøô‰∏™ÂêçÂ≠óÁöÑÂê´‰πâÔºåÂ∞±ÊòØÂÆÉË¶ÅÂÆàÊä§Êï¥‰∏™Á≥ªÁªü„ÄÇCentOS/RHEL7 ‰ª•‰∏äÁâàÊú¨‰∏≠Systemd Âèñ‰ª£‰∫ÜinitdÔºåÊàê‰∏∫Á≥ªÁªüÁöÑÁ¨¨‰∏Ä‰∏™ËøõÁ®ãÔºàPID Á≠â‰∫é 1ÔºâÔºåÂÖ∂‰ªñËøõÁ®ãÈÉΩÊòØÂÆÉÁöÑÂ≠êËøõÁ®ã„ÄÇÊü•ÁúãÁâàÊú¨Ôºö1$ systemctl --version Â∏∏Áî®ÂëΩ‰ª§systemctl ÂëΩ‰ª§ÈáçÂêØÁ≥ªÁªü1systemctl reboot ÂÖ≥Èó≠Á≥ªÁªüÔºåÂàáÊñ≠ÁîµÊ∫ê1systemctl poweroff CPUÂÅúÊ≠¢Â∑•‰Ωú1systemctl halt ÊöÇÂÅúÁ≥ªÁªü1systemctl suspend ËÆ©Á≥ªÁªüËøõÂÖ•ÂÜ¨Áú†Áä∂ÊÄÅ1systemctl hibernate ËÆ©Á≥ªÁªüËøõÂÖ•‰∫§‰∫íÂºè‰ºëÁú†Áä∂ÊÄÅ1systemctl hybrid-sleep ÂêØÂä®ËøõÂÖ•ÊïëÊè¥Áä∂ÊÄÅÔºàÂçïÁî®Êà∑Áä∂ÊÄÅÔºâ1systemctl rescue systemd-analyze ÊòØÊü•ÁúãÂêØÂä®ËÄóÊó∂ Êü•ÁúãÂêØÂä®ËÄóÊó∂1systemd-analyze Êü•ÁúãÊØè‰∏™ÊúçÂä°ÁöÑÂêØÂä®ËÄóÊó∂1systemd-analyze blame ÊòæÁ§∫ÁÄëÂ∏ÉÁä∂ÁöÑÂêØÂä®ËøáÁ®ãÊµÅ1systemd-analyze critical-chain ÊòæÁ§∫ÊåáÂÆöÊúçÂä°ÁöÑÂêØÂä®ÊµÅ1systemd-analyze critical-chain atd.service hostnamectlÂëΩ‰ª§Áî®‰∫éÊü•ÁúãÂΩìÂâç‰∏ªÊú∫ÁöÑ‰ø°ÊÅØ„ÄÇÊòæÁ§∫ÂΩìÂâç‰∏ªÊú∫ÁöÑ‰ø°ÊÅØ12345hostnamectl```bashËÆæÁΩÆ‰∏ªÊú∫Âêç„ÄÇ```bashhostnamectl set-hostname rhel7 localectlÂëΩ‰ª§Áî®‰∫éÊü•ÁúãÊú¨Âú∞ÂåñËÆæÁΩÆ„ÄÇÊü•ÁúãÊú¨Âú∞ÂåñËÆæÁΩÆ1localectl ËÆæÁΩÆÊú¨Âú∞ÂåñÂèÇÊï∞„ÄÇ12localectl set-locale LANG=en_GB.utf8localectl set-keymap en_GB timedatectlÂëΩ‰ª§Áî®‰∫éÊü•ÁúãÂΩìÂâçÊó∂Âå∫ËÆæÁΩÆ„ÄÇÊü•ÁúãÂΩìÂâçÊó∂Âå∫ËÆæÁΩÆ1timedatectl ÊòæÁ§∫ÊâÄÊúâÂèØÁî®ÁöÑÊó∂Âå∫1timedatectl list-timezones ËÆæÁΩÆÂΩìÂâçÊó∂Âå∫123timedatectl set-timezone America/New_Yorktimedatectl set-time YYYY-MM-DDtimedatectl set-time HH:MM:SS loginctlÂëΩ‰ª§Áî®‰∫éÊü•ÁúãÂΩìÂâçÁôªÂΩïÁöÑÁî®Êà∑„ÄÇÂàóÂá∫ÂΩìÂâçsession1loginctl list-sessions ÂàóÂá∫ÂΩìÂâçÁôªÂΩïÁî®Êà∑1loginctl list-users ÂàóÂá∫ÊòæÁ§∫ÊåáÂÆöÁî®Êà∑ÁöÑ‰ø°ÊÅØ1loginctl show-user ruanyf ‰ªãÁªçSystemd ÂèØ‰ª•ÁÆ°ÁêÜÊâÄÊúâÁ≥ªÁªüËµÑÊ∫ê„ÄÇ‰∏çÂêåÁöÑËµÑÊ∫êÁªüÁß∞‰∏∫ UnitÔºàÂçï‰ΩçÔºâ„ÄÇ Unit ‰∏ÄÂÖ±ÂàÜÊàê12Áßç„ÄÇ Service unitÔºöÁ≥ªÁªüÊúçÂä° Target unitÔºöÂ§ö‰∏™ Unit ÊûÑÊàêÁöÑ‰∏Ä‰∏™ÁªÑ Device UnitÔºöÁ°¨‰ª∂ËÆæÂ§á Mount UnitÔºöÊñá‰ª∂Á≥ªÁªüÁöÑÊåÇËΩΩÁÇπ Automount UnitÔºöËá™Âä®ÊåÇËΩΩÁÇπ Path UnitÔºöÊñá‰ª∂ÊàñË∑ØÂæÑ Scope UnitÔºö‰∏çÊòØÁî± Systemd ÂêØÂä®ÁöÑÂ§ñÈÉ®ËøõÁ®ã Slice UnitÔºöËøõÁ®ãÁªÑ Snapshot UnitÔºöSystemd Âø´ÁÖßÔºåÂèØ‰ª•ÂàáÂõûÊüê‰∏™Âø´ÁÖß Socket UnitÔºöËøõÁ®ãÈó¥ÈÄö‰ø°ÁöÑ socket Swap UnitÔºöswap Êñá‰ª∂ Timer UnitÔºöÂÆöÊó∂Âô® systemctl list-unitsÂëΩ‰ª§ÂèØ‰ª•Êü•ÁúãÂΩìÂâçÁ≥ªÁªüÁöÑÊâÄÊúâ Unit „ÄÇ ÂàóÂá∫Ê≠£Âú®ËøêË°åÁöÑ Unit1systemctl list-units ÂàóÂá∫ÊâÄÊúâUnitÔºåÂåÖÊã¨Ê≤°ÊúâÊâæÂà∞ÈÖçÁΩÆÊñá‰ª∂ÁöÑÊàñËÄÖÂêØÂä®Â§±Ë¥•ÁöÑ1systemctl list-units --all ÂàóÂá∫ÊâÄÊúâÊ≤°ÊúâËøêË°åÁöÑ Unit1systemctl list-units --all --state=inactive ÂàóÂá∫ÊâÄÊúâÂä†ËΩΩÂ§±Ë¥•ÁöÑ Unit1systemctl list-units --failed ÂàóÂá∫ÊâÄÊúâÊ≠£Âú®ËøêË°åÁöÑ„ÄÅÁ±ªÂûã‰∏∫ service ÁöÑ Unit1systemctl list-units --type=service Unit ÁöÑÁä∂ÊÄÅsystemctl statusÂëΩ‰ª§Áî®‰∫éÊü•ÁúãÁ≥ªÁªüÁä∂ÊÄÅÂíåÂçï‰∏™ Unit ÁöÑÁä∂ÊÄÅ„ÄÇ ÊòæÁ§∫Á≥ªÁªüÁä∂ÊÄÅ1systemctl status ÊòæÁ§∫Âçï‰∏™ Unit ÁöÑÁä∂ÊÄÅ1sysystemctl status bluetooth.service ÊòæÁ§∫ËøúÁ®ã‰∏ªÊú∫ÁöÑÊüê‰∏™ Unit ÁöÑÁä∂ÊÄÅ1systemctl -H root@rhel7.example.com status httpd.service Èô§‰∫ÜstatusÂëΩ‰ª§ÔºåsystemctlËøòÊèê‰æõ‰∫Ü‰∏â‰∏™Êü•ËØ¢Áä∂ÊÄÅÁöÑÁÆÄÂçïÊñπÊ≥ïÔºå‰∏ªË¶Å‰æõËÑöÊú¨ÂÜÖÈÉ®ÁöÑÂà§Êñ≠ËØ≠Âè•‰ΩøÁî®„ÄÇ ÊòæÁ§∫Êüê‰∏™ Unit ÊòØÂê¶Ê≠£Âú®ËøêË°å1systemctl is-active application.service ÊòæÁ§∫Êüê‰∏™ Unit ÊòØÂê¶Â§Ñ‰∫éÂêØÂä®Â§±Ë¥•Áä∂ÊÄÅ1systemctl is-failed application.service ÊòæÁ§∫Êüê‰∏™ Unit ÊúçÂä°ÊòØÂê¶Âª∫Á´ã‰∫ÜÂêØÂä®ÈìæÊé•1systemctl is-enabled application.service Unit ÁÆ°ÁêÜÂØπ‰∫éÁî®Êà∑Êù•ËØ¥ÔºåÊúÄÂ∏∏Áî®ÁöÑÊòØ‰∏ãÈù¢Ëøô‰∫õÂëΩ‰ª§ÔºåÁî®‰∫éÂêØÂä®ÂíåÂÅúÊ≠¢ UnitÔºà‰∏ªË¶ÅÊòØ serviceÔºâ„ÄÇ Á´ãÂç≥ÂêØÂä®‰∏Ä‰∏™ÊúçÂä°1systemctl start apache.service Á´ãÂç≥ÂÅúÊ≠¢‰∏Ä‰∏™ÊúçÂä°1systemctl stop apache.service ÈáçÂêØ‰∏Ä‰∏™ÊúçÂä°1systemctl restart apache.service ÊùÄÊ≠ª‰∏Ä‰∏™ÊúçÂä°ÁöÑÊâÄÊúâÂ≠êËøõÁ®ã1systemctl kill apache.service ÈáçÊñ∞Âä†ËΩΩ‰∏Ä‰∏™ÊúçÂä°ÁöÑÈÖçÁΩÆÊñá‰ª∂1systemctl reload apache.service ÈáçËΩΩÊâÄÊúâ‰øÆÊîπËøáÁöÑÈÖçÁΩÆÊñá‰ª∂1systemctl daemon-reload ÊòæÁ§∫Êüê‰∏™ Unit ÁöÑÊâÄÊúâÂ∫ïÂ±ÇÂèÇÊï∞1systemctl show httpd.service ÊòæÁ§∫Êüê‰∏™ Unit ÁöÑÊåáÂÆöÂ±ûÊÄßÁöÑÂÄº1systemctl show -p CPUShares httpd.service ËÆæÁΩÆÊüê‰∏™ Unit ÁöÑÊåáÂÆöÂ±ûÊÄß1systemctl set-property httpd.service CPUShares=500 ‰æùËµñÂÖ≥Á≥ªUnit ‰πãÈó¥Â≠òÂú®‰æùËµñÂÖ≥Á≥ªÔºöA ‰æùËµñ‰∫é BÔºåÂ∞±ÊÑèÂë≥ÁùÄ Systemd Âú®ÂêØÂä® A ÁöÑÊó∂ÂÄôÔºåÂêåÊó∂‰ºöÂéªÂêØÂä® B„ÄÇ systemctl list-dependenciesÂëΩ‰ª§ÂàóÂá∫‰∏Ä‰∏™ Unit ÁöÑÊâÄÊúâ‰æùËµñ„ÄÇ12345systemctl list-dependencies nginx.service```bash‰∏äÈù¢ÂëΩ‰ª§ÁöÑËæìÂá∫ÁªìÊûú‰πã‰∏≠ÔºåÊúâ‰∫õ‰æùËµñÊòØ Target Á±ªÂûãÔºàËØ¶ËßÅ‰∏ãÊñáÔºâÔºåÈªòËÆ§‰∏ç‰ºöÂ±ïÂºÄÊòæÁ§∫„ÄÇÂ¶ÇÊûúË¶ÅÂ±ïÂºÄ TargetÔºåÂ∞±ÈúÄË¶Å‰ΩøÁî®--allÂèÇÊï∞„ÄÇ```bashsystemctl list-dependencies --all nginx.service Unit ÁöÑÈÖçÁΩÆÊñá‰ª∂ÊØè‰∏Ä‰∏™ Unit ÈÉΩÊúâ‰∏Ä‰∏™ÈÖçÁΩÆÊñá‰ª∂ÔºåÂëäËØâ Systemd ÊÄé‰πàÂêØÂä®Ëøô‰∏™ Unit „ÄÇ Systemd ÈªòËÆ§‰ªéÁõÆÂΩï/etc/systemd/system/ËØªÂèñÈÖçÁΩÆÊñá‰ª∂„ÄÇ‰ΩÜÊòØÔºåÈáåÈù¢Â≠òÊîæÁöÑÂ§ßÈÉ®ÂàÜÊñá‰ª∂ÈÉΩÊòØÁ¨¶Âè∑ÈìæÊé•ÔºåÊåáÂêëÁõÆÂΩï/usr/lib/systemd/system/ÔºåÁúüÊ≠£ÁöÑÈÖçÁΩÆÊñá‰ª∂Â≠òÊîæÂú®ÈÇ£‰∏™ÁõÆÂΩï„ÄÇ systemctl enableÂëΩ‰ª§Áî®‰∫éÂú®‰∏äÈù¢‰∏§‰∏™ÁõÆÂΩï‰πãÈó¥ÔºåÂª∫Á´ãÁ¨¶Âè∑ÈìæÊé•ÂÖ≥Á≥ª„ÄÇ1systemctl enable clamd@scan.service Á≠âÂêå‰∫é1ln -s '/usr/lib/systemd/system/clamd@scan.service' '/etc/systemd/system/multi-user.target.wants/clamd@scan.service' Â¶ÇÊûúÈÖçÁΩÆÊñá‰ª∂ÈáåÈù¢ËÆæÁΩÆ‰∫ÜÂºÄÊú∫ÂêØÂä®Ôºåsystemctl enableÂëΩ‰ª§Áõ∏ÂΩì‰∫éÊøÄÊ¥ªÂºÄÊú∫ÂêØÂä®„ÄÇ ‰∏é‰πãÂØπÂ∫îÁöÑÔºåsystemctl disableÂëΩ‰ª§Áî®‰∫éÂú®‰∏§‰∏™ÁõÆÂΩï‰πãÈó¥ÔºåÊí§ÈîÄÁ¨¶Âè∑ÈìæÊé•ÂÖ≥Á≥ªÔºåÁõ∏ÂΩì‰∫éÊí§ÈîÄÂºÄÊú∫ÂêØÂä®„ÄÇ1systemctl disable clamd@scan.service ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂêéÁºÄÂêçÔºåÂ∞±ÊòØËØ• Unit ÁöÑÁßçÁ±ªÔºåÊØîÂ¶Çsshd.socket„ÄÇÂ¶ÇÊûúÁúÅÁï•ÔºåSystemd ÈªòËÆ§ÂêéÁºÄÂêç‰∏∫.serviceÔºåÊâÄ‰ª•sshd‰ºöË¢´ÁêÜËß£Êàêsshd.service„ÄÇ ÈÖçÁΩÆÊñá‰ª∂ÁöÑÁä∂ÊÄÅ1systemctl list-unit-filesÂëΩ‰ª§Áî®‰∫éÂàóÂá∫ÊâÄÊúâÈÖçÁΩÆÊñá‰ª∂„ÄÇ ÂàóÂá∫ÊâÄÊúâÈÖçÁΩÆÊñá‰ª∂1systemctl list-unit-files ÂàóÂá∫ÊåáÂÆöÁ±ªÂûãÁöÑÈÖçÁΩÆÊñá‰ª∂12systemctl list-unit-files --type=serviceËøô‰∏™ÂëΩ‰ª§‰ºöËæìÂá∫‰∏Ä‰∏™ÂàóË°®„ÄÇ 1systemctl list-unit-files UNIT FILE STATE123chronyd.service enabledclamd@.service staticclamd@scan.service disabled Ëøô‰∏™ÂàóË°®ÊòæÁ§∫ÊØè‰∏™ÈÖçÁΩÆÊñá‰ª∂ÁöÑÁä∂ÊÄÅÔºå‰∏ÄÂÖ±ÊúâÂõõÁßç„ÄÇ enabledÔºöÂ∑≤Âª∫Á´ãÂêØÂä®ÈìæÊé• disabledÔºöÊ≤°Âª∫Á´ãÂêØÂä®ÈìæÊé• staticÔºöËØ•ÈÖçÁΩÆÊñá‰ª∂Ê≤°Êúâ[Install]ÈÉ®ÂàÜÔºàÊó†Ê≥ïÊâßË°åÔºâÔºåÂè™ËÉΩ‰Ωú‰∏∫ÂÖ∂‰ªñÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰æùËµñ maskedÔºöËØ•ÈÖçÁΩÆÊñá‰ª∂Ë¢´Á¶ÅÊ≠¢Âª∫Á´ãÂêØÂä®ÈìæÊé• Ê≥®ÊÑèÔºå‰ªéÈÖçÁΩÆÊñá‰ª∂ÁöÑÁä∂ÊÄÅÊó†Ê≥ïÁúãÂá∫ÔºåËØ• Unit ÊòØÂê¶Ê≠£Âú®ËøêË°å„ÄÇËøôÂøÖÈ°ªÊâßË°åÂâçÈù¢ÊèêÂà∞ÁöÑsystemctl statusÂëΩ‰ª§„ÄÇ 1systemctl status bluetooth.service ‰∏ÄÊó¶‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂ÔºåÂ∞±Ë¶ÅËÆ© SystemD ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆÊñá‰ª∂ÔºåÁÑ∂ÂêéÈáçÊñ∞ÂêØÂä®ÔºåÂê¶Âàô‰øÆÊîπ‰∏ç‰ºöÁîüÊïà„ÄÇ12systemctl daemon-reloadsystemctl restart httpd.service ÈÖçÁΩÆÊñá‰ª∂ÁöÑÊ†ºÂºèÈÖçÁΩÆÊñá‰ª∂Â∞±ÊòØÊôÆÈÄöÁöÑÊñáÊú¨Êñá‰ª∂ÔºåÂèØ‰ª•Áî®ÊñáÊú¨ÁºñËæëÂô®ÊâìÂºÄ„ÄÇ systemctl catÂëΩ‰ª§ÂèØ‰ª•Êü•ÁúãÈÖçÁΩÆÊñá‰ª∂ÁöÑÂÜÖÂÆπ„ÄÇ1systemctl cat atd.service unit ÈÖçÁΩÆÊñá‰ª∂1234567891011121314151617[Unit]Description=ATD daemon[Service]Type=forkingExecStart=/usr/bin/atd[Install]WantedBy=multi-user.target‰ªé‰∏äÈù¢ÁöÑËæìÂá∫ÂèØ‰ª•ÁúãÂà∞ÔºåÈÖçÁΩÆÊñá‰ª∂ÂàÜÊàêÂá†‰∏™Âå∫Âùó„ÄÇÊØè‰∏™Âå∫ÂùóÁöÑÁ¨¨‰∏ÄË°åÔºåÊòØÁî®ÊñπÊã¨Âè∑Ë°®Á§∫ÁöÑÂå∫Âà´ÂêçÔºåÊØîÂ¶Ç[Unit]„ÄÇÊ≥®ÊÑèÔºåÈÖçÁΩÆÊñá‰ª∂ÁöÑÂå∫ÂùóÂêçÂíåÂ≠óÊÆµÂêçÔºåÈÉΩÊòØÂ§ßÂ∞èÂÜôÊïèÊÑüÁöÑ„ÄÇÊØè‰∏™Âå∫ÂùóÂÜÖÈÉ®ÊòØ‰∏Ä‰∫õÁ≠âÂè∑ËøûÊé•ÁöÑÈîÆÂÄºÂØπ„ÄÇ[Section]Directive1=valueDirective2=value. . . Ê≥®ÊÑèÔºåÈîÆÂÄºÂØπÁöÑÁ≠âÂè∑‰∏§‰æß‰∏çËÉΩÊúâÁ©∫Ê†º„ÄÇ ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂå∫Âüü[Unit]Âå∫ÂùóÈÄöÂ∏∏ÊòØÈÖçÁΩÆÊñá‰ª∂ÁöÑÁ¨¨‰∏Ä‰∏™Âå∫ÂùóÔºåÁî®Êù•ÂÆö‰πâ Unit ÁöÑÂÖÉÊï∞ÊçÆÔºå‰ª•ÂèäÈÖçÁΩÆ‰∏éÂÖ∂‰ªñ Unit ÁöÑÂÖ≥Á≥ª„ÄÇÂÆÉÁöÑ‰∏ªË¶ÅÂ≠óÊÆµÂ¶Ç‰∏ã„ÄÇ DescriptionÔºöÁÆÄÁü≠ÊèèËø∞ DocumentationÔºöÊñáÊ°£Âú∞ÂùÄ RequiresÔºöÂΩìÂâç Unit ‰æùËµñÁöÑÂÖ∂‰ªñ UnitÔºåÂ¶ÇÊûúÂÆÉ‰ª¨Ê≤°ÊúâËøêË°åÔºåÂΩìÂâç Unit ‰ºöÂêØÂä®Â§±Ë¥• WantsÔºö‰∏éÂΩìÂâç Unit ÈÖçÂêàÁöÑÂÖ∂‰ªñ UnitÔºåÂ¶ÇÊûúÂÆÉ‰ª¨Ê≤°ÊúâËøêË°åÔºåÂΩìÂâç Unit ‰∏ç‰ºöÂêØÂä®Â§±Ë¥• BindsToÔºö‰∏éRequiresÁ±ª‰ººÔºåÂÆÉÊåáÂÆöÁöÑ Unit Â¶ÇÊûúÈÄÄÂá∫Ôºå‰ºöÂØºËá¥ÂΩìÂâç Unit ÂÅúÊ≠¢ËøêË°å BeforeÔºöÂ¶ÇÊûúËØ•Â≠óÊÆµÊåáÂÆöÁöÑ Unit ‰πüË¶ÅÂêØÂä®ÔºåÈÇ£‰πàÂøÖÈ°ªÂú®ÂΩìÂâç Unit ‰πãÂêéÂêØÂä® AfterÔºöÂ¶ÇÊûúËØ•Â≠óÊÆµÊåáÂÆöÁöÑ Unit ‰πüË¶ÅÂêØÂä®ÔºåÈÇ£‰πàÂøÖÈ°ªÂú®ÂΩìÂâç Unit ‰πãÂâçÂêØÂä® ConflictsÔºöËøôÈáåÊåáÂÆöÁöÑ Unit ‰∏çËÉΩ‰∏éÂΩìÂâç Unit ÂêåÊó∂ËøêË°å Condition‚Ä¶ÔºöÂΩìÂâç Unit ËøêË°åÂøÖÈ°ªÊª°Ë∂≥ÁöÑÊù°‰ª∂ÔºåÂê¶Âàô‰∏ç‰ºöËøêË°å Assert‚Ä¶ÔºöÂΩìÂâç Unit ËøêË°åÂøÖÈ°ªÊª°Ë∂≥ÁöÑÊù°‰ª∂ÔºåÂê¶Âàô‰ºöÊä•ÂêØÂä®Â§±Ë¥• [Install]ÈÄöÂ∏∏ÊòØÈÖçÁΩÆÊñá‰ª∂ÁöÑÊúÄÂêé‰∏Ä‰∏™Âå∫ÂùóÔºåÁî®Êù•ÂÆö‰πâÂ¶Ç‰ΩïÂêØÂä®Ôºå‰ª•ÂèäÊòØÂê¶ÂºÄÊú∫ÂêØÂä®„ÄÇÂÆÉÁöÑ‰∏ªË¶ÅÂ≠óÊÆµÂ¶Ç‰∏ã„ÄÇ WantedByÔºöÂÆÉÁöÑÂÄºÊòØ‰∏Ä‰∏™ÊàñÂ§ö‰∏™ TargetÔºåÂΩìÂâç Unit ÊøÄÊ¥ªÊó∂ÔºàenableÔºâÁ¨¶Âè∑ÈìæÊé•‰ºöÊîæÂÖ•/etc/systemd/systemÁõÆÂΩï‰∏ãÈù¢‰ª• Target Âêç + .wantsÂêéÁºÄÊûÑÊàêÁöÑÂ≠êÁõÆÂΩï‰∏≠ RequiredByÔºöÂÆÉÁöÑÂÄºÊòØ‰∏Ä‰∏™ÊàñÂ§ö‰∏™ TargetÔºåÂΩìÂâç Unit ÊøÄÊ¥ªÊó∂ÔºåÁ¨¶Âè∑ÈìæÊé•‰ºöÊîæÂÖ•/etc/systemd/systemÁõÆÂΩï‰∏ãÈù¢‰ª• Target Âêç + .requiredÂêéÁºÄÊûÑÊàêÁöÑÂ≠êÁõÆÂΩï‰∏≠ AliasÔºöÂΩìÂâç Unit ÂèØÁî®‰∫éÂêØÂä®ÁöÑÂà´Âêç AlsoÔºöÂΩìÂâç Unit ÊøÄÊ¥ªÔºàenableÔºâÊó∂Ôºå‰ºöË¢´ÂêåÊó∂ÊøÄÊ¥ªÁöÑÂÖ∂‰ªñ Unit [Service]Âå∫ÂùóÁî®Êù• Service ÁöÑÈÖçÁΩÆÔºåÂè™Êúâ Service Á±ªÂûãÁöÑ Unit ÊâçÊúâËøô‰∏™Âå∫Âùó„ÄÇÂÆÉÁöÑ‰∏ªË¶ÅÂ≠óÊÆµÂ¶Ç‰∏ã„ÄÇ TypeÔºöÂÆö‰πâÂêØÂä®Êó∂ÁöÑËøõÁ®ãË°å‰∏∫„ÄÇÂÆÉÊúâ‰ª•‰∏ãÂá†ÁßçÂÄº„ÄÇ Type=simpleÔºöÈªòËÆ§ÂÄºÔºåÊâßË°åExecStartÊåáÂÆöÁöÑÂëΩ‰ª§ÔºåÂêØÂä®‰∏ªËøõÁ®ã Type=forkingÔºö‰ª• fork ÊñπÂºè‰ªéÁà∂ËøõÁ®ãÂàõÂª∫Â≠êËøõÁ®ãÔºåÂàõÂª∫ÂêéÁà∂ËøõÁ®ã‰ºöÁ´ãÂç≥ÈÄÄÂá∫ Type=oneshotÔºö‰∏ÄÊ¨°ÊÄßËøõÁ®ãÔºåSystemd ‰ºöÁ≠âÂΩìÂâçÊúçÂä°ÈÄÄÂá∫ÔºåÂÜçÁªßÁª≠ÂæÄ‰∏ãÊâßË°å Type=dbusÔºöÂΩìÂâçÊúçÂä°ÈÄöËøáD-BusÂêØÂä® Type=notifyÔºöÂΩìÂâçÊúçÂä°ÂêØÂä®ÂÆåÊØïÔºå‰ºöÈÄöÁü•SystemdÔºåÂÜçÁªßÁª≠ÂæÄ‰∏ãÊâßË°å Type=idleÔºöËã•ÊúâÂÖ∂‰ªñ‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåÂΩìÂâçÊúçÂä°Êâç‰ºöËøêË°å ExecStartÔºöÂêØÂä®ÂΩìÂâçÊúçÂä°ÁöÑÂëΩ‰ª§ ExecStartPreÔºöÂêØÂä®ÂΩìÂâçÊúçÂä°‰πãÂâçÊâßË°åÁöÑÂëΩ‰ª§ ExecStartPostÔºöÂêØÂä®ÂΩìÂâçÊúçÂä°‰πãÂêéÊâßË°åÁöÑÂëΩ‰ª§ ExecReloadÔºöÈáçÂêØÂΩìÂâçÊúçÂä°Êó∂ÊâßË°åÁöÑÂëΩ‰ª§ ExecStopÔºöÂÅúÊ≠¢ÂΩìÂâçÊúçÂä°Êó∂ÊâßË°åÁöÑÂëΩ‰ª§ ExecStopPostÔºöÂÅúÊ≠¢ÂΩìÂÖ∂ÊúçÂä°‰πãÂêéÊâßË°åÁöÑÂëΩ‰ª§ RestartSecÔºöËá™Âä®ÈáçÂêØÂΩìÂâçÊúçÂä°Èó¥ÈöîÁöÑÁßíÊï∞ RestartÔºöÂÆö‰πâ‰ΩïÁßçÊÉÖÂÜµ Systemd ‰ºöËá™Âä®ÈáçÂêØÂΩìÂâçÊúçÂä°ÔºåÂèØËÉΩÁöÑÂÄºÂåÖÊã¨alwaysÔºàÊÄªÊòØÈáçÂêØÔºâ„ÄÅon-success„ÄÅon-failure„ÄÅon-abnormal„ÄÅon-abort„ÄÅon-watchdog TimeoutSecÔºöÂÆö‰πâ Systemd ÂÅúÊ≠¢ÂΩìÂâçÊúçÂä°‰πãÂâçÁ≠âÂæÖÁöÑÁßíÊï∞ EnvironmentÔºöÊåáÂÆöÁéØÂ¢ÉÂèòÈáè Unit ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂÆåÊï¥Â≠óÊÆµÊ∏ÖÂçïÔºåËØ∑ÂèÇËÄÉÂÆòÊñπÊñáÊ°£„ÄÇ TargetÂêØÂä®ËÆ°ÁÆóÊú∫ÁöÑÊó∂ÂÄôÔºåÈúÄË¶ÅÂêØÂä®Â§ßÈáèÁöÑ Unit„ÄÇÂ¶ÇÊûúÊØè‰∏ÄÊ¨°ÂêØÂä®ÔºåÈÉΩË¶Å‰∏Ä‰∏ÄÂÜôÊòéÊú¨Ê¨°ÂêØÂä®ÈúÄË¶ÅÂì™‰∫õ UnitÔºåÊòæÁÑ∂ÈùûÂ∏∏‰∏çÊñπ‰æø„ÄÇSystemd ÁöÑËß£ÂÜ≥ÊñπÊ°àÂ∞±ÊòØ Target„ÄÇÁÆÄÂçïËØ¥ÔºåTarget Â∞±ÊòØ‰∏Ä‰∏™ Unit ÁªÑÔºåÂåÖÂê´ËÆ∏Â§öÁõ∏ÂÖ≥ÁöÑ Unit „ÄÇÂêØÂä®Êüê‰∏™ Target ÁöÑÊó∂ÂÄôÔºåSystemd Â∞±‰ºöÂêØÂä®ÈáåÈù¢ÊâÄÊúâÁöÑ Unit„ÄÇ‰ªéËøô‰∏™ÊÑè‰πâ‰∏äËØ¥ÔºåTarget Ëøô‰∏™Ê¶ÇÂøµÁ±ª‰ºº‰∫é‚ÄùÁä∂ÊÄÅÁÇπ‚ÄùÔºåÂêØÂä®Êüê‰∏™ Target Â∞±Â•ΩÊØîÂêØÂä®Âà∞ÊüêÁßçÁä∂ÊÄÅ„ÄÇ‰º†ÁªüÁöÑinitÂêØÂä®Ê®°ÂºèÈáåÈù¢ÔºåÊúâ RunLevel ÁöÑÊ¶ÇÂøµÔºåË∑ü Target ÁöÑ‰ΩúÁî®ÂæàÁ±ª‰ºº„ÄÇ‰∏çÂêåÁöÑÊòØÔºåRunLevel ÊòØ‰∫íÊñ•ÁöÑÔºå‰∏çÂèØËÉΩÂ§ö‰∏™ RunLevel ÂêåÊó∂ÂêØÂä®Ôºå‰ΩÜÊòØÂ§ö‰∏™ Target ÂèØ‰ª•ÂêåÊó∂ÂêØÂä®„ÄÇ Êü•ÁúãÂΩìÂâçÁ≥ªÁªüÁöÑÊâÄÊúâ Target1systemctl list-unit-files --type=target Êü•Áúã‰∏Ä‰∏™ Target ÂåÖÂê´ÁöÑÊâÄÊúâ Unit1systemctl list-dependencies multi-user.target Êü•ÁúãÂêØÂä®Êó∂ÁöÑÈªòËÆ§ Target1systemctl get-default ËÆæÁΩÆÂêØÂä®Êó∂ÁöÑÈªòËÆ§ Target1systemctl set-default multi-user.target ÂàáÊç¢ Target Êó∂ÔºåÈªòËÆ§‰∏çÂÖ≥Èó≠Ââç‰∏Ä‰∏™ Target ÂêØÂä®ÁöÑËøõÁ®ãÔºåsystemctl isolate ÂëΩ‰ª§ÊîπÂèòËøôÁßçË°å‰∏∫ÔºåÂÖ≥Èó≠Ââç‰∏Ä‰∏™ Target ÈáåÈù¢ÊâÄÊúâ‰∏çÂ±û‰∫éÂêé‰∏Ä‰∏™ Target ÁöÑËøõÁ®ã1systemctl isolate multi-user.target Target ‰∏é ‰º†Áªü RunLevel ÁöÑÂØπÂ∫îÂÖ≥Á≥ªÂ¶Ç‰∏ã„ÄÇ123456789Traditional runlevel New target name Symbolically linked to...Runlevel 0 | runlevel0.target -> poweroff.targetRunlevel 1 | runlevel1.target -> rescue.targetRunlevel 2 | runlevel2.target -> multi-user.targetRunlevel 3 | runlevel3.target -> multi-user.targetRunlevel 4 | runlevel4.target -> multi-user.targetRunlevel 5 | runlevel5.target -> graphical.targetRunlevel 6 | runlevel6.target -> reboot.target ÂÆÉ‰∏éinitËøõÁ®ãÁöÑ‰∏ªË¶ÅÂ∑ÆÂà´Â¶Ç‰∏ã: ÈªòËÆ§ÁöÑ RunLevelÔºàÂú®/etc/inittabÊñá‰ª∂ËÆæÁΩÆÔºâÁé∞Âú®Ë¢´ÈªòËÆ§ÁöÑ Target Âèñ‰ª£Ôºå‰ΩçÁΩÆÊòØ/etc/systemd/system/default.targetÔºåÈÄöÂ∏∏Á¨¶Âè∑ÈìæÊé•Âà∞graphical.targetÔºàÂõæÂΩ¢ÁïåÈù¢ÔºâÊàñËÄÖmulti-user.targetÔºàÂ§öÁî®Êà∑ÂëΩ‰ª§Ë°åÔºâ„ÄÇ ÂêØÂä®ËÑöÊú¨ÁöÑ‰ΩçÁΩÆÔºå‰ª•ÂâçÊòØ/etc/init.dÁõÆÂΩïÔºåÁ¨¶Âè∑ÈìæÊé•Âà∞‰∏çÂêåÁöÑ RunLevel ÁõÆÂΩï ÔºàÊØîÂ¶Ç/etc/rc3.d„ÄÅ/etc/rc5.dÁ≠âÔºâÔºåÁé∞Âú®ÂàôÂ≠òÊîæÂú®/lib/systemd/systemÂíå/etc/systemd/systemÁõÆÂΩï„ÄÇ ÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰ΩçÁΩÆÔºå‰ª•ÂâçinitËøõÁ®ãÁöÑÈÖçÁΩÆÊñá‰ª∂ÊòØ/etc/inittabÔºåÂêÑÁßçÊúçÂä°ÁöÑÈÖçÁΩÆÊñá‰ª∂Â≠òÊîæÂú®/etc/sysconfigÁõÆÂΩï„ÄÇÁé∞Âú®ÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏ªË¶ÅÂ≠òÊîæÂú®/lib/systemdÁõÆÂΩïÔºåÂú®/etc/systemdÁõÆÂΩïÈáåÈù¢ÁöÑ‰øÆÊîπÂèØ‰ª•Ë¶ÜÁõñÂéüÂßãËÆæÁΩÆ„ÄÇ Êó•ÂøóÁÆ°ÁêÜSystemd Áªü‰∏ÄÁÆ°ÁêÜÊâÄÊúâ Unit ÁöÑÂêØÂä®Êó•Âøó„ÄÇÂ∏¶Êù•ÁöÑÂ•ΩÂ§ÑÂ∞±ÊòØÔºåÂèØ‰ª•Âè™Áî®journalctl‰∏Ä‰∏™ÂëΩ‰ª§ÔºåÊü•ÁúãÊâÄÊúâÊó•ÂøóÔºàÂÜÖÊ†∏Êó•ÂøóÂíåÂ∫îÁî®Êó•ÂøóÔºâ„ÄÇÊó•ÂøóÁöÑÈÖçÁΩÆÊñá‰ª∂ÊòØ/etc/systemd/journald.conf„ÄÇ journalctlÂäüËÉΩÂº∫Â§ßÔºåÁî®Ê≥ïÈùûÂ∏∏Â§ö„ÄÇ Êü•ÁúãÊâÄÊúâÊó•ÂøóÔºàÈªòËÆ§ÊÉÖÂÜµ‰∏ã ÔºåÂè™‰øùÂ≠òÊú¨Ê¨°ÂêØÂä®ÁöÑÊó•ÂøóÔºâ1journalctl Êü•ÁúãÂÜÖÊ†∏Êó•ÂøóÔºà‰∏çÊòæÁ§∫Â∫îÁî®Êó•ÂøóÔºâ1journalctl -k Êü•ÁúãÁ≥ªÁªüÊú¨Ê¨°ÂêØÂä®ÁöÑÊó•Âøó12journalctl -bjournalctl -b -0 Êü•Áúã‰∏ä‰∏ÄÊ¨°ÂêØÂä®ÁöÑÊó•ÂøóÔºàÈúÄÊõ¥ÊîπËÆæÁΩÆÔºâ1journalctl -b -1 Êü•ÁúãÊåáÂÆöÊó∂Èó¥ÁöÑÊó•Âøó12345journalctl --since="2012-10-30 18:17:16"journalctl --since "20 min ago"journalctl --since yesterdayjournalctl --since "2015-01-10" --until "2015-01-11 03:00"journalctl --since 09:00 --until "1 hour ago" ÊòæÁ§∫Â∞æÈÉ®ÁöÑÊúÄÊñ∞10Ë°åÊó•Âøó1journalctl -n ÊòæÁ§∫Â∞æÈÉ®ÊåáÂÆöË°åÊï∞ÁöÑÊó•Âøó1journalctl -n 20 ÂÆûÊó∂ÊªöÂä®ÊòæÁ§∫ÊúÄÊñ∞Êó•Âøó1journalctl -f Êü•ÁúãÊåáÂÆöÊúçÂä°ÁöÑÊó•Âøó1journalctl /usr/lib/systemd/systemd Êü•ÁúãÊåáÂÆöËøõÁ®ãÁöÑÊó•Âøó1journalctl _PID=1 Êü•ÁúãÊüê‰∏™Ë∑ØÂæÑÁöÑËÑöÊú¨ÁöÑÊó•Âøó1journalctl /usr/bin/bash Êü•ÁúãÊåáÂÆöÁî®Êà∑ÁöÑÊó•Âøó1journalctl _UID=33 --since today Êü•ÁúãÊüê‰∏™ Unit ÁöÑÊó•Âøó12journalctl -u nginx.servicejournalctl -u nginx.service --since today ÂÆûÊó∂ÊªöÂä®ÊòæÁ§∫Êüê‰∏™ Unit ÁöÑÊúÄÊñ∞Êó•Âøó1journalctl -u nginx.service -f ÂêàÂπ∂ÊòæÁ§∫Â§ö‰∏™ Unit ÁöÑÊó•Âøó1journalctl -u nginx.service -u php-fpm.service --since today Êü•ÁúãÊåáÂÆö‰ºòÂÖàÁ∫ßÔºàÂèäÂÖ∂‰ª•‰∏äÁ∫ßÂà´ÔºâÁöÑÊó•ÂøóÔºåÂÖ±Êúâ8Á∫ß 0:emerg 1:alert 2:crit 3:err 4:warning 5:notice 6:info 7:debug1journalctl -p err -b Êó•ÂøóÈªòËÆ§ÂàÜÈ°µËæìÂá∫Ôºå‚Äìno-pager Êîπ‰∏∫Ê≠£Â∏∏ÁöÑÊ†áÂáÜËæìÂá∫1journalctl --no-pager ‰ª• JSON Ê†ºÂºèÔºàÂçïË°åÔºâËæìÂá∫1journalctl -b -u nginx.service -o json ‰ª• JSON Ê†ºÂºèÔºàÂ§öË°åÔºâËæìÂá∫ÔºåÂèØËØªÊÄßÊõ¥Â•Ω1journalctl -b -u nginx.serviceqq -o json-pretty ÊòæÁ§∫Êó•ÂøóÂç†ÊçÆÁöÑÁ°¨ÁõòÁ©∫Èó¥1journalctl --disk-usage ÊåáÂÆöÊó•ÂøóÊñá‰ª∂Âç†ÊçÆÁöÑÊúÄÂ§ßÁ©∫Èó¥1journalctl --vacuum-size=1G ÊåáÂÆöÊó•ÂøóÊñá‰ª∂‰øùÂ≠òÂ§ö‰πÖ1journalctl --vacuum-time=1years document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinuxÊü•ÁúãÊúÄÊ∂àËÄóCPUÂíåÂÜÖÂ≠òÁöÑËøõÁ®ã]]></title>
    <url>%2F2019%2F04%2F22%2Fcpu-memory%2F</url>
    <content type="text"><![CDATA[ÁúüÊ≠£Âä™ÂäõËøáÁöÑ‰∫∫ÊâçÁü•ÈÅìÔºåÊô∫ÂïÜ‰∏äÁöÑÂ∑ÆË∑ùÊòØ‰∏çÂèØÈÄæË∂äÁöÑ„ÄÇ ÂëΩ‰ª§ CPUÂç†Áî®ÊúÄÂ§öÁöÑÂâç10‰∏™ËøõÁ®ãÔºö 1ps auxw|head -1;ps auxw|sort -rn -k3|head -10 ÂÜÖÂ≠òÊ∂àËÄóÊúÄÂ§öÁöÑÂâç10‰∏™ËøõÁ®ã 1ps auxw|head -1;ps auxw|sort -rn -k4|head -10 ËôöÊãüÂÜÖÂ≠ò‰ΩøÁî®ÊúÄÂ§öÁöÑÂâç10‰∏™ËøõÁ®ã 1ps auxw|head -1;ps auxw|sort -rn -k5|head -10 Âá†‰∏™ÂèÇÊï∞Âê´‰πâ: %MEM ËøõÁ®ãÁöÑÂÜÖÂ≠òÂç†Áî®Áéá VSZ ËøõÁ®ãÊâÄ‰ΩøÁî®ÁöÑËôöÂ≠òÁöÑÂ§ßÂ∞è RSS ËøõÁ®ã‰ΩøÁî®ÁöÑÈ©ªÁïôÈõÜÂ§ßÂ∞èÊàñËÄÖÊòØÂÆûÈôÖÂÜÖÂ≠òÁöÑÂ§ßÂ∞è(RSS is the ‚Äúresident set size‚Äù meaning physical memory used) TTY ‰∏éËøõÁ®ãÂÖ≥ËÅîÁöÑÁªàÁ´ØÔºàttyÔºâ ‰∏≤Ë°åÁ´ØÂè£ÁªàÁ´ØÔºà/dev/ttySnÔºâ ‰º™ÁªàÁ´ØÔºà/dev/pty/Ôºâ ÊéßÂà∂ÁªàÁ´ØÔºà/dev/ttyÔºâ ÊéßÂà∂Âè∞ÁªàÁ´ØÔºà/dev/ttyn, /dev/consoleÔºâ ËôöÊãüÁªàÁ´Ø(/dev/pts/n) STAT Ê£ÄÊü•ÁöÑÁä∂ÊÄÅÔºöËøõÁ®ãÁä∂ÊÄÅ‰ΩøÁî®Â≠óÁ¨¶Ë°®Á§∫ÁöÑÔºåÂ¶ÇRÔºàrunningÊ≠£Âú®ËøêË°åÊàñÂáÜÂ§áËøêË°åÔºâ„ÄÅSÔºàsleepingÁù°Áú†Ôºâ„ÄÅIÔºàidleÁ©∫Èó≤Ôºâ„ÄÅZ (ÂÉµÊ≠ª)„ÄÅDÔºà‰∏çÂèØ‰∏≠Êñ≠ÁöÑÁù°Áú†ÔºåÈÄöÂ∏∏ÊòØI/OÔºâ„ÄÅPÔºàÁ≠âÂæÖ‰∫§Êç¢È°µÔºâ„ÄÅWÔºàÊç¢Âá∫,Ë°®Á§∫ÂΩìÂâçÈ°µÈù¢‰∏çÂú®ÂÜÖÂ≠òÔºâ„ÄÅNÔºà‰Ωé‰ºòÂÖàÁ∫ß‰ªªÂä°ÔºâT(terminateÁªàÊ≠¢)„ÄÅW has no resident pages D ‰∏çÂèØ‰∏≠Êñ≠ Uninterruptible sleep (usually IO) R Ê≠£Âú®ËøêË°åÔºåÊàñÂú®ÈòüÂàó‰∏≠ÁöÑËøõÁ®ã S Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅ T ÂÅúÊ≠¢ÊàñË¢´ËøΩË∏™ Z ÂÉµÂ∞∏ËøõÁ®ã W ËøõÂÖ•ÂÜÖÂ≠ò‰∫§Êç¢Ôºà‰ªéÂÜÖÊ†∏2.6ÂºÄÂßãÊó†ÊïàÔºâ X Ê≠ªÊéâÁöÑËøõÁ®ã < È´ò‰ºòÂÖàÁ∫ß N ‰Ωé‰ºòÂÖàÁ∫ß L Êúâ‰∫õÈ°µË¢´ÈîÅËøõÂÜÖÂ≠ò s ÂåÖÂê´Â≠êËøõÁ®ã ‰Ωç‰∫éÂêéÂè∞ÁöÑËøõÁ®ãÁªÑ l Â§öÁ∫øÁ®ã ÂÖãÈöÜÁ∫øÁ®ã multi-threaded (using CLONE_THREAD, like NPTL pthreads do) document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NginxÊü•ÁúãÊà™ÂèñÂàáÂâ≤Êó•Âøó]]></title>
    <url>%2F2019%2F04%2F22%2Fnginx-log%2F</url>
    <content type="text"><![CDATA[Ëøô‰∏™‰∏ñÁïåÊ≤°ÊúâÈîôÔºåË∞ÅËÆ©‰Ω†ÈïøÂæó‰∏çÂ•ΩÁúãÂèàÊ≤°Èí±„ÄÇ ‰ªãÁªçnginxÊó•ÂøóÊúÄÂ•ΩÂÆûÁé∞ÊØèÂ§©ÂÆöÊó∂ÂàáÂâ≤‰∏ãÔºåÁâπÂà´ÊòØÂú®ËÆøÈóÆÈáèÊØîËæÉÂ§ßÁöÑÊó∂ÂÄôÔºåÊñπ‰æøÊü•Áúã‰∏éÂ§ÑÁêÜÔºåÂ¶ÇÊûúÊ≤°ÂàáÂâ≤ÔºåÂèØ‰ª•Áî®sedÁõ¥Êé•ÂàáÂâ≤ ÂëΩ‰ª§Êü•Êâæ7Êúà17Êó•ËÆøÈóÆlogÂØºÂá∫Âà∞17.logÊñá‰ª∂‰∏≠1cat gelin_web_access.log | egrep "17/Jul/2017" | sed -n '/00:00:00/,/23:59:59/p' > /tmp/17.log Êü•ÁúãËÆøÈóÆÈáèÂâç10ÁöÑIP1awk '{print $1}' 17.log | sort | uniq -c | sort -nr | head -n 10 Êü•ÁúãËÆøÈóÆÂâç10ÁöÑURL1awk '{print $11}' gelin_web_access.log | sort | uniq -c | sort -nr | head -n 10 Êü•ËØ¢ËÆøÈóÆÊúÄÈ¢ëÁπÅÁöÑURL1awk '{print $7}' gelin_web_access.log | sort | uniq -c | sort -n -k 1 -r | more Êü•ËØ¢ËÆøÈóÆÊúÄÈ¢ëÁπÅÁöÑIP1awk '{print $1}' gelin_web_access.log | sort | uniq -c | sort -n -k 1 -r | more Ê†πÊçÆËÆøÈóÆIPÁªüËÆ°UV1awk '{print $1}' gelin_web_access.log | sort | uniq -c | wc -l ÁªüËÆ°ËÆøÈóÆURLÁªüËÆ°PV1awk '{print $7}' gelin_web_access.log | wc -l Ê†πÊçÆÊó∂Èó¥ÊÆµÁªüËÆ°Êü•ÁúãÊó•Âøó1cat gelin_web_access.log | sed -n '/17\/Jul\/2017:12/,/17\/Jul\/2017:13/p' | more document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux iptables Êï¥ÁêÜ]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-iptables%2F</url>
    <content type="text"><![CDATA[‰Ω†ÊÄªÂ´åÊúâ‰∫õ‰∫∫ÊáíÔºåËØ¥ÂæóÂ•ΩÂÉè‰Ω†Âã§Âø´‰∫ÜÂ∞±ÁúüËÉΩÂπ≤Âá∫‰ªÄ‰πàÂ§ß‰∫ãÂÑø‰∏ÄÊ†∑„ÄÇ ‰ªãÁªçiptablesÊòØLinux‰∏≠ÈáçË¶ÅÁöÑËÆøÈóÆÊéßÂà∂ÊâãÊÆµÔºåÊòØ‰øóÁß∞ÁöÑ Linux Èò≤ÁÅ´Â¢ôÁ≥ªÁªüÁöÑÈáçË¶ÅÁªÑÊàêÈÉ®ÂàÜ„ÄÇËøôÈáåËÆ∞ÂΩï‰∫Üiptables Èò≤ÁÅ´Â¢ôËßÑÂàôÁöÑ‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÊìç‰ΩúÊåá‰ª§„ÄÇ iptablesÁöÑÂü∫Êú¨ËØ≠Ê≥ïÔºö1iptables [-t filter/nat] [-A/I] [INPUT/OUTPUT/FORWARD] [-i/o interface] [-p tcp/udp/icmp/all] [-s ip/network] [--sport ports] [-d ip/network] [--dport ports] [-j ACCEPT/DROP] 12345678910111213141516171819202122232425262728ÂèÇÊï∞ËØ¥Êòé: ‰∏çÂä†-tÊó∂ÈªòËÆ§ÊòØfilter ËØ≠Ê≥ïÂèÇÊï∞Ôºö -IÔºöÁ¨¨‰∏ÄË°åÊèíÂÖ• -AÔºöÊúÄÂêéËøΩÂä† -i/oÔºöÊåáÁöÑÊòØÊï∞ÊçÆË¶ÅËøõÂÖ•ÊàñÂá∫ÂéªÊâÄË¶ÅÁªèËøáÁöÑÁ´ØÂè£ÔºåÂ¶Çeth1,eth0,pppoeÁ≠â -pÔºö‰Ω†ÊâÄË¶ÅÊåáÂÆöÁöÑÂçèËÆÆ -sÔºöÊåáÂÆöÊù•Ê∫êipÔºåÂèØ‰ª•ÊòØÂçï‰∏™ipÂ¶Ç192.168.109.131Ôºå‰πüÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÁΩëÁªú 192.168.109.0/24ÔºåËøòÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÂüüÂêçÂ¶Ç163.comÔºåÂ¶ÇÊûú‰Ω†Â°´ÂÜôÁöÑÊòØÂüüÂêçÁ≥ªÁªü‰ºöËá™Âä®Ëß£ÊûêÂá∫‰ªñÁöÑipÂπ∂Âú®iptablesÈáåÊòæÁ§∫ --sportÔºöÊù•Ê∫êÁ´ØÂè£ -dÔºöÊåáÂÆöÁõÆÊ†áip --dportÔºöÁõÆÊ†áÁ´ØÂè£ -jÔºöÊâßË°åÂèÇÊï∞ACCEPTÊàñDROPÔºåREJECT‰∏ÄËà¨‰∏çÁî® -A Âú®ÊåáÂÆöÈìæÁöÑÊú´Â∞æÊ∑ªÂä†ÔºàappendÔºâ‰∏ÄÊù°Êñ∞ÁöÑËßÑÂàô -D Âà†Èô§ÔºàdeleteÔºâÊåáÂÆöÈìæ‰∏≠ÁöÑÊüê‰∏ÄÊù°ËßÑÂàôÔºåÂèØ‰ª•ÊåâËßÑÂàôÂ∫èÂè∑ÂíåÂÜÖÂÆπÂà†Èô§ -I Âú®ÊåáÂÆöÈìæ‰∏≠ÊèíÂÖ•ÔºàinsertÔºâ‰∏ÄÊù°Êñ∞ÁöÑËßÑÂàôÔºåÈªòËÆ§Âú®Á¨¨‰∏ÄË°åÊ∑ªÂä† -R ‰øÆÊîπ„ÄÅÊõøÊç¢ÔºàreplaceÔºâÊåáÂÆöÈìæ‰∏≠ÁöÑÊüê‰∏ÄÊù°ËßÑÂàôÔºåÂèØ‰ª•ÊåâËßÑÂàôÂ∫èÂè∑ÂíåÂÜÖÂÆπÊõøÊç¢ -L ÂàóÂá∫ÔºàlistÔºâÊåáÂÆöÈìæ‰∏≠ÊâÄÊúâÁöÑËßÑÂàôËøõË°åÊü•Áúã -E ÈáçÂëΩÂêçÁî®Êà∑ÂÆö‰πâÁöÑÈìæÔºå‰∏çÊîπÂèòÈìæÊú¨Ë∫´ -F Ê∏ÖÁ©∫ÔºàflushÔºâ -N Êñ∞Âª∫Ôºànew-chainÔºâ‰∏ÄÊù°Áî®Êà∑Ëá™Â∑±ÂÆö‰πâÁöÑËßÑÂàôÈìæ -X Âà†Èô§ÊåáÂÆöË°®‰∏≠Áî®Êà∑Ëá™ÂÆö‰πâÁöÑËßÑÂàôÈìæÔºàdelete-chainÔºâ -P ËÆæÁΩÆÊåáÂÆöÈìæÁöÑÈªòËÆ§Á≠ñÁï•ÔºàpolicyÔºâ -Z Â∞ÜÊâÄÊúâË°®ÁöÑÊâÄÊúâÈìæÁöÑÂ≠óËäÇÂíåÊï∞ÊçÆÂåÖËÆ°Êï∞Âô®Ê∏ÖÈõ∂ -n ‰ΩøÁî®Êï∞Â≠óÂΩ¢ÂºèÔºànumericÔºâÊòæÁ§∫ËæìÂá∫ÁªìÊûú -v Êü•ÁúãËßÑÂàôË°®ËØ¶ÁªÜ‰ø°ÊÅØÔºàverboseÔºâÁöÑ‰ø°ÊÅØ -V Êü•ÁúãÁâàÊú¨(version) -h Ëé∑ÂèñÂ∏ÆÂä©ÔºàhelpÔºâ Â¶ÇÊûúÈÖçÁΩÆÁöÑÊòØINPUTÔºàËøõÂÖ•Ôºâ,ÂàôÊù•Ê∫êipÊòØËøêÁ®ãipÔºåÁõÆÊ†áÁ´ØÂè£Â∞±ÊòØÊú¨Êú∫ÔºõOUTPUTÁõ∏Âèç ÊµÅÁ®ãÂΩìÊï∞ÊçÆÂåÖÂà∞ËææÁõÆÊ†á‰∏ªÊú∫Êó∂ÔºåÁªèËøáPREROUTINGÈìæ,ÁªèË∑ØÁî±‰πãÂêéÂÜ≥ÂÆöÊòØÂê¶ËΩ¨ÂèëÔºå‰∏çËΩ¨ÂèëÂàôËøõÂÖ•INPUTÈìæÔºåÂà∞ËææÁî®Êà∑Á©∫Èó¥„ÄÇËøõÁ®ãÂØπÂ§ñÈÄö‰ø°Êó∂ÔºåÁªèÁî±OUTPUTÈìæÂá∫ÂéªÔºåË∑ØÁî±‰πãÂêéÂà∞ËææPOSTROUTINGÈìæÔºåÁªèÁΩëÂç°Âá∫Âéª„ÄÇÂΩì‰∏ÄÊï∞ÊçÆÂåÖÁªèËøáPREROUTINGÈìæÂèëÁé∞ÂÖ∂‰∏çÊòØÂà∞ËææÊú¨‰∏ªÊú∫ÔºåÈÇ£‰πàÊï∞ÊçÆÂåÖÁªèËøáFORWARDÈìæÔºåÂà∞Ëææ POSTROUTINGÈìæËΩ¨ÂèëÂá∫Âéª„ÄÇÊú¨Êú∫ËøõÁ®ãÂØπÂèëÈÄÅÊï∞ÊçÆÊó∂ÔºåÁªèÁî±OUTPUTÈìæË∑ØÁî±‰πãÂêéËøõÂÖ•POSTROUTINGÈìæÂá∫Âéª„ÄÇiptablesÂåπÈÖçËßÑÂàôÊó∂ÔºåÊòØËá™‰∏äËÄå‰∏ãÂåπÈÖçÁöÑÔºåÂåπÈÖçÂà∞Á¨¨‰∏ÄÊù°ËßÑÂàôÊó∂Êó¢Ë∑≥Âá∫ÔºåÂê¶Âàô‰∏ÄÁõ¥ÂæÄ‰∏ãÂåπÈÖçÔºåÊ≤°ÊúâÂàô‰ΩøÁî®ÈªòËÆ§ËßÑÂàô„ÄÇiptablesËßÑÂàôÂª∫Á´ãÊó∂ÔºåÈ¶ñÂÖàÈúÄË¶ÅÁ°ÆÂÆöÂäüËÉΩÔºàË°®ÔºâÔºåÁ°ÆÂÆöÊä•ÊñáÊµÅÂêëÔºåÁ°ÆÂÆöË¶ÅÂÆûÁé∞ÁöÑÁõÆÊ†áÔºåÁ°ÆÂÆöÂåπÈÖçÊù°‰ª∂„ÄÇÂ∞ΩÈáèÈÅµÂæ™‰ª•‰∏ãËßÑÂàôÔºöÂ∞ΩÈáèÂáèÂ∞ëËßÑÂàôÊù°ÁõÆÔºåÂΩºÊ≠§Èó¥Êó†ÂÖ≥ËÅîÔºåËÆøÈóÆÊù°ÁõÆÂ§ßÊîæ‰∏äÈù¢ÔºåÊúâÂÖ≥ËÅîÔºàÂêå‰∏ÄÂäüËÉΩÔºâÔºåËßÑÂàôÊõ¥‰∏•Ê†ºÁöÑÊîæ‰∏äÈù¢ ‰∫î‰∏™hookÂáΩÊï∞ÂàÜÂà´ÊòØPREROUTING,INPUT ,OUTPUT,POSTROUTING,FORWARDÔºåÊàë‰ª¨ÊääËøô‰∫î‰∏™Èí©Â≠êÂáΩÊï∞Áß∞‰∏∫ÈìæÔºåNetfilterÂÆûÁé∞‰∫ÜÂá†ÂäüËÉΩÔºåraw ÔºåmangleÔºånatÔºåfilter„ÄÇÊàë‰ª¨‰∏ÄËà¨ÊääËøôÂá†‰∏™ÂäüËÉΩÁß∞‰∏∫Ë°®ÔºåË°®‰πãÈó¥Êúâ‰ºòÂÖàÁ∫ßÂÖ≥Á≥ªÔºå‰ªé‰ΩéÂà∞È´ò‰∏∫filter‚Äî-nat‚Äî-mangle‚Äî-raw,Ë°®‰∏éÈìæ‰πãÈó¥ÊúâÂØπÂ∫îÂÖ≥Á≥ªÔºåÂÖ∑‰ΩìËßÅÂõæË°®„ÄÇ Ë°® rawË°®Ôºö ÂØπÊä•ÊñáËÆæÁΩÆ‰∏Ä‰∏™Ê†áÂøóÔºåÂÜ≥ÂÆöÊï∞ÊçÆÂåÖÊòØÂê¶Ë¢´Áä∂ÊÄÅË∑üË∏™Êú∫Âà∂Â§ÑÁêÜ mangleË°®Ôºö ‰∏ªË¶ÅÁî®‰∫é‰øÆÊîπÊï∞ÊçÆÂåÖ natË°®Ôºö ‰∏ªË¶ÅÁî®Â§ÑÊòØÁΩëÁªúÂú∞ÂùÄËΩ¨Êç¢„ÄÅÁ´ØÂè£Êò†Â∞Ñ fileterË°®Ôºö ‰∏ªË¶ÅÁî®‰∫éËøáÊª§ÂåÖ ‰∏ÄËà¨ÊÉÖÂÜµÊàë‰ª¨ÂØπfilterË°®ÂÅöÈÖçÁΩÆÁöÑÊõ¥Â§ö„ÄÇ Èìæ INPUTÔºö ‰ΩúÁî®‰∫éËøõÂÖ•Êú¨Êú∫ÁöÑÂåÖ OUTPUTÔºö ‰ΩúÁî®‰∫éÊú¨Êú∫ÈÄÅÂá∫ÁöÑÂåÖ FORWARDÔºö ÂåπÈÖçÁ©øËøáÊú¨Êú∫ÁöÑÊï∞ÊçÆÂåÖÔºàËΩ¨ÂèëÔºâ PREROUTINGÔºö Áî®‰∫é‰øÆÊîπÁõÆÁöÑÂú∞ÂùÄÔºàDNATÔºâ POSTROUTINGÔºöÁî®‰∫é‰øÆÊîπÊ∫êÂú∞ÂùÄ ÔºàSNATÔºâ Âü∫Êú¨Êìç‰Ωú12345678ÂêØÂä®Êåá‰ª§:service iptables start ÈáçÂêØÊåá‰ª§:service iptables restart ÂÖ≥Èó≠Êåá‰ª§:service iptables stop‰øùÂ≠òÊåá‰ª§:service iptables saveÊ∏ÖÈô§ËßÑÂàôÔºöiptables -F Â∞ÜÈìæÁöÑËÆ∞Êï∞ÁöÑÊµÅÈáèÊ∏ÖÈõ∂: iptables -ZÊ∏ÖÈô§Èìæ: iptables -XÊ∏ÖÁ©∫iptablesÊó∂‰∏ÄËà¨-F -Z -X‰∏ÄËµ∑‰ΩøÁî® ‰∏âÁßçÁä∂ÊÄÅ ACCEPT ÂÖÅËÆ∏ DROP ‰∏¢ÂºÉ REJECT ÊãíÁªù ROPÂíåREJECTÁöÑÂå∫Âà´ÔºöDROPÊòØÁõ¥Êé•‰∏çËÆ©ËøõÂÖ•ÔºåËÄåREJECTÊòØÂÖàËÆ©ËøõÂÖ•ÁÑ∂ÂêéÂÜçÊãíÁªùÔºåLOGÂú®/var/log/messagesÊñá‰ª∂‰∏≠ËÆ∞ÂΩïÊó•Âøó‰ø°ÊÅØÔºåÁÑ∂ÂêéÂ∞ÜÊï∞ÊçÆÂåÖ‰º†ÈÄíÁªô‰∏ã‰∏ÄÊù°ËßÑÂàô. DROPÊõ¥ÂÆâÂÖ®ÔºåÊâÄ‰ª•‰∏ÄËà¨ÊãíÁªùÈÉΩÁî®DROP -AÈªòËÆ§ÊòØÊèíÂÖ•Âà∞Â∞æÈÉ®ÁöÑÔºåÂèØ‰ª•-IÊù•ÊèíÂÖ•Âà∞ÊåáÂÆö‰ΩçÁΩÆ iptablesÁöÑ‰∏§ÁßçÈÖçÁΩÆÊÄùË∑Ø: ÈªòËÆ§ÂÖÅËÆ∏ÔºåÊãíÁªùÁâπÂà´ ÈªòËÆ§ÊãíÁªùÔºåÂÖÅËÆ∏ÁâπÂà´ ‰∫åËÄÖÈÉΩÊúâËá™Â∑±ÁöÑÁâπÁÇπÔºåÁúãÊÉÖÂÜµËÄåÂÆö„ÄÇ‰ΩÜÊòØÊ≥®ÊÑèÔºöÂ¶ÇÊûúË¶ÅÈÄâÊã©Á¨¨‰∫åÁßçÈÖçÁΩÆÊÄùË∑ØÔºåÈÖçÁΩÆÂâçÂàáËÆ∞ÂÖàÊäässhËÆæÁΩÆ‰∏∫ACCEPTÔºåÂõ†‰∏∫‰∏ÄËà¨Êú∫Âô®‰∏çÂú®Êàë‰ª¨Ë∫´ËæπÔºå‰∏ÄÊó¶ÈÖçÁΩÆÈªòËÆ§ÊãíÁªùÔºåÈÇ£Êàë‰ª¨ÁöÑËøúÁ®ãÁôªÂΩïÂ∞±‰ºöÊñ≠ÂºÄËøûÊé•ÔºåÈÇ£ÈóÆÈ¢òÂ∞±Â§ß‰∫Ü„ÄÇÈÖçÁΩÆÈªòËÆ§ÊãíÁªùÂâçËÆæÁΩÆ:12iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT ËøòÊúâ‰∏ÄÁßçÊñπÊ≥ïÔºöÂÅö‰∏Ä‰∏™ËÆ°Âàí‰ªªÂä°ÔºåËÆ©iptablesÂÆöÊúüÂÅúÊ≠¢ÔºåÂç≥ÊâßË°åservice iptables stopÔºåËøôÊ†∑ÁöÑËØùÂç≥‰ΩøÈÖçÁΩÆÈªòËÆ§ÊãíÁªùÂâçÊ≤°ÊúâÂÖÅËÆ∏ssh‰πüÊ≤°ÂÖ≥Á≥ªÔºåÁ≠âÂà∞ËÆ°Âàí‰ªªÂä°ÁîüÊïàÁöÑÊó∂Èó¥iptablesÂ∞±‰ºöËá™Âä®Ê∏ÖÈô§ÊâÄÊúâÁöÑÈÖçÁΩÆÔºåÂåÖÊã¨ÈªòËÆ§ËßÑÂàô„ÄÇ iptablesÁöÑÊâßË°å‰ºòÂÖàÁ∫ß: iptablesÁöÑÊâßË°åÈ°∫Â∫èÊòØËá™‰∏äËÄå‰∏ãÔºåÂΩìÊúâÈÖçÁΩÆ‰∫ßÁîüÂÜ≤Á™ÅÊó∂ÔºåÂâçÈù¢ÊâßË°åÁöÑÁîüÊïà„ÄÇ Âà†Èô§iptablesËßÑÂàô12345iptables -D INPUT 3 //Âà†Èô§inputÁöÑÁ¨¨3Êù°ËßÑÂàôiptables -t nat -D POSTROUTING 1 //Âà†Èô§natË°®‰∏≠postroutingÁöÑÁ¨¨‰∏ÄÊù°ËßÑÂàôiptables -F INPUT //Ê∏ÖÁ©∫ filterË°®INPUTÊâÄÊúâËßÑÂàôiptables -F //Ê∏ÖÁ©∫ÊâÄÊúâËßÑÂàôiptables -t nat -F POSTROUTING //Ê∏ÖÁ©∫natË°®POSTROUTINGÊâÄÊúâËßÑÂàô Âà†Èô§ËßÑÂàôÁ¨¨‰∏ÄÁßçÊñπÊ≥ïÔºö‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂1234vim /etc/sysconfig/iptablesÂà†Èô§Áõ∏Â∫îÁöÑË°åÔºåÁÑ∂Âêéservice iptables restart service iptables save Ê≥®ÊÑè: ‰øÆÊîπÂÆåÈÖçÁΩÆÊñá‰ª∂‰∏çËÉΩÂÖàsaveÔºå‰∏ÄÂÆöË¶ÅÂÖàrestartÊâçËÉΩsaveÔºåË¶Å‰∏çÁÑ∂Â∞±ÁôΩÂÅö‰∫Ü„ÄÇÂõ†‰∏∫save‰ºöÂú®iptablesÊúçÂä°ÂêØÂä®Êó∂ÈáçÊñ∞Âä†ËΩΩÔºåË¶ÅÊòØÂú®ÈáçÂêØ‰πãÂâçÁõ¥Êé•ÂÖàË∞ÉÁî®‰∫Üservice iptables save ÈÇ£‰πà‰Ω†ÁöÑ/etc/sysconfig/iptables ÈÖçÁΩÆÂ∞±ÂõûÊªöÂà∞‰∏äÊ¨°ÂêØÂä®ÊúçÂä°ÁöÑÈÖçÁΩÆ‰∫Ü„ÄÇ Á¨¨‰∫åÁßçÊñπÊ≥ïÔºöÁõ¥Êé•Áî®ÂëΩ‰ª§Âà†Èô§ Â¶ÇÊûú‰Ω†ËÆ∞ÂæóÈÖçÁΩÆÊó∂ÁöÑÂÜôÊ≥ïÔºåÈÇ£‰πàÂèØ‰ª•Áõ¥Êé•iptables -D ÂêéË∑ü‰∏äÈÖçÁΩÆÊó∂ÁöÑÂÜôÊ≥ï„ÄÇÂ¶ÇÔºö1iptables -D INPUT -s 10.72.11.12 -p tcp --sport 1234 -d 10.10.2.58 --dport 80 -j DROP ÊàñËÄÖÊü•ÁúãÊØèÊù°iptablesÁöÑÂ∫èÂè∑123iptables -L INPUT --line-numbersÁÑ∂ÂêéÂà†Èô§iptables -D INPUT 2 #Âà†Èô§Á¨¨2Êù°ËßÑÂàôÔºåÂç≥Êó∂ÁîüÊïà Èò≤ÁÅ´Â¢ôÂ∏∏Áî®ÁöÑÁ≠ñÁï•ÊãíÁªùËøõÂÖ•Èò≤ÁÅ´Â¢ôÁöÑÊâÄÊúâICMPÂçèËÆÆÊï∞ÊçÆÂåÖ1iptables -I INPUT -p icmp -j REJECT ÂÖÅËÆ∏Èò≤ÁÅ´Â¢ôËΩ¨ÂèëÈô§ICMPÂçèËÆÆ‰ª•Â§ñÁöÑÊâÄÊúâÊï∞ÊçÆÂåÖ1iptables -A FORWARD -p ! icmp -j ACCEPT ÊãíÁªùËΩ¨ÂèëÊù•Ëá™192.168.1.10‰∏ªÊú∫ÁöÑÊï∞ÊçÆÔºåÂÖÅËÆ∏ËΩ¨ÂèëÊù•Ëá™192.168.0.0/24ÁΩëÊÆµÁöÑÊï∞ÊçÆ12iptables -A FORWARD -s 192.168.1.11 -j REJECT iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT ‰∏¢ÂºÉ‰ªéÂ§ñÁΩëÊé•Âè£Ôºàeth1ÔºâËøõÂÖ•Èò≤ÁÅ´Â¢ôÊú¨Êú∫ÁöÑÊ∫êÂú∞ÂùÄ‰∏∫ÁßÅÁΩëÂú∞ÂùÄÁöÑÊï∞ÊçÆÂåÖ123iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP iptables -A INPUT -i eth1 -s 172.16.0.0/12 -j DROP iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP Â∞ÅÂ†µÁΩëÊÆµÔºà192.168.1.0/24ÔºâÔºå‰∏§Â∞èÊó∂ÂêéËß£Â∞Å„ÄÇ123iptables -I INPUT -s 10.20.30.0/24 -j DROP iptables -I FORWARD -s 10.20.30.0/24 -j DROP at now 2 hours at> iptables -D INPUT 1 at> iptables -D FORWARD 1 Âè™ÂÖÅËÆ∏ÁÆ°ÁêÜÂëò‰ªé202.13.0.0/16ÁΩëÊÆµ‰ΩøÁî®SSHËøúÁ®ãÁôªÂΩïÈò≤ÁÅ´Â¢ô‰∏ªÊú∫„ÄÇ12iptables -A INPUT -p tcp --dport 22 -s 202.13.0.0/16 -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j DROP ÂÖÅËÆ∏Êú¨Êú∫ÂºÄÊîæ‰ªéTCPÁ´ØÂè£20-1024Êèê‰æõÁöÑÂ∫îÁî®ÊúçÂä°12iptables -A INPUT -p tcp --dport 20:1024 -j ACCEPT iptables -A OUTPUT -p tcp --sport 20:1024 -j ACCEPT ÂÖÅËÆ∏ËΩ¨ÂèëÊù•Ëá™192.168.0.0/24Â±ÄÂüüÁΩëÊÆµÁöÑDNSËß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆÂåÖ12iptables -A FORWARD -s 192.168.0.0/24 -p udp --dport 53 -j ACCEPT iptables -A FORWARD -d 192.168.0.0/24 -p udp --sport 53 -j ACCEPT Á¶ÅÊ≠¢ÂÖ∂‰ªñ‰∏ªÊú∫pingÈò≤ÁÅ´Â¢ô‰∏ªÊú∫Ôºå‰ΩÜÊòØÂÖÅËÆ∏‰ªéÈò≤ÁÅ´Â¢ô‰∏äpingÂÖ∂‰ªñ‰∏ªÊú∫123iptables -I INPUT -p icmp --icmp-type Echo-Request -j DROP iptables -I INPUT -p icmp --icmp-type Echo-Reply -j ACCEPT iptables -I INPUT -p icmp --icmp-type destination-Unreachable -j ACCEPT Á¶ÅÊ≠¢ËΩ¨ÂèëÊù•Ëá™MACÂú∞ÂùÄ‰∏∫00Ôºö0CÔºö29Ôºö27Ôºö55Ôºö3FÁöÑÂíå‰∏ªÊú∫ÁöÑÊï∞ÊçÆÂåÖ12iptables -A FORWARD -m mac --mac-source 00:0c:29:27:55:3F -j DROPËØ¥ÊòéÔºöiptables‰∏≠‰ΩøÁî®‚Äú-m Ê®°ÂùóÂÖ≥ÈîÆÂ≠ó‚ÄùÁöÑÂΩ¢ÂºèË∞ÉÁî®ÊòæÁ§∫ÂåπÈÖç„ÄÇËøôÈáåÁî®‚Äú-m mac ‚Äìmac-source‚ÄùÊù•Ë°®Á§∫Êï∞ÊçÆÂåÖÁöÑÊ∫êMACÂú∞ÂùÄ„ÄÇ ÂÖÅËÆ∏Èò≤ÁÅ´Â¢ôÊú¨Êú∫ÂØπÂ§ñÂºÄÊîæTCPÁ´ØÂè£20„ÄÅ21„ÄÅ25„ÄÅ110‰ª•ÂèäË¢´Âä®Ê®°ÂºèFTPÁ´ØÂè£1250-128012iptables -A INPUT -p tcp -m multiport --dport 20,21,25,110,1250:1280 -j ACCEPTËØ¥ÊòéÔºöËøôÈáåÁî®‚Äú-m multiport ‚Äìdport‚ÄùÊù•ÊåáÂÆöÁõÆÁöÑÁ´ØÂè£ÂèäËåÉÂõ¥ Á¶ÅÊ≠¢ËΩ¨ÂèëÊ∫êIPÂú∞ÂùÄ‰∏∫192.168.1.20-192.168.1.99ÁöÑTCPÊï∞ÊçÆÂåÖ12iptables -A FORWARD -p tcp -m iprange --src-range 192.168.1.20-192.168.1.99 -j DROPËØ¥ÊòéÔºöÊ≠§Â§ÑÁî®‚Äú-m ‚Äìiprange ‚Äìsrc-range‚ÄùÊåáÂÆöIPËåÉÂõ¥„ÄÇ Á¶ÅÊ≠¢ËΩ¨Âèë‰∏éÊ≠£Â∏∏TCPËøûÊé•Êó†ÂÖ≥ÁöÑÈùû‚ÄîsynËØ∑Ê±ÇÊï∞ÊçÆÂåÖ12iptables -A FORWARD -m state --state NEW -p tcp ! --syn -j DROPËØ¥ÊòéÔºö‚Äú-m state‚ÄùË°®Á§∫Êï∞ÊçÆÂåÖÁöÑËøûÊé•Áä∂ÊÄÅÔºå‚ÄúNEW‚ÄùË°®Á§∫‰∏é‰ªª‰ΩïËøûÊé•Êó†ÂÖ≥ÁöÑ ÊãíÁªùËÆøÈóÆÈò≤ÁÅ´Â¢ôÁöÑÊñ∞Êï∞ÊçÆÂåÖÔºå‰ΩÜÂÖÅËÆ∏ÂìçÂ∫îËøûÊé•Êàñ‰∏éÂ∑≤ÊúâËøûÊé•Áõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂåÖ12iptables -A INPUT -p tcp -m state --state NEW -j DROP iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT ËØ¥ÊòéÔºö‚ÄúESTABLISHED‚ÄùË°®Á§∫Â∑≤ÁªèÂìçÂ∫îËØ∑Ê±ÇÊàñËÄÖÂ∑≤ÁªèÂª∫Á´ãËøûÊé•ÁöÑÊï∞ÊçÆÂåÖÔºå‚ÄúRELATED‚ÄùË°®Á§∫‰∏éÂ∑≤Âª∫Á´ãÁöÑËøûÊé•ÊúâÁõ∏ÂÖ≥ÊÄßÁöÑÔºåÊØîÂ¶ÇFTPÊï∞ÊçÆËøûÊé•Á≠â„ÄÇ Âè™ÂºÄÊîæÊú¨Êú∫ÁöÑwebÊúçÂä°Ôºà80Ôºâ„ÄÅFTP(20„ÄÅ21„ÄÅ20450-20480)ÔºåÊîæË°åÂ§ñÈÉ®‰∏ªÊú∫Âèë‰ΩèÊúçÂä°Âô®ÂÖ∂ÂÆÉÁ´ØÂè£ÁöÑÂ∫îÁ≠îÊï∞ÊçÆÂåÖÔºåÂ∞ÜÂÖ∂‰ªñÂÖ•Á´ôÊï∞ÊçÆÂåÖÂùá‰∫à‰ª•‰∏¢ÂºÉÂ§ÑÁêÜ„ÄÇ1234iptables -I INPUT -p tcp -m multiport --dport 20,21,80 -j ACCEPT iptables -I INPUT -p tcp --dport 20450:20480 -j ACCEPT iptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT iptables -P INPUT DROP ‰∏ãÈù¢‰∏§Âè•ËØùÂèØ‰ª•ÂÆö‰πâÈªòËÆ§ÂÖ®ÈÉ®‰∏¢ÂºÉÊï∞ÊçÆÂåÖÔºö12iptables -P INPUT DROPiptables -P OUTPUT DROP -PÂèÇÊï∞ÁöÑÊÑèÊÄùÊòØpolicyÔºåÁøªËØëÊàêÁ≠ñÁï•ÔΩûÈÇ£‰πàËøô‰∏§Âè•ËØùÂ∞±Â•ΩÁêÜËß£‰∫Ü„ÄÇ Á¨¨‰∏ÄÂè•ÁöÑÊÑèÊÄùÊòØÔºö ËæìÂÖ•(INPUT)ÁöÑÊï∞ÊçÆÂåÖÈªòËÆ§ÁöÑÁ≠ñÁï•(-P)ÊòØ‰∏¢ÂºÉ(DROP)ÁöÑ Á¨¨‰∫åÂè•ÁöÑÊÑèÊÄùÊòØÔºö ËæìÂá∫(OUTPUT)ÁöÑÊï∞ÊçÆÂåÖÈªòËÆ§ÁöÑÁ≠ñÁï•(-P)ÊòØ‰∏¢ÂºÉ(DROP)ÁöÑ ÂÖ∂ÂÆûÂà∞ËøôÈáåÂ∑≤ÁªèÊòØ‰∏Ä‰∏™ÊúâÁî®ÁöÑÈò≤ÁÅ´Â¢ô‰∫ÜÔºåÂè™‰∏çËøáÔºåÊ≤°Êúâ‰ªÄ‰πàÊÑè‰πâÔºåÂíåÊãîÊéâÁΩëÁ∫øÁöÑÊ¶ÇÂøµÊ≤°Êúâ‰ªÄ‰πà‰∏çÂêå È¶ñÂÖàÂÜô‰∏ãËøô6Âè•ËØù123456789101112iptables -A INPUT -p icmp --icmp-type any -j ACCEPTÂÖÅËÆ∏icmpÂåÖËøõÂÖ•iptables -A INPUT -s localhost -d localhost -j ACCEPTÂÖÅËÆ∏Êú¨Âú∞ÁöÑÊï∞ÊçÆÂåÖiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPTÂÖÅËÆ∏Â∑≤ÁªèÂª∫Á´ãÂíåÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂåÖËøõÂÖ•iptables -A OUTPUT -p icmp --icmp any -j ACCEPTÂÖÅËÆ∏icmpÂåÖÂá∫Âéªiptables -A OUTPUT -s localhost -d localhost -j ACCEPTÂÖÅËÆ∏Êú¨Âú∞Êï∞ÊçÆÂåÖiptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPTÂÖÅËÆ∏Â∑≤ÁªèÂª∫Á´ãÂíåÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂåÖÂá∫Âéª ËØ¥Êòé‰∏Ä‰∏ãÔºåËøô6Âè•Âü∫Êú¨‰∏äÈÉΩÊòØË¶ÅÁöÑ Êü•ÁúãnatË°®1234iptables -t nat -vnL POSTROUTING --line-number Chain POSTROUTING (policy ACCEPT 38 packets, 2297 bytes) num pkts bytes target prot opt in out source destination 1 0 0 MASQUERADE all -- * * 192.168.10.0/24 0.0.0.0/0 Êü•ÁúãfilterË°®12iptables -L -n --line-number |grep 21 //--line-numberÂèØ‰ª•ÊòæÁ§∫ËßÑÂàôÂ∫èÂè∑ÔºåÂú®Âà†Èô§ÁöÑÊó∂ÂÄôÊØîËæÉÊñπ‰æø 5 ACCEPT tcp -- 192.168.1.0/24 0.0.0.0/0 tcp dpt:21 ÊÄªÁªìÈôÑÊúÄÁªèÂÖ∏ÁöÑiptablesËÑöÊú¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#!/bin/sh#modprobe ipt_MASQUERADEmodprobe ip_conntrack_ftpmodprobe ip_nat_ftpiptables -Fiptables -t nat -Fiptables -Xiptables -t nat -X###########################INPUTÈîÆ###################################iptables -P INPUT DROPiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPTiptables -A INPUT -p tcp -m multiport --dports 110,80,25 -j ACCEPTiptables -A INPUT -p tcp -s 192.168.0.0/24 --dport 139 -j ACCEPT#ÂÖÅËÆ∏ÂÜÖÁΩësamba,smtp,pop3,ËøûÊé•iptables -A INPUT -i eth1 -p udp -m multiport --dports 53 -j ACCEPT#ÂÖÅËÆ∏dnsËøûÊé•iptables -A INPUT -p tcp --dport 1723 -j ACCEPTiptables -A INPUT -p gre -j ACCEPT#ÂÖÅËÆ∏Â§ñÁΩëvpnËøûÊé•iptables -A INPUT -s 192.186.0.0/24 -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPTiptables -A INPUT -i ppp0 -p tcp --syn -m connlimit --connlimit-above 15 -j DROP#‰∏∫‰∫ÜÈò≤Ê≠¢DOSÂ§™Â§öËøûÊé•ËøõÊù•,ÈÇ£‰πàÂèØ‰ª•ÂÖÅËÆ∏ÊúÄÂ§ö15‰∏™ÂàùÂßãËøûÊé•,Ë∂ÖËøáÁöÑ‰∏¢ÂºÉiptables -A INPUT -s 192.186.0.0/24 -p tcp --syn -m connlimit --connlimit-above 15 -j DROP#‰∏∫‰∫ÜÈò≤Ê≠¢DOSÂ§™Â§öËøûÊé•ËøõÊù•,ÈÇ£‰πàÂèØ‰ª•ÂÖÅËÆ∏ÊúÄÂ§ö15‰∏™ÂàùÂßãËøûÊé•,Ë∂ÖËøáÁöÑ‰∏¢ÂºÉiptables -A INPUT -p icmp -m limit --limit 3/s -j LOG --log-level INFO --log-prefix "ICMP packet IN: "iptables -A INPUT -p icmp -j DROP#Á¶ÅÊ≠¢icmpÈÄö‰ø°-ping ‰∏çÈÄöiptables -t nat -A POSTROUTING -o ppp0 -s 192.168.0.0/24 -j MASQUERADE#ÂÜÖÁΩëËΩ¨Âèëiptables -N syn-floodiptables -A INPUT -p tcp --syn -j syn-floodiptables -I syn-flood -p tcp -m limit --limit 3/s --limit-burst 6 -j RETURNiptables -A syn-flood -j REJECT#Èò≤Ê≠¢SYNÊîªÂáª ËΩªÈáè#######################FORWARDÈìæ###########################iptables -P FORWARD DROPiptables -A FORWARD -p tcp -s 192.168.0.0/24 -m multiport --dports 80,110,21,25,1723 -j ACCEPTiptables -A FORWARD -p udp -s 192.168.0.0/24 --dport 53 -j ACCEPTiptables -A FORWARD -p gre -s 192.168.0.0/24 -j ACCEPTiptables -A FORWARD -p icmp -s 192.168.0.0/24 -j ACCEPT#ÂÖÅËÆ∏ vpnÂÆ¢Êà∑Ëµ∞vpnÁΩëÁªúËøûÊé•Â§ñÁΩëiptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPTiptables -I FORWARD -p udp --dport 53 -m string --string "tencent" -m time --timestart 8:15 --timestop 12:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROP#ÊòüÊúü‰∏ÄÂà∞ÊòüÊúüÂÖ≠ÁöÑ8:00-12:30Á¶ÅÊ≠¢qqÈÄö‰ø°iptables -I FORWARD -p udp --dport 53 -m string --string "TENCENT" -m time --timestart 8:15 --timestop 12:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROP#ÊòüÊúü‰∏ÄÂà∞ÊòüÊúüÂÖ≠ÁöÑ8:00-12:30Á¶ÅÊ≠¢qqÈÄö‰ø°iptables -I FORWARD -p udp --dport 53 -m string --string "tencent" -m time --timestart 13:30 --timestop 20:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROPiptables -I FORWARD -p udp --dport 53 -m string --string "TENCENT" -m time --timestart 13:30 --timestop 20:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROP#ÊòüÊúü‰∏ÄÂà∞ÊòüÊúüÂÖ≠ÁöÑ13:30-20:30Á¶ÅÊ≠¢QQÈÄö‰ø°iptables -I FORWARD -s 192.168.0.0/24 -m string --string "qq.com" -m time --timestart 8:15 --timestop 12:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROP#ÊòüÊúü‰∏ÄÂà∞ÊòüÊúüÂÖ≠ÁöÑ8:00-12:30Á¶ÅÊ≠¢qqÁΩëÈ°µiptables -I FORWARD -s 192.168.0.0/24 -m string --string "qq.com" -m time --timestart 13:00 --timestop 20:30 --days Mon,Tue,Wed,Thu,Fri,Sat -j DROP#ÊòüÊúü‰∏ÄÂà∞ÊòüÊúüÂÖ≠ÁöÑ13:30-20:30Á¶ÅÊ≠¢QQÁΩëÈ°µiptables -I FORWARD -s 192.168.0.0/24 -m string --string "ay2000.net" -j DROPiptables -I FORWARD -d 192.168.0.0/24 -m string --string "ÂÆΩÈ¢ëÂΩ±Èô¢" -j DROPiptables -I FORWARD -s 192.168.0.0/24 -m string --string "Ëâ≤ÊÉÖ" -j DROPiptables -I FORWARD -p tcp --sport 80 -m string --string "ÂπøÂëä" -j DROP#Á¶ÅÊ≠¢ay2000.netÔºåÂÆΩÈ¢ëÂΩ±Èô¢ÔºåËâ≤ÊÉÖÔºåÂπøÂëäÁΩëÈ°µËøûÊé• ÔºÅ‰ΩÜ‰∏≠Êñá ‰∏çÊòØÂæàÁêÜÊÉ≥iptables -A FORWARD -m ipp2p --edk --kazaa --bit -j DROPiptables -A FORWARD -p tcp -m ipp2p --ares -j DROPiptables -A FORWARD -p udp -m ipp2p --kazaa -j DROP#Á¶ÅÊ≠¢BTËøûÊé•iptables -A FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 15 --connlimit-mask 24#######################################################################sysctl -w net.ipv4.ip_forward=1 &>/dev/null#ÊâìÂºÄËΩ¨Âèë#######################################################################sysctl -w net.ipv4.tcp_syncookies=1 &>/dev/null#ÊâìÂºÄ syncookie ÔºàËΩªÈáèÁ∫ßÈ¢ÑÈò≤ DOS ÊîªÂáªÔºâsysctl -w net.ipv4.netfilter.ip_conntrack_tcp_timeout_established=3800 &>/dev/null#ËÆæÁΩÆÈªòËÆ§ TCP ËøûÊé•Áó¥ÂëÜÊó∂Èïø‰∏∫ 3800 ÁßíÔºàÊ≠§ÈÄâÈ°πÂèØ‰ª•Â§ßÂ§ßÈôç‰ΩéËøûÊé•Êï∞Ôºâsysctl -w net.ipv4.ip_conntrack_max=300000 &>/dev/null#ËÆæÁΩÆÊîØÊåÅÊúÄÂ§ßËøûÊé•Ê†ë‰∏∫ 30WÔºàËøô‰∏™Ê†πÊçÆ‰Ω†ÁöÑÂÜÖÂ≠òÂíå iptables ÁâàÊú¨Êù•ÔºåÊØè‰∏™ connection ÈúÄË¶Å 300 Â§ö‰∏™Â≠óËäÇÔºâ#######################################################################iptables -I INPUT -s 192.168.0.50 -j ACCEPTiptables -I FORWARD -s 192.168.0.50 -j ACCEPT#192.168.0.50ÊòØÊàëÁöÑÊú∫Â≠êÔºåÂÖ®ÈÉ®ÊîæË°åÔºÅ############################ÂÆå######################################### document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux awk ÂëΩ‰ª§]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-awk%2F</url>
    <content type="text"><![CDATA[ÂØπ‰ªäÂ§©Ëß£ÂÜ≥‰∏ç‰∫ÜÁöÑ‰∫ãÊÉÖÔºå‰πü‰∏çË¶ÅÁùÄÊÄ•„ÄÇÂõ†‰∏∫ÊòéÂ§©‰πüÂèØËÉΩËøòÊòØËß£ÂÜ≥‰∏ç‰∫Ü„ÄÇ awkÂëΩ‰ª§‰æãÂ≠êÔºö123456ÊâìÂç∞Êñá‰ª∂ÁöÑÁ¨¨‰∏ÄÂàó(Âüü) awk '{print $1}' filenameÊâìÂç∞Êñá‰ª∂ÁöÑÂâç‰∏§Âàó(Âüü) awk '{print $1,$2}' filenameÊâìÂç∞ÂÆåÁ¨¨‰∏ÄÂàóÔºåÁÑ∂ÂêéÊâìÂç∞Á¨¨‰∫åÂàó awk '{print $1 $2}' filenameÊâìÂç∞ÊñáÊú¨Êñá‰ª∂ÁöÑÊÄªË°åÊï∞ awk 'END{print NR}' filenameÊâìÂç∞ÊñáÊú¨Á¨¨‰∏ÄË°å awk 'NR==1{print}' filenameÊâìÂç∞ÊñáÊú¨Á¨¨‰∫åË°åÁ¨¨‰∏ÄÂàó sed -n "2, 1p" filename | awk 'print $1' BashÈáåÈù¢ÁöÑËµãÂÄºÊñπÊ≥ïÊúâ‰∏§ÁßçÔºåÊ†ºÂºè‰∏∫121) arg=`(ÂëΩ‰ª§)`2) arg=$(ÂëΩ‰ª§) ÊÉ≥Ë¶ÅÊääÊüê‰∏ÄÊñá‰ª∂ÁöÑÊÄªË°åÊï∞ËµãÂÄºÁªôÂèòÈáènlinesÔºåÂèØ‰ª•Ë°®Ëææ‰∏∫Ôºö1231) nlines=`(awk 'END{print NR}' filename)`Êàñ2) nlines=$(awk 'END{print NR}' filename) 123456awk '/[^0-9][0-9].*Starting the backup operation/{print $1,$2}' /data/backup/logs/all.log#181217 02:12:48#181217 02:12:48 innobackupex: Starting the backup operationawk '/[^0-9][0-9].*OK\!/{print $1,$2}' /data/backup/logs/all.log#181217 03:51:21#181217 03:51:21 completed OK! Êó∂Èó¥Áõ∏Âáè1awk 'BEGIN{tstamp1=mktime("2108 12 18 02 12 48");tstamp2=mktime("2018 12 19 03 51 12");print tstamp2-tstamp1;}' ‰ªéÂ∫ìÂë®ÊúüÊÄßÂª∂Ëøü ÈúÄË¶Å‰Ω†‰ªébinlog‰∏≠ÊâæÂá∫Êâæ‰∏™binlog ÂêÑÁßçÊìç‰ΩúÁöÑÁªüËÆ°1mysqlbinlog --no-defaults --base64-output='decode-rows' -v -v mysql-bin.004177 | awk '/UPDATE|INSERT|DELETE/{gsub("###","");gsub("INSERT.*INTO","INSERT");gsub("DELETE.*FROM","DELETE");count[$1" "$2]++}END{for(i in count)print i,"\t",count[i]}' |sort -k3nr|head -n 20 netstat and AWK123456789netstat -an | awk '/^tcp/ {++S[$NF]};END {for(a in S) print a,S[a]}'netstat -an | awk '/^tcp/ {++state[$NF]}; END {for(key in state) print key,"\t",state[key]}'netstat -ant | awk '{print $NF}' | grep -v '[a-z]' | sort | uniq -cnetstat -anlp | grep 3306 | grep tcp | awk '{print $5}' | awk -F: '{print $1}' | sort | uniq -c | sort -nr | head -n20netstat -ant | awk '/:3306/{split($5,ip,":");++A[ip[1]]}END{for(i in A) print A[i],i}' | sort -nr | head -n20netstat -an | grep SYN | awk '{print $5}' | awk -F: '{print $1}' | sort | uniq -c | sort -nr | moretcpdump -i eno16777736 -tnn dst port 80 -c 1000 | awk -F"." '{print $1"."$2"."$3"."$4}' | sort | uniq -c | sort -nr | head -20 Êü•ÁúãË°®ÁöÑÂ§ßÂ∞èÊéíÂ∫è12du -s *|grep ibd|sort|uniq -u|sort -nr|awk '{print $2}'|xargs du -shdu -s *|grep ibd|sort|uniq -u|sort -nr|awk '{print $2}'|sort|uniq -u|xargs du -sh ÂÉµÂ∞∏ËøõÁ®ã1ps -A -o stat,ppid,pid,cmd | grep -e '\''^[Zz]'\'' | awk '\''{print }'\'' | xargs kill -9' document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰ΩøÁî®FIOÊµãËØï‰∏ªÊú∫IOPSÂèäÂÜôÂÖ•ËØªÂèñÈÄüÂ∫¶]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-fio%2F</url>
    <content type="text"><![CDATA[Âà´ËØ¥‰Ω†‰∏ÄÊó†ÊâÄÈïøÔºåÁÜ¨Â§úÁé©ÊâãÊú∫‰Ω†ÊòØ‰∏ÄÊääÂ•ΩÊâã„ÄÇ ÂâçË®ÄÂÆâË£ÖFIO1yum install fio -y ÂèÇÊï∞ËØ¥Êòé:1234567891011bs=4k ÂçïÊ¨°ioÁöÑÂùóÊñá‰ª∂Â§ßÂ∞è‰∏∫4kbsrange=512-2048 Âêå‰∏äÔºåÊèêÂÆöÊï∞ÊçÆÂùóÁöÑÂ§ßÂ∞èËåÉÂõ¥size=5g Êú¨Ê¨°ÁöÑÊµãËØïÊñá‰ª∂Â§ßÂ∞è‰∏∫5gÔºå‰ª•ÊØèÊ¨°4kÁöÑioËøõË°åÊµãËØïnumjobs=30 Êú¨Ê¨°ÁöÑÊµãËØïÁ∫øÁ®ã‰∏∫30runtime=1000 ÊµãËØïÊó∂Èó¥‰∏∫1000ÁßíÔºåÂ¶ÇÊûú‰∏çÂÜôÂàô‰∏ÄÁõ¥Â∞Ü5gÊñá‰ª∂ÂàÜ4kÊØèÊ¨°ÂÜôÂÆå‰∏∫Ê≠¢ioengine=psync ioÂºïÊìé‰ΩøÁî®pyncÊñπÂºèÔºåÂ¶ÇÊûúË¶Å‰ΩøÁî®libaioÂºïÊìéÔºåÈúÄË¶Åyum install libaio-develÂåÖrwmixwrite=30 Âú®Ê∑∑ÂêàËØªÂÜôÁöÑÊ®°Âºè‰∏ãÔºåÂÜôÂç†30%group_reporting ÂÖ≥‰∫éÊòæÁ§∫ÁªìÊûúÁöÑÔºåÊ±áÊÄªÊØè‰∏™ËøõÁ®ãÁöÑ‰ø°ÊÅØÊ≠§Â§ñlockmem=1g Âè™‰ΩøÁî®1gÂÜÖÂ≠òËøõË°åÊµãËØïzero_buffers Áî®0ÂàùÂßãÂåñÁ≥ªÁªübuffernrfiles=8 ÊØè‰∏™ËøõÁ®ãÁîüÊàêÊñá‰ª∂ÁöÑÊï∞Èáè FIO ÂëΩ‰ª§12345678910111213141516171819202122232425262728293031323334fio -direct=1 -iodepth=128 -rw=write -ioengine=libaio -bs=4k -size=100G -numjobs=1 -runtime=1000 -group_reporting -name=test -filename=/data/test111ËøêË°åÁªìÊûúÔºötest: (g=0): rw=write, bs=4K-4K/4K-4K/4K-4K, ioengine=libaio, iodepth=128fio-2.0.13Starting 1 processtest: Laying out IO file(s) (1 file(s) / 102400MB)Jobs: 1 (f=1): [W] [100.0% done] [0K/129.3M/0K /s] [0 /33.1K/0 iops] [eta 00m:00s]test: (groupid=0, jobs=1): err= 0: pid=594: Mon May 14 10:27:54 2018 write: io=102400MB, bw=129763KB/s, iops=32440 , runt=808070msec slat (usec): min=0 , max=80322 , avg=12.06, stdev=24.73 clat (usec): min=222 , max=254410 , avg=3932.47, stdev=5007.90 lat (usec): min=622 , max=254416 , avg=3944.82, stdev=5007.26 clat percentiles (usec): | 1.00th=[ 1288], 5.00th=[ 1560], 10.00th=[ 1736], 20.00th=[ 1992], | 30.00th=[ 2224], 40.00th=[ 2480], 50.00th=[ 2736], 60.00th=[ 3088], | 70.00th=[ 3536], 80.00th=[ 4320], 90.00th=[ 6624], 95.00th=[ 9664], | 99.00th=[21120], 99.50th=[37632], 99.90th=[54528], 99.95th=[78336], | 99.99th=[177152] bw (KB/s) : min=20720, max=215424, per=100.00%, avg=129801.50, stdev=19878.75 lat (usec) : 250=0.01%, 750=0.01%, 1000=0.09% lat (msec) : 2=20.47%, 4=56.01%, 10=18.78%, 20=3.20%, 50=1.33% lat (msec) : 100=0.09%, 250=0.02%, 500=0.01% cpu : usr=4.88%, sys=36.64%, ctx=9409837, majf=0, minf=23 IO depths : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, >=64=100.0% submit : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% complete : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.1% issued : total=r=0/w=26214400/d=0, short=r=0/w=0/d=0Run status group 0 (all jobs): WRITE: io=102400MB, aggrb=129763KB/s, minb=129763KB/s, maxb=129763KB/s, mint=808070msec, maxt=808070msecDisk stats (read/write): vdb: ios=0/26203032, merge=0/3962, ticks=0/90681446, in_queue=90672667, util=100.00% 100%ÈöèÊú∫Ôºå100%ËØªÔºå4K12345678910111213141516171819202122232425262728293031323334353637383940414243444546fio -filename=/dev/vdb1 -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=4k -size=100G -numjobs=50 -runtime=180 -group_reporting -name=rand_100read_4kËøêË°åÁªìÊûúÔºörand_100read_4k: (g=0): rw=randread, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1...rand_100read_4k: (g=0): rw=randread, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1fio-2.0.13Starting 50 threadsJobs: 50 (f=50): [rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr] [100.0% done] [47544K/0K/0K /s] [11.9K/0 /0 iops] [eta 00m:00s]rand_100read_4k: (groupid=0, jobs=50): err= 0: pid=25884: Mon May 14 14:59:44 2018 read : io=8454.3MB, bw=48091KB/s, iops=12022 , runt=180018msec clat (usec): min=318 , max=167471 , avg=4156.60, stdev=8363.94 lat (usec): min=318 , max=167472 , avg=4156.89, stdev=8363.95 clat percentiles (usec): | 1.00th=[ 1032], 5.00th=[ 1176], 10.00th=[ 1240], 20.00th=[ 1352], | 30.00th=[ 1464], 40.00th=[ 1688], 50.00th=[ 1832], 60.00th=[ 1944], | 70.00th=[ 2064], 80.00th=[ 2288], 90.00th=[15808], 95.00th=[18560], | 99.00th=[20608], 99.50th=[39168], 99.90th=[134144], 99.95th=[144384], | 99.99th=[156672] bw (KB/s) : min= 231, max= 7248, per=2.00%, avg=961.78, stdev=384.46 lat (usec) : 500=0.05%, 750=0.20%, 1000=0.51% lat (msec) : 2=64.37%, 4=19.62%, 10=2.88%, 20=10.62%, 50=1.52% lat (msec) : 100=0.02%, 250=0.23% cpu : usr=0.00%, sys=0.02%, ctx=1813752, majf=18446744073709550866, minf=18446744073698419008 IO depths : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0% submit : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% complete : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% issued : total=r=2164296/w=0/d=0, short=r=0/w=0/d=0Run status group 0 (all jobs): READ: io=8454.3MB, aggrb=48090KB/s, minb=48090KB/s, maxb=48090KB/s, mint=180018msec, maxt=180018msecDisk stats (read/write): vdb: ios=2163559/42, merge=23/10, ticks=8925036/223, in_queue=8922540, util=99.94%100%ÈöèÊú∫Ôºå100%ÂÜôÔºå 4K[root@test-db data]# fio -filename=/dev/vdb1 -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=4k -size=100G -numjobs=50 -runtime=180 -group_reporting -name=rand_100write_4kËøêË°åÁªìÊûúÔºörand_100write_4k: (g=0): rw=randwrite, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1...rand_100write_4k: (g=0): rw=randwrite, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1fio-2.0.13Starting 50 threadsJobs: 50 (f=50): [wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww] [100.0% done] [0K/47996K/0K /s] [0 /11.1K/0 iops] [eta 00m:00s]rand_100write_4k: (groupid=0, jobs=50): err= 0: pid=25963: Mon May 14 15:08:43 2018 write: io=8445.5MB, bw=48039KB/s, iops=12009 , runt=180024msec 100%È°∫Â∫èÔºå100%ËØª Ôºå4K1234567891011121314151617181920212223242526272829303132fio -filename=/dev/vdb1 -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=4k -size=100G -numjobs=50 -runtime=180 -group_reporting -name=sqe_100read_4kËøêË°åÁªìÊûúÔºösqe_100read_4k: (g=0): rw=read, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1fio-2.0.13Starting 50 threadsJobs: 50 (f=50): [RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR] [100.0% done] [59996K/0K/0K /s] [14.1K/0 /0 iops] [eta 00m:00s]sqe_100read_4k: (groupid=0, jobs=50): err= 0: pid=26047: Mon May 14 15:13:02 2018 read : io=10599MB, bw=60295KB/s, iops=15073 , runt=180006msec clat (usec): min=253 , max=550591 , avg=3315.70, stdev=26406.30 lat (usec): min=254 , max=550591 , avg=3315.95, stdev=26406.30 clat percentiles (usec): | 1.00th=[ 1176], 5.00th=[ 1240], 10.00th=[ 1256], 20.00th=[ 1288], | 30.00th=[ 1336], 40.00th=[ 1368], 50.00th=[ 1416], 60.00th=[ 1480], | 70.00th=[ 1528], 80.00th=[ 1592], 90.00th=[ 1736], 95.00th=[ 2800], | 99.00th=[17792], 99.50th=[18816], 99.90th=[522240], 99.95th=[528384], | 99.99th=[536576] bw (KB/s) : min= 15, max= 2475, per=2.00%, avg=1206.47, stdev=634.32 lat (usec) : 500=0.01%, 750=0.01%, 1000=0.04% lat (msec) : 2=92.64%, 4=3.87%, 10=1.05%, 20=2.03%, 50=0.01% lat (msec) : 250=0.01%, 500=0.17%, 750=0.15% cpu : usr=0.05%, sys=0.23%, ctx=2697397, majf=0, minf=18446744073708900853 IO depths : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0% submit : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% complete : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% issued : total=r=2713362/w=0/d=0, short=r=0/w=0/d=0Run status group 0 (all jobs): READ: io=10599MB, aggrb=60294KB/s, minb=60294KB/s, maxb=60294KB/s, mint=180006msec, maxt=180006msecDisk stats (read/write): vdb: ios=2711304/55, merge=1805/10, ticks=8899022/202, in_queue=8898860, util=100.00% 100%È°∫Â∫èÔºå100%ÂÜô Ôºå4K12345678910111213141516171819202122232425262728293031323334fio -filename=/dev/vdb1 -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=4k -size=100G -numjobs=50 -runtime=180 -group_reporting -name=sqe_100write_4kËøêË°åÁªìÊûúÔºösqe_100write_4k: (g=0): rw=write, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1...sqe_100write_4k: (g=0): rw=write, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1fio-2.0.13Starting 50 threadsJobs: 50 (f=50): [WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW] [100.0% done] [0K/55788K/0K /s] [0 /13.1K/0 iops] [eta 00m:00s]sqe_100write_4k: (groupid=0, jobs=50): err= 0: pid=26100: Mon May 14 15:17:24 2018 write: io=10002MB, bw=56896KB/s, iops=14224 , runt=180019msec clat (usec): min=583 , max=457330 , avg=3513.01, stdev=9958.13 lat (usec): min=584 , max=457331 , avg=3513.60, stdev=9958.13 clat percentiles (usec): | 1.00th=[ 1224], 5.00th=[ 1384], 10.00th=[ 1480], 20.00th=[ 1592], | 30.00th=[ 1672], 40.00th=[ 1752], 50.00th=[ 1832], 60.00th=[ 1928], | 70.00th=[ 2096], 80.00th=[ 2480], 90.00th=[ 6368], 95.00th=[12480], | 99.00th=[20608], 99.50th=[37120], 99.90th=[166912], 99.95th=[268288], | 99.99th=[346112] bw (KB/s) : min= 152, max= 2432, per=2.01%, avg=1141.03, stdev=401.10 lat (usec) : 750=0.01%, 1000=0.11% lat (msec) : 2=65.06%, 4=21.62%, 10=7.36%, 20=4.40%, 50=1.24% lat (msec) : 100=0.08%, 250=0.06%, 500=0.07% cpu : usr=0.05%, sys=0.38%, ctx=2547790, majf=0, minf=18446744073708899536 IO depths : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0% submit : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% complete : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% issued : total=r=0/w=2560604/d=0, short=r=0/w=0/d=0Run status group 0 (all jobs): WRITE: io=10002MB, aggrb=56896KB/s, minb=56896KB/s, maxb=56896KB/s, mint=180019msec, maxt=180019msecDisk stats (read/write): vdb: ios=63/2558949, merge=0/275, ticks=12/8897256, in_queue=8895411, util=100.00% 100%ÈöèÊú∫Ôºå70%ËØªÔºå30%ÂÜô 4K123456789101112131415161718192021222324252627282930313233343536373839404142434445fio -filename=/dev/vdb1 -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=4k -size=100G -numjobs=50 -runtime=180 -group_reporting -name=randrw_70read_4kËøêË°åÁªìÊûúÔºörandrw_70read_4k: (g=0): rw=randrw, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1...randrw_70read_4k: (g=0): rw=randrw, bs=4K-4K/4K-4K/4K-4K, ioengine=psync, iodepth=1fio-2.0.13Starting 50 threadsJobs: 50 (f=50): [mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm] [100.0% done] [48012K/20800K/0K /s] [12.3K/5200 /0 iops] [eta 00m:00s]randrw_70read_4k: (groupid=0, jobs=50): err= 0: pid=26162: Mon May 14 15:29:18 2018 read : io=8430.4MB, bw=47954KB/s, iops=11988 , runt=180020msec clat (usec): min=304 , max=177969 , avg=3045.60, stdev=5103.08 lat (usec): min=304 , max=177970 , avg=3045.87, stdev=5103.08 clat percentiles (usec): | 1.00th=[ 860], 5.00th=[ 1048], 10.00th=[ 1160], 20.00th=[ 1320], | 30.00th=[ 1448], 40.00th=[ 1560], 50.00th=[ 1656], 60.00th=[ 1768], | 70.00th=[ 1896], 80.00th=[ 2128], 90.00th=[ 4384], 95.00th=[17792], | 99.00th=[20352], 99.50th=[28544], 99.90th=[41216], 99.95th=[57088], | 99.99th=[127488] bw (KB/s) : min= 206, max= 4424, per=2.00%, avg=959.77, stdev=408.18 write: io=3613.8MB, bw=20556KB/s, iops=5138 , runt=180020msec clat (usec): min=569 , max=157336 , avg=2617.23, stdev=2821.20 lat (usec): min=570 , max=157337 , avg=2617.81, stdev=2821.20 clat percentiles (usec): | 1.00th=[ 1096], 5.00th=[ 1432], 10.00th=[ 1592], 20.00th=[ 1768], | 30.00th=[ 1912], 40.00th=[ 2040], 50.00th=[ 2160], 60.00th=[ 2288], | 70.00th=[ 2416], 80.00th=[ 2576], 90.00th=[ 2864], 95.00th=[ 3472], | 99.00th=[19328], 99.50th=[20352], 99.90th=[22400], 99.95th=[37632], | 99.99th=[52992] bw (KB/s) : min= 62, max= 1888, per=2.00%, avg=411.23, stdev=178.61 lat (usec) : 500=0.06%, 750=0.22%, 1000=2.28% lat (msec) : 2=61.13%, 4=27.68%, 10=3.02%, 20=4.48%, 50=1.07% lat (msec) : 100=0.04%, 250=0.01% cpu : usr=0.01%, sys=0.08%, ctx=2743663, majf=0, minf=18446744073698904078 IO depths : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0% submit : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% complete : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0% issued : total=r=2158165/w=925122/d=0, short=r=0/w=0/d=0Run status group 0 (all jobs): READ: io=8430.4MB, aggrb=47953KB/s, minb=47953KB/s, maxb=47953KB/s, mint=180020msec, maxt=180020msec WRITE: io=3613.8MB, aggrb=20555KB/s, minb=20555KB/s, maxb=20555KB/s, mint=180020msec, maxt=180020msecDisk stats (read/write): vdb: ios=2154562/923535, merge=0/0, ticks=6503566/2394699, in_queue=8896553, util=99.93% ÊÄªÁªìÊâßË°åÁªìÊûúËØ¥Êòé:123456789101112131415161718192021222324252627io=ÊâßË°å‰∫ÜÂ§öÂ∞ëMÁöÑIObw=Âπ≥ÂùáIOÂ∏¶ÂÆΩiops=IOPSrunt=Á∫øÁ®ãËøêË°åÊó∂Èó¥slat=Êèê‰∫§Âª∂Ëøüclat=ÂÆåÊàêÂª∂Ëøülat=ÂìçÂ∫îÊó∂Èó¥bw=Â∏¶ÂÆΩcpu=Âà©Áî®ÁéáIO depths=ioÈòüÂàóIO submit=Âçï‰∏™IOÊèê‰∫§Ë¶ÅÊèê‰∫§ÁöÑIOÊï∞IO complete=Like the above submit number, but for completions instead.IO issued=The number of read/write requests issued, and how many of them were short.IO latencies=IOÂÆåÂª∂ËøüÁöÑÂàÜÂ∏Éio=ÊÄªÂÖ±ÊâßË°å‰∫ÜÂ§öÂ∞ësizeÁöÑIOaggrb=groupÊÄªÂ∏¶ÂÆΩminb=ÊúÄÂ∞è.Âπ≥ÂùáÂ∏¶ÂÆΩ.maxb=ÊúÄÂ§ßÂπ≥ÂùáÂ∏¶ÂÆΩ.mint=group‰∏≠Á∫øÁ®ãÁöÑÊúÄÁü≠ËøêË°åÊó∂Èó¥.maxt=group‰∏≠Á∫øÁ®ãÁöÑÊúÄÈïøËøêË°åÊó∂Èó¥.ios=ÊâÄÊúâgroupÊÄªÂÖ±ÊâßË°åÁöÑIOÊï∞.merge=ÊÄªÂÖ±ÂèëÁîüÁöÑIOÂêàÂπ∂Êï∞.ticks=Number of ticks we kept the disk busy.io_queue=Ëä±Ë¥πÂú®ÈòüÂàó‰∏äÁöÑÊÄªÂÖ±Êó∂Èó¥.util=Á£ÅÁõòÂà©Áî®Áéá document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[curl Êù•ÊµãËØïÁΩëÁ´ô-dnsËß£ÊûêÊó∂Èó¥,ÂìçÂ∫îÊó∂Èó¥,‰º†ËæìÊó∂Èó¥]]></title>
    <url>%2F2019%2F04%2F22%2Fcurl-dns-time%2F</url>
    <content type="text"><![CDATA[Êúâ‰∫õ‰∫∫Âä™Âäõ‰∫Ü‰∏ÄËæàÂ≠êÔºå‰πüÂ∞±‰ªéÁ§æ‰ºöÁöÑÂõõÊµÅËøõÂÖ•‰∫Ü‰∏âÊµÅ„ÄÇ Ëé∑Âèñ Ëß£ÊûêÊó∂Èó¥:ÂìçÂ∫îÊó∂Èó¥:‰º†ËæìÊó∂Èó¥12test_dbs2 ~ # curl -o /dev/null -s -w %{time_connect}:%{time_starttransfer}:%{time_total} https://jiemin.wang 0.104:0.000:18.174 ÁªôÂá∫ÂØπÁ´ôÁÇπÊâßË°å curl ÂëΩ‰ª§ÁöÑÊÉÖÂÜµ.ËæìÂá∫ÈÄöÂ∏∏ÊòØ HTML ‰ª£Á†Å,ÈÄöËøá -o ÂèÇÊï∞ÂèëÈÄÅÂà∞ /dev/null. -s ÂèÇÊï∞ÂéªÊéâÊâÄÊúâÁä∂ÊÄÅ‰ø°ÊÅØ. -w ÂèÇÊï∞ËÆ© curl ÂÜôÂá∫ËÆ°Êó∂Âô®ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØ„ÄÇ ÂèÇÊï∞ËØ¥Êòé:12345time_connect Âª∫Á´ãÂà∞ÊúçÂä°Âô®ÁöÑ TCP ËøûÊé•ÊâÄÁî®ÁöÑÊó∂Èó¥time_starttransfer Âú®ÂèëÂá∫ËØ∑Ê±Ç‰πãÂêé,Web ÊúçÂä°Âô®ËøîÂõûÊï∞ÊçÆÁöÑÁ¨¨‰∏Ä‰∏™Â≠óËäÇÊâÄÁî®ÁöÑÊó∂Èó¥time_total ÂÆåÊàêËØ∑Ê±ÇÊâÄÁî®ÁöÑÊó∂Èó¥time_namelookup DNSËß£ÊûêÊó∂Èó¥,‰ªéËØ∑Ê±ÇÂºÄÂßãÂà∞DNSËß£ÊûêÂÆåÊØïÊâÄÁî®Êó∂Èó¥(ËÆ∞ÂæóÂÖ≥Êéâ Linux ÁöÑ nscd ÁöÑÊúçÂä°ÊµãËØï)speed_download ‰∏ãËΩΩÈÄüÂ∫¶ÔºåÂçï‰Ωç-Â≠óËäÇÊØèÁßí„ÄÇ Ëøô‰∫õËÆ°Êó∂Âô®ÈÉΩÁõ∏ÂØπ‰∫é‰∫ãÂä°ÁöÑËµ∑ÂßãÊó∂Èó¥,ÁîöËá≥Ë¶ÅÂÖà‰∫é Domain Name ServiceÔºàDNSÔºâÊü•ËØ¢.Âõ†Ê≠§,Âú®ÂèëÂá∫ËØ∑Ê±Ç‰πãÂêé,Web ÊúçÂä°Âô®Â§ÑÁêÜËØ∑Ê±ÇÂπ∂ÂºÄÂßãÂèëÂõûÊï∞ÊçÆÊâÄÁî®ÁöÑÊó∂Èó¥ÊòØ 0.000 - 0.104 = 0 Áßí.ÂÆ¢Êà∑Êú∫‰ªéÊúçÂä°Âô®‰∏ãËΩΩÊï∞ÊçÆÊâÄÁî®ÁöÑÊó∂Èó¥ÊòØ 18.174 - 0.000 = 18 Áßí. ÈÄöËøáËßÇÂØü curl Êï∞ÊçÆÂèäÂÖ∂ÈöèÊó∂Èó¥ÂèòÂåñÁöÑË∂ãÂäø,ÂèØ‰ª•ÂæàÂ•ΩÂú∞‰∫ÜËß£Á´ôÁÇπÂØπÁî®Êà∑ÁöÑÂìçÂ∫îÊÄß.‰ª•‰∏äÂèòÈáè‰ºöÊåâCURLËÆ§‰∏∫ÂêàÈÄÇÁöÑÊ†ºÂºèËæìÂá∫ÔºåËæìÂá∫ÂèòÈáèÈúÄË¶ÅÊåâÁÖß%{variable_name}ÁöÑÊ†ºÂºèÔºåÂ¶ÇÊûúÈúÄË¶ÅËæìÂá∫%Ôºådouble‰∏Ä‰∏ãÂç≥ÂèØÔºåÂç≥%%ÔºåÂêåÊó∂ÔºånÊòØÊç¢Ë°åÔºårÊòØÂõûËΩ¶ÔºåtÊòØTAB„ÄÇ ÂΩìÁÑ∂,Web Á´ôÁÇπ‰∏ç‰ªÖ‰ªÖÁî±È°µÈù¢ÁªÑÊàê.ÂÆÉËøòÊúâÂõæÂÉè„ÄÅJavaScript ‰ª£Á†Å„ÄÅCSS Âíå cookie Ë¶ÅÂ§ÑÁêÜ.curl ÂæàÈÄÇÂêà‰∫ÜËß£Âçï‰∏ÄÂÖÉÁ¥†ÁöÑÂìçÂ∫îÊó∂Èó¥,‰ΩÜÊòØÊúâÊó∂ÂÄôÈúÄË¶Å‰∫ÜËß£Êï¥‰∏™È°µÈù¢ÁöÑË£ÖËΩΩÈÄüÂ∫¶. document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux-TIME-WAIT]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-TIME-WAIT%2F</url>
    <content type="text"><![CDATA[Ê≤°‰∫ãÂê¨Âê¨Âà´‰∫∫Âè£‰∏≠ÁöÑËá™Â∑±ÔºåËøôÊØîÁúãÂ§ßÁâáËøòÂà∫ÊøÄÔºå‰Ω†‰ºöÂèëÁé∞‰Ω†‰ªÄ‰πàÈÉΩÊ≤°ÂÅöÔºå‰ΩÜÂ∑≤ÁªèÊºî‰∫ÜÂ•ΩÂ§öÁâàÊú¨ÔºåÈÉΩÊòØÂ§ßËßíËâ≤„ÄÇ ÂâçË®ÄTIME_WAIT Áä∂ÊÄÅÂéüÁêÜÂΩìÂÆ¢Êà∑Á´Ø‰∏ªÂä®ÂÖ≥Èó≠ËøûÊé•Êó∂Ôºå‰ºöÂèëÈÄÅÊúÄÂêé‰∏Ä‰∏™ACKÔºåÁÑ∂Âêé‰ºöËøõÂÖ•TIME_WAITÁä∂ÊÄÅÔºåÂÜçÂÅúÁïô2‰∏™MSLÊó∂Èó¥(Á∫¶1-4ÂàÜÈíü)ÔºåËøõÂÖ•CLOSEDÁä∂ÊÄÅ„ÄÇ ËØ¶ÁªÜCentOS6/7.xÈªòËÆ§Ê≤°ÊúâÂØπÁ≥ªÁªüÂèÇÊï∞ËøõË°åËÆæÁΩÆÔºåÂΩìÂ§ßÈáèTIME_WAIT‰∫ßÁîüÁöÑÊó∂ÂÄô‰ºöÂΩ±ÂìçÁ≥ªÁªüÊÄßËÉΩÔºå ÁªüËÆ°TIME_WAITÁä∂ÊÄÅÊï∞Èáè1netstat -ano | grep TIME_WAIT | wc -l Êü•ÁúãÁ≥ªÁªüÂΩìÂâçËøûÊé•Áä∂ÊÄÅ1234567netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'TIME_WAIT 1280FIN_WAIT1 7SYN_SENT 1FIN_WAIT2 7ESTABLISHED 247LAST_ACK 1 Êàë‰ª¨Âè™Áî®ÂÖ≥ÂøÉTIME_WAITÁöÑ‰∏™Êï∞ÔºåÂú®ËøôÈáåÂèØ‰ª•ÁúãÂà∞ÔºåÊúâ1280Â§ö‰∏™TIME_WAITÔºåËøôÊ†∑Â∞±Âç†Áî®‰∫Ü1280Â§ö‰∏™Á´ØÂè£ÔºåÁ´ØÂè£ÁöÑÊï∞ÈáèÂè™Êúâ65535‰∏™ÔºåÂç†Áî®‰∏Ä‰∏™Â∞ë‰∏Ä‰∏™Ôºå‰ºö‰∏•ÈáçÁöÑÂΩ±ÂìçÂà∞ÂêéÁªßÁöÑÊñ∞ËøûÊé•ÔºåÂ∞±ÈúÄË∞ÉÊï¥‰∏ãLinuxÁöÑTCPÂÜÖÊ†∏ÂèÇÊï∞ÔºåËÆ©Á≥ªÁªüÊõ¥Âø´ÁöÑÈáäÊîæTIME_WAITËøûÊé•„ÄÇ Ëß£ÂÜ≥ÊñπÊ≥ïÂ¶Ç‰∏ãÔºö ‰øÆÊîπÂÜÖÊ†∏ÈÖçÁΩÆvim /etc/sysctl.conf ÔºåÂä†ÂÖ•‰ª•‰∏ãÂÜÖÂÆπÔºö1234net.ipv4.tcp_syncookies = 1 #Ë°®Á§∫ÂºÄÂêØSYN Cookies„ÄÇÂΩìÂá∫Áé∞SYNÁ≠âÂæÖÈòüÂàóÊ∫¢Âá∫Êó∂ÔºåÂêØÁî®cookiesÊù•Â§ÑÁêÜÔºåÂèØÈò≤ËåÉÂ∞ëÈáèSYNÊîªÂáªÔºåÈªòËÆ§‰∏∫0ÔºåË°®Á§∫ÂÖ≥Èó≠Ôºõnet.ipv4.tcp_tw_reuse = 1 #Ë°®Á§∫ÂºÄÂêØÈáçÁî®„ÄÇÂÖÅËÆ∏Â∞ÜTIME-WAIT socketsÈáçÊñ∞Áî®‰∫éÊñ∞ÁöÑTCPËøûÊé•ÔºåÈªòËÆ§‰∏∫0ÔºåË°®Á§∫ÂÖ≥Èó≠Ôºõnet.ipv4.tcp_tw_recycle = 1 #Ë°®Á§∫ÂºÄÂêØTCPËøûÊé•‰∏≠TIME-WAIT socketsÁöÑÂø´ÈÄüÂõûÊî∂ÔºåÈªòËÆ§‰∏∫0ÔºåË°®Á§∫ÂÖ≥Èó≠Ôºõnet.ipv4.tcp_fin_timeout = 30 #‰øÆÊîπÁ≥ªÁµ±ÈªòËÆ§ÁöÑ TIMEOUT Êó∂Èó¥„ÄÇ ÁÑ∂ÂêéÊâßË°å1/sbin/sysctl -p ËÆ©ÂèÇÊï∞ÁîüÊïà„ÄÇ ÂèÇÊï∞ËØ¥Êòé:1234567891011121314151617181920212223242526272829303132net.ipv4.tcp_keepalive_time = 1200 #Ë°®Á§∫ÂΩìkeepaliveËµ∑Áî®ÁöÑÊó∂ÂÄôÔºåTCPÂèëÈÄÅkeepaliveÊ∂àÊÅØÁöÑÈ¢ëÂ∫¶„ÄÇÁº∫ÁúÅÊòØ2Â∞èÊó∂ÔºåÊîπ‰∏∫20ÂàÜÈíü„ÄÇnet.ipv4.ip_local_port_range = 10000 65000 #Ë°®Á§∫Áî®‰∫éÂêëÂ§ñËøûÊé•ÁöÑÁ´ØÂè£ËåÉÂõ¥„ÄÇÁº∫ÁúÅÊÉÖÂÜµ‰∏ãÂæàÂ∞èÔºö32768Âà∞61000ÔºåÊîπ‰∏∫10000Âà∞65000„ÄÇÔºàÊ≥®ÊÑèÔºöËøôÈáå‰∏çË¶ÅÂ∞ÜÊúÄ‰ΩéÂÄºËÆæÁöÑÂ§™‰ΩéÔºåÂê¶ÂàôÂèØËÉΩ‰ºöÂç†Áî®ÊéâÊ≠£Â∏∏ÁöÑÁ´ØÂè£ÔºÅÔºânet.ipv4.tcp_max_syn_backlog = 8192 #Ë°®Á§∫SYNÈòüÂàóÁöÑÈïøÂ∫¶ÔºåÈªòËÆ§‰∏∫1024ÔºåÂä†Â§ßÈòüÂàóÈïøÂ∫¶‰∏∫8192ÔºåÂèØ‰ª•ÂÆπÁ∫≥Êõ¥Â§öÁ≠âÂæÖËøûÊé•ÁöÑÁΩëÁªúËøûÊé•Êï∞„ÄÇnet.ipv4.tcp_max_tw_buckets = 6000 #Ë°®Á§∫Á≥ªÁªüÂêåÊó∂‰øùÊåÅTIME_WAITÁöÑÊúÄÂ§ßÊï∞ÈáèÔºåÂ¶ÇÊûúË∂ÖËøáËøô‰∏™Êï∞Â≠óÔºåTIME_WAITÂ∞ÜÁ´ãÂàªË¢´Ê∏ÖÈô§Âπ∂ÊâìÂç∞Ë≠¶Âëä‰ø°ÊÅØ„ÄÇÈªòËÆ§180000ÔºåÊîπ‰∏∫6000„ÄÇÂØπ‰∫éApache„ÄÅNginxÁ≠âÊúçÂä°Âô®Ôºå‰∏äÂá†Ë°åÁöÑÂèÇÊï∞ÂèØ‰ª•ÂæàÂ•ΩÂú∞ÂáèÂ∞ëTIME_WAITÂ•óÊé•Â≠óÊï∞ÈáèÔºå‰ΩÜÊòØÂØπ‰∫é SquidÔºåÊïàÊûúÂç¥‰∏çÂ§ß„ÄÇÊ≠§È°πÂèÇÊï∞ÂèØ‰ª•ÊéßÂà∂TIME_WAITÁöÑÊúÄÂ§ßÊï∞ÈáèÔºåÈÅøÂÖçSquidÊúçÂä°Âô®Ë¢´Â§ßÈáèÁöÑTIME_WAITÊãñÊ≠ª„ÄÇÂÜÖÊ†∏ÂÖ∂‰ªñTCPÂèÇÊï∞ËØ¥ÊòéÔºönet.ipv4.tcp_max_syn_backlog = 65536 #ËÆ∞ÂΩïÁöÑÈÇ£‰∫õÂ∞öÊú™Êî∂Âà∞ÂÆ¢Êà∑Á´ØÁ°ÆËÆ§‰ø°ÊÅØÁöÑËøûÊé•ËØ∑Ê±ÇÁöÑÊúÄÂ§ßÂÄº„ÄÇÂØπ‰∫éÊúâ128MÂÜÖÂ≠òÁöÑÁ≥ªÁªüËÄåË®ÄÔºåÁº∫ÁúÅÂÄºÊòØ1024ÔºåÂ∞èÂÜÖÂ≠òÁöÑÁ≥ªÁªüÂàôÊòØ128„ÄÇnet.core.netdev_max_backlog = 32768 #ÊØè‰∏™ÁΩëÁªúÊé•Âè£Êé•Êî∂Êï∞ÊçÆÂåÖÁöÑÈÄüÁéáÊØîÂÜÖÊ†∏Â§ÑÁêÜËøô‰∫õÂåÖÁöÑÈÄüÁéáÂø´Êó∂ÔºåÂÖÅËÆ∏ÈÄÅÂà∞ÈòüÂàóÁöÑÊï∞ÊçÆÂåÖÁöÑÊúÄÂ§ßÊï∞ÁõÆ„ÄÇnet.core.somaxconn = 32768 #webÂ∫îÁî®‰∏≠listenÂáΩÊï∞ÁöÑbacklogÈªòËÆ§‰ºöÁªôÊàë‰ª¨ÂÜÖÊ†∏ÂèÇÊï∞ÁöÑnet.core.somaxconnÈôêÂà∂Âà∞128ÔºåËÄånginxÂÆö‰πâÁöÑNGX_LISTEN_BACKLOGÈªòËÆ§‰∏∫511ÔºåÊâÄ‰ª•ÊúâÂøÖË¶ÅË∞ÉÊï¥Ëøô‰∏™ÂÄº„ÄÇnet.core.wmem_default = 8388608net.core.rmem_default = 8388608net.core.rmem_max = 16777216 #ÊúÄÂ§ßsocketËØªbuffer,ÂèØÂèÇËÄÉÁöÑ‰ºòÂåñÂÄº:873200net.core.wmem_max = 16777216 #ÊúÄÂ§ßsocketÂÜôbuffer,ÂèØÂèÇËÄÉÁöÑ‰ºòÂåñÂÄº:873200net.ipv4.tcp_timestsmps = 0 #Êó∂Èó¥Êà≥ÂèØ‰ª•ÈÅøÂÖçÂ∫èÂàóÂè∑ÁöÑÂç∑Áªï„ÄÇ‰∏Ä‰∏™1GbpsÁöÑÈìæË∑ØËÇØÂÆö‰ºöÈÅáÂà∞‰ª•ÂâçÁî®ËøáÁöÑÂ∫èÂàóÂè∑„ÄÇÊó∂Èó¥Êà≥ËÉΩÂ§üËÆ©ÂÜÖÊ†∏Êé•ÂèóËøôÁßç‚ÄúÂºÇÂ∏∏‚ÄùÁöÑÊï∞ÊçÆÂåÖ„ÄÇËøôÈáåÈúÄË¶ÅÂ∞ÜÂÖ∂ÂÖ≥Êéâ„ÄÇnet.ipv4.tcp_synack_retries = 2 #‰∏∫‰∫ÜÊâìÂºÄÂØπÁ´ØÁöÑËøûÊé•ÔºåÂÜÖÊ†∏ÈúÄË¶ÅÂèëÈÄÅ‰∏Ä‰∏™SYNÂπ∂ÈôÑÂ∏¶‰∏Ä‰∏™ÂõûÂ∫îÂâçÈù¢‰∏Ä‰∏™SYNÁöÑACK„ÄÇ‰πüÂ∞±ÊòØÊâÄË∞ì‰∏âÊ¨°Êè°Êâã‰∏≠ÁöÑÁ¨¨‰∫åÊ¨°Êè°Êâã„ÄÇËøô‰∏™ËÆæÁΩÆÂÜ≥ÂÆö‰∫ÜÂÜÖÊ†∏ÊîæÂºÉËøûÊé•‰πãÂâçÂèëÈÄÅSYN+ACKÂåÖÁöÑÊï∞Èáè„ÄÇnet.ipv4.tcp_syn_retries = 2 #Âú®ÂÜÖÊ†∏ÊîæÂºÉÂª∫Á´ãËøûÊé•‰πãÂâçÂèëÈÄÅSYNÂåÖÁöÑÊï∞Èáè„ÄÇnet.ipv4.tcp_tw_reuse = 1 # ÂºÄÂêØÈáçÁî®„ÄÇÂÖÅËÆ∏Â∞ÜTIME-WAIT socketsÈáçÊñ∞Áî®‰∫éÊñ∞ÁöÑTCPËøûÊé•„ÄÇnet.ipv4.tcp_wmem = 8192 436600 873200 # TCPÂÜôbuffer,ÂèØÂèÇËÄÉÁöÑ‰ºòÂåñÂÄº: 8192 436600 873200net.ipv4.tcp_rmem = 32768 436600 873200 # TCPËØªbuffer,ÂèØÂèÇËÄÉÁöÑ‰ºòÂåñÂÄº: 32768 436600 873200net.ipv4.tcp_mem = 94500000 91500000 92700000 # ÂêåÊ†∑Êúâ3‰∏™ÂÄº,ÊÑèÊÄùÊòØ:net.ipv4.tcp_mem[0]:‰Ωé‰∫éÊ≠§ÂÄºÔºåTCPÊ≤°ÊúâÂÜÖÂ≠òÂéãÂäõ„ÄÇnet.ipv4.tcp_mem[1]:Âú®Ê≠§ÂÄº‰∏ãÔºåËøõÂÖ•ÂÜÖÂ≠òÂéãÂäõÈò∂ÊÆµ„ÄÇnet.ipv4.tcp_mem[2]:È´ò‰∫éÊ≠§ÂÄºÔºåTCPÊãíÁªùÂàÜÈÖçsocket„ÄÇ‰∏äËø∞ÂÜÖÂ≠òÂçï‰ΩçÊòØÈ°µÔºåËÄå‰∏çÊòØÂ≠óËäÇ„ÄÇÂèØÂèÇËÄÉÁöÑ‰ºòÂåñÂÄºÊòØ:786432 1048576 1572864net.ipv4.tcp_max_orphans = 3276800 #Á≥ªÁªü‰∏≠ÊúÄÂ§öÊúâÂ§öÂ∞ë‰∏™TCPÂ•óÊé•Â≠ó‰∏çË¢´ÂÖ≥ËÅîÂà∞‰ªª‰Ωï‰∏Ä‰∏™Áî®Êà∑Êñá‰ª∂Âè•ÊüÑ‰∏ä„ÄÇÂ¶ÇÊûúË∂ÖËøáËøô‰∏™Êï∞Â≠óÔºåËøûÊé•Â∞ÜÂç≥ÂàªË¢´Â§ç‰ΩçÂπ∂ÊâìÂç∞Âá∫Ë≠¶Âëä‰ø°ÊÅØ„ÄÇËøô‰∏™ÈôêÂà∂‰ªÖ‰ªÖÊòØ‰∏∫‰∫ÜÈò≤Ê≠¢ÁÆÄÂçïÁöÑDoSÊîªÂáªÔºå‰∏çËÉΩËøáÂàÜ‰æùÈù†ÂÆÉÊàñËÄÖ‰∫∫‰∏∫Âú∞ÂáèÂ∞èËøô‰∏™ÂÄºÔºåÊõ¥Â∫îËØ•Â¢ûÂä†Ëøô‰∏™ÂÄº(Â¶ÇÊûúÂ¢ûÂä†‰∫ÜÂÜÖÂ≠ò‰πãÂêé)„ÄÇnet.ipv4.tcp_fin_timeout = 30 #Â¶ÇÊûúÂ•óÊé•Â≠óÁî±Êú¨Á´ØË¶ÅÊ±ÇÂÖ≥Èó≠ÔºåËøô‰∏™ÂèÇÊï∞ÂÜ≥ÂÆö‰∫ÜÂÆÉ‰øùÊåÅÂú®FIN-WAIT-2Áä∂ÊÄÅÁöÑÊó∂Èó¥„ÄÇÂØπÁ´ØÂèØ‰ª•Âá∫ÈîôÂπ∂Ê∞∏Ëøú‰∏çÂÖ≥Èó≠ËøûÊé•ÔºåÁîöËá≥ÊÑèÂ§ñÂΩìÊú∫„ÄÇÁº∫ÁúÅÂÄºÊòØ60Áßí„ÄÇ2.2 ÂÜÖÊ†∏ÁöÑÈÄöÂ∏∏ÂÄºÊòØ180ÁßíÔºå‰Ω†ÂèØ‰ª•ÊåâËøô‰∏™ËÆæÁΩÆÔºå‰ΩÜË¶ÅËÆ∞‰ΩèÁöÑÊòØÔºåÂç≥‰Ωø‰Ω†ÁöÑÊú∫Âô®ÊòØ‰∏Ä‰∏™ËΩªËΩΩÁöÑWEBÊúçÂä°Âô®Ôºå‰πüÊúâÂõ†‰∏∫Â§ßÈáèÁöÑÊ≠ªÂ•óÊé•Â≠óËÄåÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑÈ£éÈô©ÔºåFIN- WAIT-2ÁöÑÂç±Èô©ÊÄßÊØîFIN-WAIT-1Ë¶ÅÂ∞èÔºåÂõ†‰∏∫ÂÆÉÊúÄÂ§öÂè™ËÉΩÂêÉÊéâ1.5KÂÜÖÂ≠òÔºå‰ΩÜÊòØÂÆÉ‰ª¨ÁöÑÁîüÂ≠òÊúüÈïø‰∫õ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux dd ÂëΩ‰ª§ËØ¶Ëß£]]></title>
    <url>%2F2019%2F04%2F22%2Flinux-dd%2F</url>
    <content type="text"><![CDATA[‰∏ÄÁõ¥ÂØπÂèëÂûãÂíåË∫´Êùê‰∏çÊª°ÊÑèÁöÑ‰∫∫ÔºåÊúâ‰∏Ä‰∏™ÂÖ±ÂêåÁÇπÔºö‰∏çËÇØÊâøËÆ§ËøôÊòØËÑ∏ÁöÑÈóÆÈ¢ò„ÄÇ ÂâçË®ÄddÔºöÁî®ÊåáÂÆöÂ§ßÂ∞èÁöÑÂùóÊã∑Ë¥ù‰∏Ä‰∏™Êñá‰ª∂ÔºåÂπ∂Âú®Êã∑Ë¥ùÁöÑÂêåÊó∂ËøõË°åÊåáÂÆöÁöÑËΩ¨Êç¢„ÄÇ Ê≥®ÊÑèÔºöÊåáÂÆöÊï∞Â≠óÁöÑÂú∞ÊñπËã•‰ª•‰∏ãÂàóÂ≠óÁ¨¶ÁªìÂ∞æÔºåÂàô‰πò‰ª•Áõ∏Â∫îÁöÑÊï∞Â≠ó b=512 c=1 k=1024 w=2 dd ÂëΩ‰ª§‰æãÂ≠êdd ÂàõÂª∫ÊµãËØïÊñá‰ª∂12ËØ≠Ê≥ïÔºöCODE:[Copy to clipboard]dd „ÄîÈÄâÈ°π„Äï 123456789101112131415161718192021if =ËæìÂÖ•Êñá‰ª∂(ÊàñËÆæÂ§áÂêçÁß∞)„ÄÇof =ËæìÂá∫Êñá‰ª∂(ÊàñËÆæÂ§áÂêçÁß∞)„ÄÇibs = bytes ‰∏ÄÊ¨°ËØªÂèñbytesÂ≠óËäÇÔºåÂç≥ËØªÂÖ•ÁºìÂÜ≤Âå∫ÁöÑÂ≠óËäÇÊï∞„ÄÇskip = blocks Ë∑≥ËøáËØªÂÖ•ÁºìÂÜ≤Âå∫ÂºÄÂ§¥ÁöÑibs*blocksÂùó„ÄÇobs = bytes ‰∏ÄÊ¨°ÂÜôÂÖ•bytesÂ≠óËäÇÔºåÂç≥ÂÜô ÂÖ•ÁºìÂÜ≤Âå∫ÁöÑÂ≠óËäÇÊï∞„ÄÇbs = bytes ÂêåÊó∂ËÆæÁΩÆËØª/ÂÜôÁºìÂÜ≤Âå∫ÁöÑÂ≠óËäÇÊï∞(Á≠â‰∫éËÆæÁΩÆobsÂíåobs)„ÄÇcbs = bytes ‰∏ÄÊ¨°ËΩ¨Êç¢bytesÂ≠óËäÇ„ÄÇcount = blocks Âè™Êã∑Ë¥ùËæìÂÖ•ÁöÑblocksÂùó„ÄÇconv = ASCII ÊääEBCDICÁ†ÅËΩ¨Êç¢‰∏∫ASCIIÁ†Å„ÄÇconv = ebcdic ÊääASCIIÁ†ÅËΩ¨Êç¢‰∏∫EBCDICÁ†Å„ÄÇconv = ibm ÊääASCIIÁ†ÅËΩ¨Êç¢‰∏∫alternate EBCDICÁ†Å„ÄÇconv = blick ÊääÂèòÂä®‰ΩçËΩ¨Êç¢ÊàêÂõ∫ÂÆöÂ≠óÁ¨¶„ÄÇconv = ublock ÊääÂõ∫ÂÆö‰ª¨ËΩ¨Êç¢ÊàêÂèòÂä®‰Ωçconv = ucase ÊääÂ≠óÊØçÁî±Â∞èÂÜôÂèò‰∏∫Â§ßÂÜô„ÄÇconv = lcase ÊääÂ≠óÊØçÁî±Â§ßÂÜôÂèò‰∏∫Â∞èÂÜô„ÄÇconv = notrunc ‰∏çÊà™Áü≠ËæìÂá∫Êñá‰ª∂„ÄÇconv = swab ‰∫§Êç¢ÊØè‰∏ÄÂØπËæìÂÖ•Â≠óËäÇ„ÄÇconv = noerror Âá∫ÈîôÊó∂‰∏çÂÅúÊ≠¢Â§ÑÁêÜ„ÄÇconv = sync ÊääÊØè‰∏™ËæìÂÖ•ËÆ∞ÂΩïÁöÑÂ§ßÂ∞èÈÉΩË∞ÉÂà∞ibsÁöÑÂ§ßÂ∞è(Áî®ibsÂ°´ÂÖÖ)„ÄÇfdformatÂëΩ‰ª§‰ΩéÁ∫ßÊ†ºÂºèÂåñËΩØÁõò„ÄÇ ÂàõÂª∫‰∏Ä‰∏™2GÁöÑÊñá‰ª∂1dd if=/dev/zero of=/tmp/test bs=1M count=2048 ÊµãËØïÁ°¨ÁõòËØªÂÜôÈÄüÂ∫¶ÈÄöËøá‰∏§‰∏™ÂëΩ‰ª§ËæìÂá∫ÁöÑÊâßË°åÊó∂Èó¥ÔºåÂèØ‰ª•ËÆ°ÁÆóÂá∫ÊµãËØïÁ°¨ÁõòÁöÑËØªÔºèÂÜôÈÄüÂ∫¶:12dd if=/root/1Gb.file bs=64k | dd of=/dev/nulldd if=/dev/zero of=/root/1Gb.file bs=1024 count=1000000 ÈîÄÊØÅÁ£ÅÁõòÊï∞ÊçÆ1dd if=/dev/urandom of=/dev/hda1 Ê≥®ÊÑèÔºöÂà©Áî®ÈöèÊú∫ÁöÑÊï∞ÊçÆÂ°´ÂÖÖÁ°¨ÁõòÔºåÂú®Êüê‰∫õÂøÖË¶ÅÁöÑÂú∫ÂêàÂèØ‰ª•Áî®Êù•ÈîÄÊØÅÊï∞ÊçÆ„ÄÇ Á°ÆÂÆöÁ°¨ÁõòÁöÑÊúÄ‰Ω≥ÂùóÂ§ßÂ∞è1234dd if=/dev/zero bs=1024 count=1000000 of=/root/1Gb.filedd if=/dev/zero bs=2048 count=500000 of=/root/1Gb.filedd if=/dev/zero bs=4096 count=250000 of=/root/1Gb.filedd if=/dev/zero bs=8192 count=125000 of=/root/1Gb.file ÈÄöËøáÊØîËæÉ‰ª•‰∏äÂëΩ‰ª§ËæìÂá∫‰∏≠ÊâÄÊòæÁ§∫ÁöÑÂëΩ‰ª§ÊâßË°åÊó∂Èó¥ÔºåÂç≥ÂèØÁ°ÆÂÆöÁ≥ªÁªüÊúÄ‰Ω≥ÁöÑÂùóÂ§ßÂ∞è„ÄÇ Â§á‰ªΩ‰∏éÊÅ¢Â§çMBRÂ§á‰ªΩÁ£ÅÁõòÂºÄÂßãÁöÑ512‰∏™Â≠óËäÇÂ§ßÂ∞èÁöÑMBR‰ø°ÊÅØÂà∞ÊåáÂÆöÊñá‰ª∂Ôºö12dd if=/dev/hda of=/root/image count=1 bs=512# count=1Êåá‰ªÖÊã∑Ë¥ù‰∏Ä‰∏™ÂùóÔºõbs=512ÊåáÂùóÂ§ßÂ∞è‰∏∫512‰∏™Â≠óËäÇ„ÄÇ Â∞ÜÂ§á‰ªΩÁöÑMBR‰ø°ÊÅØÂÜôÂà∞Á£ÅÁõòÂºÄÂßãÈÉ®ÂàÜ1dd if=/root/image of=/dev/had Êã∑Ë¥ùÂÜÖÂ≠òÂÜÖÂÆπÂà∞Á°¨Áõò12dd if=/dev/mem of=/root/mem.bin bs=1024# ÊåáÂÆöÂùóÂ§ßÂ∞è‰∏∫1k ‰øÆÂ§çÁ°¨Áõò123dd if=/dev/sda of=/dev/sdaÊàñËÄÖdd if=/dev/hda of=/dev/hda Â∞Ü‰∏Ä‰∏™ÂæàÂ§ßÁöÑËßÜÈ¢ëÊñá‰ª∂‰∏≠ÁöÑÁ¨¨i‰∏™Â≠óËäÇÁöÑÂÄºÊîπÊàê0x41Ôºà‰πüÂ∞±ÊòØÂ§ßÂÜôÂ≠óÊØçAÁöÑASCIIÂÄºÔºâ1echo A | dd of=bigfile seek=$i bs=1 count=1 conv=notrunc ÁªìÂ∞æÊÄªÁªì/dev/nullÂíå/dev/zeroÁöÑÂå∫Âà´ /dev/nullÔºåÂ§ñÂè∑Âè´Êó†Â∫ïÊ¥ûÔºå‰Ω†ÂèØ‰ª•ÂêëÂÆÉËæìÂá∫‰ªª‰ΩïÊï∞ÊçÆÔºåÂÆÉÈÄöÂêÉÔºåÂπ∂‰∏î‰∏ç‰ºöÊíëÁùÄÔºÅ /dev/nullÔºåÂ§ñÂè∑Âè´Êó†Â∫ïÊ¥ûÔºå‰Ω†ÂèØ‰ª•ÂêëÂÆÉËæìÂá∫‰ªª‰ΩïÊï∞ÊçÆÔºåÂÆÉÈÄöÂêÉÔºåÂπ∂‰∏î‰∏ç‰ºöÊíëÁùÄÔºÅ /dev/nullÔºåÂÆÉÊòØÁ©∫ËÆæÂ§áÔºå‰πüÁß∞‰∏∫‰ΩçÊ°∂Ôºàbit bucketÔºâ„ÄÇ‰ªª‰ΩïÂÜôÂÖ•ÂÆÉÁöÑËæìÂá∫ÈÉΩ‰ºöË¢´ÊäõÂºÉ„ÄÇÂ¶ÇÊûú‰∏çÊÉ≥ËÆ©Ê∂àÊÅØ‰ª•Ê†áÂáÜËæìÂá∫ÊòæÁ§∫ÊàñÂÜôÂÖ•Êñá‰ª∂ÔºåÈÇ£‰πàÂèØ‰ª•Â∞ÜÊ∂àÊÅØÈáçÂÆöÂêëÂà∞‰ΩçÊ°∂„ÄÇ /dev/zero,ÊòØ‰∏Ä‰∏™ËæìÂÖ•ËÆæÂ§áÔºå‰Ω†ÂèØ‰Ω†Áî®ÂÆÉÊù•ÂàùÂßãÂåñÊñá‰ª∂„ÄÇ /dev/zero,ÊòØ‰∏Ä‰∏™ËæìÂÖ•ËÆæÂ§áÔºå‰Ω†ÂèØ‰Ω†Áî®ÂÆÉÊù•ÂàùÂßãÂåñÊñá‰ª∂„ÄÇ /dev/zeroÔºåËØ•ËÆæÂ§áÊó†Á©∑Â∞ΩÂú∞Êèê‰æõ0ÔºåÂèØ‰ª•‰ΩøÁî®‰ªª‰Ωï‰Ω†ÈúÄË¶ÅÁöÑÊï∞ÁõÆ‚Äî‚ÄîËÆæÂ§áÊèê‰æõÁöÑË¶ÅÂ§öÁöÑÂ§ö„ÄÇ‰ªñÂèØ‰ª•Áî®‰∫éÂêëËÆæÂ§áÊàñÊñá‰ª∂ÂÜôÂÖ•Â≠óÁ¨¶‰∏≤0„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰øÆÊîπsync_binlog innodb_flush_log_at_trx_commitÂíåsync_binlogÂèÇÊï∞ ÊèêÈ´òÂÜôÂÖ•ÈÄüÂ∫¶]]></title>
    <url>%2F2019%2F04%2F22%2Fsync-binlog-innodb-flush-log-at-trx-commit%2F</url>
    <content type="text"><![CDATA[ËÉ∏Â∞èÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ§ßÔºåËÉ∏Â§ßÁöÑÂßëÂ®ò‰∏ÄËà¨ËÑæÊ∞îÈÉΩÁâπÂ•ΩÔºåÂõ†‰∏∫Âè§ËØ≠Êúâ‰∫ëÔºöÁ©∑Âá∂ÊûÅÊÅ∂ÊúâÂÆπ‰πÉÂ§ßÔºÅ ÂâçË®Äinnodb_flush_log_at_trx_commitÂíåsync_binlog ‰∏§‰∏™ÂèÇÊï∞ÊòØÊéßÂà∂MySQL Á£ÅÁõòÂÜôÂÖ•Á≠ñÁï•‰ª•ÂèäÊï∞ÊçÆÂÆâÂÖ®ÊÄßÁöÑÂÖ≥ÈîÆÂèÇÊï∞„ÄÇ ËØ¶ÁªÜinnodb_flush_log_at_trx_commit Â¶ÇÊûúinnodb_flush_log_at_trx_commitËÆæÁΩÆ‰∏∫0Ôºålog bufferÂ∞ÜÊØèÁßí‰∏ÄÊ¨°Âú∞ÂÜôÂÖ•log file‰∏≠ÔºåÂπ∂‰∏îlog fileÁöÑflush(Âà∑Âà∞Á£ÅÁõò)Êìç‰ΩúÂêåÊó∂ËøõË°åÔºåËØ•Ê®°Âºè‰∏ãÔºåÂú®‰∫ãÂä°Êèê‰∫§ÁöÑÊó∂ÂÄôÔºå‰∏ç‰ºö‰∏ªÂä®Ëß¶ÂèëÂÜôÂÖ•Á£ÅÁõòÁöÑÊìç‰Ωú„ÄÇ Â¶ÇÊûúinnodb_flush_log_at_trx_commitËÆæÁΩÆ‰∏∫1ÔºåÊØèÊ¨°‰∫ãÂä°Êèê‰∫§Êó∂MySQLÈÉΩ‰ºöÊäälog bufferÁöÑÊï∞ÊçÆÂÜôÂÖ•log fileÔºåÂπ∂‰∏îflush(Âà∑Âà∞Á£ÅÁõò)‰∏≠Âéª„ÄÇ Â¶ÇÊûúinnodb_flush_log_at_trx_commitËÆæÁΩÆ‰∏∫2ÔºåÊØèÊ¨°‰∫ãÂä°Êèê‰∫§Êó∂MySQLÈÉΩ‰ºöÊäälog bufferÁöÑÊï∞ÊçÆÂÜôÂÖ•log file.‰ΩÜÊòØflush(Âà∑Âà∞Á£ÅÁõò)Êìç‰ΩúÂπ∂‰∏ç‰ºöÂêåÊó∂ËøõË°å„ÄÇËØ•Ê®°Âºè‰∏ã,MySQL‰ºöÊØèÁßíÊâßË°å‰∏ÄÊ¨° flush(Âà∑Âà∞Á£ÅÁõò)Êìç‰Ωú„ÄÇ Ê≥®ÔºöÁî±‰∫éËøõÁ®ãË∞ÉÂ∫¶Á≠ñÁï•ÈóÆÈ¢ò,Ëøô‰∏™‚ÄùÊØèÁßíÊâßË°å‰∏ÄÊ¨° flush(Âà∑Âà∞Á£ÅÁõò)Êìç‰Ωú‚ÄùÂπ∂‰∏çÊòØ‰øùËØÅ100%ÁöÑ‚ÄùÊØèÁßí‚Äù„ÄÇ sync_binlogsync_binlog ÁöÑÈªòËÆ§ÂÄºÊòØ0ÔºåÂÉèÊìç‰ΩúÁ≥ªÁªüÂà∑ÂÖ∂‰ªñÊñá‰ª∂ÁöÑÊú∫Âà∂‰∏ÄÊ†∑ÔºåMySQL‰∏ç‰ºöÂêåÊ≠•Âà∞Á£ÅÁõò‰∏≠ÂéªËÄåÊòØ‰æùËµñÊìç‰ΩúÁ≥ªÁªüÊù•Âà∑Êñ∞binary log„ÄÇ ÂΩìsync_binlog =N (N>0) ÔºåMySQL Âú®ÊØèÂÜô NÊ¨° ‰∫åËøõÂà∂Êó•Âøóbinary logÊó∂Ôºå‰ºö‰ΩøÁî®fdatasync()ÂáΩÊï∞Â∞ÜÂÆÉÁöÑÂÜô‰∫åËøõÂà∂Êó•Âøóbinary logÂêåÊ≠•Âà∞Á£ÅÁõò‰∏≠Âéª„ÄÇ Â¶ÇÊûúÂêØÁî®‰∫ÜautocommitÔºåÈÇ£‰πàÊØè‰∏Ä‰∏™ËØ≠Âè•statementÂ∞±‰ºöÊúâ‰∏ÄÊ¨°ÂÜôÊìç‰ΩúÔºõÂê¶ÂàôÊØè‰∏™‰∫ãÂä°ÂØπÂ∫î‰∏Ä‰∏™ÂÜôÊìç‰Ωú„ÄÇ Áî±Ê≠§ÂèØËßÅÔºåÂΩì‰∏§‰∏™ÂèÇÊï∞ËÆæÁΩÆ‰∏∫Âèå1ÁöÑÊó∂ÂÄôÔºåÂÜôÂÖ•ÊÄßËÉΩÊúÄÂ∑ÆÔºåsync_binlog=N (N>1 ) and innodb_flush_log_at_trx_commit=2 Êó∂Ôºå(Âú®ÂΩìÂâçÊ®°Âºè‰∏ã)MySQLÁöÑÂÜôÊìç‰ΩúÊâçËÉΩËææÂà∞ÊúÄÈ´òÊÄßËÉΩ„ÄÇ ÂΩìinnodb_flush_log_at_trx_commitÂíåsync_binlog ÈÉΩ‰∏∫ 1 Êó∂ÊòØÊúÄÂÆâÂÖ®ÁöÑÔºåÂú®mysqld ÊúçÂä°Â¥©Ê∫ÉÊàñËÄÖÊúçÂä°Âô®‰∏ªÊú∫crashÁöÑÊÉÖÂÜµ‰∏ãÔºåbinary log Âè™ÊúâÂèØËÉΩ‰∏¢Â§±ÊúÄÂ§ö‰∏Ä‰∏™ËØ≠Âè•ÊàñËÄÖ‰∏Ä‰∏™‰∫ãÂä°„ÄÇ‰ΩÜÊòØÈ±º‰∏éÁÜäÊéå‰∏çÂèØÂÖºÂæóÔºåÂèå11 ‰ºöÂØºËá¥È¢ëÁπÅÁöÑioÊìç‰ΩúÔºåÂõ†Ê≠§ËØ•Ê®°Âºè‰πüÊòØÊúÄÊÖ¢ÁöÑ‰∏ÄÁßçÊñπÂºè„ÄÇ ÂΩìinnodb_flush_log_at_trx_commitËÆæÁΩÆ‰∏∫0ÔºåmysqldËøõÁ®ãÁöÑÂ¥©Ê∫É‰ºöÂØºËá¥‰∏ä‰∏ÄÁßíÈíüÊâÄÊúâ‰∫ãÂä°Êï∞ÊçÆÁöÑ‰∏¢Â§±„ÄÇ ÂΩìinnodb_flush_log_at_trx_commitËÆæÁΩÆ‰∏∫2ÔºåÂè™ÊúâÂú®Êìç‰ΩúÁ≥ªÁªüÂ¥©Ê∫ÉÊàñËÄÖÁ≥ªÁªüÊéâÁîµÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏ä‰∏ÄÁßíÈíüÊâÄÊúâ‰∫ãÂä°Êï∞ÊçÆÊâçÂèØËÉΩ‰∏¢Â§±„ÄÇ Âèå1ÈÄÇÂêàÊï∞ÊçÆÂÆâÂÖ®ÊÄßË¶ÅÊ±ÇÈùûÂ∏∏È´òÔºåËÄå‰∏îÁ£ÅÁõòIOÂÜôËÉΩÂäõË∂≥Â§üÊîØÊåÅ‰∏öÂä°ÔºåÊØîÂ¶ÇËÆ¢Âçï,‰∫§Êòì,ÂÖÖÂÄº,ÊîØ‰ªòÊ∂àË¥πÁ≥ªÁªü„ÄÇ Êé®ËçêÁöÑÂÅöÊ≥ïÊòØ innodb_flush_log_at_trx_commit=2 Ôºåsync_binlog=N (N‰∏∫500 Êàñ1000) ‰∏î‰ΩøÁî®Â∏¶ËìÑÁîµÊ±†ÂêéÂ§áÁîµÊ∫êÁöÑÁºìÂ≠òcacheÔºåÈò≤Ê≠¢Á≥ªÁªüÊñ≠ÁîµÂºÇÂ∏∏„ÄÇ Á≥ªÁªüÊÄßËÉΩÂíåÊï∞ÊçÆÂÆâÂÖ®ÊòØ‰∏öÂä°Á≥ªÁªüÈ´òÂèØÁî®Á®≥ÂÆöÁöÑÂøÖË¶ÅÂõ†Á¥†„ÄÇÊàë‰ª¨ÂØπÁ≥ªÁªüÁöÑ‰ºòÂåñÈúÄË¶ÅÂØªÊâæ‰∏Ä‰∏™Âπ≥Ë°°ÁÇπÔºåÂêàÈÄÇÁöÑÊâçÊòØÊúÄÂ•ΩÁöÑÔºåÊ†πÊçÆ‰∏çÂêåÁöÑ‰∏öÂä°Âú∫ÊôØÈúÄÊ±ÇÔºåÂèØ‰ª•Â∞Ü‰∏§‰∏™ÂèÇÊï∞ÂÅöÁªÑÂêàË∞ÉÊï¥Ôºå‰ª•‰æøÊòØdbÁ≥ªÁªüÁöÑÊÄßËÉΩËææÂà∞ÊúÄ‰ºòÂåñ„ÄÇ PS: ‰∏§‰∏™ÈÉΩ‰∏∫1ÁöÑÊó∂ÂÄôÔºåÂØºÂÖ•Êï∞ÊçÆÁ∫¶18ÂàÜÈíüÔºå‰ºòÂåñÂêéÂØºÂÖ•Êï¥Â∫ìÁ∫¶3ÂàÜÈíü„ÄÇ12innodb_flush_log_at_trx_commit=2 sync_binlog=1000 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golang ÊâßË°å command]]></title>
    <url>%2F2019%2F04%2F20%2Fgo-command%2F</url>
    <content type="text"><![CDATA[‰Ω†Âπ∂‰∏çÊòØ‰∏ÄÊó†ÊâÄÊúâÔºåËá≥Â∞ë‰Ω†ÊúâËÇâ„ÄÇ ‰ª£Á†Ågolang‰∏≠‰ºöÁªèÂ∏∏ÈÅáÂà∞Ë¶Å fork Â≠êËøõÁ®ãÁöÑÈúÄÊ±Ç„ÄÇgo Ê†áÂáÜÂ∫ì‰∏∫Êàë‰ª¨Â∞ÅË£Ö‰∫Ü os/execÊ†áÂáÜÂåÖ,ÂΩìÊàë‰ª¨Ë¶ÅËøêË°åÂ§ñÈÉ®ÂëΩ‰ª§Êó∂Â∫îËØ•‰ºòÂÖà‰ΩøÁî®Ëøô‰∏™Â∫ì„ÄÇËøôÈáåÊàëÁÆÄÂçïÁªìÂêàcontext Âíå Cmd Ê®°ÂùóÂÜô‰∏Ä‰∏™ÈÄöÁî®ÁöÑÊâßË°å command ÊñπÊ≥ï„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã:12345678910111213141516171819202122232425262728293031323334353637383940package mainimport ( "context" "os/exec" "syscall")func RunCmd(ctx context.Context, cmd *exec.Cmd) error { cmd.SysProcAttr = &syscall.SysProcAttr{ Setpgid: true, } if err := cmd.Start(); err != nil { return err } errCh := make(chan error, 1) go func() { errCh { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLÈó™ÂõûÂéüÁêÜ‰∏éÂÆûÊàò]]></title>
    <url>%2F2019%2F04%2F19%2Fmysql-flashback-priciple-and-practice%2F</url>
    <content type="text"><![CDATA[ËÉΩÁî®Èí±Ëß£ÂÜ≥ÁöÑÈóÆÈ¢òÈÉΩ‰∏çÊòØÈóÆÈ¢òÔºåÂèØÈóÆÈ¢òÊòØÊàëÊòØÁ©∑‰∫∫„ÄÇ DBAÊàñÂºÄÂèë‰∫∫ÂëòÔºåÊúâÊó∂‰ºöËØØÂà†ÊàñËÄÖËØØÊõ¥Êñ∞Êï∞ÊçÆÔºåÂ¶ÇÊûúÊòØÁ∫ø‰∏äÁéØÂ¢ÉÂπ∂‰∏îÂΩ±ÂìçËæÉÂ§ßÔºåÂ∞±ÈúÄË¶ÅËÉΩÂø´ÈÄüÂõûÊªö„ÄÇ‰º†ÁªüÊÅ¢Â§çÊñπÊ≥ïÊòØÂà©Áî®Â§á‰ªΩÈáçÊê≠ÂÆû‰æãÔºåÂÜçÂ∫îÁî®ÂéªÈô§ÈîôËØØsqlÂêéÁöÑbinlogÊù•ÊÅ¢Â§çÊï∞ÊçÆ„ÄÇÊ≠§Ê≥ïË¥πÊó∂Ë¥πÂäõÔºåÁîöËá≥ÈúÄË¶ÅÂÅúÊú∫Áª¥Êä§ÔºåÂπ∂‰∏çÈÄÇÂêàÂø´ÈÄüÂõûÊªö„ÄÇ‰πüÊúâÂõ¢ÈòüÂà©Áî®LVMÂø´ÁÖßÊù•Áº©Áü≠ÊÅ¢Â§çÊó∂Èó¥Ôºå‰ΩÜÂø´ÁÖßÁöÑÁº∫ÁÇπÊòØ‰ºöÂΩ±ÂìçmysqlÁöÑÊÄßËÉΩ„ÄÇ MySQLÈó™Âõû(flashback)Âà©Áî®binlogÁõ¥Êé•ËøõË°åÂõûÊªöÔºåËÉΩÂø´ÈÄüÊÅ¢Â§ç‰∏î‰∏çÁî®ÂÅúÊú∫„ÄÇÊú¨ÊñáÂ∞Ü‰ªãÁªçÈó™ÂõûÂéüÁêÜÔºåÁªôÂá∫Á¨îËÄÖÁöÑÂÆûÊàòÁªèÈ™åÔºåÂπ∂ÂØπÁé∞Â≠òÁöÑÈó™ÂõûÂ∑•ÂÖ∑‰ΩúÊØîËæÉ„ÄÇ ÂºÄËÉÉËèúÊüêÂ§©ÔºåÂ∞èÊòéÂõ†ÁßçÁßçÂéüÂõ†ÔºåËØØÂà†‰∫ÜÂ§ßÊâπÁ∫ø‰∏äÁî®Êà∑Ë°®ÁöÑÊï∞ÊçÆ„ÄÇ‰ªñÊÄ•ÂøôÊâæÂà∞ÂÖ¨Âè∏DBAËØ∑Ê±ÇÂ∏ÆÂä©Ôºå‚ÄúÂÆ¢ÊúçÁîµËØùÂ∑≤Ë¢´ÊâìÁàÜÔºåÂ§ßÈáèÁî®Êà∑ÊäïËØâÊó†Ê≥ïÁôªÈôÜÔºåÈ¢ÜÂØºÈùûÂ∏∏ÊÅºÁÅ´„ÄÇËØ∑ÈóÆÂ§ö‰πÖËÉΩÊÅ¢Â§çÊï∞ÊçÆÔºü‚ÄùDBA‰∏ÄËÑ∏ÊáµÈÄºÔºåÊ≤âÈªòÂçÅÁßíÂêéÔºå‰º∏Âá∫‰∏ÄÊ†πÊâãÊåá„ÄÇ‚Äú‰Ω†ÁöÑÊÑèÊÄùÊòØ‰∏ÄÂàÜÈíüÂ∞±ËÉΩÊÅ¢Â§çÔºüÂ§™Â•Ω‰∫Ü„ÄÇ‚ÄùÂ∞èÊòéÁªà‰∫éÊúâ‰∫õÊîæÊùæÔºåÈú≤Âá∫‰∫Ü‰∏Ä‰∏ùÁ¨ëÂÆπ„ÄÇ‚Äú‰∏çÔºåÊàë‰ª¨‰∏≠Êúâ‰∏™‰∫∫Â∞Ü‰ºöÁ¶ªÂºÄÂÖ¨Âè∏„ÄÇ‚ÄùDBAÊ≤âÁóõÁöÑËØ¥ÈÅì„ÄÇ ÂãøËÆ©ÊÇ≤ÂâßÂèëÁîüÔºåÂ∞ΩÊó©Â∞ÜÊ≠§ÊñáËΩ¨ÁªôÂÖ¨Âè∏DBA„ÄÇ Èó™ÂõûÂéüÁêÜbinlogÊ¶ÇËø∞ MySQL binlog‰ª•eventÁöÑÂΩ¢ÂºèÔºåËÆ∞ÂΩï‰∫ÜMySQL server‰ªéÂêØÁî®binlog‰ª•Êù•ÊâÄÊúâÁöÑÂèòÊõ¥‰ø°ÊÅØÔºåËÉΩÂ§üÂ∏ÆÂä©ÈáçÁé∞Ëøô‰πãÈó¥ÁöÑÊâÄÊúâÂèòÂåñ„ÄÇMySQLÂºïÂÖ•binlog‰∏ªË¶ÅÊúâ‰∏§‰∏™ÁõÆÁöÑÔºö‰∏ÄÊòØ‰∏∫‰∫Ü‰∏ª‰ªéÂ§çÂà∂Ôºõ‰∫åÊòØÊüê‰∫õÂ§á‰ªΩËøòÂéüÊìç‰ΩúÂêéÈúÄË¶ÅÈáçÊñ∞Â∫îÁî®binlog„ÄÇ Êúâ‰∏âÁßçÂèØÈÄâÁöÑbinlogÊ†ºÂºèÔºåÂêÑÊúâ‰ºòÁº∫ÁÇπÔºö statementÔºöÂü∫‰∫éSQLËØ≠Âè•ÁöÑÊ®°ÂºèÔºåbinlogÊï∞ÊçÆÈáèÂ∞èÔºå‰ΩÜÊòØÊüê‰∫õËØ≠Âè•ÂíåÂáΩÊï∞Âú®Â§çÂà∂ËøáÁ®ãÂèØËÉΩÂØºËá¥Êï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁîöËá≥Âá∫ÈîôÔºõ rowÔºöÂü∫‰∫éË°åÁöÑÊ®°ÂºèÔºåËÆ∞ÂΩïÁöÑÊòØË°åÁöÑÂÆåÊï¥ÂèòÂåñ„ÄÇÂæàÂÆâÂÖ®Ôºå‰ΩÜÊòØbinlog‰ºöÊØîÂÖ∂‰ªñ‰∏§ÁßçÊ®°ÂºèÂ§ßÂæàÂ§öÔºõ mixedÔºöÊ∑∑ÂêàÊ®°ÂºèÔºåÊ†πÊçÆËØ≠Âè•Êù•ÈÄâÁî®ÊòØstatementËøòÊòØrowÊ®°ÂºèÔºõ Âà©Áî®binlogÈó™ÂõûÔºåÈúÄË¶ÅÂ∞ÜbinlogÊ†ºÂºèËÆæÁΩÆ‰∏∫row„ÄÇrowÊ®°Âºè‰∏ãÔºå‰∏ÄÊù°‰ΩøÁî®innodbÁöÑinsert‰ºö‰∫ßÁîüÂ¶Ç‰∏ãÊ†ºÂºèÁöÑbinlogÔºö 123456789101112131415161718# at 1129#161225 23:15:38 server id 3773306082 end_log_pos 1197 Query thread_id=1903021 exec_time=0 error_code=0SET TIMESTAMP=1482678938/*!*/;BEGIN/*!*/;# at 1197#161225 23:15:38 server id 3773306082 end_log_pos 1245 Table_map: `test`.`user` mapped to number 290# at 1245#161225 23:15:38 server id 3773306082 end_log_pos 1352 Write_rows: table id 290 flags: STMT_END_FBINLOG 'muJfWBPiFOjgMAAAAN0EAAAAACIBAAAAAAEABHRlc3QABHVzZXIAAwMPEQMeAAACmuJfWB7iFOjgawAAAEgFAAAAACIBAAAAAAEAAgAD//gBAAAABuWwj+i1tVhK1hH4AgAAAAblsI/pkrFYStYg+AMAAAAG5bCP5a2ZWE/onPgEAAAABuWwj+adjlhNeAD4BQAAAAJ0dFhRYJM='/*!*/;# at 1352#161225 23:15:38 server id 3773306082 end_log_pos 1379 Xid = 5327954COMMIT/*!*/; Èó™ÂõûÂéüÁêÜ Êó¢ÁÑ∂binlog‰ª•eventÂΩ¢ÂºèËÆ∞ÂΩï‰∫ÜÊâÄÊúâÁöÑÂèòÊõ¥‰ø°ÊÅØÔºåÈÇ£‰πàÊàë‰ª¨ÊääÈúÄË¶ÅÂõûÊªöÁöÑeventÔºå‰ªéÂêéÂæÄÂâçÂõûÊªöÂõûÂéªÂç≥ÂèØ„ÄÇ ÂØπ‰∫éÂçï‰∏™eventÁöÑÂõûÊªöÔºåÊàë‰ª¨‰ª•Ë°®test.userÊù•ÊºîÁ§∫ÂéüÁêÜ 12345678mysql> show create table test.user\G*************************** 1. row *************************** Table: userCreate Table: CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(10) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 ÂØπ‰∫édeleteÊìç‰ΩúÔºåÊàë‰ª¨‰ªébinlogÊèêÂèñÂá∫delete‰ø°ÊÅØÔºåÁîüÊàêÁöÑÂõûÊªöËØ≠Âè•ÊòØinsert„ÄÇ(Ê≥®Ôºö‰∏∫‰∫ÜÊñπ‰æøËß£ÈáäÔºåÊàë‰ª¨Áî®binlog2sqlÂ∞ÜÂéüÂßãbinlogËΩ¨ÂåñÊàê‰∫ÜÂèØËØªSQL) 12ÂéüÂßãÔºöDELETE FROM `test`.`user` WHERE `id`=1 AND `name`='Â∞èËµµ';ÂõûÊªöÔºöINSERT INTO `test`.`user`(`id`, `name`) VALUES (1, 'Â∞èËµµ'); ÂØπ‰∫éinsertÊìç‰ΩúÔºåÂõûÊªöSQLÊòØdelete„ÄÇ 12ÂéüÂßãÔºöINSERT INTO `test`.`user`(`id`, `name`) VALUES (2, 'Â∞èÈí±');ÂõûÊªöÔºöDELETE FROM `test`.`user` WHERE `id`=2 AND `name`='Â∞èÈí±'; ÂØπ‰∫éupdateÊìç‰ΩúÔºåÂõûÊªösqlÂ∫îËØ•‰∫§Êç¢SETÂíåWHEREÁöÑÂÄº„ÄÇ 12ÂéüÂßãÔºöUPDATE `test`.`user` SET `id`=3, `name`='Â∞èÊùé' WHERE `id`=3 AND `name`='Â∞èÂ≠ô';ÂõûÊªöÔºöUPDATE `test`.`user` SET `id`=3, `name`='Â∞èÂ≠ô' WHERE `id`=3 AND `name`='Â∞èÊùé'; TIPS Èó™ÂõûÁöÑÁõÆÊ†áÔºöÂø´ÈÄüÁ≠õÈÄâÂá∫ÁúüÊ≠£ÈúÄË¶ÅÂõûÊªöÁöÑÊï∞ÊçÆ„ÄÇ ÂÖàÊ†πÊçÆÂ∫ì„ÄÅË°®„ÄÅÊó∂Èó¥ÂÅö‰∏ÄÊ¨°ËøáÊª§ÔºåÂÜçÊ†πÊçÆ‰ΩçÁΩÆÂÅöÊõ¥ÂáÜÁ°ÆÁöÑËøáÊª§„ÄÇ Áî±‰∫éÊï∞ÊçÆ‰∏ÄÁõ¥Âú®ÂÜôÂÖ•ÔºåË¶ÅÁ°Æ‰øùÂõûÊªösql‰∏≠‰∏çÂåÖÂê´ÂÖ∂‰ªñÊï∞ÊçÆ„ÄÇÂèØÊ†πÊçÆÊòØÂê¶ÊòØÂêå‰∏Ä‰∫ãÂä°„ÄÅËØØÊìç‰ΩúË°åÊï∞„ÄÅÂ≠óÊÆµÂÄºÁöÑÁâπÂæÅÁ≠âÁ≠âÊù•Â∏ÆÂä©Âà§Êñ≠„ÄÇ ÊâßË°åÂõûÊªösqlÊó∂Â¶ÇÊúâÊä•ÈîôÔºåÈúÄË¶ÅÊü•ÂÆûÂÖ∑‰ΩìÂéüÂõ†Ôºå‰∏ÄËà¨ÊòØÂõ†‰∏∫ÂØπÂ∫îÁöÑÊï∞ÊçÆÂ∑≤ÂèëÁîüÂèòÂåñ„ÄÇÁî±‰∫éÊòØ‰∏•Ê†ºÁöÑË°åÊ®°ÂºèÔºåÂè™Ë¶ÅÊúâÂîØ‰∏ÄÈîÆ(ÂåÖÊã¨‰∏ªÈîÆ)Â≠òÂú®ÔºåÂ∞±Âè™‰ºöÊä•ÊüêÊù°Êï∞ÊçÆ‰∏çÂ≠òÂú®ÁöÑÈîôÔºå‰∏çÂøÖÊãÖÂøÉ‰ºöÊõ¥Êñ∞‰∏çËØ•Êìç‰ΩúÁöÑÊï∞ÊçÆ„ÄÇ‰∏öÂä°Â¶ÇÊûúÊúâÁâπÊÆäÈÄªËæëÔºåÊï∞ÊçÆÂõûÊªöÂèØËÉΩ‰ºöÂ∏¶Êù•ÂΩ±Âìç„ÄÇ Â¶ÇÊûúÂè™ÂõûÊªöÊüêÂº†Ë°®ÔºåÂπ∂‰∏îËØ•Ë°®ÊúâÂÖ≥ËÅîË°®ÔºåÂÖ≥ËÅîË°®Âπ∂‰∏ç‰ºöË¢´ÂõûÊªöÔºåÈúÄ‰∏é‰∏öÂä°ÊñπÊ≤üÈÄöÊ∏ÖÊ•ö„ÄÇ Âì™‰∫õÊï∞ÊçÆÈúÄË¶ÅÂõûÊªöÔºåËÆ©‰∏öÂä°ÊñπÊù•Âà§Êñ≠ÔºÅÈó™ÂõûÂ∑•ÂÖ∑MySQLÈó™ÂõûÁâπÊÄßÊúÄÊó©Áî±ÈòøÈáåÂΩ≠Á´ãÂããÂºÄÂèëÔºåÂΩ≠Âú®2012Âπ¥ÁªôÂÆòÊñπÊèê‰∫§‰∫Ü‰∏Ä‰∏™patchÔºåÂπ∂ÂØπÈó™ÂõûËÆæËÆ°ÊÄùË∑ØÂÅö‰∫ÜËØ¥Êòé(ËÆæËÆ°ÊÄùË∑ØÂæàÊúâÂêØÂèëÊÄßÔºåÂº∫ÁÉàÊé®ËçêÈòÖËØª)„ÄÇ‰ΩÜÊòØÂõ†‰∏∫ÁßçÁßçÂéüÂõ†Ôºå‰∏öÂÜÖÂÆâË£ÖËøô‰∏™patchÁöÑÂõ¢ÈòüËá≥‰ªäËøòÊòØÂ∞ëÊï∞ÔºåÁúüÊ≠£Â∫îÁî®Âà∞Á∫ø‰∏äÁöÑÊõ¥ÊòØÂ∞ë‰πãÂèàÂ∞ë„ÄÇÂΩ≠‰πãÂêéÔºåÂèàÊúâÂ§ö‰Ωç‰∫∫ÂëòÈíàÂØπ‰∏çÂêåmysqlÁâàÊú¨‰∏çÂêåËØ≠Ë®ÄÂºÄÂèë‰∫ÜÈó™ÂõûÂ∑•ÂÖ∑ÔºåÂéüÁêÜÁî®ÁöÑÈÉΩÊòØÂΩ≠ÁöÑÊÄùË∑Ø„ÄÇ ÊàëÂ∞ÜËøô‰∫õÈó™ÂõûÂ∑•ÂÖ∑ÊåâÂÆûÁé∞ÊñπÂºèÂàÜÊàê‰∫Ü‰∏âÁ±ª„ÄÇ Á¨¨‰∏ÄÁ±ªÊòØ‰ª•patchÂΩ¢ÂºèÈõÜÊàêÂà∞ÂÆòÊñπÂ∑•ÂÖ∑mysqlbinlog‰∏≠„ÄÇ‰ª•ÂΩ≠Êèê‰∫§ÁöÑpatch‰∏∫‰ª£Ë°®„ÄÇ ‰ºòÁÇπ ‰∏äÊâãÊàêÊú¨‰Ωé„ÄÇmysqlbinlogÂéüÊúâÁöÑÈÄâÈ°πÈÉΩËÉΩÁõ¥Êé•Âà©Áî®ÔºåÂè™ÊòØÂ§öÂä†‰∫Ü‰∏Ä‰∏™Èó™ÂõûÈÄâÈ°π„ÄÇÈó™ÂõûÁâπÊÄßÊú™Êù•ÊúâÂèØËÉΩË¢´ÂÆòÊñπÊî∂ÂΩï„ÄÇ ÊîØÊåÅÁ¶ªÁ∫øËß£Êûê„ÄÇ Áº∫ÁÇπ ÂÖºÂÆπÊÄßÂ∑Æ„ÄÅÈ°πÁõÆÊ¥ªË∑ÉÂ∫¶‰∏çÈ´ò„ÄÇÁî±‰∫ébinlogÊ†ºÂºèÁöÑÂèòÂä®ÔºåÂ¶ÇÊûúÈó™ÂõûÂ∑•ÂÖ∑‰ΩúËÄÖ‰∏çÂèäÊó∂ÂØπË°•‰∏ÅÂçáÁ∫ßÔºåÂàôÈó™ÂõûÂ∑•ÂÖ∑Â∞ÜÊó†Ê≥ï‰ΩøÁî®„ÄÇÁõÆÂâçÂ∑≤ÊúâÂ§ö‰Ωç‰∫∫ÂëòÂàÜÂà´ÈíàÂØπmysql5.5Ôºå5.6Ôºå5.7ÂºÄÂèë‰∫ÜpatchÔºåÈÉ®ÂàÜÈ°πÁõÆ‰ª£Á†ÅÂÖ¨ÂºÄÔºå‰ΩÜÊÄª‰Ωì‰∏äÊ¥ªË∑ÉÂ∫¶ÈÉΩ‰∏çÈ´ò„ÄÇ Èöæ‰ª•Ê∑ªÂä†Êñ∞ÂäüËÉΩÔºåÂÆûÊàòÊïàÊûúÊ¨†‰Ω≥„ÄÇÂú®ÂÆûÊàò‰∏≠ÔºåÁªèÂ∏∏‰ºöÈÅáÂà∞Áé∞Êúâpatch‰∏çÊª°Ë∂≥ÈúÄÊ±ÇÁöÑÊÉÖÂÜµÔºåÊØîÂ¶ÇË¶ÅÂä†‰∏™Ë°®ËøáÊª§ÔºåÂæàÁÆÄÂçïÁöÑ‰∏Ä‰∏™ÈúÄÊ±ÇÔºå‰ª£Á†ÅÊîπÂä®‰πü‰∏ç‰ºöÂ§ßÔºå‰ΩÜÂØπÂ§ßÈÉ®ÂàÜDBAÊù•ËØ¥ÔºåÊîπmysqlÊ∫êÁ†ÅËøòÊòØÂæàÂõ∞ÈöæÁöÑ‰∫ã„ÄÇ ÂÆâË£ÖÁ®çÊòæÈ∫ªÁÉ¶„ÄÇÈúÄË¶ÅÂØπmysqlÊ∫êÁ†ÅÊâìË°•‰∏ÅÂÜçÁºñËØëÁîüÊàê„ÄÇ Ëøô‰∫õÁº∫ÁÇπÔºåÂèØËÉΩÈÉΩÊòØÈó™ÂõûÊ≤°ÊúâÊµÅË°åÂºÄÊù•ÁöÑÂéüÂõ†„ÄÇ Á¨¨‰∫åÁ±ªÊòØÁã¨Á´ãÂ∑•ÂÖ∑ÔºåÈÄöËøá‰º™Ë£ÖÊàêslaveÊãâÂèñbinlogÊù•ËøõË°åÂ§ÑÁêÜ„ÄÇ‰ª•binlog2sql‰∏∫‰ª£Ë°®„ÄÇ ‰ºòÁÇπ ÂÖºÂÆπÊÄßÂ•Ω„ÄÇ‰º™Ë£ÖÊàêslaveÊãâbinlogËøôÈ°πÊäÄÊúØÂú®‰∏öÁïåÂ∫îÁî®ÁöÑÈùûÂ∏∏ÂπøÊ≥õÔºåÂ§ö‰∏™ÂºÄÂèëËØ≠Ë®ÄÈÉΩÊúâËøôÊ†∑ÁöÑÊ¥ªË∑ÉÈ°πÁõÆÔºåMySQLÁâàÊú¨ÁöÑÂÖºÂÆπÊÄßÁî±Ëøô‰∫õÈ°πÁõÆÊêûÂÆöÔºåÈó™ÂõûÂ∑•ÂÖ∑ÁöÑÂÖºÂÆπÈóÆÈ¢ò‰∏çÂÜçÁ™ÅÂá∫„ÄÇ Ê∑ªÂä†Êñ∞ÂäüËÉΩÁöÑÈöæÂ∫¶Â∞è„ÄÇÊõ¥ÂÆπÊòìË¢´ÊîπÈÄ†ÊàêDBAËá™Â∑±ÂñúÊ¨¢ÁöÑÂΩ¢Âºè„ÄÇÊõ¥ÈÄÇÂêàÂÆûÊàò„ÄÇ ÂÆâË£ÖÂíå‰ΩøÁî®ÁÆÄÂçï„ÄÇ Áº∫ÁÇπ ÂøÖÈ°ªÂºÄÂêØMySQL server„ÄÇ Á¨¨‰∏âÁ±ªÊòØÁÆÄÂçïËÑöÊú¨„ÄÇÂÖàÁî®mysqlbinlogËß£ÊûêÂá∫ÊñáÊú¨Ê†ºÂºèÁöÑbinlogÔºåÂÜçÊ†πÊçÆÂõûÊªöÂéüÁêÜÁî®Ê≠£ÂàôËøõË°åÂåπÈÖçÂπ∂ÊõøÊç¢„ÄÇ ‰ºòÁÇπ ËÑöÊú¨ÂÜôËµ∑Êù•Êñπ‰æøÔºåÂæÄÂæÄËÉΩÂø´ÈÄüÊêûÂÆöÊüê‰∏™ÁâπÂÆöÈóÆÈ¢ò„ÄÇ ÂÆâË£ÖÂíå‰ΩøÁî®ÁÆÄÂçï„ÄÇ ÊîØÊåÅÁ¶ªÁ∫øËß£Êûê„ÄÇ Áº∫ÁÇπ ÈÄöÁî®ÊÄß‰∏çÂ•Ω„ÄÇ ÂèØÈù†ÊÄß‰∏çÂ•Ω„ÄÇ Â∞±ÁõÆÂâçÁöÑÈó™ÂõûÂ∑•ÂÖ∑ËÄåË®ÄÔºåÁ∫ø‰∏äÁéØÂ¢ÉÁöÑÈó™ÂõûÔºåÁ¨îËÄÖÂª∫ËÆÆ‰ΩøÁî®binlog2sqlÔºåÁ¶ªÁ∫øËß£Êûê‰ΩøÁî®mysqlbinlog„ÄÇ ÂÖ≥‰∫éDDLÁöÑflashbackÊú¨ÊñáÊâÄËø∞ÁöÑflashback‰ªÖÈíàÂØπDMLËØ≠Âè•ÁöÑÂø´ÈÄüÂõûÊªö„ÄÇ‰ΩÜÂ¶ÇÊûúËØØÊìç‰ΩúÊòØDDLÁöÑËØùÔºåÊòØÊó†Ê≥ïÂà©Áî®binlogÂÅöÂø´ÈÄüÂõûÊªöÁöÑÔºåÂõ†‰∏∫Âç≥‰ΩøÂú®rowÊ®°Âºè‰∏ãÔºåbinlogÂØπ‰∫éDDLÊìç‰Ωú‰πü‰∏ç‰ºöËÆ∞ÂΩïÊØèË°åÊï∞ÊçÆÁöÑÂèòÂåñ„ÄÇË¶ÅÂÆûÁé∞DDLÂø´ÈÄüÂõûÊªöÔºåÂøÖÈ°ª‰øÆÊîπMySQLÊ∫êÁ†ÅÔºå‰ΩøÂæóÂú®ÊâßË°åDDLÂâçÂÖàÂ§á‰ªΩËÄÅÊï∞ÊçÆ„ÄÇÁõÆÂâçÊúâÂ§ö‰∏™mysqlÂÆöÂà∂ÁâàÊú¨ÂÆûÁé∞‰∫ÜDDLÈó™ÂõûÁâπÊÄßÔºåÈòøÈáåÊûóÊôìÊñåÂõ¢ÈòüÊèê‰∫§‰∫ÜpatchÁªôMySQLÂÆòÊñπÔºåMariaDBÈ¢ÑËÆ°Âú®‰∏ç‰πÖÂêéÂä†ÂÖ•ÂåÖÂê´DDLÁöÑflashbackÁâπÊÄß„ÄÇDDLÈó™ÂõûÁöÑÂâØ‰ΩúÁî®ÊòØ‰ºöÂ¢ûÂä†È¢ùÂ§ñÂ≠òÂÇ®„ÄÇËÄÉËôëÂà∞ÂÖ∂Â∫îÁî®È¢ëÊ¨°ÂÆûÂú®Ëøá‰ΩéÔºåÊú¨Êñá‰∏çÂÅöËØ¶Ëø∞ÔºåÊúâÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•Ëá™Â∑±Âéª‰∫ÜËß£ÔºåÈáçË¶ÅÁöÑÂá†ÁØáÊñáÁ´†ÊàëÂú®ÂèÇËÄÉËµÑÊñô‰∏≠ÂÅö‰∫ÜÂºïÁî®„ÄÇ ÂèÇËÄÉËµÑÊñô[1] MySQL Internals Manual, Chapter 20 The Binary Log [2] ÂΩ≠Á´ãÂããÔºåMySQL‰∏ãÂÆûÁé∞Èó™ÂõûÁöÑËÆæËÆ°ÊÄùË∑Ø [3] Lixun Peng, Provide the flashback feature by binlog [4] ÁéãÂπøÂèãÔºåmysqlbinlog flashback 5.6ÂÆåÂÖ®‰ΩøÁî®ÊâãÂÜå‰∏éÂéüÁêÜ [5] ÂßúÊâøÂ∞ß, ÊãøËµ∞‰∏çË∞¢ÔºåFlashback for MySQL 5.7 [6] ÊûóÊôìÊñå, MySQLÈó™ÂõûÊñπÊ°àËÆ®ËÆ∫ÂèäÂÆûÁé∞ [7] xiaobin lin, flashback from binlog for MySQL [8] mariadb.com, AliSQL and some features that have made it into MariaDB Server [9] danfengcao, binlog2sql: Parse MySQL binlog to SQL you want ÊñáÁ´†Êù•Ëá™MySQLÈó™ÂõûÂéüÁêÜ‰∏éÂÆûÊàò document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB Ê∑ªÂä†Á¥¢ÂºïÂºïÂèëÁöÑÊïÖÈöú]]></title>
    <url>%2F2019%2F04%2F17%2Fmongodb-creata-index%2F</url>
    <content type="text"><![CDATA[Âí∏È±ºÁøªË∫´ÔºåËøòÊòØÂí∏È±º„ÄÇ ÂéüÂõ†Á∫ø‰∏äMongoDBÊúçÂä°Âô®ËµÑÊ∫êÊä•Ë≠¶ÔºåÊü•ÁúãMongoDB logÂèëÁé∞ÊúâÂ§ßÈáèÁöÑÊü•ËØ¢Ê≤°ÊúâËµ∞Á¥¢Âºï„ÄÇ‰∫éÊòØÊ∑ªÂä†Á¥¢Âºï Êìç‰ΩúÂÖ∑‰ΩìÁöÑÊü•ËØ¢ËØ≠Âè•ÂàóÂ≠ê:1command feeds.content_medium_hismatch command: count { count: "content_medium_hismatch", query: { update_time: { $gte: 1384099200000, $lt: 1384185600000 }, content_type_id: "28" } } planSummary: IXSCAN { content_type_id: 1 } keysExamined:191146 docsExamined:191146 fromMultiPlanner:1 replanned:1 numYields:10767 reslen:44 locks:{ Global: { acquireCount: { r: 21536 } }, Database: { acquireCount: { r: 10768 } }, Collection: { acquireCount: { r: 10768 } } } protocol:op_query 84011ms ÈÄöËøáMongoDB explain()123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122repset:PRIMARY> db.content_medium_hismatch.find({ count: "content_medium_hismatch", query: { update_time: { $gte: 1384099200000, $lt: 1384185600000 }, content_type_id: "28" }}).explain(){ "queryPlanner" : { "plannerVersion" : 1, "namespace" : "feeds.content_medium_hismatch", "indexFilterSet" : false, "parsedQuery" : { "$and" : [ { "count" : { "$eq" : "content_medium_hismatch" } }, { "query" : { "$eq" : { "update_time" : { "$gte" : 1384099200000, "$lt" : 1384185600000 }, "content_type_id" : "28" } } } ] }, "winningPlan" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "count" : { "$eq" : "content_medium_hismatch" } }, { "query" : { "$eq" : { "update_time" : { "$gte" : 1384099200000, "$lt" : 1384185600000 }, "content_type_id" : "28" } } } ] }, "direction" : "forward" }, "rejectedPlans" : [ ] }, "serverInfo" : { "host" : "public-ops-mongodb2.wj.babytree-ops.org", "port" : 29001, "version" : "3.4.2", "gitVersion" : "3f76e40c105fc223b3e5aac3e20dcd026b83b38b" }, "ok" : 1}repset:PRIMARY> repset:PRIMARY> db.content_medium_hismatch.find({ count: "content_medium_hismatch", query: { update_time: { $gte: 1384099200000, $lt: 1384185600000 }, content_type_id: "28" }}).explain(){ "queryPlanner" : { "plannerVersion" : 1, "namespace" : "feeds.content_medium_hismatch", "indexFilterSet" : false, "parsedQuery" : { "$and" : [ { "count" : { "$eq" : "content_medium_hismatch" } }, { "query" : { "$eq" : { "update_time" : { "$gte" : 1384099200000, "$lt" : 1384185600000 }, "content_type_id" : "28" } } } ] }, "winningPlan" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "count" : { "$eq" : "content_medium_hismatch" } }, { "query" : { "$eq" : { "update_time" : { "$gte" : 1384099200000, "$lt" : 1384185600000 }, "content_type_id" : "28" } } } ] }, "direction" : "forward" }, "rejectedPlans" : [ ] }, "serverInfo" : { "host" : "public-ops-mongodb2.wj.babytree-ops.org", "port" : 29001, "version" : "3.4.2", "gitVersion" : "3f76e40c105fc223b3e5aac3e20dcd026b83b38b" }, "ok" : 1} ‰∫éÊòØÂæàÈ≤ÅËéΩÁöÑÊ∑ªÂä†‰∫ÜÁ¥¢ÂºïÊìç‰Ωú1db.content_medium_hismatch.ensureIndex({update_time: 1, content_type_id: 1}) ÂèëÁé∞Êó∂Èó¥ÂæàÈïøÔºå‰∫éÊòØÂ∞±crtl+c‰∏≠Êñ≠Êìç‰ΩúÔºåÂú®ÊâßË°åÁôªÂΩïMongoDB shell ÂèëÁé∞Êìç‰ΩúÈÉΩÂ†µÂ°û„ÄÇÊâßË°åtail -f /data/repset/log/mongod.logÂèëÁé∞12345678910112019-04-04T16:54:54.984+0800 I INDEX [conn2744778] build index on: feeds.content_medium_hismatch properties: { v: 2, key: { update_time: 1.0, content_type_id: 1.0 }, name: "update_time_1_content_type_id_1", ns: "feeds.content_medium_hismatch" }Index Build: 33461300/138238312 0%‚Ä¶‚Ä¶Index Build: 33461300/138238312 99%Index: (2/3) BTree Bottom Up Progress: 99135500/138238312 1%‚Ä¶‚Ä¶Index: (2/3) BTree Bottom Up Progress: 99135500/138238312 71%2019-04-04T18:22:05.817+0800 I INDEX [conn2744778] build index done. scanned 138238312 total records. 5230 secs ËøòÂú®ÊâßË°åÂàõÂª∫Á¥¢ÂºïÊìç‰Ωú„ÄÇÁªèËøáÊéíÊü•ÂèëÁé∞„ÄÇMongoDB ‰∏çÊòØÂíåMySQL‰∏ÄÊ†∑„ÄÇ‰∏≠Êñ≠‰∫ÜÂ∞±‰∏çÊâßË°å‰∫Ü„ÄÇËÄå‰∏îMongoDB Âú®ÂâçÂè∞ÂàõÂª∫Á¥¢ÂºïÊìç‰Ωú„ÄÇ‰ºöÊääÊï¥‰∏™ÊúçÂä°ÈòªÂ°û„ÄÇÁõ¥Âà∞Á¥¢ÂºïÂàõÂª∫ÊàêÂäüÔºåÊâç‰ºöÊîæÂºÄÈòªÂ°û„ÄÇËøôÊ†∑Êìç‰ΩúÁõ¥Êé•ÈÄ†Êàê‰∫Ü‰∏öÂä°‰∏çÂèØÁî®Áä∂ÊÄÅÔºåÊó∂Èó¥Êï¥Êï¥87ÂàÜÈíü„ÄÇÈ≤ÅËéΩÊÉπÁöÑÁ•∏„ÄÇ ÊÄªÁªìÂΩìÁ≥ªÁªüÂ∑≤ÊúâÂ§ßÈáèÊï∞ÊçÆÊó∂ÔºåÂàõÂª∫Á¥¢ÂºïÂ∞±ÊòØ‰∏™ÈùûÂ∏∏ËÄóÊó∂ÁöÑÊ¥ªÔºåÊàë‰ª¨ÂèØ‰ª•Âú®ÂêéÂè∞ÊâßË°åÔºåÂè™ÈúÄÊåáÂÆö‚Äùbackgroud: true‚ÄùÂç≥ÂèØ„ÄÇ1db.content_medium_hismatch.ensureIndex({update_time: 1, content_type_id: 1}, {backgroud: true}) ÂõûÈ°æÊúÄÂêéÂú®Áúã‰∏Ä‰∏ãÂ¶ÇÊ≠§‰πãÂ§ßÁöÑ‰ª£‰ª∑ÂàõÂª∫ÁöÑÁ¥¢Âºï‰πãÂêé‰ΩøÁî®ÁöÑÊÉÖÂÜµ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175repset:PRIMARY> db.content_medium_hismatch.find({ update_time: { $gte: 1384099200000, $lt: 1384185600000 }, content_type_id: "28" }).explain(){ "queryPlanner" : { "plannerVersion" : 1, "namespace" : "feeds.content_medium_hismatch", "indexFilterSet" : false, "parsedQuery" : { "$and" : [ { "content_type_id" : { "$eq" : "28" } }, { "update_time" : { "$lt" : 1384185600000 } }, { "update_time" : { "$gte" : 1384099200000 } } ] }, "winningPlan" : { "stage" : "FETCH", "inputStage" : { "stage" : "IXSCAN", "keyPattern" : { "update_time" : 1, "content_type_id" : 1 }, "indexName" : "update_time_1_content_type_id_1", "isMultiKey" : false, "multiKeyPaths" : { "update_time" : [ ], "content_type_id" : [ ] }, "isUnique" : false, "isSparse" : false, "isPartial" : false, "indexVersion" : 2, "direction" : "forward", "indexBounds" : { "update_time" : [ "[1384099200000.0, 1384185600000.0)" ], "content_type_id" : [ "[\"28\", \"28\"]" ] } } }, "rejectedPlans" : [ { "stage" : "FETCH", "filter" : { "content_type_id" : { "$eq" : "28" } }, "inputStage" : { "stage" : "IXSCAN", "keyPattern" : { "update_time" : 1 }, "indexName" : "update_time_1", "isMultiKey" : false, "multiKeyPaths" : { "update_time" : [ ] }, "isUnique" : false, "isSparse" : false, "isPartial" : false, "indexVersion" : 2, "direction" : "forward", "indexBounds" : { "update_time" : [ "[1384099200000.0, 1384185600000.0)" ] } } }, { "stage" : "FETCH", "filter" : { "$and" : [ { "update_time" : { "$lt" : 1384185600000 } }, { "update_time" : { "$gte" : 1384099200000 } } ] }, "inputStage" : { "stage" : "IXSCAN", "keyPattern" : { "content_type_id" : 1 }, "indexName" : "content_type_id_1", "isMultiKey" : false, "multiKeyPaths" : { "content_type_id" : [ ] }, "isUnique" : false, "isSparse" : false, "isPartial" : false, "indexVersion" : 2, "direction" : "forward", "indexBounds" : { "content_type_id" : [ "[\"28\", \"28\"]" ] } } }, { "stage" : "FETCH", "filter" : { "$and" : [ { "update_time" : { "$lt" : 1384185600000 } }, { "update_time" : { "$gte" : 1384099200000 } } ] }, "inputStage" : { "stage" : "IXSCAN", "keyPattern" : { "content_type_id" : 1, "content_id" : 1 }, "indexName" : "content_type_id_1_content_id_1", "isMultiKey" : false, "multiKeyPaths" : { "content_type_id" : [ ], "content_id" : [ ] }, "isUnique" : true, "isSparse" : false, "isPartial" : false, "indexVersion" : 2, "direction" : "forward", "indexBounds" : { "content_type_id" : [ "[\"28\", \"28\"]" ], "content_id" : [ "[MinKey, MaxKey]" ] } } } ] }, "serverInfo" : { "host" : "public-ops-mongodb2.wj.babytree-ops.org", "port" : 29001, "version" : "3.4.2", "gitVersion" : "3f76e40c105fc223b3e5aac3e20dcd026b83b38b" }, "ok" : 1} ÂèëÁé∞Ê≠£Â∏∏Ëµ∞‰∫ÜÁ¥¢Âºï„ÄÇÊÄªÁÆóÊ≤°ÊúâÁôΩÂÅö„ÄÇÂèØÊòØ‰ª£‰ª∑Â§™Â§ß‰∫Ü„ÄÇËøô‰∏™ÊïôËÆ≠ÂëäËØâÊàëÔºåÂú®‰∏çÁÜüÊÇâÁöÑÊï∞ÊçÆÂ∫ìÊìç‰Ωú‰∏ÄÂÆöË¶ÅÊÖéÈáç„ÄÇÈíàÂØπÁ∫ø‰∏äÊìç‰ΩúÔºå‰∏ÄÂÆöË¶ÅÂÜç‰∏âÊÖéÈáç„ÄÇÂºï‰ª•‰∏∫ÊàíÔºÅ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB ÂÆûÁé∞ MySQL ÁöÑ INSERT INTO SELECT]]></title>
    <url>%2F2019%2F04%2F15%2Fmongodb-inset-into-select%2F</url>
    <content type="text"><![CDATA[ËØ¥ÈáëÈí±ÊòØÁΩ™ÊÅ∂ÔºåÈÉΩÂú®ÊçûÔºõËØ¥ÁæéÂ•≥ÊòØÁ•∏Ê∞¥ÔºåÈÉΩÊÉ≥Ë¶ÅÔºõËØ¥È´òÂ§Ñ‰∏çËÉúÂØíÔºåÈÉΩÂú®Áà¨ÔºõËØ¥ÁÉüÈÖí‰º§Ë∫´‰ΩìÔºåÈÉΩ‰∏çÊàíÔºõËØ¥Â§©Â†ÇÊúÄÁæéÂ•ΩÔºåÈÉΩ‰∏çÂéªÔºÅ ÂéüÂõ†ÂÖ¨Âè∏‰∏öÂä°ÊúâË¶ÅÂ∞Ü‰∏Ä‰∏™ÈõÜÂêàÈúÄË¶ÅÊõ¥ÊîπÂêçÁß∞ÔºåÈúÄË¶ÅDBAÂÅöÈÖçÂêà Êìç‰ΩúÊµÅÁ®ã ÂÅúÊ≠¢ÂÖ•Â∫ì Á°ÆËÆ§Â∑≤ÁªèÊääÂ∫ìÂÖ•Êï∞ÊçÆÂÆ°ÂÆå ÈáçÂëΩÂêçcollections ÂàõÂª∫Êñ∞ÈõÜÂêàÁ¥¢Âºïdb.antispam_resource.renameCollection("antispam_resource_20190415");db.createCollection("antispam_resource");db.antispam_resource.ensureIndex({createTs: 1, groupId: 1});db.antispam_resource.ensureIndex({handleTs: 1, opUserId: 1});db.antispam_resource.getIndexes(); Êñ∞Êï∞ÊçÆÂÖ•Â∫ì ÁúãÂÆ°Ê†∏ÂêéÂè∞ÊòØÂê¶ÊúâÊñ∞Êï∞ÊçÆÂÖ•Â∫ìÂπ∂ÂÆ°Ê†∏ ÊääÊúÄËøë1‰∏™ÊúàÊï∞ÊçÆ(antispam_resource_20190415)ÂØºÂÖ•Âà∞antispam_resource ÂÆåÊØï Êìç‰ΩúÊü•Áúã‰∏Ä‰∏ãÂéüÈõÜÂêàÊï∞ÊçÆÈáè1db.antispam_resource.find().count(); ËøõË°åÊõ¥ÊîπÂêçÁß∞Êìç‰Ωú1db.antispam_resource.renameCollection("antispam_resource_20190415") ËøõË°åÂàõÂª∫Á¥¢Âºï123db.antispam_resource.ensureIndex({createTs: 1, groupId: 1});db.antispam_resource.ensureIndex({handleTs: 1, opUserId: 1});db.antispam_resource.getIndexes(); ËøõË°åÊìç‰Ωú MongoDB ÁâàÊú¨ÁöÑ INSERT INTO SELECT12345Á§∫‰æã:db.antispam_resource.find().forEach(function(doc){ print(doc._id); db.antispam_resource.insert(doc)} ); Êìç‰ΩúËØ¶ÁªÜÊ≠•È™§Êü•ÁúãÂéüÈõÜÂêàÂ§ß‰∫é4Êúà1Âè∑ÁöÑÊï∞ÊçÆ123456789101112mgset-11469021:PRIMARY> db.antispam_resource_20190415.find({createTs: { $gte: NumberLong(1554048000) }}).count()2726271mgset-11469021:PRIMARY> db.antispam_resource_20190415.find({createTs: { $lte: NumberLong(1554048000) }}).count()22264682mgset-11469021:PRIMARY> db.antispam_resource.find().count()27824mgset-11469021:PRIMARY> db.antispam_resource.find({ createTs: { $gte: NumberLong(1554048000) }}).count()27861mgset-11469021:PRIMARY> db.antispam_resource.find({ createTs: { $lte: NumberLong(1554048000) }}).count()0mgset-11469021:PRIMARY> db.antispam_resource.find({ createTs: { $gte: NumberLong(1554048000) }}).count()28074 ËøõË°åÊìç‰Ωú12mgset-11469021:PRIMARY> var docs = db.antispam_resource_20190415.find({createTs: { $gte: NumberLong(1554048000) }});mgset-11469021:PRIMARY> docs.forEach( function(d){ db.antispam_resource.insert(d) }); Êï∞ÊçÆÂú®ÊÖ¢ÊÖ¢ÊèíÂÖ•Âà∞Êñ∞ÁöÑÈõÜÂêà‰∏≠ 1234mgset-11469021:PRIMARY> db.antispam_resource_20190415.find({createTs: { $gte:1554048000, $lte:1555311600}}).count()2726271mgset-11469021:PRIMARY> db.antispam_resource.find({createTs: { $gte:1554048000, $lte:1555311600}}).count()2726271 Áªà‰∫éÂØºÂÆå document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL BINLOG Server]]></title>
    <url>%2F2019%2F04%2F03%2Fmysql-binlog-server%2F</url>
    <content type="text"><![CDATA[Èõ∑ÈîãÂÅö‰∫ÜÂ•Ω‰∫ã‰∏çÁïôÂêçÔºå‰ΩÜÊòØÊØè‰∏Ä‰ª∂‰∫ãÊÉÖÈÉΩËÆ∞Âà∞Êó•ËÆ∞ÈáåÈù¢„ÄÇ ÂâçË®ÄMySQL Binlog Server: ÂÆÉ‰ΩøÁî® mysqlbinlog ÂëΩ‰ª§‰ª• daemon ËøõÁ®ãÁöÑÊñπÂºèÊ®°Êãü‰∏Ä‰∏™ slave ÁöÑ IO Á∫øÁ®ã‰∏é‰∏ªÂ∫ìËøûÊé•ÔºåÂèØ‰ª•ÂæàÊñπ‰æøÂú∞Âç≥Êó∂ÂêåÊ≠•‰∏ªÂ∫ìÁöÑ binlogÔºå‰ª•‰æøÂº•Ë°•ÂÆöÊó∂Â§á‰ªΩÁ≠ñÁï•‰∏≠ÊúÄËøë‰∏ÄÊ¨°Â§á‰ªΩÂà∞‰∏ã‰∏ÄÊ¨°Â§á‰ªΩÂÆåÊàê‰πãÂâçËøôÊÆµÊó∂Èó¥ÂÜÖÁöÑÊï∞ÊçÆÂÆπÊòì‰∏¢Â§±ÁöÑÈóÆÈ¢ò„ÄÇ ÂÅöÂ•Ω MySQL Êó•ÂøóÁöÑÂ§á‰ªΩÔºåÊòØÊï∞ÊçÆÂÆâÂÖ®ÁöÑ‰∏Ä‰∏™ÈáçË¶Å‰øùËØÅ„ÄÇ‰ª•ÂâçÈÄöËøáÂÜôÁ®ãÂ∫èÊù•ÂÆûÁé∞Ôºå‰ªé MySQL 5.6 Âá∫Áé∞‰ª•ÂêéÔºåÂèØ‰ª•‰ΩøÁî® mysqlbinlog ÂëΩ‰ª§ÂÆûÁé∞Ôºå‰∏çÁî®ÂÜôÁ®ãÂ∫è‰∫Ü„ÄÇ ÊùÉÈôêÂàõÂª∫Â§çÂà∂Ë¥¶Âè∑1GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%' IDENTIFIED BY 'repl'; 123mysql 5.7CREATE USER 'repl'@'%' IDENTIFIED BY 'repl';GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%' 1FLUSH PRIVILEGES; ÂàõÂª∫BINLOG SERVER1# mysqlbinlog -R --raw --host='192.168.199.230' --port=3306 --user='repl' --password='unixfbi' --stop-never --stop-never-slave-server-id=2313306 mysql-bin.000001 --result-file=/data/mysql/mysql3306/logs/ & ÂëΩ‰ª§ÂèÇÊï∞‰ªãÁªçÔºö -R ‚Äìread-from-remote-server :Ë°®Á§∫‰ªéËøúÁ®ãÊú∫Âô®‰∏äËØªÂèñ binlog,Ë¶ÅÁ°Æ‰øùËøúÁ®ã mysql Â≠òÂÇ®ÔºåÈúÄË¶ÅÊèê‰æõ‚Äìhost, ‚Äìuser, ‚Äìpassword ÂèÇÊï∞; ‰ΩøÁî®ËØ•ÈÄâÈ°πÊó∂Ôºåmysqlbinlog ‰ºö‰º™Ë£ÖÊàê‰∏Ä‰∏™ slaveÔºåËøûÊé•ËØªÂèñÔºåËØ∑Ê±ÇÊåáÂÆöÁöÑ binlog fileÔºå‰∏ªÂ∫ìËé∑ÂèñÊé•Êî∂Âà∞Ëøô‰∏™ËØ∑Ê±Ç‰πãÂêéÂ∞±ÂàõÂª∫‰∏Ä‰∏™ binlog dump Á∫øÁ®ãÊé®ÈÄÅ binlog Áªô mysqlbinlog server„ÄÇ ‚Äìraw: ‰ª• binlog Ê†ºÂºèÂ≠òÂÇ®Êó•ÂøóÔºåÊñπ‰æøÂêéÊúü‰ΩøÁî®; ‚Äìhost: ËøúÁ®ãÂ∫ìÁöÑ‰∏ªÊú∫ IP ÊàñËÄÖ‰∏ªÊú∫Âêç; ‚Äìport: ËøúÁ´ØÂ∫ìÁöÑÁ´ØÂè£Âè∑; ‚Äìuser: ËøúÁ®ãÂ∫ì‰∏äÁî®‰∫éÂ§çÂà∂ÁöÑË¥¶Âè∑; ‚Äìpassword: ËøúÁ´ØÂ∫ì‰∏äÂ§çÂà∂Ë¥¶Âè∑ÁöÑÂØÜÁ†Å; ‚Äìstop-never: ‰∏ÄÁõ¥ËøûÊé•Âà∞ËøúÁ®ãÁöÑ server ‰∏äËØªÂèñ binlog Êó•ÂøóÔºåÁõ¥Êé•Âà∞ËøúÁ®ãÁöÑ server ÂÖ≥Èó≠ÂêéÊâç‰ºöÈÄÄÂá∫„ÄÇÊàñÊòØË¢´ pkill Êéâ; ‚Äìstop-never-slave-server-id: Â¶ÇÊûúÈúÄË¶ÅÂêØÂä®Â§ö‰∏™ binlog server ÔºåÈúÄË¶ÅÁªô binlog server ÊåáÂÆö server-id „ÄÇÂ¶ÇÊûúÈúÄË¶ÅÂêØÂä®Â§ö‰∏™ binlog server,ÈúÄË¶ÅÁªô binlog server ÊåáÂÆö server-id(ÈªòËÆ§ÊòØ 65535)ÔºåÂèØ‰ª•Âà©Áî® ‚Äìstop-never-slave-server-id ÂèòÊõ¥; mysql-bin.0000001 Ëøô‰∏™Êó•ÂøóÂêçË°®Á§∫‰ªéÈÇ£‰∏™Êó•ÂøóÂºÄÂßãËØªÂèñ; ‚Äìresult-file: ÊåáÂÆöÂ≠òÂÇ®Âà∞Êú¨Âú∞ÁöÑÁõÆÂΩïÔºåÊ≥®ÊÑèÂêéÁºÄÈúÄË¶ÅÂä†‰∏ä/ÔºåÂê¶Âàô mysqlbinlog ÂëΩ‰ª§‰ºöËÆ§‰∏∫ÊòØ‰øùÂ≠òÊñá‰ª∂ÁöÑÂâçÁºÄ„ÄÇËã•ÊåáÂÆö‰∫Ü‚Äìraw ÂèÇÊï∞Ôºå-r ÁöÑÂÄºÊåáÂÆö binlog ÁöÑÂ≠òÊîæÁõÆÂΩïÂíåÊñá‰ª∂ÂêçÂâçÁºÄÔºõËã•Ê≤°ÊúâÊåáÂÆö‚Äìraw ÂèÇÊï∞Ôºå-r ÁöÑÂÄºÊåáÂÆöÊñáÊú¨Â≠òÊîæÁöÑÁõÆÂΩïÂíåÊñá‰ª∂Âêç„ÄÇ Ê≥®ÊÑèÔºö ‰ΩøÁî®‚Äìraw ËøûÊé• master Êó∂Ôºå‰ª• 4k ‰∏∫Âçï‰ΩçÂÜôÂÖ•Á£ÅÁõò„ÄÇÂπ∂‰∏çËÉΩÂÆûÊó∂ÂÜôÂÖ•Á£ÅÁõò„ÄÇÈÇ£‰πà‰∏çÂ§ü 4k Êó∂Ôºåbinlog server ‰ªÄ‰πàÊó∂ÂÄôÊâç‰ºöÊääÊó•ÂøóÂÜôÂÖ•Á£ÅÁõòÂë¢Ôºü Êúâ‰∏§ÁßçÊÉÖÂÜµÔºö Á¨¨‰∏ÄÔºöbinlog server Âíå‰∏ªÂ∫ìÊñ≠ÂºÄÊó∂Ôºå Á¨¨‰∫åÔºömaster ÊâßË°å flush logs ÈÉΩ‰ºöÂÆûÊó∂ÊääÊó•ÂøóÂÜôÂÖ•Á£ÅÁõò„ÄÇ mysqlbinlog raw Êúâ‰∏Ä‰∏™ 4k ÁöÑ Buffer ÔºåÂ§ü 4k Â∞±ÂèëËΩ¶„ÄÇ ËÆæÁΩÆ mysqlbinlog ‰∏∫ÂÆàÊä§ËøõÁ®ãÂ¶ÇÊûú master ÈáçÂêØÁöÑËØùÔºåbinlog server ‰∏äÁöÑ mysqlbinlog ËøõÁ®ãÂ∞±‰ºöÈÄÄÂá∫ÔºåÊâÄ‰ª•Êàë‰ª¨ÂÜô‰∏™ËÑöÊú¨Êää mysqlbinlog ËÆæÁΩÆ‰∏∫ÂÆàÊä§ËøõÁ®ãÊñπÂºèËøêË°å1234567891011121314151617181920212223242526#!/bin/bash BACKUP_BIN=/usr/local/mysql/bin/mysqlbinlogLOCAL_BACKUP_DIR=/data/mysql/mysql3306/logs/BACKUP_LOG=/tmp/backup.logREMOTE_HOST=192.168.199.230REMOTE_PORT=3306REMOTE_USER=replREMOTE_PASS=unixfbiFIRST_BINLOG=mysql-bin.000001SLAVE_SERVER_ID=2313306# wait for 10sSLEEP_SECONDS=10cd ${LOCAL_BACKUP_DIR}while :do if [ `ls -A "${LOCAL_BACKUP_DIR}" |wc -l` -eq 0 ];then LAST_FILE=${FIRST_BINLOG} else LAST_FILE=`ls -l ${LOCAL_BACKUP_DIR} |tail -n 1 |awk '{print $NF}'` fi ${BACKUP_BIN} --raw -R --stop-never --host=${REMOTE_HOST} --port=${REMOTE_PORT} --user=${REMOTE_USER} --password=${REMOTE_PASS} --stop-never --stop-never-slave-server-id=${SLAVE_SERVER_ID} ${LAST_FILE} --result-file=${LOCAL_BACKUP_DIR} echo "`date +"%Y/%m/%d %H:%M:%S"` mysqlbinlog is stoped,return code: $?" | tee -a ${BACKUP_LOG} echo "${SLEEP_SECONDS}s will continue !" | tee -a ${BACKUP_LOG} sleep ${SLEEP_SECONDS}done ÊâßË°åËÑöÊú¨1# nohup binlog_cp.sh & ÂèÇËÄÉUnixFBI ËøêÁª¥ÁâπÂ∑• document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnodbË°®Á©∫Èó¥‰º†Ëæì]]></title>
    <url>%2F2019%2F04%2F03%2Finnodb-tablespace-copying%2F</url>
    <content type="text"><![CDATA[‰∏çÂêÉÈ•±Âì™ÊúâÂäõÊ∞îÂáèËÇ•Âïä„ÄÇ innodbË°®Á©∫Èó¥‰º†ËæìÔºåÊòØMySQL5.6ÂºÄÂßãÂä†ÂÖ•ÁöÑÊñ∞ÁâπÊÄßÔºåÊîØÊåÅÊôÆÈÄöË°®Á©∫Èó¥Êã∑Ë¥ùÂà∞ÂÖ∂‰ªñÂÆû‰æã‰∏ãÔºåMySQL5.7ÊîØÊåÅÂàÜÂå∫Ë°®ÁöÑË°®Á©∫Èó¥‰º†ËæìÔºå‰ΩøinnodbË°®ÁöÑÊã∑Ë¥ùÂèòÂæóÊõ¥Âä†ÁÆÄÂçïÂÆπÊòì„ÄÇ Êñπ‰æøÊòØÊñπ‰æø‰∫ÜÔºå‰ΩÜ‰πüË¶ÅÈúÄË¶ÅÊ≥®ÊÑè: innodbË°®Á©∫Èó¥‰º†Ëæì‰∏çË¶ÅÁî®Êù•ÂÅö‰∏ª‰ªéÂ§çÂà∂ÔºåÂê¶Âàô‰ºöÂá∫Áé∞Êï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÈóÆÈ¢ò; ‰ΩøÁî®‰πãÂâçÔºåË¶ÅÁ°ÆËÆ§‰ΩøÁî®‰∫Üinnodb_file_per_tableÂç≥Áã¨Á´ãË°®Á©∫Èó¥; Âú®Ë°®Á©∫Èó¥ÂØºÂá∫ÁöÑËøáÁ®ã‰∏≠Ôºå‰∫ãÂä°‰∏çËÉΩËøõË°åÂÜôÊìç‰Ωú, Â∫îËØ•Ê≥®ÊÑèÈÄâÊã©Êìç‰ΩúÊó∂Èó¥, Â∫îËØ•ÈÄâÊã©‰∏öÂä°‰ΩéÂ≥∞ÊúüÊìç‰Ωú; ÈªòËÆ§‰∏çÊîØÊåÅÂØºÂá∫ÊúâÂ§ñÈîÆÁöÑË°®, ÂèØ‰ª•ÈÄöËøáset foreign_key_checks=0Âº∫Âà∂ÂøΩÁï•, ‰ΩÜ‰ªÖÈôê‰∫éÊôÆÈÄöË°®, ËÄåÂàÜÂå∫Ë°®ÊöÇÊó∂‰∏çÊîØÊåÅËøôÊ†∑Êìç‰Ωú„ÄÇ Êàë‰ª¨Áü•ÈÅì‰∫ÜinnodbË°®Á©∫Èó¥‰º†ËæìÁöÑÁâπÁÇπÂíå‰ΩøÁî®Ê≥®ÊÑè‰∫ãÈ°π, Áé∞Âú®ËÄÉËôë‰∏Ä‰∏ãÂ∫îÁî®Âú∫ÊôØ„ÄÇÂõ†‰∏∫‰∏çÂÅö‰∏ª‰ªéÂ§çÂà∂ÔºåÂ∞±Âè™ËÉΩÂÅö‰∏Ä‰∫õÁ¶ªÁ∫øÊñπÈù¢ÁöÑ‰ΩøÁî®ÔºåÊØîÂ¶ÇÊääÁ∫ø‰∏äÊüê‰∏™Áîü‰∫ßË°®ÊãøÂà∞Á¶ªÁ∫øÁéØÂ¢ÉÂÅöÁªüËÆ°ÂàÜÊûêÁ≠âÁ≠â„ÄÇ ‰∏ãÈù¢‰ªãÁªçinnodbÊôÆÈÄöË°®Á©∫Èó¥‰º†ËæìÂíåÂàÜÂå∫Ë°®Á©∫Èó¥‰º†ËæìÁöÑÊìç‰ΩúËøáÁ®ã1.innodbÊôÆÈÄöË°®Á©∫Èó¥‰º†Ëæì 1.1ÁõÆÊ†áÂ∫ì123mysql> create table t2(id int auto_increment, name varchar(20), primary key(id));mysql> insert into t2(name) values('aa'),('bb'),('cc');mysql> alter table t2 discard tablespace; 1.2 Ê∫êÂ∫ì12345mysql> flush tables t2 for export;shell> scp -P2222 /data/mysql/mysql_3306/data/db1/t2.{cfg,ibd} 172.16.123.103:/data/mysql/mysql_3306/data/test/mysql> unlock tables; 1.3 ÁõÆÊ†áÂ∫ì123shell> chown mysql.mysql /data/mysql/mysql_3306/data/test/t2.*mysql> alter table t2 import tablespace; 2.innodbÂàÜÂå∫Ë°®Á©∫Èó¥‰º†ËæìÊµãËØïÂàÜÂå∫Ë°®ÁªìÊûÑ1mysql> create table t3(id int auto_increment, name varchar(20), primary key(id)) partition by key(id) partitions 4; 2.1 ÁõÆÊ†áÂ∫ì1mysql> create table t3(id int auto_increment, name varchar(20), primary key(id)) partition by key(id) partitions 4; ÊèíÂÖ•ÊµãËØïÊï∞ÊçÆ(ÁúÅÁï•)2.2 Ê∫êÂ∫ì12345mysql> flush tables t3 for export; #ÂØºÂá∫Êï¥‰∏™ÂàÜÂå∫Ë°®shell> cp -a /data/mysql/mysql_3306/data/db1/t3* /var/tmp/mysql> unlock tables; 2.3 ÁõÆÊ†áÂ∫ì 2.3.1 ÂØºÂÖ•ÂÖ®Êï∞ÂàÜÂå∫1234ÁõÆÊ†áÂ∫ìmysql> alter table t3 discard tablespace;Êàñmysql> alter table t3 discard partition all tablespace; 123Ê∫êÂ∫ìshell> scp -P2222 -r t3* 172.16.123.103:/data/mysql/mysql_3306/data/test/shell> chown mysql.mysql /data/mysql/mysql_3306/data/test/ -R 12ÁõÆÊ†áÂ∫ìmysql> alter table t3 import tablespace; 2.3.2 ÂØºÂÖ•ÊåáÂÆöÂàÜÂå∫Âè™ÂØºp1ÂàÜÂå∫12ÁõÆÊ†áÂ∫ìmysql> alter table t3 discard partition p1 tablespace; 12Ê∫êÂ∫ìshell> scp -P2222 -r t3p1 172.16.123.103:/data/mysql/mysql_3306/data/test/ 12ÁõÆÊ†áÂ∫ìmysql> alter table t3 import partition p1 tablespace; ÊÄªÁªìÊ∫êÂ∫ì‰∏äflush tables tbname for export;‚Äî>Êã∑Ë¥ùÊñá‰ª∂‚Äì>unlock tables; ÁõÆÊ†áÂ∫ì‰∏äalter table tbname discard [partition partition_names | ALL] tablespace;‚Äì>Êã∑Ë¥ùÊñá‰ª∂ËøáÊù•,ÊîπÊùÉÈôê‚Äì>alter table tbname IMPORT [PARTITION partition_names | ALL] TABLESPACE; ÂÜçÊ¨°ÊèêÈÜí ÂÅöflush tables xx discard tablespace‰πãÂâçÔºåÂä°ÂøÖ‰∏âÊÄù, ‰∏ÄÂÆöË¶ÅÊêûÊ∏ÖÊ•öÂú®Âì™‰∏™Â∫ìÊìç‰Ωú, ‰∏á‰∏ÄÂú®Áîü‰∫ßÂ∫ì‰∏äÊìç‰ΩúÔºåËøôÂ∞±ÊÇ≤Ââß‰∫Ü! ËΩ¨ËΩΩHuang Jinqiang document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰ªéMySQLÊ∫êÁ†ÅÂ≠¶‰π†ËøêÁª¥Innodb bufferÂëΩ‰∏≠ÁéáËÆ°ÁÆó]]></title>
    <url>%2F2019%2F04%2F03%2Fmysql-innodb-buffer-pool-hit%2F</url>
    <content type="text"><![CDATA[Â§©Ê≤°ÈôçÂ§ß‰ªª‰∫éÊàëÔºåÁÖßÊ†∑Ëã¶ÊàëÂøÉÊô∫ÔºåÂä≥ÊàëÁ≠ãÈ™®„ÄÇ ËÆ°ÁÆóÂÖ¨ÂºèÊåâÂÆòÊñπÊâãÂÜåÊé®ËçêInnodb buffer Hit RatiosÁöÑËÆ°ÁÆóÊòØ:123100-((iReads / iReadRequests)*100)iReads : mysql->status->Innodb_buffer_pool_readsiReadRequests: mysql->status->Innodb_buffer_pool_read_requests mysqlsqlreport‰∏≠ÂÖ≥‰∫ébufferÂëΩ‰∏≠ËÆ°ÁÆóÊòØ:1ib_bp_hit=100-(Innodb_buffer_pool_reads/Innodb_buffer_pool_read_requests)*100 Âè¶Â§ñÊàë‰ª¨Áü•ÈÅìÊü•ÁúãInnodb Buffer Hit RatiosÁöÑÂú∞ÊñπÊòØ:12show engine innodb status\G;Buffer pool hit rate : XXXX/1000; ÈÇ£‰∏™XXX/1000Âç≥ÊòØbuffer pool hit ratiosÁöÑÂëΩ‰∏≠. innodb buffer hit RatiosÁöÑÂëΩ‰∏≠ËÆ°ÁÆóÈúÄË¶ÅÊú¨Ê¨°ÂèñÁöÑÂÄºÂíå‰∏äÊ¨°ÂÄºÂÅö‰∏Ä‰∏™ÂáèÊ≥ïÂÖ¨ÂºèÂ∫îËØ•‰∏∫1ib_bp_hit=1000 ‚Äì (t2.iReads ‚Äì t1.iReads)/(t2.iReadRequest ‚Äì t1.iReadRequest)*1000 t(n): Êó∂Èó¥ÁÇπ ‰∏§‰∏™Êó∂Èó¥Èó¥ÈöîÊúÄÂ∞ëÊòØ30Áßí‰ª•‰∏ä,Âú®Â∞èÊÑè‰πâ‰∏çÂ§ß. iReads: Innodb_buffer_pool_reads iReadRequest: Innodb_buffer_pool_read_requests ÊÄùËÄÉ:ÂØπ‰∫éinnodb_buffer_pool_read_requests, innodb_buffer_pool_readsËøôÁßçÁ¥ØÂä†ÂÄº,ÂΩìÂæàÂ§ßÊó∂ËøõË°å: innodb_buffer_pool_reads/innodb_buffer_pool_read_requests Áõ∏Êù•ËÆ≤Âè™ËÉΩÂæóÂà∞‰ªéÂºÄÂßãÂà∞Áé∞Âú®ÁöÑÂëΩ‰∏≠ÁéáÁöÑË°®Áé∞‰∫Ü. Â¶ÇÊûúÊÉ≥ÂæóÂà∞Áé∞Âú®Ëøë‰∫îÂàÜÈíü,Ëøë‰∏ÄÂàÜÈíüÊàñÊòØ8ÁÇπÂà∞9ÁÇπÊØèÂàÜÈíüÁöÑÂëΩ‰∏≠ÁéáÊÉÖÂÜµ,Â¶ÇÊûúËøòÊòØÊåâÁùÄinnodb_buffer_pool_reads/innodb_buffer_pool_read_requests ËøõË°åËÆ°ÁÆó,Âè™ËÉΩÂæóÂà∞mysqldÂºÄËµ∑Á¥ØËÆ°Âú®8ÁÇπ-9ÁÇπÁöÑÊØèÂàÜÈíüÁöÑÁ¥ØËÆ°Âπ≥ÂùáÂëΩ‰∏≠ÊÉÖÂÜµ. ÊâÄ‰ª•Â¶ÇÊûúÊÉ≥Âà∞ÊØè(‰∫î)ÂàÜÈíüÁöÑÂëΩ‰∏≠ÊÉÖÂÜµ,Â∞±ÈúÄË¶ÅÊú¨Ê¨°ÂèñÂæóÁöÑÂÄºÂíå‰∏Ä(‰∫î)ÂàÜÈíüÂâçÁöÑÂÄºËøõË°åÁõ∏Âáè,ÁÑ∂ÂêéËøõË°åËøêÁÆó.ËøôÊ†∑ÊâçËÉΩÂæóÂà∞‰∏Ä‰∏™ÂΩì‰∏ãÁöÑbpÂëΩ‰∏≠ÊÉÖÂÜµ. ‰∏§ÁßçÊñπÊ≥ïÊ≤°ÂÆûË¥®ÁöÑÂØπÈîôÁöÑÈóÆÈ¢ò,‰ΩÜÁõ∏ÂØπ‰∫éÊ∫êÁ†Å‰∏≠ÁöÑÈÇ£ÁßçËÆ°ÁÆóÊñπÂºèÊõ¥ÂÆπËÆ©ÂèëÁé∞Êï∞ÊçÆÂ∫ìÁöÑÊäñÂä®ÈóÆÈ¢ò. ËÉΩËß£ÂÜ≥ÁöÑÈóÆÈ¢ò: ÂÅ∂ËÄåÁöÑÊï∞ÊçÆÂ∫ìÊÄßËÉΩÊäñÂä®ËÉΩÁõ¥ËßÇÁöÑÂèçÂ∫îÂá∫Êù•. ËΩ¨ËΩΩÂê¥ ÁÇ≥Èî°(Êï∞ÊçÆÂ∫ìÊû∂ÊûÑÂ∏à):‰ªéMySQLÊ∫êÁ†ÅÂ≠¶‰π†ËøêÁª¥Innodb bufferÂëΩ‰∏≠ÁéáËÆ°ÁÆó document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux‰∏≠SHELLÂÜÖÁΩÆgetoptsÂëΩ‰ª§Ëé∑ÂèñÂëΩ‰ª§Ë°åÂèÇÊï∞]]></title>
    <url>%2F2019%2F04%2F03%2Fshell-getopts%2F</url>
    <content type="text"><![CDATA[ÂÅö‰∫∫Â¶ÇÊûúÊ≤°ÊúâÊ¢¶ÊÉ≥ÔºåÈÇ£ÂíåÂí∏È±ºÊúâ‰ΩïÂå∫Âà´Ôºü ÂâçË®ÄÂÜôÁ®ãÂ∫èÁöÑÊó∂ÂÄôÁªèÂ∏∏Ë¶ÅÂ§ÑÁêÜÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºåÊú¨ÊñáÊèèËø∞Âú®Bash‰∏ãÁöÑÂëΩ‰ª§Ë°åÂ§ÑÁêÜÊñπÂºè„ÄÇ ÈÄâÈ°π‰∏éÂèÇÊï∞: Â¶Ç‰∏ã‰∏Ä‰∏™ÂëΩ‰ª§Ë°å:1/test.sh -f config.conf -v --prefix=/home Êàë‰ª¨Áß∞-f‰∏∫ÈÄâÈ°πÔºåÂÆÉÈúÄË¶Å‰∏Ä‰∏™ÂèÇÊï∞ÔºåÂç≥config.conf, -v ‰πüÊòØ‰∏Ä‰∏™ÈÄâÈ°πÔºå‰ΩÜÂÆÉ‰∏çÈúÄË¶ÅÂèÇÊï∞„ÄÇ ‚ÄìprefixÊàë‰ª¨Áß∞‰πã‰∏∫‰∏Ä‰∏™ÈïøÈÄâÈ°πÔºåÂç≥ÈÄâÈ°πÊú¨Ë∫´Â§ö‰∫é‰∏Ä‰∏™Â≠óÁ¨¶ÔºåÂÆÉ‰πüÈúÄË¶Å‰∏Ä‰∏™ÂèÇÊï∞ÔºåÁî®Á≠âÂè∑ËøûÊé•ÔºåÂΩìÁÑ∂Á≠âÂè∑‰∏çÊòØÂøÖÈ°ªÁöÑÔºå/homeÂèØ‰ª•Áõ¥Êé•ÂÜôÂú®‚ÄìprefixÂêéÈù¢ÔºåÂç≥‚Äìprefix/home,Êõ¥Â§öÁöÑÈôêÂà∂ÂêéÈù¢ÂÖ∑‰Ωì‰ºöËÆ≤Âà∞„ÄÇ Âú®bash‰∏≠ÔºåÂèØ‰ª•Áî®‰ª•‰∏ã‰∏âÁßçÊñπÂºèÊù•Â§ÑÁêÜÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºåÊØèÁßçÊñπÂºèÈÉΩÊúâËá™Â∑±ÁöÑÂ∫îÁî®Âú∫ÊôØ„ÄÇ ÊâãÂ∑•Â§ÑÁêÜÊñπÂºè getopts getopt Áî±‰∫éshellÂëΩ‰ª§Ë°åÁöÑÁÅµÊ¥ªÊÄßÔºåËá™Â∑±ÁºñÂÜô‰ª£Á†ÅÂà§Êñ≠Êó∂ÔºåÂ§çÊùÇÂ∫¶‰ºöÊØîËæÉÈ´ò„ÄÇ‰ΩøÁî®ÂÜÖÈÉ®ÂëΩ‰ª§ getopts ÂèØ‰ª•ÂæàÊñπ‰æøÂú∞Â§ÑÁêÜÂëΩ‰ª§Ë°åÂèÇÊï∞„ÄÇ‰∏ÄËà¨Ê†ºÂºè‰∏∫Ôºö Ë∞ÉÁî®Ê†ºÂºèÔºö1getopts options variable getopts ÁöÑËÆæËÆ°ÁõÆÊ†áÊòØÂú®Âæ™ÁéØ‰∏≠ËøêË°åÔºåÊØèÊ¨°ÊâßË°åÂæ™ÁéØÔºågetopts Â∞±Ê£ÄÊü•‰∏ã‰∏Ä‰∏™ÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºåÂπ∂Âà§Êñ≠ÂÆÉÊòØÂê¶ÂêàÊ≥ï„ÄÇÂç≥Ê£ÄÊü•ÂèÇÊï∞ÊòØÂê¶‰ª• - ÂºÄÂ§¥ÔºåÂêéÈù¢Ë∑ü‰∏Ä‰∏™ÂåÖÂê´Âú® options ‰∏≠ÁöÑÂ≠óÊØç„ÄÇÂ¶ÇÊûúÊòØÔºåÂ∞±ÊääÂåπÈÖçÁöÑÈÄâÈ°πÂ≠óÊØçÂ≠òÂú®ÊåáÂÆöÁöÑÂèòÈáè variable ‰∏≠ÔºåÂπ∂ËøîÂõûÈÄÄÂá∫Áä∂ÊÄÅ0ÔºõÂ¶ÇÊûú - ÂêéÈù¢ÁöÑÂ≠óÊØçÊ≤°ÊúâÂåÖÂê´Âú® options ‰∏≠ÔºåÂ∞±Âú® variable ‰∏≠Â≠òÂÖ•‰∏Ä‰∏™ ÔºüÔºåÂπ∂ËøîÂõûÈÄÄÂá∫Áä∂ÊÄÅ0ÔºõÂ¶ÇÊûúÂëΩ‰ª§Ë°å‰∏≠Â∑≤ÁªèÊ≤°ÊúâÂèÇÊï∞ÔºåÊàñËÄÖ‰∏ã‰∏Ä‰∏™ÂèÇÊï∞‰∏ç‰ª• - ÂºÄÂ§¥ÔºåÂ∞±ËøîÂõû‰∏ç‰∏∫0ÁöÑÈÄÄÂá∫Áä∂ÊÄÅ„ÄÇ ÂèÇÊï∞ËØ¥ÊòéÔºö option_string ÈÄâÈ°πÂêçÁß∞ variable ÈÄâÈ°πÁöÑÂÄº ÈÄâÈ°π‰πãÈó¥‰ΩøÁî®ÂÜíÂè∑:ÂàÜÈöîÔºå‰πüÂèØ‰ª•Áõ¥Êé•ËøûÊé•Ôºå : Ë°®Á§∫ÈÄâÈ°πÂêéÈù¢Êúâ‰º†ÂÄº„ÄÇ ÂΩìgetoptsÂëΩ‰ª§ÂèëÁé∞ÂÜíÂè∑ÂêéÔºå‰ºö‰ªéÂëΩ‰ª§Ë°åËØ•ÈÄâÈ°πÂêéËØªÂèñËØ•ÂÄº„ÄÇÂ¶ÇËØ•ÂÄºÂ≠òÂú®ÔºåÂ∞Ü‰øùÂ≠òÂú®ÁâπÊÆäÁöÑÂèòÈáèOPTARG‰∏≠„ÄÇ ÂΩìoption_stringÁî®:ÂºÄÂ§¥Ôºågetopts‰ºöÂå∫ÂàÜinvalid optionÈîôËØØÂíåmiss option argumentÈîôËØØ„ÄÇ invalid optionÊó∂, varname‰ºöË¢´ËÆæÊàê? miss option argumentÊó∂Ôºåvarname‰ºöË¢´ËÆæÊàê: Â¶ÇÊûúoption_string‰∏çÁî®:ÂºÄÂ§¥Ôºåinvalid optionÈîôËØØÂíåmiss option argumentÈîôËØØÈÉΩ‰ºö‰ΩøvarnameË¢´ËÆæÊàê?„ÄÇ getoptsÂåÖÂê´‰∏§‰∏™ÂÜÖÁΩÆÂèòÈáèÔºåOPTARGÂíåOPTIND OPTARG ‰øùÂ≠òÈÄâÈ°πÂêéÁöÑÂèÇÊï∞ÂÄº OPTIND Ë°®Á§∫ÂëΩ‰ª§Ë°å‰∏ã‰∏Ä‰∏™ÈÄâÈ°πÊàñÂèÇÊï∞ÁöÑÁ¥¢Âºï ‰ΩøÁî®Á§∫‰æã‰æãÂ≠ê1: ‰ΩøÁî®getoptsÂëΩ‰ª§Ëé∑ÂèñÂèÇÊï∞123456789101112131415161718#!/bin/bashwhile getopts a:b:c:d opts; do case $opts in a) a=$OPTARG ;; b) b=$OPTARG ;; c) c=$OPTARG ;; d) d=$OPTARG ;; ?) ;; esacdoneecho "a=$a"echo "b=$b"echo "c=$c"echo "d=$d"exit 0 ÊâßË°åËæìÂá∫12345./test.sh -a 1 -b 2 -c 3 -d 4a=1b=2c=3d= option_string aüÖ±c:d a,b,cÂêéÈÉΩÊúâ: dÂêéÊ≤°Êúâ: ÊâÄ‰ª•ÂèØ‰ª•Ëé∑ÂèñÂà∞a,b,cÁöÑÂÄº ‰æãÂ≠ê2: option_stringÂâçÂä†:‰∏ä‰æã‰∏≠ÔºåÂ¶ÇÊûúa,b,c‰ªªÊÑè‰∏Ä‰∏™Ê≤°Êúâ‰º†ÂÄºÔºåÂ∞Ü‰ºöÊèêÁ§∫Âá∫Èîô„ÄÇ‰æãÂ¶Ç -c ‰∏ç‰º†ÂÄº„ÄÇ123456./test.sh -a 1 -b 2 -c./test.sh: option requires an argument -- ca=1b=2c=d= Êàë‰ª¨Âú®option_stringÂâçÂä†‰∏ä:ÔºåÂàôÂèØ‰ª•Â±èËîΩËøô‰∏™ÈîôËØØ123456789101112131415161718#!/bin/bashwhile getopts :a:b:c:d opts; do case $opts in a) a=$OPTARG ;; b) b=$OPTARG ;; c) c=$OPTARG ;; d) d=$OPTARG ;; ?) ;; esacdoneecho "a=$a"echo "b=$b"echo "c=$c"echo "d=$d"exit 0 ÊâßË°åËæìÂá∫12345./test.sh -a 1 -b 2 -ca=1b=2c=d= Âú®option_stringÂâçÂä†‰∏ä:ÔºåÂèØ‰ª•Â±èËîΩÁº∫Â§±‰º†ÂÄºÁöÑÈîôËØØÔºå‰ΩÜÂ¶ÇÊûúÁº∫Â§±ÁöÑÊòØÂâçÈù¢ÈÄâÈ°πÁöÑÂÄºÔºåÈÇ£‰πàËé∑ÂèñÂà∞ÁöÑÂÄºÂ∞Ü‰ºöÈîôËØØ„ÄÇ ‰æãÂ¶ÇÁº∫Â§±aÁöÑ‰º†ÂÄºÔºåÂëΩ‰ª§‰ºöÊää-aÂêéÁöÑ-b‰Ωú‰∏∫‰∫Ü-aÁöÑÂÄºÔºåÂØºËá¥ÈîôËØØ„ÄÇ12345./test.sh -a -b 2 -c 3a=-bb=c=d= Âõ†Ê≠§‰ΩøÁî®getoptsÂëΩ‰ª§Êó∂ÔºåÂØπ‰∫éÊ≤°Êúâ‰º†ÂÄºÁöÑÈÄâÈ°πÔºåÈÄâÈ°πÂêçÁß∞‰πü‰∏çË¶ÅÂä†ÂÖ•ÂëΩ‰ª§Ë°å‰∏≠„ÄÇ‰æãÂ¶Ça‰∏ç‰º†ÂÄºÔºåÂàô-a‰∏çË¶ÅÂä†ÂÖ•ÂëΩ‰ª§Ë°å„ÄÇ12345./test.sh -b 2 -c 3a=b=2c=3d= SHELL ‰ª£Á†Å‰ª•‰∏äÊòØÁ§∫‰æãÔºå‰∏ãÈù¢Ë¥¥‰∏äÊàëÂÜôÁöÑËÑöÊú¨‰ª£Á†ÅÔºö123456789101112131415161718192021222324252627282930313233343536373839404142434445#!/bin/bash## Author: Created by jiemin.wang# QQ: 278667010# E-mail: 278661010@qq.com or wangjiemin880228@gmail.com# Created Time: Wed Apr 3 14:15:12 CST 2019# function: This is tcpdump grabs SQL executed by MySQL# version: 1.0function usage(){ echo "Usage:" echo " $(basename $0) [OPTION]:" echo " -n net" echo " -P port"}if [ $# -eq "0" ];then usage exit 1fiwhile getopts :n:P: argdo case $arg in n) net=$OPTARG ;; P) port=$OPTARG ;; esacdone#tcpdump -i "$net" -s 0 -l -w - dst port "$port" | strings | perl -e 'tcpdump -i "$net" -s 0 -l -w file dst port "$port" | strings | perl -e '#!/bin/bashwhile() { chomp; next if /^[^ ]+[ ]*$/; if(/^(SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER|CALL)/i) { if (defined $q) { print "$q\n"; } $q=$_; } else { $_ =~ s/^[ \t]+//; $q.=" $_"; }}' ÂÖ∂‰ªñÁ§∫‰æãÂú®ÁΩë‰∏äÊâæ‰∫Ü‰∏Ä‰∏™Á§∫‰æã,Ë¥¥‰∏äÊù•,‰ªÖ‰æõÂèÇËÄÉ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#!/bin/bash QUIET=VERBOSE=DEVICE=LOGFILE=/tmp/defaultusage(){ echo "Usage: `basename $0` [-qv] [-l LOGFILE] -d DEVICE input_file [input_file2...]" exit 1}[ $# -eq 0 ] && usage#option_string‰ª•ÂÜíÂè∑ÂºÄÂ§¥Ë°®Á§∫Â±èËîΩËÑöÊú¨ÁöÑÁ≥ªÁªüÊèêÁ§∫ÈîôËØØÔºåËá™Â∑±Â§ÑÁêÜÈîôËØØÊèêÁ§∫„ÄÇ#ÂêéÈù¢Êé•ÂêàÊ≥ïÁöÑÂçïÂ≠óÊØçÈÄâÈ°πÔºåÈÄâÈ°πÂêéËã•ÊúâÂÜíÂè∑ÔºåÂàôË°®Á§∫ËØ•ÈÄâÈ°πÂøÖÈ°ªÊé•ÂÖ∑‰ΩìÁöÑÂèÇÊï∞while getopts :qvd:l: OPTIONdo case $OPTION in q) QUIET=y ;; v) VERBOSE=y ;; d) DEVICE=$OPTARG #$OPTARG‰∏∫ÁâπÊÆäÂèòÈáèÔºåË°®Á§∫ÈÄâÈ°πÁöÑÂÖ∑‰ΩìÂèÇÊï∞ ;; l) LOGFILE=$OPTARG ;; \?) #Â¶ÇÊûúÂá∫Áé∞ÈîôËØØÔºåÂàôËß£Êûê‰∏∫? usage ;; esacdone#$OPTIND‰∏∫ÁâπÊÆäÂèòÈáèÔºåË°®Á§∫Á¨¨Âá†‰∏™ÈÄâÈ°πÔºåÂàùÂßãÂÄº‰∏∫1shift $(($OPTIND - 1)) #Èô§‰∫ÜÈÄâÈ°π‰πãÂ§ñÔºåËØ•ËÑöÊú¨ÂøÖÈ°ªÊé•Ëá≥Â∞ë‰∏Ä‰∏™ÂèÇÊï∞if [ $# -eq 0 ]; then usagefiif [ -z "$DEVICE" ]; then #ËØ•ËÑöÊú¨ÂøÖÈ°ªÊèê‰æõ-dÈÄâÈ°π echo "You must specify DEVICE with -d option" exitfiecho "you chose the following options.."echo "Quiet=$QUIET VERBOSE=$VERBOSE DEVICE=$DEVICE LOGFILE=$LOGFILE"for file in $@ #‰æùÊ¨°Â§ÑÁêÜÂâ©‰ΩôÁöÑÂèÇÊï∞do echo "Processing $file"done document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux ÊäÄÂ∑ßÔºö‰ΩøÁî® screen ÁÆ°ÁêÜ‰Ω†ÁöÑËøúÁ®ã‰ºöËØù]]></title>
    <url>%2F2019%2F04%2F02%2Flinux-screen%2F</url>
    <content type="text"><![CDATA[ÊúâÊú¨‰∫ãÔºå‰Ω†Êù•È°∫ÁùÄÁΩëÁ∫øÁà¨ËøáÊù•Ôºå‰Ω†Êù•Âí¨ÊàëÂëÄ ÂâçË®Ä‰Ω†ÊòØ‰∏çÊòØÁªèÂ∏∏ÈúÄË¶Å SSH ÊàñËÄÖ telent ËøúÁ®ãÁôªÂΩïÂà∞ Linux ÊúçÂä°Âô®Ôºü‰Ω†ÊòØ‰∏çÊòØÁªèÂ∏∏‰∏∫‰∏Ä‰∫õÈïøÊó∂Èó¥ËøêË°åÁöÑ‰ªªÂä°ËÄåÂ§¥ÁñºÔºåÊØîÂ¶ÇÁ≥ªÁªüÂ§á‰ªΩ„ÄÅftp ‰º†ËæìÁ≠âÁ≠â„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÊàë‰ª¨ÈÉΩÊòØ‰∏∫ÊØè‰∏Ä‰∏™ËøôÊ†∑ÁöÑ‰ªªÂä°ÂºÄ‰∏Ä‰∏™ËøúÁ®ãÁªàÁ´ØÁ™óÂè£ÔºåÂõ†‰∏∫‰ªñ‰ª¨ÊâßË°åÁöÑÊó∂Èó¥Â§™Èïø‰∫Ü„ÄÇÂøÖÈ°ªÁ≠âÂæÖÂÆÉÊâßË°åÂÆåÊØïÔºåÂú®Ê≠§ÊúüÈó¥ÂèØ‰∏çËÉΩÂÖ≥ÊéâÁ™óÂè£ÊàñËÄÖÊñ≠ÂºÄËøûÊé•ÔºåÂê¶ÂàôËøô‰∏™‰ªªÂä°Â∞±‰ºöË¢´ÊùÄÊéâÔºå‰∏ÄÂàáÂçäÈÄîËÄåÂ∫ü‰∫Ü„ÄÇ ÂÖÉÂá∂ÔºöSIGHUP ‰ø°Âè∑ËÆ©Êàë‰ª¨Êù•ÁúãÁúã‰∏∫‰ªÄ‰πàÂÖ≥ÊéâÁ™óÂè£/Êñ≠ÂºÄËøûÊé•‰ºö‰ΩøÂæóÊ≠£Âú®ËøêË°åÁöÑÁ®ãÂ∫èÊ≠ªÊéâ„ÄÇ Âú®Linux/Unix‰∏≠ÔºåÊúâËøôÊ†∑Âá†‰∏™Ê¶ÇÂøµ: ËøõÁ®ãÁªÑÔºàprocess groupÔºâÔºö‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËøõÁ®ãÁöÑÈõÜÂêàÔºåÊØè‰∏Ä‰∏™ËøõÁ®ãÁªÑÊúâÂîØ‰∏Ä‰∏Ä‰∏™ËøõÁ®ãÁªÑIDÔºåÂç≥ËøõÁ®ãÁªÑÈïøËøõÁ®ãÁöÑID„ÄÇ ‰ºöËØùÊúüÔºàsessionÔºâÔºö‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËøõÁ®ãÁªÑÁöÑÈõÜÂêàÔºåÊúâÂîØ‰∏Ä‰∏Ä‰∏™‰ºöËØùÊúüÈ¶ñËøõÁ®ãÔºàsession leaderÔºâ„ÄÇ‰ºöËØùÊúüID‰∏∫È¶ñËøõÁ®ãÁöÑID„ÄÇ ‰ºöËØùÊúüÂèØ‰ª•Êúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊéßÂà∂ÁªàÁ´ØÔºàcontrolling terminalÔºâ„ÄÇ‰∏éÊéßÂà∂ÁªàÁ´ØËøûÊé•ÁöÑ‰ºöËØùÊúüÈ¶ñËøõÁ®ãÂè´ÂÅöÊéßÂà∂ËøõÁ®ãÔºàcontrolling processÔºâ„ÄÇÂΩìÂâç‰∏éÁªàÁ´Ø‰∫§‰∫íÁöÑËøõÁ®ãÁß∞‰∏∫ÂâçÂè∞ËøõÁ®ãÁªÑ„ÄÇÂÖ∂‰ΩôËøõÁ®ãÁªÑÁß∞‰∏∫ÂêéÂè∞ËøõÁ®ãÁªÑ„ÄÇ Ê†πÊçÆPOSIX.1ÂÆö‰πâ: ÊåÇÊñ≠‰ø°Âè∑ÔºàSIGHUPÔºâÈªòËÆ§ÁöÑÂä®‰ΩúÊòØÁªàÊ≠¢Á®ãÂ∫è„ÄÇ ÂΩìÁªàÁ´ØÊé•Âè£Ê£ÄÊµãÂà∞ÁΩëÁªúËøûÊé•Êñ≠ÂºÄÔºåÂ∞ÜÊåÇÊñ≠‰ø°Âè∑ÂèëÈÄÅÁªôÊéßÂà∂ËøõÁ®ãÔºà‰ºöËØùÊúüÈ¶ñËøõÁ®ãÔºâ„ÄÇ Â¶ÇÊûú‰ºöËØùÊúüÈ¶ñËøõÁ®ãÁªàÊ≠¢ÔºåÂàôËØ•‰ø°Âè∑ÂèëÈÄÅÂà∞ËØ•‰ºöËØùÊúüÂâçÂè∞ËøõÁ®ãÁªÑ„ÄÇ ‰∏Ä‰∏™ËøõÁ®ãÈÄÄÂá∫ÂØºËá¥‰∏Ä‰∏™Â≠§ÂÑøËøõÁ®ãÁªÑ‰∏≠‰∫ßÁîüÊó∂ÔºåÂ¶ÇÊûú‰ªªÊÑè‰∏Ä‰∏™Â≠§ÂÑøËøõÁ®ãÁªÑËøõÁ®ãÂ§Ñ‰∫éSTOPÁä∂ÊÄÅÔºåÂèëÈÄÅSIGHUPÂíåSIGCONT‰ø°Âè∑Âà∞ËØ•ËøõÁ®ãÁªÑ‰∏≠ÊâÄÊúâËøõÁ®ã„ÄÇ Âõ†Ê≠§ÂΩìÁΩëÁªúÊñ≠ÂºÄÊàñÁªàÁ´ØÁ™óÂè£ÂÖ≥Èó≠ÂêéÔºåÊéßÂà∂ËøõÁ®ãÊî∂Âà∞SIGHUP‰ø°Âè∑ÈÄÄÂá∫Ôºå‰ºöÂØºËá¥ËØ•‰ºöËØùÊúüÂÜÖÂÖ∂‰ªñËøõÁ®ãÈÄÄÂá∫„ÄÇ Êàë‰ª¨Êù•Áúã‰∏Ä‰∏™‰æãÂ≠ê„ÄÇÊâìÂºÄ‰∏§‰∏™SSHÁªàÁ´ØÁ™óÂè£ÔºåÂú®ÂÖ∂‰∏≠‰∏Ä‰∏™ËøêË°åtopÂëΩ‰ª§„ÄÇ1test_dbs2 ~ # top Âú®Âè¶‰∏Ä‰∏™ÁªàÁ´ØÁ™óÂè£ÔºåÊâæÂà∞topÁöÑËøõÁ®ãID‰∏∫15371ÔºåÂÖ∂Áà∂ËøõÁ®ãID‰∏∫10034ÔºåÂç≥ÁôªÂΩïshell„ÄÇ1test_dbs2 ~ # ps -ef|grep top 12345root 5 2 0 Apr01 ? 00:00:00 [stopper/0]root 8 2 0 Apr01 ? 00:00:00 [stopper/1]root 15371 10034 0 18:37 pts/1 00:00:00 toproot 15380 15352 0 18:37 pts/2 00:00:00 grep --colour=auto toptest_dbs2 ~ # ‰ΩøÁî®pstreeÂëΩ‰ª§ÂèØ‰ª•Êõ¥Ê∏ÖÊ•öÂú∞ÁúãÂà∞Ëøô‰∏™ÂÖ≥Á≥ªÔºö123test_dbs2 ~ # pstree -H 15371|grep top | |-sshd---sshd---bash---sudo---bash---sudo---bash---toptest_dbs2 ~ # ‰ΩøÁî®ps-xjÂëΩ‰ª§ÂèØ‰ª•ÁúãÂà∞ÔºåÁôªÂΩïshellÔºàPID 15371ÔºâÂíåtopÂú®Âêå‰∏Ä‰∏™‰ºöËØùÊúüÔºåshell‰∏∫‰ºöËØùÊúüÈ¶ñËøõÁ®ãÔºåÊâÄÂú®ËøõÁ®ãÁªÑPGID‰∏∫15371ÔºåtopÊâÄÂú®ËøõÁ®ãÁªÑPGID‰∏∫9410Ôºå‰∏∫ÂâçÂè∞ËøõÁ®ãÁªÑ„ÄÇ12345678test_dbs2 ~ # ps -xj|grep 15371Warning: bad syntax, perhaps a bogus '-'? See /usr/share/doc/procps-3.2.8/FAQ 9410 10020 10020 9410 pts/1 15371 S 0 0:00 sudo bash10020 10021 10021 9410 pts/1 15371 S 0 0:00 bash10021 10033 10033 9410 pts/1 15371 S 0 0:00 sudo bash10033 10034 10034 9410 pts/1 15371 S 0 0:00 bash10034 15371 15371 9410 pts/1 15371 S+ 0 0:00 top15352 15485 15484 15327 pts/2 15484 R+ 0 0:00 grep --colour=auto 15371 ÂÖ≥Èó≠Á¨¨‰∏Ä‰∏™SSHÁ™óÂè£ÔºåÂú®Âè¶‰∏Ä‰∏™Á™óÂè£‰∏≠ÂèØ‰ª•ÁúãÂà∞top‰πüË¢´ÊùÄÊéâ‰∫Ü„ÄÇ123test_dbs2 ~ # ps -ef|grep 15371root 15511 15352 0 18:42 pts/2 00:00:00 grep --colour=auto 15371test_dbs2 ~ # Â¶ÇÊûúÊàë‰ª¨ÂèØ‰ª•ÂøΩÁï•SIGHUP‰ø°Âè∑ÔºåÂÖ≥ÊéâÁ™óÂè£Â∫îËØ•Â∞±‰∏ç‰ºöÂΩ±ÂìçÁ®ãÂ∫èÁöÑËøêË°å‰∫Ü„ÄÇnohupÂëΩ‰ª§ÂèØ‰ª•ËææÂà∞Ëøô‰∏™ÁõÆÁöÑÔºåÂ¶ÇÊûúÁ®ãÂ∫èÁöÑÊ†áÂáÜËæìÂá∫/Ê†áÂáÜÈîôËØØÊòØÁªàÁ´ØÔºånohupÈªòËÆ§Â∞ÜÂÖ∂ÈáçÂÆöÂêëÂà∞nohup.outÊñá‰ª∂„ÄÇÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØnohupÂëΩ‰ª§Âè™ÊòØ‰ΩøÂæóÁ®ãÂ∫èÂøΩÁï•SIGHUP‰ø°Âè∑ÔºåËøòÈúÄË¶Å‰ΩøÁî®Ê†áËÆ∞&ÊääÂÆÉÊîæÂú®ÂêéÂè∞ËøêË°å„ÄÇ1nohup [argument‚Ä¶] & ËôΩÁÑ∂nohupÂæàÂÆπÊòì‰ΩøÁî®Ôºå‰ΩÜËøòÊòØÊØîËæÉ‚ÄúÁÆÄÈôã‚ÄùÁöÑÔºåÂØπ‰∫éÁÆÄÂçïÁöÑÂëΩ‰ª§ËÉΩÂ§üÂ∫î‰ªòËøáÊù•ÔºåÂØπ‰∫éÂ§çÊùÇÁöÑÈúÄË¶Å‰∫∫Êú∫‰∫§‰∫íÁöÑ‰ªªÂä°Â∞±È∫ªÁÉ¶‰∫Ü„ÄÇ ÂÖ∂ÂÆûÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∏™Êõ¥‰∏∫Âº∫Â§ßÁöÑÂÆûÁî®Á®ãÂ∫èscreen„ÄÇÊµÅË°åÁöÑLinuxÂèëË°åÁâàÔºà‰æãÂ¶ÇRed Hat Enterprise Linux Ôºâ ÈÄöÂ∏∏‰ºöËá™Â∏¶screenÂÆûÁî®Á®ãÂ∫èÔºåÂ¶ÇÊûúÊ≤°ÊúâÁöÑËØùÔºåÂèØ‰ª•‰ªéGNU screenÁöÑÂÆòÊñπÁΩëÁ´ô‰∏ãËΩΩ„ÄÇ ÂºÄÂßã‰ΩøÁî®ScreenÁÆÄÂçïÊù•ËØ¥ÔºåScreenÊòØ‰∏Ä‰∏™ÂèØ‰ª•Âú®Â§ö‰∏™ËøõÁ®ã‰πãÈó¥Â§öË∑ØÂ§çÁî®‰∏Ä‰∏™Áâ©ÁêÜÁªàÁ´ØÁöÑÁ™óÂè£ÁÆ°ÁêÜÂô®„ÄÇScreen‰∏≠Êúâ‰ºöËØùÁöÑÊ¶ÇÂøµÔºåÁî®Êà∑ÂèØ‰ª•Âú®‰∏Ä‰∏™screen‰ºöËØù‰∏≠ÂàõÂª∫Â§ö‰∏™screenÁ™óÂè£ÔºåÂú®ÊØè‰∏Ä‰∏™screenÁ™óÂè£‰∏≠Â∞±ÂÉèÊìç‰Ωú‰∏Ä‰∏™ÁúüÂÆûÁöÑtelnet/SSHËøûÊé•Á™óÂè£ÈÇ£Ê†∑„ÄÇÂú®screen‰∏≠ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÁ™óÂè£ÊúâËøôÊ†∑Âá†ÁßçÊñπÂºèÔºö1234567891011121314151617181920212223242526272829303132333435363738test_dbs2 ~ # yum install -y screentest_dbs2 ~ # test_dbs2 ~ # screen --helpUse: screen [-opts] [cmd [args]] or: screen -r [host.tty]Options:-4 Use IPv4.-6 Use IPv6.-a Force all capabilities into each window's termcap.-A -[r|R] Adapt all windows to the new display width & height.-c file Read configuration file instead of '.screenrc'.-d (-r) Detach the elsewhere running screen (and reattach here).-dmS name Start as daemon: Screen session in detached mode.-D (-r) Detach and logout remote (and reattach here).-D -RR Do whatever is needed to get a screen session.-e xy Change command characters.-f Flow control on, -fn = off, -fa = auto.-h lines Set the size of the scrollback history buffer.-i Interrupt output sooner when flow control is on.-l Login mode on (update /var/run/utmp), -ln = off.-list or -ls. Do nothing, just list our SockDir.-L Turn on output logging.-m ignore $STY variable, do create a new screen session.-O Choose optimal output rather than exact vt100 emulation.-p window Preselect the named window if it exists.-q Quiet startup. Exits with non-zero return code if unsuccessful.-r Reattach to a detached screen process.-R Reattach if possible, otherwise start a new session.-s shell Shell to execute rather than $SHELL.-S sockname Name this session .sockname instead of ...-t title Set title. (window's name).-T term Use term as $TERM for windows, rather than "screen".-U Tell screen to use UTF-8 encoding.-v Print "Screen version 4.00.03 (FAU) 23-Oct-06".-wipe Do nothing, just clean up SockDir.-x Attach to a not detached screen. (Multi display mode).-X Execute as a screen command in the specified session. Áõ¥Êé•Âú®ÂëΩ‰ª§Ë°åÈîÆÂÖ•screenÂëΩ‰ª§1test_dbs2 ~ # screen ÊàñËÄÖÊ∑ªÂä†‰∏Ä‰∏™ÂêçÁß∞‰∏∫mysqldump1test_dbs2 ~ # screen -S mysqldump ‰πãÂêéÊàë‰ª¨ÊÉ≥ÊöÇÊó∂ÈÄÄÂá∫ÂÅöÁÇπÂà´ÁöÑ‰∫ãÊÉÖÔºåÊØîÂ¶ÇÂá∫ÂéªÊï£Êï£Ê≠•ÔºåÈÇ£‰πàÂú®screenÁ™óÂè£ÈîÆÂÖ•C-a dÔºåScreen‰ºöÁªôÂá∫detachedÊèêÁ§∫Ôºö ÊöÇÊó∂‰∏≠Êñ≠‰ºöËØù Âçä‰∏™Â∞èÊó∂‰πãÂêéÂõûÊù•‰∫ÜÔºåÊâæÂà∞ËØ•screen‰ºöËØùÔºö1test_dbs2 ~ # screen -ls ÈáçÊñ∞ËøûÊé•‰ºöËØùÔºö123test_dbs2 ~ # screen -r -S mysqldump#ÊàñËÄÖtest_dbs2 ~ # screen -r 16582 ÁúãÁúãÂá∫Áé∞‰ªÄ‰πà‰∫ÜÔºåÂ§™Ê£í‰∫ÜÔºå‰∏ÄÂàáÈÉΩÂú®„ÄÇÁªßÁª≠Âπ≤Âêß„ÄÇ ‰Ω†ÂèØËÉΩÊ≥®ÊÑèÂà∞ÁªôscreenÂèëÈÄÅÂëΩ‰ª§‰ΩøÁî®‰∫ÜÁâπÊÆäÁöÑÈîÆÁªÑÂêàC-a„ÄÇËøôÊòØÂõ†‰∏∫Êàë‰ª¨Âú®ÈîÆÁõò‰∏äÈîÆÂÖ•ÁöÑ‰ø°ÊÅØÊòØÁõ¥Êé•ÂèëÈÄÅÁªôÂΩìÂâçscreenÁ™óÂè£ÔºåÂøÖÈ°ªÁî®ÂÖ∂‰ªñÊñπÂºèÂêëscreenÁ™óÂè£ÁÆ°ÁêÜÂô®ÂèëÂá∫ÂëΩ‰ª§ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåscreenÊé•Êî∂‰ª•C-aÂºÄÂßãÁöÑÂëΩ‰ª§„ÄÇËøôÁßçÂëΩ‰ª§ÂΩ¢ÂºèÂú®screen‰∏≠Âè´ÂÅöÈîÆÁªëÂÆöÔºàkey bindingÔºâÔºåC-aÂè´ÂÅöÂëΩ‰ª§Â≠óÁ¨¶Ôºàcommand characterÔºâ„ÄÇ ÂèØ‰ª•ÈÄöËøáC-a ?Êù•Êü•ÁúãÊâÄÊúâÁöÑÈîÆÁªëÂÆöÔºåÂ∏∏Áî®ÁöÑÈîÆÁªëÂÆöÊúâÔºö C-a ? ÊòæÁ§∫ÊâÄÊúâÈîÆÁªëÂÆö‰ø°ÊÅØ C-a w ÊòæÁ§∫ÊâÄÊúâÁ™óÂè£ÂàóË°® C-a C-a ÂàáÊç¢Âà∞‰πãÂâçÊòæÁ§∫ÁöÑÁ™óÂè£ C-a c ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËøêË°åshellÁöÑÁ™óÂè£Âπ∂ÂàáÊç¢Âà∞ËØ•Á™óÂè£ C-a n ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™Á™óÂè£ C-a p ÂàáÊç¢Âà∞Ââç‰∏Ä‰∏™Á™óÂè£(‰∏éC-a nÁõ∏ÂØπ) C-a 0..9 ÂàáÊç¢Âà∞Á™óÂè£0..9 C-a a ÂèëÈÄÅ C-aÂà∞ÂΩìÂâçÁ™óÂè£ C-a d ÊöÇÊó∂Êñ≠ÂºÄscreen‰ºöËØù C-a k ÊùÄÊéâÂΩìÂâçÁ™óÂè£ C-a [ ËøõÂÖ•Êã∑Ë¥ù/ÂõûÊªöÊ®°Âºè ‰ΩøÁî®ÈîÆÁªëÂÆöC-a ?ÂëΩ‰ª§ÂèØ‰ª•ÁúãÂà∞, ÈªòËÆ§ÁöÑÂëΩ‰ª§Â≠óÁ¨¶ÔºàCommand keyÔºâ‰∏∫C-aÔºåËΩ¨‰πâC-aÔºàliteral ^aÔºâÁöÑÂ≠óÁ¨¶‰∏∫aÔºö Â¶ÇÊûúÁî±‰∫éÊüêÁßçÂéüÂõ†ÂÖ∂‰∏≠‰∏Ä‰∏™‰ºöËØùÊ≠ªÊéâ‰∫ÜÔºà‰æãÂ¶Ç‰∫∫‰∏∫ÊùÄÊéâËØ•‰ºöËØùÔºâÔºåËøôÊó∂screen -list‰ºöÊòæÁ§∫ËØ•‰ºöËØù‰∏∫deadÁä∂ÊÄÅ„ÄÇ‰ΩøÁî®screen -wipeÂëΩ‰ª§Ê∏ÖÈô§ËØ•‰ºöËØùÔºö123test_dbs2 ~ # kill -9 8462test_dbs2 ~ # screen -wipetest_dbs2 ~ # screen -ls document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL ‰ºòÂåñÂéüÁêÜ(‰∏â)]]></title>
    <url>%2F2019%2F03%2F29%2Fmysql-optimization-principle-3%2F</url>
    <content type="text"><![CDATA[Êà¥‰∏äÂÆÉ„ÄÇÈÉΩÂá†ÂçÅÂ≤ÅÁöÑ‰∫∫‰∫ÜÔºå‰Ω†Áúã‰Ω†Â§öË¥±Ôºå‰Ω†Ê≤°Â∞ä‰∏•ÂïäÔºüÊàë‰∏çÊÉ≥ÁúãËßÅ‰Ω†ÔºåÂø´ÁÇπÊà¥‰∏äÔºåÁÑ∂ÂêéÂéªÁúãÂåªÁîü„ÄÇ ÂâçË®ÄËÅäËÅä MySQL ÈÖçÁΩÆ„ÄÇ Â§ßÂ§öÊï∞ÂºÄÂèëËÄÖÂèØËÉΩ‰∏çÂ§™‰ºöÂÖ≥Ê≥® MySQL ÁöÑÈÖçÁΩÆÔºåÊØïÁ´üÂú®Âü∫Êú¨ÈÖçÁΩÆÊ≤°ÊúâÈóÆÈ¢òÁöÑÊÉÖÂÜµ‰∏ãÔºåÊääÊõ¥Â§öÁöÑÁ≤æÂäõÊîæÂú® schema ËÆæËÆ°„ÄÅÁ¥¢Âºï‰ºòÂåñÂíå SQL ‰ºòÂåñ‰∏äÔºåÊòØÈùûÂ∏∏Âä°ÂÆûÁöÑÁ≠ñÁï•„ÄÇËøôÊó∂ÔºåÂ¶ÇÊûúÂÜçËä±ÂäõÊ∞îÂéª‰ºòÂåñÈÖçÁΩÆÈ°πÔºåËé∑ÂæóÁöÑÊî∂ÁõäÈÄöÂ∏∏ÈÉΩÊØîËæÉÂ∞è„ÄÇÊõ¥Â§öÁöÑÊó∂ÂÄôÔºåÂü∫‰∫éÂÆâÂÖ®Âõ†Á¥†ÁöÑËÄÉÈáèÔºåÊôÆÈÄöÂºÄÂèëËÄÖÂæàÂ∞ëËÉΩÂ§üÊé•Ëß¶Âà∞Áîü‰∫ßÁéØÂ¢ÉÁöÑ MySQL ÈÖçÁΩÆ„ÄÇÊ≠£ÊòØËøôÊ†∑ÔºåÂØºËá¥ÂºÄÂèëËÄÖÔºàÂåÖÊã¨ÊàëÔºâÂØπ MySQL ÁöÑÈÖçÁΩÆ‰∏çÁîö‰∫ÜËß£ÔºåÂ∏åÊúõÊú¨ÊñáËÉΩÂ∏Æ‰Ω†Êõ¥Â•ΩÁöÑ‰∫ÜËß£ MySQL ÈÖçÁΩÆ„ÄÇ Â¶ÇÊûúËÆ©‰Ω†Âú®ÊüêÁßçÁéØÂ¢É‰∏äÂÆâË£ÖÈÖçÁΩÆ MySQLÔºå‰Ω†‰ºöÊÄé‰πàÂÅöÔºüÂÆâË£ÖÂêéÔºåÁõ¥Êé• copy ‰øÆÊîπÁ§∫‰æãÈÖçÁΩÆÊñá‰ª∂ÔºåÂ∫îËØ•ÊòØÂ§ßÂ§öÊï∞‰∫∫ÁöÑÂÅöÊ≥ï„ÄÇ‰ΩÜÂº∫ÁÉàÂª∫ËÆÆ‰∏çË¶ÅÊÄé‰πàÂÅöÔºåÈ¶ñÂÖàÔºåÁ§∫‰æãÈÖçÁΩÆÊñá‰ª∂ÊúâÈùûÂ∏∏Â§öÊ≥®ÈáäÊéâÁöÑÈÖçÁΩÆÈ°πÔºåÂÆÉÂèØËÉΩ‰ºöËØ±‰Ωø‰Ω†ÊâìÂºÄ‰∏Ä‰∏™‰Ω†Âπ∂‰∏ç‰∫ÜËß£ÁöÑÈÖçÁΩÆÔºåËÄå‰∏îËøô‰∫õÊ≥®ÈáäËøò‰∏ç‰∏ÄÂÆöÂáÜÁ°Æ„ÄÇÂÖ∂Ê¨°ÔºåMySQL ÁöÑ‰∏Ä‰∫õÈÖçÁΩÆÂØπ‰∫éÁé∞‰ª£ÂåñÁöÑÁ°¨‰ª∂ÂíåÂ∑•‰ΩúË¥üËΩΩÊù•ËØ¥ÔºåÊúâÁÇπËøáÊó∂‰∫Ü„ÄÇ MySQL ÊúâÈùûÂ∏∏Â§öÁöÑÈÖçÁΩÆÈ°πÂèØ‰ª•‰øÆÊîπÔºå‰ΩÜÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºå‰Ω†ÈÉΩ‰∏çÂ∫îËØ•Èöè‰æø‰øÆÊîπÂÆÉÔºåÂõ†‰∏∫ÈîôËØØÊàñËÄÖÊ≤°Áî®ÁöÑÈÖçÁΩÆÂØºËá¥ÁöÑÊΩúÂú®È£éÈô©ÈùûÂ∏∏Â§ßÔºåËÄå‰∏îËøòÂæàÈöæÂÆö‰ΩçÈóÆÈ¢ò„ÄÇÁ°Æ‰øùÂü∫Êú¨ÈÖçÁΩÆÊ≠£Á°ÆÔºåÁÑ∂ÂêéÂ∞èÂøÉËØäÊñ≠ÈóÆÈ¢òÔºåÁ°ÆËÆ§ÈóÆÈ¢òÊÅ∞Â•ΩÂèØ‰ª•ÈÄöËøáÊüê‰∏™ÈÖçÁΩÆÈ°πËß£ÂÜ≥ÔºåÁ¥ßÊé•ÁùÄÂÜç‰øÆÊîπËøô‰∏™ÈÖçÁΩÆÂêß„ÄÇ ÂÖ∂ÂÆûÔºåÂàõÂª∫‰∏Ä‰∏™Â•ΩÁöÑÈÖçÁΩÆÔºåÊúÄÂø´ÊñπÊ≥ï‰∏çÊòØ‰ªéÂ≠¶‰π†ÈÖçÁΩÆÈ°πÂºÄÂßãÔºå‰πü‰∏çÊòØÈóÆÂì™‰∏™ÈÖçÁΩÆÈ°πÂ∫îËØ•ÊÄé‰πàËÆæÁΩÆÊàñËÄÖÊÄé‰πà‰øÆÊîπÂºÄÂßãÔºåÊõ¥‰∏çÊòØ‰ªéÊ£ÄÊü•ÊúçÂä°Âô®Ë°å‰∏∫ÂíåËØ¢ÈóÆÂì™‰∏™ÈÖçÁΩÆÈ°πÂèØ‰ª•ÊèêÂçáÊÄßËÉΩÂºÄÂßã„ÄÇÊúÄÂ•ΩÊòØ‰ªéÁêÜËß£ MySQL ÂÜÖÊ†∏ÂíåË°å‰∏∫ÂºÄÂßãÔºåÁÑ∂ÂêéÂà©Áî®Ëøô‰∫õÁü•ËØÜÊù•ÊåáÂØº‰Ω†ÈÖçÁΩÆ MySQL„ÄÇ Â∞±‰ªéÁêÜËß£ MySQL ÈÖçÁΩÆÁöÑÂ∑•‰ΩúÂéüÁêÜÂºÄÂßãÂêß„ÄÇ MySQL ÈÖçÁΩÆÁöÑÂ∑•‰ΩúÂéüÁêÜMySQL ‰ªéÂì™ÂÑøËé∑ÂæóÈÖçÁΩÆ‰ø°ÊÅØÔºöÂëΩ‰ª§Ë°åÂèÇÊï∞ÂíåÈÖçÁΩÆÊñá‰ª∂„ÄÇÁ±ª Unix Á≥ªÁªü‰∏≠ÔºåÈÖçÁΩÆÊñá‰ª∂‰∏ÄËà¨‰Ωç‰∫é /etc/my.cnf ÊàñËÄÖ /etc/mysql/my.cnf„ÄÇÂú®ÂêØÂä®Êó∂ÔºåÂèØ‰ª•ÈÄöËøáÂëΩ‰ª§Ë°åÂèÇÊï∞ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰ΩçÁΩÆÔºåÂΩìÁÑ∂ÂëΩ‰ª§Ë°å‰∏≠‰πüÂèØ‰ª•ÊåáÂÆöÂÖ∂ÂÆÉÂèÇÊï∞ÔºåÊúçÂä°Âô®‰ºöËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÂÜÖÂÆπÔºåÂà†Èô§ÊâÄÊúâÊ≥®ÈáäÂíåÊç¢Ë°åÔºåÁÑ∂ÂêéÂíåÂëΩ‰ª§Ë°åÈÄâÈ°π‰∏ÄËµ∑Â§ÑÁêÜ„ÄÇ ‰ªª‰ΩïÊâìÁÆóÈïøÊúü‰ΩøÁî®ÁöÑÈÖçÁΩÆÈ°πÈÉΩÂ∫îËØ•ÂÜôÂÖ•ÈÖçÁΩÆÊñá‰ª∂ÔºåËÄå‰∏çÊòØÂú®ÂëΩ‰ª§Ë°å‰∏≠ÊåáÂÆö„ÄÇ‰∏ÄÂÆöË¶ÅÊ∏ÖÊ•öÁöÑÁü•ÈÅì MySQL ‰ΩøÁî®ÁöÑÈÖçÁΩÆÊñá‰ª∂‰ΩçÁΩÆÔºåÂú®‰øÆÊîπÊó∂‰∏çËÉΩÊÉ≥ÂΩìÁÑ∂ÔºåÊØîÂ¶ÇÔºå‰øÆÊîπ‰∫Ü /etc/my.cnf ÁöÑÈÖçÁΩÆÈ°πÔºå‰ΩÜ MySQL ÂÆûÈôÖÂπ∂Êú™‰ΩøÁî®Ëøô‰∏™ÈÖçÁΩÆÊñá‰ª∂„ÄÇÂ¶ÇÊûú‰Ω†‰∏çÁü•ÈÅìÂΩìÂâç‰ΩøÁî®ÁöÑÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑÔºåÂèØ‰ª•Â∞ùËØïÔºö12345$ which mysqld/usr/sbin/mysqld$ /usr/sbin/mysqld --verbose --help |grep -A 1 'Default options'Default options are read from the following files in the given order:/etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑÈÖçÁΩÆÊñá‰ª∂ÂåÖÂê´Â§ö‰∏™ÈÉ®ÂàÜÔºåÊØè‰∏™ÈÉ®ÂàÜÁöÑÂºÄÂ§¥ÊòØ‰∏Ä‰∏™ÊñπÊã¨Âè∑Êã¨Ëµ∑Êù•ÁöÑÂàÜÊÆµÂêçÁß∞„ÄÇMySQL Á®ãÂ∫èÈÄöÂ∏∏ËØªÂèñË∑üÂÆÉÂêåÂêçÁöÑÂàÜÊÆµÈÉ®ÂàÜÔºåÊØîÂ¶ÇÔºåËÆ∏Â§öÂÆ¢Êà∑Á´ØÁ®ãÂ∫èËØªÂèñ[client]ÈÉ®ÂàÜ„ÄÇÊúçÂä°Âô®ÈÄöÂ∏∏ËØªÂèñ[mysqld]Ëøô‰∏ÄÊÆµÔºå‰∏ÄÂÆöË¶ÅÁ°ÆËÆ§ÈÖçÁΩÆÈ°πÊîæÂú®‰∫ÜÊñá‰ª∂Ê≠£Á°ÆÁöÑÂàÜÊÆµ‰∏≠ÔºåÂê¶ÂàôÈÖçÁΩÆÊòØ‰∏ç‰ºöÁîüÊïàÁöÑ„ÄÇ MySQL ÊØè‰∏Ä‰∏™ÈÖçÁΩÆÈ°πÂùá‰ΩøÁî®Â∞èÂÜôÔºåÂçïËØç‰πãÈó¥Áî®‰∏ãÂàíÁ∫øÊàñËÄÖÊ®™Á∫øÈöîÂºÄÔºåËôΩÁÑ∂Êàë‰ª¨Â∏∏Áî®ÁöÑÂàÜÈöîÁ¨¶ÊòØ‰∏ãÂàíÁ∫øÔºå‰ΩÜÂ¶ÇÊûúÂú®ÂëΩ‰ª§Ë°åÊàñËÄÖÈÖçÁΩÆÊñá‰ª∂‰∏≠ËßÅÂà∞Â¶Ç‰∏ãÈÖçÁΩÆÔºå‰Ω†Ë¶ÅÁü•ÈÅìÔºåÂÆÉ‰ª¨ÂÖ∂ÂÆûÊòØÁ≠â‰ª∑ÁöÑÔºö123456# ÈÖçÁΩÆÊñá‰ª∂max_connections=5000max-connections=5000# ÂëΩ‰ª§Ë°å/usr/sbin/mysqld --max_connections=5000/usr/sbin/mysqld --max-connections=5000 ÈÖçÁΩÆÈ°πÂèØ‰ª•ÊúâÂ§ö‰∏™‰ΩúÁî®ÂüüÔºöÂÖ®Â±Ä‰ΩúÁî®Âüü„ÄÅ‰ºöËØù‰ΩúÁî®Âüü (ÊØè‰∏™ËøûÊé•‰ΩúÁî®‰∏çÂêå)„ÄÅÂØπË±°‰ΩúÁî®Âüü„ÄÇÂæàÂ§ö‰ºöËØùÁ∫ßÈÖçÁΩÆÈ°πË∑üÂÖ®Â±ÄÈÖçÁΩÆÁõ∏Á≠âÔºåÂèØ‰ª•ËÆ§‰∏∫ÊòØÈªòËÆ§ÂÄºÔºåÂ¶ÇÊûúÊîπÂèò‰ºöËØùÁ∫ßÈÖçÁΩÆÈ°πÔºåÂÆÉÂè™ÂΩ±ÂìçÊîπÂä®ÁöÑÂΩìÂâçËøûÊé•ÔºåÂΩìËøûÊé•ÂÖ≥Èó≠Êó∂ÔºåÊâÄÊúâÁöÑÂèÇÊï∞ÂèòÊõ¥ÈÉΩ‰ºöÂ§±Êïà„ÄÇ‰∏ãÈù¢ÊúâÂá†‰∏™Á§∫‰æãÈÖçÁΩÆÈ°πÔºö query-cache-size ÂÖ®Â±ÄÈÖçÁΩÆÈ°π sort-buffer-size ÈªòËÆ§ÂÖ®Â±ÄÁõ∏ÂêåÔºå‰ΩÜÊØè‰∏™Á∫øÁ®ãÈáå‰πüÂèØ‰ª•ËÆæÁΩÆ join-buffer-size ÈªòËÆ§ÂÖ®Â±ÄÔºå‰∏îÊØè‰∏™Á∫øÁ®ã‰πüÂèØ‰ª•ËÆæÁΩÆ„ÄÇ‰ΩÜËã•‰∏Ä‰∏™Êü•ËØ¢‰∏≠ÂÖ≥ËÅîÂ§öÂº†Ë°®ÔºåÂèØ‰ª•‰∏∫ÊØè‰∏™ÂÖ≥ËÅîÂàÜÈÖç‰∏Ä‰∏™ÂÖ≥ËÅîÁºìÂ≠ò (join-buffer)ÔºåÊâÄ‰ª•‰∏Ä‰∏™Êü•ËØ¢ÂèØËÉΩÊúâÂ§ö‰∏™ÂÖ≥ËÅîÁºìÂÜ≤„ÄÇ ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÂèòÈáè (ÈÖçÁΩÆÈ°π) ÊúâÂæàÂ§ö (‰ΩÜ‰∏çÊòØÊâÄÊúâ) ÂèØ‰ª•Âú®ÊúçÂä°Âô®ËøêË°åÊó∂‰øÆÊîπÔºåMySQL ÊääËøô‰∫õÂΩí‰∏∫Âä®ÊÄÅÈÖçÁΩÆÂèòÈáèÔºö12345678910111213141516-- ËÆæÁΩÆÂÖ®Â±ÄÂèòÈáèÔºåGLOBALÂíå@@global‰ΩúÁî®ÊòØ‰∏ÄÊ†∑ÁöÑset GLOBAL sort-buffer-size = set @@global.sort-buffer-size := -- ËÆæÁΩÆ‰ºöËØùÁ∫ßÂèòÈáèÔºå‰∏ãÈù¢6ÁßçÊñπÂºè‰ΩúÁî®ÊòØ‰∏ÄÊ†∑ÁöÑ-- Âç≥ÔºöÊ≤°Êúâ‰øÆÈ•∞Á¨¶„ÄÅSESSION„ÄÅLOCALÁ≠â‰øÆÈ•∞Á¨¶‰ΩúÁî®ÊòØ‰∏ÄËá¥ÁöÑset SESSION sort-buffer-size = set @@session.sort-buffer-size := set @@sort-buffer-size = set LOCAL sort-buffer-size = set @@ocal.sort-buffer-size := set sort-buffer-size = -- setÂëΩ‰ª§ÂèØ‰ª•ÂêåÊó∂ËÆæÁΩÆÂ§ö‰∏™ÂèòÈáèÔºå‰ΩÜÂÖ∂‰∏≠Âè™Ë¶ÅÊúâ‰∏Ä‰∏™ÂèòÈáèËÆæÁΩÆÂ§±Ë¥•ÔºåÊâÄÊúâÁöÑÂèòÈáèÈÉΩÊú™ÁîüÊïàSET GLOBAL sort-buffer-size = 100, SESSION sort-buffer-size = 1000;SET GLOBAL max-connections = 1000, sort-buffer-size = 1000000; Âä®ÊÄÅÁöÑËÆæÁΩÆÂèòÈáèÔºåMySQL ÂÖ≥Èó≠Êó∂Ëøô‰∫õÂèòÈáèÈÉΩ‰ºöÂ§±Êïà„ÄÇÂ¶ÇÊûúÂú®ÊúçÂä°Âô®ËøêË°åÊó∂‰øÆÊîπ‰∫ÜÂèòÈáèÁöÑÂÖ®Â±ÄÂÄºÔºåËøô‰∏™ÂÄºÂØπÂΩìÂâç‰ºöËØùÂíåÂÖ∂‰ªñ‰ªª‰ΩïÂ∑≤ÁªèÂ≠òÂú®ÁöÑ‰ºöËØùÈÉΩ‰∏çËµ∑ÊïàÊûúÔºåËøôÊòØÂõ†‰∏∫‰ºöËØùÁöÑÂèòÈáèÂÄºÊòØÂú®ËøûÊé•ÂàõÂª∫Êó∂‰ªéÂÖ®Â±ÄÂÄºÂàùÂßãÂåñËÄåÊù•ÁöÑ„ÄÇÊ≥®ÊÑèÔºåÂú®ÈÖçÁΩÆ‰øÆÊîπÂêéÔºåÈúÄË¶ÅÁ°ÆËÆ§ÊòØÂê¶‰øÆÊîπÊàêÂäü„ÄÇ ‰Ω†ÂèØËÉΩÊ≥®ÊÑèÂà∞Ôºå‰∏äÈù¢ÁöÑÁ§∫‰æã‰∏≠ÔºåÊúâ‰∫õ‰ΩøÁî® ‚Äò=‚ÄôÔºåÊúâ‰∫õ‰ΩøÁî® ‚Äò:=‚Äô„ÄÇÂØπ‰∫é set ÂëΩ‰ª§Êú¨Ë∫´Êù•ËØ¥Ôºå‰∏§ÁßçËµãÂÄºËøêÁÆóÁ¨¶Ê≤°Êúâ‰ªª‰ΩïÂå∫Âà´ÔºåÂú®ÂëΩ‰ª§Ë°å‰∏≠‰ΩøÁî®‰ªª‰∏ÄËøêÁÆóÁ¨¶Á¨¶ÔºåÂùáÂèØ‰ª•ÁîüÊïà„ÄÇËÄåÂú®ÂÖ∂‰ªñËØ≠Âè•‰∏≠ÔºåËµãÂÄºËøêÁÆóÁ¨¶ÂøÖÈ°ªÊòØ ‚Äò:=‚ÄôÔºåÂõ†‰∏∫Âú®Èùû set ËØ≠Âè•‰∏≠ ‚Äò=‚Äô Ë¢´ËßÜ‰∏∫ÊØîËæÉËøêÁÆóÁ¨¶„ÄÇÂÖ∑‰ΩìÂèØ‰ª•ÂèÇËÄÉÂ¶Ç‰∏ãÁ§∫‰æãÔºö ËØ¶ÁªÜÁ§∫‰æãÂèØ‰ª•ÂèÇËÄÉÔºö12345678910-- @exp Ë°®Á§∫Áî®Êà∑ÂèòÈáèÔºå‰∏äÈù¢ÁöÑÁ§∫‰æãÂùáÊòØÁ≥ªÁªüÂèòÈáè-- ÈîôËØØset @user = 123456;set @group = select GROUP from USER where User = @user;select * from USER where GROUP = @group;-- Ê≠£Á°ÆSET @user := 123456;SELECT @group := `group` FROM user WHERE user = @user;SELECT * FROM user WHERE `group` = @group; Êúâ‰∏Ä‰∫õÈÖçÁΩÆ‰ΩøÁî®‰∫Ü‰∏çÂêåÁöÑÂçï‰ΩçÔºåÊØîÂ¶Çtable-cacheÂèòÈáèÊåáÂÆöË°®ÂèØ‰ª•Ë¢´ÁºìÂ≠òÁöÑÊï∞ÈáèÔºåËÄå‰∏çÊòØË°®ÂèØ‰ª•Ë¢´ÁºìÂ≠òÁöÑÂ≠óËäÇÊï∞„ÄÇËÄåkey-buffer-sizeÂàôÊòØ‰ª•Â≠óËäÇ‰∏∫Âçï‰Ωç„ÄÇ ËøòÊúâ‰∏Ä‰∫õÈÖçÁΩÆÂèØ‰ª•ÊåáÂÆöÂêéÁºÄÂçï‰ΩçÔºåÊØîÂ¶Ç1M=10241024Â≠óËäÇÔºå‰ΩÜÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåËøôÂè™ËÉΩÂú®ÈÖçÁΩÆÊñá‰ª∂ÊàñËÄÖ‰Ωú‰∏∫ÂëΩ‰ª§Ë°åÂèÇÊï∞Êó∂ÊúâÊïà„ÄÇÂΩì‰ΩøÁî® SQL ÁöÑ SET ÂëΩ‰ª§Êó∂ÔºåÂøÖÈ°ª‰ΩøÁî®Êï∞Â≠óÂÄº 1048576 ÊàñËÄÖ 10241024 ËøôÊ†∑ÁöÑË°®ËææÂºèÔºå‰ΩÜÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠‰∏çËÉΩ‰ΩøÁî®Ë°®ËææÂºè„ÄÇ Â∞èÂøÉÁøºÁøºÁöÑÈÖçÁΩÆ MySQLÊàë‰ª¨Â∏∏Â∏∏Âä®ÊÄÅÁöÑ‰øÆÊîπÈÖçÁΩÆÔºå‰ΩÜËØ∑Âä°ÂøÖÂ∞èÂøÉÔºåÂõ†‰∏∫ÂÆÉ‰ª¨ÂèØËÉΩÂØºËá¥Êï∞ÊçÆÂ∫ìÂÅöÂ§ßÈáèËÄóÊó∂ÁöÑÂ∑•‰ΩúÔºå‰ªéËÄåÂΩ±ÂìçÊï∞ÊçÆÂ∫ìÁöÑÊï¥‰ΩìÊÄßËÉΩ„ÄÇÊØîÂ¶Ç‰ªéÁºìÂ≠ò‰∏≠Âà∑Êñ∞ËÑèÂùóÔºå‰∏çÂêåÁöÑÂà∑Êñ∞ÊñπÂºèÂØπ I/O ÁöÑÂΩ±ÂìçÂ∑ÆÂà´ÂæàÂ§ß (ÂêéÊñá‰ºöÂÖ∑‰ΩìËØ¥Êòé)„ÄÇÊúÄÂ•ΩÊää‰∏Ä‰∫õÂ•ΩÁöÑ‰π†ÊÉØ‰Ωú‰∏∫ËßÑËåÉÂêàÂπ∂Âà∞Â∑•‰ΩúÊµÅÁ®ã‰∏≠ÂéªÔºåÂ∞±ÊØîÂ¶ÇÔºö Â•Ω‰π†ÊÉØ 1Ôºö‰∏çË¶ÅÈÄöËøáÈÖçÁΩÆÈ°πÁöÑÂêçÁß∞Êù•Êé®Êñ≠‰∏Ä‰∏™ÂèòÈáèÁöÑ‰ΩúÁî® ‰∏çË¶ÅÈÄöËøáÈÖçÁΩÆÈ°πÁöÑÂêçÁß∞Êù•Êé®Êñ≠‰∏Ä‰∏™ÂèòÈáèÁöÑ‰ΩúÁî®ÔºåÂõ†‰∏∫ÂÆÉÂèØËÉΩË∑ü‰Ω†ÊÉ≥Ë±°ÁöÑÂÆåÂÖ®‰∏ç‰∏ÄÊ†∑„ÄÇÊØîÂ¶ÇÔºö read-buffer-sizeÔºöÂΩì MySQL ÈúÄË¶ÅÈ°∫Â∫èËØªÂèñÊï∞ÊçÆÊó∂ÔºåÂ¶ÇÊó†Ê≥ï‰ΩøÁî®Á¥¢ÂºïÔºåÂÖ∂Â∞ÜËøõË°åÂÖ®Ë°®Êâ´ÊèèÊàñËÄÖÂÖ®Á¥¢ÂºïÊâ´Êèè„ÄÇËøôÊó∂ÔºåMySQL ÊåâÁÖßÊï∞ÊçÆÁöÑÂ≠òÂÇ®È°∫Â∫è‰æùÊ¨°ËØªÂèñÊï∞ÊçÆÂùóÔºåÊØèÊ¨°ËØªÂèñÁöÑÊï∞ÊçÆÂùóÈ¶ñÂÖà‰ºöÊöÇÂ≠òÂú®ÁºìÂ≠ò‰∏≠ÔºåÂΩìÁºìÂ≠òÁ©∫Èó¥Ë¢´ÂÜôÊª°ÊàñËÄÖÂÖ®ÈÉ®Êï∞ÊçÆËØªÂèñÁªìÊùüÂêéÔºåÂÜçÂ∞ÜÁºìÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆËøîÂõûÁªô‰∏äÂ±ÇË∞ÉÁî®ËÄÖÔºå‰ª•ÊèêÈ´òÊïàÁéá„ÄÇ read-rnd-buffer-sizeÔºöÂíåÈ°∫Â∫èËØªÂèñÁõ∏ÂØπÂ∫îÔºåÂΩì MySQL ËøõË°åÈùûÈ°∫Â∫èËØªÂèñÔºàÈöèÊú∫ËØªÂèñÔºâÊï∞ÊçÆÂùóÁöÑÊó∂ÂÄôÔºå‰ºöÂà©Áî®Ëøô‰∏™ÁºìÂÜ≤Âå∫ÊöÇÂ≠òËØªÂèñÁöÑÊï∞ÊçÆ„ÄÇÊØîÂ¶ÇÔºöÊ†πÊçÆÁ¥¢Âºï‰ø°ÊÅØËØªÂèñË°®Êï∞ÊçÆ„ÄÅÊ†πÊçÆÊéíÂ∫èÂêéÁöÑÁªìÊûúÈõÜ‰∏éË°®ËøõË°å Join Á≠âÁ≠â„ÄÇÊÄªÁöÑÊù•ËØ¥ÔºåÂ∞±ÊòØÂΩìÊï∞ÊçÆÂùóÁöÑËØªÂèñÈúÄË¶ÅÊª°Ë∂≥‰∏ÄÂÆöÁöÑÈ°∫Â∫èÁöÑÊÉÖÂÜµ‰∏ãÔºåMySQL Â∞±ÈúÄË¶Å‰∫ßÁîüÈöèÊú∫ËØªÂèñÔºåËøõËÄå‰ΩøÁî®Âà∞read-rnd-buffer-sizeÂèÇÊï∞ÊâÄËÆæÁΩÆÁöÑÂÜÖÂ≠òÁºìÂÜ≤Âå∫„ÄÇ Ëøô‰∏§‰∏™ÈÖçÁΩÆÈÉΩÊòØÂú®Êâ´Êèè MyISAM Ë°®Êó∂ÊúâÊïàÔºå‰∏î MySQL ‰ºö‰∏∫ÊØè‰∏™Á∫øÁ®ãÂàÜÈÖçÂÜÖÂ≠ò„ÄÇÂØπ‰∫éÂâçËÄÖÔºåMySQL Âè™‰ºöÂú®Êü•ËØ¢ÈúÄË¶Å‰ΩøÁî®Êó∂Êâç‰ºö‰∏∫ËØ•ÁºìÂ≠òÂàÜÈÖçÂÜÖÂ≠òÔºåÂπ∂‰∏î‰∏ÄÊ¨°ÊÄßÂàÜÈÖçËØ•ÂèÇÊï∞ÊåáÂÆöÂ§ßÂ∞èÁöÑÂÖ®ÈÉ®ÂÜÖÂ≠òÔºåËÄåÂêéËÄÖÂêåÊ†∑ÊòØÈúÄË¶ÅÊó∂ÊâçÂàÜÈÖçÂÜÖÂ≠òÔºå‰ΩÜÂè™ÂàÜÈÖçÈúÄË¶ÅÁöÑÂÜÖÂ≠òÂ§ßÂ∞èËÄå‰∏çÊòØÂèÇÊï∞ÊåáÂÆöÁöÑÊï∞ÂÄºÔºåmax-read-rnd-buffer-size(ÂÆûÈôÖ‰∏äÊ≤°ÊúâËøô‰∏™ÈÖçÁΩÆÈ°π) Ëøô‰∏™ÂêçÂ≠óÊõ¥ËÉΩË°®ËææËøô‰∏™ÂèòÈáèÁöÑÂÆûÈôÖÂê´‰πâ„ÄÇ Â•Ω‰π†ÊÉØ 2Ôºö‰∏çË¶ÅËΩªÊòìÂú®ÂÖ®Â±Ä‰øÆÊîπ‰ºöËØùÁ∫ßÂà´ÁöÑÈÖçÁΩÆ ÂØπ‰∫éÊüê‰∫õ‰ºöËØùÁ∫ßÂà´ÁöÑËÆæÁΩÆÔºå‰∏çË¶ÅËΩªÊòìÁöÑÂú®ÂÖ®Â±ÄÂ¢ûÂä†ÂÆÉ‰ª¨ÁöÑÂÄºÔºåÈô§Èùû‰Ω†Á°ÆËÆ§ËøôÊ†∑ÂÅöÊòØÂØπÁöÑ„ÄÇÊØîÂ¶ÇÔºösort-buffer-sizeÔºåËØ•ÂèÇÊï∞ÊéßÂà∂ÊéíÂ∫èÊìç‰ΩúÁöÑÁºìÂ≠òÂ§ßÂ∞èÔºåMySQL Âè™‰ºöÂú®Êü•ËØ¢ÈúÄË¶ÅÂÅöÊéíÂ∫èÊìç‰ΩúÊó∂Êâç‰ºö‰∏∫ËØ•ÁºìÂÜ≤ÂàÜÈÖçÂÜÖÂ≠òÔºå‰∏ÄÊó¶ÈúÄË¶ÅÊéíÂ∫èÔºåÂ∞±‰ºö‰∏ÄÊ¨°ÊÄßÂàÜÈÖçÊåáÂÆöÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÔºåÂç≥‰ΩøÊòØÈùûÂ∏∏Â∞èÁöÑÊéíÂ∫èÊìç‰Ωú„ÄÇÂõ†Ê≠§Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠Â∫îËØ•ÈÖçÁΩÆÁöÑÂ∞è‰∏Ä‰∫õÔºåÁÑ∂ÂêéÂú®Êüê‰∫õÊü•ËØ¢ÈúÄË¶ÅÊéíÂ∫èÊó∂ÔºåÂÜçÂú®ËøûÊé•‰∏≠ÊääÂÆÉË∞ÉÂ§ß„ÄÇÊØîÂ¶ÇÔºö1234SET @@seession.sort-buffer-size := -- ÊâßË°åÊü•ËØ¢ÁöÑsqlSET @@seession.sort-buffer-size := DEFAULT -- ÊÅ¢Â§çÈªòËÆ§ÂÄº-- ÂèØ‰ª•Â∞ÜÁ±ª‰ººÁöÑ‰ª£Á†ÅÂ∞ÅË£ÖÂú®ÂáΩÊï∞‰∏≠Êñπ‰æø‰ΩøÁî®„ÄÇ Â•Ω‰π†ÊÉØ 3ÔºöÈÖçÁΩÆÂèòÈáèÊó∂ÔºåÂπ∂‰∏çÊòØÂÄºË∂äÂ§ßË∂äÂ•ΩÈÖçÁΩÆÂèòÈáèÊó∂ÔºåÂπ∂‰∏çÊòØÂÄºË∂äÂ§ßË∂äÂ•ΩÔºåËÄå‰∏îÂ¶ÇÊûúËÆæÁΩÆÁöÑÂÄºÂ§™È´òÔºåÂèØËÉΩÊõ¥ÂÆπÊòìÂØºËá¥ÂÜÖÂ≠òÈóÆÈ¢ò„ÄÇÂú®‰øÆÊîπÂÆåÊàêÂêéÔºåÂ∫îËØ•ÈÄöËøáÁõëÊéßÊù•Á°ÆËÆ§ÂèòÈáèÁöÑ‰øÆÊîπÂØπÊúçÂä°Âô®Êï¥‰ΩìÊÄßËÉΩÁöÑÂΩ±Âìç„ÄÇ Â•Ω‰π†ÊÉØ 4ÔºöËßÑËåÉÊ≥®ÈáäÔºåÁâàÊú¨ÊéßÂà∂Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂÜôÂ•ΩÊ≥®ÈáäÔºåÂèØËÉΩ‰ºöËäÇÁúÅËá™Â∑±ÂíåÂêå‰∫ãÂ§ßÈáèÁöÑÂ∑•‰ΩúÔºå‰∏Ä‰∏™Êõ¥Â•ΩÁöÑ‰π†ÊÉØÊòØÊääÈÖçÁΩÆÊñá‰ª∂ÁΩÆ‰∫éÁâàÊú¨ÊéßÂà∂‰πã‰∏ã„ÄÇ ËØ¥ÂÆå‰∫ÜÂ•Ω‰π†ÊÉØÔºåÂÜçÊù•ËØ¥ËØ¥‰∏çÂ•ΩÁöÑ‰π†ÊÉØ„ÄÇ Âùè‰π†ÊÉØ 1ÔºöÊ†πÊçÆ‰∏Ä‰∫õ ‚ÄúÊØîÁéá‚Äù Êù•Ë∞É‰ºò‰∏Ä‰∏™ÁªèÂÖ∏ÁöÑÊåâ ‚ÄúÊØîÁéá‚Äù Ë∞É‰ºòÁöÑÁªèÈ™åÊ≥ïÂàôÊòØÔºåÁºìÂ≠òÁöÑÂëΩ‰∏≠ÁéáÂ∫îËØ•È´ò‰∫éÊüê‰∏™ÁôæÂàÜÊØîÔºåÂ¶ÇÊûúÂëΩ‰∏≠ÁéáËøá‰ΩéÔºåÂàôÂ∫îËØ•Â¢ûÂä†ÁºìÂ≠òÁöÑÂ§ßÂ∞è„ÄÇËøôÊòØÈùûÂ∏∏ÈîôËØØÁöÑÊÑèËßÅÔºåÂ§ßÂÆ∂ÂèØ‰ª•‰ªîÁªÜÊÄùËÄÉ‰∏Ä‰∏ãÔºöÁºìÂ≠òÁöÑÂëΩ‰∏≠ÁéáË∑üÁºìÂ≠òÂ§ßÂ∞èÊúâÂøÖÁÑ∂ËÅîÁ≥ªÂêóÔºü(ÂàÜÊØçÂèòÂ§ßÔºåÂÄºÂ∞±ÂèòÂ§ß‰∫ÜÔºü) Èô§ÈùûÁ°ÆÂÆûÊòØÁºìÂ≠òÂ§™Â∞è‰∫Ü„ÄÇÂÖ≥‰∫é MyISAM ÈîÆÁºìÂÜ≤ÂëΩ‰∏≠ÁéáÔºå‰∏ãÊñá‰ºöËØ¶ÁªÜËØ¥Êòé„ÄÇ Âùè‰π†ÊÉØ 2ÔºöÈöè‰æø‰ΩøÁî®Ë∞É‰ºòËÑöÊú¨Â∞ΩÈáè‰∏çË¶Å‰ΩøÁî®Ë∞É‰ºòËÑöÊú¨ÔºÅ‰∏çÂêåÁöÑ‰∏öÂä°Âú∫ÊôØ„ÄÅ‰∏çÂêåÁöÑÁ°¨‰ª∂ÁéØÂ¢ÉÂØπ MySQL ÁöÑÊÄßËÉΩË¶ÅÊ±ÇÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ„ÄÇÊØîÂ¶ÇÊúâ‰∫õ‰∏öÂä°ÂØπÊï∞ÊçÆÁöÑÂÆåÊï¥ÊÄßË¶ÅÊ±ÇËæÉÈ´òÔºåÈÇ£‰πàÂ∞±‰∏ÄÂÆöË¶Å‰øùËØÅÊï∞ÊçÆ‰∏ç‰∏¢Â§±ÔºåÂá∫Áé∞ÊïÖÈöúÂêéÂèØÊÅ¢Â§çÊï∞ÊçÆÔºåËÄåÊúâ‰∫õ‰∏öÂä°Âç¥ÂØπÊï∞ÊçÆÁöÑÂÆåÊï¥ÊÄßË¶ÅÊ±ÇÊ≤°ÈÇ£‰πàÈ´òÔºå‰ΩÜÂØπÊÄßËÉΩË¶ÅÊ±ÇÊõ¥È´ò„ÄÇÂõ†Ê≠§ÔºåÂç≥‰ΩøÊòØÂêå‰∏Ä‰∏™ÂèòÈáèÔºåÂú®Ëøô‰∏§‰∏™‰∏çÂêåÂú∫ÊôØ‰∏ãÔºåÂÖ∂ÈÖçÁΩÆÁöÑÂÄº‰πüÂ∫îËØ•ÊòØ‰∏çÂêåÁöÑ„ÄÇÈÇ£‰Ω†ËøòËÉΩÊîæÂøÉÁöÑ‰ΩøÁî®ÁΩë‰∏äÊâæÂà∞ÁöÑËÑöÊú¨Âêó Ôºü Êú¨Â∞èËäÇÁ§∫‰æãÁöÑÂá†‰∏™ÈÖçÁΩÆÈ°πÔºå‰ªÖÁî®‰∫é‰∏æ‰æãËØ¥ÊòéÔºåÂπ∂‰∏ç‰ª£Ë°®ÂÆÉ‰ª¨ÊúâÂ§ö‰πàÈáçË¶ÅÔºåËØ∑Ê†πÊçÆÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÈÖçÁΩÆÂÆÉ‰ª¨„ÄÇÂ∞±ÊØîÂ¶Çsort-buffer-sizeÔºå‰Ω†ÁúüÁöÑÈúÄË¶Å 100M ÂÜÖÂ≠òÊù•ÁºìÂ≠ò 10 Ë°åÊï∞ÊçÆÔºü ÂàÜÊÆµMySQL ÈÖçÁΩÆÊñá‰ª∂ÁöÑÊ†ºÂºè‰∏∫ÈõÜ‰∏≠ÂºèÔºåÈÄöÂ∏∏‰ºöÂàÜÊàêÂ•ΩÂá†ÈÉ®ÂàÜÔºåÂèØ‰ª•‰∏∫Â§ö‰∏™Á®ãÂ∫èÊèê‰æõÈÖçÁΩÆÔºåÂ¶Ç[client]„ÄÅ[mysqld]„ÄÅ[mysql]Á≠âÁ≠â„ÄÇMySQL Á®ãÂ∫èÈÄöÂ∏∏ÊòØËØªÂèñ‰∏éÂÆÉÂêåÂêçÁöÑÂàÜÊÆµÈÉ®ÂàÜ„ÄÇ [client]ÂÆ¢Êà∑Á´ØÈªòËÆ§ËÆæÁΩÆÂÜÖÂÆπ [mysql]‰ΩøÁî® mysql ÂëΩ‰ª§ÁôªÂΩï MySQL Êï∞ÊçÆÂ∫ìÊó∂ÁöÑÈªòËÆ§ËÆæÁΩÆ [mysqld]Êï∞ÊçÆÂ∫ìÊú¨Ë∫´ÁöÑÈªòËÆ§ËÆæÁΩÆ ‰æãÂ¶ÇÊúçÂä°Âô® mysqld ÈÄöÂ∏∏ËØªÂèñ[mysqld]ÂàÜÊÆµ‰∏ãÁöÑÁõ∏ÂÖ≥ÈÖçÁΩÆÈ°π„ÄÇÂ¶ÇÊûúÈÖçÁΩÆÈ°π‰ΩçÁΩÆ‰∏çÊ≠£Á°ÆÔºåËØ•ÈÖçÁΩÆÊòØ‰∏ç‰ºöÁîüÊïàÁöÑ„ÄÇ GENERALÈ¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™Áî®Êà∑ mysql Êù•ËøêË°å mysqld ËøõÁ®ãÔºåËØ∑Á°Æ‰øùËøô‰∏™Áî®Êà∑Êã•ÊúâÊìç‰ΩúÊï∞ÊçÆÁõÆÂΩïÁöÑÊùÉÈôê„ÄÇËÆæÁΩÆÈªòËÆ§Á´ØÂè£‰∏∫ 3306ÔºåÊúâÊó∂‰∏∫‰∫ÜÂÆâÂÖ®ÔºåÂèØËÉΩ‰ºö‰øÆÊîπ‰∏Ä‰∏ã„ÄÇÈªòËÆ§ÈÄâÊã© Innodb Â≠òÂÇ®ÂºïÊìéÔºåÂú®Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÊòØÊúÄÂ•ΩÁöÑÈÄâÊã©„ÄÇ‰ΩÜÂ¶ÇÊûúÈªòËÆ§ÊòØ InnoDBÔºåÂç¥ÈúÄË¶Å‰ΩøÁî® MyISAM Â≠òÂÇ®ÂºïÊìéÔºåËØ∑ÊòæÂºèÂú∞ËøõË°åÈÖçÁΩÆ„ÄÇËÆ∏Â§öÁî®Êà∑ËÆ§‰∏∫ÂÖ∂Êï∞ÊçÆÂ∫ì‰ΩøÁî®‰∫ÜÊüêÁßçÂ≠òÂÇ®ÂºïÊìé‰ΩÜÂÆûÈôÖ‰∏äÂç¥‰ΩøÁî®ÁöÑÊòØÂè¶Â§ñ‰∏ÄÁßçÔºåÂ∞±ÊòØÂõ†‰∏∫ÈªòËÆ§ÈÖçÁΩÆÁöÑÈóÆÈ¢ò„ÄÇ Êé•ÁùÄËÆæÁΩÆÊï∞ÊçÆÊñá‰ª∂ÁöÑ‰ΩçÁΩÆÔºåËøôÈáåÊää pid Êñá‰ª∂Âíå socket Êñá‰ª∂ÊîæÂà∞Áõ∏ÂêåÁöÑ‰ΩçÁΩÆÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•ÈÄâÊã©ÂÖ∂ÂÆÉ‰ΩçÁΩÆÔºå‰ΩÜË¶ÅÊ≥®ÊÑèÁöÑÊòØ‰∏çË¶ÅÂ∞Ü socket Êñá‰ª∂Âíå pid Êñá‰ª∂ÊîæÂà∞ MySQL ÁºñËØëÁöÑÈªòËÆ§‰ΩçÁΩÆÔºåÂõ†‰∏∫‰∏çÂêåÁâàÊú¨ÁöÑ MySQLÔºåËøô‰∏§‰∏™Êñá‰ª∂ÁöÑÈªòËÆ§Ë∑ØÂæÑÂèØËÉΩ‰ºö‰∏ç‰∏ÄËá¥ÔºåÊúÄÂ•ΩÊòéÁ°ÆÂú∞ËÆæÁΩÆËøô‰∫õÊñá‰ª∂ÁöÑ‰ΩçÁΩÆÔºå‰ª•ÂÖçÁâàÊú¨ÂçáÁ∫ßÊó∂Âá∫Áé∞ÈóÆÈ¢ò„ÄÇ Âú®Á±ª UNIX Á≥ªÁªü‰∏ãÊú¨Âú∞ËøûÊé• MySQL ÂèØ‰ª•ÈááÁî® UNIX ÂüüÂ•óÊé•Â≠óÊñπÂºèÔºåËøôÁßçÊñπÂºèÈúÄË¶Å‰∏Ä‰∏™Â•óÊé•Â≠óÔºàsocketÔºâÊñá‰ª∂ÔºåÂç≥ÈÖçÁΩÆ‰∏≠ÁöÑmysql.sockÊñá‰ª∂„ÄÇ ÂΩì MySQL ÂÆû‰æãÂêØÂä®Êó∂Ôºå‰ºöÂ∞ÜËá™Â∑±ÁöÑËøõÁ®ã ID ÂÜôÂÖ•‰∏Ä‰∏™Êñá‰ª∂‰∏≠‚Äî‚ÄîËØ•Êñá‰ª∂Âç≥‰∏∫ pid Êñá‰ª∂„ÄÇËØ•Êñá‰ª∂ÂèØÁî±ÂèÇÊï∞pid-fileÊéßÂà∂ÔºåÈªòËÆ§‰Ωç‰∫éÊï∞ÊçÆÂ∫ìÁõÆÂΩï‰∏ãÔºåÊñá‰ª∂Âêç‰∏∫‰∏ªÊú∫Âêç.pid„ÄÇ DATA STORAGEdatadirÁî®‰∫éÈÖçÁΩÆÊï∞ÊçÆÊñá‰ª∂ÁöÑÂ≠òÂÇ®‰ΩçÁΩÆÔºåÊ≤°Êúâ‰ªÄ‰πàÂ•ΩËØ¥ÁöÑ„ÄÇ ‰∏∫ÁºìÂ≠òÂàÜÈÖçÂÜÖÂ≠òÊé•‰∏ãÊù•ÊúâËÆ∏Â§öÊ∂âÂèäÂà∞ÁºìÂ≠òÁöÑÈÖçÁΩÆÈ°πÔºåÁºìÂ≠òËÆæÁΩÆÂ§öÂ§ßÔºåÊúÄÁõ¥Êé•ÁöÑÂõ†Á¥†ËÇØÂÆöÊòØÊúçÂä°Âô®ÂÜÖÂ≠òÁöÑÂ§ßÂ∞è„ÄÇÂ¶ÇÊûúÊúçÂä°Âô®Âè™ËøêË°å MySQLÔºåÊâÄÊúâ‰∏çÈúÄË¶Å‰∏∫ OS ‰ª•ÂèäÊü•ËØ¢Â§ÑÁêÜ‰øùÁïôÁöÑÂÜÖÂ≠òÈÉΩÂèØ‰ª•Áî®Âú® MySQL ÁºìÂ≠ò„ÄÇ‰∏∫ MySQL ÁºìÂ≠òÂàÜÈÖçÊõ¥Â§öÂÜÖÂ≠òÔºåÂèØ‰ª•ÊúâÊïàÁöÑÈÅøÂÖçÁ£ÅÁõòËÆøÈóÆÔºåÊèêÂçáÊï∞ÊçÆÂ∫ìÊÄßËÉΩ„ÄÇÂ§ßÈÉ®ÂàÜÊÉÖÂÜµÊù•ËØ¥ÊúÄ‰∏∫ÈáçË¶ÅÁöÑÁºìÂ≠òÔºö InnoDB ÁºìÂÜ≤Ê±† InnoDB Êó•ÂøóÊñá‰ª∂Âíå MyISAM Êï∞ÊçÆÁöÑÊìç‰ΩúÁ≥ªÁªüÁºìÂ≠ò (MyISAM ‰æùËµñ‰∫é OS ÁºìÂ≠òÊï∞ÊçÆ) MyISAM ÈîÆÁºìÂ≠ò Êü•ËØ¢ÁºìÂ≠ò Êó†Ê≥ïÈÖçÁΩÆÁöÑÁºìÂ≠òÔºåÊØîÂ¶ÇÔºöbin-log ÊàñËÄÖË°®ÂÆö‰πâÊñá‰ª∂ÁöÑ OS ÁºìÂ≠ò ËøòÊúâ‰∏Ä‰∫õÂÖ∂‰ªñÁºìÂ≠òÔºå‰ΩÜÂÆÉ‰ª¨ÈÄöÂ∏∏‰∏ç‰ºö‰ΩøÁî®Â§™Â§öÂÜÖÂ≠ò„ÄÇÂÖ≥‰∫éÊü•ËØ¢ÁºìÂ≠òÔºåÂâçÈù¢ÊñáÁ´† (ÂèÇËÄÉÊú¨Á≥ªÂàóÁöÑÁ¨¨‰∏ÄÁØá) Â∑≤Êúâ‰ªãÁªçÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÊàë‰ª¨‰∏çÂª∫ËÆÆÂºÄÂêØÊü•ËØ¢ÁºìÂ≠òÔºåÂõ†Ê≠§‰∏äÊñáÁöÑÈÖçÁΩÆ‰∏≠query-cache-type=0Ë°®Á§∫Á¶ÅÁî®‰∫ÜÊü•ËØ¢ÁºìÂ≠òÔºåÁõ∏Â∫îÁöÑÊü•ËØ¢ÁºìÂ≠òÂ§ßÂ∞èquery-cache-size=0„ÄÇÈô§ÂºÄÊü•ËØ¢ÁºìÂ≠òÔºåÂâ©‰∏ãÂÖ≥‰∫é InnoDB Âíå MyISAM ÁöÑÁõ∏ÂÖ≥ÁºìÂ≠òÔºåÂú®Êé•‰∏ãÊù•‰ºöÂÅöËØ¶ÁªÜ‰ªãÁªç„ÄÇ Â¶ÇÊûúÂè™‰ΩøÁî®Âçï‰∏ÄÂ≠òÂÇ®ÂºïÊìéÔºåÈÖçÁΩÆÊúçÂä°Âô®Â∞±‰ºöÁÆÄÂçïËÆ∏Â§ö„ÄÇÂ¶ÇÊûúÂè™‰ΩøÁî® MyISAM Ë°®ÔºåÂ∞±ÂèØ‰ª•ÂÆåÂÖ®ÂÖ≥Èó≠ InnoDBÔºåËÄåÂ¶ÇÊûúÂè™‰ΩøÁî® InnoDBÔºåÂ∞±Âè™ÈúÄË¶ÅÂàÜÈÖçÊúÄÂ∞ëÁöÑËµÑÊ∫êÁªô MyISAMÔºàMySQL ÂÜÖÈÉ®Á≥ªÁªüË°®‰ΩøÁî® MyISAM ÂºïÊìéÔºâ„ÄÇ‰ΩÜÂ¶ÇÊûúÊòØÊ∑∑Âêà‰ΩøÁî®ÂêÑÁßçÂ≠òÂÇ®ÂºïÊìéÔºåÂ∞±ÂæàÈöæÂú®‰ªñ‰ª¨‰πãÈó¥ÊâæÂà∞ÊÅ∞ÂΩìÁöÑÂπ≥Ë°°ÔºåÂõ†Ê≠§Âè™ËÉΩÊ†πÊçÆ‰∏öÂä°ÂÅö‰∏Ä‰∏™ÁåúÊµãÔºåÁÑ∂ÂêéÂú®ËøêË°å‰∏≠ËßÇÂØüÊúçÂä°Âô®ËøêË°åÁä∂ÂÜµÂêéÂÅöÂá∫Ë∞ÉÊï¥„ÄÇ MyISAMkey-buffer-size key-buffer-sizeÁî®‰∫éÈÖçÁΩÆ MyISAMÈîÆÁºìÂ≠òÂ§ßÂ∞èÔºåÈªòËÆ§Âè™Êúâ‰∏Ä‰∏™ÈîÆÁºìÂ≠òÔºå‰ΩÜÊòØÂèØ‰ª•ÂàõÂª∫Â§ö‰∏™„ÄÇMyISAM Ëá™Ë∫´Âè™ÁºìÂ≠òÁ¥¢ÂºïÔºå‰∏çÁºìÂ≠òÊï∞ÊçÆ (‰æùËµñ OS ÁºìÂ≠òÊï∞ÊçÆ)„ÄÇÂ¶ÇÊûúÂ§ßÈÉ®ÂàÜË°®ÈÉΩÊòØ MyISAMÔºåÈÇ£‰πàÂ∫îËØ•‰∏∫ÈîÆÁºìÂ≠òËÆæÁΩÆËæÉÂ§öÁöÑÂÜÖÂ≠ò„ÄÇ‰ΩÜÂ¶Ç‰ΩïÁ°ÆÂÆöËØ•ËÆæÁΩÆÂ§öÂ§ßÔºüÂÅáËÆæÊï¥‰∏™Êï∞ÊçÆÂ∫ì‰∏≠Ë°®ÁöÑÁ¥¢ÂºïÂ§ßÂ∞è‰∏∫ XÔºåËÇØÂÆö‰∏çÈúÄË¶ÅÊääÁºìÂ≠òËÆæÁΩÆÂæóÊØî X ËøòÂ§ßÔºåÊâÄ‰ª•ÂΩìÂâçÁöÑÁ¥¢ÂºïÂ§ßÂ∞èÂ∞±Êàê‰∏∫Ëøô‰∏™ÈÖçÁΩÆÈ°πÁöÑÈáçË¶Å‰æùÊçÆ„ÄÇÂèØ‰ª•ÈÄöËøá‰∏ãÈù¢‰∏§ÁßçÊñπÂºèÊù•Êü•ËØ¢ÂΩìÂâçÁ¥¢ÂºïÁöÑÂ§ßÂ∞èÔºö 1.ÈÄöËøá SQL ËØ≠Âè•Êü•ËØ¢1SELECT SUM(INDEX_LENGTH) FROM INFORMATION_SCHEMA.TABLES WHERE ENGINE = 'MYISAM' 2.ÁªüËÆ°Á¥¢ÂºïÊñá‰ª∂ÁöÑÂ§ßÂ∞è123456789101112131415$ du -sch `find /path/to/mysql/data/directory/ -name "*.MYI"`ÊØîÂ¶ÇÔºöroot@dev-msc3:# du -sch `find /var/lib/mysql -name "*.MYI"`72K /var/lib/mysql/static/t_global_region.MYI40K /var/lib/mysql/mysql/db.MYI12K /var/lib/mysql/mysql/proxies_priv.MYI12K /var/lib/mysql/mysql/tables_priv.MYI4.0K /var/lib/mysql/mysql/func.MYI4.0K /var/lib/mysql/mysql/columns_priv.MYI4.0K /var/lib/mysql/mysql/proc.MYI4.0K /var/lib/mysql/mysql/event.MYI4.0K /var/lib/mysql/mysql/user.MYI4.0K /var/lib/mysql/mysql/procs_priv.MYI4.0K /var/lib/mysql/mysql/ndb_binlog_index.MYI164K total ‰Ω†ÂèØËÉΩ‰ºöÈóÆÔºåÂàöÂàõÂª∫Â•ΩÁöÑÊï∞ÊçÆÂ∫ìÔºåÊ†πÊú¨Â∞±Ê≤°‰ªÄ‰πàÊï∞ÊçÆÔºåÁ¥¢ÂºïÊñá‰ª∂Â§ßÂ∞è‰∏∫ 0ÔºåÈÇ£Â¶Ç‰ΩïÈÖçÁΩÆÈîÆÁºìÂ≠òÂ§ßÂ∞èÔºüËøôÊó∂ÂÄôÂè™ËÉΩÊ†πÊçÆÁªèÈ™åÂÄºÔºö‰∏çË∂ÖËøá‰∏∫Êìç‰ΩúÁ≥ªÁªüÁºìÂ≠ò‰øùÁïôÂÜÖÂ≠òÁöÑ 25% ~ 50%„ÄÇËÆæÁΩÆ‰∏Ä‰∏™Âü∫Êú¨ÂÄºÔºåÁ≠âËøêË°å‰∏ÄÊÆµÊó∂Èó¥ÂêéÔºåÊ†πÊçÆËøêË°åÊÉÖÂÜµÊù•Ë∞ÉÊï¥ÈîÆÁºìÂ≠òÂ§ßÂ∞è„ÄÇÊÄªÁªìÊù•ËØ¥ÔºåÁ¥¢ÂºïÂ§ßÂ∞è‰∏é OS ÁºìÂ≠òÁöÑ 25%~50% ‰∏§ËÄÖÈó¥ÂèñÂ∞èËÄÖ„ÄÇÂΩìÁÑ∂ËøòÂèØ‰ª•ËÆ°ÁÆóÈîÆÁºìÂ≠òÁöÑ‰ΩøÁî®ÊÉÖÂÜµÔºåÂ¶ÇÊûú‰∏ÄÊÆµÊó∂Èó¥ÂêéËøòÊòØÊ≤°Êúâ‰ΩøÁî®ÂÆåÊâÄÊúâÁöÑÈîÆÁºìÂ≠òÔºåÂ∞±ÂèØ‰ª•ÊääÁºìÂÜ≤Âå∫Ë∞ÉÂ∞è‰∏ÄÁÇπÔºåËÆ°ÁÆóÁºìÂ≠òÂå∫ÁöÑ‰ΩøÁî®ÁéáÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂÖ¨ÂºèÔºö(key_blocks_unused * key_cache_block_size) / key_buffer_size ËØ¥ÊòéÔºö key_blocks_unused ÁöÑÂÄºÂèØ‰ª•ÈÄöËøá SHOW STATUS Ëé∑Âèñ key_cache_block_size ÁöÑÂÄºÂèØ‰ª•ÈÄöËøá SHOW VARIABLES Ëé∑Âèñ ÈîÆÁºìÂ≠òÂùóÂ§ßÂ∞èÊòØ‰∏Ä‰∏™ÊØîËæÉÈáçË¶ÅÁöÑÂÄºÔºåÂõ†‰∏∫ÂÆÉÂΩ±Âìç MyISAM„ÄÅOS ÁºìÂ≠ò‰ª•ÂèäÊñá‰ª∂Á≥ªÁªü‰πãÈó¥ÁöÑ‰∫§‰∫í„ÄÇÂ¶ÇÊûúÁºìÂ≠òÂùóÂ§™Â∞èÔºåÂèØËÉΩ‰ºöÁ¢∞Âà∞ÂÜôÊó∂ËØªÂèñ (OS Âú®ÂÜôÊï∞ÊçÆ‰πãÂâçÂøÖÈ°ªÂÖà‰ªéÁ£ÅÁõò‰∏äËØªÂèñ‰∏Ä‰∫õÊï∞ÊçÆ)ÔºåÂÖ≥‰∫éÂÜôÊó∂ËØªÂèñÁöÑÁõ∏ÂÖ≥Áü•ËØÜÔºåÂ§ßÂÆ∂ÂèØ‰ª•Ëá™Ë°åÊü•ÈòÖ„ÄÇ ÂÖ≥‰∫éÁºìÂ≠òÂëΩ‰∏≠ÁéáÔºåËøôÈáåÂÜçËØ¥‰∏ÄÁÇπ„ÄÇÁºìÂ≠òÂëΩ‰∏≠ÁéáÊúâ‰ªÄ‰πàÊÑè‰πâÔºüÂÖ∂ÂÆûËøô‰∏™Êï∞Â≠óÊ≤°Â§™Â§ßÁöÑ‰ΩúÁî®„ÄÇÊØîÂ¶Ç 99% Âíå 99.9% ‰πãÈó¥ÁúãËµ∑Êù•Â∑ÆË∑ùÂæàÂ∞èÔºå‰ΩÜÂÆûÈôÖ‰∏ä‰ª£Ë°®‰∫Ü 10 ÂÄçÁöÑÂ∑ÆË∑ù„ÄÇÁºìÂ≠òÂëΩ‰∏≠ÁéáÁöÑÂÆûÈôÖÊÑè‰πâ‰∏éÂ∫îÁî®‰πüÊúâÂæàÂ§ßÂÖ≥Á≥ªÔºåÊúâ‰∫õÂ∫îÁî®ÂèØ‰ª•Âú®ÂëΩ‰∏≠Áéá 99% ‰∏ãËâØÂ•ΩÁöÑÂ∑•‰ΩúÔºåÊúâ‰∫õ I/O ÂØÜÈõÜÂûãÂ∫îÁî®ÔºåÂèØËÉΩÈúÄË¶Å 99.99%„ÄÇÊâÄ‰ª•‰ªéÁªèÈ™å‰∏äÊù•ËØ¥ÔºåÊØèÁßíÊú™ÂëΩ‰∏≠Ê¨°Êï∞Ëøô‰∏™ÊåáÊ†áÂÆûÈôÖ‰∏ä‰ºöÊõ¥ÊúâÁî®‰∏Ä‰∫õ„ÄÇÊØîÂ¶ÇÊØèÁßí 5 Ê¨°Êú™ÂëΩ‰∏≠ÂèØËÉΩ‰∏ç‰ºöÂØºËá¥ IO ÁπÅÂøôÔºå‰ΩÜÊØèÁßí 100 Ê¨°ÁºìÂ≠òÊú™ÂëΩ‰∏≠ÂàôÂèØËÉΩÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ MyISAM ÈîÆÁºìÂ≠òÁöÑÊØèÁßíÊú™ÂëΩ‰∏≠Ê¨°Êï∞ÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÂëΩ‰ª§ÁõëÊéßÔºö123# ËÆ°ÁÆóÊØèÈöî10sÁºìÂ≠òÊú™ÂëΩ‰∏≠Ê¨°Êï∞ÁöÑÂ¢ûÈáè# ‰ΩøÁî®Ê≠§ÂëΩ‰ª§Êó∂ËØ∑Â∏¶‰∏äÁî®Êà∑ÂíåÂØÜÁ†ÅÂèÇÊï∞Ôºömysqladmin -uroot -pxxx extended-status -r -i 10 | grep Key_reads$ mysqladmin extended-status -r -i 10 | grep Key_reads ÊúÄÂêéÔºåÂç≥‰ΩøÊ≤°Êúâ‰ΩøÁî®‰ªª‰Ωï MyISAM Ë°®Ôºå‰æùÁÑ∂ÈúÄË¶ÅÂ∞Ükey-buffer-sizeËÆæÁΩÆ‰∏∫ËæÉÂ∞èÂÄºÔºåÊØîÂ¶Ç 32MÔºåÂõ†‰∏∫ MySQL ÂÜÖÈÉ®‰ºö‰ΩøÁî® MyISAM Ë°®ÔºåÊØîÂ¶Ç GROUP BY ËØ≠Âè•ÂèØËÉΩ‰ºöÂàõÂª∫ MyISAM ‰∏¥Êó∂Ë°®„ÄÇ myisam-recovermyisam-recoverÈÄâÈ°πÁî®‰∫éÈÖçÁΩÆ MyISAM ÊÄéÊ†∑ÂØªÊâæÂíå‰øÆÂ§çÈîôËØØ„ÄÇÊâìÂºÄËøô‰∏™ÈÄâÈ°π‰ºöÈÄöÁü• MySQL Âú®ÊâìÂºÄË°®Êó∂ÔºåÊ£ÄÊü•Ë°®ÊòØÂê¶ÊçüÂùèÔºåÂπ∂Âú®ÊâæÂà∞ÈóÆÈ¢òÊó∂ËøõË°å‰øÆÂ§çÔºåÂÆÉÂèØ‰ª•ËÆæÁΩÆÂ¶Ç‰∏ãÂÄºÔºö DEFAULTÔºöË°®Á§∫‰∏çËÆæÁΩÆÔºå‰ºöÂ∞ùËØï‰øÆÂ§çÂ¥©Ê∫ÉÊàñËÄÖÊú™ÂÆåÂÖ®ÂÖ≥Èó≠ÁöÑË°®Ôºå‰ΩÜÂú®ÊÅ¢Â§çÊï∞ÊçÆÊó∂‰∏ç‰ºöÊâßË°åÂÖ∂ÂÆÉÂä®‰Ωú BACKUPÔºöÂ∞ÜÊï∞ÊçÆÊñá‰ª∂Â§á‰ªΩÂà∞. bak Êñá‰ª∂Ôºå‰ª•‰æøÈöèÂêéËøõË°åÊ£ÄÊü• FORCEÔºöÂç≥‰Ωø. myd Êñá‰ª∂‰∏≠‰∏¢Â§±ÁöÑÊï∞ÊçÆË∂ÖËøá 1 Ë°åÔºå‰πüËÆ©ÊÅ¢Â§çÂä®‰ΩúÁªßÁª≠ÊâßË°å QUICKÔºöÈô§ÈùûÊúâÂà†Èô§ÂùóÔºåÂê¶ÂàôË∑≥ËøáÊÅ¢Â§ç ÂèØ‰ª•ËÆæÁΩÆÂ§ö‰∏™ÂÄºÔºåÊØè‰∏™ÂÄºÁî®ÈÄóÂè∑ÈöîÂºÄÔºåÊØîÂ¶ÇÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑBACKUP,FORCE‰ºöÂº∫Âà∂ÊÅ¢Â§çÂπ∂‰∏îÂàõÂª∫Â§á‰ªΩÔºåËøôÊ†∑ÈÖçÁΩÆÂú®Âè™Êúâ‰∏Ä‰∫õÂ∞èÁöÑ MyISAM Ë°®Êó∂ÊúâÁî®ÔºåÂõ†‰∏∫ÊúçÂä°Âô®ËøêË°åÁùÄ‰∏Ä‰∫õÊçüÂùèÁöÑ MyISAM Ë°®ÊòØÈùûÂ∏∏Âç±Èô©ÁöÑÔºåÂÆÉ‰ª¨ÊúâÊó∂ÂèØËÉΩ‰ºöÂØºËá¥Êõ¥Â§öÊï∞ÊçÆÊçüÂùèÔºåÁîöËá≥ÊúçÂä°Âô®Â¥©Ê∫É„ÄÇÁÑ∂ËÄåÂ¶ÇÊûúÊúâÂæàÂ§ßÁöÑË°®ÔºåÂÆÉ‰ºöÂØºËá¥ÊúçÂä°Âô®ÊâìÂºÄÊâÄÊúâÁöÑ MyISAM Ë°®Êó∂ÈÉΩÊ£ÄÊü•Âíå‰øÆÂ§çÔºåÂ§ßË°®ÁöÑÊ£ÄÊü•Âíå‰øÆÂ§çÂèØËÉΩ‰ºöËÄóË¥πÂ§ßÈáèÊó∂Èó¥Ôºå‰∏îÂú®ËøôÊÆµÊó∂Èó¥ÈáåÔºåMySQL ‰ºöÈòªÊ≠¢Ëøô‰∏™ËøûÊé•ÂÅöÂÖ∂ÂÆÉ‰ªª‰ΩïÊìç‰ΩúÔºåËøôÊòæÁÑ∂ÊòØ‰∏çÂàáÂÆûÈôÖÁöÑ„ÄÇ Âõ†Ê≠§ÔºåÂú®ÈªòËÆ§‰ΩøÁî® InnoDB Â≠òÂÇ®ÂºïÊìéÊó∂ÔºåÊï∞ÊçÆÂ∫ì‰∏≠Âè™ÊúâÈùûÂ∏∏Â∞èÁöÑ MyISAM Ë°®Êó∂ÔºåÂè™ÈúÄË¶ÅÈÖçÁΩÆkey-buffe-size‰∫é‰∏Ä‰∏™ÂæàÂ∞èÁöÑÂÄº (32M) ‰ª•Âèämyisam-recover=BACKUP,FORCE„ÄÇÂΩìÊï∞ÊçÆÂ∫ì‰∏≠Â§ßÈÉ®ÂàÜË°®‰∏∫ MyISAM Ë°®Êó∂ÔºåËØ∑Ê†πÊçÆ‰∏äÊñáÁöÑÂÖ¨ÂºèÂêàÁêÜÈÖçÁΩÆkey-buffer-sizeÔºåËÄåmyisam-recoverÂàôÂèØ‰ª•ÂÖ≥Èó≠ÔºåÂú®ÂêØÂä®Âêé‰ΩøÁî®CHECK TABLESÂíåREPAIR TABLESÂëΩ‰ª§Êù•ÂÅöÊ£ÄÊü•Âíå‰øÆÂ§çÔºåËøôÊ†∑ÂØπÊúçÂä°Âô®ÁöÑÂΩ±ÂìçÊØîËæÉÂ∞è„ÄÇ SAFETYÂü∫Êú¨ÈÖçÁΩÆËÆæÁΩÆÂà∞‰ΩçÂêéÔºåMySQL Â∑≤ÁªèÊØîËæÉÂÆâÂÖ®‰∫ÜÔºåËøôÈáå‰ªÖ‰ªÖÂàóÂá∫‰∏§‰∏™ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÈÖçÁΩÆÈ°πÔºåÂ¶ÇÊûúÈúÄË¶ÅÂêØÁî®‰∏Ä‰∫õ‰ΩøÊúçÂä°Âô®Êõ¥ÂÆâÂÖ®ÂíåÂèØÈù†ÁöÑËÆæÁΩÆÔºåÂèØ‰ª•ÂèÇËÄÉ MySQL ÂÆòÊñπÊâãÂÜåÔºå‰ΩÜÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂÆÉ‰ª¨ÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∫õÈÄâÈ°πÂèØËÉΩ‰ºöÂΩ±ÂìçÊÄßËÉΩÔºåÊØïÁ´ü‰øùËØÅÂÆâÂÖ®ÂíåÂèØÈù†ÈúÄË¶Å‰ªòÂá∫‰∏Ä‰∫õ‰ª£‰ª∑„ÄÇ max-allowed-packetmax-allowed-packetÈò≤Ê≠¢ÊúçÂä°Âô®ÂèëÈÄÅÂ§™Â§ßÁöÑÊï∞ÊçÆÂåÖÔºå‰πüÊéßÂà∂ÊúçÂä°Âô®ÂèØ‰ª•Êé•Êî∂Â§öÂ§ßÁöÑÂåÖ„ÄÇÈªòËÆ§ÂÄº 4MÔºåÂèØËÉΩ‰ºöÊØîËæÉÂ∞è„ÄÇÂ¶ÇÊûúËÆæÁΩÆÂ§™Â∞èÔºåÊúâÊó∂Â§çÂà∂‰∏ä‰ºöÂá∫ÈóÆÈ¢òÔºåË°®Áé∞‰∏∫‰ªéÂ∫ì‰∏çËÉΩÊé•Êî∂‰∏ªÂ∫ìÂèëËøáÊù•ÁöÑÂ§çÂà∂Êï∞ÊçÆ„ÄÇÂ¶ÇÊûúË°®‰∏≠Êúâ Blob ÊàñËÄÖ Text Â≠óÊÆµÔºå‰∏îÊï∞ÊçÆÈáèËæÉÂ§ßÁöÑËØùÔºåË¶ÅÂ∞èÂøÉÔºåÂ¶ÇÊûúÊï∞ÊçÆÈáèË∂ÖËøáËøô‰∏™ÂèòÈáèÁöÑÂ§ßÂ∞èÔºåÂÆÉ‰ª¨ÂèØËÉΩË¢´Êà™Êñ≠ÊàñËÄÖÁΩÆ‰∏∫ NULLÔºåËøôÈáåÂª∫ËÆÆËÆæÁΩÆ‰∏∫ 16M„ÄÇ max-connect-errorsËøô‰∏™ÂèòÈáèÊòØ‰∏Ä‰∏™ MySQL ‰∏≠‰∏éÂÆâÂÖ®Áõ∏ÂÖ≥ÁöÑËÆ°Êï∞Âô®ÂÄºÔºåÂÆÉ‰∏ªË¶ÅÈò≤Ê≠¢ÂÆ¢Êà∑Á´ØÊö¥ÂäõÁ†¥Ëß£ÂØÜÁ†Å„ÄÇÂ¶ÇÊûúÊüê‰∏Ä‰∏™ÂÆ¢Êà∑Á´ØÂ∞ùËØïËøûÊé• MySQL ÊúçÂä°Âô®Â§±Ë¥•Ë∂ÖËøá n Ê¨°ÔºåÂàô MySQL ‰ºöÊó†Êù°‰ª∂Âº∫Âà∂ÈòªÊ≠¢Ê≠§ÂÆ¢Êà∑Á´ØËøûÊé•ÔºåÁõ¥Âà∞ÂÜçÊ¨°Âà∑Êñ∞‰∏ªÊú∫ÁºìÂ≠òÊàñËÄÖÈáçÂêØ MySQL ÊúçÂä°Âô®„ÄÇ Ëøô‰∏™ÂÄºÈªòËÆ§‰∏∫ 10ÔºåÂ§™Â∞è‰∫ÜÔºåÊúâÊó∂ÂÄôÁΩëÁªúÊäΩÈ£éÊàñËÄÖÂ∫îÁî®ÈÖçÁΩÆÂá∫Áé∞ÈîôËØØÂØºËá¥Áü≠Êó∂Èó¥ÂÜÖ‰∏çÊñ≠Â∞ùËØïÈáçËøûÊúçÂä°Âô®ÔºåÂÆ¢Êà∑Á´ØÂ∞±‰ºöË¢´ÂàóÂÖ•ÈªëÂêçÂçïÔºåÂØºËá¥Êó†Ê≥ïËøûÊé•„ÄÇÂ¶ÇÊûúÂú®ÂÜÖÁΩëÁéØÂ¢ÉÔºåÂèØ‰ª•Á°ÆËÆ§Ê≤°ÊúâÂÆâÂÖ®ÈóÆÈ¢òÂèØ‰ª•ÊääËøô‰∏™ÂÄºËÆæÁΩÆÁöÑÂ§ß‰∏ÄÁÇπÔºåÈªòËÆ§ÂÄºÂ§™ÂÆπÊòìÂØºËá¥ÈóÆÈ¢ò„ÄÇ LOGGINGÊé•‰∏ãÊù•Áúã‰∏ãÊó•ÂøóÁöÑÈÖçÁΩÆÔºåÂØπ‰∫é MySQL Êù•ËØ¥ÔºåÊÖ¢Êó•ÂøóÂíå bin-log ÊòØÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰∏§ÁßçÊó•ÂøóÔºåÂâçËÄÖÂèØ‰ª•Â∏ÆÂä©Â∫îÁî®Á®ãÂ∫èÁõëÊéßÊÄßËÉΩÈóÆÈ¢òÔºåÂêéËÄÖÂú®Êï∞ÊçÆÂêåÊ≠•„ÄÅÂ§á‰ªΩÁ≠âÊñπÈù¢ÂèëÊå•ÁùÄÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰ΩúÁî®„ÄÇ ÂÖ≥‰∫é bin-log ÁöÑ 3 ‰∏™ÈÖçÁΩÆÔºålog-binÁî®‰∫éÈÖçÁΩÆÊñá‰ª∂Â≠òÊîæË∑ØÂæÑÔºåexpire_logs_daysËÆ©ÊúçÂä°Âô®Âú®ÊåáÂÆöÂ§©Êï∞‰πãÂêéÊ∏ÖÁêÜÊóßÁöÑÊó•ÂøóÔºåÂç≥ÈÖçÁΩÆ‰øùÁïôÊúÄËøëÂ§öÂ∞ëÂ§©ÁöÑÊó•Âøó„ÄÇÈô§ÈùûÊúâËøêÁª¥ÊâãÂä®Â§á‰ªΩÊ∏ÖÁêÜ bin-logÔºåÂê¶ÂàôÂº∫ÁÉàÂª∫ËÆÆÊâìÂºÄÊ≠§ÈÖçÁΩÆÔºåÂ¶ÇÊûú‰∏çÂêØÁî®ÔºåÊúçÂä°Âô®Á©∫Èó¥ÊúÄÁªàÂ∞Ü‰ºöË¢´ËÄóÂ∞ΩÔºåÂØºËá¥ÊúçÂä°Âô®Âç°‰ΩèÊàñËÄÖÂ¥©Ê∫É„ÄÇ sync-binlogsync-binlogÊéßÂà∂ÂΩì‰∫ãÂä°Êèê‰∫§‰πãÂêéÔºåMySQL ÊòØÂê¶Â∞Ü bin-log Âà∑Êñ∞Âà∞Á£ÅÁõò„ÄÇÂ¶ÇÊûúÂÖ∂ÂÄºÁ≠â‰∫é 0 ÊàñËÄÖÂ§ß‰∫é 1 Êó∂ÔºåÂΩì‰∫ãÂä°Êèê‰∫§‰πãÂêéÔºåMySQL ‰∏ç‰ºöÂ∞Ü bin-log Âà∑Êñ∞Âà∞Á£ÅÁõòÔºåÂÖ∂ÊÄßËÉΩÊúÄÈ´òÔºå‰ΩÜÂ≠òÂú®ÁöÑÈ£éÈô©‰πüÊòØÊúÄÂ§ßÁöÑÔºåÂõ†‰∏∫‰∏ÄÊó¶Á≥ªÁªüÂ¥©Ê∫ÉÔºåbin-log Â∞Ü‰ºö‰∏¢Â§±„ÄÇËÄåÂΩìÂÖ∂ÂÄºÁ≠â‰∫é 1 Êó∂ÔºåÊòØÊúÄÂÆâÂÖ®ÁöÑÔºåËøôÊó∂ÂÄôÂç≥‰ΩøÁ≥ªÁªüÂ¥©Ê∫ÉÔºåÊúÄÂ§ö‰πüÂ∞±‰∏¢Â§±Êú¨Ê¨°Êú™ÂÆåÊàêÁöÑ‰∫ãÂä°ÔºåÂØπÂÆûÈôÖÁöÑÊï∞ÊçÆÊ≤°ÊúâÂÆûË¥®ÊÄßÁöÑÂΩ±ÂìçÔºå‰ΩÜÊÄßËÉΩËæÉÂ∑Æ„ÄÇ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂú® 5.7.7 ‰πãÂâçÁöÑÁâàÊú¨ÔºåËøô‰∏™ÈÄâÊã©ÁöÑÈªòËÆ§ÂÄº‰∏∫ 0ÔºåËÄå‰πãÂêéÁöÑÁâàÊú¨ÈªòËÆ§ÂÄº‰∏∫ 1Ôºå‰πüÂ∞±ÊòØÊúÄÂÆâÂÖ®ÁöÑÁ≠ñÁï•„ÄÇÂØπ‰∫éÈ´òÂπ∂ÂèëÁöÑÊÄßËÉΩÔºåÈúÄË¶ÅÂÖ≥Ê≥®Ëøô‰∏ÄÁÇπÔºåÈò≤Ê≠¢ÁâàÊú¨ÂçáÁ∫ßÂêéÂá∫Áé∞ÊÄßËÉΩÈóÆÈ¢ò„ÄÇ Ââ©‰∏ãÁöÑ 4 ‰∏™ÈÖçÁΩÆÈ°πÂ∞±Ê≤°Â§™Â§öË¶ÅËØ¥ÁöÑ„ÄÇ log-errorÔºöÁî®‰∫éÈÖçÁΩÆÈîôËØØÊó•ÂøóÁöÑÂ≠òÊîæÁõÆÂΩï slow-query-logÔºöÊâìÂºÄÊÖ¢Êó•ÂøóÔºåÈªòËÆ§ÂÖ≥Èó≠ slow-query-log-fileÔºöÈÖçÁΩÆÊÖ¢Êó•ÂøóÁöÑÂ≠òÊîæÁõÆÂΩï log-queries-not-using-indexesÔºöÂ¶ÇÊûúËØ• sql Ê≤°Êúâ‰ΩøÁî®Á¥¢ÂºïÔºå‰ºöÂ∞ÜÂÖ∂ÂÜôÂÖ•Âà∞ÊÖ¢Êó•ÂøóÔºå‰ΩÜÊòØÂê¶ÁúüÁöÑÊâßË°åÂæàÊÖ¢ÔºåÈúÄË¶ÅÂå∫ÂàÜÔºåÈªòËÆ§ÂÖ≥Èó≠„ÄÇ CACHES AND LIMITStmp-table-size && max-heap-table-sizeËøô‰∏§‰∏™ÈÖçÁΩÆÊéßÂà∂‰ΩøÁî® Memory ÂºïÊìéÁöÑÂÜÖÂ≠ò‰∏¥Êó∂Ë°®ÂèØ‰ª•‰ΩøÁî®Â§öÂ§ßÁöÑÂÜÖÂ≠ò„ÄÇÂ¶ÇÊûúÈöêÂºèÂÜÖÂ≠ò‰∏¥Êó∂Ë°®ÁöÑÂ§ßÂ∞èË∂ÖËøáËøô‰∏§‰∏™ÂÄºÔºåÂ∞Ü‰ºöË¢´ËΩ¨‰∏∫Á£ÅÁõò MyISAM Ë°® (ÈöêÂºè‰∏¥Êó∂Ë°®Áî±ÊúçÂä°Âô®ÂàõÂª∫ÔºåÁî®Êà∑‰øùÂ≠òÊâßË°å‰∏≠ÁöÑÊü•ËØ¢ÁöÑ‰∏≠Èó¥ÁªìÊûú)„ÄÇ Â¶ÇÊûúÊü•ËØ¢ËØ≠Âè•Ê≤°ÊúâÂàõÂª∫Â∫ûÂ§ßÁöÑ‰∏¥Êó∂Ë°® (ÈÄöËøáÂêàÁêÜÁöÑÁ¥¢ÂºïÂíåÊü•ËØ¢ËÆæËÆ°Êù•ÈÅøÂÖç)ÔºåÂèØ‰ª•ÊääËøô‰∏™ÂÄºËÆæÂ§ß‰∏ÄÁÇπÔºå‰ª•ÂÖçÈúÄË¶ÅÊääÂÜÖÂ≠ò‰∏¥Êó∂Ë°®ËΩ¨Êç¢‰∏∫Á£ÅÁõò‰∏¥Êó∂Ë°®„ÄÇ‰ΩÜË¶ÅË∞®Èò≤Ëøô‰∏™ÂÄºËÆæÁΩÆÂæóËøáÂ§ßÔºåÂ¶ÇÊûúÊü•ËØ¢Á°ÆÂÆû‰ºöÂàõÂª∫ÂæàÂ§ßÁöÑ‰∏¥Êó∂Ë°®ÔºåÈÇ£‰πàËøòÊòØ‰ΩøÁî®Á£ÅÁõòÊØîËæÉÂ•ΩÔºåÊØïÁ´üÂπ∂ÂèëÊï∞‰∏ÄËµ∑Êù•ÔºåÊâÄÈúÄË¶ÅÁöÑÂÜÖÂ≠òÂ∞±‰ºöÊÄ•ÂâßÂ¢ûÈïø„ÄÇ Â∫îËØ•ÁÆÄÂçïÁöÑÊääËøô‰∏§‰∏™ÂèòÈáèËÆæ‰∏∫ÂêåÊ†∑ÁöÑÂÄºÔºåËøôÈáåÈÄâÊã©‰∫Ü 32MÔºåÂèØ‰ª•ÈÄöËøá‰ªîÁªÜÊ£ÄÊü•created-tmp-disk-tablesÂíåcreated-tmp-tables‰∏§‰∏™ÂèòÈáèÊù•ÊåáÂØº‰Ω†ËÆæÁΩÆÔºåËøô‰∏§‰∏™ÂèòÈáèÁöÑÂÄºÂ∞ÜÂ±ïÁ§∫‰∏¥Êó∂Ë°®ÁöÑÂàõÂª∫ÊúâÂ§öÈ¢ëÁπÅ„ÄÇ max-connections Áî®‰∫éËÆæÁΩÆÁî®Êà∑ÁöÑÊúÄÂ§ßËøûÊé•Êï∞Ôºå‰øùËØÅÊúçÂä°Âô®‰∏ç‰ºöÂ∫î‰∏∫Â∫îÁî®Á®ãÂ∫èÊøÄÂ¢ûÁöÑËøûÊé•ËÄå‰∏çÂ†™ÈáçË¥ü„ÄÇÂ¶ÇÊûúÂ∫îÁî®Á®ãÂ∫èÊúâÈóÆÈ¢òÔºåÊàñËÄÖÊúçÂä°Âô®ÈÅáÂà∞ËøûÊé•Âª∂ËøüÈóÆÈ¢òÔºå‰ºöÂàõÂª∫ÂæàÂ§öÊñ∞ËøûÊé•„ÄÇ‰ΩÜÂ¶ÇÊûúËøô‰∫õËøûÊé•‰∏çËÉΩÊâßË°åÊü•ËØ¢ÔºåÈÇ£ÊâìÂºÄ‰∏Ä‰∏™ËøûÊé•Ê≤°‰ªÄ‰πàÂ•ΩÂ§ÑÔºåÊâÄ‰ª•Ë¢´ ‚ÄúÂ§™Â§öÁöÑËøûÊé•‚Äù ÈîôËØØÊãíÁªùÊòØ‰∏ÄÁßçÂø´ÈÄüËÄå‰∏î‰ª£‰ª∑Â∞èÁöÑÂ§±Ë¥•ÊñπÂºè„ÄÇ Âú®ÊúçÂä°Âô®ËµÑÊ∫êÂÖÅËÆ∏ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•Êäämax-connectionsËÆæÁΩÆÁöÑË∂≥Â§üÂ§ßÔºå‰ª•ÂÆπÁ∫≥Ê≠£Â∏∏ÂèØËÉΩËææÂà∞ÁöÑË¥üËΩΩ„ÄÇËã•ËÆ§‰∏∫Ê≠£Â∏∏ÊÉÖÂÜµÂ∞ÜÊúâ 300 ÊàñËÄÖÊõ¥Â§öËøûÊé•ÔºåÂèØ‰ª•ËÆæÁΩÆ‰∏∫ 500 ÊàñËÄÖÊõ¥Â§ö (Â∫îÂØπÈ´òÂ≥∞Êúü)„ÄÇÈªòËÆ§ÂÄºÊòØ 100ÔºåÂ§™Â∞è‰∫ÜÔºåËøôÈáåËÆæÁΩÆ‰∏∫ 500Ôºå‰ΩÜÂπ∂‰∏çÊÑèÂë≥ÁùÄÂÖ∂ÊòØ‰∏Ä‰∏™ÂêàÁêÜÁöÑÂÄºÔºåÂ∫îËØ•ÁõëÊéßÂ∫îÁî®ÊúâÂ§öÂ∞ëËøûÊé•ÔºåÁÑ∂ÂêéÊ†πÊçÆÁõëÊéßÂÄº (ËßÇÂØümax_used_connectionsÈöèÊó∂Èó¥ÁöÑÂèòÂåñ) Êù•ËÆæÁΩÆ„ÄÇ thread-cache-size Á∫øÁ®ãÁºìÂ≠ò‰øùÂ≠òÈÇ£‰∫õÂΩìÂâçÊ≤°Êúâ‰∏éËøûÊé•ÂÖ≥ËÅî‰ΩÜÊòØÂáÜÂ§á‰∏∫ÂêéÈù¢Êñ∞ËøûÊé•ÊúçÂä°ÁöÑÁ∫øÁ®ã„ÄÇÂΩì‰∏Ä‰∏™Êñ∞ÁöÑËøûÊé•ÂàõÂª∫Êó∂ÔºåÂ¶ÇÊûúÁºìÂ≠ò‰∏≠ÊúâÁ∫øÁ®ãÂ≠òÂú®ÔºåMySQL Âàô‰ªéÁºìÂ≠ò‰∏≠Âà†Èô§‰∏Ä‰∏™Á∫øÁ®ãÔºåÂπ∂‰∏îÊääÂÆÉÂàÜÈÖçÁªôËøô‰∏™Êñ∞ËøûÊé•„ÄÇÂΩìËøûÊé•ÂÖ≥Èó≠Êó∂ÔºåÂ¶ÇÊûúÁ∫øÁ®ãÁºìÂ≠òËøòÊúâÁ©∫Èó¥ÁöÑËØùÔºåMySQL Âèà‰ºöÊääÁ∫øÁ®ãÊîæÂõûÁºìÂ≠ò„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÁ©∫Èó¥ÁöÑËØùÔºåMySQL ‰ºöÈîÄÊØÅËøô‰∏™Á∫øÁ®ã„ÄÇÂè™Ë¶Å MySQL Âú®ÁºìÂ≠òÈáåËøòÊúâÁ©∫Èó≤ÁöÑÁ∫øÁ®ãÔºåÂÆÉÂ∞±ÂèØ‰ª•ËøÖÈÄüÂìçÂ∫îËøûÊé•ËØ∑Ê±ÇÔºåÂõ†‰∏∫ËøôÊ†∑Â∞±‰∏çÁî®‰∏∫ÊØè‰∏™ËøûÊé•ÂàõÂª∫Êñ∞Á∫øÁ®ã„ÄÇthread-cache-sizeÊåáÂÆö MySQL ÂèØ‰ª•‰øùÂ≠òÂú®ÁºìÂ≠ò‰∏≠ÁöÑÁ∫øÁ®ãÊï∞Èáè„ÄÇÂ¶ÇÊûúÊúçÂä°Âô®Ê≤°ÊúâÂæàÂ§öÁöÑËøûÊé•ËØ∑Ê±ÇÔºå‰∏ÄËà¨‰∏çÈúÄË¶ÅÈÖçÁΩÆËøô‰∏™ÂÄº„ÄÇ Â¶Ç‰ΩïÂà§Êñ≠Ëøô‰∏™ÂÄºËØ•ËÆæÁΩÆÂ§öÂ§ßÔºü ËßÇÂØüthreads-connectedÂèòÈáèÔºåÂ¶ÇÊûúthreads-connectedÂú® 100-120ÔºåÈÇ£‰πàthread-cache-sizeËÆæÁΩÆ‰∏∫ 20„ÄÇÂ¶ÇÊûúÂÆÉ‰øùÊåÅÂú® 500-700Ôºå200 ÁöÑÁ∫øÁ®ãÁºìÂ≠òÂ∫îËØ•Ë∂≥Â§üÂ§ß‰∫Ü„ÄÇÂèØ‰ª•Ëøô‰πàÁêÜËß£ÔºöÂΩìÂêåÊó∂Êúâ 700 ‰∏™ËøûÊé•Êó∂ÔºåÂèØËÉΩÁºìÂ≠ò‰∏≠Ê≤°ÊúâÁ∫øÁ®ã„ÄÇÂú® 500 ‰∏™ËøûÊé•Êó∂ÔºåÊúâ 200 ‰∏™ÁºìÂ≠òÁöÑÁ∫øÁ®ãÂáÜÂ§á‰∏∫Ë¥üËΩΩÂÜçÊ¨°Â¢ûÂä†Âà∞ 700 ‰∏™ËøûÊé•Êó∂‰ΩøÁî®„ÄÇ open-files-limit Âú®Á±ª Uinux Á≥ªÁªü‰∏äÊàë‰ª¨ÊääÂÆÉËÆæÁΩÆÂæóÂ∞ΩÂèØËÉΩÂ§ß„ÄÇÁé∞‰ª£ OS ‰∏≠ÊâìÂºÄÂè•ÊüÑÂºÄÈîÄÈÉΩÂæàÂ∞èÔºåÂ¶ÇÊûúÊ≠§ÂèÇÊï∞ËÆæÁΩÆËøáÂ∞èÔºåÂèØËÉΩ‰ºöÈÅáÂà∞ ‚ÄúÊâìÂºÄÁöÑÊñá‰ª∂Â§™Â§ö (too many open files)‚Äù ÈîôËØØ„ÄÇ table_cache_size Ë°®ÁºìÂ≠òË∑üÁ∫øÁ®ãÁºìÂ≠òÁ±ª‰ººÔºå‰ΩÜÂ≠òÂÇ®ÁöÑÂØπË±°ÊòØË°®ÔºåÂÖ∂ÂåÖÂê´Ë°®. frm Êñá‰ª∂ÁöÑËß£ÊûêÁªìÊûúÂíå‰∏Ä‰∫õÂÖ∂‰ªñÊï∞ÊçÆ„ÄÇÂáÜÁ°ÆÁöÑËØ¥ÔºåÁºìÂ≠òÁöÑÊï∞ÊçÆ‰æùËµñ‰∫éÂ≠òÂÇ®ÂºïÊìéÔºåÊØîÂ¶ÇÔºåÂØπ‰∫é MyISAMÔºåÁºìÂ≠òË°®ÁöÑÊï∞ÊçÆÂíåÁ¥¢ÂºïÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇË°®ÁºìÂ≠òÂØπ InnoDB ÁöÑÂ≠òÂÇ®ÂºïÊìéÊù•ËØ¥ÔºåÈáçË¶ÅÊÄß‰ºöÂ∞èÂæàÂ§öÔºåÂõ†‰∏∫ InnoDB ‰∏ç‰æùËµñÂÆÉÊù•ÂÅöÈÇ£‰πàÂ§öÁöÑ‰∫ã„ÄÇ ‰ªé 5.1 ÁâàÊú¨Âèä‰ª•ÂêéÔºåË°®ÁºìÂ≠òÂ∞±Ë¢´ÂàÜ‰∏∫‰∏§‰∏™ÈÉ®ÂàÜÔºöÊâìÂºÄË°®ÁºìÂ≠òÂíåÂÆö‰πâË°®ÁºìÂ≠òÔºåÂàÜÂà´ÈÄöËøátable-open-cache-sizeÂíåtable-definition-cache-sizeÂèòÈáèÊù•ÈÖçÁΩÆ„ÄÇÈÄöÂ∏∏ÂèØ‰ª•Êäätable-definition-cache-sizeËÆæÁΩÆÂæóË∂≥Â§üÈ´òÔºå‰ª•ÁºìÂ≠òÊâÄÊúâÁöÑË°®ÂÆö‰πâÔºåÂõ†‰∏∫Â§ßÈÉ®ÂàÜÂ≠òÂÇ®ÂºïÊìéÈÉΩËÉΩ‰ªétable-definition-cacheËé∑Áõä„ÄÇ InnoDB InnoDB Â∫îËØ•ÊòØ‰ΩøÁî®ÊúÄÂπøÂèëÁöÑÂ≠òÂÇ®ÂºïÊìéÔºåÊúÄÈáçË¶ÅÁöÑÈÖçÁΩÆÈÄâÈ°πÊòØ‰∏ãÈù¢Ëøô‰∏§‰∏™Ôºöinnodb-buffer-pool-size‰∏éinnodb-log-file-sizeÔºåËß£ÂÜ≥Ëøô‰∏§‰∏™ÈÖçÁΩÆÂü∫Êú¨‰∏äÂ∞±Ëß£ÂÜ≥‰∫ÜÁúüÂÆûÂú∫ÊôØ‰∏ãÁöÑÂ§ßÈÉ®ÂàÜÈÖçÁΩÆÈóÆÈ¢ò„ÄÇ innodb-buffer-pool-size Â¶ÇÊûúÂ§ßÈÉ®ÂàÜÊòØ InnoDB Ë°®ÔºåÈÇ£‰πà InnoDB ÁºìÂÜ≤Ê±†ÊàñËÆ∏ÊØîÂÖ∂‰ªñ‰ªª‰Ωï‰∏úË•øÈÉΩÊõ¥ÈúÄË¶ÅÂÜÖÂ≠òÔºåInnoDB ÁºìÂÜ≤Ê±†ÁºìÂÜ≤ÁöÑÊï∞ÊçÆÔºöÁ¥¢Âºï„ÄÅË°åÊï∞ÊçÆ„ÄÅËá™ÈÄÇÂ∫îÂìàÂ∏åÁ¥¢Âºï„ÄÅÊèíÂÖ•ÁºìÂÜ≤„ÄÅÈîÅ‰ª•ÂèäÂÖ∂‰ªñÂÜÖÈÉ®Êï∞ÊçÆÁªìÊûÑ„ÄÇInnoDB Ëøò‰ΩøÁî®ÁºìÂÜ≤Ê±†Êù•Â∏ÆÂä©Âª∂ËøüÂÜôÂÖ•ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÂêàÂπ∂Â§ö‰∏™ÂÜôÂÖ•Êìç‰ΩúÔºåÁÑ∂Âêé‰∏ÄËµ∑È°∫Â∫èÂÜôÂÖ•ÔºåÊèêÂçáÊÄßËÉΩ„ÄÇÊÄª‰πãÔºåInnoDB ‰∏•Èáç‰æùËµñÁºìÂÜ≤Ê±†ÔºåÂøÖÈ°ª‰∏∫ÂÖ∂ÂàÜÈÖçË∂≥Â§üÁöÑÂÜÖÂ≠ò„ÄÇ ÂΩìÁÑ∂ÔºåÂ¶ÇÊûúÊï∞ÊçÆÈáè‰∏çÂ§ß‰∏î‰∏ç‰ºöÂø´ÈÄüÂ¢ûÈïøÔºåÂ∞±Ê≤°ÊúâÂøÖË¶Å‰∏∫ÁºìÂÜ≤Ê±†ÂàÜÈÖçËøáÂ§öÁöÑÂÜÖÂ≠òÔºåÊääÁºìÂÜ≤Ê±†ÈÖçÁΩÆÂæóÊØîÈúÄË¶ÅÁºìÂ≠òÁöÑË°®ÂíåÁ¥¢ÂºïËøòË¶ÅÂ§ßÂæàÂ§öÔºåÂÆûÈôÖ‰∏ä‰πüÊ≤°Êúâ‰ªÄ‰πàÊÑè‰πâ„ÄÇÂæàÂ§ßÁöÑÁºìÂÜ≤Ê±†‰πü‰ºöÂ∏¶Êù•‰∏Ä‰∫õÊåëÊàòÔºå‰æãÂ¶ÇÔºåÈ¢ÑÁÉ≠ÂíåÂÖ≥Èó≠ÈÉΩ‰ºöËä±Ë¥πÂæàÈïøÁöÑÊó∂Èó¥„ÄÇÂ¶ÇÊûúÊúâÂæàÂ§öËÑèÈ°µÂú®ÁºìÂÜ≤Ê±†ÈáåÔºåInnoDB ÂÖ≥Èó≠Êó∂ÂèØËÉΩ‰ºöËä±ÂæàÈïøÊó∂Èó¥Êù•ÊääËÑèÈ°µÂÜôÂõûÊï∞ÊçÆÊñá‰ª∂„ÄÇËôΩÁÑ∂ÂèØ‰ª•Âø´ÈÄüÂÖ≥Èó≠Ôºå‰ΩÜÊòØÂú®ÂêØÂä®Êó∂ÈúÄË¶ÅÂÅöÊõ¥Â§öÁöÑÊÅ¢Â§çÂ∑•‰ΩúÔºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨Êó†Ê≥ïÂêåÊó∂Âä†ÈÄüÂÖ≥Èó≠ÂíåÈáçÂêØ‰∏§‰∏™Êìç‰Ωú„ÄÇÂΩìÊúâ‰∏Ä‰∏™ÂæàÂ§ßÁöÑÁºìÂÜ≤Ê±†ÔºåÈáçÂêØÊúçÂä°ÈúÄË¶ÅËä±Ë¥πÂæàÈïøÊó∂Èó¥ÔºàÂá†Â∞èÊó∂ÊàñËÄÖÂá†Â§©ÔºâÊù•È¢ÑÁÉ≠ÔºåÂ∞§ÂÖ∂ÊòØÁ£ÅÁõòÂæàÊÖ¢ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÊÉ≥Âä†Âø´È¢ÑÁÉ≠Êó∂Èó¥ÔºåÂèØ‰ª•Âú®ÈáçÂêØÂêéÁ´ãÂàªËøõË°åÂÖ®Ë°®Êâ´ÊèèÊàñËÄÖÁ¥¢ÂºïÊâ´ÊèèÔºåÊääÁ¥¢ÂºïËΩΩÂÖ•ÁºìÂÜ≤Ê±†„ÄÇ ÂèØ‰ª•ÁúãÂà∞Á§∫‰æãÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏≠ÊääËøô‰∏™ÂÄºÈÖçÁΩÆ‰∏∫ 12GÔºåËøô‰∏çÊòØ‰∏Ä‰∏™Ê†áÂáÜÈÖçÁΩÆÔºåÈúÄË¶ÅÊ†πÊçÆÂÖ∑‰ΩìÁöÑÁ°¨‰ª∂Êù•‰º∞ÁÆó„ÄÇÈÇ£Â¶Ç‰Ωï‰º∞ÁÆóÔºü ÂâçÈù¢ÁöÑÂ∞èËäÇÔºåÊàë‰ª¨ËØ¥Âà∞ÔºåMySQL ‰∏≠ÊúÄÈáçË¶ÅÁöÑÁºìÂ≠òÊúâ 5 ÁßçÔºåÂèØ‰ª•ÁÆÄÂçïÁöÑ‰ΩøÁî®‰∏ãÈù¢ÁöÑÂÖ¨ÂºèËÆ°ÁÆóÔºö InnoDB ÁºìÂÜ≤Ê±† = ÊúçÂä°Âô®ÊÄªÂÜÖÂ≠ò - OS È¢ÑÁïô - ÊúçÂä°Âô®‰∏äÁöÑÂÖ∂‰ªñÂ∫îÁî®Âç†Áî®ÂÜÖÂ≠ò - MySQL Ëá™Ë∫´ÈúÄË¶ÅÁöÑÂÜÖÂ≠ò - InnoDB Êó•ÂøóÊñá‰ª∂Âç†Áî®ÂÜÖÂ≠ò - ÂÖ∂ÂÆÉÂÜÖÂ≠ò (MyISAM ÈîÆÁºìÂ≠ò„ÄÅÊü•ËØ¢ÁºìÂ≠òÁ≠â) ÂÖ∑‰ΩìÊù•ÁúãÔºåËá≥Â∞ëÈúÄË¶Å‰∏∫ OS ‰øùÁïô 1~2G ÂÜÖÂ≠òÔºåÂ¶ÇÊûúÊú∫Âô®ÂÜÖÂ≠òÂ§ßÁöÑËØùÂèØ‰ª•È¢ÑÁïôÂ§ö‰∏Ä‰∫õÔºåÂª∫ËÆÆ 2GB ÂíåÊÄªÂÜÖÂ≠òÁöÑ 5% ‰∏∫Âü∫ÂáÜÔºå‰ª•ËæÉÂ§ßËÄÖ‰∏∫ÂáÜÔºåÂ¶ÇÊûúÊú∫Âô®‰∏äËøòËøêË°åÁùÄ‰∏Ä‰∫õÂÜÖÂ≠òÂØÜÈõÜÂûã‰ªªÂä°ÔºåÊØîÂ¶ÇÔºåÂ§á‰ªΩ‰ªªÂä°ÔºåÈÇ£‰πàÂèØ‰ª•‰∏∫ OS ÂÜçÈ¢ÑÁïôÂ§ö‰∏Ä‰∫õÂÜÖÂ≠ò„ÄÇ‰∏çË¶Å‰∏∫ OS ÁºìÂ≠òÂ¢ûÂä†‰ªª‰ΩïÂÜÖÂ≠òÔºåÂõ†‰∏∫ OS ÈÄöÂ∏∏‰ºöÂà©Áî®ÊâÄÊúâÂâ©‰∏ãÁöÑÂÜÖÂ≠òÊù•ÂÅöÊñá‰ª∂ÁºìÂ≠ò„ÄÇ ‰∏ÄËà¨Êù•ËØ¥ÔºåËøêË°å MySQL ÁöÑÊúçÂä°Âô®ÂæàÂ∞ë‰ºöËøêË°åÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÔºå‰ΩÜÂ¶ÇÊûúÊúâÁöÑËØùÔºåËØ∑‰∏∫Ëøô‰∫õÂ∫îÁî®Á®ãÂ∫èÈ¢ÑÁïôË∂≥Â§üÂ§öÁöÑÂÜÖÂ≠ò„ÄÇ MySQL Ëá™Ë∫´ËøêË°åËøòÈúÄË¶Å‰∏Ä‰∫õÂÜÖÂ≠òÔºå‰ΩÜÈÄöÂ∏∏ÈÉΩ‰∏ç‰ºöÂ§™Â§ß„ÄÇÈúÄË¶ÅËÄÉËôë MySQL ÊØè‰∏™ËøûÊé•ÈúÄË¶ÅÁöÑÂÜÖÂ≠òÔºåËôΩÁÑ∂ÊØè‰∏™ËøûÊé•ÈúÄË¶ÅÁöÑÂÜÖÂ≠òÈÉΩÂæàÂ∞ëÔºå‰ΩÜÂÆÉËøòË¶ÅÊ±Ç‰∏Ä‰∏™Âü∫Êú¨ÈáèÁöÑÂÜÖÂ≠òÊù•ÊâßË°å‰ªª‰ΩïÁªôÂÆöÁöÑÊü•ËØ¢ÔºåËÄå‰∏îÊü•ËØ¢ËøáÁ®ã‰∏≠ËøòÈúÄË¶Å‰∏∫ÊéíÂ∫è„ÄÅGROUP BY Á≠âÊìç‰ΩúÂàÜÈÖç‰∏¥Êó∂Ë°®ÂÜÖÂ≠òÔºåÂõ†Ê≠§ÈúÄË¶Å‰∏∫È´òÂ≥∞ÊúüÊâßË°åÂ§ßÈáèÁöÑÊü•ËØ¢È¢ÑÁïôË∂≥Â§üÁöÑÂÜÖÂ≠ò„ÄÇËøô‰∏™ÂÜÖÂ≠òÊúâÂ§öÂ§ßÔºüÂè™ËÉΩÂú®ËøêË°åËøáÁ®ã‰∏≠ÁõëÊéß„ÄÇ Â¶ÇÊûúÂ§ßÈÉ®ÂàÜË°®ÈÉΩÊòØ InnoDBÔºåMyISAM ÈîÆÁºìÂ≠òÈÖçÁΩÆ‰∏Ä‰∏™ÂæàÂ∞èÂÄºË∂≥Áü£ÔºåÊü•ËØ¢ÁºìÂ≠ò‰πüÂª∫ËÆÆÂÖ≥Èó≠„ÄÇ ÂÖ¨Âºè‰∏≠Â∞±Ââ©‰∏ã InnoDB Êó•ÂøóÊñá‰ª∂‰∫ÜÔºåËøôÂ∞±ÊòØÊàë‰ª¨Êé•‰∏ãÊù•Ë¶ÅËØ¥ÁöÑ„ÄÇ innodb-log-file-size && innodb-log-files-in-group Â¶ÇÊûúÂØπ InnoDB Êï∞ÊçÆË°®ÊúâÂ§ßÈáèÁöÑÂÜôÂÖ•Êìç‰ΩúÔºåÈÇ£‰πàÈÄâÊã©ÂêàÈÄÇÁöÑinnodb-log-file-sizeÂÄºÂØπÊèêÂçá MySQL ÊÄßËÉΩÂæàÈáçË¶Å„ÄÇInnoDB ‰ΩøÁî®Êó•ÂøóÊù•ÂáèÂ∞ëÊèê‰∫§‰∫ãÂä°Êó∂ÁöÑÂºÄÈîÄ„ÄÇÊó•Âøó‰∏≠ËÆ∞ÂΩï‰∫Ü‰∫ãÂä°ÔºåÂ∞±Êó†È°ªÂú®ÊØè‰∏™‰∫ãÂä°Êèê‰∫§Êó∂ÊääÁºìÂÜ≤Ê±†ÁöÑËÑèÂùó (ÁºìÂ≠ò‰∏≠‰∏éÁ£ÅÁõò‰∏äÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÈ°µ) Âà∑Êñ∞Âà∞Á£ÅÁõò„ÄÇ‰∫ãÂä°‰øÆÊîπÁöÑÊï∞ÊçÆÂíåÁ¥¢ÂºïÈÄöÂ∏∏‰ºöÊò†Â∞ÑÂà∞Ë°®Á©∫Èó¥ÁöÑÈöèÊú∫‰ΩçÁΩÆÔºåÊâÄ‰ª•Âà∑Êñ∞Ëøô‰∫õÂèòÊõ¥Âà∞Á£ÅÁõòÈúÄË¶ÅÂæàÂ§öÈöèÊú∫ I/O„ÄÇ‰∏ÄÊó¶Êó•ÂøóÂÆâÂÖ®ÁöÑÂÜôÂÖ•Á£ÅÁõòÔºå‰∫ãÂä°Â∞±ÊåÅ‰πÖÂåñ‰∫ÜÔºåÂç≥‰ΩøÂèòÊõ¥ËøòÊ≤°ÊúâÂÜôÂà∞Êï∞ÊçÆÊñá‰ª∂ÔºåÂú®‰∏Ä‰∫õÊÑèÂ§ñÊÉÖÂÜµÂèëÁîüÊó∂ (ÊØîÂ¶ÇÊñ≠Áîµ‰∫Ü)ÔºåInnoDB ÂèØ‰ª•ÈáçÊîæÊó•ÂøóÂπ∂‰∏îÊÅ¢Â§çÂ∑≤ÁªèÊèê‰∫§ÁöÑ‰∫ãÂä°„ÄÇ InnoDB ‰ΩøÁî®‰∏Ä‰∏™ÂêéÂè∞Á∫øÁ®ãÊô∫ËÉΩÂú∞Âà∑Êñ∞Ëøô‰∫õÂèòÊõ¥Âà∞Êï∞ÊçÆÊñá‰ª∂„ÄÇÂÆûÈôÖ‰∏äÔºå‰∫ãÂä°Êó•ÂøóÊääÊï∞ÊçÆÊñá‰ª∂ÁöÑÈöèÊú∫ I/O ËΩ¨Êç¢‰∏∫Âá†‰πéÈ°∫Â∫èÂú∞Êó•ÂøóÊñá‰ª∂ÂíåÊï∞ÊçÆÊñá‰ª∂ I/OÔºåËÆ©Âà∑Êñ∞Êìç‰ΩúÂú®ÂêéÂè∞ÂèØ‰ª•Êõ¥Âø´ÁöÑÂÆåÊàêÔºåÂπ∂‰∏îÁºìÂ≠ò I/O ÂéãÂäõ„ÄÇ Êï¥‰ΩìÁöÑÊó•ÂøóÊñá‰ª∂Â§ßÂ∞èÂèóÊéß‰∫éinnodb-log-file-sizeÂíåinnodb-log-files-in-group‰∏§‰∏™ÂèÇÊï∞ÔºåËøôÂØπÂÜôÊÄßËÉΩÈùûÂ∏∏ÈáçË¶Å„ÄÇÊó•ÂøóÊñá‰ª∂ÁöÑÊÄªÂ§ßÂ∞èÊòØÊØè‰∏™Êñá‰ª∂ÁöÑÂ§ßÂ∞è‰πãÂíå„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂè™Êúâ‰∏§‰∏™ 5M ÁöÑÊñá‰ª∂ÔºåÊÄªÂÖ± 10MÔºåÂØπÈ´òÊÄßËÉΩÂ∑•‰ΩúÊù•ËØ¥Â§™Â∞è‰∫ÜÔºåËá≥Â∞ëÈúÄË¶ÅÂá†Áôæ M ÊàñËÄÖ‰∏ä G ÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇËøôÈáåË¶ÅÊ≥®ÊÑèinnodb-log-files-in-groupËøô‰∏™ÂèÇÊï∞ÔºåÂÆÉÊéßÂà∂Êó•ÂøóÊñá‰ª∂ÁöÑÊï∞ÈáèÔºå‰ªéÂêçÂ≠ó‰∏äÁúãÂ•Ω‰ººÈÖçÁΩÆ‰∏Ä‰∏™Êó•ÂøóÁªÑÊúâÂá†‰∏™Êñá‰ª∂ÔºåÂÆûÈôÖ‰∏äÔºålog groupË°®Á§∫‰∏Ä‰∏™ÈáçÂÅöÊó•ÂøóÁöÑÊñá‰ª∂ÈõÜÂêàÔºåÊ≤°ÊúâÂèÇÊï∞‰πüÊ≤°ÊúâÂøÖË¶ÅÈÖçÁΩÆÊúâÂ§öÂ∞ë‰∏™Êó•ÂøóÁªÑ„ÄÇ ‰øÆÊîπÊó•ÂøóÊñá‰ª∂ÁöÑÂ§ßÂ∞èÔºåÈúÄË¶ÅÂÆåÂÖ®ÂÖ≥Èó≠ MySQLÔºåÁÑ∂ÂêéÂ∞ÜÊóßÁöÑÊó•ÂøóÊñá‰ª∂ËøÅÁßªÂà∞ÂÖ∂‰ªñÂú∞ÊñπÔºåÈáçÊñ∞ÈÖçÁΩÆÂèÇÊï∞ÔºåÁÑ∂ÂêéÈáçÂêØ„ÄÇÈáçÂêØÊó∂ÈúÄË¶ÅÂ∞ÜÊóßÁöÑÊó•ÂøóËøÅÁßªÂõûÊù•ÔºåÁÑ∂ÂêéÁ≠âÂæÖ MySQL ÊÅ¢Â§çÊï∞ÊçÆÂêéÔºåÂÜçÂà†Èô§ÊóßÁöÑÊó•ÂøóÊñá‰ª∂ÔºåËØ∑‰∏ÄÂÆöË¶ÅÊü•ÁúãÈîôËØØÊó•ÂøóÔºåÁ°ÆËÆ§ MySQL ÈáçÂêØÊàêÂäüÂêéÂÜçÂà†Èô§ÊóßÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇ ÊÉ≥Ë¶ÅÁ°ÆÂÆöÁêÜÊÉ≥ÁöÑÊó•ÂøóÊñá‰ª∂Â§ßÂ∞èÔºåÈúÄË¶ÅÊùÉË°°Ê≠£Â∏∏Êï∞ÊçÆÂèòÊõ¥ÁöÑÂºÄÈîÄÔºå‰ª•ÂèäÂ¥©Ê∫ÉÊó∂ÊÅ¢Â§çÈúÄË¶ÅÁöÑÊó∂Èó¥„ÄÇÂ¶ÇÊûúÊó•ÂøóÂ§™Â∞èÔºåInnoDB Â∞ÜÂøÖÈ°ªË¶ÅÂÅöÊõ¥Â§öÁöÑÊ£ÄÊü•ÁÇπÔºåÂØºËá¥Êõ¥Â§öÁöÑÊó•ÂøóÂÜôÔºåÂú®ÊûÅ‰∏™Âà´ÊÉÖÂÜµ‰∏ãÔºåÂÜôËØ≠Âè•Ëøò‰ºöË¢´ÊãñÁ¥ØÔºåÂú®Êó•ÂøóÊ≤°ÊúâÁ©∫Èó¥ÁªßÁª≠ÂÜôÂÖ•ÂâçÔºåÂøÖÈ°ªÁ≠âÂæÖÂèòÊõ¥Ë¢´Âà∑Êñ∞Âà∞Êï∞ÊçÆÊñá‰ª∂„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÂ¶ÇÊûúÊó•ÂøóÂ§™Â§ßÔºåÂú®Â¥©Ê∫ÉÊó∂ÊÅ¢Â§çÂ∞±ÂæóÂÅöÂ§ßÈáèÁöÑÂ∑•‰ΩúÔºåËøôÂèØËÉΩÂ¢ûÂ§ßÊÅ¢Â§çÊó∂Èó¥„ÄÇInnoDB ‰ºöÈááÁî® checkpoint Êú∫Âà∂Êù•Âà∑Êñ∞ÂíåÊÅ¢Â§çÊï∞ÊçÆÔºåËøô‰ºöÂä†Âø´ÊÅ¢Â§çÊï∞ÊçÆÁöÑÊó∂Èó¥ÔºåÂÖ∑‰ΩìÂèØ‰ª•ÂèÇËÄÉÔºö MySQL-checkpoint ÊäÄÊúØ How InnoDB performs a checkpoint innodb-flush-log-at-trx-commit ÂâçÈù¢ËÆ®ËÆ∫‰∫ÜÂæàÂ§öÁºìÂ≠òÔºåInnoDB Êó•Âøó‰πüÊòØÊúâÁºìÂ≠òÁöÑ„ÄÇÂΩì InnoDB ÂèòÊõ¥‰ªª‰ΩïÊï∞ÊçÆÊó∂Ôºå‰ºöÂÜô‰∏ÄÊù°ÂèòÊõ¥ËÆ∞ÂΩïÂà∞Êó•ÂøóÁºìÂ≠òÂå∫„ÄÇÂú®ÁºìÂÜ≤ÊÖ¢ÁöÑÊó∂ÂÄô„ÄÅ‰∫ãÂä°Êèê‰∫§ÁöÑÊó∂ÂÄôÔºåÊàñËÄÖÊØè‰∏ÄÁßíÈíüÔºåInnoDB ÈÉΩ‰ºöÂ∞ÜÁºìÂÜ≤Âå∫ÁöÑÊó•ÂøóÂà∑Êñ∞Âà∞Á£ÅÁõòÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇÂ¶ÇÊûúÊúâÂ§ß‰∫ãÂä°ÔºåÂ¢ûÂä†Êó•ÂøóÁºìÂÜ≤Âå∫Â§ßÂ∞èÂèØ‰ª•Â∏ÆÂä©ÂáèÂ∞ë I/OÔºåÂèòÈáèinnodb-log-buffer-sizeÂèØ‰ª•ÊéßÂà∂Êó•ÂøóÁºìÂÜ≤Âå∫ÁöÑÂ§ßÂ∞è„ÄÇÈÄöÂ∏∏‰∏çÈúÄË¶ÅÊääÊó•ÂøóÁºìÂÜ≤Âå∫ËÆæÁΩÆÁöÑÈùûÂ∏∏Â§ßÔºåÊØïÁ´ü‰∏äËø∞ 3 ‰∏™Êù°‰ª∂Ôºå‰ªª‰∏ÄÊù°‰ª∂ÂÖàËß¶ÂèëÈÉΩ‰ºöÊääÁºìÂÜ≤Âå∫ÁöÑÂÜÖÂÆπÂà∑Êñ∞Âà∞Á£ÅÁõòÔºåÊâÄ‰ª•ÁºìÂÜ≤Âå∫ÁöÑÊï∞ÊçÆËÇØÂÆö‰∏ç‰ºöÂ§™Â§öÔºåÂá∫ÂÖ•‰Ω†ÁöÑÊï∞ÊçÆ‰∏≠ÊúâÂæàÂ§öÁõ∏ÂΩìÂ§ßÁöÑ BLOB ËÆ∞ÂΩï„ÄÇÈÄöÂ∏∏Êù•ËØ¥ÔºåÈÖçÁΩÆ 1M~8M Âç≥ÂèØ„ÄÇ Êó¢ÁÑ∂Â≠òÂú®ÁºìÂÜ≤Âå∫ÔºåÊÄéÊ†∑Âà∑Êñ∞Êó•ÂøóÁºìÂÜ≤Â∞±ÊòØÊàë‰ª¨ÈúÄË¶ÅÂÖ≥Ê≥®ÁöÑÈóÆÈ¢ò„ÄÇÊó•ÂøóÁºìÂÜ≤ÂøÖÈ°ªÂà∑Êñ∞Âà∞Á£ÅÁõòÔºå‰ª•Á°Æ‰øùÊèê‰∫§ÁöÑ‰∫ãÂä°ÂÆåÂÖ®Ë¢´ÊåÅ‰πÖÂåñ„ÄÇÂ¶ÇÊûúÂíåÊåÅ‰πÖÂåñÁõ∏ÊØîÔºåÊõ¥Âú®‰πéÊÄßËÉΩÔºåÂèØ‰ª•‰øÆÊîπ innodb-flush-log-at-trx-commit ÂèòÈáèÊù•ÊéßÂà∂Êó•ÂøóÁºìÂÜ≤Âà∑Êñ∞ÁöÑÈ¢ëÁéá„ÄÇ 0ÔºöÊØè 1 ÁßíÈíüÂ∞ÜÊó•ÂøóÁºìÂÜ≤ÂÜôÂà∞Êó•ÂøóÊñá‰ª∂Âπ∂Âà∑Êñ∞Âà∞Á£ÅÁõòÔºå‰∫ãÂä°Êèê‰∫§Êó∂‰∏çÂÅö‰ªª‰ΩïÂ§ÑÁêÜ 1ÔºöÊØèÊ¨°‰∫ãÂä°Êèê‰∫§Êó∂ÔºåÂ∞ÜÊó•ÂøóÁºìÂÜ≤ÂÜôÂà∞Êó•ÂøóÊñá‰ª∂Âπ∂Âà∑Êñ∞Âà∞Á£ÅÁõò 2ÔºöÊØèÊ¨°‰∫ãÂä°Êèê‰∫§Êó∂ÔºåÂ∞ÜÊó•ÂøóÁºìÂÜ≤ÂÜôÂà∞Êó•ÂøóÊñá‰ª∂ÔºåÁÑ∂ÂêéÊØèÁßíÂà∑Êñ∞‰∏ÄÊ¨°Âà∞Á£ÅÁõò 1 ÊòØÊúÄÂÆâÂÖ®ÁöÑËÆæÁΩÆÔºå‰øùËØÅ‰∏ç‰ºö‰∏¢Â§±‰ªª‰ΩïÂ∑≤ÁªèÊèê‰∫§ÁöÑ‰∫ãÂä°ÔºåËøô‰πüÊòØÈªòËÆ§ÁöÑËÆæÁΩÆ„ÄÇ 0 Âíå 2 ÊúÄ‰∏ªË¶ÅÁöÑÂå∫Âà´ÊòØÔºåÂ¶ÇÊûú MySQL ÊåÇ‰∫ÜÔºå2 ‰∏ç‰ºö‰∏¢Â§±‰∫ãÂä°Ôºå‰ΩÜ 0 ÊúâÂèØËÉΩÔºå 2 Âú®ÊØèÊ¨°‰∫ãÂä°Êèê‰∫§Êó∂ÔºåËá≥Â∞ëÂ∞ÜÊó•ÂøóÁºìÂÜ≤Âà∑Êñ∞Âà∞Êìç‰ΩúÁ≥ªÁªüÁöÑÁºìÂ≠òÔºåËÄå 0 Âàô‰∏ç‰ºö„ÄÇÂ¶ÇÊûúÊï¥‰∏™ÊúçÂä°Âô®ÊåÇ‰∫ÜÊàñËÄÖÊñ≠Áîµ‰∫ÜÔºåÂàôËøòÊòØÂèØËÉΩ‰ºö‰∏¢Â§±‰∏Ä‰∫õ‰∫ãÂä°„ÄÇ innodb-flush-method ÂâçÈù¢ÈÉΩÂú®ËÆ®ËÆ∫‰ΩøÁî®‰ªÄ‰πàÊ†∑ÁöÑÁ≠ñÁï•Âà∑Êñ∞„ÄÅ‰ª•Âèä‰ΩïÊó∂Âà∑Êñ∞Êó•ÂøóÊàñËÄÖÊï∞ÊçÆÔºåÈÇ£ InnoDB ÂÖ∑‰ΩìÊòØÊÄéÊ†∑Âà∑Êñ∞Êï∞ÊçÆÁöÑÔºü‰ΩøÁî®innodb-flush-methodÈÄâÈ°πÂèØ‰ª•ÈÖçÁΩÆ InnoDB Â¶Ç‰ΩïË∑üÊñá‰ª∂Á≥ªÁªüÁõ∏‰∫í‰ΩúÁî®„ÄÇ‰ªéÂêçÂ≠ó‰∏äÁúãÔºå‰ºö‰ª•‰∏∫Âè™ËÉΩÂΩ±Âìç InnoDB ÊÄé‰πàÂÜôÊï∞ÊçÆÔºåÂÆûÈôÖ‰∏äËøòÂΩ±Âìç‰∫Ü InnoDB Windows ÂíåÈùû Windows Êìç‰ΩúÁ≥ªÁªü‰∏ãËøô‰∏™ÈÄâÈ°πÁöÑÂÄºÊòØ‰∫íÊñ•ÁöÑÔºå‰πüÂ∞±ÊòØËØ¥Êúâ‰∫õÂÄºÂè™ËÉΩ Windows ‰∏ã‰ΩøÁî®ÔºåÊúâ‰∫õÂè™ËÉΩÂú®Èùû Windows ‰∏ã‰ΩøÁî®ÔºåÂÖ∂‰∏≠ Windows ‰∏ãÂèØÂèñÂÄºÔºöasync_unbuffered„ÄÅunbuffered„ÄÅnormal„ÄÅNosync‰∏élittlesyncÔºåÈùû Windows ÂèñÂÄºÔºöfdatasync„ÄÅ0_DIRECT„ÄÅ 0_DSYNC„ÄÇ Ëøô‰∏™ÈÄâÈ°πÊó¢‰ºöÂΩ±ÂìçÊó•ÂøóÊñá‰ª∂Ôºå‰πü‰ºöÂΩ±ÂìçÊï∞ÊçÆÊñá‰ª∂ÔºåËÄå‰∏îÊúâÊó∂ÂÄôÂØπ‰∏çÂêåÁ±ªÂûãÁöÑÊñá‰ª∂ÁöÑÂ§ÑÁêÜ‰πü‰∏ç‰∏ÄÊ†∑ÔºåÂØºËá¥Ëøô‰∏™ÈÄâÈ°πÊúâ‰∫õÈöæ‰ª•ÁêÜËß£„ÄÇÂ¶ÇÊûúÊúâ‰∏Ä‰∏™ÈÄâÈ°πÊù•ÈÖçÁΩÆÊó•ÂøóÊñá‰ª∂Ôºå‰∏Ä‰∏™ÈÄâÈ°πÊù•ÈÖçÁΩÆÊï∞ÊçÆÊñá‰ª∂ÔºåÂ∫îËØ•‰ºöÊõ¥Â•ΩÔºå‰ΩÜÂÆûÈôÖ‰∏äÂÆÉ‰ª¨Ê∑∑ÂêàÂú®Âêå‰∏Ä‰∏™ÈÖçÁΩÆÈ°π‰∏≠„ÄÇËøôÈáåÂè™‰ªãÁªçÁ±ª Unix Êìç‰ΩúÁ≥ªÁªü‰∏ãÁöÑÈÄâÈ°π„ÄÇ fdatasync InnoDB Ë∞ÉÁî®fsync()Âíåfdatasync()ÂáΩÊï∞Êù•Âà∑Êñ∞Êï∞ÊçÆÂíåÊó•ÂøóÊñá‰ª∂ÔºåÂÖ∂‰∏≠fdatasync()Âè™Âà∑Êñá‰ª∂ÁöÑÊï∞ÊçÆÔºå‰ΩÜ‰∏çÂåÖÂê´ÂÖÉÊï∞ÊçÆ (ÊØîÂ¶ÇÔºöËÆøÈóÆÊùÉÈôê„ÄÅÊñá‰ª∂Êã•ÊúâËÄÖ„ÄÅÊúÄÂêé‰øÆÊîπÊó∂Èó¥Á≠âÊèèËø∞Êñá‰ª∂ÁâπÂæÅÁöÑÁ≥ªÁªüÊï∞ÊçÆ)ÔºåÂõ†Ê≠§fsync()Áõ∏ÊØîfdatasync()‰ºö‰∫ßÁîüÊõ¥Â§öÁöÑ I/OÔºå‰ΩÜÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãfdatasync()‰ºöÂØºËá¥Êï∞ÊçÆÊçüÂùèÔºåÂõ†Ê≠§ InnoDB ÂºÄÂèëËÄÖÂÜ≥ÂÆöÁî®fsync()Êù•‰ª£Êõøfdatasync()„ÄÇ fsync()ÁöÑÁº∫ÁÇπÊòØÊìç‰ΩúÁ≥ªÁªü‰ºöÂú®Ëá™Â∑±ÁöÑÁºìÂ≠ò‰∏≠ÁºìÂÜ≤‰∏Ä‰∫õÊï∞ÊçÆÔºåÁêÜËÆ∫‰∏äÂèåÈáçÁºìÂÜ≤ÊòØÊµ™Ë¥πÁöÑÔºåÂõ†‰∏∫ InnoDB Ëá™Â∑±‰ºöÁÆ°ÁêÜÁºìÂÜ≤ÔºåËÄå‰∏îÊØîÊìç‰ΩúÁ≥ªÁªüÊõ¥Âä†Êô∫ËÉΩ„ÄÇ‰ΩÜÂ¶ÇÊûúÊñá‰ª∂Á≥ªÁªüËÉΩÊúâÊõ¥Êô∫ËÉΩÁöÑ I/O Ë∞ÉÂ∫¶ÂíåÊâπÈáèÊìç‰ΩúÔºåÂèåÈáçÁºìÂÜ≤‰πüÂπ∂‰∏ç‰∏ÄÂÆöÊòØÂùè‰∫ãÔºö ÊúâÁöÑÊñá‰ª∂Á≥ªÁªüÂíå os ÂèØ‰ª•Á¥ØÁßØÂÜôÊìç‰ΩúÂêéÂêàÂπ∂ÊâßË°åÔºåÈÄöËøáÂØπ I/O ÁöÑÈáçÊéíÂ∫èÊù•ÊèêÂçáÊïàÁéá„ÄÅÊàñËÄÖÂπ∂ÂèëÂÜôÂÖ•Â§ö‰∏™ËÆæÂ§á ÊúâÁöÑËøòÂèØ‰ª•ÂÅöÈ¢ÑËØª‰ºòÂåñÔºåÊØîÂ¶ÇËøûÁª≠ËØ∑Ê±ÇÂá†‰∏™È°∫Â∫èÁöÑÂùóÔºåÂÆÉ‰ºöÈÄöÁü•Á°¨ÁõòÈ¢ÑËØª‰∏ã‰∏Ä‰∏™Âùó Ëøô‰∫õ‰ºòÂåñÂú®ÁâπÂÆöÁöÑÂú∫ÊôØ‰∏ãÊâç‰ºöËµ∑‰ΩúÁî®Ôºåfdatasync‰∏∫innodb-flush-methodÁöÑÈªòËÆ§ÂÄº„ÄÇ 0_DIRCET Ëøô‰∏™ËÆæÁΩÆ‰∏çÂΩ±ÂìçÊó•ÂøóÊñá‰ª∂Âπ∂‰∏î‰∏çÊòØÊâÄÊúâÁöÑÁ±ª Unix Á≥ªÁªüÈÉΩÊúâÊïàÔºå‰ΩÜËá≥Â∞ëÂú® Linux„ÄÅFreeBSD ‰ª•Âèä Solaris ÊòØÊîØÊåÅÁöÑ„ÄÇËøô‰∏™ËÆæÁΩÆ‰æùÁÑ∂‰ΩøÁî® fsync Êù•Âà∑Êñ∞Êñá‰ª∂Âà∞Á£ÅÁõòÔºå‰ΩÜÊòØÂÆÉÂÆåÂÖ®ÂÖ≥Èó≠‰∫ÜÊìç‰ΩúÁ≥ªÁªüÁºìÂ≠òÔºåÂπ∂‰∏îÊòØÊâÄÊúâÁöÑËØªÂíåÂÜôÈÉΩÁõ¥Êé•ÈÄöËøáÂ≠òÂÇ®ËÆæÁΩÆÔºåÈÅøÂÖç‰∫ÜÂèåÈáçÁºìÂÜ≤„ÄÇÂ¶ÇÊûúÂ≠òÂÇ®ËÆæÂ§áÊîØÊåÅÂÜôÁºìÂÜ≤ÊàñÈ¢ÑËØªÔºåÈÇ£‰πàËøô‰∏™ÈÄâÈ°πÂπ∂‰∏ç‰ºöÂΩ±ÂìçÂà∞ËÆæÂ§áÁöÑËÆæÁΩÆÔºåÊØîÂ¶Ç RAID Âç°„ÄÇ 0_DSYNC Ëøô‰∏™ÈÄâÈ°π‰ΩøÂæóÊâÄÊúâÁöÑÂÜôÂêåÊ≠•ÔºåÂç≥Âè™ÊúâÊï∞ÊçÆÂÜôÂà∞Á£ÅÁõòÂêéÂÜôÊìç‰ΩúÊâçËøîÂõûÔºå‰ΩÜÂÆÉÂè™ÂΩ±ÂìçÊó•ÂøóÊñá‰ª∂ÔºåËÄå‰∏çÂΩ±ÂìçÊï∞ÊçÆÊñá‰ª∂„ÄÇ ËØ¥ÂÆå‰∫ÜÊØè‰∏™ÈÖçÁΩÆÁöÑ‰ΩúÁî®ÔºåÊúÄÂêéÊòØ‰∏Ä‰∫õÂª∫ËÆÆÔºöÂ¶ÇÊûú‰ΩøÁî®Á±ª Unix Êìç‰ΩúÁ≥ªÁªüÂπ∂‰∏î RAID ÊéßÂà∂Âô®Â∏¶ÊúâÁîµÊ±†‰øùÊä§ÁöÑÂÜôÁºìÂ≠òÔºåÂª∫ËÆÆ‰ΩøÁî® 0_DIRECTÔºåÂ¶ÇÊûú‰∏çÊòØÔºåÈªòËÆ§ÂÄºÊàñËÄÖ 0_DIRECT ÈÉΩÂèØËÉΩÊòØÊúÄÂ•ΩÁöÑÈÄâÊã©„ÄÇ innodb-file-per-table ÊúÄÂêé‰∏Ä‰∏™ÈÖçÁΩÆÔºåËØ¥ËØ¥ InnoDB Ë°®Á©∫Èó¥ÔºåInnoDB ÊääÊï∞ÊçÆ‰øùÂ≠òÂú®Ë°®Á©∫Èó¥ÂÜÖÔºåÂÆÉÊú¨Ë¥®‰∏äÊòØ‰∏Ä‰∏™Áî±‰∏Ä‰∏™ÊàñËÄÖÂ§ö‰∏™Á£ÅÁõòÊñá‰ª∂ÁªÑÊàêÁöÑËôöÊãüÊñá‰ª∂Á≥ªÁªü„ÄÇInnoDB Ë°®Á©∫Èó¥Âπ∂‰∏çÂè™ÊòØÂ≠òÂÇ®Ë°®ÂíåÁ¥¢ÂºïÔºåÂÆÉËøò‰øùÂ≠ò‰∫ÜÂõûÊªöÊó•Âøó„ÄÅÊèíÂÖ•ÁºìÂÜ≤„ÄÅÂèåÂÜôÁºìÂÜ≤‰ª•ÂèäÂÖ∂‰ªñÂÜÖÈÉ®Êï∞ÊçÆÁªìÊûÑÔºåÈô§Ê≠§‰πãÂ§ñÔºåË°®Á©∫Èó¥ËøòÂÆûÁé∞‰∫ÜÂæàÂ§öÂÖ∂ÂÆÉÁöÑÂäüËÉΩ„ÄÇÂèØ‰ª•ÈÄöËøá innodb-data-file-path ÈÖçÁΩÆÈ°πÂÆöÂà∂Ë°®Á©∫Èó¥Êñá‰ª∂Ôºåinnodb-data-home-dirÈÖçÁΩÆË°®Á©∫Èó¥Êñá‰ª∂Â≠òÊîæÁöÑ‰ΩçÁΩÆÔºåÊØîÂ¶ÇÔºö12innodb-data-home-dir = /var/lib/mysqlinnodb-data-file-path = ibdata1:1G;ibdata2:1G;ibdata3:1G ËøôÈáåÂú® 3 ‰∏™Êñá‰ª∂‰∏≠ÂàõÂª∫‰∫Ü 3G Ë°®Á©∫Èó¥Ôºå‰∏∫‰∫ÜÂÖÅËÆ∏Ë°®Á©∫Èó¥Âú®Ë∂ÖËøá‰∫ÜÂàÜÈÖçÁöÑÁ©∫Èó¥Êó∂ËøòËÉΩÂ¢ûÈïøÔºåÂèØ‰ª•ÂÉèËøôÊ†∑ÈÖçÁΩÆÊúÄÂêé‰∏Ä‰∏™Êñá‰ª∂Ëá™Âä®Êâ©Â±ï1innodb-data-file-path = ibdata1:1G;ibdata2:1G;ibdata3:1G:autoextend innodb-file-per-tableÈÄâÈ°πËÆ© InnoDB ‰∏∫ÊØèÂº†Ë°®‰ΩøÁî®‰∏Ä‰∏™Êñá‰ª∂ÔºåËøô‰ΩøÂæóÂú®Âà†Èô§‰∏ÄÂº†Ë°®Êó∂ÂõûÊî∂Á©∫Èó¥ÂÆπÊòìÂæàÂ§öÔºåËÄå‰∏îÁâπÂà´ÂÆπÊòìÁÆ°ÁêÜÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøáÊü•ÁúãÊñá‰ª∂Â§ßÂ∞èÊù•Á°ÆÂÆöË°®Â§ßÂ∞èÔºåÊâÄ‰ª•ËøôÈáåÂª∫ËÆÆÊâìÂºÄËøô‰∏™ÈÖçÁΩÆ„ÄÇ ÊÄªÁªìMySQL ÊúâÂ§™Â§öÁöÑÈÖçÁΩÆÈ°πÔºåËøôÈáåÊ≤°ÊúâÂäûÊ≥ï‰∏Ä‰∏ÄÂàó‰∏æÔºåÈáçË¶ÅÁöÑÊòØ‰∫ÜËß£ÊØè‰∏™ÈÖçÁΩÆÁöÑÂ∑•‰ΩúÂéüÁêÜÔºå‰ªé‰∏Ä‰∏™Âü∫Á°ÄÈÖçÁΩÆÊñá‰ª∂ÂºÄÂßãÔºåËÆæÁΩÆÁ¨¶ÂêàÊúçÂä°Âô®ËΩØÁ°¨‰ª∂ÁéØÂ¢É‰∏éÂ∑•‰ΩúË¥üËΩΩÁöÑÂü∫Êú¨ÈÄâÈ°π„ÄÇ ÂèÇËÄÉËµÑÊñôÈ´òÊÄßËÉΩ MySQL(Á¨¨ 3 Áâà) document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL ‰ºòÂåñÂéüÁêÜ(‰∫å)]]></title>
    <url>%2F2019%2F03%2F29%2Fmysql-optimization-principle-2%2F</url>
    <content type="text"><![CDATA[ÊàëÊâì‰Ω†Â∫îËØ•Ôºå‰∏çÊâì‰Ω†ÊÇ≤ÂìÄ~ ÂâçË®ÄÂ¶ÇÊûúÊúâÂêåÂ≠¶ÁúãÂÆå‰∏ä‰∏ÄÁØáÂÖ≥‰∫é MySQL ÊñáÁ´†ÔºåÊñáÊú´ÁïôÊúâ‰∏§‰∏™ÂæàÂºÄÊîæÁöÑÈóÆÈ¢òÔºåÂ¶ÇÊúâÂÖ¥Ë∂£ÂèØ‰ª•Âú®ËÑëË¢ãÈáåÊÉ≥ÊÉ≥„ÄÇÊú¨Êñá‰πü‰ºöËØïÁùÄÂõûÁ≠îËøô‰∏§‰∏™ÈóÆÈ¢òÔºåÂ∏åÊúõËÉΩÁªô‰Ω†‰∏Ä‰∫õÂèÇËÄÉ„ÄÇÁé∞Âú®ÂèØ‰ª•ÊÄùËÄÉ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ¶ÇÊûúÊï∞ÊçÆÈáèÈùûÂ∏∏Â§ßÁöÑÊÉÖÂÜµ‰∏ãÔºåÊÇ®Ê†πÊçÆ‰∏öÂä°ÈÄâÊã©‰∫ÜÂêàÈÄÇÁöÑÂ≠óÊÆµÔºåÁ≤æÂøÉËÆæËÆ°‰∫ÜË°®ÂíåÁ¥¢ÂºïÔºåËøò‰ªîÁªÜÁöÑÊ£ÄÊü•‰∫ÜÊâÄÊúâÁöÑ SQLÔºåÂπ∂Á°ÆËÆ§Â∑≤ÁªèÊ≤°‰ªÄ‰πàÈóÆÈ¢òÔºå‰ΩÜÊÄßËÉΩ‰ªçÁÑ∂‰∏çËÉΩÊª°Ë∂≥ÊÇ®ÁöÑË¶ÅÊ±ÇÔºåËØ•ÊÄé‰πàÂäûÂë¢ÔºüËøòÊúâÂÖ∂‰ªñ‰ºòÂåñÁ≠ñÁï•ÂêóÔºüÁ≠îÊ°àÊòØËÇØÂÆöÁöÑ„ÄÇÊé•‰∏ãÊù•ÁªßÁª≠ÂíåÊÇ®ËÆ®ËÆ∫‰∏Ä‰∫õÂ∏∏Áî®ÁöÑ MySQL È´òÁ∫ßÁâπÊÄß‰ª•ÂèäÂÖ∂ËÉåÂêéÁöÑÂ∑•‰ΩúÂéüÁêÜ„ÄÇ ÂàÜÂå∫Ë°®ÂêàÁêÜÁöÑ‰ΩøÁî®Á¥¢ÂºïÂèØ‰ª•ÊûÅÂ§ßÊèêÂçá MySQL ÁöÑÊü•ËØ¢ÊÄßËÉΩÔºå‰ΩÜÂ¶ÇÊûúÂçïË°®Êï∞ÊçÆÈáèËææÂà∞‰∏ÄÂÆöÁöÑÁ®ãÂ∫¶ÔºåÁ¥¢ÂºïÂ∞±Êó†Ê≥ïËµ∑‰ΩúÁî®ÔºåÂõ†‰∏∫Âú®Êï∞ÊçÆÈáèË∂ÖÂ§ßÁöÑÊÉÖÂÜµ‰∏ãÔºåÈô§ÈùûË¶ÜÁõñÁ¥¢ÂºïÔºåÂõ†ÂõûË°®Êü•ËØ¢‰ºö‰∫ßÁîüÂ§ßÈáèÁöÑÈöèÊú∫ I/OÔºåÊï∞ÊçÆÂ∫ìÁöÑÂìçÂ∫îÊó∂Èó¥ÂèØËÉΩ‰ºöËææÂà∞‰∏çÂèØÊé•ÂèóÁöÑÁ®ãÂ∫¶„ÄÇËÄå‰∏îÁ¥¢ÂºïÁª¥Êä§ÔºàÁ£ÅÁõòÁ©∫Èó¥„ÄÅI/O Êìç‰ΩúÔºâÁöÑ‰ª£‰ª∑‰πü‰ºöÈùûÂ∏∏Â§ß„ÄÇ Âõ†Ê≠§ÔºåÂΩìÂçïË°®Êï∞ÊçÆÈáèËææÂà∞‰∏ÄÂÆöÁ®ãÂ∫¶Êó∂ÔºàÂú® MySQL4.x Êó∂‰ª£ÔºåMyISAM Â≠òÂÇ®ÂºïÊìé‰∏öÂÜÖÂÖ¨ËÆ§ÁöÑÊÄßËÉΩÊãêÁÇπÊòØ 500W Ë°åÔºåMySQL5.x Êó∂‰ª£ÁöÑÊÄßËÉΩÊãêÁÇπÂàô‰∏∫ 1KW ~ 2KW Ë°åÁ∫ßÂà´ÔºåÂÖ∑‰ΩìÈúÄÊ†πÊçÆÂÆûÈôÖÊÉÖÂÜµÊµãËØïÔºâÔºå‰∏∫‰∫ÜÊèêÂçáÊÄßËÉΩÔºåÊúÄ‰∏∫Â∏∏Áî®ÁöÑÊñπÊ≥ïÂ∞±ÊòØÂàÜË°®„ÄÇÂàÜË°®ÁöÑÁ≠ñÁï•ÂèØ‰ª•ÊòØÂûÇÁõ¥ÊãÜÂàÜÔºàÊØîÂ¶ÇÔºö‰∏çÂêåËÆ¢ÂçïÁä∂ÊÄÅÁöÑËÆ¢ÂçïÊãÜÂàÜÂà∞‰∏çÂêåÁöÑË°®ÔºâÔºå‰πüÂèØ‰ª•ÊòØÊ∞¥Âπ≥ÊãÜÂàÜÔºàÊØîÂ¶ÇÔºöÊåâÊúàÂ∞ÜËÆ¢ÂçïÊãÜÂàÜÂà∞‰∏çÂêåË°®Ôºâ„ÄÇ‰ΩÜÊÄªÁöÑÊù•ËØ¥ÔºåÂàÜË°®ÂèØ‰ª•Áúã‰ΩúÊòØ‰ªé‰∏öÂä°ËßíÂ∫¶Êù•Ëß£ÂÜ≥Â§ßÊï∞ÊçÆÈáèÈóÆÈ¢òÔºåÂÆÉÂú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÂèØ‰ª•ÊèêÂçáÊÄßËÉΩÔºå‰ΩÜ‰πüÂ§ßÂ§ßÊèêÂçá‰∫ÜÁºñÁ†ÅÁöÑÂ§çÊùÇÂ∫¶ÔºåÊúâËøáËøôÁßçÁªèÂéÜÁöÑÂêåÂ≠¶ÂèØËÉΩÊ∑±Êúâ‰Ωì‰ºö„ÄÇ Âú®‰∏öÂä°Â±ÇÂàÜË°®Â§ßÂ§ßÂ¢ûÂä†‰∫ÜÁºñÁ†ÅÁöÑÂ§çÊùÇÁ®ãÂ∫¶ÔºåËÄå‰∏îÂ§ÑÁêÜÊï∞ÊçÆÂ∫ìÁöÑÁõ∏ÂÖ≥‰ª£Á†Å‰ºöÂ§ßÈáèÊï£ËêΩÂú®Â∫îÁî®ÂêÑÂ§ÑÔºåÁª¥Êä§Âõ∞Èöæ„ÄÇÈÇ£ÊòØÂê¶ÂèØ‰ª•Â∞ÜÂàÜË°®ÁöÑÈÄªËæëÊäΩË±°Âá∫Êù•ÔºåÁªü‰∏ÄÂ§ÑÁêÜÔºåËøôÊ†∑‰∏öÂä°Â±ÇÂ∞±‰∏çÁî®ÂÖ≥ÂøÉÂ∫ïÂ±ÇÊòØÂê¶ÂàÜË°®ÔºåÂè™ÈúÄË¶Å‰∏ìÊ≥®Âú®‰∏öÂä°Âç≥ÂèØ„ÄÇÁ≠îÊ°àÂΩìÁÑ∂ÊòØËÇØÂÆöÁöÑÔºåÁõÆÂâçÊúâÈùûÂ∏∏Â§öÁöÑÊï∞ÊçÆÂ∫ì‰∏≠Èó¥‰ª∂ÈÉΩÂèØ‰ª•Â±èËîΩÂàÜË°®ÂêéÁöÑÁªÜËäÇÔºåËÆ©‰∏öÂä°Â±ÇÂÉèÊü•ËØ¢ÂçïË°®‰∏ÄÊ†∑Êü•ËØ¢ÂàÜË°®ÂêéÁöÑÊï∞ÊçÆ„ÄÇÂ¶ÇÊûúÂÜçÂ∞ÜÊäΩË±°ÁöÑÈÄªËæë‰∏ãÁßªÂà∞Êï∞ÊçÆÂ∫ìÁöÑÊúçÂä°Â±ÇÔºåÂ∞±ÊòØÊàë‰ª¨‰ªäÂ§©Ë¶ÅËÆ≤ÁöÑÂàÜÂå∫Ë°®„ÄÇ ÂàÜÂå∫ÂèØ‰ª•Áúã‰ΩúÊòØ‰ªéÊäÄÊúØÂ±ÇÈù¢Ëß£ÂÜ≥Â§ßÊï∞ÊçÆÈóÆÈ¢òÁöÑÊúâÊïàÊñπÊ≥ïÔºåÁÆÄÂçïÁöÑÁêÜËß£ÔºåÂèØ‰ª•ËÆ§‰∏∫ÊòØ MySQL Â∫ïÂ±ÇÂ∏ÆÊàë‰ª¨ÂÆûÁé∞ÂàÜË°®ÔºåÂàÜÂå∫Ë°®ÊòØ‰∏Ä‰∏™Áã¨Á´ãÁöÑÈÄªËæëË°®ÔºåÂ∫ïÂ±ÇÁî±Â§ö‰∏™Áâ©ÁêÜÂ≠êË°®ÁªÑÊàê„ÄÇÂ≠òÂÇ®ÂºïÊìéÁÆ°ÁêÜÂàÜÂå∫ÁöÑÂêÑ‰∏™Â∫ïÂ±ÇË°®ÂíåÁÆ°ÁêÜÊôÆÈÄöË°®‰∏ÄÊ†∑ÔºàÊâÄÊúâÂ∫ïÂ±ÇË°®ÂøÖÈ°ª‰ΩøÁî®Áõ∏ÂêåÁöÑÂ≠òÂÇ®ÂºïÊìéÔºâÔºåÂàÜÂå∫Ë°®ÁöÑÁ¥¢Âºï‰πüÊòØÂú®ÂêÑ‰∏™Â∫ïÂ±ÇË°®‰∏äÂêÑËá™Âä†‰∏ä‰∏Ä‰∏™ÂÆåÂÖ®Áõ∏ÂêåÁöÑÁ¥¢Âºï„ÄÇ‰ªéÂ≠òÂÇ®ÂºïÊìéÁöÑËßíÂ∫¶Êù•ÁúãÔºåÂ∫ïÂ±ÇË°®ÂíåÊôÆÈÄöË°®Ê≤°Êúâ‰ªª‰Ωï‰∏çÂêåÔºåÂ≠òÂÇ®ÂºïÊìé‰πüÊó†È°ªÁü•ÈÅì„ÄÇÂú®ÊâßË°åÊü•ËØ¢Êó∂Ôºå‰ºòÂåñÂô®‰ºöÊ†πÊçÆÂàÜÂå∫ÁöÑÂÆö‰πâËøáÊª§ÈÇ£‰∫õÊ≤°ÊúâÊàë‰ª¨ÈúÄË¶ÅÊï∞ÊçÆÁöÑÂàÜÂå∫ÔºåËøôÊ†∑Êü•ËØ¢Â∞±Êó†ÈúÄÊâ´ÊèèÊâÄÊúâÂàÜÂå∫ÔºåÂè™ÈúÄË¶ÅÊü•ÊâæÂåÖÂê´ÈúÄË¶ÅÊï∞ÊçÆÁöÑÂàÜÂå∫Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ Êõ¥Â•ΩÁöÑÁêÜËß£ÂàÜÂå∫Ë°®ÔºåÊàë‰ª¨‰ªé‰∏Ä‰∏™Á§∫‰æãÂÖ•ÊâãÔºö‰∏ÄÂº†ËÆ¢ÂçïË°®ÔºåÊï∞ÊçÆÈáèÂ§ßÊ¶ÇÊúâ 10TBÔºåÂ¶Ç‰ΩïËÆæËÆ°ÊâçËÉΩ‰ΩøÊÄßËÉΩËææÂà∞ÊúÄ‰ºòÔºü È¶ñÂÖàÂèØ‰ª•ËÇØÂÆöÁöÑÊòØÔºåÂõ†‰∏∫Êï∞ÊçÆÈáèÂ∑®Â§ßÔºåËÇØÂÆö‰∏çËÉΩËµ∞ÂÖ®Ë°®Êâ´Êèè„ÄÇ‰ΩøÁî®Á¥¢ÂºïÁöÑËØùÔºå‰Ω†‰ºöÂèëÁé∞Êï∞ÊçÆÂπ∂‰∏çÊòØÊåâÁÖßÊÉ≥Ë¶ÅÁöÑÊñπÂºèËÅöÈõÜÔºåËÄå‰∏î‰ºö‰∫ßÁîüÂ§ßÈáèÁöÑÁ¢éÁâáÔºåÊúÄÁªà‰ºöÂØºËá¥‰∏Ä‰∏™Êü•ËØ¢‰∫ßÁîüÊàêÂçÉ‰∏ä‰∏áÁöÑÈöèÊú∫ I/OÔºåÂ∫îÁî®Èöè‰πãÂÉµÊ≠ª„ÄÇÊâÄ‰ª•ÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∫õÊõ¥Á≤óÁ≤íÂ∫¶Âπ∂‰∏îÊ∂àËÄóÊõ¥Â∞ëÁöÑÊñπÂºèÊù•Ê£ÄÁ¥¢Êï∞ÊçÆ„ÄÇÊØîÂ¶ÇÂÖàÊ†πÊçÆÁ¥¢ÂºïÊâæÂà∞‰∏ÄÂ§ßÂùóÊï∞ÊçÆÔºåÁÑ∂ÂêéÂÜçÂú®ËøôÂùóÊï∞ÊçÆ‰∏äÈ°∫Â∫èÊâ´Êèè„ÄÇ ËøôÊ≠£ÊòØÂàÜÂå∫Ë¶ÅÂÅöÁöÑ‰∫ãÊÉÖÔºåÁêÜËß£ÂàÜÂå∫Êó∂ËøòÂèØ‰ª•Â∞ÜÂÖ∂ÂΩì‰ΩúÁ¥¢ÂºïÁöÑÊúÄÂàùÂΩ¢ÊÄÅÔºå‰ª•‰ª£‰ª∑ÈùûÂ∏∏Â∞èÁöÑÊñπÂºèÂÆö‰ΩçÂà∞ÈúÄË¶ÅÁöÑÊï∞ÊçÆÂú®Âì™‰∏ÄÁâá ‚ÄúÂå∫Âüü‚ÄùÔºåÂú®ËøôÁâá ‚ÄúÂå∫Âüü‚Äù ‰∏≠Ôºå‰Ω†ÂèØ‰ª•È°∫Â∫èÊâ´ÊèèÔºåÂèØ‰ª•Âª∫Á¥¢ÂºïÔºåËøòÂèØ‰ª•Â∞ÜÊï∞ÊçÆÈÉΩÁºìÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇÂõ†‰∏∫ÂàÜÂå∫Êó†È°ªÈ¢ùÂ§ñÁöÑÊï∞ÊçÆÁªìÊûÑËÆ∞ÂΩïÊØè‰∏™ÂàÜÂå∫ÊúâÂì™‰∫õÊï∞ÊçÆÔºåÊâÄ‰ª•ÂÖ∂‰ª£‰ª∑ÈùûÂ∏∏‰Ωé„ÄÇÂè™ÈúÄË¶Å‰∏Ä‰∏™ÁÆÄÂçïÁöÑË°®ËææÂºèÂ∞±ÂèØ‰ª•Ë°®ËææÊØè‰∏™ÂàÜÂå∫Â≠òÊîæÁöÑÊòØ‰ªÄ‰πàÊï∞ÊçÆ„ÄÇ ÂØπË°®ÂàÜÂå∫ÔºåÂèØ‰ª•Âú®ÂàõÂª∫Ë°®Êó∂Ôºå‰ΩøÁî®Â¶Ç‰∏ãËØ≠Âè•Ôºö12345678910CREATE TABLE sales { order_date DATETIME NOT NULL -- other columns} ENGINE=InnoDB PARTITION BY RANGE(YEAR(order_date)) ( PARTITION p_2014 VALUES LESS THAN (2014), PARTITION p_2015 VALUES LESS THAN (2015) PARTITION p_2016 VALUES LESS THAN (2016) PARTITION p_2017 VALUES LESS THAN (2017) PARTITION p_catchall VALUES LESS THAN MAXVALUE) ÂàÜÂå∫Â≠êÂè•‰∏≠ÂèØ‰ª•‰ΩøÁî®ÂêÑÁßçÂáΩÊï∞Ôºå‰ΩÜË°®ËææÂºèÁöÑËøîÂõûÂÄºÂøÖÈ°ªÊòØ‰∏Ä‰∏™Á°ÆÂÆöÁöÑÊï¥Êï∞Ôºå‰∏î‰∏çËÉΩÊòØ‰∏Ä‰∏™Â∏∏Êï∞„ÄÇMySQL ËøòÊîØÊåÅ‰∏Ä‰∫õÂÖ∂‰ªñÂàÜÂå∫ÔºåÊØîÂ¶ÇÈîÆÂÄº„ÄÅÂìàÂ∏å„ÄÅÂàóË°®ÂàÜÂå∫Ôºå‰ΩÜÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠ÂæàÂ∞ëËßÅÂà∞„ÄÇÂú® MySQL5.5 ‰ª•ÂêéÂèØ‰ª•‰ΩøÁî® RANGE COLUMNS Á±ªÂûãÂàÜÂå∫ÔºåËøôÊ†∑Âç≥‰ΩøÊòØÂü∫‰∫éÊó∂Èó¥ÂàÜÂå∫Ôºå‰πüÊó†ÈúÄÂÜçÂ∞ÜÂÖ∂ËΩ¨ÂåñÊàê‰∏Ä‰∏™Êï¥Êï∞„ÄÇ Êé•‰∏ãÊù•ÁÆÄÂçïÁúã‰∏ãÂàÜÂå∫Ë°®‰∏äÁöÑÂêÑÁßçÊìç‰ΩúÈÄªËæëÔºö SELECTÔºöÂΩìÊü•ËØ¢‰∏Ä‰∏™ÂàÜÂå∫Ë°®Êó∂ÔºåÂàÜÂå∫Â±ÇÂÖàÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÁöÑÂ∫ïÂ±ÇË°®Ôºå‰ºòÂåñÂô®ÂÖàÂà§Êñ≠ÊòØÂê¶ÂèØ‰ª•ËøáÊª§ÈÉ®ÂàÜÂàÜÂå∫ÔºåÁÑ∂ÂêéÂú®Ë∞ÉÁî®ÂØπÂ∫îÁöÑÂ≠òÂÇ®ÂºïÊìéÊé•Âè£ËÆøÈóÆÂêÑ‰∏™ÂàÜÂå∫ÁöÑÊï∞ÊçÆ INSERTÔºöÂΩìÊèíÂÖ•‰∏ÄÊù°ËÆ∞ÂΩïÊó∂ÔºåÂàÜÂå∫Â±ÇÂÖàÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÁöÑÂ∫ïÂ±ÇË°®ÔºåÁÑ∂ÂêéÁ°ÆÂÆöÂì™‰∏™ÂàÜÂå∫Êé•Êî∂ËøôÊù°ËÆ∞ÂΩïÔºåÂÜçÂ∞ÜËÆ∞ÂΩïÂÜôÂÖ•ÂØπÂ∫îÁöÑÂ∫ïÂ±ÇË°®ÔºåDELETEÊìç‰Ωú‰∏éÂÖ∂Á±ª‰ºº UPDATEÔºöÂΩìÊõ¥Êñ∞‰∏ÄÊù°Êï∞ÊçÆÊó∂ÔºåÂàÜÂå∫Â±ÇÂÖàÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÁöÑÂ∫ïÂ±ÇË°®ÔºåÁÑ∂ÂêéÁ°ÆÂÆöÊï∞ÊçÆÂØπÂ∫îÁöÑÂàÜÂå∫ÔºåÁÑ∂ÂêéÂèñÂá∫Êï∞ÊçÆÂπ∂Êõ¥Êñ∞ÔºåÂÜçÂà§Êñ≠Êõ¥Êñ∞ÂêéÁöÑÊï∞ÊçÆÂ∫îËØ•Â≠òÊîæÂà∞Âì™‰∏™ÂàÜÂå∫ÔºåÊúÄÂêéÂØπÂ∫ïÂ±ÇË°®ËøõË°åÂÜôÂÖ•Êìç‰ΩúÔºåÂπ∂ÂØπÂéüÊï∞ÊçÆÊâÄÂú®ÁöÑÂ∫ïÂ±ÇË°®ËøõË°åÂà†Èô§Êìç‰Ωú Êúâ‰∫õÊìç‰ΩúÊòØÊîØÊåÅÊù°‰ª∂ËøáÊª§ÁöÑ„ÄÇ‰æãÂ¶ÇÔºåÂΩìÂà†Èô§‰∏ÄÊù°ËÆ∞ÂΩïÊó∂ÔºåMySQL ÈúÄË¶ÅÂÖàÊâæÂà∞ËøôÊù°ËÆ∞ÂΩïÔºåÂ¶ÇÊûúWHEREÊù°‰ª∂ÊÅ∞Â•ΩÂíåÂàÜÂå∫Ë°®ËææÂºèÂåπÈÖçÔºåÂ∞±ÂèØ‰ª•Â∞ÜÊâÄÊúâ‰∏çÂåÖÂê´ËøôÊù°ËÆ∞ÂΩïÁöÑÂàÜÂå∫ÈÉΩËøáÊª§ÊéâÔºåËøôÂØπUPDATEËØ≠Âè•ÂêåÊ†∑ÊúâÊïà„ÄÇÂ¶ÇÊûúÊòØINSERTÊìç‰ΩúÔºåÊú¨Ë∫´Â∞±Âè™ÂëΩ‰∏≠‰∏Ä‰∏™ÂàÜÂå∫ÔºåÂÖ∂‰ªñÂàÜÂå∫ÈÉΩ‰ºöË¢´ËøáÊª§„ÄÇ ËôΩÁÑ∂ÊØè‰∏™Êìç‰ΩúÈÉΩ‰ºö ‚ÄúÂÖàÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÁöÑÂ∫ïÂ±ÇË°®‚ÄùÔºå‰ΩÜËøôÂπ∂‰∏çÊòØËØ¥ÂàÜÂå∫Ë°®Âú®Â§ÑÁêÜËøáÁ®ã‰∏≠ÊòØÈîÅ‰ΩèÂÖ®Ë°®ÁöÑ„ÄÇÂ¶ÇÊûúÂ≠òÂÇ®ÂºïÊìéËÉΩÂ§üËá™Â∑±ÂÆûÁé∞Ë°åÁ∫ßÈîÅÔºå‰æãÂ¶Ç InnoDBÔºåÂàô‰ºöÂú®ÂàÜÂå∫Â±ÇÈáäÊîæÂØπÂ∫îË°®ÈîÅ„ÄÇËøô‰∏™Âä†ÈîÅÂíåËß£ÈîÅÁöÑÊìç‰ΩúËøáÁ®ã‰∏éÊôÆÈÄö InnoDB ‰∏äÁöÑÊü•ËØ¢Á±ª‰ºº„ÄÇ Âú®‰ΩøÁî®ÂàÜÂå∫Ë°®Êó∂Ôºå‰∏∫‰∫Ü‰øùËØÅÂ§ßÊï∞ÊçÆÈáèÁöÑÂèØÊâ©Â±ïÊÄßÔºå‰∏ÄËà¨Êúâ‰∏§‰∏™Á≠ñÁï•Ôºö ÂÖ®ÈáèÊâ´ÊèèÊï∞ÊçÆÔºå‰∏çÁî®Á¥¢Âºï„ÄÇÂç≥Âè™Ë¶ÅËÉΩÂ§üÊ†πÊçÆ WHERE Êù°‰ª∂Â∞ÜÈúÄË¶ÅÊü•ËØ¢ÁöÑÊï∞ÊçÆÈôêÂà∂Âú®Â∞ëÊï∞ÂàÜÂå∫‰∏≠ÔºåÊïàÁéáÊòØ‰∏çÈîôÁöÑ Á¥¢ÂºïÊï∞ÊçÆÔºåÂàÜÁ¶ªÁÉ≠ÁÇπ„ÄÇÂ¶ÇÊûúÊï∞ÊçÆÊúâÊòéÊòæÁöÑ ‚ÄúÁÉ≠ÁÇπ‚ÄùÔºåËÄå‰∏îÈô§‰∫ÜËøôÈÉ®ÂàÜÊï∞ÊçÆÔºåÂÖ∂‰ªñÊï∞ÊçÆÂæàÂ∞ëË¢´ËÆøÈóÆÂà∞ÔºåÈÇ£‰πàÂèØ‰ª•Â∞ÜËøôÈÉ®ÂàÜÁÉ≠ÁÇπÊï∞ÊçÆÂçïÁã¨Â≠òÊîæÂú®‰∏Ä‰∏™ÂàÜÂå∫‰∏≠ÔºåËÆ©Ëøô‰∏™ÂàÜÂå∫ÁöÑÊï∞ÊçÆËÉΩÂ§üÊúâÊú∫‰ºöÈÉΩÁºìÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇËøôÊ†∑Êü•ËØ¢Â∞±ÂèØ‰ª•Âè™ËÆøÈóÆ‰∏Ä‰∏™ÂæàÂ∞èÁöÑÂàÜÂå∫Ë°®ÔºåËÉΩÂ§ü‰ΩøÁî®Á¥¢ÂºïÔºå‰πüËÉΩÂ§üÊúâÊïàÁöÑÂà©Áî®ÁºìÂ≠ò„ÄÇ ÂàÜÂå∫Ë°®ÁöÑ‰ºòÁÇπÊòØ‰ºòÂåñÂô®ÂèØ‰ª•Ê†πÊçÆÂàÜÂå∫ÂáΩÊï∞Êù•ËøáÊª§‰∏Ä‰∫õÂàÜÂå∫Ôºå‰ΩÜÂæàÈáçË¶ÅÁöÑ‰∏ÄÁÇπÊòØË¶ÅÂú®WHEREÊù°‰ª∂‰∏≠Â∏¶ÂÖ•ÂàÜÂå∫ÂàóÔºåÊúâÊó∂ÂÄôÂç≥‰ΩøÁúã‰ººÂ§ö‰ΩôÁöÑ‰πüË¶ÅÂ∏¶‰∏äÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ËÆ©‰ºòÂåñÂô®ËÉΩÂ§üËøáÊª§ÊéâÊó†È°ªËÆøÈóÆÁöÑÂàÜÂå∫ÔºåÂ¶ÇÊûúÊ≤°ÊúâËøô‰∫õÊù°‰ª∂ÔºåMySQL Â∞±ÈúÄË¶ÅËÆ©ÂØπÂ∫îÁöÑÂ≠òÂÇ®ÂºïÊìéËÆøÈóÆËøô‰∏™Ë°®ÁöÑÊâÄÊúâÂàÜÂå∫ÔºåÂ¶ÇÊûúË°®ÈùûÂ∏∏Â§ßÁöÑËØùÔºåÂ∞±ÂèØËÉΩ‰ºöÈùûÂ∏∏ÊÖ¢„ÄÇ ‰∏äÈù¢‰∏§‰∏™ÂàÜÂå∫Á≠ñÁï•Âü∫‰∫é‰∏§‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÂâçÊèêÔºöÊü•ËØ¢ÈÉΩËÉΩÂ§üËøáÊª§ÊéâÂæàÂ§öÈ¢ùÂ§ñÁöÑÂàÜÂå∫ÔºåÂàÜÂå∫Êú¨Ë∫´Âπ∂‰∏ç‰ºöÂ∏¶Êù•ÂæàÂ§öÈ¢ùÂ§ñÁöÑ‰ª£‰ª∑„ÄÇËÄåËøô‰∏§‰∏™ÂâçÊèêÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãÊòØÊúâÈóÆÈ¢òÁöÑÔºåÊØîÂ¶ÇÔºö 1„ÄÅNULL ÂÄº‰ºö‰ΩøÂàÜÂå∫ËøáÊª§Êó†Êïà ÂÅáËÆæÊåâÁÖßPARTITION BY RANGE YEAR(order_date)ÂàÜÂå∫ÔºåÈÇ£‰πàÊâÄÊúâorder_date‰∏∫ NULL ÊàñËÄÖÈùûÊ≥ïÂÄºÊó∂ÔºåËÆ∞ÂΩïÈÉΩ‰ºöË¢´Â≠òÊîæÂà∞Á¨¨‰∏Ä‰∏™ÂàÜÂå∫„ÄÇÊâÄ‰ª•WHERE order_date BETWEEN '2017-05-01' AND '2017-05-31'ÔºåËøô‰∏™Êü•ËØ¢‰ºöÊ£ÄÊü•‰∏§‰∏™ÂàÜÂå∫ÔºåËÄå‰∏çÊòØÊàë‰ª¨ËÆ§‰∏∫ÁöÑ 2017 Âπ¥Ëøô‰∏™ÂàÜÂå∫Ôºà‰ºöÈ¢ùÂ§ñÁöÑÊ£ÄÊü•Á¨¨‰∏Ä‰∏™ÂàÜÂå∫ÔºâÔºåÊòØÂõ†‰∏∫YEAR()Âú®Êé•Êî∂ÈùûÊ≥ïÂÄºÊó∂‰ºöËøîÂõû NULL„ÄÇÂ¶ÇÊûúÁ¨¨‰∏Ä‰∏™ÂàÜÂå∫ÁöÑÊï∞ÊçÆÈáèÈùûÂ∏∏Â§ßÔºåËÄå‰∏î‰ΩøÁî®ÂÖ®Ë°®Êâ´ÊèèÁöÑÁ≠ñÁï•Êó∂Ôºå‰ª£‰ª∑‰ºöÈùûÂ∏∏Â§ß„ÄÇ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨ÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™Êó†Áî®ÁöÑÂàÜÂå∫ÔºåÊØîÂ¶ÇÔºöPARTITION p_null values less than (0)„ÄÇÂ¶ÇÊûúÊèíÂÖ•ÁöÑÊï∞ÊçÆÈÉΩÊòØÊúâÊïàÁöÑËØùÔºåÁ¨¨‰∏Ä‰∏™ÂàÜÂå∫Â∞±ÊòØÁ©∫ÁöÑ„ÄÇ Âú® MySQL5.5 ‰ª•ÂêéÂ∞±‰∏çÈúÄË¶ÅËøô‰∏™ÊäÄÂ∑ß‰∫ÜÔºåÂõ†‰∏∫ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÂàóÊú¨Ë∫´ËÄå‰∏çÊòØÂü∫‰∫éÂàóÁöÑÂáΩÊï∞ËøõË°åÂàÜÂå∫ÔºöPARTITION BY RANGE COLUMNS(order_date)„ÄÇÁõ¥Êé•‰ΩøÁî®Ëøô‰∏™ËØ≠Ê≥ïÂèØÈÅøÂÖçËøô‰∏™ÈóÆÈ¢ò„ÄÇ 2„ÄÅÂàÜÂå∫ÂàóÂíåÁ¥¢ÂºïÂàó‰∏çÂåπÈÖç ÂΩìÂàÜÂå∫ÂàóÂíåÁ¥¢ÂºïÂàó‰∏çÂåπÈÖçÊó∂ÔºåÂèØËÉΩ‰ºöÂØºËá¥Êü•ËØ¢Êó†Ê≥ïËøõË°åÂàÜÂå∫ËøáÊª§ÔºåÈô§ÈùûÊØè‰∏™Êü•ËØ¢Êù°‰ª∂‰∏≠ÈÉΩÂåÖÂê´ÂàÜÂå∫Âàó„ÄÇÂÅáËÆæÂú®Âàó a ‰∏äÂÆö‰πâ‰∫ÜÁ¥¢ÂºïÔºåËÄåÂú®Âàó b ‰∏äËøõË°åÂàÜÂå∫„ÄÇÂõ†‰∏∫ÊØè‰∏™ÂàÜÂå∫ÈÉΩÊúâÂÖ∂Áã¨Á´ãÁöÑÁ¥¢ÂºïÔºåÊâÄ‰ª•Âú®Êâ´ÊèèÂàó b ‰∏äÁöÑÁ¥¢ÂºïÂ∞±ÈúÄË¶ÅÊâ´ÊèèÊØè‰∏Ä‰∏™ÂàÜÂå∫ÂÜÖÂØπÂ∫îÁöÑÁ¥¢ÂºïÔºåÂΩìÁÑ∂ËøôÁßçÈÄüÂ∫¶‰∏ç‰ºöÂ§™ÊÖ¢Ôºå‰ΩÜÊòØËÉΩÂ§üË∑≥Ëøá‰∏çÂåπÈÖçÁöÑÂàÜÂå∫ËÇØÂÆö‰ºöÊõ¥Â•Ω„ÄÇËøô‰∏™ÈóÆÈ¢òÁúãËµ∑Êù•ÂæàÂÆπÊòìÈÅøÂÖçÔºå‰ΩÜÈúÄË¶ÅÊ≥®ÊÑè‰∏ÄÁßçÊÉÖÂÜµÂ∞±ÊòØÔºåÂÖ≥ËÅîÊü•ËØ¢„ÄÇÂ¶ÇÊûúÂàÜÂå∫Ë°®ÊòØÂÖ≥ËÅîÈ°∫Â∫èÁöÑÁ¨¨ 2 Âº†Ë°®ÔºåÂπ∂‰∏îÂÖ≥ËÅî‰ΩøÁî®ÁöÑÁ¥¢Âºï‰∏éÂàÜÂå∫Êù°‰ª∂Âπ∂‰∏çÂåπÈÖçÔºåÈÇ£‰πàÂÖ≥ËÅîÊó∂ÂØπÁ¨¨‰∏ÄÂº†Ë°®‰∏≠Á¨¶ÂêàÊù°‰ª∂ÁöÑÊØè‰∏ÄË°åÈÉΩÈúÄË¶ÅËÆøÈóÆÂπ∂ÊêúÁ¥¢Á¨¨‰∫åÂº†Ë°®ÁöÑÊâÄÊúâÂàÜÂå∫ÔºàÂÖ≥ËÅîÊü•ËØ¢ÂéüÁêÜÔºåËØ∑ÂèÇËÄÉÂâç‰∏ÄÁØáÊñáÁ´†Ôºâ 3„ÄÅÈÄâÊã©ÂàÜÂå∫ÁöÑÊàêÊú¨ÂèØËÉΩÂæàÈ´ò ÂàÜÂå∫ÊúâÂæàÂ§öÁßçÁ±ªÂûãÔºå‰∏çÂêåÁ±ªÂûãÁöÑÂàÜÂå∫ÂÆûÁé∞ÊñπÂºè‰πü‰∏çÂêåÔºåÊâÄ‰ª•ÂÆÉ‰ª¨ÁöÑÊÄßËÉΩ‰πü‰∏çÂ∞ΩÁõ∏ÂêåÔºåÂ∞§ÂÖ∂ÊòØËåÉÂõ¥ÂàÜÂå∫ÔºåÂú®Á°ÆËÆ§Ëøô‰∏ÄË°åÂ±û‰∫éÂì™‰∏™ÂàÜÂå∫Êó∂‰ºöÊâ´ÊèèÊâÄÊúâÁöÑÂàÜÂå∫ÂÆö‰πâÔºåËøôÊ†∑ÁöÑÁ∫øÊÄßÊâ´ÊèèÊïàÁéáÂπ∂‰∏çÈ´òÔºåÊâÄ‰ª•ÈöèÁùÄÂàÜÂå∫Êï∞ÁöÑÂ¢ûÈïøÔºåÊàêÊú¨‰ºöË∂äÊù•Ë∂äÈ´ò„ÄÇÁâπÂà´ÊòØÂú®ÊâπÈáèÊèíÂÖ•Êï∞ÊçÆÊó∂ÔºåÁî±‰∫éÊØèÊù°ËÆ∞ÂΩïÂú®ÊèíÂÖ•ÂâçÔºåÈÉΩÈúÄË¶ÅÁ°ÆËÆ§ÂÖ∂Â±û‰∫éÂì™‰∏Ä‰∏™ÂàÜÂå∫ÔºåÂ¶ÇÊûúÂàÜÂå∫Êï∞Â§™Â§ßÔºå‰ºöÈÄ†ÊàêÊèíÂÖ•ÊÄßËÉΩÁöÑÊÄ•Ââß‰∏ãÈôç„ÄÇÂõ†Ê≠§ÊúâÂøÖË¶ÅÈôêÂà∂ÂàÜÂå∫Êï∞ÈáèÔºå‰ΩÜ‰πü‰∏çÁî®Â§™ËøáÊãÖÂøÉÔºåÂØπ‰∫éÂ§ßÂ§öÊï∞Á≥ªÁªüÔºå100 ‰∏™Â∑¶Âè≥ÁöÑÂàÜÂå∫ÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑ„ÄÇ 4„ÄÅÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÂ∫ïÂ±ÇË°®ÁöÑÊàêÊú¨Âú®Êüê‰∫õÊó∂ÂÄô‰ºöÂæàÈ´ò ÂâçÈù¢ËØ¥ËøáÔºåÊâìÂºÄÂπ∂ÈîÅ‰ΩèÊâÄÊúâÂ∫ïÂ±ÇË°®Âπ∂‰∏ç‰ºöÂØπÊÄßËÉΩÊúâÂ§™Â§ßÁöÑÂΩ±ÂìçÔºå‰ΩÜÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÊØîÂ¶ÇÂè™ÈúÄË¶ÅÊü•ËØ¢‰∏ªÈîÆÔºåÈÇ£‰πàÈîÅ‰ΩèÁöÑÊàêÊú¨Áõ∏ÂØπ‰∫é‰∏ªÈîÆÁöÑÊü•ËØ¢Êù•ËØ¥ÔºåÊàêÊú¨Â∞±Áï•È´ò„ÄÇ 5„ÄÅÁª¥Êä§ÂàÜÂå∫ÁöÑÊàêÊú¨ÂèØËÉΩ‰ºöÂæàÈ´ò Êñ∞Â¢ûÂíåÂà†Èô§ÂàÜÂå∫ÁöÑÈÄüÂ∫¶ÈÉΩÂæàÂø´Ôºå‰ΩÜÊòØ‰øÆÊîπÂàÜÂå∫‰ºöÈÄ†ÊàêÊï∞ÊçÆÁöÑÂ§çÂà∂ÔºåËøô‰∏éALTER TABLEÁöÑÂéüÁêÜÁ±ª‰ººÔºåÈúÄË¶ÅÂÖàÂàõÂª∫‰∏Ä‰∏™ÂéÜÂè≤ÂàÜÂå∫ÔºåÁÑ∂ÂêéÂ∞ÜÊï∞ÊçÆÂ§çÂà∂Âà∞ÂÖ∂‰∏≠ÔºåÊúÄÂêéÂà†Èô§ÂéüÂàÜÂå∫„ÄÇÂõ†Ê≠§ÔºåËÆæËÆ°Êï∞ÊçÆÂ∫ìÊó∂ÔºåËÄÉËôë‰∏öÂä°ÁöÑÂ¢ûÈïøÈúÄË¶ÅÔºåÂêàÁêÜÁöÑÂàõÂª∫ÂàÜÂå∫Ë°®ÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â•ΩÁöÑ‰π†ÊÉØ„ÄÇÂú® MySQL5.6 ‰ª•ÂêéÁöÑÁâàÊú¨ÂèØ‰ª•‰ΩøÁî®ALTER TABLE EXCHAGE PARTITIONËØ≠Âè•Êù•‰øÆÊîπÂàÜÂå∫ÔºåÂÖ∂ÊÄßËÉΩ‰ºöÊúâÂæàÂ§ßÊèêÂçá„ÄÇ ÂàÜÂå∫Ë°®ËøòÊúâ‰∏Ä‰∫õÂÖ∂‰ªñÈôêÂà∂ÔºåÊØîÂ¶ÇÊâÄÊúâÁöÑÂ∫ïÂ±ÇË°®ÂøÖÈ°ª‰ΩøÁî®Áõ∏ÂêåÁöÑÂ≠òÂÇ®ÂºïÊìéÔºåÊüê‰∫õÂ≠òÂÇ®ÂºïÊìé‰πü‰∏çÊîØÊåÅÂàÜÂå∫„ÄÇÂàÜÂå∫‰∏ÄËà¨Â∫îÁî®‰∫é‰∏ÄÂè∞ÊúçÂä°Âô®‰∏äÔºå‰ΩÜ‰∏ÄÂè∞ÊúçÂä°Âô®ÁöÑÁâ©ÁêÜËµÑÊ∫êÊÄªÊòØÊúâÈôêÁöÑÔºåÂΩìÊï∞ÊçÆËææÂà∞Ëøô‰∏™ÊûÅÈôêÊó∂ÔºåÂç≥‰ΩøÂàÜÂå∫ÔºåÊÄßËÉΩ‰πüÂèØËÉΩ‰ºöÂæà‰ΩéÔºåÊâÄ‰ª•Ëøô‰∏™Êó∂ÂÄôÂàÜÂ∫ìÊòØÂøÖÈ°ªÁöÑ„ÄÇ‰ΩÜ‰∏çÁÆ°ÊòØÂàÜÂå∫„ÄÅÂàÜÂ∫ìËøòÊòØÂàÜË°®ÔºåÂÆÉ‰ª¨ÁöÑÊÄùÊÉ≥ÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂ§ßÂÆ∂ÂèØ‰ª•Â•ΩÂ•Ω‰Ωì‰ºö‰∏ã„ÄÇ ËßÜÂõæÂØπ‰∫é‰∏Ä‰∫õÂÖ≥ËÅîË°®ÁöÑÂ§çÊùÇÊü•ËØ¢Ôºå‰ΩøÁî®ËßÜÂõæÊúâÊó∂ÂÄô‰ºöÂ§ßÂ§ßÁÆÄÂåñÈóÆÈ¢òÔºåÂõ†Ê≠§Âú®ËÆ∏Â§öÂú∫Âêà‰∏ãÈÉΩÂèØ‰ª•ÁúãÂà∞ËßÜÂõæÁöÑË∫´ÂΩ±Ôºå‰ΩÜËßÜÂõæÁúüÂ¶ÇÊàë‰ª¨ÊâÄÊÉ≥ÈÇ£Ê†∑ÁÆÄÂçïÂêóÔºüÂÆÉÂíåÁõ¥Êé•‰ΩøÁî®JOINÁöÑ SQL ËØ≠Âè•Êúâ‰ΩïÂå∫Âà´ÔºüËßÜÂõæËÉåÂêéÁöÑÂéüÁêÜÂèà‰∫ÜËß£Â§öÂ∞ëÔºü ËßÜÂõæÊú¨Ë∫´ÊòØ‰∏Ä‰∏™ËôöÊãüË°®Ôºå‰∏çÂ≠òÊîæ‰ªª‰ΩïÊï∞ÊçÆÔºåÊü•ËØ¢ËßÜÂõæÁöÑÊï∞ÊçÆÈõÜÁî±ÂÖ∂‰ªñË°®ÁîüÊàê„ÄÇMySQL Â∫ïÂ±ÇÈÄöËøá‰∏§ÁßçÁÆóÊ≥ïÊù•ÂÆûÁé∞ËßÜÂõæÔºö‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÔºàTEMPTABLEÔºâÂíåÂêàÂπ∂ÁÆóÊ≥ïÔºàMERGEÔºâ„ÄÇÊâÄË∞ì‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÂ∞±ÊòØÂ∞Ü SELECT ËØ≠Âè•ÁöÑÁªìÊûúÂ≠òÊîæÂà∞‰∏¥Êó∂Ë°®‰∏≠ÔºåÂΩìÈúÄË¶ÅËÆøÈóÆËßÜÂõæÁöÑÊó∂ÂÄôÔºåÁõ¥Êé•ËÆøÈóÆËøô‰∏™‰∏¥Êó∂Ë°®Âç≥ÂèØ„ÄÇËÄåÂêàÂπ∂ÁÆóÊ≥ïÂàôÊòØÈáçÂÜôÂåÖÂê´ËßÜÂõæÁöÑÊü•ËØ¢ÔºåÂ∞ÜËßÜÂõæÂÆö‰πâÁöÑ SQL Áõ¥Êé•ÂåÖÂê´ËøõÊü•ËØ¢ SQL ‰∏≠„ÄÇÈÄöËøá‰∏§‰∏™ÁÆÄÂçïÁöÑÁ§∫‰æãÊù•‰Ωì‰ºö‰∏§‰∏™ÁÆóÊ≥ïÁöÑÂ∑ÆÂºÇÔºåÂàõÂª∫Â¶Ç‰∏ãËßÜÂõæÔºö1234-- ËßÜÂõæÁöÑ‰ΩúÁî®ÊòØÊü•ËØ¢Êú™ÊîØ‰ªòËÆ¢ÂçïCREATE VIEW unpay_order ASSELECT * FROM sales WHERE status = 'new'WITH CHECK OPTION; -- ÂÖ∂‰ΩúÁî®‰∏ãÊñá‰ºöËÆ≤ Áé∞Ë¶Å‰ªéÊú™ÊîØ‰ªòËÆ¢Âçï‰∏≠Êü•ËØ¢Ë¥≠‰π∞ËÄÖ‰∏∫cscÁöÑËÆ¢ÂçïÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÊü•ËØ¢Ôºö12-- Êü•ËØ¢Ë¥≠‰π∞ËÄÖ‰∏∫csc‰∏îÊú™ÊîØ‰ªòÁöÑËÆ¢ÂçïSELECT order_id,order_amount,buyer FROM unpay_order WHERE buyer = 'csc'; ‰ΩøÁî®‰∏¥Êó∂Ë°®Êù•Ê®°ÊãüËßÜÂõæÔºö12CREATE TEMPORARY TABLE tmp_order_unpay AS SELECT * FROM sales WHERE status = 'new';SELECT order_id,order_amount,buyer FROM tmp_order_unpay WHERE buyer = 'csc'; ‰ΩøÁî®ÂêàÂπ∂ÁÆóÊ≥ïÂ∞ÜËßÜÂõæÂÆö‰πâÁöÑ SQL ÂêàÂπ∂ËøõÊü•ËØ¢ SQL ÂêéÁöÑÊ†∑Â≠êÔºö1SELECT order_id,order_amount,buyer FROM sales WHERE status = 'new' AND buyer = 'csc'; MySQL ÂèØ‰ª•ÂµåÂ•óÂÆö‰πâËßÜÂõæÔºåÂç≥Âú®‰∏Ä‰∏™ËßÜÂõæ‰∏äÂú®ÂÆö‰πâÂè¶‰∏Ä‰∏™ËßÜÂõæÔºåÂèØ‰ª•Âú®EXPLAIN EXTENDED‰πãÂêé‰ΩøÁî®SHOW WARNINGSÊù•Êü•Áúã‰ΩøÁî®ËßÜÂõæÁöÑÊü•ËØ¢ÈáçÂÜôÂêéÁöÑÁªìÊûú„ÄÇÂ¶ÇÊûúÈááÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÂÆûÁé∞ÁöÑËßÜÂõæÔºåEXPLAIN‰∏≠‰ºöÊòæÁ§∫‰∏∫Ê¥æÁîüË°®ÔºàDERIVEDÔºâÔºåÊ≥®ÊÑèEXPLAINÊó∂ÈúÄË¶ÅÂÆûÈôÖÊâßË°åÂπ∂‰∫ßÁîü‰∏¥Êó∂Ë°®ÔºåÊâÄ‰ª•ÊúâÂèØËÉΩ‰ºöÂæàÊÖ¢„ÄÇ ÊòéÊòæÂú∞Ôºå‰∏¥Êó∂Ë°®‰∏äÊ≤°Êúâ‰ªª‰ΩïÁ¥¢ÂºïÔºåËÄå‰∏î‰ºòÂåñÂô®‰πüÂæàÈöæ‰ºòÂåñ‰∏¥Êó∂Ë°®‰∏äÁöÑÊü•ËØ¢ÔºåÂõ†Ê≠§ÔºåÂ¶ÇÊúâÂèØËÉΩÔºåÂ∞ΩÈáè‰ΩøÁî®ÂêàÂπ∂ÁÆóÊ≥ï‰ºöÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩ„ÄÇÈÇ£‰πàÈóÆÈ¢òÊù•‰∫ÜÔºöÂêàÂπ∂ÁÆóÊ≥ïÔºàÁ±ª‰ºº‰∫éÁõ¥Êé•Êü•ËØ¢ÔºâÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩÔºå‰∏∫‰ªÄ‰πàËøòË¶Å‰ΩøÁî®ËßÜÂõæÔºü È¶ñÂÖàËßÜÂõæÂèØ‰ª•ÁÆÄÂåñÂ∫îÁî®‰∏äÂ±ÇÁöÑÊìç‰ΩúÔºåËÆ©Â∫îÁî®Êõ¥‰∏ìÊ≥®‰∫éÂÖ∂ÊâÄÂÖ≥ÂøÉÁöÑÊï∞ÊçÆ„ÄÇÂÖ∂Ê¨°ÔºåËßÜÂõæËÉΩÂ§üÂØπÊïèÊÑüÊï∞ÊçÆÊèê‰æõÂÆâÂÖ®‰øùÊä§ÔºåÊØîÂ¶ÇÔºöÂØπ‰∏çÂêåÁöÑÁî®Êà∑ÂÆö‰πâ‰∏çÂêåÁöÑËßÜÂõæÔºåÂèØ‰ª•‰ΩøÊïèÊÑüÊï∞ÊçÆ‰∏çÂá∫Áé∞Âú®‰∏çÂ∫îËØ•ÁúãÂà∞Ëøô‰∫õÊï∞ÊçÆÁöÑÁî®Êà∑ËßÜÂõæ‰∏äÔºõ‰πüÂèØ‰ª•‰ΩøÁî®ËßÜÂõæÂÆûÁé∞Âü∫‰∫éÂàóÁöÑÊùÉÈôêÊéßÂà∂ÔºåËÄå‰∏çÈúÄË¶ÅÁúüÊ≠£ÁöÑÂú®Êï∞ÊçÆÂ∫ì‰∏≠ÂàõÂª∫ÂàóÊùÉÈôê„ÄÇÂÜçËÄÖÔºåËßÜÂõæÂèØ‰ª•Êñπ‰æøÁ≥ªÁªüËøêÁª¥ÔºåÊØîÂ¶ÇÔºöÂú®ÈáçÊûÑ schema ÁöÑÊó∂ÂÄô‰ΩøÁî®ËßÜÂõæÔºå‰ΩøÂæóÂú®‰øÆÊîπËßÜÂõæÂ∫ïÂ±ÇË°®ÁªìÊûÑÁöÑÊó∂ÂÄôÔºåÂ∫îÁî®‰ª£Á†ÅËøòÂèØ‰ª•ÁªßÁª≠ËøêË°å‰∏çÊä•Èîô„ÄÇ Âü∫‰∫éÊ≠§Ôºå‰ΩøÁî®ËßÜÂõæÂÖ∂ÂÆûÊõ¥Â§öÁöÑÊòØÂü∫‰∫é‰∏öÂä°ÊàñËÄÖÁª¥Êä§ÊàêÊú¨‰∏äÁöÑËÄÉËôëÔºåÂÖ∂Êú¨Ë∫´Âπ∂‰∏ç‰ºöÂØπÊÄßËÉΩÊèêÂçáÊúâÂ§öÂ§ß‰ΩúÁî®ÔºàÊ≥®ÊÑèÔºöÊ≠§Â§ÑÂè™ÊòØÂü∫‰∫é MySQL ËÄÉËôëÔºåÂÖ∂‰ªñÂÖ≥Á≥ªÊÄßÊï∞ÊçÆÂ∫ì‰∏≠ËßÜÂõæÂèØËÉΩ‰ºöÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩÔºåÊØîÂ¶ÇORACLEÂíåMS SQL SERVERÈÉΩÊîØÊåÅÁâ©ÂåñËßÜÂõæÔºåÂÆÉ‰ª¨ÈÉΩÊØî MySQL ËßÜÂõæÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩÔºâ„ÄÇËÄå‰∏î‰ΩøÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÂÆûÁé∞ÁöÑËßÜÂõæÔºåÂú®Êüê‰∫õÊó∂ÂÄôÊÄßËÉΩÂèØËÉΩ‰ºöÈùûÂ∏∏Á≥üÁ≥ïÔºåÊØîÂ¶ÇÔºö123-- ËßÜÂõæÁöÑ‰ΩúÁî®ÊòØÁªüËÆ°ÊØèÊó•ÊîØÂá∫ÈáëÈ¢ùÔºåDATE('2017-06-15 12:00:23') = 2017-06-15CREATE VIEW cost_per_day ASSELECT DATE(create_time) AS date,SUM(cost) AS cost FROM costs GROUP BY date; Áé∞Ë¶ÅÁªüËÆ°ÊØèÊó•ÁöÑÊî∂ÂÖ•‰∏éÊîØÂá∫ÔºåÊúâÁ±ª‰ºº‰∫é‰∏äÈù¢ÁöÑÊî∂ÂÖ•Ë°®ÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ã SQLÔºö1234SELECT c.date,c.cost,s.amountFROM cost_per_day AS cJOIN sale_per_day AS s USING(date)WHERE date BETWEEN '2017-06-01' AND '2017-06-30' Ëøô‰∏™Êü•ËØ¢‰∏≠ÔºåMySQL ÂÖàÊâßË°åËßÜÂõæÁöÑ SQLÔºåÁîüÊàê‰∏¥Êó∂Ë°®ÔºåÁÑ∂ÂêéÂÜçÂ∞Üsale_per_dayË°®Âíå‰∏¥Êó∂Ë°®ËøõË°åÂÖ≥ËÅî„ÄÇËøôÈáåWHEREÂ≠óÂè•‰∏≠ÁöÑBETWEENÊù°‰ª∂Âπ∂‰∏çËÉΩ‰∏ãÊé®Âà∞ËßÜÂõæ‰∏≠ÔºåÂõ†ËÄåËßÜÂõæÂú®ÂàõÂª∫Êó∂Ôºå‰ºöÂ∞ÜÊâÄÊúâÁöÑÊï∞ÊçÆÊîæÂà∞‰∏¥Êó∂Ë°®‰∏≠ÔºåËÄå‰∏çÊòØ‰∏Ä‰∏™ÊúàÊï∞ÊçÆÔºåÂπ∂‰∏îËøô‰∏™‰∏¥Êó∂Ë°®‰πü‰∏ç‰ºöÊúâÁ¥¢Âºï„ÄÇ ÂΩìÁÑ∂Ëøô‰∏™Á§∫‰æã‰∏≠ÁöÑ‰∏¥Êó∂Ë°®Êï∞ÊçÆ‰∏ç‰ºöÂ§™Â§ßÔºåÊØïÁ´üÊó•ÊúüÁöÑÊï∞Èáè‰∏ç‰ºöÂ§™Â§öÔºå‰ΩÜ‰ªçÁÑ∂Ë¶ÅËÄÉËôëÁîüÊàê‰∏¥Êó∂Ë°®ÁöÑÊÄßËÉΩÔºàÂ¶ÇÊûú costs Ë°®Êï∞ÊçÆËøáÂ§ßÔºåGROUP BYÊúâÂèØËÉΩ‰ºöÊØîËæÉÊÖ¢Ôºâ„ÄÇËÄå‰∏îÊú¨Á§∫‰æã‰∏≠Á¥¢Âºï‰πü‰∏çÊòØÈóÆÈ¢òÔºåÈÄöËøá‰∏ä‰∏ÄÁØáÊàë‰ª¨Áü•ÈÅìÔºåÂ¶ÇÊûú MySQL Â∞Ü‰∏¥Êó∂Ë°®‰Ωú‰∏∫ÂÖ≥ËÅîÈ°∫Â∫è‰∏≠ÁöÑÁ¨¨‰∏ÄÂº†Ë°®Ôºå‰ªçÁÑ∂ÂèØ‰ª•‰ΩøÁî®sale_per_day‰∏≠ÁöÑÁ¥¢Âºï„ÄÇ‰ΩÜÂ¶ÇÊûúÊòØÂØπ‰∏§‰∏™ËßÜÂõæÂÅöÂÖ≥ËÅîÁöÑËØùÔºå‰ºòÂåñÂô®Â∞±Ê≤°Êúâ‰ªª‰ΩïÁ¥¢ÂºïÂèØ‰ª•‰ΩøÁî®ÔºåËøôÊó∂Â∞±ÈúÄË¶Å‰∏•Ê†ºÊµãËØïÂ∫îÁî®ÁöÑÊÄßËÉΩÊòØÂê¶Êª°Ë∂≥ÈúÄÊ±Ç„ÄÇ Êàë‰ª¨ÂæàÂ∞ë‰ºöÂú®ÂÆûÈôÖ‰∏öÂä°Âú∫ÊôØ‰∏≠ÂéªÊõ¥Êñ∞ËßÜÂõæÔºåÂõ†Ê≠§Âç∞Ë±°‰∏≠ÔºåËßÜÂõæÊòØ‰∏çËÉΩÊõ¥Êñ∞ÁöÑ„ÄÇ‰ΩÜÂÆûÈôÖ‰∏äÔºåÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåËßÜÂõæÊòØÂèØ‰ª•Êõ¥Êñ∞ÁöÑ„ÄÇÂèØÊõ¥Êñ∞ËßÜÂõæÊòØÊåáÈÄöËøáÊõ¥Êñ∞Ëøô‰∏™ËßÜÂõæÊù•Êõ¥Êñ∞ËßÜÂõæÊ∂âÂèäÁöÑÁõ∏ÂÖ≥Ë°®ÔºåÂè™Ë¶ÅÊåáÂÆö‰∫ÜÂêàÈÄÇÁöÑÊù°‰ª∂ÔºåÂ∞±ÂèØ‰ª•Êõ¥Êñ∞„ÄÅÂà†Èô§ÁîöËá≥ÊòØÂêëËßÜÂõæ‰∏≠ÊèíÂÖ•Êï∞ÊçÆ„ÄÇÈÄöËøá‰∏äÊñáÁöÑ‰∫ÜËß£Ôºå‰∏çÈöæÊé®Êñ≠Âá∫ÔºöÊõ¥Êñ∞ËßÜÂõæÁöÑÂÆûË¥®Â∞±ÊòØÊõ¥Êñ∞ËßÜÂõæÂÖ≥ËÅîÁöÑË°®ÔºåÂ∞ÜÂàõÂª∫ËßÜÂõæÁöÑWHEREÂ≠êÂè•ËΩ¨Âåñ‰∏∫UPDATEËØ≠Âè•ÁöÑWHEREÂ≠êÂè•ÔºåÂè™Êúâ‰ΩøÁî®ÂêàÂπ∂ÁÆóÊ≥ïÁöÑËßÜÂõæÊâçËÉΩÊõ¥Êñ∞ÔºåÂπ∂‰∏îÊõ¥Êñ∞ÁöÑÂàóÂøÖÈ°ªÊù•Ëá™Âêå‰∏Ä‰∏™Ë°®‰∏≠„ÄÇÂõûÈ°æ‰∏äÊñáÂàõÂª∫ËßÜÂõæÁöÑ SQL ËØ≠Âè•ÔºåÂÖ∂‰∏≠Êúâ‰∏ÄÂè•ÔºöWITH CHECK OPTIONÔºåÂÖ∂‰ΩúÁî®Â∞±ÊòØË°®Á§∫ÈÄöËøáËßÜÂõæÊõ¥Êñ∞ÁöÑË°åÔºåÈÉΩÂøÖÈ°ªÁ¨¶ÂêàËßÜÂõæÊú¨Ë∫´ÁöÑWHEREÊù°‰ª∂ÂÆö‰πâÔºå‰∏çËÉΩÊõ¥Êñ∞ËßÜÂõæÂÆö‰πâÂàó‰ª•Â§ñÁöÑÂàóÔºåÂê¶ÂàôÂ∞±‰ºöÊäõÂá∫check option failedÈîôËØØ„ÄÇ ËßÜÂõæËøòÊúâ‰∏Ä‰∏™ÂÆπÊòìÈÄ†ÊàêËØØËß£ÁöÑÂú∞ÊñπÔºö‚ÄúÂØπ‰∫é‰∏Ä‰∫õÁÆÄÂçïÁöÑÊü•ËØ¢ÔºåËßÜÂõæ‰ºö‰ΩøÁî®ÂêàÂπ∂ÁÆóÊ≥ïÔºåËÄåÂØπ‰∫é‰∏Ä‰∫õÊØîËæÉÂ§çÊùÇÁöÑÊü•ËØ¢ÔºåËßÜÂõæÂ∞±‰ºö‰ΩøÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ï‚Äù„ÄÇ‰ΩÜÂÆûÈôÖ‰∏äÔºåËßÜÂõæÁöÑÂÆûÁé∞ÁÆóÊ≥ïÊòØËßÜÂõæÊú¨Ë∫´ÁöÑÂ±ûÊÄßÂÜ≥ÂÆöÁöÑÔºåË∑ü‰ΩúÁî®Âú®ËßÜÂõæ‰∏äÁöÑ SQL Ê≤°Êúâ‰ªª‰ΩïÂÖ≥Á≥ª„ÄÇÈÇ£‰ªÄ‰πàÊó∂ÂÄôËßÜÂõæÈááÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÔºå‰ªÄ‰πàÊó∂ÂÄôÈááÁî®ÂêàÂπ∂ÁÆóÊ≥ïÂë¢Ôºü‰∏ÄËà¨Êù•ËØ¥ÔºåÂè™Ë¶ÅÂéüË°®ËÆ∞ÂΩïÂíåËßÜÂõæ‰∏≠ÁöÑËÆ∞ÂΩïÊó†Ê≥ïÂª∫Á´ã‰∏Ä‰∏ÄÊò†Â∞ÑÁöÑÂÖ≥Á≥ªÊó∂ÔºåMySQL ÈÉΩÂ∞Ü‰ΩøÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÊù•ÂÆûÁé∞ËßÜÂõæ„ÄÇÊØîÂ¶ÇÂàõÂª∫ËßÜÂõæÁöÑ SQL ‰∏≠ÂåÖÂê´GROUP BY„ÄÅDISTINCT„ÄÅUNION„ÄÅËÅöÂêàÂáΩÊï∞„ÄÅÂ≠êÊü•ËØ¢ÁöÑÊó∂ÂÄôÔºåËßÜÂõæÈÉΩÂ∞ÜÈááÁî®‰∏¥Êó∂Ë°®ÁÆóÊ≥ïÔºàËøô‰∫õËßÑÂàôÂú®‰ª•ÂêéÁöÑÁâàÊú¨‰∏≠ÔºåÂèØËÉΩ‰ºöÂèëÁîüÊîπÂèòÔºåÂÖ∑‰ΩìËØ∑ÂèÇËÄÉÂÆòÊñπÊâãÂÜåÔºâ„ÄÇ Áõ∏ÊØî‰∫éÂÖ∂ÂÆÉÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ìÁöÑËßÜÂõæÔºåMySQL ÁöÑËßÜÂõæÂú®ÂäüËÉΩ‰∏ä‰ºöÂº±ÂæàÂ§öÔºåÊØîÂ¶ÇORACLEÂíåMS SQL SERVERÈÉΩÊîØÊåÅÁâ©ÂåñËßÜÂõæ„ÄÇÁâ©ÂåñËßÜÂõæÊòØÊåáÂ∞ÜËßÜÂõæÁªìÊûúÊï∞ÊçÆÂ≠òÊîæÂú®‰∏Ä‰∏™ÂèØ‰ª•Êü•ËØ¢ÁöÑË°®‰∏≠ÔºåÂπ∂ÂÆöÊúü‰ªéÂéüÂßãË°®‰∏≠Âà∑Êñ∞Êï∞ÊçÆÂà∞ËøôÂº†Ë°®‰∏≠ÔºåËøôÂº†Ë°®ÂíåÊôÆÈÄöÁâ©ÁêÜË°®‰∏ÄÊ†∑ÔºåÂèØ‰ª•ÂàõÂª∫Á¥¢Âºï„ÄÅ‰∏ªÈîÆÁ∫¶ÊùüÁ≠âÁ≠âÔºåÊÄßËÉΩÁõ∏ÊØî‰∫é‰∏¥Êó∂Ë°®‰ºöÊúâË¥®ÁöÑÊèêÂçá„ÄÇ‰ΩÜÈÅóÊÜæÁöÑÊòØ MySQL ÁõÆÂâçÂπ∂‰∏çÊîØÊåÅÁâ©ÂåñËßÜÂõæÔºåÂΩìÁÑ∂ MySQL ‰πü‰∏çÊîØÊåÅÂú®ËßÜÂõæ‰∏≠ÂàõÂª∫Á¥¢Âºï„ÄÇ Â≠òÂÇ®ËøáÁ®ã‰∏éËß¶ÂèëÂô®ÂõûÂà∞Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåÊúâÈùûÂ∏∏Â§öÁöÑ‰∫∫Âú®ÂàÜ‰∫´Êó∂ÈÉΩ‰ºöÊäõÂá∫ËøôÊ†∑‰∏Ä‰∏™ËßÇÁÇπÔºöÂ∞ΩÂèØËÉΩ‰∏çË¶Å‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÔºåÂ≠òÂÇ®ËøáÁ®ãÈùûÂ∏∏‰∏çÂÆπÊòìÁª¥Êä§Ôºå‰πü‰ºöÂ¢ûÂä†‰ΩøÁî®ÊàêÊú¨ÔºåÂ∫îËØ•Êää‰∏öÂä°ÈÄªËæëÊîæÂà∞ÂÆ¢Êà∑Á´Ø„ÄÇÊó¢ÁÑ∂ÂÆ¢Êà∑Á´ØÈÉΩËÉΩÂπ≤Ëøô‰∫õ‰∫ãÔºåÈÇ£‰∏∫‰ªÄ‰πàËøòË¶ÅÂ≠òÂÇ®ËøáÁ®ãÔºü Â¶ÇÊûúÊúâÊ∑±ÂÖ•‰∫ÜËß£ËøáÂ≠òÂÇ®ËøáÁ®ãÔºåÂ∞±‰ºöÂèëÁé∞Â≠òÂÇ®ËøáÁ®ãÂπ∂Ê≤°ÊúâÂ§ßÂÆ∂ÊèèËø∞ÁöÑÈÇ£‰πà‰∏çÂ†™„ÄÇÊàëÊõæÁªèÁªèÂéÜËøá‰∏Ä‰∫õÈáçÂ∫¶‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÁöÑ‰∫ßÂìÅÔºå‰æùËµñÂà∞‰ªÄ‰πàÁ®ãÂ∫¶Âë¢ÔºüÂ∞±Ëøô‰πàËØ¥ÂêßÔºå‰∏äÂ±ÇÁöÑÂ∫îÁî®Âü∫Êú¨‰∏äÂè™Â§ÑÁêÜ‰∫§‰∫í‰∏éÂä®ÊïàÁöÑÈÄªËæëÔºåÊâÄÊúâÁöÑ‰∏öÂä°ÈÄªËæëÔºåÁîöËá≥ÊòØÂèÇÊï∞ÁöÑÊ†°È™åÂùáÂú®Â≠òÂÇ®ËøáÁ®ã‰∏≠ÂÆûÁé∞„ÄÇÊõæÁªèÊúâÂá∫Áé∞Ëøá‰∏Ä‰∏™Ë∂ÖÂ§ßÁöÑÂ≠òÂÇ®ËøáÁ®ãÔºåÂÖ∂Êñá‰ª∂Â§ßÂ∞èËææÂà∞ÊÉä‰∫∫ÁöÑ 80KÔºåÂèØÊÉ≥ËÄåÁü•ÔºåÂÖ∂‰∏öÂä°ÈÄªËæëÊúâÂ§ö‰πàÂ§çÊùÇ„ÄÇÂú®Â§ßÂ§öÊï∞‰∫∫Áúº‰∏≠ÔºåËøôÊ†∑ÁöÑÊäÄÊúØÊû∂ÊûÑÁÆÄÁõ¥ÊúâÁÇπ‰∏çÂèØÁêÜÂñªÔºå‰ΩÜÂÆûÈôÖ‰∏äËøôÊ¨æ‰∫ßÂìÅÈùûÂ∏∏ÊàêÂäü„ÄÇ ÂÖ∂ÊàêÂäüÁöÑÂéüÂõ†Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÂæóÁõä‰∫éÂ≠òÂÇ®ËøáÁ®ãÁöÑ‰ºòÁÇπÔºåÁî±‰∫é‰∏öÂä°Â±Ç‰ª£Á†ÅÊ≤°Êúâ‰ªª‰Ωï‰æµÂÖ•‰∏öÂä°ÁöÑ‰ª£Á†ÅÔºåÂú®‰∏çÊîπÂèòÂâçÁ´ØÂ±ïÁ§∫ÊïàÊûúÁöÑÂêåÊó∂ÔºåÂèØ‰ª•ÈùûÂ∏∏Âø´ÈÄüÁöÑ‰øÆÂ§ç BUG„ÄÅÂºÄÂèëÊñ∞ÂäüËÉΩ„ÄÇÁî±‰∫éËøôÊ¨æ‰∫ßÂìÅÈúÄË¶ÅÈÉ®ÁΩ≤Âú®ÂÆ¢Êà∑ÁöÑÁßÅÊúâÁéØÂ¢É‰∏äÔºåÂø´ÈÄüÂìçÂ∫îÂÆ¢Êà∑ÁöÑÈúÄÊ±ÇÂ∞±ÂèòÂæóÂ∞§‰∏∫ÈáçË¶ÅÔºåÊ≠£ÊòØÂæóÁõä‰∫éËøôÁßçÊû∂ÊûÑÔºåÂèØ‰ª•Âú®ÂÆ¢Êà∑Âá∫Áé∞ÈóÆÈ¢òÊàñËÄÖÊèêÂá∫Êñ∞ÈúÄÊ±ÇÊó∂ÔºåÂø´ÈÄüÂìçÂ∫îÔºåÊûÅÁ´ØÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÂèØ‰ª•Âú® 1 Â∞èÊó∂ÂÜÖ‰øÆÂ§çÂÆ¢Êà∑ÈÅáÂà∞ÁöÑÈóÆÈ¢ò„ÄÇÊ≠£ÊòØËøôÁßçÂø´ÈÄüÂìçÂ∫îÊú∫Âà∂ÔºåËÆ©Êàë‰ª¨Ëé∑ÂæóÂ§ßÈáèÁöÑÂÆ¢Êà∑„ÄÇ ÂΩìÁÑ∂Â≠òÂÇ®ËøáÁ®ãËøòÊúâÂÖ∂‰ªñÁöÑ‰ºòÁÇπÔºåÊØîÂ¶ÇÔºåÂèØ‰ª•ÈùûÂ∏∏Êñπ‰æøÁöÑÂä†ÂØÜÂ≠òÂÇ®ËøáÁ®ã‰ª£Á†ÅÔºåËÄå‰∏çÁî®ÊãÖÂøÉÂ∫îÁî®ÈÉ®ÁΩ≤Âà∞ÁßÅÊúâÁéØÂ¢ÉÈÄ†ÊàêÊ∫ê‰ª£Á†ÅÊ≥ÑÈú≤„ÄÅÂèØ‰ª•ÂÉèË∞ÉËØïÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫è‰∏ÄÊ†∑Ë∞ÉËØïÂ≠òÂÇ®ËøáÁ®ã„ÄÅÂèØ‰ª•ËÆæÂÆöÂ≠òÂÇ®ËøáÁ®ãÁöÑ‰ΩøÁî®ÊùÉÈôêÊù•‰øùËØÅÊï∞ÊçÆÂÆâÂÖ®Á≠âÁ≠â„ÄÇ‰∏ÄÂàáÈÉΩÈùûÂ∏∏ÁæéÂ•ΩÔºå‰ΩÜÊàë‰ª¨ÁöÑ‰∫ßÂìÅÊòØÂü∫‰∫éMS SQL SERVERÂÆûÁé∞ÁöÑÔºåÂÖ∂ÂèØ‰ª•ÈÄöËøáT-SQLÈùûÂ∏∏Êñπ‰æøÁöÑÂÆûÁé∞Â§çÊùÇÁöÑ‰∏öÂä°ÈÄªËæë„ÄÇ‰Ω†ÂèØ‰ª•ÊääT-SQLÁúãÂÅöÊòØ‰∏ÄÈó®ÁºñÁ®ãËØ≠Ë®ÄÔºåÂÖ∂ÂåÖÂê´SQLÁöÑÊâÄÊúâÂäüËÉΩÔºåËøòÂÖ∑Â§áÊµÅÁ®ãÊéßÂà∂„ÄÅÊâπÂ§ÑÁêÜ„ÄÅÂÆöÊó∂‰ªªÂä°Á≠âËÉΩÂäõÔºå‰Ω†ÁîöËá≥ÂèØ‰ª•Áî®ÂÖ∂Êù•Ëß£Êûê XML Êï∞ÊçÆ„ÄÇÂÖ≥‰∫éT-SQLÁöÑÊõ¥Â§ö‰ø°ÊÅØÂèØ‰ª•ÂèÇËÄÉMSDNÔºå‰∏ªÊµÅÁöÑÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ìÁõÆÂâçÂè™ÊúâMS SQL SERVERÊîØÊåÅT-SQLÔºåÂõ†Ê≠§ÔºåMySQL Âπ∂‰∏çÂÖ∑Â§á‰∏äÊñáÊèèËø∞ÁöÑ‰∏Ä‰∫õËÉΩÂäõÔºåÊØîÂ¶ÇÔºåMySQL ÁöÑÂ≠òÂÇ®ËøáÁ®ãË∞ÉËØïÈùûÂ∏∏‰∏çÊñπ‰æøÔºàÂΩìÁÑ∂ÂèØ‰ª•ÈÄöËøá‰ªòË¥πËΩØ‰ª∂Êù•Ëé∑ÂæóÂæàÂ•ΩÁöÑÊîØÊåÅÔºâ„ÄÇ Èô§Ê≠§‰πãÂ§ñÔºåMySQL Â≠òÂÇ®ËøáÁ®ãËøòÊúâ‰∏Ä‰∫õÂÖ∂‰ªñÁöÑÈôêÂà∂Ôºö ‰ºòÂåñÂô®Êó†Ê≥ïËØÑ‰º∞Â≠òÂÇ®ËøáÁ®ãÁöÑÊâßË°åÊàêÊú¨ ÊØè‰∏™ËøûÊé•ÈÉΩÊúâÁã¨Á´ãÁöÑÂ≠òÂÇ®ËøáÁ®ãÊâßË°åËÆ°ÂàíÁºìÂ≠òÔºåÂ¶ÇÊûúÊúâÂ§ö‰∏™ËøûÊé•ÈúÄË¶ÅË∞ÉÁî®Âêå‰∏Ä‰∏™Â≠òÂÇ®ËøáÁ®ãÔºåÂ∞Ü‰ºöÊµ™Ë¥πÁºìÂ≠òÁ©∫Èó¥Êù•ÁºìÂ≠òÁõ∏ÂêåÁöÑÊâßË°åËÆ°Âàí Âõ†Ê≠§ÔºåÂú® MySQL ‰∏≠‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÂπ∂‰∏çÊòØ‰∏Ä‰∏™Â§™Â•ΩÁ≠ñÁï•ÔºåÁâπÂà´ÊòØÂú®‰∏Ä‰∫õÂ§ßÊï∞ÊçÆ„ÄÅÈ´òÂπ∂ÂèëÁöÑÂú∫ÊôØ‰∏ãÔºåÂ∞ÜÂ§çÊùÇÁöÑÈÄªËæë‰∫§Áªô‰∏äÂ±ÇÂ∫îÁî®ÂÆûÁé∞ÔºåÂèØ‰ª•ÈùûÂ∏∏Êñπ‰æøÁöÑÊâ©Â±ïÂ∑≤ÊúâËµÑÊ∫ê‰ª•‰æøËé∑ÂæóÊõ¥È´òÁöÑËÆ°ÁÆóËÉΩÂäõ„ÄÇËÄå‰∏îÂØπ‰∫éÁÜüÊÇâÁöÑÁºñÁ®ãËØ≠Ë®ÄÔºåÂÖ∂ÂèØËØªÊÄß‰ºöÊØîÂ≠òÂÇ®ËøáÁ®ãÊõ¥Â•Ω‰∏Ä‰∫õÔºå‰πüÊõ¥Âä†ÁÅµÊ¥ª„ÄÇ‰∏çËøáÔºåÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãÔºåÂ¶ÇÊûúÂ≠òÂÇ®ËøáÁ®ãÊØîÂÖ∂‰ªñÂÆûÁé∞‰ºöÂø´ÂæàÂ§öÔºåÂπ∂‰∏îÊòØ‰∏Ä‰∫õËæÉÂ∞èÁöÑÊìç‰ΩúÔºåÂèØ‰ª•ÈÄÇÂΩìËÄÉËôë‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ã„ÄÇ ÂíåÂ≠òÂÇ®ËøáÁ®ãÁ±ª‰ººÁöÑÔºåËøòÊúâËß¶ÂèëÂô®ÔºåËß¶ÂèëÂô®ÂèØ‰ª•ËÆ©‰Ω†Âú®ÊâßË°åINSERT„ÄÅUPDATEÂíåDELETEÊó∂ÔºåÊâßË°å‰∏Ä‰∫õÁâπÂÆöÁöÑÊìç‰Ωú„ÄÇÂú® MySQL ‰∏≠ÂèØ‰ª•ÈÄâÊã©Âú® SQL ÊâßË°å‰πãÂâçËß¶ÂèëËøòÊòØÂú® SQL ÊâßË°åÂêéËß¶Âèë„ÄÇËß¶ÂèëÂô®‰∏ÄËà¨Áî®‰∫éÂÆûÁé∞‰∏Ä‰∫õÂº∫Âà∂ÁöÑÈôêÂà∂ÔºåËøô‰∫õÈôêÂà∂Â¶ÇÊûúÂú®Â∫îÁî®Á®ãÂ∫è‰∏≠ÂÆûÁé∞‰ºöËÆ©‰∏öÂä°‰ª£Á†ÅÂèòÂæóÈùûÂ∏∏Â§çÊùÇÔºåËÄå‰∏îÂÆÉ‰πüÂèØ‰ª•ÂáèÂ∞ëÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Âô®‰πãÈó¥ÁöÑÈÄö‰ø°„ÄÇMySQL Ëß¶ÂèëÂô®ÁöÑÂÆûÁé∞ÈùûÂ∏∏ÁÆÄÂçïÔºåÊâÄ‰ª•ÂäüËÉΩÈùûÂ∏∏ÊúâÈôêÔºåÂ¶ÇÊûú‰Ω†Âú®ÂÖ∂‰ªñÊï∞ÊçÆÂ∫ì‰∫ßÂìÅ‰∏≠Â∑≤ÁªèÈáçÂ∫¶‰æùËµñËß¶ÂèëÂô®ÔºåÈÇ£‰πàÂú®‰ΩøÁî® MySQL Ëß¶ÂèëÂô®Êó∂ÂÄôÈúÄË¶ÅÊ≥®ÊÑèÔºåÂõ†‰∏∫ MySQL Ëß¶ÂèëÂô®ÁöÑË°®Áé∞ÂíåÈ¢ÑÊÉ≥ÁöÑ‰∏ç‰∏ÄËá¥„ÄÇ È¶ñÂÖàÂØπ‰∏ÄÂº†Ë°®ÁöÑÊØè‰∏Ä‰∏™‰∫ã‰ª∂ÔºåÊúÄÂ§öÂè™ËÉΩÂÆö‰πâ‰∏Ä‰∏™Ëß¶ÂèëÂô®ÔºåËÄå‰∏îÂÆÉÂè™ÊîØÊåÅ ‚ÄúÂü∫‰∫éË°åÁöÑËß¶Âèë‚ÄùÔºå‰πüÂ∞±ÊòØËß¶ÂèëÂô®ÂßãÁªàÊòØÈíàÂØπ‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÔºåËÄå‰∏çÊòØÈíàÂØπÊï¥‰∏™ SQL ËØ≠Âè•„ÄÇÂ¶ÇÊûúÊòØÊâπÈáèÊõ¥Êñ∞ÁöÑËØùÔºåÊïàÁéáÂèØËÉΩ‰ºöÂæà‰Ωé„ÄÇÂÖ∂Ê¨°ÔºåËß¶ÂèëÂô®ÂèØ‰ª•Êé©ÁõñÊúçÂä°Âô®Êú¨Ë¥®Â∑•‰ΩúÔºå‰∏Ä‰∏™ÁÆÄÂçïÁöÑ SQL ËØ≠Âè•ËÉåÂêéÔºåÂõ†‰∏∫Ëß¶ÂèëÂô®ÔºåÂèØËÉΩÂåÖÂê´‰∫ÜÂæàÂ§öÁúã‰∏çËßÅÁöÑÂ∑•‰Ωú„ÄÇÂÜçËÄÖÔºåËß¶ÂèëÂô®Âá∫Áé∞ÈóÆÈ¢òÊó∂ÂæàÈöæÊéíÊü•„ÄÇÊúÄÂêéÔºåËß¶ÂèëÂô®Âπ∂‰∏ç‰∏ÄÂÆöËÉΩ‰øùËØÅÂéüÂ≠êÊÄßÔºåÊØîÂ¶ÇMyISAMÂºïÊìé‰∏ãËß¶ÂèëÂô®ÊâßË°åÂ§±Ë¥•‰∫ÜÔºå‰πü‰∏çËÉΩÂõûÊªö„ÄÇÂú®InnoDBË°®‰∏äÁöÑËß¶ÂèëÂô®ÊòØÂú®Âêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠ÊâßË°åÂÆåÊàêÁöÑÔºåÊâÄ‰ª•‰ªñ‰ª¨ÁöÑÊâßË°åÊòØÂéüÂ≠êÁöÑÔºåÂéüÊìç‰ΩúÂíåËß¶ÂèëÂô®Êìç‰Ωú‰ºöÂêåÊó∂Â§±Ë¥•ÊàñËÄÖÊàêÂäü„ÄÇ ËôΩÁÑ∂Ëß¶ÂèëÂô®ÊúâËøô‰πàÂ§öÈôêÂà∂Ôºå‰ΩÜÂÆÉ‰ªçÊúâÈÄÇÁî®ÁöÑÂú∫ÊôØÔºåÊØîÂ¶ÇÔºåÂΩì‰Ω†ÈúÄË¶ÅËÆ∞ÂΩï MySQL Êï∞ÊçÆÁöÑÂèòÊõ¥Êó•ÂøóÔºåËøôÊó∂Ëß¶ÂèëÂô®Â∞±ÈùûÂ∏∏Êñπ‰æø‰∫Ü„ÄÇ Â§ñÈîÆÁ∫¶ÊùüÁõÆÂâçÂú®Â§ßÂ§öÊï∞‰∫íËÅîÁΩëÈ°πÁõÆÔºåÁâπÂà´ÊòØÂú®Â§ßÊï∞ÊçÆÁöÑÂú∫ÊôØ‰∏ãÔºåÂ∑≤Áªè‰∏çÂª∫ËÆÆ‰ΩøÁî®Â§ñÈîÆ‰∫ÜÔºå‰∏ªË¶ÅÊòØËÄÉËôëÂà∞Â§ñÈîÆÁöÑ‰ΩøÁî®ÊàêÊú¨Ôºö Â§ñÈîÆÈÄöÂ∏∏Ë¶ÅÊ±ÇÊØèÊ¨°‰øÆÊîπÊï∞ÊçÆÊó∂ÈÉΩË¶ÅÂú®Âè¶Â§ñ‰∏ÄÂº†Ë°®‰∏≠ÊâßË°å‰∏ÄÊ¨°Êü•ÊâæÊìç‰Ωú„ÄÇÂú® InnoDB Â≠òÂÇ®ÂºïÊìé‰∏≠‰ºöÂº∫Âà∂Â§ñÈîÆ‰ΩøÁî®Á¥¢ÂºïÔºå‰ΩÜÂú®Â§ßÊï∞ÊçÆÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ªçÁÑ∂‰∏çËÉΩÂøΩÁï•Â§ñÈîÆÊ£ÄÊü•Â∏¶Êù•ÁöÑÂºÄÈîÄÔºåÁâπÂà´ÊòØÂΩìÂ§ñÈîÆÁöÑÈÄâÊã©ÊÄßÂæà‰ΩéÊó∂Ôºå‰ºöÂØºËá¥‰∏Ä‰∏™ÈùûÂ∏∏Â§ß‰∏îÈÄâÊã©ÊÄß‰ΩéÁöÑÁ¥¢Âºï„ÄÇ Â¶ÇÊûúÂêëÂ≠êË°®‰∏≠ÊèíÂÖ•‰∏ÄÊù°ËÆ∞ÂΩïÔºåÂ§ñÈîÆÁ∫¶Êùü‰ºöËÆ© InnoDB Ê£ÄÊü•ÂØπÂ∫îÁöÑÁà∂Ë°®ÁöÑËÆ∞ÂΩïÔºå‰πüÂ∞±ÈúÄË¶ÅÂØπÁà∂Ë°®ÂØπÂ∫îËÆ∞ÂΩïËøõË°åÂä†ÈîÅÊìç‰ΩúÔºåÊù•Á°Æ‰øùËøôÊù°ËÆ∞ÂΩï‰∏ç‰ºöÂú®Ëøô‰∏™‰∫ãÂä°ÂÆåÊàê‰πãÊó∂Â∞±Ë¢´Âà†Èô§‰∫Ü„ÄÇËøô‰ºöÂØºËá¥È¢ùÂ§ñÁöÑÈîÅÁ≠âÂæÖÔºåÁîöËá≥‰ºöÂØºËá¥‰∏Ä‰∫õÊ≠ªÈîÅ„ÄÇ È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÊï∞ÊçÆÂ∫ìÂæàÂÆπÊòìÊàê‰∏∫ÊÄßËÉΩÁì∂È¢àÔºåËá™ÁÑ∂ËÄåÁÑ∂ÁöÑÂ∞±Â∏åÊúõÊï∞ÊçÆÂ∫ìÂèØ‰ª•Ê∞¥Âπ≥Êâ©Â±ïÔºåËøôÊó∂Â∞±ÈúÄË¶ÅÊääÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÊéßÂà∂ÊîæÂà∞Â∫îÁî®Â±ÇÔºå‰πüÂ∞±ÊòØËÆ©Â∫îÁî®ÊúçÂä°Âô®ÂèØ‰ª•ÊâøÊãÖÂéãÂäõÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÊï∞ÊçÆÂ∫ìÂ±ÇÈù¢Â∞±‰∏çËÉΩ‰ΩøÁî®Â§ñÈîÆ„ÄÇ Âõ†Ê≠§ÔºåÂΩì‰∏çÁî®ËøáÂ§öËÄÉËôëÊï∞ÊçÆÂ∫ìÁöÑÊÄßËÉΩÈóÆÈ¢òÊó∂ÔºåÊØîÂ¶Ç‰∏Ä‰∫õÂÜÖÈÉ®È°πÁõÆÊàñ‰º†ÁªüË°å‰∏öÈ°πÁõÆÔºàÂÖ∂‰ΩøÁî®‰∫∫Êï∞ÊúâÈôêÔºåËÄå‰∏îÊï∞ÊçÆÈáè‰∏ÄËà¨‰∏ç‰ºöÂ§™Â§ßÔºâÔºå‰ΩøÁî®Â§ñÈîÆÊòØ‰∏Ä‰∏™‰∏çÈîôÁöÑÈÄâÊã©ÔºåÊØïÁ´üÊÉ≥Ë¶ÅÁ°Æ‰øùÁõ∏ÂÖ≥Ë°®ÂßãÁªàÊúâ‰∏ÄËá¥ÁöÑÊï∞ÊçÆÔºå‰ΩøÁî®Â§ñÈîÆË¶ÅÊØîÂú®Â∫îÁî®Á®ãÂ∫è‰∏≠Ê£ÄÊü•‰∏ÄËá¥ÊÄßÊñπ‰æøÁÆÄÂçïËÆ∏Â§öÔºåÊ≠§Â§ñÔºåÂ§ñÈîÆÂú®Áõ∏ÂÖ≥Êï∞ÊçÆÁöÑÂà†Èô§ÂíåÊõ¥Êñ∞Êìç‰Ωú‰∏ä‰πü‰ºöÊØîÂú®Â∫îÁî®‰∏≠Ë¶ÅÈ´òÊïà„ÄÇ ÁªëÂÆöÂèòÈáèÂèØËÉΩÂ§ßÂÆ∂ÁúãÂà∞ ‚ÄúÁªëÂÆöÂèòÈáè‚Äù Ëøô‰∏™ËØçÊó∂Ôºå‰ºöÊúâ‰∏ÄÁÇπÈôåÁîüÔºåÊç¢‰∏™ËØ¥Ê≥ïÂèØËÉΩ‰ºöÁÜüÊÇâ‰∏Ä‰∫õÔºöprepared statement„ÄÇÁªëÂÆöÂèòÈáèÁöÑ SQLÔºå‰ΩøÁî®ÈóÆÂè∑Ê†áËÆ∞ÂèØ‰ª•Êé•Êî∂ÂèÇÊï∞ÁöÑ‰ΩçÁΩÆÔºåÂΩìÁúüÊ≠£ÈúÄË¶ÅÊâßË°åÂÖ∑‰ΩìÊü•ËØ¢ÁöÑÊó∂ÂÄôÔºåÂàô‰ΩøÁî®ÂÖ∑‰ΩìÁöÑÊï∞ÂÄº‰ª£ÊõøËøô‰∫õÈóÆÂè∑ÔºåÊØîÂ¶ÇÔºö12345678910111213SELECT order_no, order_amount FROM sales WHERE order_status = ? and buyer = ?``` ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®ÁªëÂÆöÂèòÈáèÔºüÊÄªÊâÄÂë®Áü•ÁöÑÂéüÂõ†ÊòØÂèØ‰ª•È¢ÑÂÖàÁºñËØëÔºåÂáèÂ∞ë SQL Ê≥®ÂÖ•ÁöÑÈ£éÈô©ÔºåÈô§‰∫ÜËøô‰∫õÂë¢ÔºüÂΩìÂàõÂª∫‰∏Ä‰∏™ÁªëÂÆöÂèòÈáè SQL Êó∂ÔºåÂÆ¢Êà∑Á´ØÂêëÊúçÂä°Âô®ÂèëÈÄÅ‰∫Ü‰∏Ä‰∏™ SQL ËØ≠Âè•ÂéüÂûãÔºåÊúçÂä°Âô®Êî∂Âà∞Ëøô‰∏™ SQL ËØ≠Âè•ÁöÑÊ°ÜÊû∂ÂêéÔºåËß£ÊûêÂπ∂Â≠òÂÇ®Ëøô‰∏™ SQL ËØ≠Âè•ÁöÑÈÉ®ÂàÜÊâßË°åËÆ°ÂàíÔºåËøîÂõûÁªôÂÆ¢Êà∑Á´Ø‰∏Ä‰∏™ SQL ËØ≠Âè•Â§ÑÁêÜÂè•ÊüÑÔºå‰ªéÊ≠§‰ª•ÂêéÔºåÂÆ¢Êà∑Á´ØÈÄöËøáÂêëÊúçÂä°Âô®ÂèëÈÄÅÂêÑ‰∏™ÈóÆÂè∑ÁöÑÂèñÂÄºÂíåËøô‰∏™Âè•ÊüÑÊù•ÊâßË°å‰∏Ä‰∏™ÂÖ∑‰ΩìÊü•ËØ¢ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Êõ¥È´òÊïàÂú∞ÊâßË°åÂ§ßÈáèÈáçÂ§çËØ≠Âè•ÔºåÂõ†‰∏∫Ôºö* ÊúçÂä°Âô®Âè™ÈúÄË¶ÅËß£Êûê‰∏ÄÊ¨° SQL ËØ≠Âè•* ÊúçÂä°Âô®Êüê‰∫õ‰ºòÂåñÂô®ÁöÑ‰ºòÂåñÂ∑•‰Ωú‰πüÂè™ÈúÄË¶ÅÂÅö‰∏ÄÊ¨°ÔºåÂõ†‰∏∫ MySQL ‰ºöÁºìÂ≠òÈÉ®ÂàÜÊâßË°åËÆ°Âàí* ÈÄö‰ø°‰∏≠‰ªÖ‰ªÖÂèëÈÄÅÁöÑÊòØÂèÇÊï∞ÔºåËÄå‰∏çÊòØÊï¥‰∏™ËØ≠Âè•ÔºåÁΩëÁªúÂºÄÈîÄ‰πü‰ºöÊõ¥Â∞èÔºåËÄå‰∏î‰ª•‰∫åËøõÂà∂ÂèëÈÄÅÂèÇÊï∞ÂíåÂè•ÊüÑË¶ÅÊØîÂèëÈÄÅ ASCII ÊñáÊú¨ÁöÑÊïàÁéáÊõ¥È´òÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåMySQL Âπ∂‰∏çÊòØÊÄªËÉΩÁºìÂ≠òÊâßË°åËÆ°ÂàíÔºåÂ¶ÇÊûúÊüê‰∫õÊâßË°åËÆ°ÂàíÈúÄË¶ÅÊ†πÊçÆÂèÇÂÖ•ÁöÑÂèÇÊï∞Êù•ËÆ°ÁÆóÊó∂ÔºåMySQL Â∞±Êó†Ê≥ïÁºìÂ≠òËøôÈÉ®ÂàÜÊâßË°åËÆ°Âàí„ÄÇÊØîÂ¶ÇÔºö```bash-- ËøôÈáåÂÅáË£ÖÊúâ‰∏Ä‰∏™‰æãÂ≠êÔºåÂ§ßÂÆ∂ÂèØ‰ª•Ëá™Â∑±ÊÄùËÄÉ‰∏Ä‰∏ã ‰ΩøÁî®ÁªëÂÆöÂèòÈáèÁöÑÊúÄÂ§ßÈô∑Èò±ÊòØÔºö‰Ω†Áü•ÈÅìÂÖ∂ÂéüÁêÜÔºå‰ΩÜ‰∏çÁü•ÈÅìÂÆÉÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇÊúâÊó∂ÂÄôÔºåÂæàÈöæËß£ÈáäÂ¶Ç‰∏ã 3 ÁßçÁªëÂÆöÂèòÈáèÁ±ªÂûã‰πãÈó¥ÁöÑÂå∫Âà´Ôºö ÂÆ¢Êà∑Á´ØÊ®°ÊãüÁöÑÁªëÂÆöÂèòÈáèÔºöÂÆ¢Êà∑Á´ØÁöÑÈ©±Âä®Á®ãÂ∫èÊé•Êî∂‰∏Ä‰∏™Â∏¶ÂèÇÊï∞ÁöÑ SQLÔºåÂÜçÂ∞ÜÂèÇÊï∞ÁöÑÂÄºÂ∏¶ÂÖ•ÂÖ∂‰∏≠ÔºåÊúÄÂêéÂ∞ÜÂÆåÊï¥ÁöÑÊü•ËØ¢ÂèëÈÄÅÂà∞ÊúçÂä°Âô®„ÄÇ ÊúçÂä°Âô®ÁªëÂÆöÂèòÈáèÔºöÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÁâπÊÆäÁöÑ‰∫åËøõÂà∂ÂçèËÆÆÂ∞ÜÂ∏¶ÂèÇÊï∞ÁöÑ SQL ËØ≠Âè•ÂèëÈÄÅÂà∞ÊúçÂä°Âô®Á´ØÔºåÁÑ∂Âêé‰ΩøÁî®‰∫åËøõÂà∂ÂçèËÆÆÂ∞ÜÂÖ∑‰ΩìÁöÑÂèÇÊï∞ÂÄºÂèëÈÄÅÁªôÊúçÂä°Âô®Âπ∂ÊâßË°å„ÄÇ SQL Êé•Âè£ÁöÑÁªëÂÆöÂèòÈáèÔºöÂÆ¢Êà∑Á´ØÂÖàÂèëÈÄÅ‰∏Ä‰∏™Â∏¶ÂèÇÊï∞ÁöÑ SQL ËØ≠Âè•Âà∞ÊúçÂä°Âô®Á´ØÔºåËøôÁ±ª‰ºº‰∫é‰ΩøÁî®preparedÁöÑ SQL ËØ≠Âè•ÔºåÁÑ∂ÂêéÂèëÈÄÅËÆæÁΩÆÁöÑÂèÇÊï∞ÔºåÊúÄÂêéÂú®ÂèëÈÄÅexecuteÊåá‰ª§Êù•ÊâßË°å SQLÔºåÊâÄÊúâËøô‰∫õÈÉΩÊòØÁî®ÊôÆÈÄöÁöÑÊñáÊú¨‰º†ËæìÂçèËÆÆ„ÄÇ ÊØîÂ¶ÇÊüê‰∫õ‰∏çÊîØÊåÅÈ¢ÑÁºñËØëÁöÑ JDBC È©±Âä®ÔºåÂú®Ë∞ÉÁî®connection.prepareStatement(sql)Êó∂ÔºåÂπ∂‰∏ç‰ºöÊää SQL ËØ≠Âè•ÂèëÈÄÅÁªôÊï∞ÊçÆÂ∫ìÂÅöÈ¢ÑÂ§ÑÁêÜÔºåËÄåÊòØÁ≠âÂà∞Ë∞ÉÁî®executeQueryÊñπÊ≥ïÊó∂ÊâçÊääÊï¥‰∏™ËØ≠Âè•ÂèëÈÄÅÂà∞ÊúçÂä°Âô®ÔºåËøôÁßçÊñπÂºèÂ∞±Á±ª‰ºº‰∫éÁ¨¨ 1 ÁßçÊÉÖÂÜµ„ÄÇÂõ†Ê≠§ÔºåÂú®Á®ãÂ∫è‰∏≠‰ΩøÁî®ÁªëÂÆöÂèòÈáèÊó∂ÔºåÁêÜËß£‰Ω†‰ΩøÁî®ÁöÑÈ©±Âä®ÈÄöËøáÂì™ÁßçÊñπÂºèÊù•ÂÆûÁé∞Â∞±ÊòæÂæóÂæàÊúâÂøÖË¶Å„ÄÇÂª∂‰º∏ÂºÄÊù•ËØ¥ÔºåÂØπ‰∫éËá™Â∑±‰ΩøÁî®ÁöÑÊ°ÜÊû∂„ÄÅÂºÄÊ∫êÂ∑•ÂÖ∑Ôºå‰∏çÂ∫î‰ªÖ‰ªÖÂÅúÁïôÂú®‰ºö‰ΩøÁî®Ëøô‰∏™Â±ÇÈù¢ÔºåÊúâÊó∂Èó¥ÂèØ‰ª•Ê∑±ÂÖ•‰∫ÜËß£ÂÖ∂ÂéüÁêÜÂíåÂÆûÁé∞Ôºå‰∏çÁÑ∂ÊúâÂèØËÉΩË¢´È™ó‰∫ÜÈÉΩ‰∏çÁü•ÈÅìÂì¶„ÄÇ Áî®Êà∑Ëá™ÂÆö‰πâÂáΩÊï∞MySQL Êú¨Ë∫´ÂÜÖÁΩÆ‰∫ÜÈùûÂ∏∏Â§öÁöÑÂáΩÊï∞ÔºåÊØîÂ¶ÇSUM„ÄÅCOUNT„ÄÅAVGÁ≠âÁ≠âÔºåÂèØÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåÊàë‰ª¨Â∏∏Â∏∏ÈúÄË¶ÅÊõ¥Â§ö„ÄÇÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÊõ¥Âº∫Â§ßÁöÑÂäüËÉΩÈÉΩÊòØÂú®Â∫îÁî®Â±ÇÈù¢ÂÆûÁé∞Ôºå‰ΩÜÂÆûÈôÖ‰∏ä MySQL ‰πüÊèê‰æõ‰∫ÜÊú∫‰ºöËÆ©Êàë‰ª¨ÂèØ‰ª•ÂéªÊâ©Â±ï MySQL ÂáΩÊï∞ÔºåËøôÂ∞±ÊòØÁî®Êà∑Ëá™ÂÆö‰πâÂáΩÊï∞ (user-defined function)Ôºå‰πüÁß∞‰∏∫ÔºöUDF„ÄÇÈúÄË¶ÅÊ≥®ÊÑèUDF‰∏éÂ≠òÂÇ®ËøáÁ®ãÂíåÈÄöËøá SQL ÂàõÂª∫ÂáΩÊï∞ÁöÑÂå∫Âà´ÔºåÂ≠òÂÇ®ËøáÁ®ãÂè™ËÉΩ‰ΩøÁî® SQL Êù•ÁºñÂÜôÔºåËÄåUDFÊ≤°ÊúâËøô‰∏™ÈôêÂà∂ÔºåÂèØ‰ª•‰ΩøÁî®ÊîØÊåÅ C ËØ≠Ë®ÄË∞ÉÁî®Á∫¶ÂÆöÁöÑ‰ªª‰ΩïÁºñÁ®ãËØ≠Ë®ÄÊù•ÂÆûÁé∞„ÄÇ UDFÂøÖÈ°ª‰∫ãÂÖàÁºñËØëÂ•ΩÂπ∂Âä®ÊÄÅÈìæÊé•Âà∞ÊúçÂä°Âô®‰∏äÔºåËøôÁßçÂπ≥Âè∞Áõ∏ÂÖ≥ÊÄß‰ΩøÂæóUDFÂú®ÂæàÂ§öÊñπÈù¢ÈÉΩÂæàÂº∫Â§ßÔºåUDFÈÄüÂ∫¶ÈùûÂ∏∏Âø´ÔºåËÄå‰∏îÂèØ‰ª•ËÆøÈóÆÂ§ßÈáèÊìç‰ΩúÁ≥ªÁªüÂäüËÉΩÔºåËøòÂèØ‰ª•‰ΩøÁî®Â§ßÈáèÂ∫ìÂáΩÊï∞„ÄÇÂ¶ÇÊûúÈúÄË¶Å‰∏Ä‰∏™ MySQL ‰∏çÊîØÊåÅÁöÑÁªüËÆ°ËÅöÂêàÂáΩÊï∞ÔºåÂπ∂‰∏îÊó†Ê≥ï‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÊù•ÂÆûÁé∞ÔºåËÄå‰∏îËøòÊÉ≥‰∏çÂêåÁöÑËØ≠Ë®ÄÈÉΩÂèØ‰ª•Ë∞ÉÁî®ÔºåÈÇ£‰πàUDFÊòØ‰∏çÈîôÁöÑÈÄâÊã©ÔºåËá≥Â∞ë‰∏çÈúÄË¶ÅÊØèÁßçËØ≠Ë®ÄÈÉΩÊù•ÂÆûÁé∞Áõ∏ÂêåÁöÑÈÄªËæë„ÄÇ ÊâÄË∞ìËÉΩÂäõË∂äÂ§ßÔºåË¥£‰ªª‰πüÂ∞±Ë∂äÂ§ßÔºåUDF‰∏≠ÁöÑ‰∏Ä‰∏™ÈîôËØØÂèØËÉΩÁõ¥Êé•ËÆ©ÊúçÂä°Âô®Â¥©Ê∫ÉÔºåÁîöËá≥Êâ∞‰π±ÊúçÂä°Âô®ÁöÑÂÜÖÂ≠òÂíåÊï∞ÊçÆÔºåÂõ†Ê≠§Ôºå‰ΩøÁî®Êó∂ÈúÄË¶ÅÊ≥®ÊÑèÂÖ∂ÊΩúÂú®ÁöÑÈ£éÈô©„ÄÇÂú® MySQL ÁâàÊú¨ÂçáÁ∫ßÊó∂‰πüÈúÄË¶ÅÊ≥®ÊÑèÔºåÂõ†‰∏∫‰Ω†ÂèØËÉΩÈúÄË¶ÅÈáçÊñ∞ÁºñËØëÊàñËÄÖ‰øÆÊîπËøô‰∫õUDFÔºå‰ª•‰æøËÆ©ÂÆÉ‰ª¨ËÉΩÂú®Êñ∞ÁâàÊú¨‰∏≠Â∑•‰Ωú„ÄÇ ËøôÈáåÊúâ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁ§∫‰æãÊù•Â±ïÁ§∫Â¶Ç‰ΩïÂàõÂª∫UDFÔºöÂ∞ÜÁªìÊûúÈõÜËΩ¨Âåñ‰∏∫ JSONÔºåÂÖ∑‰ΩìÁöÑ‰ª£Á†ÅËØ∑ÂèÇËÄÉÔºölib_mysqludf_json„ÄÇ1234567891011121314151617181920212223242526-- 1„ÄÅÈ¶ñÂÖà‰ΩøÁî®cËØ≠Ë®ÄÂÆûÁé∞ÂäüËÉΩ-- 2„ÄÅÁºñËØë-- ËøôÈáåÁúÅÁï•Á¨¨1„ÄÅ2Ê≠•ÔºåÂÆûÁé∞Âπ∂ÁºñËØëÊàê.so-- 3„ÄÅ‰ΩøÁî®SQLÂàõÂª∫ÂáΩÊï∞DROP FUNCTION json_array;CREATE FUNCTION json_array RETURNS string soname 'lib_mysqludf_json.so';-- 4„ÄÅ‰ΩøÁî®ÂáΩÊï∞SELECT json_array( customer_id, first_name, last_name, last_update ) as customerFROM customerWHERE customer_id = 1;/*5„ÄÅÂæóÂà∞ÁöÑÁªìÊûúÂ¶Ç‰∏ãÔºö+------------------------------------------+| customer |+------------------------------------------+| [1,"MARY","SMITH","2006-02-15 04:57:20"] |+------------------------------------------+*/ ÂÖ∂Â§ßËá¥ÁöÑÂÆûÁé∞ÊµÅÁ®ãÔºö‰ΩøÁî® C ËØ≠Ë®ÄÂÆûÁé∞ÈÄªËæë -> ÁºñËØëÊàê.soÊñá‰ª∂ -> ÂàõÂª∫ÂáΩÊï∞ -> ‰ΩøÁî®ÂáΩÊï∞„ÄÇUDFÂú®ÂÆûÈôÖÂ∑•‰Ωú‰∏≠ÂèØËÉΩÂæàÂ∞ë‰ΩøÁî®Ôºå‰ΩÜ‰Ωú‰∏∫ÂºÄÂèëËÄÖÁöÑÊàë‰ª¨Ôºå‰∫ÜËß£Ëøô‰πà‰∏ÄÊ¨æÂº∫Â§ßÁöÑÂ∑•ÂÖ∑ÔºåÂú®Ëß£ÂÜ≥Ê£òÊâãÈóÆÈ¢òÊó∂Ôºå‰πüËÆ©Êàë‰ª¨Êúâ‰∫ÜÊõ¥Â§öÁöÑÈÄâÊã©„ÄÇ Â≠óÁ¨¶ÈõÜÊúÄÂêéËØ¥ËØ¥Â≠óÁ¨¶ÈõÜ„ÄÇ ÂÖ≥‰∫éÂ≠óÁ¨¶ÈõÜÂ§ßÂ§öÊï∞‰∫∫ÁöÑÁ¨¨‰∏ÄÂç∞Ë±°ÂèØËÉΩÂ∞±ÊòØÔºöÊï∞ÊçÆÂ∫ìÂ≠óÁ¨¶ÈõÜÂ∞ΩÈáè‰ΩøÁî®UTF8ÔºåÂõ†‰∏∫UTF8Â≠óÁ¨¶ÈõÜÊòØÁõÆÂâçÊúÄÈÄÇÂêà‰∫éÂÆûÁé∞Â§öÁßç‰∏çÂêåÂ≠óÁ¨¶ÈõÜ‰πãÈó¥ÁöÑËΩ¨Êç¢ÁöÑÂ≠óÁ¨¶ÈõÜÔºåÂèØ‰ª•ÊúÄÂ§ßÁ®ãÂ∫¶‰∏äÈÅøÂÖç‰π±Á†ÅÈóÆÈ¢òÔºå‰πüÂèØ‰ª•Êñπ‰æø‰ª•ÂêéÁöÑÊï∞ÊçÆËøÅÁßª„ÄÇBut whyÔºü Â≠óÁ¨¶ÈõÜÊòØÊåá‰∏ÄÁßç‰ªé‰∫åËøõÂà∂ÁºñÁ†ÅÂà∞ÊüêÁ±ªÂ≠óÁ¨¶Á¨¶Âè∑ÁöÑÊò†Â∞ÑÔºåÂèØ‰ª•ÂèÇËÄÉÂ¶Ç‰Ωï‰ΩøÁî®‰∏Ä‰∏™Â≠óËäÇÊù•Ë°®Á§∫Ëã±ÊñáÂ≠óÊØç„ÄÇÊ†°ÂØπËßÑÂàôÊòØÊåá‰∏ÄÁªÑÁî®‰∫éÊüê‰∏™Â≠óÁ¨¶ÈõÜÁöÑÊéíÂ∫èËßÑÂàôÔºåÂç≥ÈááÁî®‰ΩïÁßçËßÑÂàôÂØπÊüêÁ±ªÂ≠óÁ¨¶ËøõË°åÊéíÂ∫è„ÄÇMySQL ÊØè‰∏ÄÁ±ªÁºñÁ†ÅÂ≠óÁ¨¶ÈÉΩÊúâÂÖ∂ÂØπÂ∫îÁöÑÂ≠óÁ¨¶ÈõÜÂíåÊ†°ÂØπËßÑÂàô„ÄÇMySQL ÂØπÂêÑÁßçÂ≠óÁ¨¶ÈõÜÁöÑÊîØÊåÅÈÉΩÈùûÂ∏∏ÂÆåÂñÑÔºå‰ΩÜÂêåÊó∂‰πüÂ∏¶Êù•‰∏Ä‰∫õÂ§çÊùÇÊÄßÔºåÊüê‰∫õÂú∫ÊôØ‰∏ãÁîöËá≥‰ºöÊúâ‰∏Ä‰∫õÊÄßËÉΩÁâ∫Áâ≤„ÄÇ ‰∏ÄÁßçÂ≠óÁ¨¶ÈõÜÂèØËÉΩÂØπÂ∫îÂ§öÁßçÊ†°ÂØπËßÑÂàôÔºå‰∏îÈÉΩÊúâ‰∏Ä‰∏™ÈªòËÆ§Ê†°ÂØπËßÑÂàôÔºåÈÇ£Âú® MySQL ‰∏≠ÊòØÂ¶Ç‰Ωï‰ΩøÁî®Â≠óÁ¨¶ÈõÜÁöÑÔºüÂú® MySQL ‰∏≠ÂèØ‰ª•ÈÄöËøá‰∏§ÁßçÊñπÂºèËÆæÁΩÆÂ≠óÁ¨¶ÈõÜÔºöÂàõÂª∫ÂØπË±°Êó∂ËÆæÁΩÆÈªòËÆ§ÂÄº„ÄÅÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Âô®ÈÄö‰ø°Êó∂ÊòæÂºèËÆæÁΩÆ„ÄÇ MySQL ÈááÁî® ‚ÄúÈò∂Ê¢Ø‚Äù ÂºèÁöÑÊñπÂºèÊù•ËÆæÂÆöÂ≠óÁ¨¶ÈõÜÈªòËÆ§ÂÄºÔºåÊØè‰∏™Êï∞ÊçÆÂ∫ìÔºåÊØèÂº†Ë°®ÈÉΩÊúâËá™Â∑±ÁöÑÈªòËÆ§ÂÄºÔºåÂÆÉ‰ª¨ÈÄêÂ±ÇÁªßÊâøÔºåÊúÄÁªàÊúÄÈù†Â∫ïÂ±ÇÁöÑÈªòËÆ§ËÆæÁΩÆÂ∞ÜÂΩ±Âìç‰Ω†ÂàõÂª∫ÁöÑÂØπË±°„ÄÇÊØîÂ¶ÇÔºåÂàõÂª∫Êï∞ÊçÆÂ∫ìÊó∂ÔºåÂ∞ÜÊ†πÊçÆÊúçÂä°Âô®‰∏äÁöÑcharacter_set_serverÊù•ËÆæÁΩÆÊï∞ÊçÆÂ∫ìÁöÑÈªòËÆ§Â≠óÁ¨¶ÈõÜÔºåÂêåÊ†∑ÁöÑÈÅìÁêÜÔºåÊ†πÊçÆdatabaseÁöÑÂ≠óÁ¨¶ÈõÜÊù•ÊåáÂÆöÂ∫ì‰∏≠ÊâÄÊúâË°®ÁöÑÂ≠óÁ¨¶ÈõÜ‚Ä¶‚Ä¶ ‰∏çÁÆ°ÊòØÂØπÊï∞ÊçÆÂ∫ìÔºåËøòÊòØË°®ÂíåÂàóÔºåÂè™ÊúâÂΩìÂÆÉ‰ª¨Ê≤°ÊúâÊòæÂºèÊåáÂÆöÂ≠óÁ¨¶ÈõÜÊó∂ÔºåÈªòËÆ§Â≠óÁ¨¶ÈõÜÊâç‰ºöËµ∑‰ΩúÁî®„ÄÇ ÂΩìÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Âô®ÈÄö‰ø°Êó∂ÔºåÂÆÉ‰ª¨ÂèØ‰ª•‰ΩøÁî®‰∏çÂêåÁöÑÂ≠óÁ¨¶ÈõÜÔºåËøôÊó∂ÂÄôÊúçÂä°Âô®Â∞ÜËøõË°åÂøÖË¶ÅÁöÑËΩ¨Êç¢Â∑•‰Ωú„ÄÇÂΩìÂÆ¢Êà∑Á´ØÂêëÊúçÂä°Âô®ÂèëÈÄÅËØ∑Ê±ÇÊó∂ÔºåÊï∞ÊçÆ‰ª•character_set_clientËÆæÁΩÆÁöÑÂ≠óÁ¨¶ÈõÜËøõË°åÁºñÁ†ÅÔºõËÄåÂΩìÊúçÂä°Âô®Êî∂Âà∞ÂÆ¢Êà∑Á´ØÁöÑ SQL ÊàñËÄÖÊï∞ÊçÆÊó∂Ôºå‰ºöÊåâÁÖßcharacter_set_connectionËÆæÁΩÆÁöÑÂ≠óÁ¨¶ÈõÜËøõË°åËΩ¨Êç¢ÔºõÂΩìÊúçÂä°Âô®Â∞ÜË¶ÅËøõË°åÂ¢ûÂà†ÊîπÊü•Á≠âÊìç‰ΩúÂâç‰ºöÂÜçÊ¨°Â∞ÜÊï∞ÊçÆËΩ¨Êç¢Êàêcharacter_set_database(Êï∞ÊçÆÂ∫ìÈááÁî®ÁöÑÂ≠óÁ¨¶ÈõÜÔºåÊ≤°ÊúâÂçïÁã¨ÈÖçÁΩÆÂç≥‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆÔºåÂÖ∑‰ΩìÂèÇËÄÉ‰∏äÊñá)ÔºåÊúÄÂêéÂΩìÊúçÂä°Âô®ËøîÂõûÊï∞ÊçÆÊàñËÄÖÈîôËØØ‰ø°ÊÅØÊó∂ÔºåÂàôÂ∞ÜÊï∞ÊçÆÊåâcharacter_set_resultËÆæÁΩÆÁöÑÂ≠óÁ¨¶ÈõÜËøõË°åÁºñÁ†Å„ÄÇÊúçÂä°Âô®Á´ØÂèØ‰ª•‰ΩøÁî®SET CHARACTER SETÊù•ÊîπÂèò‰∏äÈù¢ÁöÑÈÖçÁΩÆÔºåÂÆ¢Êà∑Á´Ø‰πüÂèØ‰ª•Ê†πÊçÆÂØπÂ∫îÁöÑ API Êù•ÊîπÂèòÂ≠óÁ¨¶ÈõÜÈÖçÁΩÆ„ÄÇÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®Á´ØÈÉΩ‰ΩøÁî®Ê≠£Á°ÆÁöÑÂ≠óÁ¨¶ÈõÜÊâçËÉΩÈÅøÂÖçÂú®ÈÄö‰ø°‰∏≠Âá∫Áé∞ÈóÆÈ¢ò„ÄÇ ÈÇ£Â¶Ç‰ΩïÈÄâÊã©Â≠óÁ¨¶ÈõÜÂú®ËÄÉËôë‰ΩøÁî®‰ΩïÁßçÂ≠óÁ¨¶ÈõÜÊó∂ÔºåÊúÄ‰∏ªË¶ÅÁöÑË°°ÈáèÂõ†Á¥†ÊòØÂ≠òÂÇ®ÁöÑÂÜÖÂÆπÔºåÂú®ËÉΩÂ§üÊª°Ë∂≥Â≠òÂÇ®ÂÜÖÂÆπÁöÑÂâçÊèê‰∏ãÔºåÂ∞ΩÈáè‰ΩøÁî®ËæÉÂ∞èÁöÑÂ≠óÁ¨¶ÈõÜ„ÄÇÂõ†‰∏∫Êõ¥Â∞èÁöÑÂ≠óÁ¨¶ÈõÜÊÑèÂë≥ÁùÄÊõ¥Â∞ëÁ©∫Èó¥Âç†Áî®„ÄÅ‰ª•ÂèäÊõ¥È´òÁöÑÁΩëÁªú‰º†ËæìÊïàÁéáÔºå‰πüÈó¥Êé•ÊèêÈ´ò‰∫ÜÁ≥ªÁªüÁöÑÊÄßËÉΩ„ÄÇÂ¶ÇÊûúÂ≠òÂÇ®ÁöÑÂÜÖÂÆπÊòØËã±ÊñáÂ≠óÁ¨¶Á≠âÊãâ‰∏ÅËØ≠Á≥ªÂ≠óÁ¨¶ÁöÑËØùÔºåÈÇ£‰πà‰ΩøÁî®ÈªòËÆ§ÁöÑlatin1Â≠óÁ¨¶ÈõÜÂÆåÂÖ®Ê≤°ÊúâÈóÆÈ¢òÔºàMySQL 8 ÈªòËÆ§utf8mb4ÔºâÔºåÂ¶ÇÊûúÈúÄË¶ÅÂ≠òÂÇ®Ê±âÂ≠ó„ÄÅ‰øÑÊñá„ÄÅÈòøÊãâ‰ºØËØ≠Á≠âÈùûÊãâ‰∏ÅËØ≠Á≥ªÂ≠óÁ¨¶ÔºåÂàôÂª∫ËÆÆ‰ΩøÁî®UTF8Â≠óÁ¨¶ÈõÜ„ÄÇÂΩìÁÑ∂‰∏çÂêåÂ≠óÁ¨¶Âú®‰ΩøÁî®UTF8Â≠óÁ¨¶ÈõÜÊâÄÂç†Áî®ÁöÑÁ©∫Èó¥ÊòØ‰∏çÂêåÁöÑÔºåÊØîÂ¶ÇËã±ÊñáÂ≠óÁ¨¶Âú®UTF8Â≠óÁ¨¶ÈõÜ‰∏≠Âè™‰ΩøÁî®‰∏Ä‰∏™Â≠óËäÇÔºåËÄå‰∏Ä‰∏™Ê±âÂ≠óÂàôÂç†Áî® 3 ‰∏™Â≠óËäÇ„ÄÇ Èô§‰∫ÜÂ≠óÁ¨¶ÈõÜÔºåÊ†°ÂØπËßÑÂàô‰πüÊòØÊàë‰ª¨ÈúÄË¶ÅËÄÉËôëÁöÑÈóÆÈ¢ò„ÄÇÂØπ‰∫éÊ†°ÂØπËßÑÂàôÔºå‰∏ÄËà¨Êù•ËØ¥Âè™ÈúÄË¶ÅËÄÉËôëÊòØÂê¶‰ª•Â§ßÂ∞èÂÜôÊïèÊÑüÁöÑÊñπÂºèÊØîËæÉÂ≠óÁ¨¶‰∏≤ÊàñËÄÖÊòØÂê¶Áî®Â≠óÁ¨¶‰∏≤ÁºñÁ†ÅÁöÑ‰∫åËøõÂà∂Êù•ÊØîËæÉÂ§ßÂ∞èÔºåÂÖ∂ÂØπÂ∫îÁöÑÊ†°ÂØπËßÑÂàôÁöÑÂêéÁºÄÂàÜÂà´ÊòØ_cs„ÄÅ_ciÂíå_bin„ÄÇÂ§ßÂ∞èÂÜôÊïèÊÑüÂíå‰∫åËøõÂà∂Ê†°ÂØπËßÑÂàôÁöÑ‰∏çÂêå‰πãÂ§ÑÂú®‰∫éÔºå‰∫åËøõÂà∂Ê†°ÂØπËßÑÂàôÁõ¥Êé•‰ΩøÁî®Â≠óÁ¨¶ÁöÑÂ≠óËäÇËøõË°åÊØîËæÉÔºåËÄåÂ§ßÂ∞èÂÜôÊïèÊÑüÁöÑÊ†°ÂØπËßÑÂàôÂú®Â§öÂ≠óËäÇÂ≠óÁ¨¶ÈõÜÊó∂ÔºåÂ¶ÇÂæ∑ËØ≠ÔºåÊúâÊõ¥Â§çÊùÇÁöÑÊØîËæÉËßÑÂàô„ÄÇ‰∏æ‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºåUTF8Â≠óÁ¨¶ÈõÜÂØπÂ∫îÊ†°ÂØπËßÑÂàôÊúâ‰∏âÁßçÔºö utf8_binÂ∞ÜÂ≠óÁ¨¶‰∏≤‰∏≠ÁöÑÊØè‰∏Ä‰∏™Â≠óÁ¨¶Áî®‰∫åËøõÂà∂Êï∞ÊçÆÂ≠òÂÇ®ÔºåÂå∫ÂàÜÂ§ßÂ∞èÂÜô utf8_general_ci‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºåci‰∏∫case insensitiveÁöÑÁº©ÂÜôÔºåÂç≥Â§ßÂ∞èÂÜô‰∏çÊïèÊÑü utf8_general_csÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºåcs‰∏∫case sensitiveÁöÑÁº©ÂÜôÔºåÂç≥Â§ßÂ∞èÂÜôÊïèÊÑü ÊØîÂ¶ÇÔºåÂàõÂª∫‰∏ÄÂº†Ë°®Ôºå‰ΩøÁî®UTF8ÁºñÁ†ÅÔºå‰∏îÂ§ßÂ∞èÂÜôÊïèÊÑüÊó∂ÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãËØ≠Âè•Ôºö12345CREATE TABLE sales ( order_no VARCHAR(32) NOT NULL PRIMARY KEY, order_amount INT NOT NULL DEFAULT 0, ......) ENGINE=InnoDB COLLATE=utf8_general_cs; Âõ†Ê≠§ÔºåÂú®È°πÁõÆ‰∏≠Áõ¥Êé•‰ΩøÁî®UTF8Â≠óÁ¨¶ÈõÜÊòØÂÆåÂÖ®Ê≤°ÊúâÈóÆÈ¢òÁöÑÔºå‰ΩÜÈúÄË¶ÅËÆ∞‰ΩèÁöÑÊòØ‰∏çË¶ÅÂú®‰∏Ä‰∏™Êï∞ÊçÆÂ∫ì‰∏≠‰ΩøÁî®Â§ö‰∏™‰∏çÂêåÁöÑÂ≠óÁ¨¶ÈõÜÔºå‰∏çÂêåÂ≠óÁ¨¶ÈõÜ‰πãÈó¥ÁöÑ‰∏çÂÖºÂÆπÈóÆÈ¢òÂæàÈöæÁº†„ÄÇÊúâÊó∂ÂÄôÔºåÁúãËµ∑Êù•‰∏ÄÂàáÊ≠£Â∏∏Ôºå‰ΩÜÊòØÂΩìÊüê‰∏™ÁâπÊÆäÂ≠óÁ¨¶Âá∫Áé∞Êó∂Ôºå‰∏ÄÂàáÊìç‰ΩúÈÉΩ‰ºöÂá∫ÈîôÔºåËÄå‰∏î‰Ω†ÂæàÈöæÂèëÁé∞ÈîôËØØÁöÑÂéüÂõ†„ÄÇ Â≠óÁ¨¶ÈõÜÂØπÊï∞ÊçÆÂ∫ìÁöÑÊÄßËÉΩÊúâÂΩ±ÂìçÂêóÊüê‰∫õÂ≠óÁ¨¶ÈõÜÂíåÊ†°ÂØπËßÑÂàôÂèØËÉΩ‰ºöÈúÄË¶ÅÂ§ö‰∏™ÁöÑ CPU Êìç‰ΩúÔºåÂèØËÉΩ‰ºöÊ∂àËÄóÊõ¥Â§öÁöÑÂÜÖÂ≠òÂíåÂ≠òÂÇ®Á©∫Èó¥ÔºåËøôÁÇπÂú®ÂâçÊñáÂ∑≤ÁªèËØ¥Ëøá„ÄÇÁâπÂà´ÊòØÂú®Âêå‰∏Ä‰∏™Êï∞ÊçÆÂ∫ì‰∏≠‰ΩøÁî®‰∏çÂêåÁöÑÂ≠óÁ¨¶ÈõÜÔºåÈÄ†ÊàêÁöÑÂΩ±ÂìçÂèØËÉΩ‰ºöÊõ¥Â§ß„ÄÇ ‰∏çÂêåÂ≠óÁ¨¶ÈõÜÂíåÊ†°ÂØπËßÑÂàô‰πãÈó¥ÁöÑËΩ¨Êç¢ÂèØËÉΩ‰ºöÂ∏¶Êù•È¢ùÂ§ñÁöÑÁ≥ªÁªüÂºÄÈîÄÔºåÊØîÂ¶ÇÔºåÊï∞ÊçÆË°®salesÂú®buyerÂ≠óÊÆµ‰∏äÊúâÁ¥¢ÂºïÔºåÂàôÂèØ‰ª•Âä†ÈÄü‰∏ãÈù¢ÁöÑORDER BYÊìç‰ΩúÔºö1SELECT order_no,order_amount FROM sales ORDER BY buyer; Âè™ÊúâÂΩì SQL Êü•ËØ¢‰∏≠ÊéíÂ∫èË¶ÅÊ±ÇÁöÑÂ≠óÁ¨¶ÈõÜ‰∏éÊúçÂä°Âô®Êï∞ÊçÆÁöÑÂ≠óÁ¨¶ÈõÜÁõ∏ÂêåÊó∂ÔºåÊâçËÉΩ‰ΩøÁî®Á¥¢ÂºïËøõË°åÊéíÂ∫è„ÄÇ‰Ω†ÂèØËÉΩ‰ºöËØ¥ÔºåËøô‰∏çÊòØÂ∫üËØùÂêóÔºüÂÖ∂ÂÆû‰∏çÁÑ∂ÔºåMySQL ÊòØÂèØ‰ª•ÂçïÁã¨ÊåáÂÆöÊéíÂ∫èÊó∂‰ΩøÁî®ÁöÑÊ†°ÂØπËßÑÂàôÁöÑÔºåÊØîÂ¶ÇÔºö123-- ‰Ω†ËØ¥ÔºåËøô‰∏çÊòØÂêÉÈ•±‰∫ÜÊíëÁöÑÂêóÔºüÊàëËßâÂæó‰πüÊòØÔºå‰πüËÆ∏‰ºöÊúâÂÖ∂ÈÄÇÁî®ÁöÑÂú∫ÊôØÂêß-- ËøôÊó∂ÂÄôÂ∞±‰∏çËÉΩ‰ΩøÁî®Á¥¢ÂºïÊéíÂ∫èÂë¢ÔºåÂè™ËÉΩ‰ΩøÁî®Êñá‰ª∂ÊéíÂ∫èSELECT order_no,order_amount FROM sales ORDER BY buyer COLLATE utf8_bin; ÂΩì‰ΩøÁî®‰∏§‰∏™Â≠óÁ¨¶ÈõÜ‰∏çÂêåÁöÑÂàóÊù•ÂÖ≥ËÅî‰∏§Âº†Ë°®Êó∂ÔºåMySQL ‰ºöÂ∞ùËØïËΩ¨Êç¢ÂÖ∂‰∏≠‰∏Ä‰∏™ÂàóÁöÑÂ≠óÁ¨¶ÈõÜ„ÄÇËøôÂíåÂú®Êï∞ÊçÆÂàóÂ§ñÈù¢Â∞ÅË£Ö‰∏Ä‰∏™ÂáΩÊï∞‰∏ÄÊ†∑Ôºå‰ºöËÆ© MySQL Êó†Ê≥ï‰ΩøÁî®Ëøô‰∏™Âàó‰∏äÁöÑÁ¥¢Âºï„ÄÇÂÖ≥‰∫é MySQL Â≠óÁ¨¶ÈõÜËøòÊúâ‰∏Ä‰∫õÂùëÔºå‰ΩÜÂú®ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ‰∏≠ÈÅáÂà∞ÁöÑÂ≠óÁ¨¶ÈõÜÈóÆÈ¢òÔºåÂÖ∂ÂÆû‰∏çÊòØÁâπÂà´ÁöÑÂ§öÔºåÊâÄ‰ª•Â∞±Ê≠§Êâì‰Ωè„ÄÇ ÁªìËØ≠MySQL ËøòÊúâ‰∏Ä‰∫õÂÖ∂‰ªñÈ´òÁ∫ßÁâπÊÄßÔºå‰ΩÜÂú®Â§ßÂ§öÊï∞Âú∫ÊôØ‰∏ãÊàë‰ª¨ÂæàÂ∞ë‰ºö‰ΩøÁî®ÔºåÂõ†Ê≠§ËøôÈáå‰πüÊ≤°ÊúâËÆ®ËÆ∫Ôºå‰ΩÜÂ§ö‰∫ÜËß£‰∏Ä‰∫õÊÄªÊòØÂ•ΩÁöÑÔºåËá≥Â∞ëÂú®ÈúÄË¶ÅÁöÑÊó∂ÂÄôÔºå‰Ω†Áü•ÈÅìÊúâËøôÊ†∑‰∏Ä‰∏™‰∏úË•ø„ÄÇÊàë‰ª¨ÈùûÂ∏∏Â§öÁöÑ‰∫∫ÔºåÊÄªÊòØ‰ºöËÆ§‰∏∫Ëá™Â∑±ÊâÄÂ≠¶ÁöÑÁü•ËØÜÂ∞±ÂÉèÁ¢éÁâá‰∏ÄÊ†∑‰∏çÊàê‰ΩìÁ≥ªÔºåÂèàÊâæ‰∏çÂà∞Ëß£ÂÜ≥ÂäûÊ≥ïÔºåÈÇ£‰Ω†ÊúâÊ≤°ÊúâÊÉ≥Ëøá‰πüËÆ∏ÊòØÁ¢éÁâá‰∏çÂ§üÂ§öÁöÑÁºòÊïÖÔºüÁÇπÂ§™Â∞ëÔºåËá™ÁÑ∂‰∏çËÉΩËøûÊé•ÊàêÁ∫øÔºåÁ∫øÂ§™Â∞ëÔºåËá™ÁÑ∂‰∏çËÉΩÁªìÊàêÁΩë„ÄÇÂõ†ËÄåÔºåÊ≤°ÊúâÂÖ∂‰ªñÂäûÊ≥ïÔºå‰øùÊåÅÂ•ΩÂ•áÂøÉ„ÄÅÂ§öÂ≠¶‰π†„ÄÅÂ§öÁßØÁ¥ØÔºåÈáèÂèòÊÄªÊúâ‰∏ÄÂ§©‰ºöË¥®Âèò„ÄÇ ÂâçÈù¢ÊàëÂÜôÁöÑ‰∏Ä‰∫õÊñáÁ´†ÈáåÈù¢‰ºöÊúâÊèêÂà∞ËøáÔºåÊû∂ÊûÑËÆæËÆ°ÊòØ‰∏ÄÁßçÂπ≥Ë°°ÁöÑËâ∫ÊúØÔºåÂÖ∂ÂÆûË¥®Â∫îËØ•ÊòØ‰∏ÄÁßçÂ¶•ÂçèÔºåÊòØÂØπÁé∞ÊúâËµÑÊ∫êÁöÑ‰∏ÄÁßçÂ¶•Âçè„ÄÇÊúâÊó∂ÂÄôÊàë‰ª¨‰ºö‰∏çËá™ËßâÁöÑÈô∑ÂÖ•Êüê‰∏Ä‰∏™ÁÇπÔºåÊØîÂ¶ÇÔºå‰∏∫‰∫ÜËøΩÊ±ÇÊï∞ÊçÆÁöÑÊâ©Â±ïÊÄßÔºåÂæàÂ§ö‰∫∫‰∏Ä‰∏äÊù•Â∞±ÂºÄÂßãÂàÜÂ∫ìÂàÜË°®ÔºåÁÑ∂ÂêéÊääÂ∫îÁî®ÊêûÂæóÈùûÂ∏∏Â§çÊùÇÔºåÂà∞ÊúÄÂêéË°®ÈáåËøòÊ≤°ÊúâË£ÖÊª°Êï∞ÊçÆÔºåÈ°πÁõÆÂ∞±Â∑≤ÁªèÊ≠ª‰∫Ü„ÄÇÊâÄ‰ª•Âú®ËµÑÊ∫êÊúâÈôêÊàñËÄÖÊú™Êù•Ëøò‰∏çÂèØÁü•ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞ΩÈáè‰ΩøÁî®Êï∞ÊçÆÂ∫ì„ÄÅËØ≠Ë®ÄÊú¨Ë∫´ÁöÑÁâπÊÄßÊù•ÂÆåÊàêÁõ∏Â∫îÁöÑÂ∑•‰ΩúÔºåÊòØ‰∏çÊòØ‰ºöÊõ¥Â•Ω‰∏ÄÁÇπ„ÄÇËß£ÂÜ≥Â§ßÊï∞ÊçÆÈóÆÈ¢òÔºå‰πü‰∏çÂè™ÊòØÂàÜÂ∫ìÂàÜË°®Ôºå‰Ω†ËøòÂ∫îËØ•ËøòÂèØ‰ª•ÊÉ≥Âà∞ÂàÜÂå∫ÔºõÊúâ‰∫õ‰∏öÂä°Âç≥‰ΩøÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ã‰πü‰∏ç‰∏ÄÂÆöÈùûË¶ÅÂú®‰∏öÂä°Â±ÇÂÆåÊàêÔºåÂêàÁêÜ‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÂíåËß¶ÂèëÂô®ÊàñËÄÖ‰ΩøÁî®Ëá™Â∑±Ê†πÊçÆÂàÜË°®ÂàÜÂ∫ìËßÑÂàôÁöÑÂ∞èÂ∑•ÂÖ∑‰πüËÆ∏‰ºöËÆ©‰Ω†Êõ¥ËΩªÊùæ‚Ä¶‚Ä¶ ÂèÇËÄÉËµÑÊñôÈ´òÊÄßËÉΩ MySQL(Á¨¨ 3 Áâà) document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL ‰ºòÂåñÂéüÁêÜ(‰∏Ä)]]></title>
    <url>%2F2019%2F03%2F29%2Fmysql-optimization-principle-1%2F</url>
    <content type="text"><![CDATA[Êâ´Âú∞Âè™‰∏çËøáÊòØÊàëdiË°®Èù¢Â∑•‰ΩúÔºåÊàëÁúüÊ≠£diË∫´‰ªΩÊòØ‰∏Ä‰ΩçÁ†îÁ©∂‚Äî‚ÄîÂÉß„ÄÇ ÂâçË®ÄËØ¥Ëµ∑ MySQL ÁöÑÊü•ËØ¢‰ºòÂåñÔºåÁõ∏‰ø°Â§ßÂÆ∂Êî∂Ëóè‰∫Ü‰∏ÄÂ†ÜÂ•áÊäÄÊ∑´Â∑ßÔºö‰∏çËÉΩ‰ΩøÁî®SELECT *„ÄÅ‰∏ç‰ΩøÁî® NULL Â≠óÊÆµ„ÄÅÂêàÁêÜÂàõÂª∫Á¥¢Âºï„ÄÅ‰∏∫Â≠óÊÆµÈÄâÊã©ÂêàÈÄÇÁöÑÊï∞ÊçÆÁ±ªÂûã‚Ä¶‚Ä¶ ‰Ω†ÊòØÂê¶ÁúüÁöÑÁêÜËß£Ëøô‰∫õ‰ºòÂåñÊäÄÂ∑ßÔºüÊòØÂê¶ÁêÜËß£ÂÖ∂ËÉåÂêéÁöÑÂ∑•‰ΩúÂéüÁêÜÔºüÂú®ÂÆûÈôÖÂú∫ÊôØ‰∏ãÊÄßËÉΩÁúüÊúâÊèêÂçáÂêóÔºüÊàëÊÉ≥Êú™ÂøÖ„ÄÇÂõ†ËÄåÁêÜËß£Ëøô‰∫õ‰ºòÂåñÂª∫ËÆÆËÉåÂêéÁöÑÂéüÁêÜÂ∞±Â∞§‰∏∫ÈáçË¶ÅÔºåÂ∏åÊúõÊú¨ÊñáËÉΩËÆ©‰Ω†ÈáçÊñ∞ÂÆ°ËßÜËøô‰∫õ‰ºòÂåñÂª∫ËÆÆÔºåÂπ∂Âú®ÂÆûÈôÖ‰∏öÂä°Âú∫ÊôØ‰∏ãÂêàÁêÜÁöÑËøêÁî®„ÄÇ MySQL ÈÄªËæëÊû∂ÊûÑÂ¶ÇÊûúËÉΩÂú®Â§¥ËÑë‰∏≠ÊûÑÂª∫‰∏ÄÂπÖ MySQL ÂêÑÁªÑ‰ª∂‰πãÈó¥Â¶Ç‰ΩïÂçèÂêåÂ∑•‰ΩúÁöÑÊû∂ÊûÑÂõæÔºåÊúâÂä©‰∫éÊ∑±ÂÖ•ÁêÜËß£ MySQL ÊúçÂä°Âô®„ÄÇ‰∏ãÂõæÂ±ïÁ§∫‰∫Ü MySQL ÁöÑÈÄªËæëÊû∂ÊûÑÂõæ„ÄÇ MySQL ÈÄªËæëÊû∂ÊûÑÊï¥‰ΩìÂàÜ‰∏∫‰∏âÂ±ÇÔºåÊúÄ‰∏äÂ±Ç‰∏∫ÂÆ¢Êà∑Á´ØÂ±ÇÔºåÂπ∂Èùû MySQL ÊâÄÁã¨ÊúâÔºåËØ∏Â¶ÇÔºöËøûÊé•Â§ÑÁêÜ„ÄÅÊéàÊùÉËÆ§ËØÅ„ÄÅÂÆâÂÖ®Á≠âÂäüËÉΩÂùáÂú®Ëøô‰∏ÄÂ±ÇÂ§ÑÁêÜ„ÄÇ MySQL Â§ßÂ§öÊï∞Ê†∏ÂøÉÊúçÂä°ÂùáÂú®‰∏≠Èó¥Ëøô‰∏ÄÂ±ÇÔºåÂåÖÊã¨Êü•ËØ¢Ëß£Êûê„ÄÅÂàÜÊûê„ÄÅ‰ºòÂåñ„ÄÅÁºìÂ≠ò„ÄÅÂÜÖÁΩÆÂáΩÊï∞ (ÊØîÂ¶ÇÔºöÊó∂Èó¥„ÄÅÊï∞Â≠¶„ÄÅÂä†ÂØÜÁ≠âÂáΩÊï∞)„ÄÇÊâÄÊúâÁöÑË∑®Â≠òÂÇ®ÂºïÊìéÁöÑÂäüËÉΩ‰πüÂú®Ëøô‰∏ÄÂ±ÇÂÆûÁé∞ÔºöÂ≠òÂÇ®ËøáÁ®ã„ÄÅËß¶ÂèëÂô®„ÄÅËßÜÂõæÁ≠â„ÄÇ ÊúÄ‰∏ãÂ±Ç‰∏∫Â≠òÂÇ®ÂºïÊìéÔºåÂÖ∂Ë¥üË¥£ MySQL ‰∏≠ÁöÑÊï∞ÊçÆÂ≠òÂÇ®ÂíåÊèêÂèñ„ÄÇÂíå Linux ‰∏ãÁöÑÊñá‰ª∂Á≥ªÁªüÁ±ª‰ººÔºåÊØèÁßçÂ≠òÂÇ®ÂºïÊìéÈÉΩÊúâÂÖ∂‰ºòÂäøÂíåÂä£Âäø„ÄÇ‰∏≠Èó¥ÁöÑÊúçÂä°Â±ÇÈÄöËøá API ‰∏éÂ≠òÂÇ®ÂºïÊìéÈÄö‰ø°ÔºåËøô‰∫õ API Êé•Âè£Â±èËîΩ‰∫Ü‰∏çÂêåÂ≠òÂÇ®ÂºïÊìéÈó¥ÁöÑÂ∑ÆÂºÇ„ÄÇ MySQL Êü•ËØ¢ËøáÁ®ãÊàë‰ª¨ÊÄªÊòØÂ∏åÊúõ MySQL ËÉΩÂ§üËé∑ÂæóÊõ¥È´òÁöÑÊü•ËØ¢ÊÄßËÉΩÔºåÊúÄÂ•ΩÁöÑÂäûÊ≥ïÊòØÂºÑÊ∏ÖÊ•ö MySQL ÊòØÂ¶Ç‰Ωï‰ºòÂåñÂíåÊâßË°åÊü•ËØ¢ÁöÑ„ÄÇ‰∏ÄÊó¶ÁêÜËß£‰∫ÜËøô‰∏ÄÁÇπÔºåÂ∞±‰ºöÂèëÁé∞ÔºöÂæàÂ§öÁöÑÊü•ËØ¢‰ºòÂåñÂ∑•‰ΩúÂÆûÈôÖ‰∏äÂ∞±ÊòØÈÅµÂæ™‰∏Ä‰∫õÂéüÂàôËÆ© MySQL ÁöÑ‰ºòÂåñÂô®ËÉΩÂ§üÊåâÁÖßÈ¢ÑÊÉ≥ÁöÑÂêàÁêÜÊñπÂºèËøêË°åËÄåÂ∑≤„ÄÇ ÂΩìÂêë MySQL ÂèëÈÄÅ‰∏Ä‰∏™ËØ∑Ê±ÇÁöÑÊó∂ÂÄôÔºåMySQL Âà∞Â∫ïÂÅö‰∫Ü‰∫õ‰ªÄ‰πàÂë¢Ôºü ÂÆ¢Êà∑Á´Ø / ÊúçÂä°Á´ØÈÄö‰ø°ÂçèËÆÆMySQL ÂÆ¢Êà∑Á´Ø / ÊúçÂä°Á´ØÈÄö‰ø°ÂçèËÆÆÊòØ ‚ÄúÂçäÂèåÂ∑•‚Äù ÁöÑÔºöÂú®‰ªª‰∏ÄÊó∂ÂàªÔºåË¶Å‰πàÊòØÊúçÂä°Âô®ÂêëÂÆ¢Êà∑Á´ØÂèëÈÄÅÊï∞ÊçÆÔºåË¶Å‰πàÊòØÂÆ¢Êà∑Á´ØÂêëÊúçÂä°Âô®ÂèëÈÄÅÊï∞ÊçÆÔºåËøô‰∏§‰∏™Âä®‰Ωú‰∏çËÉΩÂêåÊó∂ÂèëÁîü„ÄÇ‰∏ÄÊó¶‰∏ÄÁ´ØÂºÄÂßãÂèëÈÄÅÊ∂àÊÅØÔºåÂè¶‰∏ÄÁ´ØË¶ÅÊé•Êî∂ÂÆåÊï¥‰∏™Ê∂àÊÅØÊâçËÉΩÂìçÂ∫îÂÆÉÔºåÊâÄ‰ª•Êàë‰ª¨Êó†Ê≥ï‰πüÊó†È°ªÂ∞Ü‰∏Ä‰∏™Ê∂àÊÅØÂàáÊàêÂ∞èÂùóÁã¨Á´ãÂèëÈÄÅÔºå‰πüÊ≤°ÊúâÂäûÊ≥ïËøõË°åÊµÅÈáèÊéßÂà∂„ÄÇ ÂÆ¢Êà∑Á´ØÁî®‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊï∞ÊçÆÂåÖÂ∞ÜÊü•ËØ¢ËØ∑Ê±ÇÂèëÈÄÅÁªôÊúçÂä°Âô®ÔºåÊâÄ‰ª•ÂΩìÊü•ËØ¢ËØ≠Âè•ÂæàÈïøÁöÑÊó∂ÂÄôÔºåÈúÄË¶ÅËÆæÁΩÆmax_allowed_packetÂèÇÊï∞„ÄÇ‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûúÊü•ËØ¢ÂÆûÂú®ÊòØÂ§™Â§ßÔºåÊúçÂä°Á´Ø‰ºöÊãíÁªùÊé•Êî∂Êõ¥Â§öÊï∞ÊçÆÂπ∂ÊäõÂá∫ÂºÇÂ∏∏„ÄÇ ‰∏é‰πãÁõ∏ÂèçÁöÑÊòØÔºåÊúçÂä°Âô®ÂìçÂ∫îÁªôÁî®Êà∑ÁöÑÊï∞ÊçÆÈÄöÂ∏∏‰ºöÂæàÂ§öÔºåÁî±Â§ö‰∏™Êï∞ÊçÆÂåÖÁªÑÊàê„ÄÇ‰ΩÜÊòØÂΩìÊúçÂä°Âô®ÂìçÂ∫îÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÊó∂ÔºåÂÆ¢Êà∑Á´ØÂøÖÈ°ªÂÆåÊï¥ÁöÑÊé•Êî∂Êï¥‰∏™ËøîÂõûÁªìÊûúÔºåËÄå‰∏çËÉΩÁÆÄÂçïÁöÑÂè™ÂèñÂâçÈù¢Âá†Êù°ÁªìÊûúÔºåÁÑ∂ÂêéËÆ©ÊúçÂä°Âô®ÂÅúÊ≠¢ÂèëÈÄÅ„ÄÇÂõ†ËÄåÂú®ÂÆûÈôÖÂºÄÂèë‰∏≠ÔºåÂ∞ΩÈáè‰øùÊåÅÊü•ËØ¢ÁÆÄÂçï‰∏îÂè™ËøîÂõûÂøÖÈúÄÁöÑÊï∞ÊçÆÔºåÂáèÂ∞èÈÄö‰ø°Èó¥Êï∞ÊçÆÂåÖÁöÑÂ§ßÂ∞èÂíåÊï∞ÈáèÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â•ΩÁöÑ‰π†ÊÉØÔºåËøô‰πüÊòØÊü•ËØ¢‰∏≠Â∞ΩÈáèÈÅøÂÖç‰ΩøÁî®SELECT *‰ª•ÂèäÂä†‰∏äLIMITÈôêÂà∂ÁöÑÂéüÂõ†‰πã‰∏Ä„ÄÇ Êü•ËØ¢ÁºìÂ≠òÂú®Ëß£Êûê‰∏Ä‰∏™Êü•ËØ¢ËØ≠Âè•ÂâçÔºåÂ¶ÇÊûúÊü•ËØ¢ÁºìÂ≠òÊòØÊâìÂºÄÁöÑÔºåÈÇ£‰πà MySQL ‰ºöÊ£ÄÊü•Ëøô‰∏™Êü•ËØ¢ËØ≠Âè•ÊòØÂê¶ÂëΩ‰∏≠Êü•ËØ¢ÁºìÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆ„ÄÇÂ¶ÇÊûúÂΩìÂâçÊü•ËØ¢ÊÅ∞Â•ΩÂëΩ‰∏≠Êü•ËØ¢ÁºìÂ≠òÔºåÂú®Ê£ÄÊü•‰∏ÄÊ¨°Áî®Êà∑ÊùÉÈôêÂêéÁõ¥Êé•ËøîÂõûÁºìÂ≠ò‰∏≠ÁöÑÁªìÊûú„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÊü•ËØ¢‰∏ç‰ºöË¢´Ëß£ÊûêÔºå‰πü‰∏ç‰ºöÁîüÊàêÊâßË°åËÆ°ÂàíÔºåÊõ¥‰∏ç‰ºöÊâßË°å„ÄÇ MySQL Â∞ÜÁºìÂ≠òÂ≠òÊîæÂú®‰∏Ä‰∏™ÂºïÁî®Ë°®Ôºà‰∏çË¶ÅÁêÜËß£ÊàêtableÔºåÂèØ‰ª•ËÆ§‰∏∫ÊòØÁ±ª‰ºº‰∫éHashMapÁöÑÊï∞ÊçÆÁªìÊûÑÔºâÔºåÈÄöËøá‰∏Ä‰∏™ÂìàÂ∏åÂÄºÁ¥¢ÂºïÔºåËøô‰∏™ÂìàÂ∏åÂÄºÈÄöËøáÊü•ËØ¢Êú¨Ë∫´„ÄÅÂΩìÂâçË¶ÅÊü•ËØ¢ÁöÑÊï∞ÊçÆÂ∫ì„ÄÅÂÆ¢Êà∑Á´ØÂçèËÆÆÁâàÊú¨Âè∑Á≠â‰∏Ä‰∫õÂèØËÉΩÂΩ±ÂìçÁªìÊûúÁöÑ‰ø°ÊÅØËÆ°ÁÆóÂæóÊù•„ÄÇÊâÄ‰ª•‰∏§‰∏™Êü•ËØ¢Âú®‰ªª‰ΩïÂ≠óÁ¨¶‰∏äÁöÑ‰∏çÂêåÔºà‰æãÂ¶ÇÔºöÁ©∫Ê†º„ÄÅÊ≥®ÈáäÔºâÔºåÈÉΩ‰ºöÂØºËá¥ÁºìÂ≠ò‰∏ç‰ºöÂëΩ‰∏≠„ÄÇ Â¶ÇÊûúÊü•ËØ¢‰∏≠ÂåÖÂê´‰ªª‰ΩïÁî®Êà∑Ëá™ÂÆö‰πâÂáΩÊï∞„ÄÅÂ≠òÂÇ®ÂáΩÊï∞„ÄÅÁî®Êà∑ÂèòÈáè„ÄÅ‰∏¥Êó∂Ë°®„ÄÅMySQL Â∫ì‰∏≠ÁöÑÁ≥ªÁªüË°®ÔºåÂÖ∂Êü•ËØ¢ÁªìÊûúÈÉΩ‰∏ç‰ºöË¢´ÁºìÂ≠ò„ÄÇÊØîÂ¶ÇÂáΩÊï∞NOW()ÊàñËÄÖCURRENT_DATE()‰ºöÂõ†‰∏∫‰∏çÂêåÁöÑÊü•ËØ¢Êó∂Èó¥ÔºåËøîÂõû‰∏çÂêåÁöÑÊü•ËØ¢ÁªìÊûúÔºåÂÜçÊØîÂ¶ÇÂåÖÂê´CURRENT_USERÊàñËÄÖCONNECION_ID()ÁöÑÊü•ËØ¢ËØ≠Âè•‰ºöÂõ†‰∏∫‰∏çÂêåÁöÑÁî®Êà∑ËÄåËøîÂõû‰∏çÂêåÁöÑÁªìÊûúÔºåÂ∞ÜËøôÊ†∑ÁöÑÊü•ËØ¢ÁªìÊûúÁºìÂ≠òËµ∑Êù•Ê≤°Êúâ‰ªª‰ΩïÁöÑÊÑè‰πâ„ÄÇ Êó¢ÁÑ∂ÊòØÁºìÂ≠òÔºåÂ∞±‰ºöÂ§±ÊïàÔºåÈÇ£Êü•ËØ¢ÁºìÂ≠ò‰ΩïÊó∂Â§±ÊïàÂë¢ÔºüMySQL ÁöÑÊü•ËØ¢ÁºìÂ≠òÁ≥ªÁªü‰ºöË∑üË∏™Êü•ËØ¢‰∏≠Ê∂âÂèäÁöÑÊØè‰∏™Ë°®ÔºåÂ¶ÇÊûúËøô‰∫õË°®ÔºàÊï∞ÊçÆÊàñÁªìÊûÑÔºâÂèëÁîüÂèòÂåñÔºåÈÇ£‰πàÂíåËøôÂº†Ë°®Áõ∏ÂÖ≥ÁöÑÊâÄÊúâÁºìÂ≠òÊï∞ÊçÆÈÉΩÂ∞ÜÂ§±Êïà„ÄÇÊ≠£Âõ†‰∏∫Â¶ÇÊ≠§ÔºåÂú®‰ªª‰ΩïÁöÑÂÜôÊìç‰ΩúÊó∂ÔºåMySQL ÂøÖÈ°ªÂ∞ÜÂØπÂ∫îË°®ÁöÑÊâÄÊúâÁºìÂ≠òÈÉΩËÆæÁΩÆ‰∏∫Â§±Êïà„ÄÇÂ¶ÇÊûúÊü•ËØ¢ÁºìÂ≠òÈùûÂ∏∏Â§ßÊàñËÄÖÁ¢éÁâáÂæàÂ§öÔºåËøô‰∏™Êìç‰ΩúÂ∞±ÂèØËÉΩÂ∏¶Êù•ÂæàÂ§ßÁöÑÁ≥ªÁªüÊ∂àËÄóÔºåÁîöËá≥ÂØºËá¥Á≥ªÁªüÂÉµÊ≠ª‰∏Ä‰ºöÂÑø„ÄÇËÄå‰∏îÊü•ËØ¢ÁºìÂ≠òÂØπÁ≥ªÁªüÁöÑÈ¢ùÂ§ñÊ∂àËÄó‰πü‰∏ç‰ªÖ‰ªÖÂú®ÂÜôÊìç‰ΩúÔºåËØªÊìç‰Ωú‰πü‰∏ç‰æãÂ§ñÔºö ‰ªª‰ΩïÁöÑÊü•ËØ¢ËØ≠Âè•Âú®ÂºÄÂßã‰πãÂâçÈÉΩÂøÖÈ°ªÁªèËøáÊ£ÄÊü•ÔºåÂç≥‰ΩøËøôÊù° SQL ËØ≠Âè•Ê∞∏Ëøú‰∏ç‰ºöÂëΩ‰∏≠ÁºìÂ≠ò Â¶ÇÊûúÊü•ËØ¢ÁªìÊûúÂèØ‰ª•Ë¢´ÁºìÂ≠òÔºåÈÇ£‰πàÊâßË°åÂÆåÊàêÂêéÔºå‰ºöÂ∞ÜÁªìÊûúÂ≠òÂÖ•ÁºìÂ≠òÔºå‰πü‰ºöÂ∏¶Êù•È¢ùÂ§ñÁöÑÁ≥ªÁªüÊ∂àËÄó Âü∫‰∫éÊ≠§ÔºåÊàë‰ª¨Ë¶ÅÁü•ÈÅìÂπ∂‰∏çÊòØ‰ªÄ‰πàÊÉÖÂÜµ‰∏ãÊü•ËØ¢ÁºìÂ≠òÈÉΩ‰ºöÊèêÈ´òÁ≥ªÁªüÊÄßËÉΩÔºåÁºìÂ≠òÂíåÂ§±ÊïàÈÉΩ‰ºöÂ∏¶Êù•È¢ùÂ§ñÊ∂àËÄóÔºåÂè™ÊúâÂΩìÁºìÂ≠òÂ∏¶Êù•ÁöÑËµÑÊ∫êËäÇÁ∫¶Â§ß‰∫éÂÖ∂Êú¨Ë∫´Ê∂àËÄóÁöÑËµÑÊ∫êÊó∂ÔºåÊâç‰ºöÁªôÁ≥ªÁªüÂ∏¶Êù•ÊÄßËÉΩÊèêÂçá„ÄÇ‰ΩÜË¶ÅÂ¶Ç‰ΩïËØÑ‰º∞ÊâìÂºÄÁºìÂ≠òÊòØÂê¶ËÉΩÂ§üÂ∏¶Êù•ÊÄßËÉΩÊèêÂçáÊòØ‰∏Ä‰ª∂ÈùûÂ∏∏Âõ∞ÈöæÁöÑ‰∫ãÊÉÖÔºå‰πü‰∏çÂú®Êú¨ÊñáËÆ®ËÆ∫ÁöÑËåÉÁï¥ÂÜÖ„ÄÇÂ¶ÇÊûúÁ≥ªÁªüÁ°ÆÂÆûÂ≠òÂú®‰∏Ä‰∫õÊÄßËÉΩÈóÆÈ¢òÔºåÂèØ‰ª•Â∞ùËØïÊâìÂºÄÊü•ËØ¢ÁºìÂ≠òÔºåÂπ∂Âú®Êï∞ÊçÆÂ∫ìËÆæËÆ°‰∏äÂÅö‰∏Ä‰∫õ‰ºòÂåñÔºåÊØîÂ¶ÇÔºö Áî®Â§ö‰∏™Â∞èË°®‰ª£Êõø‰∏Ä‰∏™Â§ßË°®ÔºåÊ≥®ÊÑè‰∏çË¶ÅËøáÂ∫¶ËÆæËÆ° ÊâπÈáèÊèíÂÖ•‰ª£ÊõøÂæ™ÁéØÂçïÊù°ÊèíÂÖ• ÂêàÁêÜÊéßÂà∂ÁºìÂ≠òÁ©∫Èó¥Â§ßÂ∞èÔºå‰∏ÄËà¨Êù•ËØ¥ÂÖ∂Â§ßÂ∞èËÆæÁΩÆ‰∏∫Âá†ÂçÅÂÖÜÊØîËæÉÂêàÈÄÇ ÂèØ‰ª•ÈÄöËøáSQL_CACHEÂíåSQL_NO_CACHEÊù•ÊéßÂà∂Êüê‰∏™Êü•ËØ¢ËØ≠Âè•ÊòØÂê¶ÈúÄË¶ÅËøõË°åÁºìÂ≠ò ÊúÄÂêéÁöÑÂø†ÂëäÊòØ‰∏çË¶ÅËΩªÊòìÊâìÂºÄÊü•ËØ¢ÁºìÂ≠òÔºåÁâπÂà´ÊòØÂÜôÂØÜÈõÜÂûãÂ∫îÁî®„ÄÇÂ¶ÇÊûú‰Ω†ÂÆûÂú®ÊòØÂøç‰∏ç‰ΩèÔºåÂèØ‰ª•Â∞Üquery_cache_typeËÆæÁΩÆ‰∏∫DEMANDÔºåËøôÊó∂Âè™ÊúâÂä†ÂÖ•SQL_CACHEÁöÑÊü•ËØ¢Êâç‰ºöËµ∞ÁºìÂ≠òÔºåÂÖ∂‰ªñÊü•ËØ¢Âàô‰∏ç‰ºöÔºåËøôÊ†∑ÂèØ‰ª•ÈùûÂ∏∏Ëá™Áî±Âú∞ÊéßÂà∂Âì™‰∫õÊü•ËØ¢ÈúÄË¶ÅË¢´ÁºìÂ≠ò„ÄÇ ÂΩìÁÑ∂Êü•ËØ¢ÁºìÂ≠òÁ≥ªÁªüÊú¨Ë∫´ÊòØÈùûÂ∏∏Â§çÊùÇÁöÑÔºåËøôÈáåËÆ®ËÆ∫ÁöÑ‰πüÂè™ÊòØÂæàÂ∞èÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÂÖ∂‰ªñÊõ¥Ê∑±ÂÖ•ÁöÑËØùÈ¢òÔºåÊØîÂ¶ÇÔºöÁºìÂ≠òÊòØÂ¶Ç‰Ωï‰ΩøÁî®ÂÜÖÂ≠òÁöÑÔºüÂ¶Ç‰ΩïÊéßÂà∂ÂÜÖÂ≠òÁöÑÁ¢éÁâáÂåñÔºü‰∫ãÂä°ÂØπÊü•ËØ¢ÁºìÂ≠òÊúâ‰ΩïÂΩ±ÂìçÁ≠âÁ≠âÔºåËØªËÄÖÂèØ‰ª•Ëá™Ë°åÈòÖËØªÁõ∏ÂÖ≥ËµÑÊñôÔºåËøôÈáåÊùÉÂΩìÊäõÁ†ñÂºïÁéâÂêß„ÄÇ ËØ≠Ê≥ïËß£ÊûêÂíåÈ¢ÑÂ§ÑÁêÜMySQL ÈÄöËøáÂÖ≥ÈîÆÂ≠óÂ∞Ü SQL ËØ≠Âè•ËøõË°åËß£ÊûêÔºåÂπ∂ÁîüÊàê‰∏ÄÈ¢óÂØπÂ∫îÁöÑËß£ÊûêÊ†ë„ÄÇËøô‰∏™ËøáÁ®ãËß£ÊûêÂô®‰∏ªË¶ÅÈÄöËøáËØ≠Ê≥ïËßÑÂàôÊù•È™åËØÅÂíåËß£Êûê„ÄÇÊØîÂ¶Ç SQL ‰∏≠ÊòØÂê¶‰ΩøÁî®‰∫ÜÈîôËØØÁöÑÂÖ≥ÈîÆÂ≠óÊàñËÄÖÂÖ≥ÈîÆÂ≠óÁöÑÈ°∫Â∫èÊòØÂê¶Ê≠£Á°ÆÁ≠âÁ≠â„ÄÇÈ¢ÑÂ§ÑÁêÜÂàô‰ºöÊ†πÊçÆ MySQL ËßÑÂàôËøõ‰∏ÄÊ≠•Ê£ÄÊü•Ëß£ÊûêÊ†ëÊòØÂê¶ÂêàÊ≥ï„ÄÇÊØîÂ¶ÇÊ£ÄÊü•Ë¶ÅÊü•ËØ¢ÁöÑÊï∞ÊçÆË°®ÂíåÊï∞ÊçÆÂàóÊòØÂê¶Â≠òÂú®Á≠âÁ≠â„ÄÇ Êü•ËØ¢‰ºòÂåñÁªèËøáÂâçÈù¢ÁöÑÊ≠•È™§ÁîüÊàêÁöÑËØ≠Ê≥ïÊ†ëË¢´ËÆ§‰∏∫ÊòØÂêàÊ≥ïÁöÑ‰∫ÜÔºåÂπ∂‰∏îÁî±‰ºòÂåñÂô®Â∞ÜÂÖ∂ËΩ¨ÂåñÊàêÊü•ËØ¢ËÆ°Âàí„ÄÇÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºå‰∏ÄÊù°Êü•ËØ¢ÂèØ‰ª•ÊúâÂæàÂ§öÁßçÊâßË°åÊñπÂºèÔºåÊúÄÂêéÈÉΩËøîÂõûÁõ∏Â∫îÁöÑÁªìÊûú„ÄÇ‰ºòÂåñÂô®ÁöÑ‰ΩúÁî®Â∞±ÊòØÊâæÂà∞ËøôÂÖ∂‰∏≠ÊúÄÂ•ΩÁöÑÊâßË°åËÆ°Âàí„ÄÇ MySQL ‰ΩøÁî®Âü∫‰∫éÊàêÊú¨ÁöÑ‰ºòÂåñÂô®ÔºåÂÆÉÂ∞ùËØïÈ¢ÑÊµã‰∏Ä‰∏™Êü•ËØ¢‰ΩøÁî®ÊüêÁßçÊâßË°åËÆ°ÂàíÊó∂ÁöÑÊàêÊú¨ÔºåÂπ∂ÈÄâÊã©ÂÖ∂‰∏≠ÊàêÊú¨ÊúÄÂ∞èÁöÑ‰∏Ä‰∏™„ÄÇÂú® MySQL ÂèØ‰ª•ÈÄöËøáÊü•ËØ¢ÂΩìÂâç‰ºöËØùÁöÑlast_query_costÁöÑÂÄºÊù•ÂæóÂà∞ÂÖ∂ËÆ°ÁÆóÂΩìÂâçÊü•ËØ¢ÁöÑÊàêÊú¨„ÄÇ123456789mysql> select * from t_message limit 10;...ÁúÅÁï•ÁªìÊûúÈõÜmysql> show status like 'last_query_cost';+-----------------+-------------+| Variable_name | Value |+-----------------+-------------+| Last_query_cost | 6391.799000 |+-----------------+-------------+ Á§∫‰æã‰∏≠ÁöÑÁªìÊûúË°®Á§∫‰ºòÂåñÂô®ËÆ§‰∏∫Â§ßÊ¶ÇÈúÄË¶ÅÂÅö 6391 ‰∏™Êï∞ÊçÆÈ°µÁöÑÈöèÊú∫Êü•ÊâæÊâçËÉΩÂÆåÊàê‰∏äÈù¢ÁöÑÊü•ËØ¢„ÄÇËøô‰∏™ÁªìÊûúÊòØÊ†πÊçÆ‰∏Ä‰∫õÂàóÁöÑÁªüËÆ°‰ø°ÊÅØËÆ°ÁÆóÂæóÊù•ÁöÑÔºåËøô‰∫õÁªüËÆ°‰ø°ÊÅØÂåÖÊã¨ÔºöÊØèÂº†Ë°®ÊàñËÄÖÁ¥¢ÂºïÁöÑÈ°µÈù¢‰∏™Êï∞„ÄÅÁ¥¢ÂºïÁöÑÂü∫Êï∞„ÄÅÁ¥¢ÂºïÂíåÊï∞ÊçÆË°åÁöÑÈïøÂ∫¶„ÄÅÁ¥¢ÂºïÁöÑÂàÜÂ∏ÉÊÉÖÂÜµÁ≠âÁ≠â„ÄÇ ÊúâÈùûÂ∏∏Â§öÁöÑÂéüÂõ†‰ºöÂØºËá¥ MySQL ÈÄâÊã©ÈîôËØØÁöÑÊâßË°åËÆ°ÂàíÔºåÊØîÂ¶ÇÁªüËÆ°‰ø°ÊÅØ‰∏çÂáÜÁ°Æ„ÄÅ‰∏ç‰ºöËÄÉËôë‰∏çÂèóÂÖ∂ÊéßÂà∂ÁöÑÊìç‰ΩúÊàêÊú¨ÔºàÁî®Êà∑Ëá™ÂÆö‰πâÂáΩÊï∞„ÄÅÂ≠òÂÇ®ËøáÁ®ãÔºâ„ÄÅMySQL ËÆ§‰∏∫ÁöÑÊúÄ‰ºòË∑üÊàë‰ª¨ÊÉ≥ÁöÑ‰∏ç‰∏ÄÊ†∑ÔºàÊàë‰ª¨Â∏åÊúõÊâßË°åÊó∂Èó¥Â∞ΩÂèØËÉΩÁü≠Ôºå‰ΩÜ MySQL Âè™ÈÄâÊã©ÂÆÉËÆ§‰∏∫ÊàêÊú¨Â∞èÁöÑÔºå‰ΩÜÊàêÊú¨Â∞èÂπ∂‰∏çÊÑèÂë≥ÁùÄÊâßË°åÊó∂Èó¥Áü≠ÔºâÁ≠âÁ≠â„ÄÇ MySQL ÁöÑÊü•ËØ¢‰ºòÂåñÂô®ÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§çÊùÇÁöÑÈÉ®‰ª∂ÔºåÂÆÉ‰ΩøÁî®‰∫ÜÈùûÂ∏∏Â§öÁöÑ‰ºòÂåñÁ≠ñÁï•Êù•ÁîüÊàê‰∏Ä‰∏™ÊúÄ‰ºòÁöÑÊâßË°åËÆ°ÂàíÔºö ÈáçÊñ∞ÂÆö‰πâË°®ÁöÑÂÖ≥ËÅîÈ°∫Â∫èÔºàÂ§öÂº†Ë°®ÂÖ≥ËÅîÊü•ËØ¢Êó∂ÔºåÂπ∂‰∏ç‰∏ÄÂÆöÊåâÁÖß SQL ‰∏≠ÊåáÂÆöÁöÑÈ°∫Â∫èËøõË°åÔºå‰ΩÜÊúâ‰∏Ä‰∫õÊäÄÂ∑ßÂèØ‰ª•ÊåáÂÆöÂÖ≥ËÅîÈ°∫Â∫èÔºâ ‰ºòÂåñMIN()ÂíåMAX()ÂáΩÊï∞ÔºàÊâæÊüêÂàóÁöÑÊúÄÂ∞èÂÄºÔºåÂ¶ÇÊûúËØ•ÂàóÊúâÁ¥¢ÂºïÔºåÂè™ÈúÄË¶ÅÊü•Êâæ B+Tree Á¥¢ÂºïÊúÄÂ∑¶Á´ØÔºåÂèç‰πãÂàôÂèØ‰ª•ÊâæÂà∞ÊúÄÂ§ßÂÄºÔºåÂÖ∑‰ΩìÂéüÁêÜËßÅ‰∏ãÊñáÔºâ ÊèêÂâçÁªàÊ≠¢Êü•ËØ¢ÔºàÊØîÂ¶ÇÔºö‰ΩøÁî® Limit Êó∂ÔºåÊü•ÊâæÂà∞Êª°Ë∂≥Êï∞ÈáèÁöÑÁªìÊûúÈõÜÂêé‰ºöÁ´ãÂç≥ÁªàÊ≠¢Êü•ËØ¢Ôºâ ‰ºòÂåñÊéíÂ∫èÔºàÂú®ËÄÅÁâàÊú¨ MySQL ‰ºö‰ΩøÁî®‰∏§Ê¨°‰º†ËæìÊéíÂ∫èÔºåÂç≥ÂÖàËØªÂèñË°åÊåáÈíàÂíåÈúÄË¶ÅÊéíÂ∫èÁöÑÂ≠óÊÆµÂú®ÂÜÖÂ≠ò‰∏≠ÂØπÂÖ∂ÊéíÂ∫èÔºåÁÑ∂ÂêéÂÜçÊ†πÊçÆÊéíÂ∫èÁªìÊûúÂéªËØªÂèñÊï∞ÊçÆË°åÔºåËÄåÊñ∞ÁâàÊú¨ÈááÁî®ÁöÑÊòØÂçïÊ¨°‰º†ËæìÊéíÂ∫èÔºå‰πüÂ∞±ÊòØ‰∏ÄÊ¨°ËØªÂèñÊâÄÊúâÁöÑÊï∞ÊçÆË°åÔºåÁÑ∂ÂêéÊ†πÊçÆÁªôÂÆöÁöÑÂàóÊéíÂ∫è„ÄÇÂØπ‰∫é I/O ÂØÜÈõÜÂûãÂ∫îÁî®ÔºåÊïàÁéá‰ºöÈ´òÂæàÂ§öÔºâ ÈöèÁùÄ MySQL ÁöÑ‰∏çÊñ≠ÂèëÂ±ïÔºå‰ºòÂåñÂô®‰ΩøÁî®ÁöÑ‰ºòÂåñÁ≠ñÁï•‰πüÂú®‰∏çÊñ≠ÁöÑËøõÂåñÔºåËøôÈáå‰ªÖ‰ªÖ‰ªãÁªçÂá†‰∏™ÈùûÂ∏∏Â∏∏Áî®‰∏îÂÆπÊòìÁêÜËß£ÁöÑ‰ºòÂåñÁ≠ñÁï•ÔºåÂÖ∂‰ªñÁöÑ‰ºòÂåñÁ≠ñÁï•ÔºåÂ§ßÂÆ∂Ëá™Ë°åÊü•ÈòÖÂêß„ÄÇ Êü•ËØ¢ÊâßË°åÂºïÊìéÂú®ÂÆåÊàêËß£ÊûêÂíå‰ºòÂåñÈò∂ÊÆµ‰ª•ÂêéÔºåMySQL ‰ºöÁîüÊàêÂØπÂ∫îÁöÑÊâßË°åËÆ°ÂàíÔºåÊü•ËØ¢ÊâßË°åÂºïÊìéÊ†πÊçÆÊâßË°åËÆ°ÂàíÁªôÂá∫ÁöÑÊåá‰ª§ÈÄêÊ≠•ÊâßË°åÂæóÂá∫ÁªìÊûú„ÄÇÊï¥‰∏™ÊâßË°åËøáÁ®ãÁöÑÂ§ßÈÉ®ÂàÜÊìç‰ΩúÂùáÊòØÈÄöËøáË∞ÉÁî®Â≠òÂÇ®ÂºïÊìéÂÆûÁé∞ÁöÑÊé•Âè£Êù•ÂÆåÊàêÔºåËøô‰∫õÊé•Âè£Ë¢´Áß∞‰∏∫handler API„ÄÇÊü•ËØ¢ËøáÁ®ã‰∏≠ÁöÑÊØè‰∏ÄÂº†Ë°®Áî±‰∏Ä‰∏™handlerÂÆû‰æãË°®Á§∫„ÄÇÂÆûÈôÖ‰∏äÔºåMySQL Âú®Êü•ËØ¢‰ºòÂåñÈò∂ÊÆµÂ∞±‰∏∫ÊØè‰∏ÄÂº†Ë°®ÂàõÂª∫‰∫Ü‰∏Ä‰∏™handlerÂÆû‰æãÔºå‰ºòÂåñÂô®ÂèØ‰ª•Ê†πÊçÆËøô‰∫õÂÆû‰æãÁöÑÊé•Âè£Êù•Ëé∑ÂèñË°®ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÂåÖÊã¨Ë°®ÁöÑÊâÄÊúâÂàóÂêç„ÄÅÁ¥¢ÂºïÁªüËÆ°‰ø°ÊÅØÁ≠â„ÄÇÂ≠òÂÇ®ÂºïÊìéÊé•Âè£Êèê‰æõ‰∫ÜÈùûÂ∏∏‰∏∞ÂØåÁöÑÂäüËÉΩÔºå‰ΩÜÂÖ∂Â∫ïÂ±Ç‰ªÖÊúâÂá†ÂçÅ‰∏™Êé•Âè£ÔºåËøô‰∫õÊé•Âè£ÂÉèÊê≠ÁßØÊú®‰∏ÄÊ†∑ÂÆåÊàê‰∫Ü‰∏ÄÊ¨°Êü•ËØ¢ÁöÑÂ§ßÈÉ®ÂàÜÊìç‰Ωú„ÄÇ ËøîÂõûÁªìÊûúÁªôÂÆ¢Êà∑Á´ØÊü•ËØ¢ÊâßË°åÁöÑÊúÄÂêé‰∏Ä‰∏™Èò∂ÊÆµÂ∞±ÊòØÂ∞ÜÁªìÊûúËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇÂç≥‰ΩøÊü•ËØ¢‰∏çÂà∞Êï∞ÊçÆÔºåMySQL ‰ªçÁÑ∂‰ºöËøîÂõûËøô‰∏™Êü•ËØ¢ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÊØîÂ¶ÇËØ•Êü•ËØ¢ÂΩ±ÂìçÂà∞ÁöÑË°åÊï∞‰ª•ÂèäÊâßË°åÊó∂Èó¥Á≠âÁ≠â„ÄÇ Â¶ÇÊûúÊü•ËØ¢ÁºìÂ≠òË¢´ÊâìÂºÄ‰∏îËøô‰∏™Êü•ËØ¢ÂèØ‰ª•Ë¢´ÁºìÂ≠òÔºåMySQL ‰πü‰ºöÂ∞ÜÁªìÊûúÂ≠òÊîæÂà∞ÁºìÂ≠ò‰∏≠„ÄÇ ÁªìÊûúÈõÜËøîÂõûÂÆ¢Êà∑Á´ØÊòØ‰∏Ä‰∏™Â¢ûÈáè‰∏îÈÄêÊ≠•ËøîÂõûÁöÑËøáÁ®ã„ÄÇÊúâÂèØËÉΩ MySQL Âú®ÁîüÊàêÁ¨¨‰∏ÄÊù°ÁªìÊûúÊó∂ÔºåÂ∞±ÂºÄÂßãÂêëÂÆ¢Êà∑Á´ØÈÄêÊ≠•ËøîÂõûÁªìÊûúÈõÜ‰∫Ü„ÄÇËøôÊ†∑ÊúçÂä°Á´ØÂ∞±Êó†È°ªÂ≠òÂÇ®Â§™Â§öÁªìÊûúËÄåÊ∂àËÄóËøáÂ§öÂÜÖÂ≠òÔºå‰πüÂèØ‰ª•ËÆ©ÂÆ¢Êà∑Á´ØÁ¨¨‰∏ÄÊó∂Èó¥Ëé∑ÂæóËøîÂõûÁªìÊûú„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÁªìÊûúÈõÜ‰∏≠ÁöÑÊØè‰∏ÄË°åÈÉΩ‰ºö‰ª•‰∏Ä‰∏™Êª°Ë∂≥ ‚ë† ‰∏≠ÊâÄÊèèËø∞ÁöÑÈÄö‰ø°ÂçèËÆÆÁöÑÊï∞ÊçÆÂåÖÂèëÈÄÅÔºåÂÜçÈÄöËøá TCP ÂçèËÆÆËøõË°å‰º†ËæìÔºåÂú®‰º†ËæìËøáÁ®ã‰∏≠ÔºåÂèØËÉΩÂØπ MySQL ÁöÑÊï∞ÊçÆÂåÖËøõË°åÁºìÂ≠òÁÑ∂ÂêéÊâπÈáèÂèëÈÄÅ„ÄÇ ÂõûÂ§¥ÊÄªÁªì‰∏Ä‰∏ã MySQL Êï¥‰∏™Êü•ËØ¢ÊâßË°åËøáÁ®ãÔºåÊÄªÁöÑÊù•ËØ¥ÂàÜ‰∏∫ 5 ‰∏™Ê≠•È™§Ôºö ÂÆ¢Êà∑Á´ØÂêë MySQL ÊúçÂä°Âô®ÂèëÈÄÅ‰∏ÄÊù°Êü•ËØ¢ËØ∑Ê±Ç ÊúçÂä°Âô®È¶ñÂÖàÊ£ÄÊü•Êü•ËØ¢ÁºìÂ≠òÔºåÂ¶ÇÊûúÂëΩ‰∏≠ÁºìÂ≠òÔºåÂàôÁ´ãÂàªËøîÂõûÂ≠òÂÇ®Âú®ÁºìÂ≠ò‰∏≠ÁöÑÁªìÊûú„ÄÇÂê¶ÂàôËøõÂÖ•‰∏ã‰∏ÄÈò∂ÊÆµ ÊúçÂä°Âô®ËøõË°å SQL Ëß£Êûê„ÄÅÈ¢ÑÂ§ÑÁêÜ„ÄÅÂÜçÁî±‰ºòÂåñÂô®ÁîüÊàêÂØπÂ∫îÁöÑÊâßË°åËÆ°Âàí MySQL Ê†πÊçÆÊâßË°åËÆ°ÂàíÔºåË∞ÉÁî®Â≠òÂÇ®ÂºïÊìéÁöÑ API Êù•ÊâßË°åÊü•ËØ¢ Â∞ÜÁªìÊûúËøîÂõûÁªôÂÆ¢Êà∑Á´ØÔºåÂêåÊó∂ÁºìÂ≠òÊü•ËØ¢ÁªìÊûú ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆÁúã‰∫ÜËøô‰πàÂ§öÔºå‰Ω†ÂèØËÉΩ‰ºöÊúüÂæÖÁªôÂá∫‰∏Ä‰∫õ‰ºòÂåñÊâãÊÆµÔºåÊòØÁöÑÔºå‰∏ãÈù¢‰ºö‰ªé 3 ‰∏™‰∏çÂêåÊñπÈù¢ÁªôÂá∫‰∏Ä‰∫õ‰ºòÂåñÂª∫ËÆÆ„ÄÇ‰ΩÜËØ∑Á≠âÁ≠âÔºåËøòÊúâ‰∏ÄÂè•Âø†ÂëäË¶ÅÂÖàÈÄÅÁªô‰Ω†Ôºö‰∏çË¶ÅÂê¨‰ø°‰Ω†ÁúãÂà∞ÁöÑÂÖ≥‰∫é‰ºòÂåñÁöÑ ‚ÄúÁªùÂØπÁúüÁêÜ‚ÄùÔºåÂåÖÊã¨Êú¨ÊñáÊâÄËÆ®ËÆ∫ÁöÑÂÜÖÂÆπÔºåËÄåÂ∫îËØ•ÊòØÂú®ÂÆûÈôÖÁöÑ‰∏öÂä°Âú∫ÊôØ‰∏ãÈÄöËøáÊµãËØïÊù•È™åËØÅ‰Ω†ÂÖ≥‰∫éÊâßË°åËÆ°Âàí‰ª•ÂèäÂìçÂ∫îÊó∂Èó¥ÁöÑÂÅáËÆæ„ÄÇ Scheme ËÆæËÆ°‰∏éÊï∞ÊçÆÁ±ªÂûã‰ºòÂåñ ÈÄâÊã©Êï∞ÊçÆÁ±ªÂûãÂè™Ë¶ÅÈÅµÂæ™Â∞èËÄåÁÆÄÂçïÁöÑÂéüÂàôÂ∞±Â•ΩÔºåË∂äÂ∞èÁöÑÊï∞ÊçÆÁ±ªÂûãÈÄöÂ∏∏‰ºöÊõ¥Âø´ÔºåÂç†Áî®Êõ¥Â∞ëÁöÑÁ£ÅÁõò„ÄÅÂÜÖÂ≠òÔºåÂ§ÑÁêÜÊó∂ÈúÄË¶ÅÁöÑ CPU Âë®Êúü‰πüÊõ¥Â∞ë„ÄÇË∂äÁÆÄÂçïÁöÑÊï∞ÊçÆÁ±ªÂûãÂú®ËÆ°ÁÆóÊó∂ÈúÄË¶ÅÊõ¥Â∞ëÁöÑ CPU Âë®ÊúüÔºåÊØîÂ¶ÇÔºåÊï¥ÂûãÂ∞±ÊØîÂ≠óÁ¨¶Êìç‰Ωú‰ª£‰ª∑‰ΩéÔºåÂõ†ËÄå‰ºö‰ΩøÁî®Êï¥ÂûãÊù•Â≠òÂÇ® IP Âú∞ÂùÄÔºå‰ΩøÁî®DATETIMEÊù•Â≠òÂÇ®Êó∂Èó¥ÔºåËÄå‰∏çÊòØ‰ΩøÁî®Â≠óÁ¨¶‰∏≤„ÄÇ ËøôÈáåÊÄªÁªìÂá†‰∏™ÂèØËÉΩÂÆπÊòìÁêÜËß£ÈîôËØØÁöÑÊäÄÂ∑ßÔºö ÈÄöÂ∏∏Êù•ËØ¥ÊääÂèØ‰∏∫NULLÁöÑÂàóÊîπ‰∏∫NOT NULL‰∏ç‰ºöÂØπÊÄßËÉΩÊèêÂçáÊúâÂ§öÂ∞ëÂ∏ÆÂä©ÔºåÂè™ÊòØÂ¶ÇÊûúËÆ°ÂàíÂú®Âàó‰∏äÂàõÂª∫Á¥¢ÂºïÔºåÂ∞±Â∫îËØ•Â∞ÜËØ•ÂàóËÆæÁΩÆ‰∏∫NOT NULL„ÄÇ ÂØπÊï¥Êï∞Á±ªÂûãÊåáÂÆöÂÆΩÂ∫¶ÔºåÊØîÂ¶ÇINT(11)ÔºåÊ≤°Êúâ‰ªª‰ΩïÂçµÁî®„ÄÇINT‰ΩøÁî® 32 ‰ΩçÔºà4 ‰∏™Â≠óËäÇÔºâÂ≠òÂÇ®Á©∫Èó¥ÔºåÈÇ£‰πàÂÆÉÁöÑË°®Á§∫ËåÉÂõ¥Â∑≤ÁªèÁ°ÆÂÆöÔºåÊâÄ‰ª•INT(1)ÂíåINT(20)ÂØπ‰∫éÂ≠òÂÇ®ÂíåËÆ°ÁÆóÊòØÁõ∏ÂêåÁöÑ„ÄÇ UNSIGNEDË°®Á§∫‰∏çÂÖÅËÆ∏Ë¥üÂÄºÔºåÂ§ßËá¥ÂèØ‰ª•‰ΩøÊ≠£Êï∞ÁöÑ‰∏äÈôêÊèêÈ´ò‰∏ÄÂÄç„ÄÇÊØîÂ¶ÇTINYINTÂ≠òÂÇ®ËåÉÂõ¥ÊòØ -128 ~ 127ÔºåËÄåUNSIGNED TINYINTÂ≠òÂÇ®ÁöÑËåÉÂõ¥Âç¥ÊòØ 0 - 255„ÄÇ ÈÄöÂ∏∏Êù•ËÆ≤ÔºåÊ≤°ÊúâÂ§™Â§ßÁöÑÂøÖË¶Å‰ΩøÁî®DECIMALÊï∞ÊçÆÁ±ªÂûã„ÄÇÂç≥‰ΩøÊòØÂú®ÈúÄË¶ÅÂ≠òÂÇ®Ë¥¢Âä°Êï∞ÊçÆÊó∂Ôºå‰ªçÁÑ∂ÂèØ‰ª•‰ΩøÁî®BIGINT„ÄÇÊØîÂ¶ÇÈúÄË¶ÅÁ≤æÁ°ÆÂà∞‰∏áÂàÜ‰πã‰∏ÄÔºåÈÇ£‰πàÂèØ‰ª•Â∞ÜÊï∞ÊçÆ‰πò‰ª•‰∏ÄÁôæ‰∏áÁÑ∂Âêé‰ΩøÁî®BIGINTÂ≠òÂÇ®„ÄÇËøôÊ†∑ÂèØ‰ª•ÈÅøÂÖçÊµÆÁÇπÊï∞ËÆ°ÁÆó‰∏çÂáÜÁ°ÆÂíåDECIMALÁ≤æÁ°ÆËÆ°ÁÆó‰ª£‰ª∑È´òÁöÑÈóÆÈ¢ò„ÄÇ TIMESTAMP‰ΩøÁî® 4 ‰∏™Â≠óËäÇÂ≠òÂÇ®Á©∫Èó¥ÔºåDATETIME‰ΩøÁî® 8 ‰∏™Â≠óËäÇÂ≠òÂÇ®Á©∫Èó¥„ÄÇÂõ†ËÄåÔºåTIMESTAMPÂè™ËÉΩË°®Á§∫ 1970 - 2038 Âπ¥ÔºåÊØîDATETIMEË°®Á§∫ÁöÑËåÉÂõ¥Â∞èÂæóÂ§öÔºåËÄå‰∏îTIMESTAMPÁöÑÂÄºÂõ†Êó∂Âå∫‰∏çÂêåËÄå‰∏çÂêå„ÄÇ Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÊ≤°Êúâ‰ΩøÁî®Êûö‰∏æÁ±ªÂûãÁöÑÂøÖË¶ÅÔºåÂÖ∂‰∏≠‰∏Ä‰∏™Áº∫ÁÇπÊòØÊûö‰∏æÁöÑÂ≠óÁ¨¶‰∏≤ÂàóË°®ÊòØÂõ∫ÂÆöÁöÑÔºåÊ∑ªÂä†ÂíåÂà†Èô§Â≠óÁ¨¶‰∏≤ÔºàÊûö‰∏æÈÄâÈ°πÔºâÂøÖÈ°ª‰ΩøÁî®ALTER TABLEÔºàÂ¶ÇÊûúÂè™Âè™ÊòØÂú®ÂàóË°®Êú´Â∞æËøΩÂä†ÂÖÉÁ¥†Ôºå‰∏çÈúÄË¶ÅÈáçÂª∫Ë°®Ôºâ„ÄÇ schema ÁöÑÂàó‰∏çË¶ÅÂ§™Â§ö„ÄÇÂéüÂõ†ÊòØÂ≠òÂÇ®ÂºïÊìéÁöÑ API Â∑•‰ΩúÊó∂ÈúÄË¶ÅÂú®ÊúçÂä°Âô®Â±ÇÂíåÂ≠òÂÇ®ÂºïÊìéÂ±Ç‰πãÈó¥ÈÄöËøáË°åÁºìÂÜ≤Ê†ºÂºèÊã∑Ë¥ùÊï∞ÊçÆÔºåÁÑ∂ÂêéÂú®ÊúçÂä°Âô®Â±ÇÂ∞ÜÁºìÂÜ≤ÂÜÖÂÆπËß£Á†ÅÊàêÂêÑ‰∏™ÂàóÔºåËøô‰∏™ËΩ¨Êç¢ËøáÁ®ãÁöÑ‰ª£‰ª∑ÊòØÈùûÂ∏∏È´òÁöÑ„ÄÇÂ¶ÇÊûúÂàóÂ§™Â§öËÄåÂÆûÈôÖ‰ΩøÁî®ÁöÑÂàóÂèàÂæàÂ∞ëÁöÑËØùÔºåÊúâÂèØËÉΩ‰ºöÂØºËá¥ CPU Âç†Áî®ËøáÈ´ò„ÄÇ Â§ßË°®ALTER TABLEÈùûÂ∏∏ËÄóÊó∂ÔºåMySQL ÊâßË°åÂ§ßÈÉ®ÂàÜ‰øÆÊîπË°®ÁªìÊûúÊìç‰ΩúÁöÑÊñπÊ≥ïÊòØÁî®Êñ∞ÁöÑÁªìÊûÑÂàõÂª∫‰∏Ä‰∏™Âº†Á©∫Ë°®Ôºå‰ªéÊóßË°®‰∏≠Êü•Âá∫ÊâÄÊúâÁöÑÊï∞ÊçÆÊèíÂÖ•Êñ∞Ë°®ÔºåÁÑ∂ÂêéÂÜçÂà†Èô§ÊóßË°®„ÄÇÂ∞§ÂÖ∂ÂΩìÂÜÖÂ≠ò‰∏çË∂≥ËÄåË°®ÂèàÂæàÂ§ßÔºåËÄå‰∏îËøòÊúâÂæàÂ§ßÁ¥¢ÂºïÁöÑÊÉÖÂÜµ‰∏ãÔºåËÄóÊó∂Êõ¥‰πÖ„ÄÇÂΩìÁÑ∂Êúâ‰∏Ä‰∫õÂ•áÊäÄÊ∑´Â∑ßÂèØ‰ª•Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÊúâÂÖ¥Ë∂£ÂèØËá™Ë°åÊü•ÈòÖ„ÄÇ ÂàõÂª∫È´òÊÄßËÉΩÁ¥¢ÂºïÁ¥¢ÂºïÊòØÊèêÈ´ò MySQL Êü•ËØ¢ÊÄßËÉΩÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÈÄîÂæÑÔºå‰ΩÜËøáÂ§öÁöÑÁ¥¢ÂºïÂèØËÉΩ‰ºöÂØºËá¥ËøáÈ´òÁöÑÁ£ÅÁõò‰ΩøÁî®Áéá‰ª•ÂèäËøáÈ´òÁöÑÂÜÖÂ≠òÂç†Áî®Ôºå‰ªéËÄåÂΩ±ÂìçÂ∫îÁî®Á®ãÂ∫èÁöÑÊï¥‰ΩìÊÄßËÉΩ„ÄÇÂ∫îÂΩìÂ∞ΩÈáèÈÅøÂÖç‰∫ãÂêéÊâçÊÉ≥Ëµ∑Ê∑ªÂä†Á¥¢ÂºïÔºåÂõ†‰∏∫‰∫ãÂêéÂèØËÉΩÈúÄË¶ÅÁõëÊéßÂ§ßÈáèÁöÑ SQL ÊâçËÉΩÂÆö‰ΩçÂà∞ÈóÆÈ¢òÊâÄÂú®ÔºåËÄå‰∏îÊ∑ªÂä†Á¥¢ÂºïÁöÑÊó∂Èó¥ËÇØÂÆöÊòØËøúÂ§ß‰∫éÂàùÂßãÊ∑ªÂä†Á¥¢ÂºïÊâÄÈúÄË¶ÅÁöÑÊó∂Èó¥ÔºåÂèØËßÅÁ¥¢ÂºïÁöÑÊ∑ªÂä†‰πüÊòØÈùûÂ∏∏ÊúâÊäÄÊúØÂê´ÈáèÁöÑ„ÄÇ Êé•‰∏ãÊù•Â∞ÜÂêë‰Ω†Â±ïÁ§∫‰∏ÄÁ≥ªÂàóÂàõÂª∫È´òÊÄßËÉΩÁ¥¢ÂºïÁöÑÁ≠ñÁï•Ôºå‰ª•ÂèäÊØèÊù°Á≠ñÁï•ÂÖ∂ËÉåÂêéÁöÑÂ∑•‰ΩúÂéüÁêÜ„ÄÇ‰ΩÜÂú®Ê≠§‰πãÂâçÔºåÂÖà‰∫ÜËß£‰∏éÁ¥¢ÂºïÁõ∏ÂÖ≥ÁöÑ‰∏Ä‰∫õÁÆóÊ≥ïÂíåÊï∞ÊçÆÁªìÊûÑÔºåÂ∞ÜÊúâÂä©‰∫éÊõ¥Â•ΩÁöÑÁêÜËß£ÂêéÊñáÁöÑÂÜÖÂÆπ„ÄÇ Á¥¢ÂºïÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÁªìÊûÑÂíåÁÆóÊ≥ï ÈÄöÂ∏∏Êàë‰ª¨ÊâÄËØ¥ÁöÑÁ¥¢ÂºïÊòØÊåáB-TreeÁ¥¢ÂºïÔºåÂÆÉÊòØÁõÆÂâçÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ì‰∏≠Êü•ÊâæÊï∞ÊçÆÊúÄ‰∏∫Â∏∏Áî®ÂíåÊúâÊïàÁöÑÁ¥¢ÂºïÔºåÂ§ßÂ§öÊï∞Â≠òÂÇ®ÂºïÊìéÈÉΩÊîØÊåÅËøôÁßçÁ¥¢Âºï„ÄÇ‰ΩøÁî®B-TreeËøô‰∏™ÊúØËØ≠ÔºåÊòØÂõ†‰∏∫ MySQL Âú®CREATE TABLEÊàñÂÖ∂ÂÆÉËØ≠Âè•‰∏≠‰ΩøÁî®‰∫ÜËøô‰∏™ÂÖ≥ÈîÆÂ≠óÔºå‰ΩÜÂÆûÈôÖ‰∏ä‰∏çÂêåÁöÑÂ≠òÂÇ®ÂºïÊìéÂèØËÉΩ‰ΩøÁî®‰∏çÂêåÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÊØîÂ¶Ç InnoDB Â∞±ÊòØ‰ΩøÁî®ÁöÑÊòØÂÆÉÁöÑÂèòÁßçB+Tree„ÄÇ B+Tree‰∏≠ÁöÑ B ÊòØÊåábalanceÔºåÊÑè‰∏∫Âπ≥Ë°°„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåB + Ê†ëÁ¥¢ÂºïÂπ∂‰∏çËÉΩÊâæÂà∞‰∏Ä‰∏™ÁªôÂÆöÈîÆÂÄºÁöÑÂÖ∑‰ΩìË°åÔºåÂÆÉÊâæÂà∞ÁöÑÂè™ÊòØË¢´Êü•ÊâæÊï∞ÊçÆË°åÊâÄÂú®ÁöÑÈ°µÔºåÊé•ÁùÄÊï∞ÊçÆÂ∫ì‰ºöÊääÈ°µËØªÂÖ•Âà∞ÂÜÖÂ≠òÔºåÂÜçÂú®ÂÜÖÂ≠ò‰∏≠ËøõË°åÊü•ÊâæÔºåÊúÄÂêéÂæóÂà∞Ë¶ÅÊü•ÊâæÁöÑÊï∞ÊçÆ„ÄÇ Âú®‰ªãÁªçB+TreeÂâçÔºåÂÖà‰∫ÜËß£‰∏Ä‰∏ã‰∫åÂèâÊü•ÊâæÊ†ëÔºåÂÆÉÊòØ‰∏ÄÁßçÁªèÂÖ∏ÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÂÖ∂Â∑¶Â≠êÊ†ëÁöÑÂÄºÊÄªÊòØÂ∞è‰∫éÊ†πÁöÑÂÄºÔºåÂè≥Â≠êÊ†ëÁöÑÂÄºÊÄªÊòØÂ§ß‰∫éÊ†πÁöÑÂÄºÔºåÂ¶Ç‰∏ãÂõæ ‚ë†„ÄÇÂ¶ÇÊûúË¶ÅÂú®ËøôËØæÊ†ë‰∏≠Êü•ÊâæÂÄº‰∏∫ 5 ÁöÑËÆ∞ÂΩïÔºåÂÖ∂Â§ßËá¥ÊµÅÁ®ãÔºöÂÖàÊâæÂà∞Ê†πÔºåÂÖ∂ÂÄº‰∏∫ 6ÔºåÂ§ß‰∫é 5ÔºåÊâÄ‰ª•Êü•ÊâæÂ∑¶Â≠êÊ†ëÔºåÊâæÂà∞ 3ÔºåËÄå 5 Â§ß‰∫é 3ÔºåÊé•ÁùÄÊâæ 3 ÁöÑÂè≥Â≠êÊ†ëÔºåÊÄªÂÖ±Êâæ‰∫Ü 3 Ê¨°„ÄÇÂêåÊ†∑ÁöÑÊñπÊ≥ïÔºåÂ¶ÇÊûúÊü•ÊâæÂÄº‰∏∫ 8 ÁöÑËÆ∞ÂΩïÔºå‰πüÈúÄË¶ÅÊü•Êâæ 3 Ê¨°„ÄÇÊâÄ‰ª•‰∫åÂèâÊü•ÊâæÊ†ëÁöÑÂπ≥ÂùáÊü•ÊâæÊ¨°Êï∞‰∏∫ (3 + 3 + 3 + 2 + 2 + 1) / 6 = 2.3 Ê¨°ÔºåËÄåÈ°∫Â∫èÊü•ÊâæÁöÑËØùÔºåÊü•ÊâæÂÄº‰∏∫ 2 ÁöÑËÆ∞ÂΩïÔºå‰ªÖÈúÄË¶Å 1 Ê¨°Ôºå‰ΩÜÊü•ÊâæÂÄº‰∏∫ 8 ÁöÑËÆ∞ÂΩïÂàôÈúÄË¶Å 6 Ê¨°ÔºåÊâÄ‰ª•È°∫Â∫èÊü•ÊâæÁöÑÂπ≥ÂùáÊü•ÊâæÊ¨°Êï∞‰∏∫Ôºö(1 + 2 + 3 + 4 + 5 + 6) / 6 = 3.3 Ê¨°ÔºåÂõ†Ê≠§Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ã‰∫åÂèâÊü•ÊâæÊ†ëÁöÑÂπ≥ÂùáÊü•ÊâæÈÄüÂ∫¶ÊØîÈ°∫Â∫èÊü•ÊâæË¶ÅÂø´„ÄÇ Áî±‰∫é‰∫åÂèâÊü•ÊâæÊ†ëÂèØ‰ª•‰ªªÊÑèÊûÑÈÄ†ÔºåÂêåÊ†∑ÁöÑÂÄºÔºåÂèØ‰ª•ÊûÑÈÄ†Âá∫Â¶ÇÂõæ ‚ë° ÁöÑ‰∫åÂèâÊü•ÊâæÊ†ëÔºåÊòæÁÑ∂ËøôÊ£µ‰∫åÂèâÊ†ëÁöÑÊü•ËØ¢ÊïàÁéáÂíåÈ°∫Â∫èÊü•ÊâæÂ∑Æ‰∏çÂ§ö„ÄÇËã•ÊÉ≥‰∫åÂèâÊü•ÊâæÊï∞ÁöÑÊü•ËØ¢ÊÄßËÉΩÊúÄÈ´òÔºåÈúÄË¶ÅËøôÊ£µ‰∫åÂèâÊü•ÊâæÊ†ëÊòØÂπ≥Ë°°ÁöÑÔºå‰πüÂç≥Âπ≥Ë°°‰∫åÂèâÊ†ëÔºàAVL Ê†ëÔºâ„ÄÇ Âπ≥Ë°°‰∫åÂèâÊ†ëÈ¶ñÂÖàÈúÄË¶ÅÁ¨¶Âêà‰∫åÂèâÊü•ÊâæÊ†ëÁöÑÂÆö‰πâÔºåÂÖ∂Ê¨°ÂøÖÈ°ªÊª°Ë∂≥‰ªª‰ΩïËäÇÁÇπÁöÑ‰∏§‰∏™Â≠êÊ†ëÁöÑÈ´òÂ∫¶Â∑Æ‰∏çËÉΩÂ§ß‰∫é 1„ÄÇÊòæÁÑ∂Âõæ ‚ë° ‰∏çÊª°Ë∂≥Âπ≥Ë°°‰∫åÂèâÊ†ëÁöÑÂÆö‰πâÔºåËÄåÂõæ ‚ë† ÊòØ‰∏ÄËØæÂπ≥Ë°°‰∫åÂèâÊ†ë„ÄÇÂπ≥Ë°°‰∫åÂèâÊ†ëÁöÑÊü•ÊâæÊÄßËÉΩÊòØÊØîËæÉÈ´òÁöÑÔºàÊÄßËÉΩÊúÄÂ•ΩÁöÑÊòØÊúÄ‰ºò‰∫åÂèâÊ†ëÔºâÔºåÊü•ËØ¢ÊÄßËÉΩË∂äÂ•ΩÔºåÁª¥Êä§ÁöÑÊàêÊú¨Â∞±Ë∂äÂ§ß„ÄÇÊØîÂ¶ÇÂõæ ‚ë† ÁöÑÂπ≥Ë°°‰∫åÂèâÊ†ëÔºåÂΩìÁî®Êà∑ÈúÄË¶ÅÊèíÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑÂÄº 9 ÁöÑËäÇÁÇπÊó∂ÔºåÂ∞±ÈúÄË¶ÅÂÅöÂá∫Â¶Ç‰∏ãÂèòÂä®„ÄÇ ÈÄöËøá‰∏ÄÊ¨°Â∑¶ÊóãÊìç‰ΩúÂ∞±Â∞ÜÊèíÂÖ•ÂêéÁöÑÊ†ëÈáçÊñ∞Âèò‰∏∫Âπ≥Ë°°‰∫åÂèâÊ†ëÊòØÊúÄÁÆÄÂçïÁöÑÊÉÖÂÜµ‰∫ÜÔºåÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ‰∏≠ÂèØËÉΩÈúÄË¶ÅÊóãËΩ¨Â§öÊ¨°„ÄÇËá≥Ê≠§Êàë‰ª¨ÂèØ‰ª•ËÄÉËôë‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂπ≥Ë°°‰∫åÂèâÊ†ëÁöÑÊü•ÊâæÊïàÁéáËøò‰∏çÈîôÔºåÂÆûÁé∞‰πüÈùûÂ∏∏ÁÆÄÂçïÔºåÁõ∏Â∫îÁöÑÁª¥Êä§ÊàêÊú¨ËøòËÉΩÊé•ÂèóÔºå‰∏∫‰ªÄ‰πà MySQL Á¥¢Âºï‰∏çÁõ¥Êé•‰ΩøÁî®Âπ≥Ë°°‰∫åÂèâÊ†ëÔºü ÈöèÁùÄÊï∞ÊçÆÂ∫ì‰∏≠Êï∞ÊçÆÁöÑÂ¢ûÂä†ÔºåÁ¥¢ÂºïÊú¨Ë∫´Â§ßÂ∞èÈöè‰πãÂ¢ûÂä†Ôºå‰∏çÂèØËÉΩÂÖ®ÈÉ®Â≠òÂÇ®Âú®ÂÜÖÂ≠ò‰∏≠ÔºåÂõ†Ê≠§Á¥¢ÂºïÂæÄÂæÄ‰ª•Á¥¢ÂºïÊñá‰ª∂ÁöÑÂΩ¢ÂºèÂ≠òÂÇ®ÁöÑÁ£ÅÁõò‰∏ä„ÄÇËøôÊ†∑ÁöÑËØùÔºåÁ¥¢ÂºïÊü•ÊâæËøáÁ®ã‰∏≠Â∞±Ë¶Å‰∫ßÁîüÁ£ÅÁõò I/O Ê∂àËÄóÔºåÁõ∏ÂØπ‰∫éÂÜÖÂ≠òÂ≠òÂèñÔºåI/O Â≠òÂèñÁöÑÊ∂àËÄóË¶ÅÈ´òÂá†‰∏™Êï∞ÈáèÁ∫ß„ÄÇÂèØ‰ª•ÊÉ≥Ë±°‰∏Ä‰∏ã‰∏ÄÊ£µÂá†Áôæ‰∏áËäÇÁÇπÁöÑ‰∫åÂèâÊ†ëÁöÑÊ∑±Â∫¶ÊòØÂ§öÂ∞ëÔºüÂ¶ÇÊûúÂ∞ÜËøô‰πàÂ§ßÊ∑±Â∫¶ÁöÑ‰∏ÄÈ¢ó‰∫åÂèâÊ†ëÊîæÁ£ÅÁõò‰∏äÔºåÊØèËØªÂèñ‰∏Ä‰∏™ËäÇÁÇπÔºåÈúÄË¶Å‰∏ÄÊ¨°Á£ÅÁõòÁöÑ I/O ËØªÂèñÔºåÊï¥‰∏™Êü•ÊâæÁöÑËÄóÊó∂ÊòæÁÑ∂ÊòØ‰∏çËÉΩÂ§üÊé•ÂèóÁöÑ„ÄÇÈÇ£‰πàÂ¶Ç‰ΩïÂáèÂ∞ëÊü•ÊâæËøáÁ®ã‰∏≠ÁöÑ I/O Â≠òÂèñÊ¨°Êï∞Ôºü ‰∏ÄÁßçË°å‰πãÊúâÊïàÁöÑËß£ÂÜ≥ÊñπÊ≥ïÊòØÂáèÂ∞ëÊ†ëÁöÑÊ∑±Â∫¶ÔºåÂ∞Ü‰∫åÂèâÊ†ëÂèò‰∏∫ m ÂèâÊ†ëÔºàÂ§öË∑ØÊêúÁ¥¢Ê†ëÔºâÔºåËÄåB+TreeÂ∞±ÊòØ‰∏ÄÁßçÂ§öË∑ØÊêúÁ¥¢Ê†ë„ÄÇÁêÜËß£B+TreeÊó∂ÔºåÂè™ÈúÄË¶ÅÁêÜËß£ÂÖ∂ÊúÄÈáçË¶ÅÁöÑ‰∏§‰∏™ÁâπÂæÅÂç≥ÂèØÔºöÁ¨¨‰∏ÄÔºåÊâÄÊúâÁöÑÂÖ≥ÈîÆÂ≠óÔºàÂèØ‰ª•ÁêÜËß£‰∏∫Êï∞ÊçÆÔºâÈÉΩÂ≠òÂÇ®Âú®Âè∂Â≠êËäÇÁÇπÔºàLeaf PageÔºâÔºåÈùûÂè∂Â≠êËäÇÁÇπÔºàIndex PageÔºâÂπ∂‰∏çÂ≠òÂÇ®ÁúüÊ≠£ÁöÑÊï∞ÊçÆÔºåÊâÄÊúâËÆ∞ÂΩïËäÇÁÇπÈÉΩÊòØÊåâÈîÆÂÄºÂ§ßÂ∞èÈ°∫Â∫èÂ≠òÊîæÂú®Âêå‰∏ÄÂ±ÇÂè∂Â≠êËäÇÁÇπ‰∏ä„ÄÇÂÖ∂Ê¨°ÔºåÊâÄÊúâÁöÑÂè∂Â≠êËäÇÁÇπÁî±ÊåáÈíàËøûÊé•„ÄÇÂ¶Ç‰∏ãÂõæ‰∏∫È´òÂ∫¶‰∏∫ 2 ÁöÑÁÆÄÂåñ‰∫ÜÁöÑB+Tree„ÄÇ ÊÄé‰πàÁêÜËß£Ëøô‰∏§‰∏™ÁâπÂæÅÔºüMySQL Â∞ÜÊØè‰∏™ËäÇÁÇπÁöÑÂ§ßÂ∞èËÆæÁΩÆ‰∏∫‰∏Ä‰∏™È°µÁöÑÊï¥Êï∞ÂÄçÔºàÂéüÂõ†‰∏ãÊñá‰ºö‰ªãÁªçÔºâÔºå‰πüÂ∞±ÊòØÂú®ËäÇÁÇπÁ©∫Èó¥Â§ßÂ∞è‰∏ÄÂÆöÁöÑÊÉÖÂÜµ‰∏ãÔºåÊØè‰∏™ËäÇÁÇπÂèØ‰ª•Â≠òÂÇ®Êõ¥Â§öÁöÑÂÜÖÁªìÁÇπÔºåËøôÊ†∑ÊØè‰∏™ÁªìÁÇπËÉΩÁ¥¢ÂºïÁöÑËåÉÂõ¥Êõ¥Â§ßÊõ¥Á≤æÁ°Æ„ÄÇÊâÄÊúâÁöÑÂè∂Â≠êËäÇÁÇπ‰ΩøÁî®ÊåáÈíàÈìæÊé•ÁöÑÂ•ΩÂ§ÑÊòØÂèØ‰ª•ËøõË°åÂå∫Èó¥ËÆøÈóÆÔºåÊØîÂ¶Ç‰∏äÂõæ‰∏≠ÔºåÂ¶ÇÊûúÊü•ÊâæÂ§ß‰∫é 20 ËÄåÂ∞è‰∫é 30 ÁöÑËÆ∞ÂΩïÔºåÂè™ÈúÄË¶ÅÊâæÂà∞ËäÇÁÇπ 20ÔºåÂ∞±ÂèØ‰ª•ÈÅçÂéÜÊåáÈíà‰æùÊ¨°ÊâæÂà∞ 25„ÄÅ30„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÈìæÊé•ÊåáÈíàÁöÑËØùÔºåÂ∞±Êó†Ê≥ïËøõË°åÂå∫Èó¥Êü•Êâæ„ÄÇËøô‰πüÊòØ MySQL ‰ΩøÁî®B+Tree‰Ωú‰∏∫Á¥¢ÂºïÂ≠òÂÇ®ÁªìÊûÑÁöÑÈáçË¶ÅÂéüÂõ†„ÄÇ MySQL ‰∏∫‰ΩïÂ∞ÜËäÇÁÇπÂ§ßÂ∞èËÆæÁΩÆ‰∏∫È°µÁöÑÊï¥Êï∞ÂÄçÔºåËøôÂ∞±ÈúÄË¶ÅÁêÜËß£Á£ÅÁõòÁöÑÂ≠òÂÇ®ÂéüÁêÜ„ÄÇÁ£ÅÁõòÊú¨Ë∫´Â≠òÂèñÂ∞±ÊØî‰∏ªÂ≠òÊÖ¢ÂæàÂ§öÔºåÂú®Âä†‰∏äÊú∫Ê¢∞ËøêÂä®ÊçüËÄóÔºàÁâπÂà´ÊòØÊôÆÈÄöÁöÑÊú∫Ê¢∞Á°¨ÁõòÔºâÔºåÁ£ÅÁõòÁöÑÂ≠òÂèñÈÄüÂ∫¶ÂæÄÂæÄÊòØ‰∏ªÂ≠òÁöÑÂá†Áôæ‰∏áÂàÜ‰πã‰∏ÄÔºå‰∏∫‰∫ÜÂ∞ΩÈáèÂáèÂ∞ëÁ£ÅÁõò I/OÔºåÁ£ÅÁõòÂæÄÂæÄ‰∏çÊòØ‰∏•Ê†ºÊåâÈúÄËØªÂèñÔºåËÄåÊòØÊØèÊ¨°ÈÉΩ‰ºöÈ¢ÑËØªÔºåÂç≥‰ΩøÂè™ÈúÄË¶Å‰∏Ä‰∏™Â≠óËäÇÔºåÁ£ÅÁõò‰πü‰ºö‰ªéËøô‰∏™‰ΩçÁΩÆÂºÄÂßãÔºåÈ°∫Â∫èÂêëÂêéËØªÂèñ‰∏ÄÂÆöÈïøÂ∫¶ÁöÑÊï∞ÊçÆÊîæÂÖ•ÂÜÖÂ≠òÔºåÈ¢ÑËØªÁöÑÈïøÂ∫¶‰∏ÄËà¨‰∏∫È°µÁöÑÊï¥Êï∞ÂÄç„ÄÇ È°µÊòØËÆ°ÁÆóÊú∫ÁÆ°ÁêÜÂ≠òÂÇ®Âô®ÁöÑÈÄªËæëÂùóÔºåÁ°¨‰ª∂Âèä OS ÂæÄÂæÄÂ∞Ü‰∏ªÂ≠òÂíåÁ£ÅÁõòÂ≠òÂÇ®Âå∫ÂàÜÂâ≤‰∏∫ËøûÁª≠ÁöÑÂ§ßÂ∞èÁõ∏Á≠âÁöÑÂùóÔºåÊØè‰∏™Â≠òÂÇ®ÂùóÁß∞‰∏∫‰∏ÄÈ°µÔºàËÆ∏Â§ö OS ‰∏≠ÔºåÈ°µÁöÑÂ§ßÂ∞èÈÄöÂ∏∏‰∏∫ 4KÔºâ„ÄÇ‰∏ªÂ≠òÂíåÁ£ÅÁõò‰ª•È°µ‰∏∫Âçï‰Ωç‰∫§Êç¢Êï∞ÊçÆ„ÄÇÂΩìÁ®ãÂ∫èË¶ÅËØªÂèñÁöÑÊï∞ÊçÆ‰∏çÂú®‰∏ªÂ≠ò‰∏≠Êó∂Ôºå‰ºöËß¶Âèë‰∏Ä‰∏™Áº∫È°µÂºÇÂ∏∏ÔºåÊ≠§Êó∂Á≥ªÁªü‰ºöÂêëÁ£ÅÁõòÂèëÂá∫ËØªÁõò‰ø°Âè∑ÔºåÁ£ÅÁõò‰ºöÊâæÂà∞Êï∞ÊçÆÁöÑËµ∑Âßã‰ΩçÁΩÆÂπ∂ÂêëÂêéËøûÁª≠ËØªÂèñ‰∏ÄÈ°µÊàñÂá†È°µËΩΩÂÖ•ÂÜÖÂ≠ò‰∏≠ÔºåÁÑ∂Âêé‰∏ÄËµ∑ËøîÂõûÔºåÁ®ãÂ∫èÁªßÁª≠ËøêË°å„ÄÇ MySQL Â∑ßÂ¶ôÂà©Áî®‰∫ÜÁ£ÅÁõòÈ¢ÑËØªÂéüÁêÜÔºåÂ∞Ü‰∏Ä‰∏™ËäÇÁÇπÁöÑÂ§ßÂ∞èËÆæ‰∏∫Á≠â‰∫é‰∏Ä‰∏™È°µÔºåËøôÊ†∑ÊØè‰∏™ËäÇÁÇπÂè™ÈúÄË¶Å‰∏ÄÊ¨° I/O Â∞±ÂèØ‰ª•ÂÆåÂÖ®ËΩΩÂÖ•„ÄÇ‰∏∫‰∫ÜËææÂà∞Ëøô‰∏™ÁõÆÁöÑÔºåÊØèÊ¨°Êñ∞Âª∫ËäÇÁÇπÊó∂ÔºåÁõ¥Êé•Áî≥ËØ∑‰∏Ä‰∏™È°µÁöÑÁ©∫Èó¥ÔºåËøôÊ†∑Â∞±‰øùËØÅ‰∏Ä‰∏™ËäÇÁÇπÁâ©ÁêÜ‰∏ä‰πüÂ≠òÂÇ®Âú®‰∏Ä‰∏™È°µÈáåÔºåÂä†‰πãËÆ°ÁÆóÊú∫Â≠òÂÇ®ÂàÜÈÖçÈÉΩÊòØÊåâÈ°µÂØπÈΩêÁöÑÔºåÂ∞±ÂÆûÁé∞‰∫ÜËØªÂèñ‰∏Ä‰∏™ËäÇÁÇπÂè™ÈúÄ‰∏ÄÊ¨° I/O„ÄÇÂÅáËÆæB+TreeÁöÑÈ´òÂ∫¶‰∏∫ hÔºå‰∏ÄÊ¨°Ê£ÄÁ¥¢ÊúÄÂ§öÈúÄË¶Åh-1Ê¨° I/OÔºàÊ†πËäÇÁÇπÂ∏∏È©ªÂÜÖÂ≠òÔºâÔºåÂ§çÊùÇÂ∫¶ O(h) = O(logmN)„ÄÇÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ‰∏≠ÔºåM ÈÄöÂ∏∏ËæÉÂ§ßÔºåÂ∏∏Â∏∏Ë∂ÖËøá 100ÔºåÂõ†Ê≠§Ê†ëÁöÑÈ´òÂ∫¶‰∏ÄËà¨ÈÉΩÊØîËæÉÂ∞èÔºåÈÄöÂ∏∏‰∏çË∂ÖËøá 3„ÄÇ ÊúÄÂêéÁÆÄÂçï‰∫ÜËß£‰∏ãB+TreeËäÇÁÇπÁöÑÊìç‰ΩúÔºåÂú®Êï¥‰Ωì‰∏äÂØπÁ¥¢ÂºïÁöÑÁª¥Êä§Êúâ‰∏Ä‰∏™Â§ßÊ¶ÇÁöÑ‰∫ÜËß£ÔºåËôΩÁÑ∂Á¥¢ÂºïÂèØ‰ª•Â§ßÂ§ßÊèêÈ´òÊü•ËØ¢ÊïàÁéáÔºå‰ΩÜÁª¥Êä§Á¥¢Âºï‰ªçË¶ÅËä±Ë¥πÂæàÂ§ßÁöÑ‰ª£‰ª∑ÔºåÂõ†Ê≠§ÂêàÁêÜÁöÑÂàõÂª∫Á¥¢Âºï‰πüÂ∞±Â∞§‰∏∫ÈáçË¶Å„ÄÇ ‰ªç‰ª•‰∏äÈù¢ÁöÑÊ†ë‰∏∫‰æãÔºåÊàë‰ª¨ÂÅáËÆæÊØè‰∏™ËäÇÁÇπÂè™ËÉΩÂ≠òÂÇ® 4 ‰∏™ÂÜÖËäÇÁÇπ„ÄÇÈ¶ñÂÖàË¶ÅÊèíÂÖ•Á¨¨‰∏Ä‰∏™ËäÇÁÇπ 28ÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ Êé•ÁùÄÊèíÂÖ•‰∏ã‰∏Ä‰∏™ËäÇÁÇπ 70ÔºåÂú® Index Page ‰∏≠Êü•ËØ¢ÂêéÂæóÁü•Â∫îËØ•ÊèíÂÖ•Âà∞ 50 - 70 ‰πãÈó¥ÁöÑÂè∂Â≠êËäÇÁÇπÔºå‰ΩÜÂè∂Â≠êËäÇÁÇπÂ∑≤Êª°ÔºåËøôÊó∂ÂÄôÂ∞±ÈúÄË¶ÅËøõË°å‰πüÂàÜË£ÇÁöÑÊìç‰ΩúÔºåÂΩìÂâçÁöÑÂè∂Â≠êËäÇÁÇπËµ∑ÁÇπ‰∏∫ 50ÔºåÊâÄ‰ª•Ê†πÊçÆ‰∏≠Èó¥ÂÄºÊù•ÊãÜÂàÜÂè∂Â≠êËäÇÁÇπÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ ÊúÄÂêéÊèíÂÖ•‰∏Ä‰∏™ËäÇÁÇπ 95ÔºåËøôÊó∂ÂÄô Index Page Âíå Leaf Page ÈÉΩÊª°‰∫ÜÔºåÂ∞±ÈúÄË¶ÅÂÅö‰∏§Ê¨°ÊãÜÂàÜÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ Leaf Page ‰∏é Index Page ÊãÜÂàÜÂêéÊúÄÁªàÂΩ¢Êàê‰∫ÜËøôÊ†∑‰∏ÄÈ¢óÊ†ë„ÄÇ B+Tree‰∏∫‰∫Ü‰øùÊåÅÂπ≥Ë°°ÔºåÂØπ‰∫éÊñ∞ÊèíÂÖ•ÁöÑÂÄºÈúÄË¶ÅÂÅöÂ§ßÈáèÁöÑÊãÜÂàÜÈ°µÊìç‰ΩúÔºåËÄåÈ°µÁöÑÊãÜÂàÜÈúÄË¶Å I/O Êìç‰ΩúÔºå‰∏∫‰∫ÜÂ∞ΩÂèØËÉΩÁöÑÂáèÂ∞ëÈ°µÁöÑÊãÜÂàÜÊìç‰ΩúÔºåB+Tree‰πüÊèê‰æõ‰∫ÜÁ±ª‰ºº‰∫éÂπ≥Ë°°‰∫åÂèâÊ†ëÁöÑÊóãËΩ¨ÂäüËÉΩ„ÄÇÂΩì Leaf Page Â∑≤Êª°‰ΩÜÂÖ∂Â∑¶Âè≥ÂÖÑÂºüËäÇÁÇπÊ≤°ÊúâÊª°ÁöÑÊÉÖÂÜµ‰∏ãÔºåB+TreeÂπ∂‰∏çÊÄ•‰∫éÂéªÂÅöÊãÜÂàÜÊìç‰ΩúÔºåËÄåÊòØÂ∞ÜËÆ∞ÂΩïÁßªÂà∞ÂΩìÂâçÊâÄÂú®È°µÁöÑÂÖÑÂºüËäÇÁÇπ‰∏ä„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÂ∑¶ÂÖÑÂºü‰ºöË¢´ÂÖàÊ£ÄÊü•Áî®Êù•ÂÅöÊóãËΩ¨Êìç‰Ωú„ÄÇÂ∞±ÊØîÂ¶Ç‰∏äÈù¢Á¨¨‰∫å‰∏™Á§∫‰æãÔºåÂΩìÊèíÂÖ• 70 ÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏ç‰ºöÂéªÂÅöÈ°µÊãÜÂàÜÔºåËÄåÊòØÂ∑¶ÊóãÊìç‰Ωú„ÄÇ ÈÄöËøáÊóãËΩ¨Êìç‰ΩúÂèØ‰ª•ÊúÄÂ§ßÈôêÂ∫¶ÁöÑÂáèÂ∞ëÈ°µÂàÜË£ÇÔºå‰ªéËÄåÂáèÂ∞ëÁ¥¢ÂºïÁª¥Êä§ËøáÁ®ã‰∏≠ÁöÑÁ£ÅÁõòÁöÑ I/O Êìç‰ΩúÔºå‰πüÊèêÈ´òÁ¥¢ÂºïÁª¥Êä§ÊïàÁéá„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂà†Èô§ËäÇÁÇπË∑üÊèíÂÖ•ËäÇÁÇπÁ±ª‰ººÔºå‰ªçÁÑ∂ÈúÄË¶ÅÊóãËΩ¨ÂíåÊãÜÂàÜÊìç‰ΩúÔºåËøôÈáåÂ∞±‰∏çÂÜçËØ¥Êòé„ÄÇ È´òÊÄßËÉΩÁ≠ñÁï•ÈÄöËøá‰∏äÊñáÔºåÁõ∏‰ø°‰Ω†ÂØπB+TreeÁöÑÊï∞ÊçÆÁªìÊûÑÂ∑≤ÁªèÊúâ‰∫ÜÂ§ßËá¥ÁöÑ‰∫ÜËß£Ôºå‰ΩÜ MySQL ‰∏≠Á¥¢ÂºïÊòØÂ¶Ç‰ΩïÁªÑÁªáÊï∞ÊçÆÁöÑÂ≠òÂÇ®Âë¢Ôºü‰ª•‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁ§∫‰æãÊù•ËØ¥ÊòéÔºåÂÅáÂ¶ÇÊúâÂ¶Ç‰∏ãÊï∞ÊçÆË°®Ôºö1234567CREATE TABLE People( last_name varchar(50) not null, first_name varchar(50) not null, dob date not null, gender enum(`m`,`f`) not null, key(last_name,first_name,dob)); ÂØπ‰∫éË°®‰∏≠ÊØè‰∏ÄË°åÊï∞ÊçÆÔºåÁ¥¢Âºï‰∏≠ÂåÖÂê´‰∫Ü last_name„ÄÅfirst_name„ÄÅdob ÂàóÁöÑÂÄºÔºå‰∏ãÂõæÂ±ïÁ§∫‰∫ÜÁ¥¢ÂºïÊòØÂ¶Ç‰ΩïÁªÑÁªáÊï∞ÊçÆÂ≠òÂÇ®ÁöÑ„ÄÇ ÂèØ‰ª•ÁúãÂà∞ÔºåÁ¥¢ÂºïÈ¶ñÂÖàÊ†πÊçÆÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÊù•ÊéíÂàóÈ°∫Â∫èÔºåÂΩìÂêçÂ≠óÁõ∏ÂêåÊó∂ÔºåÂàôÊ†πÊçÆÁ¨¨‰∏â‰∏™Â≠óÊÆµÔºåÂç≥Âá∫ÁîüÊó•ÊúüÊù•ÊéíÂ∫èÔºåÊ≠£ÊòØÂõ†‰∏∫Ëøô‰∏™ÂéüÂõ†ÔºåÊâçÊúâ‰∫ÜÁ¥¢ÂºïÁöÑ ‚ÄúÊúÄÂ∑¶ÂéüÂàô‚Äù„ÄÇ MySQL ‰∏ç‰ºö‰ΩøÁî®Á¥¢ÂºïÁöÑÊÉÖÂÜµÔºöÈùûÁã¨Á´ãÁöÑÂàó ‚ÄúÁã¨Á´ãÁöÑÂàó‚Äù ÊòØÊåáÁ¥¢ÂºïÂàó‰∏çËÉΩÊòØË°®ËææÂºèÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰πü‰∏çËÉΩÊòØÂáΩÊï∞ÁöÑÂèÇÊï∞„ÄÇÊØîÂ¶ÇÔºö1select * from where id + 1 = 5 Êàë‰ª¨ÂæàÂÆπÊòìÁúãÂá∫ÂÖ∂Á≠â‰ª∑‰∫é id = 4Ôºå‰ΩÜÊòØ MySQL Êó†Ê≥ïËá™Âä®Ëß£ÊûêËøô‰∏™Ë°®ËææÂºèÔºå‰ΩøÁî®ÂáΩÊï∞ÊòØÂêåÊ†∑ÁöÑÈÅìÁêÜ„ÄÇ ÂâçÁºÄÁ¥¢ÂºïÂ¶ÇÊûúÂàóÂæàÈïøÔºåÈÄöÂ∏∏ÂèØ‰ª•Á¥¢ÂºïÂºÄÂßãÁöÑÈÉ®ÂàÜÂ≠óÁ¨¶ÔºåËøôÊ†∑ÂèØ‰ª•ÊúâÊïàËäÇÁ∫¶Á¥¢ÂºïÁ©∫Èó¥Ôºå‰ªéËÄåÊèêÈ´òÁ¥¢ÂºïÊïàÁéá„ÄÇ Â§öÂàóÁ¥¢ÂºïÂíåÁ¥¢ÂºïÈ°∫Â∫èÂú®Â§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÂú®Â§ö‰∏™Âàó‰∏äÂª∫Á´ãÁã¨Á´ãÁöÑÁ¥¢ÂºïÂπ∂‰∏çËÉΩÊèêÈ´òÊü•ËØ¢ÊÄßËÉΩ„ÄÇÁêÜÁî±ÈùûÂ∏∏ÁÆÄÂçïÔºåMySQL ‰∏çÁü•ÈÅìÈÄâÊã©Âì™‰∏™Á¥¢ÂºïÁöÑÊü•ËØ¢ÊïàÁéáÊõ¥Â•ΩÔºåÊâÄ‰ª•Âú®ËÄÅÁâàÊú¨ÔºåÊØîÂ¶Ç MySQL5.0 ‰πãÂâçÂ∞±‰ºöÈöè‰æøÈÄâÊã©‰∏Ä‰∏™ÂàóÁöÑÁ¥¢ÂºïÔºåËÄåÊñ∞ÁöÑÁâàÊú¨‰ºöÈááÁî®ÂêàÂπ∂Á¥¢ÂºïÁöÑÁ≠ñÁï•„ÄÇ‰∏æ‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºåÂú®‰∏ÄÂº†ÁîµÂΩ±ÊºîÂëòË°®‰∏≠ÔºåÂú® actor_id Âíå film_id ‰∏§‰∏™Âàó‰∏äÈÉΩÂª∫Á´ã‰∫ÜÁã¨Á´ãÁöÑÁ¥¢ÂºïÔºåÁÑ∂ÂêéÊúâÂ¶Ç‰∏ãÊü•ËØ¢Ôºö 1select film_id,actor_id from film_actor where actor_id = 1 or film_id = 1 ËÄÅÁâàÊú¨ÁöÑ MySQL ‰ºöÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™Á¥¢ÂºïÔºå‰ΩÜÊñ∞ÁâàÊú¨ÂÅöÂ¶Ç‰∏ãÁöÑ‰ºòÂåñÔºö123select film_id,actor_id from film_actor where actor_id = 1union allselect film_id,actor_id from film_actor where film_id = 1 and actor_id 1 ÂΩìÂá∫Áé∞Â§ö‰∏™Á¥¢ÂºïÂÅöÁõ∏‰∫§Êìç‰ΩúÊó∂ÔºàÂ§ö‰∏™ AND Êù°‰ª∂ÔºâÔºåÈÄöÂ∏∏Êù•ËØ¥‰∏Ä‰∏™ÂåÖÂê´ÊâÄÊúâÁõ∏ÂÖ≥ÂàóÁöÑÁ¥¢ÂºïË¶Å‰ºò‰∫éÂ§ö‰∏™Áã¨Á´ãÁ¥¢Âºï„ÄÇ ÂΩìÂá∫Áé∞Â§ö‰∏™Á¥¢ÂºïÂÅöËÅîÂêàÊìç‰ΩúÊó∂ÔºàÂ§ö‰∏™ OR Êù°‰ª∂ÔºâÔºåÂØπÁªìÊûúÈõÜÁöÑÂêàÂπ∂„ÄÅÊéíÂ∫èÁ≠âÊìç‰ΩúÈúÄË¶ÅËÄóË¥πÂ§ßÈáèÁöÑ CPU ÂíåÂÜÖÂ≠òËµÑÊ∫êÔºåÁâπÂà´ÊòØÂΩìÂÖ∂‰∏≠ÁöÑÊüê‰∫õÁ¥¢ÂºïÁöÑÈÄâÊã©ÊÄß‰∏çÈ´òÔºåÈúÄË¶ÅËøîÂõûÂêàÂπ∂Â§ßÈáèÊï∞ÊçÆÊó∂ÔºåÊü•ËØ¢ÊàêÊú¨Êõ¥È´ò„ÄÇÊâÄ‰ª•ËøôÁßçÊÉÖÂÜµ‰∏ãËøò‰∏çÂ¶ÇËµ∞ÂÖ®Ë°®Êâ´Êèè„ÄÇ Âõ†Ê≠§explainÊó∂Â¶ÇÊûúÂèëÁé∞ÊúâÁ¥¢ÂºïÂêàÂπ∂ÔºàExtra Â≠óÊÆµÂá∫Áé∞Using unionÔºâÔºåÂ∫îËØ•Â•ΩÂ•ΩÊ£ÄÊü•‰∏Ä‰∏ãÊü•ËØ¢ÂíåË°®ÁªìÊûÑÊòØ‰∏çÊòØÂ∑≤ÁªèÊòØÊúÄ‰ºòÁöÑÔºåÂ¶ÇÊûúÊü•ËØ¢ÂíåË°®ÈÉΩÊ≤°ÊúâÈóÆÈ¢òÔºåÈÇ£Âè™ËÉΩËØ¥ÊòéÁ¥¢ÂºïÂª∫ÁöÑÈùûÂ∏∏Á≥üÁ≥ïÔºåÂ∫îÂΩìÊÖéÈáçËÄÉËôëÁ¥¢ÂºïÊòØÂê¶ÂêàÈÄÇÔºåÊúâÂèØËÉΩ‰∏Ä‰∏™ÂåÖÂê´ÊâÄÊúâÁõ∏ÂÖ≥ÂàóÁöÑÂ§öÂàóÁ¥¢ÂºïÊõ¥ÈÄÇÂêà„ÄÇ ÂâçÈù¢Êàë‰ª¨ÊèêÂà∞ËøáÁ¥¢ÂºïÂ¶Ç‰ΩïÁªÑÁªáÊï∞ÊçÆÂ≠òÂÇ®ÁöÑÔºå‰ªéÂõæ‰∏≠ÂèØ‰ª•ÁúãÂà∞Â§öÂàóÁ¥¢ÂºïÊó∂ÔºåÁ¥¢ÂºïÁöÑÈ°∫Â∫èÂØπ‰∫éÊü•ËØ¢ÊòØËá≥ÂÖ≥ÈáçË¶ÅÁöÑÔºåÂæàÊòéÊòæÂ∫îËØ•ÊääÈÄâÊã©ÊÄßÊõ¥È´òÁöÑÂ≠óÊÆµÊîæÂà∞Á¥¢ÂºïÁöÑÂâçÈù¢ÔºåËøôÊ†∑ÈÄöËøáÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÂ∞±ÂèØ‰ª•ËøáÊª§ÊéâÂ§ßÂ§öÊï∞‰∏çÁ¨¶ÂêàÊù°‰ª∂ÁöÑÊï∞ÊçÆ„ÄÇ Á¥¢ÂºïÈÄâÊã©ÊÄßÊòØÊåá‰∏çÈáçÂ§çÁöÑÁ¥¢ÂºïÂÄºÂíåÊï∞ÊçÆË°®ÁöÑÊÄªËÆ∞ÂΩïÊï∞ÁöÑÊØîÂÄºÔºåÈÄâÊã©ÊÄßË∂äÈ´òÊü•ËØ¢ÊïàÁéáË∂äÈ´òÔºåÂõ†‰∏∫ÈÄâÊã©ÊÄßË∂äÈ´òÁöÑÁ¥¢ÂºïÂèØ‰ª•ËÆ© MySQL Âú®Êü•ËØ¢Êó∂ËøáÊª§ÊéâÊõ¥Â§öÁöÑË°å„ÄÇÂîØ‰∏ÄÁ¥¢ÂºïÁöÑÈÄâÊã©ÊÄßÊòØ 1ÔºåËøôÊòØÊúÄÂ•ΩÁöÑÁ¥¢ÂºïÈÄâÊã©ÊÄßÔºåÊÄßËÉΩ‰πüÊòØÊúÄÂ•ΩÁöÑ„ÄÇ ÁêÜËß£Á¥¢ÂºïÈÄâÊã©ÊÄßÁöÑÊ¶ÇÂøµÂêéÔºåÂ∞±‰∏çÈöæÁ°ÆÂÆöÂì™‰∏™Â≠óÊÆµÁöÑÈÄâÊã©ÊÄßËæÉÈ´ò‰∫ÜÔºåÊü•‰∏Ä‰∏ãÂ∞±Áü•ÈÅì‰∫ÜÔºåÊØîÂ¶ÇÔºö1SELECT * FROM payment where staff_id = 2 and customer_id = 584 ÊòØÂ∫îËØ•ÂàõÂª∫(staff_id,customer_id)ÁöÑÁ¥¢ÂºïËøòÊòØÂ∫îËØ•È¢†ÂÄí‰∏Ä‰∏ãÈ°∫Â∫èÔºüÊâßË°å‰∏ãÈù¢ÁöÑÊü•ËØ¢ÔºåÂì™‰∏™Â≠óÊÆµÁöÑÈÄâÊã©ÊÄßÊõ¥Êé•Ëøë 1 Â∞±ÊääÂì™‰∏™Â≠óÊÆµÁ¥¢ÂºïÂâçÈù¢Â∞±Â•Ω„ÄÇ123select count(distinct staff_id)/count(*) as staff_id_selectivity, count(distinct customer_id)/count(*) as customer_id_selectivity, count(*) from payment Â§öÊï∞ÊÉÖÂÜµ‰∏ã‰ΩøÁî®Ëøô‰∏™ÂéüÂàôÊ≤°Êúâ‰ªª‰ΩïÈóÆÈ¢òÔºå‰ΩÜ‰ªçÁÑ∂Ê≥®ÊÑè‰Ω†ÁöÑÊï∞ÊçÆ‰∏≠ÊòØÂê¶Â≠òÂú®‰∏Ä‰∫õÁâπÊÆäÊÉÖÂÜµ„ÄÇ‰∏æ‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºåÊØîÂ¶ÇË¶ÅÊü•ËØ¢Êüê‰∏™Áî®Êà∑ÁªÑ‰∏ãÊúâËøá‰∫§ÊòìÁöÑÁî®Êà∑‰ø°ÊÅØÔºö1select user_id from trade where user_group_id = 1 and trade_amount > 0 MySQL ‰∏∫Ëøô‰∏™Êü•ËØ¢ÈÄâÊã©‰∫ÜÁ¥¢Âºï(user_group_id,trade_amount)ÔºåÂ¶ÇÊûú‰∏çËÄÉËôëÁâπÊÆäÊÉÖÂÜµÔºåËøôÁúãËµ∑Êù•Ê≤°Êúâ‰ªª‰ΩïÈóÆÈ¢òÔºå‰ΩÜÂÆûÈôÖÊÉÖÂÜµÊòØËøôÂº†Ë°®ÁöÑÂ§ßÂ§öÊï∞Êï∞ÊçÆÈÉΩÊòØ‰ªéËÄÅÁ≥ªÁªü‰∏≠ËøÅÁßªËøáÊù•ÁöÑÔºåÁî±‰∫éÊñ∞ËÄÅÁ≥ªÁªüÁöÑÊï∞ÊçÆ‰∏çÂÖºÂÆπÔºåÊâÄ‰ª•Â∞±ÁªôËÄÅÁ≥ªÁªüËøÅÁßªËøáÊù•ÁöÑÊï∞ÊçÆËµã‰∫à‰∫Ü‰∏Ä‰∏™ÈªòËÆ§ÁöÑÁî®Êà∑ÁªÑ„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÈÄöËøáÁ¥¢ÂºïÊâ´ÊèèÁöÑË°åÊï∞Ë∑üÂÖ®Ë°®Êâ´ÊèèÂü∫Êú¨Ê≤°‰ªÄ‰πàÂå∫Âà´ÔºåÁ¥¢Âºï‰πüÂ∞±Ëµ∑‰∏çÂà∞‰ªª‰Ωï‰ΩúÁî®„ÄÇ Êé®ÂπøÂºÄÊù•ËØ¥ÔºåÁªèÈ™åÊ≥ïÂàôÂíåÊé®ËÆ∫Âú®Â§öÊï∞ÊÉÖÂÜµ‰∏ãÊòØÊúâÁî®ÁöÑÔºåÂèØ‰ª•ÊåáÂØºÊàë‰ª¨ÂºÄÂèëÂíåËÆæËÆ°Ôºå‰ΩÜÂÆûÈôÖÊÉÖÂÜµÂæÄÂæÄ‰ºöÊõ¥Â§çÊùÇÔºåÂÆûÈôÖ‰∏öÂä°Âú∫ÊôØ‰∏ãÁöÑÊüê‰∫õÁâπÊÆäÊÉÖÂÜµÂèØËÉΩ‰ºöÊëßÊØÅ‰Ω†ÁöÑÊï¥‰∏™ËÆæËÆ°„ÄÇ ÈÅøÂÖçÂ§ö‰∏™ËåÉÂõ¥Êù°‰ª∂ ÂÆûÈôÖÂºÄÂèë‰∏≠ÔºåÊàë‰ª¨‰ºöÁªèÂ∏∏‰ΩøÁî®Â§ö‰∏™ËåÉÂõ¥Êù°‰ª∂ÔºåÊØîÂ¶ÇÊÉ≥Êü•ËØ¢Êüê‰∏™Êó∂Èó¥ÊÆµÂÜÖÁôªÂΩïËøáÁöÑÁî®Êà∑Ôºö1select user.* from user where login_time > '2017-04-01' and age between 18 and 30; Ëøô‰∏™Êü•ËØ¢Êúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºöÂÆÉÊúâ‰∏§‰∏™ËåÉÂõ¥Êù°‰ª∂Ôºålogin_time ÂàóÂíå age ÂàóÔºåMySQL ÂèØ‰ª•‰ΩøÁî® login_time ÂàóÁöÑÁ¥¢ÂºïÊàñËÄÖ age ÂàóÁöÑÁ¥¢ÂºïÔºå‰ΩÜÊó†Ê≥ïÂêåÊó∂‰ΩøÁî®ÂÆÉ‰ª¨„ÄÇ Ë¶ÜÁõñÁ¥¢Âºï Â¶ÇÊûú‰∏Ä‰∏™Á¥¢ÂºïÂåÖÂê´ÊàñËÄÖËØ¥Ë¶ÜÁõñÊâÄÊúâÈúÄË¶ÅÊü•ËØ¢ÁöÑÂ≠óÊÆµÁöÑÂÄºÔºåÈÇ£‰πàÂ∞±Ê≤°ÊúâÂøÖË¶ÅÂÜçÂõûË°®Êü•ËØ¢ÔºåËøôÂ∞±Áß∞‰∏∫Ë¶ÜÁõñÁ¥¢Âºï„ÄÇË¶ÜÁõñÁ¥¢ÂºïÊòØÈùûÂ∏∏ÊúâÁî®ÁöÑÂ∑•ÂÖ∑ÔºåÂèØ‰ª•ÊûÅÂ§ßÁöÑÊèêÈ´òÊÄßËÉΩÔºåÂõ†‰∏∫Êü•ËØ¢Âè™ÈúÄË¶ÅÊâ´ÊèèÁ¥¢Âºï‰ºöÂ∏¶Êù•ËÆ∏Â§öÂ•ΩÂ§ÑÔºö Á¥¢ÂºïÊù°ÁõÆËøúÂ∞è‰∫éÊï∞ÊçÆË°åÂ§ßÂ∞èÔºåÂ¶ÇÊûúÂè™ËØªÂèñÁ¥¢ÂºïÔºåÊûÅÂ§ßÂáèÂ∞ëÊï∞ÊçÆËÆøÈóÆÈáè Á¥¢ÂºïÊòØÊúâÊåâÁÖßÂàóÂÄºÈ°∫Â∫èÂ≠òÂÇ®ÁöÑÔºåÂØπ‰∫é I/O ÂØÜÈõÜÂûãÁöÑËåÉÂõ¥Êü•ËØ¢Ë¶ÅÊØîÈöèÊú∫‰ªéÁ£ÅÁõòËØªÂèñÊØè‰∏ÄË°åÊï∞ÊçÆÁöÑ IO Ë¶ÅÂ∞ëÁöÑÂ§ö ‰ΩøÁî®Á¥¢ÂºïÊâ´ÊèèÊù•ÊéíÂ∫è MySQL Êúâ‰∏§ÁßçÊñπÂºèÂèØ‰ª•Áîü‰∫ßÊúâÂ∫èÁöÑÁªìÊûúÈõÜÔºåÂÖ∂‰∏ÄÊòØÂØπÁªìÊûúÈõÜËøõË°åÊéíÂ∫èÁöÑÊìç‰ΩúÔºåÂÖ∂‰∫åÊòØÊåâÁÖßÁ¥¢ÂºïÈ°∫Â∫èÊâ´ÊèèÂæóÂá∫ÁöÑÁªìÊûúËá™ÁÑ∂ÊòØÊúâÂ∫èÁöÑ„ÄÇÂ¶ÇÊûú explain ÁöÑÁªìÊûú‰∏≠typeÂàóÁöÑÂÄº‰∏∫indexË°®Á§∫‰ΩøÁî®‰∫ÜÁ¥¢ÂºïÊâ´ÊèèÊù•ÂÅöÊéíÂ∫è„ÄÇ Êâ´ÊèèÁ¥¢ÂºïÊú¨Ë∫´ÂæàÂø´ÔºåÂõ†‰∏∫Âè™ÈúÄË¶Å‰ªé‰∏ÄÊù°Á¥¢ÂºïËÆ∞ÂΩïÁßªÂä®Âà∞Áõ∏ÈÇªÁöÑ‰∏ã‰∏ÄÊù°ËÆ∞ÂΩï„ÄÇ‰ΩÜÂ¶ÇÊûúÁ¥¢ÂºïÊú¨Ë∫´‰∏çËÉΩË¶ÜÁõñÊâÄÊúâÈúÄË¶ÅÊü•ËØ¢ÁöÑÂàóÔºåÈÇ£‰πàÂ∞±‰∏çÂæó‰∏çÊØèÊâ´Êèè‰∏ÄÊù°Á¥¢ÂºïËÆ∞ÂΩïÂ∞±ÂõûË°®Êü•ËØ¢‰∏ÄÊ¨°ÂØπÂ∫îÁöÑË°å„ÄÇËøô‰∏™ËØªÂèñÊìç‰ΩúÂü∫Êú¨‰∏äÊòØÈöèÊú∫ I/OÔºåÂõ†Ê≠§ÊåâÁÖßÁ¥¢ÂºïÈ°∫Â∫èËØªÂèñÊï∞ÊçÆÁöÑÈÄüÂ∫¶ÈÄöÂ∏∏Ë¶ÅÊØîÈ°∫Â∫èÂú∞ÂÖ®Ë°®Êâ´ÊèèË¶ÅÊÖ¢„ÄÇ Âú®ËÆæËÆ°Á¥¢ÂºïÊó∂ÔºåÂ¶ÇÊûú‰∏Ä‰∏™Á¥¢ÂºïÊó¢ËÉΩÂ§üÊª°Ë∂≥ÊéíÂ∫èÔºåÂèàÊª°Ë∂≥Êü•ËØ¢ÔºåÊòØÊúÄÂ•ΩÁöÑ„ÄÇ Âè™ÊúâÂΩìÁ¥¢ÂºïÁöÑÂàóÈ°∫Â∫èÂíåORDER BYÂ≠êÂè•ÁöÑÈ°∫Â∫èÂÆåÂÖ®‰∏ÄËá¥ÔºåÂπ∂‰∏îÊâÄÊúâÂàóÁöÑÊéíÂ∫èÊñπÂêë‰πü‰∏ÄÊ†∑Êó∂ÔºåÊâçËÉΩÂ§ü‰ΩøÁî®Á¥¢ÂºïÊù•ÂØπÁªìÊûúÂÅöÊéíÂ∫è„ÄÇÂ¶ÇÊûúÊü•ËØ¢ÈúÄË¶ÅÂÖ≥ËÅîÂ§öÂº†Ë°®ÔºåÂàôÂè™ÊúâORDER BYÂ≠êÂè•ÂºïÁî®ÁöÑÂ≠óÊÆµÂÖ®ÈÉ®‰∏∫Á¨¨‰∏ÄÂº†Ë°®Êó∂ÔºåÊâçËÉΩ‰ΩøÁî®Á¥¢ÂºïÂÅöÊéíÂ∫è„ÄÇORDER BYÂ≠êÂè•ÂíåÊü•ËØ¢ÁöÑÈôêÂà∂ÊòØ‰∏ÄÊ†∑ÁöÑÔºåÈÉΩË¶ÅÊª°Ë∂≥ÊúÄÂ∑¶ÂâçÁºÄÁöÑË¶ÅÊ±ÇÔºàÊúâ‰∏ÄÁßçÊÉÖÂÜµ‰æãÂ§ñÔºåÂ∞±ÊòØÊúÄÂ∑¶ÁöÑÂàóË¢´ÊåáÂÆö‰∏∫Â∏∏Êï∞Ôºå‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁ§∫‰æãÔºâÔºåÂÖ∂‰ªñÊÉÖÂÜµ‰∏ãÈÉΩÈúÄË¶ÅÊâßË°åÊéíÂ∫èÊìç‰ΩúÔºåËÄåÊó†Ê≥ïÂà©Áî®Á¥¢ÂºïÊéíÂ∫è„ÄÇ12-- ÊúÄÂ∑¶Âàó‰∏∫Â∏∏Êï∞ÔºåÁ¥¢ÂºïÔºö(date,staff_id,customer_id)select staff_id,customer_id from demo where date = '2015-06-01' order by staff_id,customer_id ÂÜó‰ΩôÂíåÈáçÂ§çÁ¥¢Âºï ÂÜó‰ΩôÁ¥¢ÂºïÊòØÊåáÂú®Áõ∏ÂêåÁöÑÂàó‰∏äÊåâÁÖßÁõ∏ÂêåÁöÑÈ°∫Â∫èÂàõÂª∫ÁöÑÁõ∏ÂêåÁ±ªÂûãÁöÑÁ¥¢ÂºïÔºåÂ∫îÂΩìÂ∞ΩÈáèÈÅøÂÖçËøôÁßçÁ¥¢ÂºïÔºåÂèëÁé∞ÂêéÁ´ãÂç≥Âà†Èô§„ÄÇÊØîÂ¶ÇÊúâ‰∏Ä‰∏™Á¥¢Âºï(A,B)ÔºåÂÜçÂàõÂª∫Á¥¢Âºï(A)Â∞±ÊòØÂÜó‰ΩôÁ¥¢Âºï„ÄÇÂÜó‰ΩôÁ¥¢ÂºïÁªèÂ∏∏ÂèëÁîüÂú®‰∏∫Ë°®Ê∑ªÂä†Êñ∞Á¥¢ÂºïÊó∂ÔºåÊØîÂ¶ÇÊúâ‰∫∫Êñ∞Âª∫‰∫ÜÁ¥¢Âºï(A,B)Ôºå‰ΩÜËøô‰∏™Á¥¢Âºï‰∏çÊòØÊâ©Â±ïÂ∑≤ÊúâÁöÑÁ¥¢Âºï(A)„ÄÇ Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÈÉΩÂ∫îËØ•Â∞ΩÈáèÊâ©Â±ïÂ∑≤ÊúâÁöÑÁ¥¢ÂºïËÄå‰∏çÊòØÂàõÂª∫Êñ∞Á¥¢Âºï„ÄÇ‰ΩÜÊúâÊûÅÂ∞ëÊÉÖÂÜµ‰∏ãÂá∫Áé∞ÊÄßËÉΩÊñπÈù¢ÁöÑËÄÉËôëÈúÄË¶ÅÂÜó‰ΩôÁ¥¢ÂºïÔºåÊØîÂ¶ÇÊâ©Â±ïÂ∑≤ÊúâÁ¥¢ÂºïËÄåÂØºËá¥ÂÖ∂ÂèòÂæóËøáÂ§ßÔºå‰ªéËÄåÂΩ±ÂìçÂà∞ÂÖ∂‰ªñ‰ΩøÁî®ËØ•Á¥¢ÂºïÁöÑÊü•ËØ¢„ÄÇ Âà†Èô§ÈïøÊúüÊú™‰ΩøÁî®ÁöÑÁ¥¢Âºï ÂÆöÊúüÂà†Èô§‰∏Ä‰∫õÈïøÊó∂Èó¥Êú™‰ΩøÁî®ËøáÁöÑÁ¥¢ÂºïÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â•ΩÁöÑ‰π†ÊÉØ„ÄÇ ÂÖ≥‰∫éÁ¥¢ÂºïËøô‰∏™ËØùÈ¢òÊâìÁÆóÂ∞±Ê≠§Êâì‰ΩèÔºåÊúÄÂêéË¶ÅËØ¥‰∏ÄÂè•ÔºåÁ¥¢ÂºïÂπ∂‰∏çÊÄªÊòØÊúÄÂ•ΩÁöÑÂ∑•ÂÖ∑ÔºåÂè™ÊúâÂΩìÁ¥¢ÂºïÂ∏ÆÂä©ÊèêÈ´òÊü•ËØ¢ÈÄüÂ∫¶Â∏¶Êù•ÁöÑÂ•ΩÂ§ÑÂ§ß‰∫éÂÖ∂Â∏¶Êù•ÁöÑÈ¢ùÂ§ñÂ∑•‰ΩúÊó∂ÔºåÁ¥¢ÂºïÊâçÊòØÊúâÊïàÁöÑ„ÄÇÂØπ‰∫éÈùûÂ∏∏Â∞èÁöÑË°®ÔºåÁÆÄÂçïÁöÑÂÖ®Ë°®Êâ´ÊèèÊõ¥È´òÊïà„ÄÇÂØπ‰∫é‰∏≠Âà∞Â§ßÂûãÁöÑË°®ÔºåÁ¥¢ÂºïÂ∞±ÈùûÂ∏∏ÊúâÊïà„ÄÇÂØπ‰∫éË∂ÖÂ§ßÂûãÁöÑË°®ÔºåÂª∫Á´ãÂíåÁª¥Êä§Á¥¢ÂºïÁöÑ‰ª£‰ª∑Èöè‰πãÂ¢ûÈïøÔºåËøôÊó∂ÂÄôÂÖ∂‰ªñÊäÄÊúØ‰πüËÆ∏Êõ¥ÊúâÊïàÔºåÊØîÂ¶ÇÂàÜÂå∫Ë°®„ÄÇÊúÄÂêéÁöÑÊúÄÂêéÔºåexplainÂêéÂÜçÊèêÊµãÊòØ‰∏ÄÁßçÁæéÂæ∑„ÄÇ ÁâπÂÆöÁ±ªÂûãÊü•ËØ¢‰ºòÂåñ ‰ºòÂåñ COUNT() Êü•ËØ¢ COUNT()ÂèØËÉΩÊòØË¢´Â§ßÂÆ∂ËØØËß£ÊúÄÂ§öÁöÑÂáΩÊï∞‰∫ÜÔºåÂÆÉÊúâ‰∏§Áßç‰∏çÂêåÁöÑ‰ΩúÁî®ÔºåÂÖ∂‰∏ÄÊòØÁªüËÆ°Êüê‰∏™ÂàóÂÄºÁöÑÊï∞ÈáèÔºåÂÖ∂‰∫åÊòØÁªüËÆ°Ë°åÊï∞„ÄÇÁªüËÆ°ÂàóÂÄºÊó∂ÔºåË¶ÅÊ±ÇÂàóÂÄºÊòØÈùûÁ©∫ÁöÑÔºåÂÆÉ‰∏ç‰ºöÁªüËÆ° NULL„ÄÇÂ¶ÇÊûúÁ°ÆËÆ§Êã¨Âè∑‰∏≠ÁöÑË°®ËææÂºè‰∏çÂèØËÉΩ‰∏∫Á©∫Êó∂ÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØÂú®ÁªüËÆ°Ë°åÊï∞„ÄÇÊúÄÁÆÄÂçïÁöÑÂ∞±ÊòØÂΩì‰ΩøÁî®COUNT(*)Êó∂ÔºåÂπ∂‰∏çÊòØÊàë‰ª¨ÊâÄÊÉ≥Ë±°ÁöÑÈÇ£Ê†∑Êâ©Â±ïÊàêÊâÄÊúâÁöÑÂàóÔºåÂÆûÈôÖ‰∏äÔºåÂÆÉ‰ºöÂøΩÁï•ÊâÄÊúâÁöÑÂàóËÄåÁõ¥Êé•ÁªüËÆ°Ë°åÊï∞„ÄÇ Êàë‰ª¨ÊúÄÂ∏∏ËßÅÁöÑËØØËß£‰πüÂ∞±Âú®ËøôÂÑøÔºåÂú®Êã¨Âè∑ÂÜÖÊåáÂÆö‰∫Ü‰∏ÄÂàóÂç¥Â∏åÊúõÁªüËÆ°ÁªìÊûúÊòØË°åÊï∞ÔºåËÄå‰∏îËøòÂ∏∏Â∏∏ËØØ‰ª•‰∏∫ÂâçËÄÖÁöÑÊÄßËÉΩ‰ºöÊõ¥Â•Ω„ÄÇ‰ΩÜÂÆûÈôÖÂπ∂ÈùûËøôÊ†∑ÔºåÂ¶ÇÊûúË¶ÅÁªüËÆ°Ë°åÊï∞ÔºåÁõ¥Êé•‰ΩøÁî®COUNT(*)ÔºåÊÑè‰πâÊ∏ÖÊô∞Ôºå‰∏îÊÄßËÉΩÊõ¥Â•Ω„ÄÇ ÊúâÊó∂ÂÄôÊüê‰∫õ‰∏öÂä°Âú∫ÊôØÂπ∂‰∏çÈúÄË¶ÅÂÆåÂÖ®Á≤æÁ°ÆÁöÑCOUNTÂÄºÔºåÂèØ‰ª•Áî®Ëøë‰ººÂÄºÊù•‰ª£ÊõøÔºåEXPLAIN Âá∫Êù•ÁöÑË°åÊï∞Â∞±ÊòØ‰∏Ä‰∏™‰∏çÈîôÁöÑËøë‰ººÂÄºÔºåËÄå‰∏îÊâßË°å EXPLAIN Âπ∂‰∏çÈúÄË¶ÅÁúüÊ≠£Âú∞ÂéªÊâßË°åÊü•ËØ¢ÔºåÊâÄ‰ª•ÊàêÊú¨ÈùûÂ∏∏‰Ωé„ÄÇÈÄöÂ∏∏Êù•ËØ¥ÔºåÊâßË°åCOUNT()ÈÉΩÈúÄË¶ÅÊâ´ÊèèÂ§ßÈáèÁöÑË°åÊâçËÉΩËé∑ÂèñÂà∞Á≤æÁ°ÆÁöÑÊï∞ÊçÆÔºåÂõ†Ê≠§ÂæàÈöæ‰ºòÂåñÔºåMySQL Â±ÇÈù¢ËøòËÉΩÂÅöÂæó‰πüÂ∞±Âè™ÊúâË¶ÜÁõñÁ¥¢Âºï‰∫Ü„ÄÇÂ¶ÇÊûú‰∏çËøòËÉΩËß£ÂÜ≥ÈóÆÈ¢òÔºåÂè™Êúâ‰ªéÊû∂ÊûÑÂ±ÇÈù¢Ëß£ÂÜ≥‰∫ÜÔºåÊØîÂ¶ÇÊ∑ªÂä†Ê±áÊÄªË°®ÔºåÊàñËÄÖ‰ΩøÁî® redis ËøôÊ†∑ÁöÑÂ§ñÈÉ®ÁºìÂ≠òÁ≥ªÁªü„ÄÇ ‰ºòÂåñÂÖ≥ËÅîÊü•ËØ¢ Âú®Â§ßÊï∞ÊçÆÂú∫ÊôØ‰∏ãÔºåË°®‰∏éË°®‰πãÈó¥ÈÄöËøá‰∏Ä‰∏™ÂÜó‰ΩôÂ≠óÊÆµÊù•ÂÖ≥ËÅîÔºåË¶ÅÊØîÁõ¥Êé•‰ΩøÁî®JOINÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩ„ÄÇÂ¶ÇÊûúÁ°ÆÂÆûÈúÄË¶Å‰ΩøÁî®ÂÖ≥ËÅîÊü•ËØ¢ÁöÑÊÉÖÂÜµ‰∏ãÔºåÈúÄË¶ÅÁâπÂà´Ê≥®ÊÑèÁöÑÊòØÔºö Á°Æ‰øùONÂíåUSINGÂ≠óÂè•‰∏≠ÁöÑÂàó‰∏äÊúâÁ¥¢Âºï„ÄÇÂú®ÂàõÂª∫Á¥¢ÂºïÁöÑÊó∂ÂÄôÂ∞±Ë¶ÅËÄÉËôëÂà∞ÂÖ≥ËÅîÁöÑÈ°∫Â∫è„ÄÇÂΩìË°® A ÂíåË°® B Áî®Âàó c ÂÖ≥ËÅîÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú‰ºòÂåñÂô®ÂÖ≥ËÅîÁöÑÈ°∫Â∫èÊòØ A„ÄÅBÔºåÈÇ£‰πàÂ∞±‰∏çÈúÄË¶ÅÂú® A Ë°®ÁöÑÂØπÂ∫îÂàó‰∏äÂàõÂª∫Á¥¢Âºï„ÄÇÊ≤°ÊúâÁî®Âà∞ÁöÑÁ¥¢Âºï‰ºöÂ∏¶Êù•È¢ùÂ§ñÁöÑË¥üÊãÖÔºå‰∏ÄËà¨Êù•ËØ¥ÔºåÈô§ÈùûÊúâÂÖ∂‰ªñÁêÜÁî±ÔºåÂè™ÈúÄË¶ÅÂú®ÂÖ≥ËÅîÈ°∫Â∫è‰∏≠ÁöÑÁ¨¨‰∫åÂº†Ë°®ÁöÑÁõ∏Â∫îÂàó‰∏äÂàõÂª∫Á¥¢ÂºïÔºàÂÖ∑‰ΩìÂéüÂõ†‰∏ãÊñáÂàÜÊûêÔºâ„ÄÇ Á°Æ‰øù‰ªª‰ΩïÁöÑGROUP BYÂíåORDER BY‰∏≠ÁöÑË°®ËææÂºèÂè™Ê∂âÂèäÂà∞‰∏Ä‰∏™Ë°®‰∏≠ÁöÑÂàóÔºåËøôÊ†∑ MySQL ÊâçÊúâÂèØËÉΩ‰ΩøÁî®Á¥¢ÂºïÊù•‰ºòÂåñ„ÄÇ Ë¶ÅÁêÜËß£‰ºòÂåñÂÖ≥ËÅîÊü•ËØ¢ÁöÑÁ¨¨‰∏Ä‰∏™ÊäÄÂ∑ßÔºåÂ∞±ÈúÄË¶ÅÁêÜËß£ MySQL ÊòØÂ¶Ç‰ΩïÊâßË°åÂÖ≥ËÅîÊü•ËØ¢ÁöÑ„ÄÇÂΩìÂâç MySQL ÂÖ≥ËÅîÊâßË°åÁöÑÁ≠ñÁï•ÈùûÂ∏∏ÁÆÄÂçïÔºåÂÆÉÂØπ‰ªª‰ΩïÁöÑÂÖ≥ËÅîÈÉΩÊâßË°åÂµåÂ•óÂæ™ÁéØÂÖ≥ËÅîÊìç‰ΩúÔºåÂç≥ÂÖàÂú®‰∏Ä‰∏™Ë°®‰∏≠Âæ™ÁéØÂèñÂá∫ÂçïÊù°Êï∞ÊçÆÔºåÁÑ∂ÂêéÂú®ÂµåÂ•óÂæ™ÁéØÂà∞‰∏ã‰∏Ä‰∏™Ë°®‰∏≠ÂØªÊâæÂåπÈÖçÁöÑË°åÔºå‰æùÊ¨°‰∏ãÂéªÔºåÁõ¥Âà∞ÊâæÂà∞ÊâÄÊúâË°®‰∏≠ÂåπÈÖçÁöÑË°å‰∏∫‰∏∫Ê≠¢„ÄÇÁÑ∂ÂêéÊ†πÊçÆÂêÑ‰∏™Ë°®ÂåπÈÖçÁöÑË°åÔºåËøîÂõûÊü•ËØ¢‰∏≠ÈúÄË¶ÅÁöÑÂêÑ‰∏™Âàó„ÄÇ Â§™ÊäΩË±°‰∫ÜÔºü‰ª•‰∏äÈù¢ÁöÑÁ§∫‰æãÊù•ËØ¥ÊòéÔºåÊØîÂ¶ÇÊúâËøôÊ†∑ÁöÑ‰∏Ä‰∏™Êü•ËØ¢Ôºö1SELECT A.xx,B.yy FROM A INNER JOIN B USING(c) WHERE A.xx IN (5,6) ÂÅáËÆæ MySQL ÊåâÁÖßÊü•ËØ¢‰∏≠ÁöÑÂÖ≥ËÅîÈ°∫Â∫è A„ÄÅB Êù•ËøõË°åÂÖ≥ËÅîÊìç‰ΩúÔºåÈÇ£‰πàÂèØ‰ª•Áî®‰∏ãÈù¢ÁöÑ‰º™‰ª£Á†ÅË°®Á§∫ MySQL Â¶Ç‰ΩïÂÆåÊàêËøô‰∏™Êü•ËØ¢Ôºö1234567891011outer_iterator = SELECT A.xx,A.c FROM A WHERE A.xx IN (5,6);outer_row = outer_iterator.next;while(outer_row) { inner_iterator = SELECT B.yy FROM B WHERE B.c = outer_row.c; inner_row = inner_iterator.next; while(inner_row) { output[inner_row.yy,outer_row.xx]; inner_row = inner_iterator.next; } outer_row = outer_iterator.next;} ÂèØ‰ª•ÁúãÂà∞ÔºåÊúÄÂ§ñÂ±ÇÁöÑÊü•ËØ¢ÊòØÊ†πÊçÆA.xxÂàóÊù•Êü•ËØ¢ÁöÑÔºåA.c‰∏äÂ¶ÇÊûúÊúâÁ¥¢ÂºïÁöÑËØùÔºåÊï¥‰∏™ÂÖ≥ËÅîÊü•ËØ¢‰πü‰∏ç‰ºö‰ΩøÁî®„ÄÇÂÜçÁúãÂÜÖÂ±ÇÁöÑÊü•ËØ¢ÔºåÂæàÊòéÊòæB.c‰∏äÂ¶ÇÊûúÊúâÁ¥¢ÂºïÁöÑËØùÔºåËÉΩÂ§üÂä†ÈÄüÊü•ËØ¢ÔºåÂõ†Ê≠§Âè™ÈúÄË¶ÅÂú®ÂÖ≥ËÅîÈ°∫Â∫è‰∏≠ÁöÑÁ¨¨‰∫åÂº†Ë°®ÁöÑÁõ∏Â∫îÂàó‰∏äÂàõÂª∫Á¥¢ÂºïÂç≥ÂèØ„ÄÇ ‰ºòÂåñ LIMIT ÂàÜÈ°µ ÂΩìÈúÄË¶ÅÂàÜÈ°µÊìç‰ΩúÊó∂ÔºåÈÄöÂ∏∏‰ºö‰ΩøÁî®LIMITÂä†‰∏äÂÅèÁßªÈáèÁöÑÂäûÊ≥ïÂÆûÁé∞ÔºåÂêåÊó∂Âä†‰∏äÂêàÈÄÇÁöÑORDER BYÂ≠óÂè•„ÄÇÂ¶ÇÊûúÊúâÂØπÂ∫îÁöÑÁ¥¢ÂºïÔºåÈÄöÂ∏∏ÊïàÁéá‰ºö‰∏çÈîôÔºåÂê¶ÂàôÔºåMySQL ÈúÄË¶ÅÂÅöÂ§ßÈáèÁöÑÊñá‰ª∂ÊéíÂ∫èÊìç‰Ωú„ÄÇ ‰∏Ä‰∏™Â∏∏ËßÅÁöÑÈóÆÈ¢òÊòØÂΩìÂÅèÁßªÈáèÈùûÂ∏∏Â§ßÁöÑÊó∂ÂÄôÔºåÊØîÂ¶ÇÔºöLIMIT 10000 20ËøôÊ†∑ÁöÑÊü•ËØ¢ÔºåMySQL ÈúÄË¶ÅÊü•ËØ¢ 10020 Êù°ËÆ∞ÂΩïÁÑ∂ÂêéÂè™ËøîÂõû 20 Êù°ËÆ∞ÂΩïÔºåÂâçÈù¢ÁöÑ 10000 Êù°ÈÉΩÂ∞ÜË¢´ÊäõÂºÉÔºåËøôÊ†∑ÁöÑ‰ª£‰ª∑ÈùûÂ∏∏È´ò„ÄÇ ‰ºòÂåñËøôÁßçÊü•ËØ¢‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑÂäûÊ≥ïÂ∞±ÊòØÂ∞ΩÂèØËÉΩÁöÑ‰ΩøÁî®Ë¶ÜÁõñÁ¥¢ÂºïÊâ´ÊèèÔºåËÄå‰∏çÊòØÊü•ËØ¢ÊâÄÊúâÁöÑÂàó„ÄÇÁÑ∂ÂêéÊ†πÊçÆÈúÄË¶ÅÂÅö‰∏ÄÊ¨°ÂÖ≥ËÅîÊü•ËØ¢ÂÜçËøîÂõûÊâÄÊúâÁöÑÂàó„ÄÇÂØπ‰∫éÂÅèÁßªÈáèÂæàÂ§ßÊó∂ÔºåËøôÊ†∑ÂÅöÁöÑÊïàÁéá‰ºöÊèêÂçáÈùûÂ∏∏Â§ß„ÄÇËÄÉËôë‰∏ãÈù¢ÁöÑÊü•ËØ¢Ôºö1SELECT film_id,description FROM film ORDER BY title LIMIT 50,5; Â¶ÇÊûúËøôÂº†Ë°®ÈùûÂ∏∏Â§ßÔºåÈÇ£‰πàËøô‰∏™Êü•ËØ¢ÊúÄÂ•ΩÊîπÊàê‰∏ãÈù¢ÁöÑÊ†∑Â≠êÔºö1234SELECT film.film_id,film.descriptionFROM film INNER JOIN ( SELECT film_id FROM film ORDER BY title LIMIT 50,5) AS tmp USING(film_id); ËøôÈáåÁöÑÂª∂ËøüÂÖ≥ËÅîÂ∞ÜÂ§ßÂ§ßÊèêÂçáÊü•ËØ¢ÊïàÁéáÔºåËÆ© MySQL Êâ´ÊèèÂ∞ΩÂèØËÉΩÂ∞ëÁöÑÈ°µÈù¢ÔºåËé∑ÂèñÈúÄË¶ÅËÆøÈóÆÁöÑËÆ∞ÂΩïÂêéÂú®Ê†πÊçÆÂÖ≥ËÅîÂàóÂõûÂéüË°®Êü•ËØ¢ÊâÄÈúÄË¶ÅÁöÑÂàó„ÄÇ ÊúâÊó∂ÂÄôÂ¶ÇÊûúÂèØ‰ª•‰ΩøÁî®‰π¶Á≠æËÆ∞ÂΩï‰∏äÊ¨°ÂèñÊï∞ÊçÆÁöÑ‰ΩçÁΩÆÔºåÈÇ£‰πà‰∏ãÊ¨°Â∞±ÂèØ‰ª•Áõ¥Êé•‰ªéËØ•‰π¶Á≠æËÆ∞ÂΩïÁöÑ‰ΩçÁΩÆÂºÄÂßãÊâ´ÊèèÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÈÅøÂÖç‰ΩøÁî®OFFSETÔºåÊØîÂ¶Ç‰∏ãÈù¢ÁöÑÊü•ËØ¢Ôºö123SELECT id FROM t LIMIT 10000, 10;-- Êîπ‰∏∫ÔºöSELECT id FROM t WHERE id > 10000 LIMIT 10; ÂÖ∂‰ªñ‰ºòÂåñÁöÑÂäûÊ≥ïËøòÂåÖÊã¨‰ΩøÁî®È¢ÑÂÖàËÆ°ÁÆóÁöÑÊ±áÊÄªË°®ÔºåÊàñËÄÖÂÖ≥ËÅîÂà∞‰∏Ä‰∏™ÂÜó‰ΩôË°®ÔºåÂÜó‰ΩôË°®‰∏≠Âè™ÂåÖÂê´‰∏ªÈîÆÂàóÂíåÈúÄË¶ÅÂÅöÊéíÂ∫èÁöÑÂàó„ÄÇ ‰ºòÂåñ UNIONMySQL Â§ÑÁêÜUNIONÁöÑÁ≠ñÁï•ÊòØÂÖàÂàõÂª∫‰∏¥Êó∂Ë°®ÔºåÁÑ∂ÂêéÂÜçÊääÂêÑ‰∏™Êü•ËØ¢ÁªìÊûúÊèíÂÖ•Âà∞‰∏¥Êó∂Ë°®‰∏≠ÔºåÊúÄÂêéÂÜçÊù•ÂÅöÊü•ËØ¢„ÄÇÂõ†Ê≠§ÂæàÂ§ö‰ºòÂåñÁ≠ñÁï•Âú®UNIONÊü•ËØ¢‰∏≠ÈÉΩÊ≤°ÊúâÂäûÊ≥ïÂæàÂ•ΩÁöÑÊó∂ÂÄô„ÄÇÁªèÂ∏∏ÈúÄË¶ÅÊâãÂä®Â∞ÜWHERE„ÄÅLIMIT„ÄÅORDER BYÁ≠âÂ≠óÂè• ‚Äú‰∏ãÊé®‚Äù Âà∞ÂêÑ‰∏™Â≠êÊü•ËØ¢‰∏≠Ôºå‰ª•‰æø‰ºòÂåñÂô®ÂèØ‰ª•ÂÖÖÂàÜÂà©Áî®Ëøô‰∫õÊù°‰ª∂ÂÖà‰ºòÂåñ„ÄÇ Èô§ÈùûÁ°ÆÂÆûÈúÄË¶ÅÊúçÂä°Âô®ÂéªÈáçÔºåÂê¶ÂàôÂ∞±‰∏ÄÂÆöË¶Å‰ΩøÁî®UNION ALLÔºåÂ¶ÇÊûúÊ≤°ÊúâALLÂÖ≥ÈîÆÂ≠óÔºåMySQL ‰ºöÁªô‰∏¥Êó∂Ë°®Âä†‰∏äDISTINCTÈÄâÈ°πÔºåËøô‰ºöÂØºËá¥Êï¥‰∏™‰∏¥Êó∂Ë°®ÁöÑÊï∞ÊçÆÂÅöÂîØ‰∏ÄÊÄßÊ£ÄÊü•ÔºåËøôÊ†∑ÂÅöÁöÑ‰ª£‰ª∑ÈùûÂ∏∏È´ò„ÄÇÂΩìÁÑ∂Âç≥‰Ωø‰ΩøÁî® ALL ÂÖ≥ÈîÆÂ≠óÔºåMySQL ÊÄªÊòØÂ∞ÜÁªìÊûúÊîæÂÖ•‰∏¥Êó∂Ë°®ÔºåÁÑ∂ÂêéÂÜçËØªÂá∫ÔºåÂÜçËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇËôΩÁÑ∂ÂæàÂ§öÊó∂ÂÄôÊ≤°ÊúâËøô‰∏™ÂøÖË¶ÅÔºåÊØîÂ¶ÇÊúâÊó∂ÂÄôÂèØ‰ª•Áõ¥Êé•ÊääÊØè‰∏™Â≠êÊü•ËØ¢ÁöÑÁªìÊûúËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇ ÁªìËØ≠ÁêÜËß£Êü•ËØ¢ÊòØÂ¶Ç‰ΩïÊâßË°å‰ª•ÂèäÊó∂Èó¥ÈÉΩÊ∂àËÄóÂú®Âì™‰∫õÂú∞ÊñπÔºåÂÜçÂä†‰∏ä‰∏Ä‰∫õ‰ºòÂåñËøáÁ®ãÁöÑÁü•ËØÜÔºåÂèØ‰ª•Â∏ÆÂä©Â§ßÂÆ∂Êõ¥Â•ΩÁöÑÁêÜËß£ MySQLÔºåÁêÜËß£Â∏∏ËßÅ‰ºòÂåñÊäÄÂ∑ßËÉåÂêéÁöÑÂéüÁêÜ„ÄÇÂ∏åÊúõÊú¨Êñá‰∏≠ÁöÑÂéüÁêÜ„ÄÅÁ§∫‰æãËÉΩÂ§üÂ∏ÆÂä©Â§ßÂÆ∂Êõ¥Â•ΩÁöÑÂ∞ÜÁêÜËÆ∫ÂíåÂÆûË∑µËÅîÁ≥ªËµ∑Êù•ÔºåÊõ¥Â§öÁöÑÂ∞ÜÁêÜËÆ∫Áü•ËØÜËøêÁî®Âà∞ÂÆûË∑µ‰∏≠„ÄÇ ÂÖ∂‰ªñ‰πüÊ≤°Âï•ËØ¥ÁöÑ‰∫ÜÔºåÁªôÂ§ßÂÆ∂Áïô‰∏§‰∏™ÊÄùËÄÉÈ¢òÂêßÔºåÂèØ‰ª•Âú®ËÑëË¢ãÈáåÊÉ≥ÊÉ≥Á≠îÊ°àÔºåËøô‰πüÊòØÂ§ßÂÆ∂ÁªèÂ∏∏ÊåÇÂú®Âò¥ËæπÁöÑÔºå‰ΩÜÂæàÂ∞ëÊúâ‰∫∫‰ºöÊÄùËÄÉ‰∏∫‰ªÄ‰πàÔºü ÊúâÈùûÂ∏∏Â§öÁöÑÁ®ãÂ∫èÂëòÂú®ÂàÜ‰∫´Êó∂ÈÉΩ‰ºöÊäõÂá∫ËøôÊ†∑‰∏Ä‰∏™ËßÇÁÇπÔºöÂ∞ΩÂèØËÉΩ‰∏çË¶Å‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÔºåÂ≠òÂÇ®ËøáÁ®ãÈùûÂ∏∏‰∏çÂÆπÊòìÁª¥Êä§Ôºå‰πü‰ºöÂ¢ûÂä†‰ΩøÁî®ÊàêÊú¨ÔºåÂ∫îËØ•Êää‰∏öÂä°ÈÄªËæëÊîæÂà∞ÂÆ¢Êà∑Á´Ø„ÄÇÊó¢ÁÑ∂ÂÆ¢Êà∑Á´ØÈÉΩËÉΩÂπ≤Ëøô‰∫õ‰∫ãÔºåÈÇ£‰∏∫‰ªÄ‰πàËøòË¶ÅÂ≠òÂÇ®ËøáÁ®ãÔºü JOINÊú¨Ë∫´‰πüÊå∫Êñπ‰æøÁöÑÔºåÁõ¥Êé•Êü•ËØ¢Â∞±Â•Ω‰∫ÜÔºå‰∏∫‰ªÄ‰πàËøòÈúÄË¶ÅËßÜÂõæÂë¢Ôºü ÂèÇËÄÉËµÑÊñô Áî± B-/B+Ê†ëÁúã MySQLÁ¥¢ÂºïÁªìÊûÑ MySQL ÊäÄÊúØÂÜÖÂπïÔºöInnoDB Â≠òÂÇ®ÂºïÊìé(Á¨¨ 2 Áâà) È´òÊÄßËÉΩ MySQL(Á¨¨ 3 Áâà) document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL ‰ºòÂåñ‰πã Covering Index]]></title>
    <url>%2F2019%2F03%2F29%2FCoveringIndex%2F</url>
    <content type="text"><![CDATA[‰∏∫‰ªÄ‰πàÊàëËÄÅÁà∏‰∏çÊòØÊùéÂòâËØöÔºå‰∏∫‰ªÄ‰πàÊàëÈïøÁöÑËøô‰πàÂ∏ÖÔºå‰ΩÜÊòØË¶ÅÊéâÂ§¥ÂèëÂë¢Ôºå‰Ω†‰ª¨ÈïøËøô‰πà‰∏ëÔºåÂç¥‰∏çÊéâÂ§¥ÂèëÂë¢Ôºü ÂâçË®ÄÂú®ÁΩë‰∏äÈöè‰æøÊêúÊêúÔºåÂ∞±ËÉΩÊâæÂà∞Â§ßÊääÁöÑÂÖ≥‰∫é MySQL ‰ºòÂåñÁöÑÊñáÁ´†Ôºå‰∏çËøáÈáåÈù¢ÂæàÂ§öÈÉΩ‰∏çÂáÜÁ°ÆÔºåËØ¥‰∏™Â∏∏ËßÅÁöÑÔºö1SELECT a FROM ... WHERE b = ... ‰∏ÄËà¨Êù•ËØ¥ÔºåÂæàÂ§öÊñáÁ´†‰ºöÂëäËØ´‰Ω†Á±ª‰ººËøôÊ†∑ÁöÑÊü•ËØ¢Ôºå‰∏çË¶ÅÂú® ‚Äúa‚Äù Â≠óÊÆµ‰∏äÂª∫Á´ãÁ¥¢ÂºïÔºåËÄåÂ∫îËØ•Âú® ‚Äúb‚Äù ‰∏äÂª∫Á´ãÁ¥¢Âºï„ÄÇËøôÊ†∑ÂÅöÁ°ÆÂÆû‰∏çÈîôÔºå‰ΩÜÊòØÂæàÂ§öÊó∂ÂÄôËøôÂπ∂‰∏çÊòØÊúÄ‰Ω≥ÁªìÊûú„ÄÇ‰∏∫‰ªÄ‰πàËøôÊ†∑ËØ¥ÔºüËøôËøòÂæóÂÖà‰ªéÁ¥¢ÂºïÊù•ËØ¥Ëµ∑„ÄÇ Á¥¢ÂºïMySQL ÂÆòÊñπÂØπÁ¥¢ÂºïÁöÑÂÆö‰πâ‰∏∫ÔºöÁ¥¢ÂºïÔºàIndexÔºâÊòØÂ∏ÆÂä© MySQL È´òÊïàËé∑ÂèñÊï∞ÊçÆÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇÊèêÂèñÂè•Â≠ê‰∏ªÂπ≤ÔºåÂ∞±ÂèØ‰ª•ÂæóÂà∞Á¥¢ÂºïÁöÑÊú¨Ë¥®ÔºöÁ¥¢ÂºïÊòØÊï∞ÊçÆÁªìÊûÑ„ÄÇ Âú® MySQL ‰∏≠ÔºåÁ¥¢ÂºïÂ±û‰∫éÂ≠òÂÇ®ÂºïÊìéÁ∫ßÂà´ÁöÑÊ¶ÇÂøµÔºå‰∏çÂêåÂ≠òÂÇ®ÂºïÊìéÂØπÁ¥¢ÂºïÁöÑÂÆûÁé∞ÊñπÂºèÊòØ‰∏çÂêåÁöÑÔºåÊú¨ÊñáËÆ®ËÆ∫ÁöÑ‰∏ªË¶ÅÊòØ InnoDB ÁöÑ B+Tree Á¥¢ÂºïÔºåÂÆÉÂèàÂèØ‰ª•ÂàÜ‰∏∫‰∏§Á±ªÔºö ËÅöÁ∞áÁ¥¢Âºï ÈùûËÅöÁ∞áÁ¥¢Âºï ËÅöÁ∞áÁ¥¢ÂºïÂèàÁß∞‰∏∫ËÅöÈõÜÁ¥¢ÂºïÊàñ‰∏ªÈîÆÁ¥¢ÂºïÔºåÂÆÉÂπ∂‰∏çÊòØ‰∏ÄÁßçÂçïÁã¨ÁöÑÁ¥¢ÂºïÁ±ªÂûãÔºåËÄåÊòØ‰∏ÄÁßçÊï∞ÊçÆÂ≠òÂÇ®ÊñπÂºè„ÄÇÂú® InnoDB ‰∏≠ÔºåË°®Êï∞ÊçÆÊñá‰ª∂Êú¨Ë∫´Â∞±ÊòØÊåâ B+Tree ÁªÑÁªáÁöÑ‰∏Ä‰∏™Á¥¢ÂºïÁªìÊûÑÔºåËøôÊ£µÊ†ëÁöÑÂè∂Â≠êËäÇÁÇπÁß∞‰∏∫ leaf pageÔºåÂÖ∂ data Âüü‰øùÂ≠ò‰∫ÜÂÆåÊï¥ÁöÑÊï∞ÊçÆËÆ∞ÂΩï„ÄÇ‰πüÂç≥Êàë‰ª¨ÊâÄËØ¥ÁöÑÊï∞ÊçÆË°åÂç≥Á¥¢ÂºïÔºåÁ¥¢ÂºïÂç≥Êï∞ÊçÆ„ÄÇ ÈùûËÅöÁ∞áÁ¥¢ÂºïÊòØÁõ∏ÂØπ‰∫éËÅöÁ∞áÁ¥¢ÂºïÊù•ËØ¥ÁöÑÔºåÊàë‰ª¨ÂèàÁß∞‰∏∫ËæÖÂä©Á¥¢ÂºïÊàñ‰∫åÁ∫ßÁ¥¢Âºï„ÄÇ InnoDB ÁöÑ‰∫åÁ∫ßÁ¥¢Âºï data ÂüüÂ≠òÂÇ®ÁöÑÊòØÁõ∏Â∫îËÆ∞ÂΩï‰∏ªÈîÆÁöÑÂÄºËÄå‰∏çÊòØÁâ©ÁêÜ‰ΩçÁΩÆÁöÑÊåáÈíà„ÄÇ ÂõûË°®‰∫ÜËß£‰∫Ü InnoDB Á¥¢ÂºïÁöÑÂÆûÁé∞ÊñπÂºèÔºåÊàë‰ª¨Â∞±ÂæàÂÆπÊòìÁêÜËß£ ‚ÄúÂõûË°®‚Äù Ëøô‰∏™Ê¶ÇÂøµ‰∫Ü„ÄÇ ËÅöÁ∞áÁ¥¢ÂºïËøôÁßçÂÆûÁé∞ÊñπÂºè‰ΩøÂæóÊåâ‰∏ªÈîÆÁöÑÊêúÁ¥¢ÂçÅÂàÜÈ´òÊïàÔºå‰ΩÜÊòØ‰∫åÁ∫ßÁ¥¢ÂºïÊêúÁ¥¢ÈúÄË¶ÅÊ£ÄÁ¥¢‰∏§ÈÅçÁ¥¢ÂºïÔºöÈ¶ñÂÖàÊ£ÄÁ¥¢‰∫åÁ∫ßÁ¥¢ÂºïËé∑Âæó‰∏ªÈîÆÔºåÁÑ∂ÂêéÁî®‰∏ªÈîÆÂà∞‰∏ªÁ¥¢Âºï‰∏≠Ê£ÄÁ¥¢Ëé∑ÂæóËÆ∞ÂΩï„ÄÇ ËÆ©Êàë‰ª¨ÂõûÂà∞ÂºÄÂ§¥ËØ¥ÁöÑÈÇ£‰∏™‰æãÂ≠êÔºö1SELECT a FROM ... WHERE b = ... Êàë‰ª¨ÂÖàÊù•ÂàÜÊûê‰∏Ä‰∏ãÊü•ËØ¢ÁöÑÂ§ÑÁêÜËøáÁ®ãÔºöÂú®ÊâßË°åÊü•ËØ¢Êó∂ÔºåÁ≥ªÁªü‰ºöÊü•ËØ¢ ‚Äúb‚Äù Á¥¢ÂºïËøõË°åÂÆö‰ΩçÔºåÁÑ∂ÂêéÂõûË°®Êü•ËØ¢ÈúÄË¶ÅÁöÑÊï∞ÊçÆ ‚Äúa‚ÄùÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂú®Ëøô‰∏™ËøáÁ®ã‰∏≠Â≠òÂú®‰∏§Ê¨°Êü•ËØ¢Ôºå‰∏ÄÊ¨°ÊòØÊü•ËØ¢Á¥¢ÂºïÔºåÂè¶‰∏ÄÊ¨°ÊòØÊü•ËØ¢Ë°®„ÄÇ ÈÇ£ÊúâÊ≤°ÊúâÂäûÊ≥ïÁî®‰∏ÄÊ¨°Êü•ËØ¢ÊêûÂÆöÈóÆÈ¢òÂë¢ÔºüÊúâÔºåÂ∞±ÊòØ Covering IndexÔºÅ ËØ¥Âà∞ËøôÈáå‰Ω†ÂèØËÉΩ‰ºöÊÉ≥Ëµ∑Êù• MySQL5.6 ‰∏≠ÂºïÂÖ•ÁöÑ MRRÔºàMulti-Range ReadÔºåÂ§öËåÉÂõ¥ËØªÔºâÔºåÂÆÉÊòØ‰∏ìÈó®Êù•‰ºòÂåñ‰∫åÁ∫ßÁ¥¢ÂºïÁöÑËåÉÂõ¥Êâ´ÊèèÂπ∂‰∏îÈúÄË¶ÅÂõûË°®ÁöÑÊÉÖÂÜµ„ÄÇÂÆÉÁöÑÂéüÁêÜÊòØÔºåÂ∞ÜÂ§ö‰∏™ÈúÄË¶ÅÂõûË°®ÁöÑ‰∫åÁ∫ßÁ¥¢ÂºïÊ†πÊçÆ‰∏ªÈîÆËøõË°åÊéíÂ∫èÔºåÁÑ∂Âêé‰∏ÄËµ∑ÂõûË°®ÔºåÂ∞ÜÂéüÊù•ÁöÑÂõûË°®Êó∂ËøõË°åÁöÑÈöèÊú∫ IOÔºåËΩ¨ÂèòÊàêÈ°∫Â∫è IO„ÄÇMRR ÁöÑ‰ºòÂäøÊòØÂ∞ÜÂ§ö‰∏™ÈöèÊú∫ IO ËΩ¨Êç¢ÊàêËæÉÂ∞ëÊï∞ÈáèÁöÑÈ°∫Â∫è IOÔºåÊâÄ‰ª•ÂØπ‰∫é SSD Êù•ËØ¥‰ª∑ÂÄºËøòÊòØÊúâÁöÑÔºå‰ΩÜÊòØÁõ∏ÊØîÊú∫Ê¢∞Á£ÅÁõòÊù•ËØ¥ÊÑè‰πâÂ∞è‰∏Ä‰∫õ„ÄÇ Covering IndexÊâÄË∞ì Covering IndexÔºåÂ∞±ÊòØËØ¥‰∏çÂøÖÊü•ËØ¢Ë°®Êñá‰ª∂ÔºåÂçïÈù†Êü•ËØ¢Á¥¢ÂºïÊñá‰ª∂Âç≥ÂèØÂÆåÊàê„ÄÇ‰ΩøÁî®Ë¶ÜÁõñÁ¥¢ÂºïÁöÑÂ•ΩÂ§ÑÊòØËæÖÂä©Á¥¢Âºï‰∏çÂåÖÂê´Êï¥Ë°åËÆ∞ÂΩïÁöÑÊâÄÊúâ‰ø°ÊÅØÔºåÊïÖÂÖ∂Â§ßÂ∞èË¶ÅËøúÂ∞è‰∫éËÅöÈõÜÁ¥¢ÂºïÔºåÂõ†Ê≠§ÂèØ‰ª•ÂáèÂ∞ëÂ§ßÈáèÁöÑ IO Êìç‰Ωú„ÄÇ ÂÖ∑‰ΩìÂà∞‰∏äËæπÁöÑ‰æãÂ≠ê‰∏≠Â∞±ÊòØÂª∫Á´ã‰∏Ä‰∏™Â§çÂêàÁ¥¢Âºï (b, a)ÔºåÂΩìÊü•ËØ¢ËøõË°åÊó∂ÔºåÈÄöËøáÂ§çÂêàÁ¥¢ÂºïÁöÑ ‚Äúb‚Äù ÈÉ®ÂàÜÂéªÂÆö‰ΩçÔºåËá≥‰∫éÈúÄË¶ÅÁöÑÊï∞ÊçÆ ‚Äúa‚ÄùÔºåÁ´ãÂàªÂ∞±ÂèØ‰ª•Âú®Á¥¢ÂºïÈáåÂæóÂà∞Ôºå‰ªéËÄåÁúÅÁï•‰∫ÜË°®Êü•ËØ¢ÁöÑËøáÁ®ã„ÄÇ Â¶ÇÊûú‰Ω†ÊÉ≥Âà©Áî® Covering IndexÔºåÈÇ£‰πàÂ∞±Ë¶ÅÊ≥®ÊÑè SELECT ÊñπÂºèÔºåÂè™ SELECT ÂøÖË¶ÅÁöÑÂ≠óÊÆµÔºåÂçÉ‰∏áÂà´SELECT * FROM ‚Ä¶ÔºåÂõ†‰∏∫Êàë‰ª¨‰∏çÂ§™ÂèØËÉΩÊääÊâÄÊúâÁöÑÂ≠óÊÆµ‰∏ÄËµ∑ÂÅöÁ¥¢ÂºïÔºåËôΩÁÑ∂ÂèØ‰ª•ÈÇ£Ê†∑ÂÅöÔºå‰ΩÜÈÇ£Ê†∑‰ºöËÆ©Á¥¢ÂºïÊñá‰ª∂ËøáÂ§ßÔºåÁªìÊûúÂèçÂÄí‰ºöÂºÑÂ∑ßÊàêÊãô„ÄÇ Â¶Ç‰ΩïÊâçËÉΩÁ°ÆËÆ§Êü•ËØ¢‰ΩøÁî®‰∫Ü Covering Index Âë¢ÔºüÂæàÁÆÄÂçïÔºå‰ΩøÁî® EXPLAIN Âç≥ÂèØÔºÅÂè™Ë¶ÅÂú® Extra ÈáåÂá∫Áé∞Using indexÂ∞±ËØ¥Êòé‰ΩøÁî®ÁöÑÊòØ Covering Index„ÄÇ ËøôÈáåÂÜç‰∏æ‰∏§‰∏™Ê†óÂ≠êÔºåËÆ©Â§ßÂÆ∂Âç∞Ë±°Ê∑±ÁÇπ„ÄÇ ‰æãÂ≠ê‰∏Ä Âú®ÊñáÁ´†Á≥ªÁªüÈáåÁªüËÆ°ÊÄªÊï∞ÁöÑÊó∂ÂÄôÔºå‰∏ÄËà¨ÁöÑÊü•ËØ¢ÊòØËøôÊ†∑ÁöÑÔºö1SELECT COUNT(*) FROM article WHERE category_id = ... ÂΩìÊàë‰ª¨Âú®category_idÂª∫Á´ãÁ¥¢ÂºïÂêéÔºåËøô‰∏™Êü•ËØ¢‰ΩøÁî®ÁöÑÂ∞±ÊòØ Covering Index„ÄÇ ÂèÇËÄÉÊñáÊ°£ÔºöCOUNT(*) vs COUNT(col) ‰æãÂ≠ê‰∫åÂú®ÊñáÁ´†Á≥ªÁªüÈáåÂàÜÈ°µÊòæÁ§∫ÁöÑÊó∂ÂÄôÔºå‰∏ÄËà¨ÁöÑÊü•ËØ¢ÊòØËøôÊ†∑ÁöÑÔºö1SELECT id, title, content FROM article ORDER BY created DESC LIMIT 10000, 10; ÈÄöÂ∏∏ËøôÊ†∑ÁöÑÊü•ËØ¢‰ºöÊääÁ¥¢ÂºïÂª∫Âú®createdÂ≠óÊÆµÔºàÂÖ∂‰∏≠idÊòØ‰∏ªÈîÆÔºâÔºå‰∏çËøáÂΩìLIMITÂÅèÁßªÂæàÂ§ßÊó∂ÔºåÊü•ËØ¢ÊïàÁéá‰ªçÁÑ∂Âæà‰ΩéÔºåËøôÊó∂Ëøô‰∏™Êü•ËØ¢ÊúÄÂ•ΩÊîπÊàê‰∏ãÈù¢ÁöÑÊ†∑Â≠êÔºö1234SELECT id, title, content FROM articleINNER JOIN ( SELECT id FROM article ORDER BY created DESC LIMIT 10000, 10) AS page USING(id); Ê≠§Êó∂ÔºåÂ∞±ÂèØ‰ª•Âú®Â≠êÊü•ËØ¢ÈáåÂà©Áî®‰∏ä Covering IndexÔºåÂø´ÈÄüÂÆö‰Ωç idÔºåÊü•ËØ¢ÊïàÁéáÂó∑Âó∑ÁöÑ„ÄÇ Âü∫‰∫éÊàëÁöÑÊµãËØïÊï∞ÊçÆÔºåËøô‰∏§Êù°ËØ≠Âè•ÁöÑÊü•ËØ¢ËÄóÊó∂ÂàÜÂà´ÊòØ ‚Äú0.08 Áßí‚Äù Âíå‚Äú0.01 Áßí‰ª•ÂÜÖ‚ÄùÔºå8 ÂÄçÁöÑÂ∑ÆË∑ùÂïäÔºÅ‰∏çÁî±ÂèàÊÉ≥Ëµ∑‰∫ÜÂú∞Á≤æÁöÑÁªèÂÖ∏ËØ≠ÂΩïÊó∂Èó¥Â∞±ÊòØÈáëÈí±ÔºåÊàëÁöÑÊúãÂèãÔºÅ Ë°•ÂÖÖÔºöInnoDB ÂºïÊìéÂ±ÇÊòØ‰ºöÂØπ‰∫åÁ∫ßÁ¥¢ÂºïÂÅöËá™Âä®Êâ©Â±ïÔºå‰ºòÂåñÂô®ËÉΩËØÜÂà´Âá∫Êâ©Â±ïÁöÑ‰∏ªÈîÆ„ÄÇËØ¶ÊÉÖÂèØ‰ª•ÂèÇËÄÉËøôÁØáÊñáÁ´†„ÄÇ Êàë‰ª¨ÂÜçÊù•ÁúãÁúãËøô‰∏§Êù°ËØ≠Âè•ÂàÜÂà´ÂØπÂ∫îÁöÑÊâßË°åËÆ°Âàí1234567891011121314151617mysql> EXPLAIN SELECT SQL_NO_CACHE id, title, content FROM article ORDER BY created DESC LIMIT 10000, 10;+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+| 1 | SIMPLE | article | NULL | ALL | NULL | NULL | NULL | NULL | 99210 | 100.00 | Using filesort |+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+1 row in set, 2 warnings (0.00 sec)mysql> EXPLAIN SELECT SQL_NO_CACHE id, title, content FROM article INNER JOIN ( SELECT id FROM article ORDER BY created DESC LIMIT 10000, 10 ) AS page USING(id);+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+| 1 | PRIMARY | | NULL | ALL | NULL | NULL | NULL | NULL | 10010 | 100.00 | NULL || 1 | PRIMARY | article | NULL | eq_ref | PRIMARY | PRIMARY | 4 | page.id | 1 | 100.00 | NULL || 2 | DERIVED | article | NULL | index | NULL | idx_created | 5 | NULL | 10010 | 100.00 | Backward index scan; Using index |+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+3 rows in set, 2 warnings (0.00 sec) ÈÄöËøá EXPLAIN Êàë‰ª¨ÂèØ‰ª•ÂæàÊòéÊòæÁöÑÁúãÂá∫ÔºåÁ¨¨‰∏Ä‰∏™Êü•ËØ¢Ê≤°ÊúâÁî®Âà∞Á¥¢ÂºïÔºåExtra ÈáåÊòØ ‚ÄúUsing filesort‚ÄùÔºåËøôÊòØÊàë‰ª¨Â∫îËØ•Â∞ΩÈáèÈÅøÂÖçÁöÑÊÉÖÂÜµ„ÄÇËÄåÁ¨¨‰∫å‰∏™ÁöÑ Extra ÊòØ ‚ÄúUsing index‚ÄùÔºåÊâÄ‰ª•Ëøô‰∏§ËÄÖÈó¥ÊïàÁéá‰∏äÁöÑÂ∑ÆË∑ùÂ∞±ÊòæËÄåÊòìËßÅ‰∫Ü„ÄÇ ÊÄªÁªìCovering Index Âπ∂‰∏çÊòØ‰ªÄ‰πàÂæàÈöæÁöÑÊ¶ÇÂøµÔºå‰ΩÜÊòØÊúâ‰∫õ‰∫∫Ëøò‰∏ç‰∫ÜËß£ÂÆÉÊàñÂøΩËßÜÂÆÉÁöÑ‰ª∑ÂÄºÔºåÂ∏åÊúõÊú¨ÊñáËÉΩÁªô‰Ω†Êèê‰∏™ÈÜí„ÄÇ ÂèÇËÄÉ MySQL Ë¶ÜÁõñÁ¥¢Âºï MySQL Á¥¢ÂºïËÉåÂêéÁöÑÊï∞ÊçÆÁªìÊûÑÂèäÁÆóÊ≥ïÂéüÁêÜ MySQL ËÆ§ËØÜÁ¥¢Âºï Ë∞àË∞à SQL Êü•ËØ¢‰∏≠ÂõûË°®ÂØπÊÄßËÉΩÁöÑÂΩ±Âìç MySQL ‰ºòÂåñ‰πã MRR (Multi-Range Read: ‰∫åÁ∫ßÁ¥¢ÂºïÂêàÂπ∂ÂõûË°®) ÂÖ≥‰∫é MySQL InnoDB Ë°®ÁöÑ‰∫åÁ∫ßÁ¥¢ÂºïÊòØÂê¶Âä†ÂÖ•‰∏ªÈîÆÂàóÁöÑÈóÆÈ¢òËß£Èáä document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[rsync ÂëΩ‰ª§ËØ¶Ëß£]]></title>
    <url>%2F2019%2F03%2F29%2Frsync%2F</url>
    <content type="text"><![CDATA[‰ªÄ‰πàÊòØ RsyncRsyncÔºàremote synchronizeÔºâÊòØ‰∏Ä‰∏™ËøúÁ®ãÊï∞ÊçÆÂêåÊ≠•Â∑•ÂÖ∑ÔºåÂèØÈÄöËøá LAN/WAN Âø´ÈÄüÂêåÊ≠•Â§öÂè∞‰∏ªÊú∫Èó¥ÁöÑÊñá‰ª∂„ÄÇRsync ‰ΩøÁî®ÊâÄË∞ìÁöÑ ‚ÄúRsync ÁÆóÊ≥ï‚Äù Êù•‰ΩøÊú¨Âú∞ÂíåËøú Á®ã‰∏§‰∏™‰∏ªÊú∫‰πãÈó¥ÁöÑÊñá‰ª∂ËææÂà∞ÂêåÊ≠•ÔºåËøô‰∏™ÁÆóÊ≥ïÂè™‰º†ÈÄÅ‰∏§‰∏™Êñá‰ª∂ÁöÑ‰∏çÂêåÈÉ®ÂàÜÔºåËÄå‰∏çÊòØÊØèÊ¨°ÈÉΩÊï¥‰ªΩ‰º†ÈÄÅÔºåÂõ†Ê≠§ÈÄüÂ∫¶Áõ∏ÂΩìÂø´„ÄÇ Rsync Êú¨Êù•ÊòØÁî®‰∫éÊõø‰ª£ rcp ÁöÑ‰∏Ä‰∏™Â∑•ÂÖ∑ÔºåÁõÆÂâçÁî± samba Áª¥Êä§ÔºåÊâÄ‰ª• rsync.conf Êñá‰ª∂ÁöÑÊ†ºÂºèÁ±ª‰ºº‰∫é Samba ÁöÑ ‰∏ªÈÖçÁΩÆÊñá‰ª∂„ÄÇRsync ÂèØ‰ª•ÈÄöËøá rsh Êàñ ssh ‰ΩøÁî®Ôºå‰πüËÉΩ‰ª• daemon Ê®°ÂºèÂéªËøêË°åÔºåÂú®‰ª• daemon ÊñπÂºèËøêË°åÊó∂ Rsync server ‰ºöÊâìÂºÄ‰∏Ä‰∏™ 873 Á´ØÂè£ÔºåÁ≠âÂæÖÂÆ¢Êà∑Á´ØÂéªËøûÊé•„ÄÇËøûÊé•Êó∂ÔºåRsync server ‰ºöÊ£ÄÊü•Âè£‰ª§ÊòØÂê¶Áõ∏Á¨¶ÔºåËã•ÈÄöËøáÂè£‰ª§Êü•Ê†∏ÔºåÂàôÂèØ‰ª•ÂºÄÂßãËøõË°åÊñá‰ª∂‰º†Ëæì„ÄÇÁ¨¨‰∏ÄÊ¨°ËøûÈÄöÂÆåÊàêÊó∂Ôºå‰ºöÊääÊï¥‰ªΩÊñá‰ª∂‰º†Ëæì‰∏ÄÊ¨°Ôºå‰ª•ÂêéÂàôÂ∞±Âè™ÈúÄËøõË°åÂ¢ûÈáèÂ§á‰ªΩ„ÄÇ Rsync ÊîØÊåÅÂ§ßÂ§öÊï∞ÁöÑÁ±ª Unix Á≥ªÁªüÔºåÊó†ËÆ∫ÊòØ Linux„ÄÅSolaris ËøòÊòØ BSD ‰∏äÈÉΩÁªèËøá‰∫ÜËâØÂ•ΩÁöÑÊµãËØï„ÄÇÊ≠§Â§ñÔºåÂÆÉÂú® windows Âπ≥Âè∞‰∏ã‰πüÊúâÁõ∏Â∫îÁöÑÁâàÊú¨ÔºåÂ¶Ç cwRsync Âíå Sync2NAS Á≠âÂ∑•ÂÖ∑„ÄÇ Rsync ÁöÑÂü∫Êú¨ÁâπÁÇπÂ¶Ç‰∏ãÔºö ÂèØ‰ª•ÈïúÂÉè‰øùÂ≠òÊï¥‰∏™ÁõÆÂΩïÊ†ëÂíåÊñá‰ª∂Á≥ªÁªüÔºõ ÂèØ‰ª•ÂæàÂÆπÊòìÂÅöÂà∞‰øùÊåÅÂéüÊù•Êñá‰ª∂ÁöÑÊùÉÈôê„ÄÅÊó∂Èó¥„ÄÅËΩØÁ°¨ÈìæÊé•Á≠âÔºõ Êó†È°ªÁâπÊÆäÊùÉÈôêÂç≥ÂèØÂÆâË£ÖÔºõ ‰ºòÂåñÁöÑÊµÅÁ®ãÔºåÊñá‰ª∂‰º†ËæìÊïàÁéáÈ´òÔºõ ÂèØ‰ª•‰ΩøÁî® rsh„ÄÅssh Á≠âÊñπÂºèÊù•‰º†ËæìÊñá‰ª∂ÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•ÈÄöËøáÁõ¥Êé•ÁöÑ socket ËøûÊé•Ôºõ ÊîØÊåÅÂåøÂêç‰º†Ëæì„ÄÇ Rsync ÂêåÊ≠•ÁÆóÊ≥ïRsync Âè™ÊâÄ‰ª•ÂêåÊ≠•Êñá‰ª∂ÁöÑÈÄüÂ∫¶Áõ∏ÂΩìÂø´ÔºåÊòØÂõ†‰∏∫ ‚ÄúRsync ÂêåÊ≠•ÁÆóÊ≥ï‚Äù ËÉΩÂú®ÂæàÁü≠ÁöÑÊó∂Èó¥ÂÜÖËÆ°ÁÆóÂá∫ÈúÄË¶ÅÂ§á‰ªΩÁöÑÊï∞ÊçÆÔºåÂÖ≥‰∫é Rsync ÁöÑÂêåÊ≠•ÁÆóÊ≥ïÊèèËø∞Â¶Ç‰∏ãÔºö ÂÅáÂÆöÂú® 1 Âè∑Âíå 2 Âè∑‰∏§Âè∞ËÆ°ÁÆóÊú∫‰πãÈó¥ÂêåÊ≠•Áõ∏‰ººÁöÑÊñá‰ª∂ A ‰∏é BÔºåÂÖ∂‰∏≠ 1 Âè∑ÂØπÊñá‰ª∂ A Êã•ÊúâËÆøÈóÆÊùÉÔºå2 Âè∑ÂØπÊñá‰ª∂ B Êã•ÊúâËÆøÈóÆÊùÉ„ÄÇÂπ∂‰∏îÂÅáÂÆö‰∏ªÊú∫ 1 Âè∑‰∏é 2 Âè∑‰πãÈó¥ÁöÑÁΩëÁªúÂ∏¶ÂÆΩÂæàÂ∞è„ÄÇÈÇ£‰πà rsync ÁÆóÊ≥ïÂ∞ÜÈÄöËøá‰∏ãÈù¢ÁöÑ‰∫î‰∏™Ê≠•È™§Êù•ÂÆåÊàêÔºö 2 Âè∑Â∞ÜÊñá‰ª∂ B ÂàÜÂâ≤Êàê‰∏ÄÁªÑ‰∏çÈáçÂè†ÁöÑÂõ∫ÂÆöÂ§ßÂ∞è‰∏∫ S Â≠óËäÇÁöÑÊï∞ÊçÆÂùóÔºåÊúÄÂêé‰∏ÄÂùóÂèØËÉΩ‰ºöÊØî S Â∞è„ÄÇ 2 Âè∑ÂØπÊØè‰∏Ä‰∏™ÂàÜÂâ≤Â•ΩÁöÑÊï∞ÊçÆÂùóÊâßË°å‰∏§ÁßçÊ†°È™åÔºö‰∏ÄÁßçÊòØ 32 ‰ΩçÁöÑÊªöÂä®Âº±Ê†°È™åÔºåÂè¶‰∏ÄÁßçÊòØ 128 ‰ΩçÁöÑ MD4 Âº∫Ê†°È™å 2 Âè∑Â∞ÜËøô‰∫õÊ†°È™åÁªìÊûúÂèëÁªô 1 Âè∑„ÄÇ 1 Âè∑ÈÄöËøáÊêúÁ¥¢Êñá‰ª∂ A ÁöÑÊâÄÊúâÂ§ßÂ∞è‰∏∫ S ÁöÑÊï∞ÊçÆÂùó (ÂÅèÁßªÈáèÂèØ‰ª•‰ªªÈÄâÔºå‰∏ç‰∏ÄÂÆöÈùûË¶ÅÊòØ S ÁöÑÂÄçÊï∞)ÔºåÊù•ÂØªÊâæ‰∏éÊñá‰ª∂ B ÁöÑÊüê‰∏ÄÂùóÊúâÁùÄÁõ∏ÂêåÁöÑÂº±Ê†°È™åÁ†ÅÂíåÂº∫Ê†°È™åÁ†ÅÁöÑÊï∞ÊçÆÂùó„ÄÇËøôÈ°πÂ∑•‰ΩúÂèØ‰ª•ÂÄüÂä©ÊªöÂä®Ê†°È™åÁöÑÁâπÊÄßÂæàÂø´ÂÆåÊàê„ÄÇ 1 Âè∑ÂèëÁªô 2 Âè∑‰∏Ä‰∏≤Êåá‰ª§Êù•ÁîüÊàêÊñá‰ª∂ A Âú® 2 Âè∑‰∏äÁöÑÂ§á‰ªΩ„ÄÇËøôÈáåÁöÑÊØè‰∏ÄÊù°Êåá‰ª§Ë¶Å‰πàÊòØÂØπÊñá‰ª∂ B ÁªèÊã•ÊúâÊüê‰∏Ä‰∏™Êï∞ÊçÆÂùóËÄå‰∏çÈ°ªÈáç‰º†ÁöÑËØÅÊòéÔºåË¶Å‰πàÊòØ‰∏Ä‰∏™Êï∞ÊçÆÂùóÔºåËøô‰∏™Êï∞ÊçÆÂùóËÇØÂÆöÊòØÊ≤°Êúâ‰∏éÊñá‰ª∂ B ÁöÑ‰ªª‰Ωï‰∏Ä‰∏™Êï∞ÊçÆÂùóÂåπÈÖç‰∏äÁöÑ„ÄÇ Rsync ÂèÇÊï∞ËØ¥ÊòéÈÖçÁΩÆÊñá‰ª∂Ôºörsyncd.conf ÂÖ®Â±ÄÂèÇÊï∞Âú®Êñá‰ª∂‰∏≠Ôºå[module]‰πãÂâçÁöÑÊâÄÊúâÂèÇÊï∞ÈÉΩÊòØÂÖ®Â±ÄÂèÇÊï∞ÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•Âú®ÂÖ®Â±ÄÂèÇÊï∞ÈÉ®ÂàÜÂÆö‰πâÊ®°ÂùóÂèÇÊï∞ÔºåËøôÊó∂ÂÄôËØ•ÂèÇÊï∞ÁöÑÂÄºÂ∞±ÊòØÊâÄÊúâÊ®°ÂùóÁöÑÈªòËÆ§ÂÄº„ÄÇ portÊåáÂÆöÂêéÂè∞Á®ãÂ∫è‰ΩøÁî®ÁöÑÁ´ØÂè£Âè∑ÔºåÈªòËÆ§‰∏∫ 873„ÄÇ motd fileÁî®Êù•ÊåáÂÆö‰∏Ä‰∏™Ê∂àÊÅØÊñá‰ª∂ÔºåÂΩìÂÆ¢Êà∑ËøûÊé•ÊúçÂä°Âô®Êó∂ËØ•Êñá‰ª∂ÁöÑÂÜÖÂÆπÊòæÁ§∫ÁªôÂÆ¢Êà∑ÔºåÈªòËÆ§ÊòØÊ≤°Êúâ motd Êñá‰ª∂ÁöÑ„ÄÇ log fileÊåáÂÆö rsync ÁöÑÊó•ÂøóÊñá‰ª∂ÔºåËÄå‰∏çÂ∞ÜÊó•ÂøóÂèëÈÄÅÁªô syslog„ÄÇÊØîÂ¶ÇÂèØÊåáÂÆö‰∏∫ /var/log/rsyncd.log„ÄÇ pid fileÊåáÂÆö rsync ÁöÑ pid Êñá‰ª∂ÔºåÈÄöÂ∏∏ÊåáÂÆö‰∏∫ /var/run/rsyncd.pid„ÄÇ syslog facilityÊåáÂÆö rsync ÂèëÈÄÅÊó•ÂøóÊ∂àÊÅØÁªô syslog Êó∂ÁöÑÊ∂àÊÅØÁ∫ßÂà´ÔºåÂ∏∏ËßÅÁöÑÊ∂àÊÅØÁ∫ßÂà´ÊòØÔºö daemon ÈªòËÆ§ÂÄº uth authpriv cron daemon ftp kern lpr mail news security sys-log user uucp local0 local1 local2 local3 local4 local5 local6 local7 Ê®°ÂùóÂèÇÊï∞‰∏ªË¶ÅÊòØÂÆö‰πâÊúçÂä°Âô®Âì™‰∏™ÁõÆÂΩïË¶ÅË¢´ÂêåÊ≠•„ÄÇÂÖ∂Ê†ºÂºèÂøÖÈ°ª‰∏∫‚Äú[module]‚ÄùÂΩ¢ÂºèÔºåËøô‰∏™ÂêçÂ≠óÂ∞±ÊòØÂú® rsync ÂÆ¢Êà∑Á´ØÁúãÂà∞ÁöÑÂêçÂ≠óÔºåÂÖ∂ÂÆûÊúâÁÇπË±° Samba ÊúçÂä°Âô®Êèê‰æõÁöÑÂÖ±‰∫´Âêç„ÄÇËÄåÊúçÂä°Âô®ÁúüÊ≠£ÂêåÊ≠•ÁöÑÊï∞ÊçÆÊòØÈÄöËøá path Êù•ÊåáÂÆöÁöÑ„ÄÇÊàë‰ª¨ÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÈúÄË¶ÅÔºåÊù•ÊåáÂÆöÂ§ö‰∏™Ê®°ÂùóÔºåÊ®°Âùó‰∏≠ÂèØ‰ª•ÂÆö‰πâ‰ª•‰∏ãÂèÇÊï∞Ôºö commentÁªôÊ®°ÂùóÊåáÂÆö‰∏Ä‰∏™ÊèèËø∞ÔºåËØ•ÊèèËø∞ËøûÂêåÊ®°ÂùóÂêçÂú®ÂÆ¢Êà∑ËøûÊé•ÂæóÂà∞Ê®°ÂùóÂàóË°®Êó∂ÊòæÁ§∫ÁªôÂÆ¢Êà∑„ÄÇÈªòËÆ§Ê≤°ÊúâÊèèËø∞ÂÆö‰πâ„ÄÇ pathÊåáÂÆöËØ•Ê®°ÂùóÁöÑ‰æõÂ§á‰ªΩÁöÑÁõÆÂΩïÊ†ëË∑ØÂæÑÔºåËØ•ÂèÇÊï∞ÊòØÂøÖÈ°ªÊåáÂÆöÁöÑ„ÄÇ use chrootÂ¶ÇÊûúÊåáÂÆö‰∏∫ trueÔºåÈÇ£‰πà rsync Âú®‰º†ËæìÊñá‰ª∂‰ª•ÂâçÈ¶ñÂÖà chroot Âà∞ path ÂèÇÊï∞ÊâÄÊåáÂÆöÁöÑÁõÆÂΩï‰∏ã„ÄÇËøôÊ†∑ÂÅöÁöÑÂéüÂõ†ÊòØÂÆûÁé∞È¢ùÂ§ñÁöÑÂÆâÂÖ®Èò≤Êä§Ôºå‰ΩÜÊòØÁº∫ÁÇπÊòØÈúÄË¶Å‰ª• root ÊùÉÈôêÔºåÂπ∂‰∏î‰∏çËÉΩÂ§á‰ªΩÊåáÂêëÂ§ñÈÉ®ÁöÑÁ¨¶Âè∑ËøûÊé•ÊâÄÊåáÂêëÁöÑÁõÆÂΩïÊñá‰ª∂„ÄÇÈªòËÆ§ÂÄº‰∏∫ true„ÄÇ uidÊåáÂÆöÂΩìËØ•Ê®°Âùó‰º†ËæìÊñá‰ª∂Êó∂ÂÆàÊä§ËøõÁ®ãÂ∫îËØ•ÂÖ∑ÊúâÁöÑ uidÔºåÈÖçÂêà gidÈÄâÈ°π‰ΩøÁî®ÂèØ‰ª•Á°ÆÂÆöÂì™‰∫õÂèØ‰ª•ËÆøÈóÆÊÄé‰πàÊ†∑ÁöÑÊñá‰ª∂ÊùÉÈôêÔºåÈªòËÆ§ÂÄºÊòØ‚Äùnobody‚Äù„ÄÇ gidÊåáÂÆöÂΩìËØ•Ê®°Âùó‰º†ËæìÊñá‰ª∂Êó∂ÂÆàÊä§ËøõÁ®ãÂ∫îËØ•ÂÖ∑ÊúâÁöÑ gid„ÄÇÈªòËÆ§ÂÄº‰∏∫‚Äùnobody‚Äù„ÄÇ max connectionsÊåáÂÆöËØ•Ê®°ÂùóÁöÑÊúÄÂ§ßÂπ∂ÂèëËøûÊé•Êï∞Èáè‰ª•‰øùÊä§ÊúçÂä°Âô®ÔºåË∂ÖËøáÈôêÂà∂ÁöÑËøûÊé•ËØ∑Ê±ÇÂ∞ÜË¢´ÂëäÁü•ÈöèÂêéÂÜçËØï„ÄÇÈªòËÆ§ÂÄºÊòØ 0Ôºå‰πüÂ∞±ÊòØÊ≤°ÊúâÈôêÂà∂„ÄÇ listËØ•ÈÄâÈ°πËÆæÂÆöÂΩìÂÆ¢Êà∑ËØ∑Ê±ÇÂèØ‰ª•‰ΩøÁî®ÁöÑÊ®°ÂùóÂàóË°®Êó∂ÔºåËØ•Ê®°ÂùóÊòØÂê¶Â∫îËØ•Ë¢´ÂàóÂá∫„ÄÇÂ¶ÇÊûúËÆæÁΩÆËØ•ÈÄâÈ°π‰∏∫ falseÔºåÂèØ‰ª•ÂàõÂª∫ÈöêËóèÁöÑÊ®°Âùó„ÄÇÈªòËÆ§ÂÄºÊòØ true„ÄÇ read onlyËÆæÂÆöÊòØÂê¶ÂÖÅËÆ∏ÂÆ¢Êà∑‰∏äËΩΩÊñá‰ª∂„ÄÇÂ¶ÇÊûú‰∏∫ true ÈÇ£‰πà‰ªª‰Ωï‰∏äËΩΩËØ∑Ê±ÇÈÉΩ‰ºöÂ§±Ë¥•ÔºåÂ¶ÇÊûú‰∏∫ false Âπ∂‰∏îÊúçÂä°Âô®ÁõÆÂΩïËØªÂÜôÊùÉÈôêÂÖÅËÆ∏ÈÇ£‰πà‰∏äËΩΩÊòØÂÖÅËÆ∏ÁöÑ„ÄÇÈªòËÆ§ÂÄº‰∏∫ true„ÄÇ excludeÁî®Êù•ÊåáÂÆöÂ§ö‰∏™Áî±Á©∫Ê†ºÈöîÂºÄÁöÑÂ§ö‰∏™Êñá‰ª∂ÊàñÁõÆÂΩï (Áõ∏ÂØπË∑ØÂæÑ)ÔºåÂπ∂Â∞ÜÂÖ∂Ê∑ªÂä†Âà∞ exclude ÂàóË°®‰∏≠„ÄÇËøôÁ≠âÂêå‰∫éÂú®ÂÆ¢Êà∑Á´ØÂëΩ‰ª§‰∏≠‰ΩøÁî®--excludeÊù•ÊåáÂÆö Ê®°ÂºèÔºå‰∏Ä‰∏™Ê®°ÂùóÂè™ËÉΩÊåáÂÆö‰∏Ä‰∏™ exclude ÈÄâÈ°π„ÄÇ‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÁöÑ‰∏ÄÁÇπÊòØËØ•ÈÄâÈ°πÊúâ‰∏ÄÂÆöÁöÑÂÆâÂÖ®ÊÄßÈóÆÈ¢òÔºåÂÆ¢Êà∑ÂæàÊúâÂèØËÉΩÁªïËøá exclude ÂàóË°®ÔºåÂ¶ÇÊûúÂ∏åÊúõÁ°Æ‰øùÁâπÂÆö ÁöÑÊñá‰ª∂‰∏çËÉΩË¢´ËÆøÈóÆÔºåÈÇ£Â∞±ÊúÄÂ•ΩÁªìÂêà uid/gid ÈÄâÈ°π‰∏ÄËµ∑‰ΩøÁî®„ÄÇ exclude fromÊåáÂÆö‰∏Ä‰∏™ÂåÖÂê´ exclude Ê®°ÂºèÁöÑÂÆö‰πâÁöÑÊñá‰ª∂ÂêçÔºåÊúçÂä°Âô®‰ªéËØ•Êñá‰ª∂‰∏≠ËØªÂèñ exclude ÂàóË°®ÂÆö‰πâ„ÄÇ includeÁî®Êù•ÊåáÂÆö‰∏çÊéíÈô§Á¨¶ÂêàË¶ÅÊ±ÇÁöÑÊñá‰ª∂ÊàñÁõÆÂΩï„ÄÇËøôÁ≠âÂêå‰∫éÂú®ÂÆ¢Êà∑Á´ØÂëΩ‰ª§‰∏≠‰ΩøÁî®‚Äìinclude Êù•ÊåáÂÆöÊ®°ÂºèÔºåÁªìÂêà include Âíå exclude ÂèØ‰ª•ÂÆö‰πâÂ§çÊùÇÁöÑ exclude/include ËßÑÂàô„ÄÇ include fromÊåáÂÆö‰∏Ä‰∏™ÂåÖÂê´ include Ê®°ÂºèÁöÑÂÆö‰πâÁöÑÊñá‰ª∂ÂêçÔºåÊúçÂä°Âô®‰ªéËØ•Êñá‰ª∂‰∏≠ËØªÂèñ include ÂàóË°®ÂÆö‰πâ„ÄÇ auth usersÊåáÂÆöÁî±Á©∫Ê†ºÊàñÈÄóÂè∑ÂàÜÈöîÁöÑÁî®Êà∑ÂêçÂàóË°®ÔºåÂè™ÊúâËøô‰∫õÁî®Êà∑ÊâçÂÖÅËÆ∏ËøûÊé•ËØ•Ê®°Âùó„ÄÇËøôÈáåÁöÑÁî®Êà∑ÂíåÁ≥ªÁªüÁî®Êà∑Ê≤°Êúâ‰ªª‰ΩïÂÖ≥Á≥ª„ÄÇÂ¶ÇÊûú‚Äùauth users‚Äù Ë¢´ËÆæÁΩÆÔºåÈÇ£‰πàÂÆ¢Êà∑Á´ØÂèëÂá∫ÂØπËØ•Ê®°ÂùóÁöÑËøûÊé•ËØ∑Ê±Ç‰ª•Âêé‰ºöË¢´ rsync ËØ∑Ê±Ç challenged ËøõË°åÈ™åËØÅË∫´‰ªΩËøôÈáå‰ΩøÁî®ÁöÑ challenge/response ËÆ§ËØÅÂçèËÆÆ„ÄÇÁî®Êà∑ÁöÑÂêçÂíåÂØÜÁ†Å‰ª•ÊòéÊñáÊñπÂºèÂ≠òÊîæÂú®‚Äùsecrets file‚Äù ÈÄâÈ°πÊåáÂÆöÁöÑÊñá‰ª∂‰∏≠„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊó†ÈúÄÂØÜÁ†ÅÂ∞±ÂèØ‰ª•ËøûÊé•Ê®°Âùó (‰πüÂ∞±ÊòØÂåøÂêçÊñπÂºè)„ÄÇ secrets fileÊåáÂÆö‰∏Ä‰∏™ÂåÖÂê´ÂÆö‰πâÁî®Êà∑Âêç: ÂØÜÁ†ÅÂØπÁöÑÊñá‰ª∂„ÄÇÂè™ÊúâÂú®‚Äùauth users‚Äù Ë¢´ÂÆö‰πâÊó∂ÔºåËØ•Êñá‰ª∂ÊâçÊúâ‰ΩúÁî®„ÄÇÊñá‰ª∂ÊØèË°åÂåÖÂê´‰∏Ä‰∏™ username:passwd ÂØπ„ÄÇ‰∏ÄËà¨Êù•ËØ¥ÂØÜÁ†ÅÊúÄÂ•Ω‰∏çË¶ÅË∂ÖËøá 8 ‰∏™Â≠óÁ¨¶„ÄÇÊ≤°ÊúâÈªòËÆ§ÁöÑ secures fileÔºåÈúÄË¶ÅÈôêÂºèÊåáÂÆö‰∏Ä‰∏™ (‰æãÂ¶ÇÔºö/etc/rsyncd.passwd)„ÄÇÊ≥®ÊÑèÔºöËØ•Êñá‰ª∂ÁöÑÊùÉÈôê‰∏ÄÂÆöË¶ÅÊòØ 600ÔºåÂê¶ÂàôÂÆ¢Êà∑Á´ØÂ∞Ü‰∏çËÉΩËøûÊé•ÊúçÂä°Âô®„ÄÇ strict modesÊåáÂÆöÊòØÂê¶ÁõëÊµãÂØÜÁ†ÅÊñá‰ª∂ÁöÑÊùÉÈôêÔºåÂ¶ÇÊûúËØ•ÈÄâÈ°πÂÄº‰∏∫ true ÈÇ£‰πàÂØÜÁ†ÅÊñá‰ª∂Âè™ËÉΩË¢´ rsync ÊúçÂä°Âô®ËøêË°åË∫´‰ªΩÁöÑÁî®Êà∑ËÆøÈóÆÔºåÂÖ∂‰ªñ‰ªª‰ΩïÁî®Êà∑‰∏çÂèØ‰ª•ËÆøÈóÆËØ•Êñá‰ª∂„ÄÇÈªòËÆ§ÂÄº‰∏∫ true„ÄÇ hosts allowÊåáÂÆöÂì™‰∫õ IP ÁöÑÂÆ¢Êà∑ÂÖÅËÆ∏ËøûÊé•ËØ•Ê®°Âùó„ÄÇÂÆ¢Êà∑Ê®°ÂºèÂÆö‰πâÂèØ‰ª•ÊòØ‰ª•‰∏ãÂΩ¢ÂºèÔºö Âçï‰∏™ IP Âú∞ÂùÄÔºå‰æãÂ¶ÇÔºö192.167.0.1 Êï¥‰∏™ÁΩëÊÆµÔºå‰æãÂ¶ÇÔºö192.168.0.0/24Ôºå‰πüÂèØ‰ª•ÊòØ 192.168.0.0/255.255.255.0 Â§ö‰∏™ IP ÊàñÁΩëÊÆµÈúÄË¶ÅÁî®Á©∫Ê†ºÈöîÂºÄÔºå‚Äú*‚Äù ÂàôË°®Á§∫ÊâÄÊúâÔºåÈªòËÆ§ÊòØÂÖÅËÆ∏ÊâÄÊúâ‰∏ªÊú∫ËøûÊé•„ÄÇ hosts denyÊåáÂÆö‰∏çÂÖÅËÆ∏ËøûÊé• rsync ÊúçÂä°Âô®ÁöÑÊú∫Âô®ÔºåÂèØ‰ª•‰ΩøÁî® hosts allow ÁöÑÂÆö‰πâÊñπÂºèÊù•ËøõË°åÂÆö‰πâ„ÄÇÈªòËÆ§ÊòØÊ≤°Êúâ hosts deny ÂÆö‰πâ„ÄÇ ignore errorsÊåáÂÆö rsyncd Âú®Âà§Êñ≠ÊòØÂê¶ËøêË°å‰º†ËæìÊó∂ÁöÑÂà†Èô§Êìç‰ΩúÊó∂ÂøΩÁï• server ‰∏äÁöÑ IO ÈîôËØØÔºå‰∏ÄËà¨Êù•ËØ¥ rsync Âú®Âá∫Áé∞ IO ÈîôËØØÊó∂Â∞ÜÂ∞ÜË∑≥Ëøá--deleteÊìç‰ΩúÔºå‰ª•Èò≤Ê≠¢Âõ†‰∏∫ÊöÇÊó∂ÁöÑËµÑÊ∫ê‰∏çË∂≥ÊàñÂÖ∂ÂÆÉ IO ÈîôËØØÂØºËá¥ÁöÑ‰∏•ÈáçÈóÆÈ¢ò„ÄÇ ignore nonreadableÊåáÂÆö rysnc ÊúçÂä°Âô®ÂÆåÂÖ®ÂøΩÁï•ÈÇ£‰∫õÁî®Êà∑Ê≤°ÊúâËÆøÈóÆÊùÉÈôêÁöÑÊñá‰ª∂„ÄÇËøôÂØπ‰∫éÂú®ÈúÄË¶ÅÂ§á‰ªΩÁöÑÁõÆÂΩï‰∏≠Êúâ‰∫õÊñá‰ª∂ÊòØ‰∏çÂ∫îËØ•Ë¢´Â§á‰ªΩËÄÖÂæóÂà∞ÁöÑÊÉÖÂÜµÊòØÊúâÊÑè‰πâÁöÑ„ÄÇ lock fileÊåáÂÆöÊîØÊåÅ max connections ÂèÇÊï∞ÁöÑÈîÅÊñá‰ª∂ÔºåÈªòËÆ§ÂÄºÊòØ /var/run/rsyncd.lock„ÄÇ transfer logging‰Ωø rsync ÊúçÂä°Âô®‰ΩøÁî® ftp Ê†ºÂºèÁöÑÊñá‰ª∂Êù•ËÆ∞ÂΩï‰∏ãËΩΩÂíå‰∏äËΩΩÊìç‰ΩúÂú®Ëá™Â∑±ÂçïÁã¨ÁöÑÊó•Âøó‰∏≠„ÄÇ log formatÈÄöËøáËØ•ÈÄâÈ°πÁî®Êà∑Âú®‰ΩøÁî® transfer logging ÂèØ‰ª•Ëá™Â∑±ÂÆöÂà∂Êó•ÂøóÊñá‰ª∂ÁöÑÂ≠óÊÆµ„ÄÇÂÖ∂Ê†ºÂºèÊòØ‰∏Ä‰∏™ÂåÖÂê´Ê†ºÂºèÂÆö‰πâÁ¨¶ÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÂèØ‰ª•‰ΩøÁî®ÁöÑÊ†ºÂºèÂÆö‰πâÁ¨¶Â¶Ç‰∏ãÔºö12345678910111213%h ËøúÁ®ã‰∏ªÊú∫Âêç%a ËøúÁ®ãIPÂú∞ÂùÄ%l Êñá‰ª∂ÈïøÂ∫¶Â≠óÁ¨¶Êï∞%p ËØ•Ê¨°rsync‰ºöËØùÁöÑËøõÁ®ãid%o Êìç‰ΩúÁ±ªÂûãÔºö"send"Êàñ"recv"%f Êñá‰ª∂Âêç%P Ê®°ÂùóË∑ØÂæÑ%m Ê®°ÂùóÂêç%t ÂΩìÂâçÊó∂Èó¥%u ËÆ§ËØÅÁöÑÁî®Êà∑Âêç(ÂåøÂêçÊó∂ÊòØnull)%b ÂÆûÈôÖ‰º†ËæìÁöÑÂ≠óËäÇÊï∞%c ÂΩìÂèëÈÄÅÊñá‰ª∂Êó∂ÔºåËØ•Â≠óÊÆµËÆ∞ÂΩïËØ•Êñá‰ª∂ÁöÑÊ†°È™åÁ†ÅÈªòËÆ§logÊ†ºÂºè‰∏∫Ôºö`%o %h [%a] %m (%u) %f %l`Ôºå‰∏ÄËà¨Êù•ËØ¥,Âú®ÊØèË°åÁöÑÂ§¥‰∏ä‰ºöÊ∑ªÂä†`%t [%p]`„ÄÇÂú®Ê∫ê‰ª£Á†Å‰∏≠ÂêåÊó∂ÂèëÂ∏ÉÊúâ‰∏Ä‰∏™Âè´rsyncstatsÁöÑperlËÑöÊú¨Á®ãÂ∫èÊù•ÁªüËÆ°ËøôÁßçÊ†ºÂºèÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇ timeoutÈÄöËøáËØ•ÈÄâÈ°πÂèØ‰ª•Ë¶ÜÁõñÂÆ¢Êà∑ÊåáÂÆöÁöÑ IP Ë∂ÖÊó∂Êó∂Èó¥„ÄÇÈÄöËøáËØ•ÈÄâÈ°πÂèØ‰ª•Á°Æ‰øù rsync ÊúçÂä°Âô®‰∏ç‰ºöÊ∞∏ËøúÁ≠âÂæÖ‰∏Ä‰∏™Â¥©Ê∫ÉÁöÑÂÆ¢Êà∑Á´Ø„ÄÇË∂ÖÊó∂Âçï‰Ωç‰∏∫ÁßíÈíüÔºå0 Ë°®Á§∫Ê≤°ÊúâË∂ÖÊó∂ÂÆö‰πâÔºåËøô‰πüÊòØÈªòËÆ§ÂÄº„ÄÇÂØπ‰∫éÂåøÂêç rsync ÊúçÂä°Âô®Êù•ËØ¥Ôºå‰∏Ä‰∏™ÁêÜÊÉ≥ÁöÑÊï∞Â≠óÊòØ 600„ÄÇ refuse optionsÈÄöËøáËØ•ÈÄâÈ°πÂèØ‰ª•ÂÆö‰πâ‰∏Ä‰∫õ‰∏çÂÖÅËÆ∏ÂÆ¢Êà∑ÂØπËØ•Ê®°Âùó‰ΩøÁî®ÁöÑÂëΩ‰ª§ÂèÇÊï∞ÂàóË°®„ÄÇËøôÈáåÂøÖÈ°ª‰ΩøÁî®ÂëΩ‰ª§ÂÖ®ÂêçÔºåËÄå‰∏çËÉΩÊòØÁÆÄÁß∞„ÄÇ‰ΩÜÂèëÁîüÊãíÁªùÊüê‰∏™ÂëΩ‰ª§ÁöÑÊÉÖÂÜµÊó∂ÊúçÂä°Âô®Â∞ÜÊä•ÂëäÈîôËØØ‰ø°ÊÅØÁÑ∂ÂêéÈÄÄÂá∫„ÄÇÂ¶ÇÊûúË¶ÅÈò≤Ê≠¢‰ΩøÁî®ÂéãÁº©ÔºåÂ∫îËØ•ÊòØÔºödont compress = *„ÄÇ dont compressÁî®Êù•ÊåáÂÆöÈÇ£‰∫õ‰∏çËøõË°åÂéãÁº©Â§ÑÁêÜÂÜç‰º†ËæìÁöÑÊñá‰ª∂ÔºåÈªòËÆ§ÂÄºÊòØ *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz Rsync ÂëΩ‰ª§Âú®ÂØπ rsync ÊúçÂä°Âô®ÈÖçÁΩÆÁªìÊùü‰ª•ÂêéÔºå‰∏ã‰∏ÄÊ≠•Â∞±ÈúÄË¶ÅÂú®ÂÆ¢Êà∑Á´ØÂèëÂá∫ rsync ÂëΩ‰ª§Êù•ÂÆûÁé∞Â∞ÜÊúçÂä°Âô®Á´ØÁöÑÊñá‰ª∂Â§á‰ªΩÂà∞ÂÆ¢Êà∑Á´ØÊù•„ÄÇrsync ÊòØ‰∏Ä‰∏™ÂäüËÉΩÈùûÂ∏∏Âº∫Â§ßÁöÑÂ∑•ÂÖ∑ÔºåÂÖ∂ÂëΩ‰ª§‰πüÊúâÂæàÂ§öÂäüËÉΩÁâπËâ≤ÈÄâÈ°πÔºå‰∏ãÈù¢Â∞±ÂØπÂÆÉÁöÑÈÄâÈ°π‰∏Ä‰∏ÄËøõË°åÂàÜÊûêËØ¥Êòé„ÄÇRsync ÁöÑÂëΩ‰ª§Ê†ºÂºèÂèØ‰ª•‰∏∫‰ª•‰∏ãÂÖ≠ÁßçÔºö rsync [OPTION]... SRC DEST rsync [OPTION]... SRC [USER@]HOST:DEST rsync [OPTION]... [USER@]HOST:SRC DEST rsync [OPTION]... [USER@]HOST::SRC DEST rsync [OPTION]... SRC [USER@]HOST::DEST rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST] ÂØπÂ∫î‰∫é‰ª•‰∏äÂÖ≠ÁßçÂëΩ‰ª§Ê†ºÂºèÔºårsync ÊúâÂÖ≠Áßç‰∏çÂêåÁöÑÂ∑•‰ΩúÊ®°ÂºèÔºö Êã∑Ë¥ùÊú¨Âú∞Êñá‰ª∂„ÄÇÂΩì SRC Âíå DES Ë∑ØÂæÑ‰ø°ÊÅØÈÉΩ‰∏çÂåÖÂê´ÊúâÂçï‰∏™ÂÜíÂè∑‚Äù:‚Äù ÂàÜÈöîÁ¨¶Êó∂Â∞±ÂêØÂä®ËøôÁßçÂ∑•‰ΩúÊ®°Âºè„ÄÇÂ¶ÇÔºörsync -a /data /backup ‰ΩøÁî®‰∏Ä‰∏™ËøúÁ®ã shell Á®ãÂ∫è (Â¶Ç rsh„ÄÅssh) Êù•ÂÆûÁé∞Â∞ÜÊú¨Âú∞Êú∫Âô®ÁöÑÂÜÖÂÆπÊã∑Ë¥ùÂà∞ËøúÁ®ãÊú∫Âô®„ÄÇÂΩì DST Ë∑ØÂæÑÂú∞ÂùÄÂåÖÂê´Âçï‰∏™ÂÜíÂè∑‚Äù:‚ÄùÂàÜÈöîÁ¨¶Êó∂ÂêØÂä®ËØ•Ê®°Âºè„ÄÇÂ¶ÇÔºörsync -avz *.c foo:src ‰ΩøÁî®‰∏Ä‰∏™ËøúÁ®ã shell Á®ãÂ∫è (Â¶Ç rsh„ÄÅssh) Êù•ÂÆûÁé∞Â∞ÜËøúÁ®ãÊú∫Âô®ÁöÑÂÜÖÂÆπÊã∑Ë¥ùÂà∞Êú¨Âú∞Êú∫Âô®„ÄÇÂΩì SRC Âú∞ÂùÄË∑ØÂæÑÂåÖÂê´Âçï‰∏™ÂÜíÂè∑‚Äù:‚ÄùÂàÜÈöîÁ¨¶Êó∂ÂêØÂä®ËØ•Ê®°Âºè„ÄÇÂ¶ÇÔºörsync -avz foo:src/bar /data ‰ªéËøúÁ®ã rsync ÊúçÂä°Âô®‰∏≠Êã∑Ë¥ùÊñá‰ª∂Âà∞Êú¨Âú∞Êú∫„ÄÇÂΩì SRC Ë∑ØÂæÑ‰ø°ÊÅØÂåÖÂê´‚Äù::‚Äù ÂàÜÈöîÁ¨¶Êó∂ÂêØÂä®ËØ•Ê®°Âºè„ÄÇÂ¶ÇÔºörsync -av root@172.16.78.192::www /databack ‰ªéÊú¨Âú∞Êú∫Âô®Êã∑Ë¥ùÊñá‰ª∂Âà∞ËøúÁ®ã rsync ÊúçÂä°Âô®‰∏≠„ÄÇÂΩì DST Ë∑ØÂæÑ‰ø°ÊÅØÂåÖÂê´‚Äù::‚Äù ÂàÜÈöîÁ¨¶Êó∂ÂêØÂä®ËØ•Ê®°Âºè„ÄÇÂ¶ÇÔºörsync -av /databack root@172.16.78.192::www ÂàóËøúÁ®ãÊú∫ÁöÑÊñá‰ª∂ÂàóË°®„ÄÇËøôÁ±ª‰ºº‰∫é rsync ‰º†ËæìÔºå‰∏çËøáÂè™Ë¶ÅÂú®ÂëΩ‰ª§‰∏≠ÁúÅÁï•ÊéâÊú¨Âú∞Êú∫‰ø°ÊÅØÂç≥ÂèØ„ÄÇÂ¶ÇÔºörsync -v rsync://172.16.78.192/www rsync ÂèÇÊï∞ÁöÑÂÖ∑‰ΩìËß£ÈáäÂ¶Ç‰∏ãÔºö12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061-v, --verbose ËØ¶ÁªÜÊ®°ÂºèËæìÂá∫-q, --quiet Á≤æÁÆÄËæìÂá∫Ê®°Âºè-c, --checksum ÊâìÂºÄÊ†°È™åÂºÄÂÖ≥ÔºåÂº∫Âà∂ÂØπÊñá‰ª∂‰º†ËæìËøõË°åÊ†°È™å-a, --archive ÂΩíÊ°£Ê®°ÂºèÔºåË°®Á§∫‰ª•ÈÄíÂΩíÊñπÂºè‰º†ËæìÊñá‰ª∂ÔºåÂπ∂‰øùÊåÅÊâÄÊúâÊñá‰ª∂Â±ûÊÄßÔºåÁ≠â‰∫é-rlptgoD-r, --recursive ÂØπÂ≠êÁõÆÂΩï‰ª•ÈÄíÂΩíÊ®°ÂºèÂ§ÑÁêÜ-R, --relative ‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑ‰ø°ÊÅØ-b, --backup ÂàõÂª∫Â§á‰ªΩÔºå‰πüÂ∞±ÊòØÂØπ‰∫éÁõÆÁöÑÂ∑≤ÁªèÂ≠òÂú®ÊúâÂêåÊ†∑ÁöÑÊñá‰ª∂ÂêçÊó∂ÔºåÂ∞ÜËÄÅÁöÑÊñá‰ª∂ÈáçÊñ∞ÂëΩÂêç‰∏∫~filename„ÄÇÂèØ‰ª•‰ΩøÁî®--suffixÈÄâÈ°πÊù•ÊåáÂÆö‰∏çÂêåÁöÑÂ§á‰ªΩÊñá‰ª∂ÂâçÁºÄ„ÄÇ--backup-dir Â∞ÜÂ§á‰ªΩÊñá‰ª∂(Â¶Ç~filename)Â≠òÊîæÂú®Âú®ÁõÆÂΩï‰∏ã„ÄÇ-suffix=SUFFIX ÂÆö‰πâÂ§á‰ªΩÊñá‰ª∂ÂâçÁºÄ-u, --update ‰ªÖ‰ªÖËøõË°åÊõ¥Êñ∞Ôºå‰πüÂ∞±ÊòØË∑≥ËøáÊâÄÊúâÂ∑≤ÁªèÂ≠òÂú®‰∫éDSTÔºåÂπ∂‰∏îÊñá‰ª∂Êó∂Èó¥Êôö‰∫éË¶ÅÂ§á‰ªΩÁöÑÊñá‰ª∂„ÄÇ(‰∏çË¶ÜÁõñÊõ¥Êñ∞ÁöÑÊñá‰ª∂)-l, --links ‰øùÁïôËΩØÈìæÁªì-L, --copy-links ÊÉ≥ÂØπÂæÖÂ∏∏ËßÑÊñá‰ª∂‰∏ÄÊ†∑Â§ÑÁêÜËΩØÈìæÁªì--copy-unsafe-links ‰ªÖ‰ªÖÊã∑Ë¥ùÊåáÂêëSRCË∑ØÂæÑÁõÆÂΩïÊ†ë‰ª•Â§ñÁöÑÈìæÁªì--safe-links ÂøΩÁï•ÊåáÂêëSRCË∑ØÂæÑÁõÆÂΩïÊ†ë‰ª•Â§ñÁöÑÈìæÁªì-H, --hard-links ‰øùÁïôÁ°¨ÈìæÁªì-p, --perms ‰øùÊåÅÊñá‰ª∂ÊùÉÈôê-o, --owner ‰øùÊåÅÊñá‰ª∂Â±û‰∏ª‰ø°ÊÅØ-g, --group ‰øùÊåÅÊñá‰ª∂Â±ûÁªÑ‰ø°ÊÅØ-D, --devices ‰øùÊåÅËÆæÂ§áÊñá‰ª∂‰ø°ÊÅØ-t, --times ‰øùÊåÅÊñá‰ª∂Êó∂Èó¥‰ø°ÊÅØ-S, --sparse ÂØπÁ®ÄÁñèÊñá‰ª∂ËøõË°åÁâπÊÆäÂ§ÑÁêÜ‰ª•ËäÇÁúÅDSTÁöÑÁ©∫Èó¥-n, --dry-runÁé∞ÂÆûÂì™‰∫õÊñá‰ª∂Â∞ÜË¢´‰º†Ëæì-W, --whole-file Êã∑Ë¥ùÊñá‰ª∂Ôºå‰∏çËøõË°åÂ¢ûÈáèÊ£ÄÊµã-x, --one-file-system ‰∏çË¶ÅË∑®Ë∂äÊñá‰ª∂Á≥ªÁªüËæπÁïå-B, --block-size=SIZE Ê£ÄÈ™åÁÆóÊ≥ï‰ΩøÁî®ÁöÑÂùóÂ∞∫ÂØ∏ÔºåÈªòËÆ§ÊòØ700Â≠óËäÇ-e, --rsh=COMMAND ÊåáÂÆö‰ΩøÁî®rsh„ÄÅsshÊñπÂºèËøõË°åÊï∞ÊçÆÂêåÊ≠•--rsync-path=PATH ÊåáÂÆöËøúÁ®ãÊúçÂä°Âô®‰∏äÁöÑrsyncÂëΩ‰ª§ÊâÄÂú®Ë∑ØÂæÑ‰ø°ÊÅØ-C, --cvs-exclude ‰ΩøÁî®ÂíåCVS‰∏ÄÊ†∑ÁöÑÊñπÊ≥ïËá™Âä®ÂøΩÁï•Êñá‰ª∂ÔºåÁî®Êù•ÊéíÈô§ÈÇ£‰∫õ‰∏çÂ∏åÊúõ‰º†ËæìÁöÑÊñá‰ª∂--existing ‰ªÖ‰ªÖÊõ¥Êñ∞ÈÇ£‰∫õÂ∑≤ÁªèÂ≠òÂú®‰∫éDSTÁöÑÊñá‰ª∂ÔºåËÄå‰∏çÂ§á‰ªΩÈÇ£‰∫õÊñ∞ÂàõÂª∫ÁöÑÊñá‰ª∂--delete Âà†Èô§ÈÇ£‰∫õDST‰∏≠SRCÊ≤°ÊúâÁöÑÊñá‰ª∂--delete-excluded ÂêåÊ†∑Âà†Èô§Êé•Êî∂Á´ØÈÇ£‰∫õË¢´ËØ•ÈÄâÈ°πÊåáÂÆöÊéíÈô§ÁöÑÊñá‰ª∂--delete-after ‰º†ËæìÁªìÊùü‰ª•ÂêéÂÜçÂà†Èô§--ignore-errors ÂèäÊó∂Âá∫Áé∞IOÈîôËØØ‰πüËøõË°åÂà†Èô§--max-delete=NUM ÊúÄÂ§öÂà†Èô§NUM‰∏™Êñá‰ª∂--partial ‰øùÁïôÈÇ£‰∫õÂõ†ÊïÖÊ≤°ÊúâÂÆåÂÖ®‰º†ËæìÁöÑÊñá‰ª∂Ôºå‰ª•ÊòØÂä†Âø´ÈöèÂêéÁöÑÂÜçÊ¨°‰º†Ëæì--force Âº∫Âà∂Âà†Èô§ÁõÆÂΩïÔºåÂç≥‰Ωø‰∏ç‰∏∫Á©∫--numeric-ids ‰∏çÂ∞ÜÊï∞Â≠óÁöÑÁî®Êà∑ÂíåÁªÑIDÂåπÈÖç‰∏∫Áî®Êà∑ÂêçÂíåÁªÑÂêç--timeout=TIME IPË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫Áßí-I, --ignore-times ‰∏çË∑≥ËøáÈÇ£‰∫õÊúâÂêåÊ†∑ÁöÑÊó∂Èó¥ÂíåÈïøÂ∫¶ÁöÑÊñá‰ª∂--size-only ÂΩìÂÜ≥ÂÆöÊòØÂê¶Ë¶ÅÂ§á‰ªΩÊñá‰ª∂Êó∂Ôºå‰ªÖ‰ªÖÂØüÁúãÊñá‰ª∂Â§ßÂ∞èËÄå‰∏çËÄÉËôëÊñá‰ª∂Êó∂Èó¥--modify-window=NUM ÂÜ≥ÂÆöÊñá‰ª∂ÊòØÂê¶Êó∂Èó¥Áõ∏ÂêåÊó∂‰ΩøÁî®ÁöÑÊó∂Èó¥Êà≥Á™óÂè£ÔºåÈªòËÆ§‰∏∫0-T --temp-dir=DIR Âú®DIR‰∏≠ÂàõÂª∫‰∏¥Êó∂Êñá‰ª∂--compare-dest=DIR ÂêåÊ†∑ÊØîËæÉDIR‰∏≠ÁöÑÊñá‰ª∂Êù•ÂÜ≥ÂÆöÊòØÂê¶ÈúÄË¶ÅÂ§á‰ªΩ-P Á≠âÂêå‰∫é --partial--progress ÊòæÁ§∫Â§á‰ªΩËøáÁ®ã-z, --compress ÂØπÂ§á‰ªΩÁöÑÊñá‰ª∂Âú®‰º†ËæìÊó∂ËøõË°åÂéãÁº©Â§ÑÁêÜ--exclude=PATTERN ÊåáÂÆöÊéíÈô§‰∏çÈúÄË¶Å‰º†ËæìÁöÑÊñá‰ª∂Ê®°Âºè--include=PATTERN ÊåáÂÆö‰∏çÊéíÈô§ËÄåÈúÄË¶Å‰º†ËæìÁöÑÊñá‰ª∂Ê®°Âºè--exclude-from=FILE ÊéíÈô§FILE‰∏≠ÊåáÂÆöÊ®°ÂºèÁöÑÊñá‰ª∂--include-from=FILE ‰∏çÊéíÈô§FILEÊåáÂÆöÊ®°ÂºèÂåπÈÖçÁöÑÊñá‰ª∂--version ÊâìÂç∞ÁâàÊú¨‰ø°ÊÅØ--address ÁªëÂÆöÂà∞ÁâπÂÆöÁöÑÂú∞ÂùÄ--config=FILE ÊåáÂÆöÂÖ∂‰ªñÁöÑÈÖçÁΩÆÊñá‰ª∂Ôºå‰∏ç‰ΩøÁî®ÈªòËÆ§ÁöÑrsyncd.confÊñá‰ª∂--port=PORT ÊåáÂÆöÂÖ∂‰ªñÁöÑrsyncÊúçÂä°Á´ØÂè£--blocking-io ÂØπËøúÁ®ãshell‰ΩøÁî®ÈòªÂ°ûIO-stats ÁªôÂá∫Êüê‰∫õÊñá‰ª∂ÁöÑ‰º†ËæìÁä∂ÊÄÅ--progress Âú®‰º†ËæìÊó∂Áé∞ÂÆû‰º†ËæìËøáÁ®ã--log-format=formAT ÊåáÂÆöÊó•ÂøóÊñá‰ª∂Ê†ºÂºè--password-file=FILE ‰ªéFILE‰∏≠ÂæóÂà∞ÂØÜÁ†Å--bwlimit=KBPS ÈôêÂà∂I/OÂ∏¶ÂÆΩÔºåKBytes per second-h, --help ÊòæÁ§∫Â∏ÆÂä©‰ø°ÊÅØ Rsync ‰ΩøÁî®ÂÆû‰æãSSH ÊñπÂºèÂú®ÊúçÂä°Á´ØÂêØÂä® ssh ÊúçÂä°12$ service sshd startÂêØÂä® sshdÔºö [Á°ÆÂÆö] ‰ΩøÁî® rsync ËøõË°åÂêåÊ≠• Êé•‰∏ãÊù•Â∞±ÂèØ‰ª•Âú®ÂÆ¢Êà∑Á´Ø‰ΩøÁî® rsync ÂëΩ‰ª§Êù•Â§á‰ªΩÊúçÂä°Á´Ø‰∏äÁöÑÊï∞ÊçÆ‰∫ÜÔºåSSH ÊñπÂºèÊòØÈÄöËøáÁ≥ªÁªüÁî®Êà∑Êù•ËøõË°åÂ§á‰ªΩÁöÑÔºåÂ¶Ç‰∏ãÔºö123456789101112131415$ rsync -vzrtopg --progress -e ssh --delete work@172.16.78.192:/www/* /databack/experiment/rsyncwork@172.16.78.192's password:receiving file list ...5 files to considertest/a0 100% 0.00kB/s 527:35:41 (1, 20.0% of 5)b67 100% 65.43kB/s 0:00:00 (2, 40.0% of 5)c0 100% 0.00kB/s 527:35:41 (3, 60.0% of 5)dd100663296 100% 42.22MB/s 0:00:02 (4, 80.0% of 5)sent 96 bytes received 98190 bytes 11563.06 bytes/sectotal size is 100663363 speedup is 1024.19 ‰∏äÈù¢ÁöÑ‰ø°ÊÅØÊèèËø∞‰∫ÜÊï¥‰∏™ÁöÑÂ§á‰ªΩËøáÁ®ãÔºå‰ª•ÂèäÊÄªÂÖ±Â§á‰ªΩÊï∞ÊçÆÁöÑÂ§ßÂ∞è„ÄÇ ÂêéÂè∞ÊúçÂä°ÊñπÂºèÂêØÂä® rsync ÊúçÂä° ÁºñËæë / etc/xinetd.d/rsync Êñá‰ª∂ÔºåÂ∞ÜÂÖ∂‰∏≠ÁöÑ disable=yes Êîπ‰∏∫ disable=noÔºåÂπ∂ÈáçÂêØ xinetd ÊúçÂä°ÔºåÂ¶Ç‰∏ãÔºö12345678910111213# default: off# description: The rsync server is a good addition to an ftp server, as it \# allows crc checksumming etc.service rsync{disable = nosocket_type = streamwait = nouser = rootserver = /usr/bin/rsyncserver_args = --daemonlog_on_failure += USERID} 123$ /etc/init.d/xinetd restartÂÅúÊ≠¢ xinetdÔºö [Á°ÆÂÆö]ÂêØÂä® xinetdÔºö [Á°ÆÂÆö] ÊàñËÄÖËá™Â∑±ÊâãÂä®ÂêØÂä®Âπ∂Ê∑ªÂä†Ëá™ÂêØÂä®Ôºö12/usr/bin/rsync --daemon --config=/etc/rsyncd.confecho "/usr/bin/rsync --daemon --config=/etc/rsyncd.conf" >> /etc/rc.local ÂàõÂª∫ÈÖçÁΩÆÊñá‰ª∂ ÈªòËÆ§ÂÆâË£ÖÂ•Ω rsync Á®ãÂ∫èÂêéÔºåÂπ∂‰∏ç‰ºöËá™Âä®ÂàõÂª∫ rsync ÁöÑ‰∏ªÈÖçÁΩÆÊñá‰ª∂ÔºåÈúÄË¶ÅÊâãÂ∑•Êù•ÂàõÂª∫ÔºåÂÖ∂‰∏ªÈÖçÁΩÆÊñá‰ª∂‰∏∫ ‚Äú/etc/rsyncd.conf‚ÄùÔºåÂàõÂª∫ËØ•Êñá‰ª∂Âπ∂ÊèíÂÖ•Â¶Ç‰∏ãÂÜÖÂÆπÔºö123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# Minimal configuration file for rsync daemon# See rsync(1) and rsyncd.conf(5) man pages for help############################ ‰ª•‰∏ãÊòØÂÖ¨ÂÖ±ÂèÇÊï∞ÈÖçÁΩÆ ############################# This line is required by the /etc/init.d/rsyncd scriptpid file = /var/run/rsyncd.pid# ÊúçÂä°ÁöÑÁ´ØÂè£port = 873# ÊúçÂä°ÁöÑIPaddress = 10.44.201.202# ËøêË°åÁöÑÂÆø‰∏ªË¥¶Êà∑ÔºåËøôÈáå‰∏∫ÁÆÄÂçïÂ∞±root‰∫Üuid = rootgid = root# ÊâìÂºÄÔºàyesÔºâÂêéÊúâ‰∏™ÂäüËÉΩÊòØËÆ©Á¨¶Âè∑ÈìæÊé•ÂèØ‰ª•ÂêåÊ≠•ËøáÂéªÔºà‰∏çÈÄöËøáÁ¨¶Âè∑ÈìæÊé•ÂØπÂ∫îÁöÑÂÆûÈôÖÊñá‰ª∂Ôºâuse chroot = no# ÂÆ¢Êà∑Á´ØÂè™ËØªread only = yes#limit access to private LANshosts allow=10.51.56.165/255.255.255.0# hosts deny=*# ÊúÄÂ§ßËøûÊé•Êï∞max connections = 5# Ê¨¢Ëøé‰ø°ÊÅØÂØπÂ∫îÁöÑÊñá‰ª∂# motd file = /etc/rsyncd.motd# ÂÆ¢Êà∑Á´ØÈìæÊé•ÁöÑË∂ÖÊó∂Êó∂Èó¥timeout = 300# ‰ª•‰∏ãÊòØÊó•ÂøóÁõ∏ÂÖ≥ÈÖçÁΩÆÔºåÂèØÈÄâ‰ΩøÁî®Áã¨Á´ãÊó•ÂøóÊñá‰ª∂ÂíåÁ≥ªÁªüÊó•Âøó# This will give you a separate log file# log file = /var/log/rsync.log# This will log every file transferred - up to 85,000+ per user, per sync# transfer logging = yes# log format = %t %a %m %f %b# syslog facility = local3############################# ÂêåÊ≠•Ê®°ÂùóÈÖçÁΩÆ ################################[thrift]# ÈúÄË¶ÅÂêåÊ≠•ÁöÑË∑ØÂæÑpath = /data/JiemoLucenes# ÂÆ¢Êà∑Á´ØÂèØ‰ª•‰ΩøÁî®listÂëΩ‰ª§ÂàóË°®ÊòæÁ§∫list=yes# ÂøΩÁï•ÈîôËØØignore errors# ËÆ§ËØÅÁî®Êà∑auth users = root# ËÆ§ËØÅ‰ΩøÁî®ÁöÑË¥¶Êà∑ÂØÜÁ†ÅÊñá‰ª∂secrets file = /etc/rsyncd.secrets# Â§áÊ≥®‰ø°ÊÅØcomment = This is nexus data# Â¶ÇÊûúÊúâÂøΩÁï•ÁöÑÂ≠êÁõÆÂΩïÔºåÂèØ‰ª•ÈÄöËøáexcludeÂÆö‰πâ# exclude = easylife/ samba/ ÂàõÂª∫ÂØÜÁ†ÅÊñá‰ª∂ÈááÁî®ËøôÁßçÊñπÂºè‰∏çËÉΩ‰ΩøÁî®Á≥ªÁªüÁî®Êà∑ÂØπÂÆ¢Êà∑Á´ØËøõË°åËÆ§ËØÅÔºåÊâÄ‰ª•ÈúÄË¶ÅÂàõÂª∫‰∏Ä‰∏™ÂØÜÁ†ÅÊñá‰ª∂ÔºåÂÖ∂Ê†ºÂºè‰∏∫ ‚Äúusername:password‚ÄùÔºåÁî®Êà∑ÂêçÂèØ‰ª•ÂíåÂØÜÁ†ÅÂèØ‰ª•Èöè‰æøÂÆö‰πâÔºåÊúÄÂ•Ω‰∏çË¶ÅÂíåÁ≥ªÁªüÂ∏êÊà∑‰∏ÄËá¥ÔºåÂêåÊó∂Ë¶ÅÊääÂàõÂª∫ÁöÑÂØÜÁ†ÅÊñá‰ª∂ÊùÉÈôêËÆæÁΩÆ‰∏∫ 600ÔºåËøôÂú®ÂâçÈù¢ÁöÑÊ®°ÂùóÂèÇÊï∞ÂÅö‰∫ÜËØ¶ÁªÜ‰ªãÁªç„ÄÇ12echo "work:abc123" > /etc/rsyncd.passwdchmod 600 /etc/rsyncd.passwd Â§á‰ªΩÂÆåÊàê‰ª•‰∏äÂ∑•‰ΩúÔºåÁé∞Âú®Â∞±ÂèØ‰ª•ÂØπÊï∞ÊçÆËøõË°åÂ§á‰ªΩ‰∫ÜÔºåÂ¶Ç‰∏ãÔºö123456789101112131415$ rsync -avz --progress --delete work@172.16.78.192::www /databack/experiment/rsyncPassword:receiving file list ...6 files to consider./ files...a0 100% 0.00kB/s 528:20:41 (1, 50.0% of 6)b67 100% 65.43kB/s 0:00:00 (2, 66.7% of 6)c0 100% 0.00kB/s 528:20:41 (3, 83.3% of 6)dd100663296 100% 37.49MB/s 0:00:02 (4, 100.0% of 6)sent 172 bytes received 98276 bytes 17899.64 bytes/sectotal size is 150995011 speedup is 1533.75 ÊÅ¢Â§çÂΩìÊúçÂä°Âô®ÁöÑÊï∞ÊçÆÂá∫Áé∞ÈóÆÈ¢òÊó∂ÔºåÈÇ£‰πàËøôÊó∂Â∞±ÈúÄË¶ÅÈÄöËøáÂÆ¢Êà∑Á´ØÁöÑÊï∞ÊçÆÂØπÊúçÂä°Á´ØËøõË°åÊÅ¢Â§çÔºå‰ΩÜÂâçÊèêÊòØÊúçÂä°Á´ØÂÖÅËÆ∏ÂÆ¢Êà∑Á´ØÊúâÂÜôÂÖ•ÊùÉÈôêÔºåÂê¶Âàô‰πü‰∏çËÉΩÂú®ÂÆ¢Êà∑Á´ØÁõ¥Êé•ÂØπÊúçÂä°Á´ØËøõË°åÊÅ¢Â§çÔºå‰ΩøÁî® rsync ÂØπÊï∞ÊçÆËøõË°åÊÅ¢Â§çÁöÑÊñπÊ≥ïÂ¶Ç‰∏ãÔºö1234567891011$ rsync -avz --progress /databack/experiment/rsync/ work@172.16.78.192::wwwPassword:building file list ...6 files to consider./ab67 100% 0.00kB/s 0:00:00 (2, 66.7% of 6)csent 258 bytes received 76 bytes 95.43 bytes/sectotal size is 150995011 speedup is 452080.87 Á§∫‰æãËÑöÊú¨ËøôÈáåËøô‰∫õËÑöÊú¨ÈÉΩÊòØ rsync ÁΩëÁ´ô‰∏äÁöÑ‰æãÂ≠êÔºö1„ÄÅÊØèÈöî‰∏ÉÂ§©Â∞ÜÊï∞ÊçÆÂæÄ‰∏≠ÂøÉÊúçÂä°Âô®ÂÅöÂ¢ûÈáèÂ§á‰ªΩ1234567891011121314151617181920212223242526272829303132333435#!/bin/sh# This script does personal backups to a rsync backup server. You will end up# with a 7 day rotating incremental backup. The incrementals will go# into subdirectories named after the day of the week, and the current# full backup goes into a directory called "current"# tridge@linuxcare.com# directory to backupBDIR=/home/$USER# excludes file - this contains a wildcard pattern per line of files to excludeEXCLUDES=$HOME/cron/excludes# the name of the backup machineBSERVER=owl# your password on the backup serverexport RSYNC_PASSWORD=XXXXXX#######################################################################BACKUPDIR=`date +%A`OPTS="--force --ignore-errors --delete-excluded --exclude-from=$EXCLUDES--delete --backup --backup-dir=/$BACKUPDIR -a"export PATH=$PATH:/bin:/usr/bin:/usr/local/bin# the following line clears the last weeks incremental directory[ -d $HOME/emptydir ] || mkdir $HOME/emptydirrsync --delete -a $HOME/emptydir/ $BSERVER::$USER/$BACKUPDIR/rmdir $HOME/emptydir# now the actual transferrsync $OPTS $BDIR $BSERVER::$USER/current 2„ÄÅÂ§á‰ªΩËá≥‰∏Ä‰∏™Á©∫Èó≤ÁöÑÁ°¨Áõò12345678910111213141516#!/bin/shexport PATH=/usr/local/bin:/usr/bin:/binLIST="rootfs usr data data2"for d in $LIST; domount /backup/$drsync -ax --exclude fstab --delete /$d/ /backup/$d/umount /backup/$ddoneDAY=`date "+%A"`rsync -a --delete /usr/local/apache /data2/backups/$DAYrsync -a --delete /data/solid /data2/backups/$DAY 3„ÄÅÂØπ vger.rutgers.edu ÁöÑ cvs Ê†ëËøõË°åÈïúÂÉè1234567891011121314151617181920212223#!/bin/bashcd /var/www/cvs/vger/PATH=/usr/local/bin:/usr/freeware/bin:/usr/bin:/binRUN=`lps x | grep rsync | grep -v grep | wc -l`if [ "$RUN" -gt 0 ]; thenecho already runningexit 1firsync -az vger.rutgers.edu::cvs/CVSROOT/ChangeLog $HOME/ChangeLogsum1=`sum $HOME/ChangeLog`sum2=`sum /var/www/cvs/vger/CVSROOT/ChangeLog`if [ "$sum1" = "$sum2" ]; thenecho nothing to doexit 0firsync -az --delete --force vger.rutgers.edu::cvs/ /var/www/cvs/vger/exit 0 FAQQÔºöÂ¶Ç‰ΩïÈÄöËøá ssh ËøõË°å rsyncÔºåËÄå‰∏îÊó†È°ªËæìÂÖ•ÂØÜÁ†ÅÔºü AÔºöÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂá†‰∏™Ê≠•È™§ * ÈÄöËøá ssh-keygen Âú® server A ‰∏äÂª∫Á´ã SSH keysÔºå‰∏çË¶ÅÊåáÂÆöÂØÜÁ†ÅÔºå‰Ω†‰ºöÂú®~/.ssh ‰∏ãÁúãÂà∞ identity Âíå identity.pub Êñá‰ª∂ * Âú® server B ‰∏äÁöÑ home ÁõÆÂΩïÂª∫Á´ãÂ≠êÁõÆÂΩï. ssh * Â∞Ü A ÁöÑ identity.pub Êã∑Ë¥ùÂà∞ server B ‰∏ä * Â∞Ü identity.pub Âä†Âà∞`~[user b]/.ssh/authorized_keys` * ‰∫éÊòØ server A ‰∏äÁöÑ A Áî®Êà∑ÔºåÂèØÈÄöËøá‰∏ãÈù¢ÂëΩ‰ª§‰ª•Áî®Êà∑ B ssh Âà∞ server B ‰∏ä‰∫Ü e.g.`ssh -l userB serverB` * ËøôÊ†∑Â∞±‰Ωø server A ‰∏äÁöÑÁî®Êà∑ A Â∞±ÂèØ‰ª• ssh ‰ª•Áî®Êà∑ B ÁöÑË∫´‰ªΩÊó†ÈúÄÂØÜÁ†ÅÁôªÈôÜÂà∞ server B ‰∏ä‰∫Ü„ÄÇ QÔºöÂ¶Ç‰ΩïÈÄöËøáÂú®‰∏çÂç±ÂÆ≥ÂÆâÂÖ®ÁöÑÊÉÖÂÜµ‰∏ãÈÄöËøáÈò≤ÁÅ´Â¢ô‰ΩøÁî® rsync? AÔºöËß£Á≠îÂ¶Ç‰∏ãÔºö ËøôÈÄöÂ∏∏Êúâ‰∏§ÁßçÊÉÖÂÜµÔºå‰∏ÄÁßçÊòØÊúçÂä°Âô®Âú®Èò≤ÁÅ´Â¢ôÂÜÖÔºå‰∏ÄÁßçÊòØÊúçÂä°Âô®Âú®Èò≤ÁÅ´Â¢ôÂ§ñ„ÄÇÊó†ËÆ∫Âì™ÁßçÊÉÖÂÜµÔºåÈÄöÂ∏∏ËøòÊòØ‰ΩøÁî® sshÔºåËøôÊó∂ÊúÄÂ•ΩÊñ∞Âª∫‰∏Ä‰∏™Â§á‰ªΩÁî®Êà∑ÔºåÂπ∂‰∏îÈÖçÁΩÆ sshd ‰ªÖÂÖÅËÆ∏Ëøô‰∏™Áî®Êà∑ÈÄöËøá RSA ËÆ§ËØÅÊñπÂºèËøõÂÖ•„ÄÇÂ¶ÇÊûúÊúçÂä°Âô®Âú®Èò≤ÁÅ´Â¢ôÂÜÖÔºåÂàôÊúÄÂ•ΩÈôêÂÆöÂÆ¢Êà∑Á´ØÁöÑ IP Âú∞ÂùÄÔºåÊãíÁªùÂÖ∂ÂÆÉÊâÄÊúâËøûÊé•„ÄÇÂ¶ÇÊûúÂÆ¢Êà∑Êú∫Âú®Èò≤ÁÅ´Â¢ôÂÜÖÔºåÂàôÂèØ‰ª•ÁÆÄ ÂçïÂÖÅËÆ∏Èò≤ÁÅ´Â¢ôÊâìÂºÄ TCP Á´ØÂè£ 22 ÁöÑ ssh Â§ñÂèëËøûÊé•Â∞± ok ‰∫Ü„ÄÇ QÔºöÊàëËÉΩÂ∞ÜÊõ¥ÊîπËøáÊàñËÄÖÂà†Èô§ÁöÑÊñá‰ª∂‰πüÂ§á‰ªΩ‰∏äÊù•ÂêóÔºü AÔºöÂΩìÁÑ∂ÂèØ‰ª•Ôºö ‰Ω†ÂèØ‰ª•‰ΩøÁî®Â¶ÇÔºörsync -other -options -backupdir = ./backup-2000-2-13 ...ËøôÊ†∑ÁöÑÂëΩ‰ª§Êù•ÂÆûÁé∞„ÄÇËøôÊ†∑Â¶ÇÊûúÊ∫êÊñá‰ª∂:/path/to/some/file.c ÊîπÂèò‰∫ÜÔºåÈÇ£‰πàÊóßÁöÑÊñá‰ª∂Â∞±‰ºöË¢´ÁßªÂà∞./backup-2000-2-13/path/to/some/file.cÔºåËøôÈáåËøô‰∏™ÁõÆÂΩïÈúÄË¶ÅËá™Â∑±ÊâãÂ∑•Âª∫Á´ãËµ∑Êù• QÔºöÊàëÈúÄË¶ÅÂú®Èò≤ÁÅ´Â¢ô‰∏äÂºÄÊîæÂì™‰∫õÁ´ØÂè£‰ª•ÈÄÇÂ∫î rsyncÔºü AÔºöËßÜÊÉÖÂÜµËÄåÂÆö rsync ÂèØ‰ª•Áõ¥Êé•ÈÄöËøá 873 Á´ØÂè£ÁöÑ tcp ËøûÊé•‰º†Êñá‰ª∂Ôºå‰πüÂèØ‰ª•ÈÄöËøá 22 Á´ØÂè£ÁöÑ ssh Êù•ËøõË°åÊñá‰ª∂‰º†ÈÄíÔºå‰ΩÜ‰Ω†‰πüÂèØ‰ª•ÈÄöËøá‰∏ãÂàóÂëΩ‰ª§ÊîπÂèòÂÆÉÁöÑÁ´ØÂè£Ôºörsync --port 8730 otherhost::ÊàñËÄÖrsync -e 'ssh -p 2002' otherhost: QÔºöÊàëÂ¶Ç‰ΩïÈÄöËøá rsync Âè™Â§çÂà∂ÁõÆÂΩïÁªìÊûÑÔºåÂøΩÁï•ÊéâÊñá‰ª∂Âë¢Ôºü AÔºörsync -av --include '*/' --exclude '*' source-dir dest-dir QÔºö‰∏∫‰ªÄ‰πàÊàëÊÄª‰ºöÂá∫Áé∞ ‚ÄúRead-only file system‚Äù ÁöÑÈîôËØØÂë¢Ôºü AÔºöÁúãÁúãÊòØÂê¶Âøò‰∫ÜËÆæ ‚Äúread only = no‚Äù ‰∫Ü QÔºö‰∏∫‰ªÄ‰πàÊàë‰ºöÂá∫Áé∞‚Äò@ERROR: invalid gid‚ÄôÁöÑÈîôËØØÂë¢Ôºü AÔºörsync ‰ΩøÁî®Êó∂ÈªòËÆ§ÊòØÁî® uid=nobody;gid=nobody Êù•ËøêË°åÁöÑÔºåÂ¶ÇÊûú‰Ω†ÁöÑÁ≥ªÁªü‰∏çÂ≠òÂú® nobody ÁªÑÁöÑËØùÔºåÂ∞±‰ºöÂá∫Áé∞ËøôÊ†∑ÁöÑÈîôËØØÔºåÂèØ‰ª•ËØïËØï gid = nogroup ÊàñËÄÖÂÖ∂ÂÆÉ QÔºöÁªëÂÆöÁ´ØÂè£ 873 Â§±Ë¥•ÊòØÊÄé‰πàÂõû‰∫ãÔºü AÔºöÂ¶ÇÊûú‰Ω†‰∏çÊòØ‰ª• root ÊùÉÈôêËøêË°åËøô‰∏ÄÂÆàÊä§ËøõÁ®ãÁöÑËØùÔºåÂõ†‰∏∫ 1024 Á´ØÂè£‰ª•‰∏ãÊòØÁâπÊùÉÁ´ØÂè£Ôºå‰ºöÂá∫Áé∞ËøôÊ†∑ÁöÑÈîôËØØ„ÄÇ‰Ω†ÂèØ‰ª•Áî®‚Äìport ÂèÇÊï∞Êù•ÊîπÂèò„ÄÇ QÔºö‰∏∫‰ªÄ‰πàÊàëËÆ§ËØÅÂ§±Ë¥•Ôºü AÔºö‰ªé‰Ω†ÁöÑÂëΩ‰ª§Ë°åÁúãÊù•Ôºö123$ rsync -a 144.16.251.213::test testPassword:@ERROR: auth failed on module test Â∫îËØ•ÊòØÊ≤°Êúâ‰ª•‰Ω†ÁöÑÁî®Êà∑ÂêçÁôªÈôÜÂØºËá¥ÁöÑÈóÆÈ¢òÔºåËØïËØïrsync -a max@144.16.251.213::test test document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Modules ÂàùËØï -- Go ÂåÖÁÆ°ÁêÜËß£ÂÜ≥‰πãÈÅì]]></title>
    <url>%2F2019%2F03%2F29%2FgoModules%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄGo ÁöÑÂåÖÁÆ°ÁêÜÊòØ‰∏ÄÁõ¥ÊòØ‰∏∫‰∫∫ËØüÁóÖ‰πãÂ§ÑÔºå‰ªé Go 1.5 ÂºïÂÖ•ÁöÑ vendor Êú∫Âà∂ÔºåÂà∞ÂáÜÂÆòÊñπÂ∑•ÂÖ∑ depÔºåÁõÆÂâç‰∏∫Ê≠¢ËøòÊ≤°‰∏Ä‰∏™ÁÆÄ‰æøÁöÑËß£ÂÜ≥ÊñπÊ°à ‰∏çËøáÁé∞Âú® go modules ÈöèÁùÄ golang1.11 ÁöÑÂèëÂ∏ÉËÄåÂíåÊàë‰ª¨ËßÅÈù¢‰∫ÜÔºåËøôÊòØÂÆòÊñπÊèêÂÄ°ÁöÑÊñ∞ÁöÑÂåÖÁÆ°ÁêÜÔºå‰πÉËá≥È°πÁõÆÁÆ°ÁêÜÊú∫Âà∂ÔºåÂèØ‰ª•‰∏çÂÜçÈúÄË¶Å GOPATH ÁöÑÂ≠òÂú®„ÄÇ Ê¨£Âñú‰πã‰ΩôÔºåËµ∂Á¥ß‰∏äÊâãÊù•ËØï‰∏Ä‰∏ãÂêß~ Go modules ÁöÑÂâç‰∏ñ‰ªäÁîü ËØ¥Ëµ∑ Go ÁöÑÂåÖ‰æùËµñÁÆ°ÁêÜÔºå‰Ωú‰∏∫ Google ËÑëÊÆãÁ≤âÁöÑÊàë‰πüÊòØËøûËøûÂèπÊ∞î„ÄÇ„ÄÇ„ÄÇ Â¶ÇÊûúËØ¥ Java(Maven) ÊòØÂù® shit ÁöÑËØùÔºåÈÇ£ Go ÁúüÊòØËøû Java ÈÉΩ‰∏çÂ¶Ç„ÄÇ Ëá™ 2007 Âπ¥ ‚Äú‰∏âÂ∑®Â§¥‚ÄùÔºàRobert Griesemer, Rob Pike, Ken ThompsonÔºâÊèêÂá∫ËÆæËÆ°ÂíåÂÆûÁé∞ Go ËØ≠Ë®Ä‰ª•Êù•ÔºåËøôÈó®ËØ≠Ë®ÄÂ∑≤ÁªèÂèëÂ±ïÂíåÊºîÂåñ‰∫ÜÂçÅ‰ΩôÂπ¥‰∫Ü„ÄÇ ‰ΩÜÊòØËá™‰ªé Go ËØ≠Ë®ÄËØûÁîü‰ª•Êù•ÂêßÔºåÂ§ß‰Ω¨‰ª¨Â∞±ËÆ§‰∏∫go get Â∑≤ÁªèÊå∫Â•Ω‰∫ÜÔºåÊ≤°ÂøÖË¶ÅÂÜçÈ¢ùÂ§ñÈÄ†‰∏Ä‰∏™ËΩÆÂ≠ê‰∫Ü‚Äî‚ÄîÂåÖÁÆ°ÁêÜÂô®„ÄÇ ‰πüËÆ∏ÊòØÂ§ß‰Ω¨‰ª¨ÈÉΩ‰∏çÈúÄË¶ÅÂõ¢ÈòüÂºÄÂèëÂêßÔºå‰ΩÜÊòØÂ§ß‰Ω¨ÊØïÁ´üÊòØÂ∞ëÊï∞Ôºå‰∫éÊòØÔºåÂêÑÁßçÂêÑÊ†∑ÁöÑÁ§æÂå∫Ëß£ÂÜ≥ÊñπÊ°àÂ∞±Âá∫Áé∞‰∫ÜÔºåÂèØË∞ìÊòØÁôæÂÆ∂‰∫âÈ∏£„ÄÇ dep manul - Vendor packages using git submodules. Godep Govendor godm govend - Manage dependencies like go get but for /vendor. Glide - Manage packages like composer, npm, bundler, or other languages. ÂΩìÂàùÁúãÂà∞Ëøô‰∏™ÂàóË°®ÁöÑÊó∂ÂÄôÔºåÊàë‰∏çÁ¶ÅÊÑüÊÖ®Ôºö‚ÄúËøô‰πàÂ§öÁöÑËß£ÂÜ≥ÊñπÊ°àÔºåÂèØÁúüÊòØÊåëËä±‰∫ÜÊúïÁöÑÁúºÁùõÂëÄ„ÄÇ‚Äù Go ÂÆòÊñπËØ¥Ôºö‚ÄúËé´ÊÄ•ÔºåËøô‰ªΩÂÆòÊñπÂØπÊØîÊãøÂ•Ω‰∏çË∞¢„ÄÇ‚Äù Go Âú®ÊûÑÂª∫ËÆæËÆ°ÊñπÈù¢Ê∑±Âèó Google ÂÜÖÈÉ®ÂºÄÂèëÂÆûË∑µÁöÑÂΩ±ÂìçÔºåÊØîÂ¶Ç go get ÁöÑËÆæËÆ°Â∞±Ê∑±Âèó Google ÂÜÖÈÉ®Âçï‰∏Ä‰ª£Á†Å‰ªìÂ∫ì (single monorepo) ÂíåÂü∫‰∫é‰∏ªÂπ≤ (trunk/mainline based) ÁöÑÂºÄÂèëÊ®°ÂûãÁöÑÂΩ±ÂìçÔºöÂè™Ëé∑Âèñ Trunk/mainline ‰ª£Á†ÅÂíåÁâàÊú¨Êó†ÊÑüÁü•„ÄÇ Google ÂÜÖÈÉ®Âü∫‰∫é‰∏ªÂπ≤ÁöÑÂºÄÂèëÊ®°ÂûãÔºö ÊâÄÊúâÂºÄÂèë‰∫∫ÂëòÂü∫‰∫é‰∏ªÂπ≤ trunk/mainline ÂºÄÂèëÔºöÊèê‰∫§Âà∞ trunk Êàñ‰ªé trunk Ëé∑ÂèñÊúÄÊñ∞ÁöÑ‰ª£Á†ÅÔºàÂêåÊ≠•Âà∞Êú¨Âú∞ workspaceÔºâ ÁâàÊú¨ÂèëÂ∏ÉÊó∂ÔºåÂª∫Á´ã Release branchÔºårelease branch ÂÆûË¥®‰∏äÂ∞±ÊòØÊüê‰∏Ä‰∏™Êó∂Âàª‰∏ªÂπ≤‰ª£Á†ÅÁöÑÂø´ÁÖß ÂøÖÈ°ªÂêåÊ≠•Âà∞ release branch ‰∏äÁöÑ bug fix ÂíåÂ¢ûÂº∫ÊîπËøõ‰ª£Á†Å‰πüÈÄöÂ∏∏ÊòØÂÖàÂú® trunk ‰∏äÊèê‰∫§ (commit)ÔºåÁÑ∂ÂêéÂÜç cherry-pick Âà∞ release branch ‰∏ä Êàë‰ª¨Áü•ÈÅì go get Ëé∑ÂèñÁöÑ‰ª£Á†Å‰ºöÊîæÂú® $GOPATH/src ‰∏ãÈù¢ÔºåËÄå go build ‰ºöÂú® $GOROOT/src Âíå \$GOPATH/src ‰∏ãÈù¢ÊåâÁÖß import path ÂéªÊêúÁ¥¢ packageÔºåÁî±‰∫é go get Ëé∑ÂèñÁöÑÈÉΩÊòØÂêÑ‰∏™ package repo ÁöÑ trunk/mainline ÁöÑ‰ª£Á†ÅÔºåÂõ†Ê≠§ÔºåGo 1.5 ‰πãÂâçÁöÑ Go compiler ÈÉΩÊòØÂü∫‰∫éÁõÆÊ†á Go Á®ãÂ∫è‰æùËµñÂåÖÁöÑ trunk/mainline ‰ª£Á†ÅÂéªÁºñËØëÁöÑ„ÄÇËøôÊ†∑ÁöÑÊú∫Âà∂Â∏¶Êù•ÁöÑÈóÆÈ¢òÊòØÊòæËÄåÊòìËßÅÁöÑÔºåËá≥Â∞ëÂåÖÊã¨Ôºö Âõ†‰æùËµñÂåÖÁöÑ trunk ÁöÑÂèòÂåñÔºåÂØºËá¥‰∏çÂêå‰∫∫Ëé∑ÂèñÂíåÁºñËØë‰Ω†ÁöÑÂåÖ / Á®ãÂ∫èÊó∂ÂæóÂà∞ÁöÑÁªìÊûúÂÆûË¥®ÊòØ‰∏çÂêåÁöÑÔºåÂç≥‰∏çËÉΩÂÆûÁé∞ reproduceable build Âõ†‰æùËµñÂåÖÁöÑ trunk ÁöÑÂèòÂåñÔºåÂºïÂÖ•‰∏çÂÖºÂÆπÁöÑÂÆûÁé∞ÔºåÂØºËá¥‰Ω†ÁöÑÂåÖ / Á®ãÂ∫èÊó†Ê≥ïÈÄöËøáÁºñËØë Âõ†‰æùËµñÂåÖÊºîËøõËÄåÊó†Ê≥ïÈÄöËøáÁºñËØëÔºåÂØºËá¥‰Ω†ÁöÑÂåÖ / Á®ãÂ∫èÊó†Ê≥ïÈÄöËøáÁºñËØë ‰∏∫‰∫ÜÂÆûÁé∞ reporduceable buildÔºåGo 1.5 ÂºïÂÖ•‰∫Ü Vendor Êú∫Âà∂ÔºåGo ÁºñËØëÂô®‰ºö‰ºòÂÖàÂú® vendor ‰∏ãÊêúÁ¥¢‰æùËµñÁöÑÁ¨¨‰∏âÊñπÂåÖÔºåËøôÊ†∑Â¶ÇÊûúÂºÄÂèëËÄÖÂ∞ÜÁâπÂÆöÁâàÊú¨ÁöÑ‰æùËµñÂåÖÂ≠òÊîæÂú® vendor ‰∏ãÈù¢Âπ∂Êèê‰∫§Âà∞ code repoÔºåÈÇ£‰πàÊâÄÊúâ‰∫∫ÁêÜËÆ∫‰∏äÈÉΩ‰ºöÂæóÂà∞ÂêåÊ†∑ÁöÑÁºñËØëÁªìÊûúÔºå‰ªéËÄåÂÆûÁé∞ reporduceable build„ÄÇ Âú® Go 1.5 ÂèëÂ∏ÉÂêéÁöÑËã•Âπ≤Âπ¥Ôºågopher ‰ª¨ÊääÊ≥®ÊÑèÂäõÈÉΩÈõÜ‰∏≠Âú®Â¶Ç‰ΩïÂà©Áî® vendor Ëß£ÂÜ≥ÂåÖ‰æùËµñÈóÆÈ¢òÔºå‰ªéÊâãÂ∑•Ê∑ªÂä†‰æùËµñÂà∞ vendor„ÄÅÊâãÂ∑•Êõ¥Êñ∞‰æùËµñÔºåÂà∞‰∏Ä‰ºóÂåÖ‰æùËµñÁÆ°ÁêÜÂ∑•ÂÖ∑ÁöÑËØûÁîüÔºåÊØîÂ¶ÇÔºöGovendor„ÄÅglide ‰ª•ÂèäÂè∑Áß∞ÂáÜÂÆòÊñπÂ∑•ÂÖ∑ÁöÑ depÔºåÂä™ÂäõÂú∞Â∞ùËØïÁùÄÊåâÁÖßÂΩì‰ªä‰∏ªÊµÅÊÄùË∑ØËß£ÂÜ≥ÁùÄËØ∏Â¶Ç ‚ÄúÈíªÁü≥Âûã‰æùËµñ‚Äù Á≠âÈöæÈ¢ò„ÄÇ Ê≠£ÂΩì gopher ËÆ§‰∏∫ dep Â∞Ü ‚ÄúÈ°∫ÁêÜÊàêÁ´†‚Äù Âú∞ÂçáÁ∫ß‰∏∫ go toolchain ‰∏ÄÈÉ®ÂàÜÁöÑÊó∂ÂÄôÔºå‰ªäÂπ¥Âπ¥ÂàùÔºåGo Ê†∏ÂøÉ Team ÁöÑÊäÄÊúØ leaderÔºå‰πüÊòØ Go Team ÊúÄÊó©ÊúüÊàêÂëò‰πã‰∏ÄÁöÑ Russ Cox Âú®‰∏™‰∫∫ÂçöÂÆ¢‰∏äËøûÁª≠ÂèëË°®‰∫Ü‰∏ÉÁØáÊñáÁ´†ÔºåÁ≥ªÁªüÈòêËø∞‰∫Ü Go team Ëß£ÂÜ≥‚Äù ÂåÖ‰æùËµñÁÆ°ÁêÜ‚Äù ÁöÑÊäÄÊúØÊñπÊ°à: vgo ‚Äî‚Äî modules ÁöÑÂâçË∫´„ÄÇ vgo ÁöÑ‰∏ªË¶ÅÊÄùË∑ØÂåÖÊã¨ÔºöSemantic Import Versioning„ÄÅMinimal Version Selection„ÄÅÂºïÂÖ• Go module Á≠â„ÄÇËøô‰∏ÉÁØáÊñáÁ´†ÁöÑÂèëÂ∏ÉÂºïÂèë‰∫Ü Go Á§æÂå∫ÊøÄÁÉàÂú∞‰∫âËÆ∫ÔºåÂ∞§ÂÖ∂ÊòØ MVS(ÊúÄÂ∞èÁâàÊú¨ÈÄâÊã©) ‰∏éÁõÆÂâç‰∏ªÊµÅÁöÑ‰æùËµñÁâàÊú¨ÈÄâÊã©ÊñπÊ≥ïÁöÑÁõ∏ÊÇñËÆ©ÂæàÂ§ö‰º†Áªü Go ÂåÖÁÆ°ÁêÜÂ∑•ÂÖ∑ÁöÑÁª¥Êä§ËÄÖ‚Äù ‰∏çÊª°‚ÄùÔºåÂ∞§ÂÖ∂ÊòØ‚Äù ÂáÜÂÆòÊñπÂ∑•ÂÖ∑‚ÄùÔºödep„ÄÇvgo ÊñπÊ°àÁöÑÊèêÂá∫‰πüÊÑèÂë≥ÁùÄ dep È°πÁõÆÁöÑÁîüÂëΩÂë®ÊúüÂç≥Â∞ÜËøõÂÖ•Â∞æÂ£∞„ÄÇ 5 Êúà‰ªΩÔºåRuss Cox ÁöÑ Proposal ‚Äúcmd/go: add package version support to Go toolchain‚Äù Ë¢´ acceptedÔºåËøôÂë®‰∫îÊó©‰∫õÊó∂ÂÄô Russ Cox Â∞Ü vgo ÁöÑ‰ª£Á†Å merge Âà∞ Go ‰∏ªÂπ≤ÔºåÂπ∂Â∞ÜËøôÂ•óÊú∫Âà∂Ê≠£ÂºèÂëΩÂêç‰∏∫‚Äùgo modules‚Äù„ÄÇÁî±‰∫é vgo È°πÁõÆÊú¨Ë∫´Â∞±ÊòØ‰∏Ä‰∏™ÂÆûÈ™åÂéüÂûãÔºåmerge Âà∞‰∏ªÂπ≤ÂêéÔºåvgo Ëøô‰∏™ÊúØËØ≠‰ª•Âèä vgo È°πÁõÆÁöÑ‰ΩøÂëΩ‰πüÂ∞±Â∞±Ê≠§ÁªìÊùü‰∫Ü„ÄÇÂêéÁª≠ Go modules Êú∫Âà∂Â∞ÜÁõ¥Êé•Âú® Go ‰∏ªÂπ≤‰∏äÁªßÁª≠ÊºîÂåñ„ÄÇ Go modules ÊòØ Go team Âú®Ëß£ÂÜ≥ÂåÖ‰æùËµñÁÆ°ÁêÜÊñπÈù¢ÁöÑ‰∏ÄÊ¨°ÂãáÊï¢Â∞ùËØïÔºåÊó†ËÆ∫Â¶Ç‰ΩïÔºåÂØπ Go ËØ≠Ë®ÄÊù•ËØ¥ÈÉΩÊòØ‰∏Ä‰∏™Â•Ω‰∫ã„ÄÇ Go modules ‰∏äÊâãËøôÈáåÂ∞±Áî® Gin Ê°ÜÊû∂Êù•ÂÆûÁé∞‰∏§‰∏™ RESTful API ‰ΩúÁ§∫‰æãÂêßÔºåÁõÆÂΩïÁªìÊûÑÂ¶Ç‰∏ãÔºå‰∏§‰∏™ handler ÂàÜÂà´Â±û‰∫é main Âíå pkg/api/data Ëøô‰∏§‰∏™ package123456mytest‚îú‚îÄ‚îÄ main.go‚îî‚îÄ‚îÄ pkg ‚îî‚îÄ‚îÄ api ‚îî‚îÄ‚îÄ data ‚îî‚îÄ‚îÄ api.go ËøõÂÖ• myproj ÁõÆÂΩïÔºåÁÑ∂Âêé‰ΩøÁî® go mod Âª∫Á´ã modules12$ go mod init github.com/wangjiemin/mytestgo: creating new go.mod: module github.com/wangjiemin/mytest Ê≠§Êó∂‰ºöËá™Âä®‰∫ßÁîü‰∏Ä‰∏™ go.mod Êñá‰ª∂ÔºåÊâìÂºÄÁúãÂà∞ÈáåËæπÂÜÖÂÆπÂè™Êúâ‰∏ÄË°å1module github.com/wangjiemin/mytest Áé∞Âú®ÂºÄÂßãÂÜôÊàë‰ª¨ÁöÑ‰∏§‰∏™ handler1.pkg/api/data/api.go123456789101112131415package dataimport ( "net/http" "github.com/gin-gonic/gin")// GetDataAPIHealthHandler GET /health-dataapi to expose heathy check result of data APIfunc GetDataAPIHealthHandler(c *gin.Context) { // do something to check heathy of data API c.JSON(http.StatusOK, gin.H{ "code": 0, "message": "Data API is alive", })} 2.main.go1234567891011121314151617181920212223242526272829package mainimport ( dataapi "github.com/wangjiemin/mytest/pkg/api/data" "net/http" "github.com/gin-gonic/gin")func main() { router := gin.Default() router.GET("/health", GetHealthHandler) router.GET("/health-dataapi", dataapi.GetDataAPIHealthHandler) s := &http.Server{ Addr: ":8000", Handler: router, } s.ListenAndServe()}// GetHealthHandler - GET /health to expose service healthfunc GetHealthHandler(c *gin.Context) { c.JSON(http.StatusOK, gin.H{ "code": 0, "message": "Service is alive!", })} ÁÑ∂ÂêéÁî®Êàë‰ª¨ÁöÑËÄÅÊúãÂèã go build ÂàõÂª∫ÂèØÊâßË°åÊñá‰ª∂1234567891011121314151617$ go build -o bin/main main.gogo: finding github.com/gin-gonic/gin v1.3.0go: downloading github.com/gin-gonic/gin v1.3.0go: finding github.com/gin-contrib/sse latestgo: finding github.com/ugorji/go/codec latestgo: finding github.com/golang/protobuf/proto latestgo: finding github.com/mattn/go-isatty v0.0.4go: finding gopkg.in/yaml.v2 v2.2.1go: finding gopkg.in/go-playground/validator.v8 v8.18.2go: downloading github.com/gin-contrib/sse v0.0.0-20170109093832-22d885f9ecc7go: downloading github.com/mattn/go-isatty v0.0.4go: downloading github.com/ugorji/go/codec v0.0.0-20181022190402-e5e69e061d4fgo: finding github.com/golang/protobuf v1.2.0go: downloading gopkg.in/yaml.v2 v2.2.1go: downloading gopkg.in/go-playground/validator.v8 v8.18.2go: downloading github.com/golang/protobuf v1.2.0go: finding gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405 ÂèØ‰ª•ÁúãÂà∞ go compiler ‰∏ªÂä®‰∏ãËΩΩ‰∫ÜÁõ∏ÂÖ≥ package„ÄÇ ÈÇ£‰πàËøô‰∫õ package Ë¢´‰∏ãËΩΩÂà∞‰∫ÜÂì™ÈáåÂë¢Ôºå‰Ω†ÊâìÂºÄ $GOPATH/pkg/mod Â∞±ÂèØ‰ª•ÁúãÂà∞‰∫ÜÔºåÂè¶Â§ñ modules ÊòØÂÖÅËÆ∏Âêå package Â§öÁßçÁâàÊú¨Âπ∂Â≠òÁöÑ„ÄÇ12345678910~/go/pkg/mod‚îú‚îÄ‚îÄ cache‚îÇ ‚îú‚îÄ‚îÄ download‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ github.com‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ gopkg.in‚îÇ ‚îî‚îÄ‚îÄ vcs‚îÇ ‚îú‚îÄ‚îÄ 37981a5904034a62f98c21341f5422b08cc21ccf1bea734e2aafc91119af6c9b‚îÇ ‚îú‚îÄ‚îÄ 37981a5904034a62f98c21341f5422b08cc21ccf1bea734e2aafc91119af6c9b.info‚îÇ ‚îú‚îÄ‚îÄ 3cef6ea433a84771f272e076cd77b94bd94828b89b4ccd04fa8622bf2d5d3a3f‚îÇ ‚îú‚îÄ‚îÄ 3cef6ea433a84771f272e076cd77b94bd94828b89b4ccd04fa8622bf2d5d3a3f.info Êàë‰ª¨ÁúãÁúãÊâßË°å go build Âêé go.mod Êñá‰ª∂ÁöÑÂÜÖÂÆπÔºö1234567891011module github.com/wangjiemin/mytestrequire ( github.com/gin-contrib/sse v0.0.0-20170109093832-22d885f9ecc7 // indirect github.com/gin-gonic/gin v1.3.0 github.com/golang/protobuf v1.2.0 // indirect github.com/mattn/go-isatty v0.0.4 // indirect github.com/ugorji/go/codec v0.0.0-20181022190402-e5e69e061d4f // indirect gopkg.in/go-playground/validator.v8 v8.18.2 // indirect gopkg.in/yaml.v2 v2.2.1 // indirect) Êàë‰ª¨ÁúãÂà∞ go modules ÂàÜÊûêÂá∫‰∫Ü mytest ÁöÑ‰æùËµñÔºåÂπ∂Â∞ÜÂÖ∂ÊîæÂÖ• go.mod ÁöÑ require Âå∫Âüü„ÄÇ go modules ÊãâÂèñ package ÁöÑÂéüÂàôÊòØÂÖàÊãâÂèñÊúÄÊñ∞ÁöÑ release tagÔºåËã•Êó† tag ÂàôÊãâÊúÄÊñ∞ commit Âπ∂‰ª• Pseudo-versions ÁöÑÂΩ¢ÂºèËÆ∞ÂΩï„ÄÇÂõ†‰∏∫Êàë‰ª¨ÁöÑ module Âè™Áõ¥Êé•‰æùËµñ‰∫Ü ginÔºåÂÖ∂‰ªñÁöÑÈÉΩÊòØÈùûÁõ¥Êé•‰æùËµñÁöÑÔºåÊâÄ‰ª•ÂÆÉ‰ª¨ÂêéËæπÈÉΩË¢´‰ª•Ê≥®ÈáäÂΩ¢ÂºèÊ†áËÆ∞‰∫Ü indirectÔºåÂç≥‰º†ÈÄí‰æùËµñ„ÄÇgo.mod Êñá‰ª∂‰∏ÄÊó¶ÂàõÂª∫ÂêéÔºåÂÆÉÁöÑÂÜÖÂÆπÂ∞Ü‰ºöË¢´ go toolchain ÂÖ®Èù¢ÊéåÊéß„ÄÇgo toolchain ‰ºöÂú®ÂêÑÁ±ªÂëΩ‰ª§ÊâßË°åÊó∂ÔºåÊØîÂ¶Ç go get„ÄÅgo build„ÄÅgo mod Á≠â‰øÆÊîπÂíåÁª¥Êä§ go.mod Êñá‰ª∂„ÄÇ ÂêåÊó∂ÂèëÁé∞ÁõÆÂΩï‰∏ãÂ§ö‰∫Ü‰∏Ä‰∏™Êñá‰ª∂ go.sum123456789101112131415github.com/gin-contrib/sse v0.0.0-20170109093832-22d885f9ecc7 h1:AzN37oI0cOS+cougNAV9szl6CVoj2RYwzS3DpUQNtlY=github.com/gin-contrib/sse v0.0.0-20170109093832-22d885f9ecc7/go.mod h1:VJ0WA2NBN22VlZ2dKZQPAPnyWw5XTlK1KymzLKsr59s=github.com/gin-gonic/gin v1.3.0 h1:kCmZyPklC0gVdL728E6Aj20uYBJV93nj/TkwBTKhFbs=github.com/gin-gonic/gin v1.3.0/go.mod h1:7cKuhb5qV2ggCFctp2fJQ+ErvciLZrIeoOSOm6mUr7Y=github.com/golang/protobuf v1.2.0 h1:P3YflyNX/ehuJFLhxviNdFxQPkGK5cDcApsge1SqnvM=github.com/golang/protobuf v1.2.0/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=github.com/mattn/go-isatty v0.0.4 h1:bnP0vzxcAdeI1zdubAl5PjU6zsERjGZb7raWodagDYs=github.com/mattn/go-isatty v0.0.4/go.mod h1:M+lRXTBqGeGNdLjl/ufCoiOlB5xdOkqRJdNxMWT7Zi4=github.com/ugorji/go/codec v0.0.0-20181022190402-e5e69e061d4f h1:y3Vj7GoDdcBkxFa2RUUFKM25TrBbWVDnjRDI0u975zQ=github.com/ugorji/go/codec v0.0.0-20181022190402-e5e69e061d4f/go.mod h1:VFNgLljTbGfSG7qAOspJ7OScBnGdDN/yBr0sguwnwf0=gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=gopkg.in/go-playground/validator.v8 v8.18.2 h1:lFB4DoMU6B626w8ny76MV7VX6W2VHct2GVOI3xgiMrQ=gopkg.in/go-playground/validator.v8 v8.18.2/go.mod h1:RX2a/7Ha8BgOhfk7j780h4/u/RRjR0eouCJSH80/M2Y=gopkg.in/yaml.v2 v2.2.1 h1:mUhvW9EsL+naU5Q3cakzfE91YhliOondGd6ZrsDBHQE=gopkg.in/yaml.v2 v2.2.1/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI= ÂÜôËøá node ÁöÑ‰∫∫Â∫îËØ•‰ºöÂèëÁé∞Ôºå go.mod/go.sum ÁöÑÂÖ≥Á≥ªË∑ü package.json/package-lock.json Á±ª‰ººÔºåÂâçËÄÖÂÆö‰πâ dependency rootÔºåÂêéËÄÖÂ∞ÜÂÖ≥Á≥ªÂ±ïÂºÄ„ÄÇ ÊúÄÂêéÊâßË°å bin/main ÂèØ‰ª•ÁúãÂà∞ Gin ÂæàË¥¥ÂøÉÁöÑÂàóÂá∫‰∫Ü handler ÊâÄÂ±ûÁöÑ package1234567891011$ ./bin/main[GIN-debug] [WARNING] Now Gin requires Go 1.6 or later and Go 1.7 will be required soon.[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production. - using env: export GIN_MODE=release - using code: gin.SetMode(gin.ReleaseMode)[GIN-debug] GET /health --> main.GetHealthHandler (3 handlers)[GIN-debug] GET /health-dataapi --> github.com/wangjiemin/mytest/pkg/api/data.GetDataAPIHealthHandler (3 handlers) Âà∞ËøôÈáåÔºå‰∏Ä‰∏™ go modules Â∞±ÂÆåÊàê‰∫Ü„ÄÇ GO111MODULEModules ÊòØ‰Ωú‰∏∫ experiment feature Âä†ÂÖ•Âà∞‰∏ç‰πÖÂâçÊ≠£ÂºèÂèëÂ∏ÉÁöÑ Go 1.11 ‰∏≠ÁöÑ„ÄÇ ÊåâÁÖß Go ÁöÑÊÉØ‰æãÔºåÂú®Êñ∞ÁöÑ experiment feature È¶ñÊ¨°Âä†ÂÖ•Êó∂ÔºåÈÉΩ‰ºöÊúâ‰∏Ä‰∏™ÁâπÊÄßÂºÄÂÖ≥Ôºågo modules ‰πü‰∏ç‰æãÂ§ñÔºåGO111MODULE Ëøô‰∏™‰∏¥Êó∂ÁöÑÁéØÂ¢ÉÂèòÈáèÂ∞±ÊòØ go modules ÁâπÊÄßÁöÑ experiment ÂºÄÂÖ≥„ÄÇ off: go modules experiment feature ÂÖ≥Èó≠Ôºågo compiler ‰ºöÂßãÁªà‰ΩøÁî® GOPATH modeÔºåÂç≥Êó†ËÆ∫Ë¶ÅÊûÑÂª∫ÁöÑÊ∫êÁ†ÅÁõÆÂΩïÊòØÂê¶Âú® GOPATH Ë∑ØÂæÑ‰∏ãÔºågo compiler ÈÉΩ‰ºöÂú®‰º†ÁªüÁöÑ GOPATH Âíå vendor ÁõÆÂΩï (‰ªÖÊîØÊåÅÂú® GOPATH ÁõÆÂΩï‰∏ãÁöÑ package) ‰∏ãÊêúÁ¥¢ÁõÆÊ†áÁ®ãÂ∫è‰æùËµñÁöÑ go packageÔºõ on: ÂßãÁªà‰ΩøÁî® module-aware modeÔºåÂè™Ê†πÊçÆ go.mod ‰∏ãËΩΩ dependency ËÄåÂÆåÂÖ®ÂøΩÁï• GOPATH ‰ª•Âèä vendor ÁõÆÂΩï auto: Golang 1.11 È¢ÑËÆæÂÄºÔºå‰ΩøÁî® GOPATH mode ËøòÊòØ module-aware modeÔºåÂèñÂÜ≥‰∫éË¶ÅÊûÑÂª∫ÁöÑÊ∫êÁ†ÅÁõÆÂΩïÊâÄÂú®‰ΩçÁΩÆ‰ª•ÂèäÊòØÂê¶ÂåÖÂê´ go.mod Êñá‰ª∂„ÄÇÊª°Ë∂≥‰ªª‰∏ÄÊù°‰ª∂Êó∂Êâç‰ΩøÁî® module-aware mode: ÂΩìÂâçÁõÆÂΩï‰Ωç‰∫é GOPATH/src ‰πãÂ§ñÂπ∂‰∏îÂåÖÂê´ go.mod Êñá‰ª∂ ÂΩìÂâçÁõÆÂΩï‰Ωç‰∫éÂåÖÂê´ go.mod Êñá‰ª∂ÁöÑÁõÆÂΩï‰∏ã go mod ÂëΩ‰ª§12345678download download modules to local cache (‰∏ãËΩΩ‰æùËµñÁöÑ modules Âà∞Êú¨Âú∞ cache)edit edit go.mod from tools or scripts (ÁºñËæë go.mod Êñá‰ª∂)graph print module requirement graph (ÊâìÂç∞Ê®°Âùó‰æùËµñÂõæ)init initialize new module in current directory (ÂÜçÂΩìÂâçÊñá‰ª∂Â§π‰∏ãÂàùÂßãÂåñ‰∏Ä‰∏™Êñ∞ÁöÑ module, ÂàõÂª∫ go.mod Êñá‰ª∂)tidy add missing and remove unused modules (Â¢ûÂä†‰∏¢Â§±ÁöÑ modulesÔºåÂéªÊéâÊú™Áî®ÁöÑ modules)vendor make vendored copy of dependencies (Â∞Ü‰æùËµñÂ§çÂà∂Âà∞ vendor ‰∏ã)verify verify dependencies have expected content (Ê†°È™å‰æùËµñ)why explain why packages or modules are needed (Ëß£Èáä‰∏∫‰ªÄ‰πàÈúÄË¶Å‰æùËµñ) ÁúãËøô‰∫õÂëΩ‰ª§ÁöÑÂ∏ÆÂä©Â∑≤ÁªèÊØîËæÉÂÆπÊòì‰∫ÜËß£ÂëΩ‰ª§ÁöÑÂäüËÉΩ„ÄÇ Êó¢ÊúâÈ°πÁõÆÂÅáËÆæ‰Ω†Â∑≤ÁªèÊúâ‰∫Ü‰∏Ä‰∏™ go È°πÁõÆÔºå ÊØîÂ¶ÇÂú®$GOPATH/github.com/wangjiemim/mytest‰∏ãÔºå ‰Ω†ÂèØ‰ª•‰ΩøÁî®go mod init github.com/wangjiemim/mytestÂú®Ëøô‰∏™Êñá‰ª∂Â§π‰∏ãÂàõÂª∫‰∏Ä‰∏™Á©∫ÁöÑ go.mod (Âè™ÊúâÁ¨¨‰∏ÄË°å module github.com/wangjiemim/mytest)„ÄÇ ÁÑ∂Âêé‰Ω†ÂèØ‰ª•ÈÄöËøá go get ./...ËÆ©ÂÆÉÊü•Êâæ‰æùËµñÔºåÂπ∂ËÆ∞ÂΩïÂú® go.mod Êñá‰ª∂‰∏≠ (‰Ω†ËøòÂèØ‰ª•ÊåáÂÆö -tags, ËøôÊ†∑ÂèØ‰ª•Êää tags ÁöÑ‰æùËµñÈÉΩÊü•ÊâæÂà∞)„ÄÇ ÈÄöËøágo mod tidy‰πüÂèØ‰ª•Áî®Êù•‰∏∫ go.mod Â¢ûÂä†‰∏¢Â§±ÁöÑ‰æùËµñÔºåÂà†Èô§‰∏çÈúÄË¶ÅÁöÑ‰æùËµñÔºå‰ΩÜÊòØÊàë‰∏çÁ°ÆÂÆöÂÆÉÊÄé‰πàÂ§ÑÁêÜtags„ÄÇ ÊâßË°å‰∏äÈù¢ÁöÑÂëΩ‰ª§‰ºöÊää go.mod ÁöÑlatestÁâàÊú¨Êç¢ÊàêÂÆûÈôÖÁöÑÊúÄÊñ∞ÁöÑÁâàÊú¨ÔºåÂπ∂‰∏î‰ºöÁîüÊàê‰∏Ä‰∏™go.sumËÆ∞ÂΩïÊØè‰∏™‰æùËµñÂ∫ìÁöÑÁâàÊú¨ÂíåÂìàÂ∏åÂÄº„ÄÇ replaceÂú®ÂõΩÂÜÖËÆøÈóÆgolang.org/xÁöÑÂêÑ‰∏™ÂåÖÈÉΩÈúÄË¶ÅÊ¢ØÂ≠êÔºå‰Ω†ÂèØ‰ª•Âú® go.mod ‰∏≠‰ΩøÁî®replaceÊõøÊç¢Êàê github ‰∏äÂØπÂ∫îÁöÑÂ∫ì„ÄÇ12345replace ( golang.org/x/crypto v0.0.0-20180820150726-614d502a4dac => github.com/golang/crypto v0.0.0-20180820150726-614d502a4dac golang.org/x/net v0.0.0-20180821023952-922f4815f713 => github.com/golang/net v0.0.0-20180826012351-8a410e7b638d golang.org/x/text v0.3.0 => github.com/golang/text v0.3.0) ‰æùËµñÂ∫ì‰∏≠ÁöÑreplaceÂØπ‰Ω†ÁöÑ‰∏ª go.mod ‰∏çËµ∑‰ΩúÁî®ÔºåÊØîÂ¶Çgithub.com/wangjiemin/mytestÁöÑ go.mod Â∑≤ÁªèÂ¢ûÂä†‰∫Üreplace, ‰ΩÜÊòØ‰Ω†ÁöÑ go.mod ËôΩÁÑ∂require‰∫ÜrpcxÁöÑÂ∫ìÔºå‰ΩÜÊòØÊ≤°ÊúâËÆæÁΩÆreplaceÁöÑËØùÔºå go getËøòÊòØ‰ºöËÆøÈóÆgolang.org/x„ÄÇ ÊâÄ‰ª•Â¶ÇÊûúÊÉ≥ÁºñËØëÈÇ£‰∏™È°πÁõÆÔºåÂ∞±Âú®Âì™‰∏™È°πÁõÆ‰∏≠Â¢ûÂä†replace„ÄÇ ÂåÖÁöÑÁâàÊú¨ÊéßÂà∂‰∏ãÈù¢ÁöÑÁâàÊú¨ÈÉΩÊòØÂêàÊ≥ïÁöÑÔºö12345gopkg.in/tomb.v1 v1.0.0-20141024135613-dd632973f1e7gopkg.in/vmihailenco/msgpack.v2 v2.9.1gopkg.in/yaml.v2 { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[masterha-master-switch ÂèÇÊï∞ËØ¶Ëß£]]></title>
    <url>%2F2019%2F03%2F28%2Fmasterha-master-switch%2F</url>
    <content type="text"><![CDATA[MHA ÂëΩ‰ª§ masterha_master_switchÂ∏∏Áî®ÂèÇÊï∞‰ªãÁªç1234567891011121314151617181920212223242526272829303132333435363738394041424344--master_state=dead Âº∫Âà∂ÁöÑÂèÇÊï∞ÔºåÂèÇÊï∞ÂÄº‰∏∫"dead" ÊàñËÄÖ "alive" . Â¶ÇÊûú ËÆæÁΩÆ‰∏∫ alive Ê®°ÂºèÔºåmasterha_master_switch ÂºÄÂßãÂú®Á∫ø‰∏ªÂ∫ìÂàáÊç¢Êìç‰Ωú„ÄÇ --dead_master_host=(hostname) Âº∫Âà∂ÂèÇÊï∞ÔºåÂÆïÊú∫ÁöÑ‰∏ªÂ∫ìÊâÄÂú®ÁöÑ‰∏ªÊú∫ÂêçÁß∞„ÄÇ--dead_master_ip Âíå --dead_master_port ÊòØÂèØÈÄâÂèÇÊï∞ÔºåÂ¶ÇÊûúËøô‰∫õÂèÇÊï∞Ê≤°ÊúâËÆæÁΩÆÔºå--dead_master_ip Â∞±ÊòØ --dead_master_host Ëß£ÊûêÁöÑIPÂú∞ÂùÄ„ÄÇ--dead_master_port ‰∏∫ 3306 --new_master_host=(hostname) Êñ∞‰∏ªÊú∫Âú∞ÂùÄÔºåÂèØÈÄâÂèÇÊï∞ÔºåËøô‰∏™ÂèÇÊï∞Âú®‰Ω†ÊòéÁ°ÆÊñ∞ÁöÑ‰∏ªÂ∫ìÁöÑ‰∏ªÊú∫ÔºåÈùûÂ∏∏ÊúâÁî®„ÄÇ(ËøôÂ∞±ÊÑèÂë≥ÁùÄ‰Ω†‰∏çÈúÄË¶ÅËÆ©MHAÊù•ÂÜ≥ÂÆöÊñ∞ÁöÑ‰∏ªÂ∫ì)„ÄÇÂ¶ÇÊûú‰∏çËÆæÁΩÆÊ≠§ÂèÇÊï∞ÔºåMHA Â∞Ü‰ºöÂà©Áî®Ëá™Âä®failoverÁöÑËßÑÂàôÊù•ÈÄâÊã©Êñ∞ÁöÑ‰∏ªÂ∫ì„ÄÇÂ¶ÇÊûúËÆæÁΩÆ--new_master_hostÔºåMHAÈÄâÊã©Ê≠§‰∏ªÊú∫‰∏∫Êñ∞ÁöÑ‰∏ªÂ∫ìÔºåÂ¶ÇÊûú‰∏çËÉΩÊàê‰∏∫‰∏ªÂ∫ìÔºåMHAÂ∞Ü‰ºöÈÄÄÂá∫ --interactive=(0|1) Â¶ÇÊûúËÆæÁΩÆ‰∏∫0ÔºåÂú®masterha_master_switchÔºåÂÆÉËá™Âä®ÊâßË°åÊïÖÈöúËΩ¨Áßª(Èùû‰∫§‰∫íÂºè)„ÄÇËøôÂÆûÈôÖ‰∏äÊòØÂíåmasterha_managerÁöÑÂÜÖÈÉ®ËøêË°åÊú∫Âà∂‰∏ÄÊ†∑ÔºåËøôÁßçÈùû‰∫§‰∫íÂºèÊïÖÈöúËΩ¨ÁßªÊòØÊúâÁî®ÁöÑÔºåÂ¶ÇÊûú‰Ω†Â∑≤ÁªèËØÅÂÆû‰∫ÜmasterÊ≠ª‰∫Ü,‰ΩÜ‰Ω†ÊÉ≥Â∞ΩÂø´ÂÅöÊïÖÈöúËΩ¨Áßª„ÄÇÈùû‰∫§‰∫íÂºèÊïÖÈöúËΩ¨Áßª‰πüÊòØÊúâÁî®ÁöÑ,Â¶ÇÊûú‰Ω†‰ΩøÁî®ÂÖ∂‰ªñÁé∞ÊúâÁöÑ‰∏ªÁõëÊéßËΩØ‰ª∂ÂíåË¶ÅË∞ÉÁî®ÁöÑÈùû‰∫§‰∫íÂºèÊïÖÈöúËΩ¨ÁßªÂëΩ‰ª§ËΩØ‰ª∂„ÄÇÂÖ∏ÂûãÁöÑ‰æãÂ≠êÊòØmasterha_master_switchË∞ÉÁî®‰ªéÈõÜÁæ§ËΩØ‰ª∂ÂÉèËµ∑ÊêèÂô®„ÄÇ --ssh_reachable=(0|1|2) ÊåáÂÆömaster ÁªèËøáSSHÊòØÂê¶ÂèØËææ„ÄÇ0:‰∏çÂèØËææ„ÄÅ1:ÂèØËææ„ÄÅ2:Êú™Áü•(ÈªòËÆ§ÂÄº)„ÄÇ Â¶ÇÊûúËÆæÁΩÆ‰∏∫‰∫Ü2ÔºåÊ≠§ÂëΩ‰ª§ÂÜÖÈÉ®Â∞Ü‰ºöÊ£ÄÊµãÈÄöËøáSSH ÊòØÂê¶ÂèØËææmasterÔºåÂπ∂‰∏îË∑üÊñ∞SSH Áä∂ÊÄÅ„ÄÇÂ¶ÇÊûúÂèØËææÔºå‰∏îËÆæÁΩÆmaster_ip_failover_script ÊàñËÄÖ shutdown_script .Â∞Ü‰ºöÊâßË°å"--command=stopssh"„ÄÇÂê¶ÂàôÔºåÊâßË°å "--command=stop"„ÄÇÂè¶Â§ñÔºåÂ¶ÇÊûúÂÆïÊú∫ÁöÑmasterÈÄöËøáSSHÂèØËææÔºåfailoverËÑöÊú¨ËØïÂõæ‰ªéÂÆïÊú∫ÁöÑmasterÊú∫Âô®‰∏äÊã∑Ë¥ùÊ≤°ÊúâÊ≤°ÊúâÂèëÈÄÅÁöÑbinlog„ÄÇ --skip_change_master Â¶ÇÊûúËÆæÁΩÆÊ≠§ÂèÇÊï∞ÔºåÂΩìÂèëÁîüfailoverÁöÑÊó∂ÂÄôÔºåMAH Âú®Â∫îÁî®ÂÆå‰∏çÂêåÁöÑrelay logÈÄÄÂá∫ÔºåÂøΩÁï•CHANGE MASTER Âíå START SLAVE Êìç‰Ωú„ÄÇÊâÄ‰ª• slaves ‰∏ç‰ºöÊåáÂêë Êñ∞ÁöÑmaster. ÂºÄÂêØÊ≠§ÂèÇÊï∞ÔºåÊúâÂà©‰∫éÊâãÂä®ÁöÑ‰∫åÊ¨°Ê£ÄÊü•slave ÊÅ¢Â§çÊòØÂê¶ÊàêÂäü --skip_disable_read_only ËÆæÁΩÆÊ≠§ÂèÇÊï∞ÔºåMHA Â∞Ü‰∏ç‰ºöÂú®Êñ∞ÁöÑ‰∏ªÂ∫ì‰∏äÊâßË°å SET GLOBAL read_only =0 Êìç‰ΩúÔºåÊúâÂà©‰∫éÊâãÂä®Êìç‰Ωú --last_failover_minute=(minutes) ÂèÇËÄÉmaster_manager --ignore_last_failover ÂèÇËÄÉmaster_manager --wait_on_failover_error=(seconds) Á±ª‰ºº‰∫émaster_manager, Ê≠§ÂèÇÊï∞Âè™Áî®‰∫éËá™Âä®ÁöÑ/Èùû‰∫§‰∫íÂºèÁöÑfailover„ÄÇÂ¶ÇÊûúÊ≤°ÊúâËÆæÁΩÆ--interval=0Ôºåwait_on_failover_error Â∞Ü‰ºöË¢´ÂøΩÁï•ÔºåÂú®ÂèëÁîüÈîôËØØÁöÑÊó∂ÂÄô‰∏ç‰ºösleep„ÄÇ --remove_dead_master_conf ÂèÇËÄÉmasterha_manager --wait_until_gtid_in_sync(0|1) Ê≠§ÂèÇÊï∞‰ªé0.56ÁâàÊú¨ÂºÄÂßãÂèØÁî®ÔºåÂ¶ÇÊûúËÆæÁΩÆÊàê1ÔºåÂΩìÂü∫‰∫éGITDÁöÑfailoverÊó∂,MHA ‰ºöÁ≠âÂæÖÊâÄÊúâÁöÑ‰ªéÂ∫ìËøΩ‰∏äÊñ∞‰∏ªÂ∫ìÁöÑGITD --skip_change_master Ê≠§ÂèÇÊï∞‰ªé0.56ÁâàÊú¨ÂºÄÂßãÂèØÁî®ÔºåÂ¶ÇÊûúÂºÄÂêØÊ≠§ÈÄâÈ°πÔºåMHA Ë∑≥Ëøá CHANGE MASTER ÁöÑÊìç‰Ωú --skip_disable_read_only Ê≠§ÂèÇÊï∞‰ªé0.56ÁâàÊú¨ÂºÄÂßãÂèØÁî®ÔºåÂ¶ÇÊûúÂºÄÂêØÊ≠§ÈÄâÈ°πÔºåMHA Â∞Ü‰ºöÂú®Êñ∞ÁöÑmaster Ë∑≥Ëøá SET GLOBAL read_only = 0; --ignore_binlog_server_error Ê≠§ÂèÇÊï∞‰ªé0.56ÁâàÊú¨ÂºÄÂßãÂèØÁî®ÔºåÂ¶ÇÊûúÂºÄÂêØÊ≠§ÈÄâÈ°πÔºåÂΩìÊâßË°åfailoverÁöÑÊó∂ÔºåMHAÂøΩÁï•binlog server‰∏ä‰ªª‰ΩïÈîôËØØ ‰∏ªÂú®Á∫øÂàáÊç¢Êó∂Áõ∏ÂÖ≥ÂèÇÊï∞1234567891011--new_master_host=(hostname) Êñ∞‰∏ªÊú∫Âú∞ÂùÄÔºåÂèØÈÄâÂèÇÊï∞ÔºåËøô‰∏™ÂèÇÊï∞Âú®‰Ω†ÊòéÁ°ÆÊñ∞ÁöÑ‰∏ªÂ∫ìÁöÑ‰∏ªÊú∫ÔºåÈùûÂ∏∏ÊúâÁî®„ÄÇ(ËøôÂ∞±ÊÑèÂë≥ÁùÄ‰Ω†‰∏çÈúÄË¶ÅËÆ©MHAÊù•ÂÜ≥ÂÆöÊñ∞ÁöÑ‰∏ªÂ∫ì)„ÄÇÂ¶ÇÊûú‰∏çËÆæÁΩÆÊ≠§ÂèÇÊï∞ÔºåMHA Â∞Ü‰ºöÂà©Áî®Ëá™Âä®failoverÁöÑËßÑÂàôÊù•ÈÄâÊã©Êñ∞ÁöÑ‰∏ªÂ∫ì„ÄÇÂ¶ÇÊûúËÆæÁΩÆ--new_master_hostÔºåMHAÈÄâÊã©Ê≠§‰∏ªÊú∫‰∏∫Êñ∞ÁöÑ‰∏ªÂ∫ìÔºåÂ¶ÇÊûú‰∏çËÉΩÊàê‰∏∫‰∏ªÂ∫ìÔºåMHAÂ∞Ü‰ºöÈÄÄÂá∫ --orig_master_is_new_slave ÂΩìÂÆåÊàê‰∏ªÂ∫ìÂàáÊç¢ÂêéÔºåÂéüÂÖàÁöÑ‰∏ªÂ∫ìÂ∞Ü‰Ωú‰∏∫Áé∞Âú®‰∏ªÂ∫ìÁöÑslaveËøêË°å„ÄÇÈªòËÆ§:‰∏çÂºÄÂêØ(ÂéüÂÖàÁöÑ‰∏ªÂ∫ì‰∏ç‰ºöÂä†ÂÖ•Âà∞Êñ∞ÁöÑÂ§çÂà∂ÁéØÂ¢É‰∏≠)„ÄÇÂ¶ÇÊûúÂºÄÂêØÊ≠§ÈÄâÈ°πÔºåÈúÄË¶ÅÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆrepl_passwordÂèÇÊï∞ÔºåÁî±‰∫éÂΩìÊúüÁöÑMasterÂπ∂‰∏çÁü•ÈÅìÊñ∞ÁöÑMasterÁöÑreplicationÁöÑÂØÜÁ†Å --remove_orig_master_conf Â¶ÇÊûúËÆæÁΩÆÊ≠§ÂèÇÊï∞ÔºåÂΩìÊàêÂäüfailoverÂêéÔºåMHA managerÂ∞Ü‰ºöËá™Âä®Âà†Èô§ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂÖ≥‰∫édead masterÁöÑÈÖçÁΩÆÈÄâÈ°π„ÄÇ --skip_lock_all_tables ÂΩìÂú®ÂÅö‰∏ªÂ∫ìÂàáÊç¢ÁöÑÊó∂ÂÄôÔºåMHA‰ºöÂú®ÂéüÂÖàÁöÑ‰∏ªÂ∫ì‰∏äÊâßË°åFLUSH TABLES WITH READ LOCK Êìç‰ΩúÔºåÁ°Æ‰øùÊ≤°ÊúâË∑üÊñ∞Êìç‰ΩúÔºå‰ΩÜÊòØFLUSH TABLES WITH READ LOCK Êìç‰ΩúÊòØÈùûÂ∏∏ËÄóË¥πËµÑÊ∫êÁöÑÔºåÂπ∂‰∏î‰Ω†ÂèØ‰ª•Âú®ÂéüÂÖàÁöÑ‰∏ªÂ∫ìÁ°ÆÂÆöÊ≤°ÊúâË∑üÊñ∞Êìç‰Ωú(ÈÄöËøámaster_ip_online_change_script ‰∏≠kill all clientsÊìç‰ΩúÁ≠â)„ÄÇÂèØ‰ª•Âà©Áî®Ê≠§ÈÄâÈ°πÈÅøÂÖçÈîÅË°®„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MHA</category>
      </categories>
      <tags>
        <tag>MHA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MHA ÊïÖÈöúÂàáÊç¢ÊºîÁªÉ --- masterha_master_switch]]></title>
    <url>%2F2019%2F03%2F28%2Fmha-switch%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÊò®Â§©ÂÖ¨Âè∏Ë¶ÅËøõË°åÁ∫ø‰∏äMHAÈ´òÂèØÁî®ÈõÜÁæ§ÊïÖÈöúÂàáÊç¢ÊºîÁªÉ„ÄÇÁî±‰∫éÊàëÂàöÂÖ•ËÅåÂÖ¨Âè∏„ÄÇÂÖ¨Âè∏ËøòÊ≤°ÊúâÂÅöËøáÂ§™Â§öÁöÑÁÅæÈöæÁ∫ßÂà´ÁöÑÊïÖÈöúÊºîÁªÉ„ÄÇ ÊàëÂÜô‰∫Ü‰∏Ä‰∫õÊ≠•È™§ÔºöÊïÖÈöúÂàáÊç¢ Êü•Áúã‰∏ª‰ªéÂª∂ËøüÁä∂ÊÄÅ ÁôªÂΩïMHA‰∏≠ÊéßÊú∫ÔºåÊü•ÁúãÊºîÁªÉÂàáÊç¢ÁöÑÊï∞ÊçÆÂ∫ìMHA logÊñá‰ª∂Ôºå‰ΩøÁî®tail -f ÂëΩ‰ª§Êù•Ëé∑ÂèñÂàáÊç¢ÁöÑlogÊó•Âøó‰ø°ÊÅØ ÁôªÂΩïmasterÊú∫Âô®ÔºåÊâßË°å /etc/init.d/mysql stop Êü•ÁúãMHA‰∏≠ÊéßÊú∫Êó•Âøó‰ø°ÊÅØ„ÄÇ ÂàáÊç¢ÊàêÂäüÔºåÁôªÂΩïÂà∞ new_master ‰∏≠Êü•ÁúãvipÊòØÂê¶Â∑≤ÁªèÁªëÂÆöÂà∞ÁΩëÂç°‰∏ä ÁôªÂΩïslaveÔºåÊü•Áúã show slave status ÊòØÂê¶Â∑≤Áªèchange master to new_master ip‰∏äÔºåÊü•ÁúãslaveÊ≠£Â∏∏‰∏éÂê¶ Âú® MHA ‰∏≠ÊéßÊú∫ÂêØÂä® masterha_manager ËøõÁ®ãÔºåÊü•ÁúãMHAÈõÜÁæ§ÂêØÂä®ÊòØÂê¶Ê≠£Â∏∏„ÄÇ(‰∏§ËäÇÁÇπ)ÁªìÊûÑÂõæÔºönew_master: (master)‚Äî> slave: (slave) master Êï∞ÊçÆÂ∫ìÊÅ¢Â§ç ÁôªÂΩïÂà∞old_master Êú∫Âô®‰∏äÊâßË°å /etc/init.d/mysql start ÊòØÂê¶Ê≠£Â∏∏ÂêØÂä®ÊúçÂä° Âú®MHA‰∏≠ÊéßÊú∫‰∏≠Ëé∑ÂèñÂàáÊç¢ÁöÑlog Êó•Âøó‰ø°ÊÅØÊâæÂá∫ change master to new_master ‰ø°ÊÅØËØ≠Âè• Âú®old_master ‰∏≠ÊâßË°åchange master to ËØ≠Âè•ÔºåÂèò‰∏∫ new_masterÁöÑslave show slave status Êü•Áúã old_master ÊòØÂê¶Ê≠£Â∏∏Âèò‰∏∫ new_master ÁöÑslave Âú®MHA ‰∏≠ÊéßÊú∫ËäÇÁÇπÔºåÊâßË°å masterha_stop ÂëΩ‰ª§ÁªìÊùü masterha_managerËøõÁ®ã„ÄÇ Âú®MHA ‰∏≠ÊéßÊú∫ÂêØÂä® masterha_manager ËøõÁ®ãÔºåÊü•ÁúãÊÅ¢Â§çÂ•ΩÁöÑold_masterÊòØÂê¶Ê≠£Â∏∏Âä†ÂÖ•Âà∞MHAËäÇÁÇπ (‰∏âËäÇÁÇπÔºâÁªìÊûÑÂõæÔºönew_master: (master)‚Äî> old_master: (slave)‚Äî> slave: (slave) ÊÅ¢Â§ç old_master‰∏∫ master ËßíËâ≤ Êü•Áúã‰∏ª‰ªéÂª∂ËøüÁä∂ÊÄÅ ÁôªÂΩïMHA‰∏≠ÊéßÊú∫ÔºåÊü•ÁúãÊºîÁªÉÂàáÊç¢ÁöÑÊï∞ÊçÆÂ∫ìMHA logÊñá‰ª∂Ôºå‰ΩøÁî®tail -f ÂëΩ‰ª§Êù•Ëé∑ÂèñÂàáÊç¢ÁöÑlogÊó•Âøó‰ø°ÊÅØ ÁôªÂΩïnew_masterÊú∫Âô®ÔºåÊâßË°å /etc/init.d/mysql stop Êü•ÁúãMHA‰∏≠ÊéßÊú∫Êó•Âøó‰ø°ÊÅØ„ÄÇ ÂàáÊç¢ÊàêÂäüÔºåÁôªÂΩïÂà∞ old_master ‰∏≠Êü•ÁúãvipÊòØÂê¶Â∑≤ÁªèÁªëÂÆöÂà∞ÁΩëÂç°‰∏ä ÁôªÂΩïslaveÔºåÊü•Áúã show slave status ÊòØÂê¶Â∑≤Áªèchange master to old_master ip‰∏äÔºåÊü•ÁúãslaveÊ≠£Â∏∏‰∏éÂê¶ Âú® MHA ‰∏≠ÊéßÊú∫ÂêØÂä® masterha_manager ËøõÁ®ãÔºåÊü•ÁúãMHAÈõÜÁæ§ÂêØÂä®ÊòØÂê¶Ê≠£Â∏∏„ÄÇ(‰∏§ËäÇÁÇπ)ÁªìÊûÑÂõæÔºömaster(old_master): (master)‚Äî> slave(new_master): (slave)‚Äî> slave: (slave) ‰ΩÜÊòØËøô‰πàÊìç‰ΩúËôΩÁÑ∂ËÉΩÊõ¥Ë¥¥ËøëÁúüÂÆûÁÅæÈöæ(ÊöÇÊó∂Ê≤°ÊúâÊää‰∏ª‰ªéÊï∞ÊçÆÂª∂ËøüËÄÉËôëËøõÂÖ•)ÔºåÈúÄË¶ÅÁöÑÊó∂Èó¥‰ºöÊõ¥Â§ö„ÄÇÈ¢ÜÂØºÂª∫ËÆÆÊâãÂä®Êìç‰ΩúMHA failoverÊµãËØïËÉΩ‰∏çËÉΩÂàáÊç¢„ÄÇÊúçÂä°Âô®Êû∂ÊûÑ server role master old_master slave new_master slave slave ÂÖ∑‰ΩìÊìç‰ΩúÂú®MHA ‰∏≠ÊéßÊú∫‰∏≠ÊâßË°åÂëΩ‰ª§1# masterha_check_repl --conf=/root/dba/mha/conf/babybi_#1.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182Wed Mar 27 23:28:28 2019 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.Wed Mar 27 23:28:28 2019 - [info] Reading application default configuration from /root/dba/mha/conf/babybi_#1.conf..Wed Mar 27 23:28:28 2019 - [info] Reading server configuration from /root/dba/mha/conf/babybi_#1.conf..Wed Mar 27 23:28:28 2019 - [info] MHA::MasterMonitor version 0.56.Wed Mar 27 23:28:28 2019 - [info] GTID failover mode = 0Wed Mar 27 23:28:28 2019 - [info] Dead Servers:Wed Mar 27 23:28:28 2019 - [info] Alive Servers:Wed Mar 27 23:28:28 2019 - [info] 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:28:28 2019 - [info] 10.25.1.67(10.25.1.67:3306)Wed Mar 27 23:28:28 2019 - [info] 10.25.1.68(10.25.1.68:3306)Wed Mar 27 23:28:28 2019 - [info] Alive Slaves:Wed Mar 27 23:28:28 2019 - [info] 10.25.1.67(10.25.1.67:3306) Version=5.6.29-76.2-log (oldest major version between slaves) log-bin:enabledWed Mar 27 23:28:28 2019 - [info] Replicating from 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:28:28 2019 - [info] Primary candidate for the new Master (candidate_master is set)Wed Mar 27 23:28:28 2019 - [info] 10.25.1.68(10.25.1.68:3306) Version=5.6.29-76.2-log (oldest major version between slaves) log-bin:enabledWed Mar 27 23:28:28 2019 - [info] Replicating from 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:28:28 2019 - [info] Current Alive Master: 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:28:28 2019 - [info] Checking slave configurations..Wed Mar 27 23:28:28 2019 - [warning] relay_log_purge=0 is not set on slave 10.25.1.67(10.25.1.67:3306).Wed Mar 27 23:28:28 2019 - [warning] relay_log_purge=0 is not set on slave 10.25.1.68(10.25.1.68:3306).Wed Mar 27 23:28:28 2019 - [info] Checking replication filtering settings..Wed Mar 27 23:28:28 2019 - [info] binlog_do_db= , binlog_ignore_db= Wed Mar 27 23:28:28 2019 - [info] Replication filtering check ok.Wed Mar 27 23:28:28 2019 - [info] GTID (with auto-pos) is not supportedWed Mar 27 23:28:28 2019 - [info] Starting SSH connection tests..Wed Mar 27 23:28:29 2019 - [info] All SSH connection tests passed successfully.Wed Mar 27 23:28:29 2019 - [info] Checking MHA Node version..Wed Mar 27 23:28:30 2019 - [info] Version check ok.Wed Mar 27 23:28:30 2019 - [info] Checking SSH publickey authentication settings on the current master..Wed Mar 27 23:28:30 2019 - [info] HealthCheck: SSH to 10.25.1.66 is reachable.Wed Mar 27 23:28:30 2019 - [info] Master MHA Node version is 0.56.Wed Mar 27 23:28:30 2019 - [info] Checking recovery script configurations on 10.25.1.66(10.25.1.66:3306)..Wed Mar 27 23:28:30 2019 - [info] Executing command: save_binary_logs --command=test --start_pos=4 --binlog_dir=/log/mysql/binlog/ --output_file=/var/tmp/save_binary_logs_test --manager_version=0.56 --start_file=mysql-bin.004691 Wed Mar 27 23:28:30 2019 - [info] Connecting to root@10.25.1.66(10.25.1.66:22).. Creating /var/tmp if not exists.. ok. Checking output directory is accessible or not.. ok. Binlog found at /log/mysql/binlog/, up to mysql-bin.004691Wed Mar 27 23:28:31 2019 - [info] Binlog setting check done.Wed Mar 27 23:28:31 2019 - [info] Checking SSH publickey authentication and checking recovery script configurations on all alive slave servers..Wed Mar 27 23:28:31 2019 - [info] Executing command : apply_diff_relay_logs --command=test --slave_user='mha' --slave_host=10.25.1.67 --slave_ip=10.25.1.67 --slave_port=3306 --workdir=/var/tmp --target_version=5.6.29-76.2-log --manager_version=0.56 --relay_log_info=/my/data/percona/relay-log.info --relay_dir=/my/data/percona/ --slave_pass=xxxWed Mar 27 23:28:31 2019 - [info] Connecting to root@10.25.1.67(10.25.1.67:22).. Checking slave recovery environment settings.. Opening /my/data/percona/relay-log.info ... ok. Relay log found at /log/mysql/relaylog, up to relay-log.014072 Temporary relay log file is /log/mysql/relaylog/relay-log.014072 Testing mysql connection and privileges..Warning: Using a password on the command line interface can be insecure. done. Testing mysqlbinlog output.. done. Cleaning up test file(s).. done.Wed Mar 27 23:28:31 2019 - [info] Executing command : apply_diff_relay_logs --command=test --slave_user='mha' --slave_host=10.25.1.68 --slave_ip=10.25.1.68 --slave_port=3306 --workdir=/var/tmp --target_version=5.6.29-76.2-log --manager_version=0.56 --relay_log_info=/my/data/percona/relay-log.info --relay_dir=/my/data/percona/ --slave_pass=xxxWed Mar 27 23:28:31 2019 - [info] Connecting to root@10.25.1.68(10.25.1.68:22).. Checking slave recovery environment settings.. Opening /my/data/percona/relay-log.info ... ok. Relay log found at /log/mysql/relaylog, up to relay-log.014072 Temporary relay log file is /log/mysql/relaylog/relay-log.014072 Testing mysql connection and privileges..Warning: Using a password on the command line interface can be insecure. done. Testing mysqlbinlog output.. done. Cleaning up test file(s).. done.Wed Mar 27 23:28:31 2019 - [info] Slaves settings check done.Wed Mar 27 23:28:31 2019 - [info] 10.25.1.66(10.25.1.66:3306) (current master) +--10.25.1.67(10.25.1.67:3306) +--10.25.1.68(10.25.1.68:3306)Wed Mar 27 23:28:31 2019 - [info] Checking replication health on 10.25.1.67..Wed Mar 27 23:28:31 2019 - [info] ok.Wed Mar 27 23:28:31 2019 - [info] Checking replication health on 10.25.1.68..Wed Mar 27 23:28:31 2019 - [info] ok.Wed Mar 27 23:28:31 2019 - [info] Checking master_ip_failover_script status:Wed Mar 27 23:28:31 2019 - [info] /root/dba/mha/script/master_ip_failover.sh --command=status --ssh_user=root --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 IN SCRIPT TEST====/etc/init.d/keepalived stop==/etc/init.d/keepalived start===Checking the Status of the script.. OK Wed Mar 27 23:28:31 2019 - [info] OK.Wed Mar 27 23:28:31 2019 - [warning] shutdown_script is not defined.Wed Mar 27 23:28:31 2019 - [info] Got exit code 0 (Not master dead).MySQL Replication Health is OK. ÊâßË°å masterha_master_switch ÂëΩ‰ª§1# masterha_master_switch --conf=/root/dba/mha/conf/babybi_#1.conf --master_state=alive --new_master_host=10.25.1.67 --new_master_port=3306 --orig_master_is_new_slave --running_updates_limit=10000 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798Wed Mar 27 23:34:27 2019 - [info] MHA::MasterRotate version 0.56.Wed Mar 27 23:34:27 2019 - [info] Starting online master switch..Wed Mar 27 23:34:27 2019 - [info] Wed Mar 27 23:34:27 2019 - [info] * Phase 1: Configuration Check Phase..Wed Mar 27 23:34:27 2019 - [info] Wed Mar 27 23:34:27 2019 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.Wed Mar 27 23:34:27 2019 - [info] Reading application default configuration from /root/dba/mha/conf/babybi_#1.conf..Wed Mar 27 23:34:27 2019 - [info] Reading server configuration from /root/dba/mha/conf/babybi_#1.conf..Wed Mar 27 23:34:27 2019 - [info] GTID failover mode = 0Wed Mar 27 23:34:27 2019 - [info] Current Alive Master: 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:34:27 2019 - [info] Alive Slaves:Wed Mar 27 23:34:27 2019 - [info] 10.25.1.67(10.25.1.67:3306) Version=5.6.29-76.2-log (oldest major version between slaves) log-bin:enabledWed Mar 27 23:34:27 2019 - [info] Replicating from 10.25.1.66(10.25.1.66:3306)Wed Mar 27 23:34:27 2019 - [info] Primary candidate for the new Master (candidate_master is set)Wed Mar 27 23:34:27 2019 - [info] 10.25.1.68(10.25.1.68:3306) Version=5.6.29-76.2-log (oldest major version between slaves) log-bin:enabledWed Mar 27 23:34:27 2019 - [info] Replicating from 10.25.1.66(10.25.1.66:3306)It is better to execute FLUSH NO_WRITE_TO_BINLOG TABLES on the master before switching. Is it ok to execute on 10.25.1.66(10.25.1.66:3306)? (YES/no): ---> ËæìÂÖ•: yesWed Mar 27 23:34:34 2019 - [info] Executing FLUSH NO_WRITE_TO_BINLOG TABLES. This may take long time..Wed Mar 27 23:34:34 2019 - [info] ok.Wed Mar 27 23:34:34 2019 - [info] Checking MHA is not monitoring or doing failover..Wed Mar 27 23:34:34 2019 - [info] Checking replication health on 10.25.1.67..Wed Mar 27 23:34:34 2019 - [info] ok.Wed Mar 27 23:34:34 2019 - [info] Checking replication health on 10.25.1.68..Wed Mar 27 23:34:34 2019 - [info] ok.Wed Mar 27 23:34:34 2019 - [info] 10.25.1.67 can be new master.Wed Mar 27 23:34:34 2019 - [info] From:10.25.1.66(10.25.1.66:3306) (current master) +--10.25.1.67(10.25.1.67:3306) +--10.25.1.68(10.25.1.68:3306)To:10.25.1.67(10.25.1.67:3306) (new master) +--10.25.1.68(10.25.1.68:3306) +--10.25.1.66(10.25.1.66:3306)Starting master switch from 10.25.1.66(10.25.1.66:3306) to 10.25.1.67(10.25.1.67:3306)? (yes/NO): ---> ËæìÂÖ•: yesWed Mar 27 23:34:37 2019 - [info] Checking whether 10.25.1.67(10.25.1.67:3306) is ok for the new master..Wed Mar 27 23:34:37 2019 - [info] ok.Wed Mar 27 23:34:37 2019 - [info] 10.25.1.66(10.25.1.66:3306): SHOW SLAVE STATUS returned empty result. To check replication filtering rules, temporarily executing CHANGE MASTER to a dummy host.Wed Mar 27 23:34:37 2019 - [info] 10.25.1.66(10.25.1.66:3306): Resetting slave pointing to the dummy host.Wed Mar 27 23:34:37 2019 - [info] ** Phase 1: Configuration Check Phase completed.Wed Mar 27 23:34:37 2019 - [info] Wed Mar 27 23:34:37 2019 - [info] * Phase 2: Rejecting updates Phase..Wed Mar 27 23:34:37 2019 - [info] Wed Mar 27 23:34:37 2019 - [info] Executing master ip online change script to disable write on the current master:Wed Mar 27 23:34:37 2019 - [info] /root/dba/mha/script/master_ip_online_change.sh --command=stop --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 --orig_master_user='mha' --orig_master_password='mhapassword' --new_master_host=10.25.1.67 --new_master_ip=10.25.1.67 --new_master_port=3306 --new_master_user='mha' --new_master_password='mhapassword' --orig_master_ssh_user=root --new_master_ssh_user=root --orig_master_is_new_slave2019-03-27 23:34:38 set_mysql_read_only successful!Stopping keepalived: [ OK ]2019-03-27 23:34:38 stop_keepalived successful!Wed Mar 27 23:34:38 2019 - [info] ok.Wed Mar 27 23:34:38 2019 - [info] Locking all tables on the orig master to reject updates from everybody (including root):Wed Mar 27 23:34:38 2019 - [info] Executing FLUSH TABLES WITH READ LOCK..Wed Mar 27 23:34:38 2019 - [info] ok.Wed Mar 27 23:34:38 2019 - [info] Orig master binlog:pos is mysql-bin.004691:854373586.Wed Mar 27 23:34:38 2019 - [info] Waiting to execute all relay logs on 10.25.1.67(10.25.1.67:3306)..Wed Mar 27 23:34:38 2019 - [info] master_pos_wait(mysql-bin.004691:854373586) completed on 10.25.1.67(10.25.1.67:3306). Executed 0 events.Wed Mar 27 23:34:38 2019 - [info] done.Wed Mar 27 23:34:38 2019 - [info] Getting new master's binlog name and position..Wed Mar 27 23:34:38 2019 - [info] mysql-bin.000001:120Wed Mar 27 23:34:38 2019 - [info] All other slaves should start replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST='10.25.1.67', MASTER_PORT=3306, MASTER_LOG_FILE='mysql-bin.000001', MASTER_LOG_POS=120, MASTER_USER='repl', MASTER_PASSWORD='xxx';Wed Mar 27 23:34:38 2019 - [info] Executing master ip online change script to allow write on the new master:Wed Mar 27 23:34:38 2019 - [info] /root/dba/mha/script/master_ip_online_change.sh --command=start --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 --orig_master_user='mha' --orig_master_password='mhapassword' --new_master_host=10.25.1.67 --new_master_ip=10.25.1.67 --new_master_port=3306 --new_master_user='mha' --new_master_password='mhapassword' --orig_master_ssh_user=root --new_master_ssh_user=root --orig_master_is_new_slaveStarting keepalived: [ OK ]2019-03-27 23:34:38 start_keepalived successful!Wed Mar 27 23:34:38 2019 - [info] ok.Wed Mar 27 23:34:38 2019 - [info] Setting read_only=0 on 10.25.1.67(10.25.1.67:3306)..Wed Mar 27 23:34:38 2019 - [info] ok.Wed Mar 27 23:34:38 2019 - [info] Wed Mar 27 23:34:38 2019 - [info] * Switching slaves in parallel..Wed Mar 27 23:34:38 2019 - [info] Wed Mar 27 23:34:38 2019 - [info] -- Slave switch on host 10.25.1.68(10.25.1.68:3306) started, pid: 20673Wed Mar 27 23:34:38 2019 - [info] Wed Mar 27 23:34:38 2019 - [info] Log messages from 10.25.1.68 ...Wed Mar 27 23:34:39 2019 - [info] Wed Mar 27 23:34:38 2019 - [info] Waiting to execute all relay logs on 10.25.1.68(10.25.1.68:3306)..Wed Mar 27 23:34:38 2019 - [info] master_pos_wait(mysql-bin.004691:854373586) completed on 10.25.1.68(10.25.1.68:3306). Executed 0 events.Wed Mar 27 23:34:38 2019 - [info] done.Wed Mar 27 23:34:38 2019 - [info] Resetting slave 10.25.1.68(10.25.1.68:3306) and starting replication from the new master 10.25.1.67(10.25.1.67:3306)..Wed Mar 27 23:34:38 2019 - [info] Executed CHANGE MASTER.Wed Mar 27 23:34:38 2019 - [info] Slave started.Wed Mar 27 23:34:39 2019 - [info] End of log messages from 10.25.1.68 ...Wed Mar 27 23:34:39 2019 - [info] Wed Mar 27 23:34:39 2019 - [info] -- Slave switch on host 10.25.1.68(10.25.1.68:3306) succeeded.Wed Mar 27 23:34:39 2019 - [info] Unlocking all tables on the orig master:Wed Mar 27 23:34:39 2019 - [info] Executing UNLOCK TABLES..Wed Mar 27 23:34:39 2019 - [info] ok.Wed Mar 27 23:34:39 2019 - [info] Starting orig master as a new slave..Wed Mar 27 23:34:39 2019 - [info] Resetting slave 10.25.1.66(10.25.1.66:3306) and starting replication from the new master 10.25.1.67(10.25.1.67:3306)..Wed Mar 27 23:34:39 2019 - [info] Executed CHANGE MASTER.Wed Mar 27 23:34:39 2019 - [info] Slave started.Wed Mar 27 23:34:39 2019 - [info] All new slave servers switched successfully.Wed Mar 27 23:34:39 2019 - [info] Wed Mar 27 23:34:39 2019 - [info] * Phase 5: New master cleanup phase..Wed Mar 27 23:34:39 2019 - [info] Wed Mar 27 23:34:39 2019 - [info] 10.25.1.67: Resetting slave info succeeded.Wed Mar 27 23:34:39 2019 - [info] Switching master to 10.25.1.67(10.25.1.67:3306) completed successfully. 1234# ps -ef|grep babybi_#1.confroot 3578 1 0 Jan08 ? 00:42:35 perl /usr/bin/masterha_manager --conf=/root/dba/mha/conf/babybi_#1.conf --ignore_last_failoverroot 21082 17518 0 23:35 pts/0 00:00:00 grep --colour=auto babybi_#1.conf# Âà∞new_masterÊú∫Âô®‰∏≠Êü•ÁúãVIPÊúâÊ≤°ÊúâÁªëÂÆöËøáÊù•Âà∞ÁΩëÂç°‰∏ä1# ip a 123456789101112131415161718191: lo: mtu 65536 qdisc noqueue state UNKNOWN link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: em1: mtu 1500 qdisc mq master bond0 state UP qlen 1000 link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff3: em2: mtu 1500 qdisc mq master bond0 state UP qlen 1000 link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff4: em3: mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 24:6e:96:13:61:34 brd ff:ff:ff:ff:ff:ff5: em4: mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 24:6e:96:13:61:35 brd ff:ff:ff:ff:ff:ff6: bond0: mtu 1500 qdisc noqueue state UP link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff inet 10.25.1.67/24 brd 10.25.1.255 scope global bond0 inet 10.25.1.203/32 scope global bond0 inet6 fe80::266e:96ff:fe13:6130/64 scope link valid_lft forever preferred_lft forever ÁôªÂΩïÂà∞slaveÊú∫Âô®‰∏ä12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364mysql> show slave status\GERROR 2006 (HY000): MySQL server has gone awayNo connection. Trying to reconnect...Connection id: 2049252955Current database: *** NONE ****************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 10.25.1.67 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 62528 Relay_Log_File: relay-log.000002 Relay_Log_Pos: 62691 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 62528 Relay_Log_Space: 62858 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1673306 Master_UUID: ca479c32-fa0d-11e8-bc0f-246e96136130 Master_Info_File: /my/data/percona/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 01 row in set (0.00 sec)mysql> Ê≠£Â∏∏ CHANGE MASTER TO NEW_MASTER ÁôªÂΩïÂà∞old_master‰∏≠Êü•Áúã1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859mysql> show slave status\G*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 10.25.1.67 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 66875 Relay_Log_File: relay-log.000002 Relay_Log_Pos: 67038 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 66875 Relay_Log_Space: 67205 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1673306 Master_UUID: ca479c32-fa0d-11e8-bc0f-246e96136130 Master_Info_File: /my/data/percona/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 01 row in set (0.00 sec)mysql> Âà∞new_master‰∏äÊü•Áúã12345$ ps -ef|grep keepalivedroot 37477 1 0 23:41 ? 00:00:00 /usr/sbin/keepalived -Droot 37478 37477 0 23:41 ? 00:00:00 /usr/sbin/keepalived -Droot 37479 37477 0 23:41 ? 00:00:00 /usr/sbin/keepalived -Ddbctl 38747 35598 0 23:49 pts/0 00:00:00 grep --colour=auto keepalived Âú®ÂàáÊç¢ÂõûÊù•Âà∞old_masterÊèêÊàê‰∏∫masterÊ≠•È™§ÊåâÁÖß‰∏äÈù¢Êìç‰ΩúÔºåÂ∞±‰∏çÈáçÂ§çÊê¨Á†ñ‰∫Ü„ÄÇ ÁªìÊûúMHA È´òÂèØÁî®ÈõÜÁæ§ÂàáÊç¢ÊàêÂäüÔºåËôΩÁÑ∂ÊòØÊâãÂä®MHA failoverÊµãËØïÔºåÂπ∂‰∏çËÉΩ‰ª£Ë°®MHAÁöÑÈ´òÂèØÁî®„ÄÇ‰ª•ÂêéËøò‰ºöÊåâÁÖß‰∏äÈù¢Áº©ÂÜôÁöÑÊ≠•È™§Âú®Âä†‰∏ä‰∏ÄÂÆöÁöÑ‰∏ª‰ªéÊï∞ÊçÆÂêåÊ≠•Âª∂ËøüÊù•ËøõË°åÊºîÁªÉ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MHA</category>
      </categories>
      <tags>
        <tag>MHA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS Install git Source]]></title>
    <url>%2F2019%2F03%2F25%2Fgit-install%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄGit ÂêåÁîüÊ¥ª‰∏≠ÁöÑËÆ∏Â§ö‰ºüÂ§ß‰∫ã‰ª∂‰∏ÄÊ†∑ÔºåGit ËØûÁîü‰∫é‰∏Ä‰∏™ÊûÅÂØåÁ∫∑‰∫âÂ§ß‰∏æÂàõÊñ∞ÁöÑÂπ¥‰ª£„ÄÇLinux ÂÜÖÊ†∏ÂºÄÊ∫êÈ°πÁõÆÊúâÁùÄ‰∏∫Êï∞‰ºóÂπøÁöÑÂèÇ‰∏éËÄÖ„ÄÇÁªùÂ§ßÂ§öÊï∞ÁöÑ Linux ÂÜÖÊ†∏Áª¥Êä§Â∑•‰ΩúÈÉΩËä±Âú®‰∫ÜÊèê‰∫§Ë°•‰∏ÅÂíå‰øùÂ≠òÂΩíÊ°£ÁöÑÁπÅÁêê‰∫ãÂä°‰∏äÔºà1991Ôºç2002Âπ¥Èó¥Ôºâ„ÄÇÂà∞ 2002 Âπ¥ÔºåÊï¥‰∏™È°πÁõÆÁªÑÂºÄÂßãÂêØÁî®ÂàÜÂ∏ÉÂºèÁâàÊú¨ÊéßÂà∂Á≥ªÁªü BitKeeper Êù•ÁÆ°ÁêÜÂíåÁª¥Êä§‰ª£Á†Å„ÄÇÂÆòÊñπÊñáÊ°£ Âà∞‰∫Ü 2005 Âπ¥ÔºåÂºÄÂèë BitKeeper ÁöÑÂïÜ‰∏öÂÖ¨Âè∏Âêå Linux ÂÜÖÊ†∏ÂºÄÊ∫êÁ§æÂå∫ÁöÑÂêà‰ΩúÂÖ≥Á≥ªÁªìÊùüÔºå‰ªñ‰ª¨Êî∂Âõû‰∫ÜÂÖçË¥π‰ΩøÁî® BitKeeper ÁöÑÊùÉÂäõ„ÄÇËøôÂ∞±Ëø´‰Ωø Linux ÂºÄÊ∫êÁ§æÂå∫ÔºàÁâπÂà´ÊòØ Linux ÁöÑÁºîÈÄ†ËÄÖ Linus Torvalds Ôºâ‰∏çÂæó‰∏çÂê∏ÂèñÊïôËÆ≠ÔºåÂè™ÊúâÂºÄÂèë‰∏ÄÂ•óÂ±û‰∫éËá™Â∑±ÁöÑÁâàÊú¨ÊéßÂà∂Á≥ªÁªüÊâç‰∏çËá≥‰∫éÈáçËπàË¶ÜËæô„ÄÇ‰ªñ‰ª¨ÂØπÊñ∞ÁöÑÁ≥ªÁªüÂà∂ËÆ¢‰∫ÜËã•Âπ≤ÁõÆÊ†áÔºö ÈÄüÂ∫¶ ÁÆÄÂçïÁöÑËÆæËÆ° ÂØπÈùûÁ∫øÊÄßÂºÄÂèëÊ®°ÂºèÁöÑÂº∫ÂäõÊîØÊåÅÔºàÂÖÅËÆ∏‰∏äÂçÉ‰∏™Âπ∂Ë°åÂºÄÂèëÁöÑÂàÜÊîØÔºâ ÂÆåÂÖ®ÂàÜÂ∏ÉÂºè ÊúâËÉΩÂäõÈ´òÊïàÁÆ°ÁêÜÁ±ª‰ºº Linux ÂÜÖÊ†∏‰∏ÄÊ†∑ÁöÑË∂ÖÂ§ßËßÑÊ®°È°πÁõÆÔºàÈÄüÂ∫¶ÂíåÊï∞ÊçÆÈáèÔºâ ÂÆâË£Ögit Ê∫êÁ†ÅÂÆâË£Ö„ÄÇ‰∏ãËΩΩÊ∫êÁ†Å1# wget https://github.com/git/git/archive/v2.21.0.zip Ëß£ÂéãÁº©12345# tar zxvf v2.21.0.zip# cd git-2.20.1ÁºñËØëÂëΩ‰ª§Â¶Ç‰∏ã# # make prefix=/usr/local/git all Â¶ÇÊûúÈÅáÂà∞ËØ•ÈîôËØØ 123http.h:6:23: warning: curl/curl.h: No such file or directoryhttp.h:7:23: warning: curl/easy.h: No such file or directory‚Ä¶‚Ä¶ 12ÊâßË°åÂëΩ‰ª§# yum install -y curl curl-devel ÈáçÊñ∞ÊâßË°åÁºñËØëÂëΩ‰ª§ ÂèëÁé∞ÁºñËØëÊä•Èîô 1234567891011121314151617181920212223242526272829303132 CC http.o CC http-walker.o CC http-fetch.o LINK git-http-fetch CC http-push.ohttp-push.c:22:19: warning: expat.h: No such file or directoryhttp-push.c:830: warning: type defaults to ‚Äòint‚Äô in declaration of ‚ÄòXML_Char‚Äôhttp-push.c:830: error: expected ‚Äò;‚Äô, ‚Äò,‚Äô or ‚Äò)‚Äô before ‚Äò*‚Äô tokenhttp-push.c: In function ‚Äòlock_remote‚Äô:http-push.c:900: error: ‚ÄòXML_Parser‚Äô undeclared (first use in this function)http-push.c:900: error: (Each undeclared identifier is reported only oncehttp-push.c:900: error: for each function it appears in.)http-push.c:900: error: expected ‚Äò;‚Äô before ‚Äòparser‚Äôhttp-push.c:907: warning: implicit declaration of function ‚ÄòXML_SetUserData‚Äôhttp-push.c:907: error: ‚Äòparser‚Äô undeclared (first use in this function)http-push.c:908: warning: implicit declaration of function ‚ÄòXML_SetElementHandler‚Äôhttp-push.c:910: warning: implicit declaration of function ‚ÄòXML_SetCharacterDataHandler‚Äôhttp-push.c:910: error: ‚Äòxml_cdata‚Äô undeclared (first use in this function)http-push.c:911: warning: implicit declaration of function ‚ÄòXML_Parse‚Äôhttp-push.c:916: warning: implicit declaration of function ‚ÄòXML_ErrorString‚Äôhttp-push.c:917: warning: implicit declaration of function ‚ÄòXML_GetErrorCode‚Äôhttp-push.c:920: warning: implicit declaration of function ‚ÄòXML_ParserFree‚Äôhttp-push.c: In function ‚Äòremote_ls‚Äô:http-push.c:1154: error: ‚ÄòXML_Parser‚Äô undeclared (first use in this function)http-push.c:1154: error: expected ‚Äò;‚Äô before ‚Äòparser‚Äôhttp-push.c:1161: error: ‚Äòparser‚Äô undeclared (first use in this function)http-push.c:1164: error: ‚Äòxml_cdata‚Äô undeclared (first use in this function)http-push.c: In function ‚Äòlocking_available‚Äô:http-push.c:1228: error: ‚ÄòXML_Parser‚Äô undeclared (first use in this function)http-push.c:1228: error: expected ‚Äò;‚Äô before ‚Äòparser‚Äôhttp-push.c:1235: error: ‚Äòparser‚Äô undeclared (first use in this function)make: *** [http-push.o] Error 1 ÊâßË°åÂëΩ‰ª§Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò1# yum install -y expat-devel ÂÜçÊ¨°ÈáçÊñ∞ÊâßË°åÁºñËØëÂëΩ‰ª§ ÂèëÁé∞ÂÜçÊ¨°Êä•Èîô 1234567GITGUI_VERSION = 0.21.GITGUI * new locations or Tcl/Tk interpreter GEN git-gui INDEX lib/ * tclsh failed; using unoptimized loading MSGFMT po/bg.msg make[1]: *** [po/bg.msg] Error 127make: *** [all] Error 2 ÊâßË°åÂëΩ‰ª§Ëß£ÂÜ≥1# yum install -y tcl build-essential tk gettext ÂÜçÊ¨°ÈáçÊñ∞ÊâßË°åÁºñËØëÂëΩ‰ª§ gitÊ∫êÁ†ÅÁºñËØëÊàêÂäüÊâßË°åÊâßË°åÂëΩ‰ª§1# make prefix=/usr/local/git install 123456789101112# cd /usr/local/git/# lsbin libexec share# cd bin/# lsgit git-cvsserver gitk git-receive-pack git-shell git-upload-archive git-upload-pack# ./git --versiongit version 2.20.1 ÂÆâË£ÖÂÆåÊàê„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux Netcat ÂëΩ‰ª§ - ÁΩëÁªú‰∏≠ÁöÑÁëûÂ£´ÂÜõÂàÄ]]></title>
    <url>%2F2019%2F03%2F25%2Fnc%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄnetcatÊòØÁΩëÁªúÂ∑•ÂÖ∑‰∏≠ÁöÑÁëûÂ£´ÂÜõÂàÄÔºåÂÆÉËÉΩÈÄöËøáTCPÂíåUDPÂú®ÁΩëÁªú‰∏≠ËØªÂÜôÊï∞ÊçÆ„ÄÇÈÄöËøá‰∏éÂÖ∂‰ªñÂ∑•ÂÖ∑ÁªìÂêàÂíåÈáçÂÆöÂêëÔºå‰Ω†ÂèØ‰ª•Âú®ËÑöÊú¨‰∏≠‰ª•Â§öÁßçÊñπÂºè‰ΩøÁî®ÂÆÉ„ÄÇ‰ΩøÁî®netcatÂëΩ‰ª§ÊâÄËÉΩÂÆåÊàêÁöÑ‰∫ãÊÉÖ‰ª§‰∫∫ÊÉäËÆ∂„ÄÇÂÆÉÁöÑ‰∏ãËΩΩÂú∞ÂùÄ netcatÊâÄÂÅöÁöÑÂ∞±ÊòØÂú®‰∏§Âè∞ÁîµËÑë‰πãÈó¥Âª∫Á´ãÈìæÊé•Âπ∂ËøîÂõû‰∏§‰∏™Êï∞ÊçÆÊµÅÔºåÂú®Ëøô‰πãÂêéÊâÄËÉΩÂÅöÁöÑ‰∫ãÂ∞±Áúã‰Ω†ÁöÑÊÉ≥ÂÉèÂäõ‰∫Ü„ÄÇ‰Ω†ËÉΩÂª∫Á´ã‰∏Ä‰∏™ÊúçÂä°Âô®Ôºå‰º†ËæìÊñá‰ª∂Ôºå‰∏éÊúãÂèãËÅäÂ§©Ôºå‰º†ËæìÊµÅÂ™í‰ΩìÊàñËÄÖÁî®ÂÆÉ‰Ωú‰∏∫ÂÖ∂ÂÆÉÂçèËÆÆÁöÑÁã¨Á´ãÂÆ¢Êà∑Á´Ø„ÄÇ1234567891011121314151617181920212223242526272829$ nc -husage: nc [-46DdhklnrStUuvzC] [-i interval] [-p source_port] [-s source_ip_address] [-T ToS] [-w timeout] [-X proxy_version] [-x proxy_address[:port]] [hostname] [port[s]] Command Summary: -4 Use IPv4 -6 Use IPv6 -D Enable the debug socket option -d Detach from stdin -h This help text -i secs Delay interval for lines sent, ports scanned -k Keep inbound sockets open for multiple connects -l Listen mode, for inbound connects -n Suppress name/port resolutions -p port Specify local port for remote connects -r Randomize remote ports -S Enable the TCP MD5 signature option -s addr Local source address -T ToS Set IP Type of Service -C Send CRLF as line-ending -t Answer TELNET negotiation -U Use UNIX domain socket -u UDP mode -v Verbose -w secs Timeout for connects and final net reads -X proto Proxy protocol: "4", "5" (SOCKS) or "connect" -x addr[:port] Specify proxy address and port -z Zero-I/O mode [used for scanning] Port numbers can be individual or ranges: lo-hi [inclusive] 1234$ ncusage: nc [-46DdhklnrStUuvzC] [-i interval] [-p source_port] [-s source_ip_address] [-T ToS] [-w timeout] [-X proxy_version] [-x proxy_address[:port]] [hostname] [port[s]] nc ÁöÑÂü∫Êú¨ÂäüËÉΩÂ¶Ç‰∏ãÔºö telnet / Ëé∑ÂèñÁ≥ªÁªü banner ‰ø°ÊÅØ ‰º†ËæìÊñáÊú¨‰ø°ÊÅØ ‰º†ËæìÊñá‰ª∂ÂíåÁõÆÂΩï Âä†ÂØÜ‰º†ËæìÊñá‰ª∂ Á´ØÂè£Êâ´Êèè ËøúÁ®ãÊéßÂà∂ / Ê≠£ÊñπÂêë shell ÊµÅÂ™í‰ΩìÊúçÂä°Âô® ËøúÁ®ãÂÖãÈöÜÁ°¨Áõò ‰ΩøÁî®‰æãÂ≠êÁ´ØÂè£Êâ´ÊèèÁ´ØÂè£Êâ´ÊèèÁªèÂ∏∏Ë¢´Á≥ªÁªüÁÆ°ÁêÜÂëòÂíåÈªëÂÆ¢Áî®Êù•ÂèëÁé∞Âú®‰∏Ä‰∫õÊú∫Âô®‰∏äÂºÄÊîæÁöÑÁ´ØÂè£ÔºåÂ∏ÆÂä©‰ªñ‰ª¨ËØÜÂà´Á≥ªÁªü‰∏≠ÁöÑÊºèÊ¥û1$ nc -z -v -n 192.168.10.10 10-100 ÂèØ‰ª•ËøêË°åÂú®TCPÊàñËÄÖUDPÊ®°ÂºèÔºåÈªòËÆ§ÊòØTCPÔºå-uÂèÇÊï∞Ë∞ÉÊï¥‰∏∫udp. z ÂèÇÊï∞ÂëäËØânetcat‰ΩøÁî®0 IO,ËøûÊé•ÊàêÂäüÂêéÁ´ãÂç≥ÂÖ≥Èó≠ËøûÊé•Ôºå ‰∏çËøõË°åÊï∞ÊçÆ‰∫§Êç¢ v ÂèÇÊï∞Êåá‰ΩøÁî®ÂÜó‰ΩôÈÄâÈ°πÔºàËØëËÄÖÊ≥®ÔºöÂç≥ËØ¶ÁªÜËæìÂá∫Ôºâ n ÂèÇÊï∞ÂëäËØânetcat ‰∏çË¶Å‰ΩøÁî®DNSÂèçÂêëÊü•ËØ¢IPÂú∞ÂùÄÁöÑÂüüÂêç Ëøô‰∏™ÂëΩ‰ª§‰ºöÊâìÂç∞21Âà∞25 ÊâÄÊúâÂºÄÊîæÁöÑÁ´ØÂè£„ÄÇBannerÊòØ‰∏Ä‰∏™ÊñáÊú¨ÔºåBannerÊòØ‰∏Ä‰∏™‰Ω†ËøûÊé•ÁöÑÊúçÂä°ÂèëÈÄÅÁªô‰Ω†ÁöÑÊñáÊú¨‰ø°ÊÅØ„ÄÇÂΩì‰Ω†ËØïÂõæÈâ¥Âà´ÊºèÊ¥ûÊàñËÄÖÊúçÂä°ÁöÑÁ±ªÂûãÂíåÁâàÊú¨ÁöÑÊó∂ÂÄôÔºåBanner‰ø°ÊÅØÊòØÈùûÂ∏∏ÊúâÁî®ÁöÑ„ÄÇ‰ΩÜÊòØÔºåÂπ∂‰∏çÊòØÊâÄÊúâÁöÑÊúçÂä°ÈÉΩ‰ºöÂèëÈÄÅbanner„ÄÇ ‰∏ÄÊó¶‰Ω†ÂèëÁé∞ÂºÄÊîæÁöÑÁ´ØÂè£Ôºå‰Ω†ÂèØ‰ª•ÂÆπÊòìÁöÑ‰ΩøÁî®netcat ËøûÊé•ÊúçÂä°ÊäìÂèñ‰ªñ‰ª¨ÁöÑbanner„ÄÇ 1$ nc -v 192.168.10.10 22 netcat ÂëΩ‰ª§‰ºöËøûÊé•ÂºÄÊîæÁ´ØÂè£21Âπ∂‰∏îÊâìÂç∞ËøêË°åÂú®Ëøô‰∏™Á´ØÂè£‰∏äÊúçÂä°ÁöÑbanner‰ø°ÊÅØ„ÄÇ C S(Chat Server) ËÅäÂ§©Server1$ nc -l 10010 netcat ÂëΩ‰ª§Âú®1567Á´ØÂè£ÂêØÂä®‰∫Ü‰∏Ä‰∏™tcp ÊúçÂä°Âô®ÔºåÊâÄÊúâÁöÑÊ†áÂáÜËæìÂá∫ÂíåËæìÂÖ•‰ºöËæìÂá∫Âà∞ËØ•Á´ØÂè£„ÄÇËæìÂá∫ÂíåËæìÂÖ•ÈÉΩÂú®Ê≠§shell‰∏≠Â±ïÁ§∫„ÄÇ Client1$ nc 192.168.10.10 10010 ‰∏çÁÆ°‰Ω†Âú®Êú∫Âô®B‰∏äÈîÆÂÖ•‰ªÄ‰πàÈÉΩ‰ºöÂá∫Áé∞Âú®Êú∫Âô®A‰∏ä„ÄÇ Êñá‰ª∂‰º†ËæìÂ§ßÈÉ®ÂàÜÊó∂Èó¥‰∏≠ÔºåÊàë‰ª¨ÈÉΩÂú®ËØïÂõæÈÄöËøáÁΩëÁªúÊàñËÄÖÂÖ∂‰ªñÂ∑•ÂÖ∑‰º†ËæìÊñá‰ª∂„ÄÇÊúâÂæàÂ§öÁßçÊñπÊ≥ïÔºåÊØîÂ¶ÇFTP,SCP,SMBÁ≠âÁ≠âÔºå‰ΩÜÊòØÂΩì‰Ω†Âè™ÊòØÈúÄË¶Å‰∏¥Êó∂ÊàñËÄÖ‰∏ÄÊ¨°‰º†ËæìÊñá‰ª∂ÔºåÁúüÁöÑÂÄºÂæóÊµ™Ë¥πÊó∂Èó¥Êù•ÂÆâË£ÖÈÖçÁΩÆ‰∏Ä‰∏™ËΩØ‰ª∂Âà∞‰Ω†ÁöÑÊú∫Âô®‰∏äÂòõ„ÄÇÂÅáËÆæÔºå‰Ω†ÊÉ≥Ë¶Å‰º†‰∏Ä‰∏™Êñá‰ª∂testfile.txt ‰ªéA Âà∞B„ÄÇAÊàñËÄÖBÈÉΩÂèØ‰ª•‰Ωú‰∏∫ÊúçÂä°Âô®ÊàñËÄÖÂÆ¢Êà∑Á´ØÔºå‰ª•‰∏ãÔºåËÆ©A‰Ωú‰∏∫ÊúçÂä°Âô®ÔºåB‰∏∫ÂÆ¢Êà∑Á´Ø„ÄÇ Server1$ nc -l 10010 > testfile.txt Client1$ nc -n 192.168.10.10 10010 < testfile.txt ËøôÈáåÊàë‰ª¨ÂàõÂª∫‰∫Ü‰∏Ä‰∏™ÊúçÂä°Âô®Âú®A‰∏äÂπ∂‰∏îÈáçÂÆöÂêënetcatÁöÑËæìÂÖ•‰∏∫Êñá‰ª∂testfile.txtÔºåÈÇ£‰πàÂΩì‰ªª‰ΩïÊàêÂäüËøûÊé•Âà∞ËØ•Á´ØÂè£Ôºånetcat‰ºöÂèëÈÄÅfileÁöÑÊñá‰ª∂ÂÜÖÂÆπ„ÄÇÂú®ÂÆ¢Êà∑Á´ØÊàë‰ª¨ÈáçÂÆöÂêëËæìÂá∫Âà∞testfile.txtÔºåÂΩìBËøûÊé•Âà∞AÔºåAÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπÔºåB‰øùÂ≠òÊñá‰ª∂ÂÜÖÂÆπÂà∞testfile.txt. Ê≤°ÊúâÂøÖË¶ÅÂàõÂª∫Êñá‰ª∂Ê∫ê‰Ωú‰∏∫ServerÔºåÊàë‰ª¨‰πüÂèØ‰ª•Áõ∏ÂèçÁöÑÊñπÊ≥ï‰ΩøÁî®„ÄÇÂÉè‰∏ãÈù¢ÁöÑÊàë‰ª¨ÂèëÈÄÅÊñá‰ª∂‰ªéBÂà∞AÔºå‰ΩÜÊòØÊúçÂä°Âô®ÂàõÂª∫Âú®A‰∏äÔºåËøôÊ¨°Êàë‰ª¨‰ªÖÈúÄË¶ÅÈáçÂÆöÂêënetcatÁöÑËæìÂá∫Âπ∂‰∏îÈáçÂÆöÂêëBÁöÑËæìÂÖ•Êñá‰ª∂„ÄÇ ÁõÆÂΩï‰º†ËæìÂèëÈÄÅ‰∏Ä‰∏™Êñá‰ª∂ÂæàÁÆÄÂçïÔºå‰ΩÜÊòØÂ¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅÂèëÈÄÅÂ§ö‰∏™Êñá‰ª∂ÔºåÊàñËÄÖÊï¥‰∏™ÁõÆÂΩïÔºå‰∏ÄÊ†∑ÂæàÁÆÄÂçïÔºåÂè™ÈúÄË¶Å‰ΩøÁî®ÂéãÁº©Â∑•ÂÖ∑tarÔºåÂéãÁº©ÂêéÂèëÈÄÅÂéãÁº©ÂåÖ„ÄÇ Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅÈÄöËøáÁΩëÁªú‰º†Ëæì‰∏Ä‰∏™ÁõÆÂΩï‰ªéAÂà∞B„ÄÇ Server12$ tar -cvf - dir_name | nc -n 192.168.10.10 10010$ tar -cvf - dir_name | nc 192.168.10.10 10010 Client1$ nc -l 10010 | tar -xvf - ËøôÈáåÂú®AÊúçÂä°Âô®‰∏äÔºåÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™tarÂΩíÊ°£ÂåÖÂπ∂‰∏îÈÄöËøá-Âú®ÊéßÂà∂Âè∞ÈáçÂÆöÂêëÂÆÉÔºåÁÑ∂Âêé‰ΩøÁî®ÁÆ°ÈÅìÔºåÈáçÂÆöÂêëÁªônetcatÔºånetcatÂèØ‰ª•ÈÄöËøáÁΩëÁªúÂèëÈÄÅÂÆÉ„ÄÇ Âú®ÂÆ¢Êà∑Á´ØÊàë‰ª¨‰∏ãËΩΩËØ•ÂéãÁº©ÂåÖÈÄöËøánetcat ÁÆ°ÈÅìÁÑ∂ÂêéÊâìÂºÄÊñá‰ª∂„ÄÇ Â¶ÇÊûúÊÉ≥Ë¶ÅËäÇÁúÅÂ∏¶ÂÆΩ‰º†ËæìÂéãÁº©ÂåÖÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®bzip2ÊàñËÄÖÂÖ∂‰ªñÂ∑•ÂÖ∑ÂéãÁº©„ÄÇ Server123$ tar -cvf - dir_name| bzip2 -z | nc -n 192.168.10.10 10010$ tar -cvf - dir_name| bzip2 -z | nc 192.168.10.10 10010#‰ΩøÁî® bzip2 ÂéãÁº© Client12$ nc -l 10010 | bzip2 -d | tar -xvf -#‰ΩøÁî® bzip2 Ëß£ÂéãÁº© Âä†ÂØÜÈÄöËøáÁΩëÁªúÂèëÈÄÅÁöÑÊï∞ÊçÆÂ¶ÇÊûú‰Ω†ÊãÖÂøÉ‰Ω†Âú®ÁΩëÁªú‰∏äÂèëÈÄÅÊï∞ÊçÆÁöÑÂÆâÂÖ®Ôºå‰Ω†ÂèØ‰ª•Âú®ÂèëÈÄÅ‰Ω†ÁöÑÊï∞ÊçÆ‰πãÂâçÁî®Â¶Ç mcrypt ÁöÑÂ∑•ÂÖ∑Âä†ÂØÜ„ÄÇ Server12$ nc localhost 10010 | mcrypt -flush -bare -F -q -d -m ecb > testfile.txt#‰ΩøÁî®mcryptÂ∑•ÂÖ∑Âä†ÂØÜÊï∞ÊçÆ Client1$ mcrypt -flush -bare -F -q -m ecb < testfile.txt | nc -l 10010 ‰ΩøÁî®mcryptÂ∑•ÂÖ∑Ëß£ÂØÜÊï∞ÊçÆ„ÄÇ ‰ª•‰∏ä‰∏§‰∏™ÂëΩ‰ª§‰ºöÊèêÁ§∫ÈúÄË¶ÅÂØÜÁ†ÅÔºåÁ°Æ‰øù‰∏§Á´Ø‰ΩøÁî®Áõ∏ÂêåÁöÑÂØÜÁ†Å„ÄÇ ËøôÈáåÊàë‰ª¨ÊòØ‰ΩøÁî®mcryptÁî®Êù•Âä†ÂØÜÔºå‰ΩøÁî®ÂÖ∂ÂÆÉ‰ªªÊÑèÂä†ÂØÜÂ∑•ÂÖ∑ÈÉΩÂèØ‰ª•„ÄÇ ÂèçÂêë SHELLÂèçÂêëshellÊòØÊåáÂú®ÂÆ¢Êà∑Á´ØÊâìÂºÄÁöÑshell„ÄÇÂèçÂêëshellËøôÊ†∑ÂëΩÂêçÊòØÂõ†‰∏∫‰∏çÂêå‰∫éÂÖ∂‰ªñÈÖçÁΩÆÔºåËøôÈáåÊúçÂä°Âô®‰ΩøÁî®ÁöÑÊòØÁî±ÂÆ¢Êà∑Êèê‰æõÁöÑÊúçÂä°„ÄÇ Server1$ nc -l 10010 Âú®ÂÆ¢Êà∑Á´ØÔºåÁÆÄÂçïÂú∞ÂëäËØânetcatÂú®ËøûÊé•ÂÆåÊàêÂêéÔºåÊâßË°åshell Client1$ nc 192.168.10.10 10010 -e /bin/bash Áé∞Âú®Ôºå‰ªÄ‰πàÊòØÂèçÂêëshellÁöÑÁâπÂà´‰πãÂ§ÑÂë¢ ÂèçÂêëshellÁªèÂ∏∏Ë¢´Áî®Êù•ÁªïËøáÈò≤ÁÅ´Â¢ôÁöÑÈôêÂà∂ÔºåÂ¶ÇÈòªÊ≠¢ÂÖ•Á´ôËøûÊé•„ÄÇ‰æãÂ¶ÇÔºåÊàëÊúâ‰∏Ä‰∏™‰∏ìÁî®IPÂú∞ÂùÄ‰∏∫192.168.10.10ÔºåÊàë‰ΩøÁî®‰ª£ÁêÜÊúçÂä°Âô®ËøûÊé•Âà∞Â§ñÈÉ®ÁΩëÁªú„ÄÇÂ¶ÇÊûúÊàëÊÉ≥‰ªéÁΩëÁªúÂ§ñÈÉ®ËÆøÈóÆ ËøôÂè∞Êú∫Âô®Â¶Ç10.1.1.10ÁöÑshellÔºåÈÇ£‰πàÊàë‰ºöÁî®ÂèçÂêëÂ§ñÂ£≥Áî®‰∫éËøô‰∏ÄÁõÆÁöÑ„ÄÇ ÂÖãÈöÜËÆæÂ§áÂ¶ÇÊûú‰Ω†Â∑≤ÁªèÂÆâË£ÖÈÖçÁΩÆ‰∏ÄÂè∞LinuxÊú∫Âô®Âπ∂‰∏îÈúÄË¶ÅÈáçÂ§çÂêåÊ†∑ÁöÑÊìç‰ΩúÂØπÂÖ∂‰ªñÁöÑÊú∫Âô®ÔºåËÄå‰Ω†‰∏çÊÉ≥Âú®ÈáçÂ§çÈÖçÁΩÆ‰∏ÄÈÅç„ÄÇ‰∏çÂú®ÈúÄË¶ÅÈáçÂ§çÈÖçÁΩÆÂÆâË£ÖÁöÑËøáÁ®ãÔºåÂè™ÂêØÂä®Âè¶‰∏ÄÂè∞Êú∫Âô®ÁöÑ‰∏Ä‰∫õÂºïÂØºÂèØ‰ª•ÈöèË∫´Á¢üÂíåÂÖãÈöÜ‰Ω†ÁöÑÊú∫Âô®„ÄÇ ÂÖãÈöÜLinux PCÂæàÁÆÄÂçïÔºåÂÅáÂ¶Ç‰Ω†ÁöÑÁ≥ªÁªüÂú®Á£ÅÁõò/dev/sda‰∏ä Server1$ dd if=/dev/sda | nc -l 10010 Âú®ÂÆ¢Êà∑Á´ØÔºåÁÆÄÂçïÂú∞ÂëäËØânetcatÂú®ËøûÊé•ÂÆåÊàêÂêéÔºåÊâßË°åshell Client1$ nc -n 192.168.10.10 10010 | dd of=/dev/sda ddÊòØ‰∏Ä‰∏™‰ªéÁ£ÅÁõòËØªÂèñÂéüÂßãÊï∞ÊçÆÁöÑÂ∑•ÂÖ∑ÔºåÊàëÈÄöËøánetcatÊúçÂä°Âô®ÈáçÂÆöÂêëÂÆÉÁöÑËæìÂá∫ÊµÅÂà∞ÂÖ∂‰ªñÊú∫Âô®Âπ∂‰∏îÂÜôÂÖ•Âà∞Á£ÅÁõò‰∏≠ÔºåÂÆÉ‰ºöÈöèÁùÄÂàÜÂå∫Ë°®Êã∑Ë¥ùÊâÄÊúâÁöÑ‰ø°ÊÅØ„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÊàë‰ª¨Â∑≤ÁªèÂÅöËøáÂàÜÂå∫Âπ∂‰∏îÂè™ÈúÄË¶ÅÂÖãÈöÜrootÂàÜÂå∫ÔºåÊàë‰ª¨ÂèØ‰ª•Ê†πÊçÆÊàë‰ª¨Á≥ªÁªürootÂàÜÂå∫ÁöÑ‰ΩçÁΩÆÔºåÊõ¥Êîπsda ‰∏∫sda1Ôºåsda2.Á≠âÁ≠â„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Èò≤Ê≠¢ rm -rf ËØØÂà†Â∏¶Êù•ÁöÑÁÅæÈöæ]]></title>
    <url>%2F2019%2F03%2F20%2Ftrash-cli%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÊêûËøáËøêÁª¥ÊÉ≥ËøáË°å‰∏öÁöÑÊ∑´‰ª¨ÈÉΩÊúâËøárm‰πã‰º§ÔºåÈÄ†ÊàêË°ÄÁöÑÊïôËÆ≠„ÄÇ‰∏∫‰∫ÜÈÅøÂÖç‰ª•ÂêéÊâçÂá∫Áé∞Á±ª‰ººÁöÑÊÉÖÂÜµÔºåÂº∫ÁÉàÂª∫ËÆÆÁîü‰∫ßÁéØÂ¢É‰∏≠ÂçÉ‰∏á‰∏çË¶Å‰ΩøÁî®rm -rf ËøôÁßçÊìç‰ΩúÔºåÂ§™Âç±Èô©‰∫Ü„ÄÇ‰∏∫‰ªÄ‰πà‰∏çÂ≠¶Â≠¶Ubuntu/MacOSÁ≠âÁ≥ªÁªüÊúâ‰∏Ä‰∏™ÂõûÊî∂Á´ôÔºåÂà†Èô§‰∫ÜÂèØ‰ª•ÂéªÂõûÊî∂Á´ôÈáåÈù¢Êâæ„ÄÇÁªèËøáÊäòËÖæ‰∏ÄÁï™ÔºåÁªà‰∫éÊâæÂà∞‰∫Ü‰∏Ä‰∏™Â∑•ÂÖ∑ trash-cli„ÄÇtrash-cliÊòØ‰∏Ä‰∏™‰ΩøÁî® python ÂºÄÂèëÁöÑËΩØ‰ª∂ÂåÖÔºåtrash-cli trashesËÆ∞ÂΩïÂéüÂßãË∑ØÂæÑÔºåÂà†Èô§Êó•ÊúüÂíåÊùÉÈôêÁöÑÊñá‰ª∂„ÄÇÂÆÉ‰ΩøÁî®KDEÔºåGNOMEÂíåXFCE‰ΩøÁî®ÁöÑÁõ∏ÂêåÂûÉÂúæÊ°∂Ôºå‰ΩÜÊÇ®ÂèØ‰ª•‰ªéÂëΩ‰ª§Ë°åÔºàÂíåËÑöÊú¨ÔºâË∞ÉÁî®ÂÆÉ„ÄÇÂåÖÂê´:12345* trash-put trash files and directories.* trash-empty empty the trashcan(s).* trash-list list trashed files.* trash-restore restore a trashed file.* trash-rm remove individual files from the trashcan. trash-cli ÂÆâË£ÖThe easy wayRequirements: Python 2.7 or Python 3 setuptools (use apt-get install python-setuptools on Debian) Installation command:1easy_install trash-cli From sourcesSystem-wide installation:123git clone https://github.com/andreafrancia/trash-cli.gitcd trash-clisudo python setup.py install User-only installation:123git clone https://github.com/andreafrancia/trash-cli.gitcd trash-clipython setup.py install --user trash-cli ÂëΩ‰ª§Êü•ÁúãÂÆâË£ÖÊàêÂäü‰πãÂêéÁöÑÂëΩ‰ª§1234567# ll /usr/bin/ | grep trash-rwxr-xr-x 1 root root 123 Feb 2 17:43 trash-rwxr-xr-x 1 root root 125 Feb 2 17:43 trash-empty-rwxr-xr-x 1 root root 124 Feb 2 17:43 trash-list-rwxr-xr-x 1 root root 123 Feb 2 17:43 trash-put-rwxr-xr-x 1 root root 127 Feb 2 17:43 trash-restore-rwxr-xr-x 1 root root 122 Feb 2 17:43 trash-rm ÂäüËÉΩËØ¥ÊòéÔºö trash-put Â∞ÜÊñá‰ª∂ÊàñÁõÆÂΩïÁßªÂÖ•ÂõûÊî∂Á´ô trash-empty Ê∏ÖÁ©∫ÂõûÊî∂Á´ô trash-list ÂàóÂá∫ÂõûÊî∂Á´ô‰∏≠ÁöÑÊñá‰ª∂ trash-restore ËøòÂéüÂõûÊî∂Á´ô‰∏≠ÁöÑÊñá‰ª∂ trash-rm Âà†Èô§ÂõûÈ¶ñÁ´ô‰∏≠ÁöÑÂçï‰∏™Êñá‰ª∂ Áî®ÂÆÉÊõø‰ª£ rmÂëΩ‰ª§1234# vim .bashrc # .bashrc#alias rm='rm -i'alias rm='trash-put' ÂÆûÈ™åÊµãËØïÂà†Èô§ÊµãËØïÔºö123456# rm -rf dump.sql# ll ~/.local/share/Trash/files -rw-r--r-- 1 root root 123 Jul 17 2018 dump.sql # trash-list2019-02-02 18:02:33 /root/dump.sql ËøòÂéüÂà†Èô§ÁöÑÊñá‰ª∂12345678# trash-restore /root/dump.rdb 0 2019-02-02 18:01:08 /root/dump.sql.bak 1 2019-02-02 18:02:33 /root/dump.sqlWhat file to restore [0..1]: 1ËøòÂéüÊàêÂäü# ll /root/dump.rdb -rw-r--r-- 1 root root 123 Jul 17 2018 /root/dump.sql ÁªìÊùütrash-putÂëΩ‰ª§‰ºöÊääÊàë‰ª¨ÊÉ≥Ë¶ÅÂà†Èô§ÁöÑÊñá‰ª∂ÁßªÂä®Âà∞~/.local/share/Trash/files ‰∏≠„ÄÇÁõ∏ÂÖ≥‰ø°ÊÅØËÆ∞ÂΩïÂú®~/.local/share/Trash/info‰∏≠„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ClickHouse-sync-to-MySQLDate]]></title>
    <url>%2F2019%2F03%2F20%2FClickHouse-sync-to-MySQLDate%2F</url>
    <content type="text"><![CDATA[ÂâçË®Ä ClickHouse ËøôÊ¨æ‰∫ßÂìÅÂ§ßÂÆ∂ÈÉΩÂê¨ËØ¥ËøáÂæàÂø´Ôºå‰ΩÜÊòØÂà∞Â∫ïÊúâÂ§öÊÅêÊÄñÔºü ClickHouse Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü ‰ªãÁªçClickHouseÊúÄÂàùÊòØ‰∏∫ Yandex.Metrica ‰∏ñÁïåÁ¨¨‰∫åÂ§ßWebÂàÜÊûêÂπ≥Âè∞ ËÄåÂºÄÂèëÁöÑ„ÄÇÂ§öÂπ¥Êù•‰∏ÄÁõ¥‰Ωú‰∏∫ËØ•Á≥ªÁªüÁöÑÊ†∏ÂøÉÁªÑ‰ª∂Ë¢´ËØ•Á≥ªÁªüÊåÅÁª≠‰ΩøÁî®ÁùÄ„ÄÇÁõÆÂâç‰∏∫Ê≠¢ÔºåËØ•Á≥ªÁªüÂú®ClickHouse‰∏≠ÊúâË∂ÖËøá13‰∏á‰∫øÊù°ËÆ∞ÂΩïÔºåÂπ∂‰∏îÊØèÂ§©Ë∂ÖËøá200Â§ö‰∫ø‰∏™‰∫ã‰ª∂Ë¢´Â§ÑÁêÜ„ÄÇÂÆÉÂÖÅËÆ∏Áõ¥Êé•‰ªéÂéüÂßãÊï∞ÊçÆ‰∏≠Âä®ÊÄÅÊü•ËØ¢Âπ∂ÁîüÊàêÊä•Âëä„ÄÇÊú¨ÊñáÁÆÄË¶Å‰ªãÁªç‰∫ÜClickHouseÂú®ÂÖ∂Êó©ÊúüÂèëÂ±ïÈò∂ÊÆµÁöÑÁõÆÊ†á„ÄÇ Yandex.MetricaÂü∫‰∫éÁî®Êà∑ÂÆö‰πâÁöÑÂ≠óÊÆµÔºåÂØπÂÆûÊó∂ËÆøÈóÆ„ÄÅËøûÊé•‰ºöËØùÔºåÁîüÊàêÂÆûÊó∂ÁöÑÁªüËÆ°Êä•Ë°®„ÄÇËøôÁßçÈúÄÊ±ÇÂæÄÂæÄÈúÄË¶ÅÂ§çÊùÇËÅöÂêàÊñπÂºèÔºåÊØîÂ¶ÇÂØπËÆøÈóÆÁî®Êà∑ËøõË°åÂéªÈáç„ÄÇÊûÑÂª∫Êä•Ë°®ÁöÑÊï∞ÊçÆÔºåÊòØÂÆûÊó∂Êé•Êî∂Â≠òÂÇ®ÁöÑÊñ∞Êï∞ÊçÆ„ÄÇ Êà™Ëá≥2014Âπ¥4ÊúàÔºåYandex.MetricaÊØèÂ§©Ë∑üË∏™Â§ßÁ∫¶120‰∫ø‰∏™‰∫ã‰ª∂ÔºàÁî®Êà∑ÁöÑÁÇπÂáªÂíåÊµèËßàÔºâ„ÄÇ‰∏∫‰∫ÜÂèØ‰ª•ÂàõÂª∫Ëá™ÂÆö‰πâÁöÑÊä•Ë°®ÔºåÊàë‰ª¨ÂøÖÈ°ªÂ≠òÂÇ®ÂÖ®ÈÉ®Ëøô‰∫õ‰∫ã‰ª∂„ÄÇÂêåÊó∂ÔºåËøô‰∫õÊü•ËØ¢ÂèØËÉΩÈúÄË¶ÅÂú®Âá†ÁôæÊØ´ÁßíÂÜÖÊâ´ÊèèÊï∞Áôæ‰∏áË°åÁöÑÊï∞ÊçÆÔºåÊàñÂú®Âá†ÁßíÂÜÖÊâ´ÊèèÊï∞‰∫øË°åÁöÑÊï∞ÊçÆ„ÄÇ ‰ªÄ‰πàÊòØClickHouse ?ClickHouse ÊòØÈù¢Âêë OLAP ÁöÑÂàÜÂ∏ÉÂºèÂàóÂºè DBMS. ClickHouseÁöÑÊòæËëóÁâπÊÄß ÁúüÊ≠£ÁöÑÈù¢ÂêëÂàóÁöÑDBMS Êï∞ÊçÆÈ´òÊïàÂéãÁº© Á£ÅÁõòÂ≠òÂÇ®ÁöÑÊï∞ÊçÆ Â§öÊ†∏Âπ∂Ë°åÂ§ÑÁêÜ Âú®Â§ö‰∏™ÊúçÂä°Âô®‰∏äÂàÜÂ∏ÉÂºèÂ§ÑÁêÜ SQLËØ≠Ê≥ïÊîØÊåÅ ÂêëÈáèÂåñÂºïÊìé ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞ Á¥¢Âºï ÈÄÇÂêàÂú®Á∫øÊü•ËØ¢ ÊîØÊåÅËøë‰ººÈ¢Ñ‰º∞ËÆ°ÁÆó ÊîØÊåÅÂµåÂ•óÁöÑÊï∞ÊçÆÁªìÊûÑ ÊîØÊåÅÊï∞ÁªÑ‰Ωú‰∏∫Êï∞ÊçÆÁ±ªÂûã ÊîØÊåÅÈôêÂà∂Êü•ËØ¢Â§çÊùÇÊÄß‰ª•ÂèäÈÖçÈ¢ù Â§çÂà∂Êï∞ÊçÆÂ§çÂà∂ÂíåÂØπÊï∞ÊçÆÂÆåÊï¥ÊÄßÁöÑÊîØÊåÅ OLAPÂú∫ÊôØÁöÑÂÖ≥ÈîÆÁâπÂæÅ Â§ßÂ§öÊï∞ÊòØËØªËØ∑Ê±Ç Êï∞ÊçÆÊÄªÊòØ‰ª•Áõ∏ÂΩìÂ§ßÁöÑÊâπ(> 1000 rows)ËøõË°åÂÜôÂÖ• ‰∏ç‰øÆÊîπÂ∑≤Ê∑ªÂä†ÁöÑÊï∞ÊçÆ ÊØèÊ¨°Êü•ËØ¢ÈÉΩ‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñÂ§ßÈáèÁöÑË°åÔºå‰ΩÜÊòØÂêåÊó∂Âèà‰ªÖÈúÄË¶ÅÂ∞ëÈáèÁöÑÂàó ÂÆΩË°®ÔºåÂç≥ÊØè‰∏™Ë°®ÂåÖÂê´ÁùÄÂ§ßÈáèÁöÑÂàó ËæÉÂ∞ëÁöÑÊü•ËØ¢(ÈÄöÂ∏∏ÊØèÂè∞ÊúçÂä°Âô®ÊØèÁßíÊï∞Áôæ‰∏™Êü•ËØ¢ÊàñÊõ¥Â∞ë) ÂØπ‰∫éÁÆÄÂçïÊü•ËØ¢ÔºåÂÖÅËÆ∏Âª∂ËøüÂ§ßÁ∫¶50ÊØ´Áßí Âàó‰∏≠ÁöÑÊï∞ÊçÆÁõ∏ÂØπËæÉÂ∞èÔºö Êï∞Â≠óÂíåÁü≠Â≠óÁ¨¶‰∏≤(‰æãÂ¶ÇÔºåÊØè‰∏™URL 60‰∏™Â≠óËäÇ) Â§ÑÁêÜÂçï‰∏™Êü•ËØ¢Êó∂ÈúÄË¶ÅÈ´òÂêûÂêêÈáèÔºàÊØè‰∏™ÊúçÂä°Âô®ÊØèÁßíÈ´òËææÊï∞ÂçÅ‰∫øË°åÔºâ ‰∫ãÂä°‰∏çÊòØÂøÖÈ°ªÁöÑ ÂØπÊï∞ÊçÆ‰∏ÄËá¥ÊÄßË¶ÅÊ±Ç‰Ωé ÊØè‰∏Ä‰∏™Êü•ËØ¢Èô§‰∫Ü‰∏Ä‰∏™Â§ßË°®Â§ñÈÉΩÂæàÂ∞è Êü•ËØ¢ÁªìÊûúÊòéÊòæÂ∞è‰∫éÊ∫êÊï∞ÊçÆÔºåÊç¢Âè•ËØùËØ¥ÔºåÊï∞ÊçÆË¢´ËøáÊª§ÊàñËÅöÂêàÂêéËÉΩÂ§üË¢´ÁõõÊîæÂú®ÂçïÂè∞ÊúçÂä°Âô®ÁöÑÂÜÖÂ≠ò‰∏≠ ÂàóÂºèÊï∞ÊçÆÂ∫ìÊõ¥ÈÄÇÂêàOLAPÂú∫ÊôØÁöÑÂéüÂõ†ÂàóÂºèÊï∞ÊçÆÂ∫ìÊõ¥ÈÄÇÂêà‰∫éOLAPÂú∫ÊôØ(ÂØπ‰∫éÂ§ßÂ§öÊï∞Êü•ËØ¢ËÄåË®ÄÔºåÂ§ÑÁêÜÈÄüÂ∫¶Ëá≥Â∞ëÊèêÈ´ò‰∫Ü100ÂÄç)Ôºå‰∏ãÈù¢ËØ¶ÁªÜËß£Èáä‰∫ÜÂéüÂõ†(ÈÄöËøáÂõæÁâáÊõ¥ÊúâÂà©‰∫éÁõ¥ËßÇÁêÜËß£)ÔºöË°åÂºèÂàóÂºèÁúãÂà∞Â∑ÆÂà´‰∫Ü‰πàÔºü‰∏ãÈù¢Â∞ÜËØ¶ÁªÜ‰ªãÁªç‰∏∫‰ªÄ‰πà‰ºöÂèëÁîüËøôÁßçÊÉÖÂÜµ„ÄÇ1.ÈíàÂØπÂàÜÊûêÁ±ªÊü•ËØ¢ÔºåÈÄöÂ∏∏Âè™ÈúÄË¶ÅËØªÂèñË°®ÁöÑ‰∏ÄÂ∞èÈÉ®ÂàÜÂàó„ÄÇÂú®ÂàóÂºèÊï∞ÊçÆÂ∫ì‰∏≠‰Ω†ÂèØ‰ª•Âè™ËØªÂèñ‰Ω†ÈúÄË¶ÅÁöÑÊï∞ÊçÆ„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÂè™ÈúÄË¶ÅËØªÂèñ100Âàó‰∏≠ÁöÑ5ÂàóÔºåËøôÂ∞ÜÂ∏ÆÂä©‰Ω†ÊúÄÂ∞ëÂáèÂ∞ë20ÂÄçÁöÑI/OÊ∂àËÄó„ÄÇ2.Áî±‰∫éÊï∞ÊçÆÊÄªÊòØÊâìÂåÖÊàêÊâπÈáèËØªÂèñÁöÑÔºåÊâÄ‰ª•ÂéãÁº©ÊòØÈùûÂ∏∏ÂÆπÊòìÁöÑ„ÄÇÂêåÊó∂Êï∞ÊçÆÊåâÂàóÂàÜÂà´Â≠òÂÇ®Ëøô‰πüÊõ¥ÂÆπÊòìÂéãÁº©„ÄÇËøôËøõ‰∏ÄÊ≠•Èôç‰Ωé‰∫ÜI/OÁöÑ‰ΩìÁßØ„ÄÇ3.Áî±‰∫éI/OÁöÑÈôç‰ΩéÔºåËøôÂ∞ÜÂ∏ÆÂä©Êõ¥Â§öÁöÑÊï∞ÊçÆË¢´Á≥ªÁªüÁºìÂ≠ò„ÄÇ 1234567891011121314151617181920212223242526272829303132333435363738394041$ clickhouse-clientClickHouse client version 0.0.52053.Connecting to localhost:9000.Connected to ClickHouse server version 0.0.52053.:) SELECT CounterID, count() FROM hits GROUP BY CounterID ORDER BY count() DESC LIMIT 20SELECT CounterID, count()FROM hitsGROUP BY CounterIDORDER BY count() DESCLIMIT 20‚îå‚îÄCounterID‚îÄ‚î¨‚îÄ‚îÄcount()‚îÄ‚îê‚îÇ 114208 ‚îÇ 56057344 ‚îÇ‚îÇ 115080 ‚îÇ 51619590 ‚îÇ‚îÇ 3228 ‚îÇ 44658301 ‚îÇ‚îÇ 38230 ‚îÇ 42045932 ‚îÇ‚îÇ 145263 ‚îÇ 42042158 ‚îÇ‚îÇ 91244 ‚îÇ 38297270 ‚îÇ‚îÇ 154139 ‚îÇ 26647572 ‚îÇ‚îÇ 150748 ‚îÇ 24112755 ‚îÇ‚îÇ 242232 ‚îÇ 21302571 ‚îÇ‚îÇ 338158 ‚îÇ 13507087 ‚îÇ‚îÇ 62180 ‚îÇ 12229491 ‚îÇ‚îÇ 82264 ‚îÇ 12187441 ‚îÇ‚îÇ 232261 ‚îÇ 12148031 ‚îÇ‚îÇ 146272 ‚îÇ 11438516 ‚îÇ‚îÇ 168777 ‚îÇ 11403636 ‚îÇ‚îÇ 4120072 ‚îÇ 11227824 ‚îÇ‚îÇ 10938808 ‚îÇ 10519739 ‚îÇ‚îÇ 74088 ‚îÇ 9047015 ‚îÇ‚îÇ 115079 ‚îÇ 8837972 ‚îÇ‚îÇ 337234 ‚îÇ 8205961 ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò20 rows in set. Elapsed: 0.153 sec. Processed 1.00 billion rows, 4.00 GB (6.53 billion rows/s., 26.10 GB/s.):) ClickHouse SQLCreating a Table12345678910111213CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]( name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1], name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2], ... INDEX index_name1 expr1 TYPE type1(...) GRANULARITY value1, INDEX index_name2 expr2 TYPE type2(...) GRANULARITY value2) ENGINE = MergeTree()[PARTITION BY expr][ORDER BY expr][PRIMARY KEY expr][SAMPLE BY expr][SETTINGS name=value, ...] Example of sections setting1ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity=8192 MySQL Êï∞ÊçÆÂØºÂÖ•ÊµãËØïÊµãËØï‰∏Ä12345678910# duÂá∫ÁöÑË°®Â§ßÂ∞è5.5G test_1.ibd# ClickHouseÊìç‰ΩúËØ≠Âè•CREATE TABLE test_1ENGINE = MergeTreeORDER BY id ASSELECT *FROM mysql('host:port', 'dbtest', 'test_1', 'user', 'password') # ËÄóÊó∂ÂíåÂπ≥ÂùáÈÄüÂ∫¶0 rows in set. Elapsed: 137.251 sec. Processed 18.59 million rows, 7.34 GB (135.43 thousand rows/s., 53.48 MB/s.) ÊµãËØï‰∫å123456789# Âè¶‰∏Ä‰∏™Ë°®20G test_2.ibdCREATE TABLE test_2ENGINE = MergeTreeORDER BY id ASSELECT *FROM mysql('host:port', 'dbtest', 'test_2', 'user', 'password') # ‰∏çÁü•ÈÅì‰∏∫Âï•ËøôË°®Ëøô‰πàÂø´Â∞±ÂØºÂÖ•‰∫Ü Ë≤å‰ººÊòØË°åÂ∞ëÔºå‰ΩÜÊòØË°®ÁöÑÊÄªÂ§ßÂ∞èÂ§ßÂïä0 rows in set. Elapsed: 44.389 sec. Processed 13.03 million rows, 1.44 GB (293.44 thousand rows/s., 32.35 MB/s.) ÂèÇËÄÉClickHouse ÂÆòÊñπËµÑÊñô document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>ClickHouse</category>
      </categories>
      <tags>
        <tag>ClickHouse</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[disk cache policy in RAID]]></title>
    <url>%2F2019%2F03%2F11%2Fdisk-cache-policy-in-RAID%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄËøôÁØáÊñáÁ´†ËÉåÂêéÔºåÂ≠óÂ≠óÈÉΩÊòØË°ÄÊ≥™„ÄÇÊõæÁªèÂõ†‰∏∫EXT4-fs errorÔºå‰ªéÂ§úÈáå10ÁÇπÊä¢ÊïëÊï∞ÊçÆÂà∞ÂáåÊô®7ÁÇπÔºå Áù°‰∏Ä‰∏™Â∞èÊó∂ÂÄô‰πãÂêéÔºåÂêÉÈ•≠ÔºåËßÅÂÆ¢Êà∑ÔºåÂëäËØâÂÆ¢Êà∑Êï∞ÊçÆÊÅ¢Â§çÂõûÊù•‰∫Ü„ÄÇÂéüÁêÜÈ¶ñÂÖàÔºåRAIDÁöÑwrite policyÂàÜÊàê‰∏§ÁßçÔºö write back write through ‰∏ÄÁßçÊ®°ÂºèÊòØwrite back‰ºöÊúâÊõ¥Â•ΩÁöÑÊÄßËÉΩ„ÄÇÂõ†‰∏∫Âú®write backÊ®°Âºè‰∏ãÔºåÊï∞ÊçÆÂÜôÂÖ•Controller CacheÔºåÂ∞±ËÆ§‰∏∫Write IOÁªìÊùü‰∫ÜÔºåËÄå‰∏çÈúÄË¶ÅÁ≠âÂæÖÂÜôÂÖ•Hard driver„ÄÇËøôÁßçÊ®°ÂºèÂæàÊòéÊòæÂ≠òÂú®ÂÆâÂÖ®ÈöêÊÇ£ÔºåÂºÇÂ∏∏ÊéâÁîµÊÉÖÂÜµ‰∏ãÔºåÂæàÂÆπÊòìÂºïËµ∑Êï∞ÊçÆ‰∏¢Â§±„ÄÇ Âè¶‰∏ÄÁßçÊ®°ÂºèÊòØwrite throughÔºåËøôÁßçÊ®°ÂºèÊØîËæÉË∞®ÊÖéÔºåÂÆÉÂéãÊ†π‰∏ç‰ΩøÁî®Raid CacheÊù•Âä†ÈÄüÂÜôÊìç‰ΩúÔºåÂõ†Ê≠§ËøôÁßçÊ®°ÂºèÁöÑÊÄßËÉΩË¶ÅÊØîwrite back ‰Ωé‰∏çÂ∞ë„ÄÇ ‰ΩÜÊòØwrite backÁöÑ‰∏çÂÆâÂÖ®‰πüÊòØÊúâÂäûÊ≥ïËß£ÂÜ≥ÁöÑÔºö Á¨¨‰∏Ä‰∏™ÊñπÊ°àÊòØUPS‚ÄìUninterruptible Power SupplyÔºåËøô‰∏™Êåâ‰∏ã‰∏çÊèê Á¨¨‰∫å‰∏™ÊñπÊ°àÊòØBBU‚ÄìBackup Battery UnitÔºåÊúâ‰∫ÜBBUÔºåÂ∞±ÂèØ‰ª•ÂÆâÂøÉÂú∞ÈááÁî®write-backÊ®°Âºè‰∫Ü ÂØπBBU‰∏çÂ§™‰∫ÜËß£ÁöÑÔºåÂèØ‰ª•ÈòÖËØª[Barriers, Caches, Filesystems]Ôºå‰ªãÁªçÁöÑÈùûÂ∏∏Â•Ω ËÆ≤ÂÆå‰∫ÜËøô‰∏™write policyÔºåËøòÊúâ‰∏Ä‰∏™‰∏ú‰∏úÂè´disk cache policyÔºåËøô‰∏™‰∏úË•øÁî®Êù•ÂÜ≥ÂÆöÁ£ÅÁõò‰∏ÄÁ∫ßÁöÑcacheÊòØÂê¶enable„ÄÇ ‰∏ÄÂÆöË¶ÅÊ≥®ÊÑèËøô‰∏™‰∏úË•øÔºåÊó†Êï∞Ë°ÄÊ≥™ÈÉΩÊòØËøô‰∏™‰∏úË•øÂºïËµ∑ÁöÑ„ÄÇ Â¶ÇÊûúÈÄâÊã©write throughÊ®°ÂºèÔºåÂç≥‰∏ç‰ΩøÁî®RAID cacheÔºåËøôÁßçÊÉÖÂÜµ‰∏ãdisk cacheÂØπÊÄßËÉΩÁöÑÊèêÂçáÊòØÂæàÂ§ßÁöÑ„ÄÇ‰ΩÜÊòØÂ∞ΩÁÆ°Â¶ÇÊ≠§Ôºå‰πü‰∏çË¶Åenable disk cacheÔºåÂõ†‰∏∫Ôºå‰ºöÊúâÊï∞ÊçÆ‰∏¢Â§±ÁöÑÈ£éÈô©„ÄÇÂ¶ÇÊûúÂèØËÉΩÂºÇÂ∏∏ÊéâÁîµÔºåÈÇ£‰πà‰∏ÄÂÆö‰∏çË¶Åenable disk cache„ÄÇ Áõ∏ÂÖ≥ÂëΩ‰ª§Êü•Áúãwrite policy Âíå disk cache policyÁöÑÂëΩ‰ª§Â¶Ç‰∏ãÔºö1/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aAll ËæìÂá∫Â¶Ç‰∏ãÔºö1234567891011121314151617181920Virtual Drive: 1 (Target Id: 1)Name :RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3Size : 25.466 TBSector Size : 512Is VD emulated : NoParity Size : 3.637 TBState : OptimalStrip Size : 128 KBNumber Of Drives : 8Span Depth : 1Default Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache if Bad BBUCurrent Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache if Bad BBUDefault Access Policy: Read/WriteCurrent Access Policy: Read/WriteDisk Cache Policy : Disk's DefaultEncryption Type : NonePI type: No PIIs VD Cached: No ÂèØ‰ª•ÁúãÂà∞Disk Cache Policy ÊòØ Disk‚Äôs Default „ÄÇËøô‰∏™defaultÂÄºÂèØ‰ª•ÂàÜÊàê‰ª•‰∏ãÊÉÖÂÜµÔºö For virtual disks containing SATA disks Ôºå Enabled For virtual disks containing SAS disks Ôºå Disabled ÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÂëΩ‰ª§Â∞ÜDisk Cache PolicyÁöÑÂÄºÊîπÊàê Disable1/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -DisDskCache -Immediate -Lall -aAll ËæìÂá∫Â¶Ç‰∏ãÔºö123456789Set Disk Cache Policy to Disabled on Adapter 0, VD 0 (target id: 0) successSet Disk Cache Policy to Disabled on Adapter 0, VD 1 (target id: 1) successSet Disk Cache Policy to Disabled on Adapter 0, VD 2 (target id: 2) successSet Disk Cache Policy to Disabled on Adapter 0, VD 3 (target id: 3) successSet Disk Cache Policy to Disabled on Adapter 0, VD 4 (target id: 4) successSet Disk Cache Policy to Disabled on Adapter 0, VD 5 (target id: 5) successSet Disk Cache Policy to Disabled on Adapter 0, VD 6 (target id: 6) successExit Code: 0x00 Ê≠§Êó∂ÂÜçÊ¨°Êü•ÁúãËæìÂá∫Ôºö1234567891011121314151617181920Virtual Drive: 1 (Target Id: 1)Name :RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3Size : 25.466 TBSector Size : 512Is VD emulated : NoParity Size : 3.637 TBState : OptimalStrip Size : 128 KBNumber Of Drives : 8Span Depth : 1Default Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache if Bad BBUCurrent Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache if Bad BBUDefault Access Policy: Read/WriteCurrent Access Policy: Read/WriteDisk Cache Policy : DisabledEncryption Type : NonePI type: No PIIs VD Cached: No Êé®ËçêËÆæÁΩÆ1.ÂïÜÁî®ÁéØÂ¢ÉÔºåRAID‰∏ÄÂÆöË¶ÅÊúâBBU2.write policy ÈááÁî® write back3.disk cache policy ‰∏ÄÂÆöË¶Å‰∏∫disable Ëøô‰∏™Êé®ËçêËÆæÁΩÆÔºåÂíåIntelÁªôÂá∫ÁöÑ Configuring RAID For Optimal Performance ÊòØ‰∏ÄËá¥ÁöÑÔºåÈô§Ê≠§‰ª•Â§ñÔºåRAID Controller and Hard Disk Cache Settings‰πüÁªôÂá∫‰∫ÜÁ±ª‰ººÁöÑÁªìËÆ∫„ÄÇËøô‰∫õÈÉΩÊòØ‰∏çÈîôÁöÑÂèÇËÄÉÊñáÁåÆ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[check e2fsck progress realtime]]></title>
    <url>%2F2019%2F03%2F11%2Fcheck-e2fsck-progress-realtime%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÂØπ‰∫ée2fsck ËÄåË®ÄÔºåÊúâ‰∏§‰∏™ÁâπÁÇπÔºåÂ¶ÇÊûúÊñá‰ª∂Á≥ªÁªüÊòØÂÅ•Â∫∑ÁöÑÔºåÂèØ‰ª•ÂæàÂø´ÂÆåÊàêÔºå3Áßí‰πãÂÜÖËß£ÂÜ≥ÊàòÊñóÔºå‰ΩÜÊòØÁ°ÆÂÆûÂ≠òÂú®errorÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØËÉΩËÄóÊó∂ÈùûÂ∏∏‰πÖÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÔºåËøõÂ∫¶Ê±áÊä•ÊòØÈùûÂ∏∏ÈáçË¶ÅÁöÑÔºåÂ¶ÇÊûú‰∏Ä‰∏™Êñá‰ª∂Á≥ªÁªüÈúÄË¶Å‰øÆÂ§çÂá†‰∏™Â∞èÊó∂ÔºåÂèàÊ≤°ÊúâËøõÂ∫¶Ê±áÊä•Ôºå‰∫∫‰ºöÊäìÁãÇÁöÑ„ÄÇÂÆûÊó∂Ê£ÄÊü• e2fsck ËøõÂ∫¶ÁöÑÊñπÊ≥ïÂú®e2fsck ËøõË°åÁöÑÊó∂ÂÄôÔºåÂú®Âè¶Â§ñ‰∏Ä‰∏™ÁªàÁ´ØÂêëe2fsck ËøõÁ®ãÂèëÈÄÅSIGUSR1‰ø°Âè∑„ÄÇ1watch -n 5 kill -10 `pidof e2fsck` Âú®e2fsckË∞ÉÁî®ÁöÑÁªàÁ´Ø‰∏äÔºåÂ∞±‰ºöÊØè5ÁßíÈíüÊòæÁ§∫‰∏Ä‰∏ãÂÆûÊó∂ÁöÑËøõÂ∫¶„ÄÇ12345678e2fsck 1.42 (29-Nov-2011)/dev/dm-19 contains a file system with errors, check forced.Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information /dev/dm-19: |====================================================== \ 95.8% ÁªìÊùüËØ≠Âπ∂ÈùûÂè™Êúâe2fsck Ëøô‰∏™Â∑•ÂÖ∑‰ºöÂìçÂ∫îSIGUSR1‰ø°Âè∑ÔºåddÂ∑•ÂÖ∑‰πüÊúâÂêåÊ†∑ÁöÑÁâπÁÇπ„ÄÇdd Êã∑Ë¥ùÂ§ßÊñá‰ª∂ÁöÑÊó∂ÂÄôÔºåÂè™ÊúâÂú®Êã∑Ë¥ùÁªìÊùüÁöÑÊó∂ÂÄôÔºåÊâç‰ºöÊ±áÊä•Êó∂Èó¥‰ª•ÂèäÈÄüÂ∫¶Á≠â‰ø°ÊÅØÔºå‰ΩÜÊòØÂÉèÊàëËøôÁßçÁ≠âÂæÖÁÑ¶ËôëÁªºÂêàÁóáÁöÑÈÄâÊâãÔºå‰∏ÄÂÆöÊòØ‰ºöÊäìÁãÇÁöÑÔºåÂêåÊ†∑ÈÅìÁêÜÔºåÈÄöËøáÂÆûÊó∂ÂêëddËøõÁ®ãÂèëÈÄÅ SIGUSR1‰ø°Âè∑ÔºåddËøõÁ®ãÂ∞±‰ºöÊó∂Êó∂Ê±áÊä•ÈÄüÁéá‰ø°ÊÅØÔºå‰∏çÂ¶®ËØïËØïÔºåÂæàÊúâÁî®„ÄÇ ÂØπ‰∫éÂºÄÂèëÂêÑÁßçÂ∑•ÂÖ∑ÁöÑ‰∫∫Êù•ËØ¥ÔºåÂ¶ÇÊûúÂ∑•ÂÖ∑ËøêË°åÊó∂Èó¥ÂèØËÉΩÂæà‰πÖÔºåÂèØ‰ª•ÈÄöËøáÊ≥®ÂÜåSIGUSR1‰ø°Âè∑ÁöÑÂ§ÑÁêÜÂáΩÊï∞ÔºåÂÆûÊó∂ÂêëÁî®Êà∑Ê±áÊä•ËøõÂ∫¶ÔºåËøôÊòØ‰∏Ä‰∏™‰∏çÈîôÁöÑ‰π†ÊÉØ„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iSCSI_command]]></title>
    <url>%2F2019%2F03%2F11%2FiSCSI-command%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄiSCSIÂÆ¢Êà∑Á´ØÂ∏∏Áî®ÂëΩ‰ª§ÊÄªÊòØÂøòËÆ∞ÔºåÂú®Ê≠§Â§ÑËÆ∞ÂΩï‰∏ã„ÄÇÂ∏∏Áî®ÂëΩ‰ª§Êü•ÁúãÂΩìÂâçsessionÊåÇËΩΩ‰πãÂâçÔºå‰∏ÄËà¨Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö12root@node:~# iscsiadm -m session iscsiadm: No active sessions. ÊåÇËΩΩ‰πãÂêé12345678910111213141516171819202122232425262728293031323334353637383940root@node-242:~# iscsiadm -m session tcp: [2] 10.16.172.247:3260,1 iqn.2018-11.com:BEANroot@node-242:~# iscsiadm -m session -P 3iSCSI Transport Class version 2.0-870version 2.0-871Target: iqn.2018-11.com:BEAN Current Portal: 10.16.172.247:3260,1 Persistent Portal: 10.16.172.247:3260,1 ********** Interface: ********** Iface Name: default Iface Transport: tcp Iface Initiatorname: iqn.1993-08.org.debian:01:c9c12dd76e Iface IPaddress: 10.16.172.242 Iface HWaddress: (null) Iface Netdev: (null) SID: 2 iSCSI Connection State: LOGGED IN iSCSI Session State: LOGGED_IN Internal iscsid Session State: NO CHANGE ************************ Negotiated iSCSI params: ************************ HeaderDigest: None DataDigest: None MaxRecvDataSegmentLength: 262144 MaxXmitDataSegmentLength: 1048576 FirstBurstLength: 262144 MaxBurstLength: 1048576 ImmediateData: Yes InitialR2T: No MaxOutstandingR2T: 1 ************************ Attached SCSI devices: ************************ Host Number: 25 State: running scsi25 Channel 00 Id 0 Lun: 0 Attached scsi disk sde State: running Ê†πÊçÆIP ÂèëÁé∞target1iscsiadm -m discovery -t st -p 10.16.172.246 ËæìÂá∫Â¶Ç‰∏ãÔºö1234root@node:~# iscsiadm -m discovery -t st -p 10.16.172.24610.16.172.246:3260,1 iqn.2018-11.com:BEAN10.16.172.247:3260,1 iqn.2018-11.com:BEAN10.16.172.248:3260,1 iqn.2018-11.com:BEAN ÁôªÂΩïÂà∞ÊåáÂÆötarget1iscsiadm -m node -T [target_name] -p [ip:3260] -l Â¶Ç‰∏ãÊâÄÁ§∫Ôºö1iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -l ËæìÂá∫Â¶Ç‰∏ãÔºö123root@node:~# iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -lLogging in to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]Login to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]: successful ÁôªÂΩï‰πãÂêéÔºåÂèØ‰ª•Áî®iscsiadm -m sessionÊü•Áúã„ÄÇÁªìÊûú‰∏ÄËà¨Â¶Ç‰∏ãÊâÄÁ§∫Ôºö12root@node-242:~# iscsiadm -m session tcp: [3] 10.16.172.246:3260,1 iqn.2018-11.com:BEAN ÁôªÂá∫ÊåáÂÆötarget1iscsiadm -m node -T [target_name] -p [ip:3260] -u ÂÖ∑‰ΩìÊåá‰ª§Â¶Ç‰∏ãÊâÄÁ§∫Ôºö123root@node:~# iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -uLogging out of session [sid: 3, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]Logout of [sid: 3, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]: successful ÁôªÂá∫‰πãÂêéÔºåÂèØ‰ª•Áî®iscsiadm -m session Ê£ÄÊü•ÊïàÊûú„ÄÇ12root@node-242:~# iscsiadm -m session iscsiadm: No active sessions. ‰ø°ÊÅØ‰∏ÄËà¨Êù•ËÆ≤ÔºåÁôªÂΩïtarget‰πãÂêé‰ºöÊñ∞Â¢û‰∏Ä‰∏™ÁõòÁ¨¶ÔºåÁôªÂΩï‰πãÂâçÔºålsblkËæìÂá∫Â¶Ç‰∏ãÔºö123456789101112root@node:~# lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTsda 8:0 0 30G 0 disk ‚îú‚îÄsda1 8:1 0 7M 0 part ‚îú‚îÄsda2 8:2 0 22.2G 0 part /‚îú‚îÄsda3 8:3 0 7.5G 0 part [SWAP]‚îî‚îÄsda4 8:4 0 261M 0 part sdb 8:16 0 100G 0 disk ‚îú‚îÄsdb1 8:17 0 8G 0 part ‚îî‚îÄsdb2 8:18 0 92G 0 part /data/osd.2sdc 8:32 0 2T 0 disk sr0 11:0 1 1024M 0 rom ÊâßË°åÁôªÂΩïtarget‰πãÂêéÔºö123456789101112131415root@node:~# iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -lLogging in to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260] (multiple)Login to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260] successful.root@node2:~# lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTsda 8:0 0 30G 0 disk ‚îú‚îÄsda1 8:1 0 7M 0 part ‚îú‚îÄsda2 8:2 0 22.2G 0 part /‚îú‚îÄsda3 8:3 0 7.5G 0 part [SWAP]‚îî‚îÄsda4 8:4 0 261M 0 part sdb 8:16 0 100G 0 disk ‚îú‚îÄsdb1 8:17 0 8G 0 part ‚îî‚îÄsdb2 8:18 0 92G 0 part /data/osd.2sdc 8:32 0 2T 0 disk sr0 11:0 1 1024M 0 rom Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Êñ∞Â¢û‰∫Ü‰∏Ä‰∏™sdc„ÄÇ Â¶ÇÊûúÁ°ÆÂÆösdcÂíåiSCSI targetÁöÑÂÖ≥Á≥ªÂë¢:1iscsiadm -m session -P 3 ÊØîÂ¶Ç‰πãÂâçÁöÑËæìÂá∫, sdeËøôÂùóÁ£ÅÁõòÂç≥iSCSIÔºåÊù•Ëá™ 10.16.172.247:3260ÁöÑTarget: iqn.2018-11.com:BEAN12345678910111213141516171819202122232425262728293031323334353637root@node:~# iscsiadm -m session -P 3iSCSI Transport Class version 2.0-870version 2.0-871Target: iqn.2018-11.com:BEAN Current Portal: 10.16.172.247:3260,1 Persistent Portal: 10.16.172.247:3260,1 ********** Interface: ********** Iface Name: default Iface Transport: tcp Iface Initiatorname: iqn.1993-08.org.debian:01:c9c12dd76e Iface IPaddress: 10.16.172.242 Iface HWaddress: (null) Iface Netdev: (null) SID: 2 iSCSI Connection State: LOGGED IN iSCSI Session State: LOGGED_IN Internal iscsid Session State: NO CHANGE ************************ Negotiated iSCSI params: ************************ HeaderDigest: None DataDigest: None MaxRecvDataSegmentLength: 262144 MaxXmitDataSegmentLength: 1048576 FirstBurstLength: 262144 MaxBurstLength: 1048576 ImmediateData: Yes InitialR2T: No MaxOutstandingR2T: 1 ************************ Attached SCSI devices: ************************ Host Number: 25 State: running scsi25 Channel 00 Id 0 Lun: 0 Attached scsi disk sde State: running document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iÈÄöËøáipmitoolËé∑ÂèñÂêÑÂÖÉ‰ª∂ÁöÑÊ∏©Â∫¶‰ø°ÊÅØÂíåÊ£ÄÊü•ÁîµÊ∫êÊ®°ÂùóÁä∂ÊÄÅ]]></title>
    <url>%2F2019%2F03%2F11%2Fipmitool%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄipmitoolÂèØ‰ª•Ëé∑ÂèñÂêÑ‰∏™ÂÖÉ‰ª∂ÁöÑÊ∏©Â∫¶‰ø°ÊÅØÔºåÂ¶Ç‰ΩïÂà§Êñ≠ÂêÑ‰∏™ÁªÑ‰ª∂ÁöÑÊ∏©Â∫¶‰ø°ÊÅØÔºåÂêÑ‰∏™ÁªÑ‰ª∂ÁöÑÊ∏©Â∫¶‰ø°ÊÅØÊòØÂê¶OKÔºåÊúâÊ≤°ÊúâÊ∏©Â∫¶ËøáÈ´òÊàñËÄÖËøá‰ΩéÁöÑÂÖÉ‰ª∂ÈúÄË¶ÅÂëäË≠¶ÔºüËé∑ÂèñÂêÑ‰∏™ÂÖÉ‰ª∂Ê∏©Â∫¶ÁöÑÊñπÊ≥ïÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊåá‰ª§Ëé∑ÂèñÊâÄÊúâÂÖÉ‰ª∂ÁöÑÊ∏©Â∫¶‰ø°ÊÅØÂíåÁõ∏ÂÖ≥ÁöÑÁä∂ÊÄÅ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657root@node:~# ipmitool sensor list CPU1 Temp | 29.000 | degrees C | ok | 0.000 | 0.000 | 0.000 | 85.000 | 90.000 | 90.000 CPU2 Temp | 33.000 | degrees C | nr | 10.000 | 10.000 | 10.000 | 30.000 | 30.000 | 30.000 PCH Temp | 32.000 | degrees C | ok | 0.000 | 5.000 | 16.000 | 90.000 | 95.000 | 100.000 System Temp | 30.000 | degrees C | ok | -10.000 | -5.000 | 0.000 | 80.000 | 85.000 | 90.000 Peripheral Temp | 34.000 | degrees C | ok | -10.000 | -5.000 | 0.000 | 80.000 | 85.000 | 90.000 Vcpu1VRM Temp | 28.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 Vcpu2VRM Temp | 34.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 VmemABVRM Temp | 29.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 VmemCDVRM Temp | 28.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 VmemEFVRM Temp | 31.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 VmemGHVRM Temp | 30.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 95.000 | 100.000 | 105.000 P1-DIMMA1 Temp | 27.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 80.000 | 85.000 | 90.000 P1-DIMMA2 Temp | na | | na | na | na | na | na | na | na P1-DIMMB1 Temp | 27.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 80.000 | 85.000 | 90.000 P1-DIMMB2 Temp | na | | na | na | na | na | na | na | na P1-DIMMC1 Temp | na | | na | na | na | na | na | na | na P1-DIMMC2 Temp | na | | na | na | na | na | na | na | na P1-DIMMD1 Temp | na | | na | na | na | na | na | na | na P1-DIMMD2 Temp | na | | na | na | na | na | na | na | na P2-DIMME1 Temp | 29.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 80.000 | 85.000 | 90.000 P2-DIMME2 Temp | na | | na | na | na | na | na | na | na P2-DIMMF1 Temp | 30.000 | degrees C | ok | -5.000 | 0.000 | 5.000 | 80.000 | 85.000 | 90.000 P2-DIMMF2 Temp | na | | na | na | na | na | na | na | na P2-DIMMG1 Temp | na | | na | na | na | na | na | na | na P2-DIMMG2 Temp | na | | na | na | na | na | na | na | na P2-DIMMH1 Temp | na | | na | na | na | na | na | na | na P2-DIMMH2 Temp | na | | na | na | na | na | na | na | na FAN1 | 4400.000 | RPM | ok | 300.000 | 500.000 | 700.000 | 25300.000 | 25400.000 | 25500.000 FAN2 | 4300.000 | RPM | ok | 300.000 | 500.000 | 700.000 | 25300.000 | 25400.000 | 25500.000 FAN3 | 4400.000 | RPM | ok | 300.000 | 500.000 | 700.000 | 25300.000 | 25400.000 | 25500.000 FAN4 | na | | na | na | na | na | na | na | na FAN5 | na | | na | na | na | na | na | na | na FAN6 | na | | na | na | na | na | na | na | na FANA | 4400.000 | RPM | ok | 300.000 | 500.000 | 700.000 | 25300.000 | 25400.000 | 25500.000 FANB | na | | na | na | na | na | na | na | na 12V | 12.315 | Volts | ok | 10.173 | 10.299 | 10.740 | 12.945 | 13.260 | 13.386 5VCC | 5.000 | Volts | ok | 4.246 | 4.298 | 4.480 | 5.390 | 5.546 | 5.598 3.3VCC | 3.316 | Volts | ok | 2.789 | 2.823 | 2.959 | 3.554 | 3.656 | 3.690 VBAT | 3.104 | Volts | ok | 2.376 | 2.480 | 2.584 | 3.494 | 3.598 | 3.676 Vcpu1 | 1.800 | Volts | ok | 1.242 | 1.260 | 1.395 | 1.899 | 2.088 | 2.106 Vcpu2 | 1.809 | Volts | ok | 1.242 | 1.260 | 1.395 | 1.899 | 2.088 | 2.106 VDIMMAB | 1.200 | Volts | ok | 0.948 | 0.975 | 1.047 | 1.344 | 1.425 | 1.443 VDIMMCD | 1.209 | Volts | ok | 0.948 | 0.975 | 1.047 | 1.344 | 1.425 | 1.443 VDIMMEF | 1.209 | Volts | ok | 0.948 | 0.975 | 1.047 | 1.344 | 1.425 | 1.443 VDIMMGH | 1.209 | Volts | ok | 0.948 | 0.975 | 1.047 | 1.344 | 1.425 | 1.443 5VSB | 4.974 | Volts | ok | 4.246 | 4.298 | 4.480 | 5.390 | 5.546 | 5.598 3.3VSB | 3.316 | Volts | ok | 2.789 | 2.823 | 2.959 | 3.554 | 3.656 | 3.690 1.5V PCH | 1.509 | Volts | ok | 1.320 | 1.347 | 1.401 | 1.644 | 1.671 | 1.698 1.2V BMC | 1.209 | Volts | ok | 1.020 | 1.047 | 1.092 | 1.344 | 1.371 | 1.398 1.05V PCH | 1.050 | Volts | ok | 0.870 | 0.897 | 0.942 | 1.194 | 1.221 | 1.248 Chassis Intru | 0x0 | discrete | 0x0000| na | na | na | na | na | na PS1 Status | 0x1 | discrete | 0x0100| na | na | na | na | na | na PS2 Status | 0x1 | discrete | 0x0100| na | na | na | na | na | na AOC_SAS Temp | 60.000 | degrees C | ok | -11.000 | -8.000 | -5.000 | 100.000 | 105.000 | 110.000 HDD Temp | 29.000 | degrees C | ok | -11.000 | -8.000 | -5.000 | 50.000 | 55.000 | 60.000 HDD Status | 0x1 | discrete | 0x01ff| na | na | na | na | na | na ‰∏ÄËà¨Êù•ËÆ≤ÔºåÁ¨¨‰∏âÂàóÁöÑÂÄº‰∏≠ÊúâdegreeÁöÑÔºåÊàë‰ª¨ÁªüËÆ°ÁöÑÊòØÊ∏©Â∫¶‰ø°ÊÅØ„ÄÇ Á¨¨‰∏ÄÂàóÔºö ‰º†ÊÑüÂô®ÁöÑÂêçÁß∞ÔºåÊØîÂ¶ÇCPU1 TempÔºå Á¨¨‰∫åÂàó: ËØ•ÂÖÉ‰ª∂ÁöÑÂΩìÂâçÊ∏©Â∫¶ÂÄºÔºåÊ≥®ÊÑèÊúâÊó∂ÂÄô‰ºöÊòØnaÔºåÂç≥Âèñ‰∏çÂà∞„ÄÇ Á¨¨ÂõõÂàóÔºö Ê∏©Â∫¶ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåokË°®Á§∫Ê∏©Â∫¶Ê≠£Â∏∏ÔºåÊúâÊó∂ÂÄôËØ•Áä∂ÊÄÅÂÄº‰∏∫nrÔºå‰∏∫non-recoveryÔºå‰∏çÂèØÊÅ¢Â§çÁöÑÊÑèÊÄù ‰∏ÄËà¨Êù•ËÆ≤ÔºåÂ∏∏ËßÅÁöÑÊ∏©Â∫¶Áä∂ÊÄÅÊúâ‰ª•‰∏ã5ÁßçÔºö okÔºöÊ∏©Â∫¶Ê≠£Â∏∏ ncÔºö non-criticalÔºåÊ∏©Â∫¶ÂÅèÈ´òÔºàÊàñËÄÖÂÅè‰ΩéÔºâÔºå‰ΩÜÊòØÂπ∂‰∏çÂ§™‰∏•Èáç crÔºöcriticalÔºåÊ∏©Â∫¶Â§™È´òÊàñËÄÖÊ∏©Â∫¶Â§™‰ΩéÔºåÂæà‰∏•Èáç nrÔºö non-recoveryÔºåÊ∏©Â∫¶Â§™È´òÊàñËÄÖÊ∏©Â∫¶Â§™‰ΩéÔºåÈÄ†Êàê‰∏çÂèØÊÅ¢Â§çÁöÑÊçü‰º§„ÄÇ naÔºöÊ∏©Â∫¶Áä∂ÊÄÅ‰∏çÊòéÔºåÊØîËæÉÂ∞ëËßÅ„ÄÇ Ê≥®ÊÑèok ‚Äì> nc ‚Äì> cr ‚Äì> nr ‰ªéÊ≠£Â∏∏ÔºåÂà∞Ë∂äÊù•Ë∂ä‰∏•ÈáçÁöÑÊ∏©Â∫¶ÈóÆÈ¢ò„ÄÇ Â¶Ç‰ΩïËß¶ÂèëÊ∏©Â∫¶ÂëäË≠¶‰ªãÁªç‰∫Ünc cr Âíånr‰∏âÁßçÁä∂ÊÄÅÔºåÈÉΩËØ¥Ê∏©Â∫¶ÂÅèÈ´òÊàñËÄÖÊ∏©Â∫¶ÂÅè‰ΩéÔºåÈÇ£‰πà Ê∏©Â∫¶Âà∞‰ªÄ‰πàÁ®ãÂ∫¶Áä∂ÊÄÅ‰ºöÂèòÊàêncÔºå Ê∏©Â∫¶Âà∞‰ªÄ‰πàÁ®ãÂ∫¶‰ºöÂèòÊàêcr Ê∏©Â∫¶Âà∞‰ªÄ‰πàÁ®ãÂ∫¶‰ºöÂèòÊàênr ÊòæÁÑ∂ÔºåÂêÑ‰∏™ÂÖÉ‰ª∂ÁöÑÁä∂ÊÄÅÊîπÂèòÊòØÊúâÊ∏©Â∫¶Èó®ÈôêÂÄºÁöÑÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊñπÊ≥ïÊü•ÁúãÔºö123456789101112131415161718192021222324252627root@node:~# ipmitool sensor get "CPU1 Temp"Locating sensor record...Sensor ID : CPU1 Temp (0x1) Entity ID : 3.1 (Processor) Sensor Type (Threshold) : Temperature (0x01) Sensor Reading : 29 (+/- 0) degrees C Status : ok Nominal Reading : 40.000 Normal Minimum : -4.000 Normal Maximum : 89.000 Upper non-recoverable : 90.000 Upper critical : 90.000 Upper non-critical : 85.000 Lower non-recoverable : 0.000 Lower critical : 0.000 Lower non-critical : 0.000 Positive Hysteresis : 2.000 Negative Hysteresis : 2.000 Minimum sensor range : Unspecified Maximum sensor range : Unspecified Event Message Control : Per-threshold Readable Thresholds : lnr lcr lnc unc ucr unr Settable Thresholds : lnr lcr lnc unc ucr unr Threshold Read Mask : lnr lcr lnc unc ucr unr Assertion Events : Assertions Enabled : ucr+ Deassertions Enabled : ucr+ ‰ªé‰∏äÈù¢ÁöÑ‰ø°ÊÅØÂèØ‰ª•ÁúãÂá∫Ôºö Upper non-critical 85 Â∫¶ Upper critical 90 Â∫¶ Upper non-recovery 90 Â∫¶ Lower non-critical 0 Â∫¶ Lower critical 0 Â∫¶ Lower non-recoverable Êúâ‰∫ÜÈó®ÈôêÂÄºÔºåÊòØÂì™ÁßçÁä∂ÊÄÅÂ∞±ÊØîËæÉÁÆÄÂçï‰∫Ü„ÄÇ [0,85]‰πãÈó¥ÊòØÔºåÁä∂ÊÄÅok [85,90] Áä∂ÊÄÅ‰∏∫nc [90,] Áä∂ÊÄÅ‰∏∫nr ÔºàÂõ†‰∏∫crÁöÑÈó®ÈôêÂíånrÁöÑÈó®ÈôêÈÉΩÊòØ90ÔºåÁä∂ÊÄÅÂèñnrÔºâ ‰ΩéÊ∏©ÁöÑÊÉÖÂÜµ‰πüÊòØÁ±ª‰ºº„ÄÇ Â¶Ç‰ΩïËÆ©Ê∏©Â∫¶Áä∂ÊÄÅÂëäË≠¶Âë¢ÔºåÂç≥ÂèòÊàêncÊàñËÄÖcrÊàñËÄÖnrÁä∂ÊÄÅÂë¢Ôºü ipmitoolÊèê‰æõ‰∫ÜÊñπÊ≥ïÊù•ËÆæÁΩÆÂêÑ‰∏™Áä∂ÊÄÅÁöÑÈó®ÈôêÂÄº„ÄÇ1ipmitool -I open sensor thresh 'CPU2 Temp' upper 20 30 90 ‰∏äËø∞Êåá‰ª§ÁöÑÊÑèÊÄùÊòØÂ∞ÜCPU2 TempÂÖÉ‰ª∂ÁöÑÂëäË≠¶Èó®Èôê‰∏≠ÁöÑÊ∏©Â∫¶‰∏äÈôêÂëäË≠¶Èó®ÈôêËÆæÁΩÆ‰∏∫20 30 Âíå90. ‰ª•‰∏∫CPUÁöÑÊ∏©Â∫¶ÊòØ33Â∫¶Â∑¶Âè≥ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊåá‰ª§ÔºåÂ∞ÜÁä∂ÊÄÅÂèò‰∏∫ncÔºö12345root@node:~# ipmitool -I open sensor thresh 'CPU2 Temp' upper 20 40 90Locating sensor record 'CPU2 Temp'...Setting sensor "CPU2 Temp" Upper Non-Critical threshold to 20.000Setting sensor "CPU2 Temp" Upper Critical threshold to 40.000Setting sensor "CPU2 Temp" Upper Non-Recoverable threshold to 90.000 12root@node:~# ipmitool sensor listCPU2 Temp | 33.000 | degrees C | nc | 10.000 | 10.000 | 10.000 | 20.000 | 40.000 | 90.000 33ÊëÑÊ∞èÂ∫¶ÔºåË∂ÖËøá‰∫Ü20Â∫¶Ôºå‰ΩÜÊòØÊ≤°Ë¶ÅË∂ÖËøá40Â∫¶ÔºåÂõ†Ê≠§Áä∂ÊÄÅÊòØncÔºåÂç≥non-critical„ÄÇ ÂêåÊ†∑ÈÅìÁêÜÔºåÊàë‰ª¨Â∞ÜÂëäË≠¶Èó®ÈôêËÆæÁΩÆ‰∏∫ 20 30 90ÁöÑËØùÔºåÂ∞±‰ºöÂèëÁé∞Áä∂ÊÄÅ‰∏∫crÔºåÂç≥criticalÔºö123456789root@node:~# ipmitool -I open sensor thresh 'CPU2 Temp' upper 20 30 90Locating sensor record 'CPU2 Temp'...Setting sensor "CPU2 Temp" Upper Non-Critical threshold to 20.000Setting sensor "CPU2 Temp" Upper Critical threshold to 30.000Setting sensor "CPU2 Temp" Upper Non-Recoverable threshold to 90.000root@node:~# ipmitool sensor list CPU1 Temp | 30.000 | degrees C | ok | 0.000 | 0.000 | 0.000 | 85.000 | 90.000 | 90.000 CPU2 Temp | 33.000 | degrees C | cr | 10.000 | 10.000 | 10.000 | 20.000 | 30.000 | 90.000 ÂêåÊ†∑ÈÅìÁêÜÔºåÂèØ‰ª•Â∞ÜÁä∂ÊÄÅÂèòÊàênrÔºåÂè™ÈúÄË¶ÅËÆæÁΩÆÈó®Èôê‰∏∫20 30 30 ÔºåÂç≥ÂèØ„ÄÇ Ê£ÄÊü•ÁîµÊ∫êÊ®°ÂùóÁä∂ÊÄÅÊàë‰ª¨Áü•ÈÅìIPMIÂæàÂº∫Â§ßÔºåÂ¶Ç‰ΩïÂà©Áî®ipmitoolËé∑ÂèñÂà∞ÁîµÊ∫êÁöÑÂÆûÊñΩÁä∂ÊÄÅÁöÑ„ÄÇÁé∞‰ª£ÁöÑÊúçÂä°Âô®ÔºåÂü∫Êú¨‰∏äÈÉΩÊúâ‰∏§‰∏™ÁîµÊ∫êÊ®°ÂùóÔºå‰Ωú‰∏∫ÂÜó‰Ωô„ÄÇÂ¶Ç‰ΩïÊü•ÁúãÁîµÊ∫êÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÂë¢ÔºåÊòØÂê¶ÊâÄÊúâÁöÑÁîµÊ∫êÊ®°ÂùóÈÉΩÂ∑≤ÂêØÁî®ÔºåÁîµÊ∫êÊòØÂê¶ÈÉΩÈÄöÁîµÔºü ÊñπÊ≥ï‰∏ÄÈÄöËøáÂ¶Ç‰∏ãÊåá‰ª§ÂèØ‰ª•Ëé∑ÂèñÂà∞ÁîµÊ∫êÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºö1ipmitool sdr type "power supply" Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÁîµÊ∫êÁöÑÁä∂ÊÄÅÂ¶Ç‰∏ãÊâÄÁ§∫12PS1 Status | C4h | ok | 10.1 | Presence detectedPS2 Status | C5h | ok | 10.2 | Presence detected Â¶ÇÊûúÔºåÊàë‰ª¨Â∞ÜÂÖ∂‰∏≠‰∏Ä‰∏™ÊãîÊéâÁîµÊ∫êÊèíÂ§¥ÔºåÁä∂ÊÄÅÂ∞±‰ºöÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö12PS1 Status | C4h | ok | 10.1 | Presence detectedPS2 Status | C5h | ok | 10.2 | Presence detected, Failure detected, Power Supply AC lost Â¶ÇÊûúÊàë‰ª¨Â∞ÜÂÖ∂‰∏≠‰∏Ä‰∏™ÁöÑÁîµÊ∫êÊ®°Âùó(PSU, power supply unit)Áõ¥Êé•‰ªéÊúçÂä°Âô®‰∏äÊãîÂá∫ÔºåÁä∂ÊÄÅÂ∞±‰ºöÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö12PS1 Status | C4h | ok | 10.1 | Presence detectedPS2 Status | C5h | ok | 10.2 | ‰∫ãÂÆû‰∏äÈô§‰∫Ü‰∏äÈù¢ÁöÑÂá†ÁßçÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá1ipmitool sensor get "PS1 Status" Êü•ÁúãÂÖ∂‰ªñÂèØËÉΩÁöÑÂÄº123456789101112131415161718192021222324Sensor ID : PS1 Status (0xc4)Entity ID : 10.1 (Power Supply)Sensor Type (Discrete): Power Supply (0x08)Sensor Reading : 1h { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ë∞ÅËøû‰∫ÜÊàëÁöÑNFSÁõÆÂΩï]]></title>
    <url>%2F2019%2F03%2F11%2Fshowmount%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÊúâ‰∫õÊó∂ÂÄôÔºå‰Ωú‰∏∫NFS ServerÔºåÈúÄË¶Å‰∫ÜËß£Âì™‰∫õclientÁ´ØËøû‰∫ÜÊàëÁöÑNFS ÁõÆÂΩïÔºåËøôÊó∂ÂÄôÔºåshowmountÂëΩ‰ª§Â∞±Èó™‰∫ÆÁôªÂú∫‰∫Ü„ÄÇ ‰ΩøÁî®ÊñπÊ≥ïshowmount -a ÂèØ‰ª•Êü•ÁúãÔºåÂΩìÂâçÂà∞Â∫ïÊúâÂì™‰∫õclientËøûÊé•‰∫ÜÊú¨Server exportsÁöÑÁõÆÂΩï12345678910root@node # showmount -a All mount points on Storage-b3:10.1.226.105:/var/share/ezfs/shareroot/mgt10.1.227.1:/var/share/ezfs/shareroot/backup10.1.227.201:/var/share/ezfs/shareroot/mgt10.1.227.2:/var/share/ezfs/shareroot/backup10.1.227.3:/var/share/ezfs/shareroot/backup10.1.227.81:/var/share/ezfs/shareroot/mgt10.1.227.85:/var/share/ezfs/shareroot/mgt10.1.232.199:/var/share/ezfs/shareroot/mgt Â∞æÂ£∞showmountÊòØ‰∏Ä‰∏™ÊØîËæÉÁªºÂêàÁöÑÂëΩ‰ª§ÔºåËøòÊúâÂæàÂ§öÂÖ∂ÂÆÉÁöÑÁî®Ê≥ï„ÄÇÂèØ‰ª•ÈÄöËøáman Êü•Áúã„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê∑±ÂÖ•ÁêÜËß£iostat]]></title>
    <url>%2F2019%2F03%2F11%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3iostat%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄiostatÁÆóÊòØÊØîËæÉÈáçË¶ÅÁöÑÊü•ÁúãÂùóËÆæÂ§áËøêË°åÁä∂ÊÄÅÁöÑÂ∑•ÂÖ∑ÔºåÁõ∏‰ø°Â§ßÂ§öÊï∞‰ΩøÁî®LinuxÁöÑÂêåÂ≠¶ÈÉΩÁî®ËøáËøô‰∏™Â∑•ÂÖ∑ÔºåÊàñËÄÖÂê¨ËØ¥ËøáËøô‰∏™Â∑•ÂÖ∑„ÄÇ‰ΩÜÊòØÂØπ‰∫éËøô‰∏™Â∑•ÂÖ∑ÔºåÂºïËµ∑ÁöÑËØØËß£‰πüÊòØÊúÄÂ§öÁöÑÔºåÂ§ßÂ§öÊï∞‰∫∫ÂØπËøô‰∏™Â∑•ÂÖ∑Â§Ñ‰∫éÊú¶Êú¶ËÉßËÉßÁöÑÁä∂ÊÄÅ„ÄÇÁé∞Âú®Êàë‰ª¨Áî±ÊµÖÂà∞Ê∑±Âú∞‰ªãÁªçËøô‰∏™Â∑•ÂÖ∑ÔºåÂÆÉËæìÂá∫ÁöÑÂê´‰πâ‰ªÄ‰πàÔºå‰ªãÁªçÂÆÉÁöÑËÉΩÂäõËæπÁïåÔºå‰ªãÁªçÂÖ≥‰∫éËøô‰∏™Â∑•ÂÖ∑ÁöÑÂ∏∏ËßÅËØØËß£„ÄÇÂü∫Êú¨Áî®Ê≥ïÂíåËæìÂá∫ÁöÑÂü∫Êú¨Âê´‰πâiostatÁöÑÁî®Ê≥ïÊØîËæÉÁÆÄÂçïÔºå‰∏ÄËà¨Êù•ËØ¥Áî®Ê≥ïÂ¶Ç‰∏ãÔºö1iostat -mtx 2 Âê´‰πâÊòØËØ¥ÔºåÊØè2ÁßíÈíüÈááÈõÜ‰∏ÄÁªÑÊï∞ÊçÆÔºö123-m Display statistics in megabytes per second.-t Print the time for each report displayed. The timestamp format may depend on the value of the S_TIME_FORMAT environment variable (see below).-x Display extended statistics. ËæìÂá∫ÁöÑÁªìÊûúÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö Ê≥®ÊÑèÔºå‰∏äÂõæÊòØÂú®ÂØπsdcËøôÂùóÂçïÁõòÔºàRAIDÂç°‰∏äÁöÑÂçïÁõòÔºâÂÅö4KBÁöÑÈöèÊú∫ÂÜôÂÖ•ÊµãËØïÔºö1fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=64 --numjobs=1 --rate_iops=5000 --filename=/dev/sdf --direct=1 --group_reporting Âõ†Ê≠§‰∏äÂõæ‰∏≠Âè™ÊúâsdcÂú®Âøô„ÄÇÂ¶Ç‰ΩïÈòÖËØªiostatÁöÑËæìÂá∫ÔºåÂêÑ‰∏™ÂèÇÊï∞ÈÉΩÊòØ‰ªÄ‰πàÂê´‰πâÔºåÂèçÊò†‰∫ÜÁ£ÅÁõòÁöÑ‰ªÄ‰πà‰ø°ÊÅØÔºüÁ¨¨‰∏ÄÂàóDeviceÊØîËæÉÂÆπÊòìÁêÜËß£ÔºåÂ∞±ÊòØËØ¥Ëøô‰∏ÄË°åÊèèËø∞ÁöÑÊòØÂì™‰∏Ä‰∏™ËÆæÂ§á„ÄÇ rrqm/s : ÊØèÁßíÂêàÂπ∂ËØªÊìç‰ΩúÁöÑÊ¨°Êï∞ wrqm/s: ÊØèÁßíÂêàÂπ∂ÂÜôÊìç‰ΩúÁöÑÊ¨°Êï∞ r/s Ôºö ÊØèÁßíËØªÊìç‰ΩúÁöÑÊ¨°Êï∞ w/s : ÊØèÁßíÂÜôÊìç‰ΩúÁöÑÊ¨°Êï∞ rMB/s : ÊØèÁßíËØªÂèñÁöÑMBÂ≠óËäÇÊï∞ wMB/s: ÊØèÁßíÂÜôÂÖ•ÁöÑMBÂ≠óËäÇÊï∞ avgrq-szÔºö ÊØè‰∏™IOÁöÑÂπ≥ÂùáÊâáÂå∫Êï∞ÔºåÂç≥ÊâÄÊúâËØ∑Ê±ÇÁöÑÂπ≥ÂùáÂ§ßÂ∞èÔºå‰ª•ÊâáÂå∫Ôºà512Â≠óËäÇÔºâ‰∏∫Âçï‰Ωç avgqu-szÔºö Âπ≥Âùá‰∏∫ÂÆåÊàêÁöÑIOËØ∑Ê±ÇÊï∞ÈáèÔºåÂç≥Âπ≥ÂùáÊÑè‰πâÂ±±ÁöÑËØ∑Ê±ÇÈòüÂàóÈïøÂ∫¶ awaitÔºö Âπ≥ÂùáÊØè‰∏™IOÊâÄÈúÄË¶ÅÁöÑÊó∂Èó¥ÔºåÂåÖÊã¨Âú®ÈòüÂàóÁ≠âÂæÖÁöÑÊó∂Èó¥Ôºå‰πüÂåÖÊã¨Á£ÅÁõòÊéßÂà∂Âô®Â§ÑÁêÜÊú¨Ê¨°ËØ∑Ê±ÇÁöÑÊúâÊïàÊó∂Èó¥„ÄÇ r_waitÔºö ÊØè‰∏™ËØªÊìç‰ΩúÂπ≥ÂùáÊâÄÈúÄË¶ÅÁöÑÊó∂Èó¥Ôºå‰∏ç‰ªÖÂåÖÊã¨Á°¨ÁõòËÆæÂ§áËØªÊìç‰ΩúÁöÑÊó∂Èó¥Ôºå‰πüÂåÖÊã¨Âú®ÂÜÖÊ†∏ÈòüÂàó‰∏≠ÁöÑÊó∂Èó¥„ÄÇ w_wait: ÊØè‰∏™ÂÜôÊìçÂπ≥ÂùáÊâÄÈúÄË¶ÅÁöÑÊó∂Èó¥Ôºå‰∏ç‰ªÖÂåÖÊã¨Á°¨ÁõòËÆæÂ§áÂÜôÊìç‰ΩúÁöÑÊó∂Èó¥Ôºå‰πüÂåÖÊã¨Âú®ÈòüÂàó‰∏≠Á≠âÂæÖÁöÑÊó∂Èó¥„ÄÇ svctmÔºö Ë°®Èù¢ÁúãÊòØÊØè‰∏™IOËØ∑Ê±ÇÁöÑÊúçÂä°Êó∂Èó¥Ôºå‰∏çÂåÖÊã¨Á≠âÂæÖÊó∂Èó¥Ôºå‰ΩÜÊòØÂÆûÈôÖ‰∏äÔºåËøô‰∏™ÊåáÊ†áÂ∑≤ÁªèÂ∫üÂºÉ„ÄÇÂÆûÈôÖ‰∏äÔºåiostatÂ∑•ÂÖ∑Ê≤°Êúâ‰ªª‰Ωï‰∏ÄËæìÂá∫È°πË°®Á§∫ÁöÑÊòØÁ°¨ÁõòËÆæÂ§áÂπ≥ÂùáÊØèÊ¨°IOÁöÑÊó∂Èó¥„ÄÇ %utilÔºö Â∑•‰ΩúÊó∂Èó¥ÊàñËÄÖÁπÅÂøôÊó∂Èó¥Âç†ÊÄªÊó∂Èó¥ÁöÑÁôæÂàÜÊØî avgqu-sz ÂíåÁπÅÂøôÁ®ãÂ∫¶È¶ñÂÖàÊàë‰ª¨Áî®Ë∂ÖÂ∏ÇË¥≠Áâ©Êù•ÊØîÂØπiostatÁöÑËæìÂá∫„ÄÇÊàë‰ª¨Âú®Ë∂ÖÂ∏ÇÁªìË¥¶ÁöÑÊó∂ÂÄôÔºå‰∏ÄËà¨‰ºöÊúâÂæàÂ§öÈòüÂèØ‰ª•ÊéíÔºåÈòüÂàóÁöÑÈïøÂ∫¶ÔºåÂú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÂèçÂ∫î‰∫ÜËØ•Êî∂Èì∂ÊüúÂè∞ÁöÑÁπÅÂøôÁ®ãÂ∫¶„ÄÇÈÇ£‰πàËøô‰∏™ÂèòÈáèÊòØavgqu-szËøô‰∏™ËæìÂá∫ÂèçÂ∫îÁöÑÔºåËØ•ÂÄºË∂äÂ§ßÔºåË°®Á§∫ÊéíÈòüÁ≠âÂæÖÂ§ÑÁêÜÁöÑioË∂äÂ§ö„ÄÇ Êàë‰ª¨Êêû4KÁöÑÈöèÊú∫IOÔºå‰ΩÜÊòØiodepth=1 ÔºåÊü•Áúã‰∏ãfioÁöÑÊåá‰ª§ÂíåiostatÁöÑËæìÂá∫Ôºö1fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=1 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting ÂêåÊ†∑ÊòØ4KÁöÑÈöèÊú∫IOÔºåÊàë‰ª¨ËÆæÁΩÆiodepth=16Ôºå Êü•ÁúãfioÁöÑÊåá‰ª§ÂíåiostatÁöÑËæìÂá∫Ôºö1fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=16 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting Ê≥®ÊÑè sdcÁöÑavgrq-szËøôÂàóÁöÑÂÄºÔºåÂèòÊàê‰∫Ü256ÔºåÂç≥256 ‰∏™ÊâáÂå∫ = 256* 512 Byte = 128KBÔºåÁ≠â‰∫éÊàë‰ª¨fioÊµãËØïÊó∂Ôºå‰∏ãËææÁöÑbs = 128k„ÄÇÊ≥®ÊÑèÔºåËøô‰∏™ÂÄº‰πü‰∏çÊòØ‰∏∫ÊâÄÊ¨≤‰∏∫ÁöÑÔºåÂÆÉÂèóÂÜÖÊ†∏ÂèÇÊï∞ÁöÑÊéßÂà∂Ôºö123root@node1:~# cat /sys/block/sdc/queue/max_sectors_kb 256#Ëøô‰∏™ÂÄº‰∏çÊòØÊúÄÂ§ß‰∏ãÂèëÁöÑIOÊòØ256KBÔºåÂç≥512‰∏™ÊâáÂå∫„ÄÇÂΩìÊàë‰ª¨fioÂØπsdcËøôÂùóÁõòÂÅöÊµãËØïÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúbs=256kÔºåiostatËæìÂá∫‰∏≠ÁöÑavgrq-sz ‰ºöÂèòÊàê 512 ÊâáÂå∫Ôºå‰ΩÜÊòØÔºåÂ¶ÇÊûúÁªßÁª≠Â¢ûÂ§ßbsÔºåÊØîÂ¶Çbs=512kÔºåÈÇ£‰πàiostatËæìÂá∫‰∏≠ÁöÑavgrq-sz‰∏ç‰ºöÁªßÁª≠Â¢ûÂ§ßÔºå‰ªçÁÑ∂ÊòØ512ÔºåË°®Á§∫512ÊâáÂå∫„ÄÇ 1fio --name=randwrite --rw=randwrite --bs=512k --size=20G --runtime=1200 --ioengine=libaio --iodepth=1 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting Ê≥®ÊÑèÔºåÊú¨Êù•512KBÁ≠â‰∫é1024‰∏™ÊâáÂå∫Ôºåavgrq-szÂ∫îËØ•‰∏∫1204Ôºå‰ΩÜÊòØÁî±‰∫éÂÜÖÊ†∏ÁöÑmax_sectors_kbÊéßÂà∂ÂèÇÊï∞ÔºåÂÜ≥ÂÆö‰∫Ü‰∏çÂèØËÉΩÔºöÂè¶Â§ñ‰∏Ä‰∏™ÈúÄË¶ÅÊ≥®ÊÑè‰πü‰∏çÈöæÁêÜËß£ÁöÑÁé∞Ë±°ÊòØÔºåioËØ∑Ê±ÇË∂äÂ§ßÔºåÈúÄË¶ÅÊ∂àËÄóÁöÑÊó∂Èó¥Â∞±‰ºöË∂äÈïø„ÄÇÂØπ‰∫éÂùóËÆæÂ§áËÄåË®ÄÔºåÊó∂Èó¥ÂàÜÊàê2‰∏™ÈÉ®ÂàÜÔºö ÂØªÈÅì ËØªÊàñÂÜôÊìç‰ΩúÊ≥®ÊÑèÊ≠§Â§ÑÁöÑÂØªÈÅì‰∏çËÉΩÁÆÄÂçïÂú∞ÁêÜËß£ÊàêÁ£ÅÁõòÁ£ÅÂ§¥ÊóãËΩ¨Âà∞ÊåáÂÆö‰ΩçÁΩÆÔºåÂõ†‰∏∫ÂêéÂ§áÂùóËÆæÂ§áÂèØËÉΩÊòØRAIDÔºåÂèØËÉΩÊòØSSDÔºåÊàë‰ª¨ÁêÜËß£ÂÜôÂÖ•ÂâçÁöÑÂáÜÂ§áÂä®‰Ωú„ÄÇÂáÜÂ§áÂ∑•‰ΩúÂÆåÊàê‰πãÂêéÔºåÂÜôÂÖ•4KÂíåÂÜôÂÖ•128KBÔºåÊòéÊòæÂÜôÂÖ•128KBÁöÑÂ∑•‰ΩúÈáèË¶ÅÊõ¥Â§ß‰∏Ä‰∫õÔºåÂõ†Ê≠§ÂæàÂÆπÊòìÁêÜËß£ÈöèÊú∫ÂÜôÂÖ•128KBÁªôÂùóËÆæÂ§áÂ∏¶Êù•ÁöÑË¥üËΩΩË¶ÅÊØîÈöèÊú∫ÂÜôÂÖ•4KÁªôÂùóËÆæÂ§áÂ∏¶Êù•ÁöÑË¥üËΩΩË¶ÅÈ´ò‰∏Ä‰∫õ„ÄÇ ÂØπÊØîÁîüÊ¥ª‰∏≠ÁöÑ‰æãÂ≠êÔºåË∂ÖÊó∂ÊéíÈòüÁöÑÊó∂ÂÄôÔºå‰Ω†‰ºöÈ¶ñÂÖàÊü•ÁúãÈòüÂàóÁöÑÈïøÂ∫¶Êù•ËØÑ‰º∞‰∏ãÊó∂Èó¥ÔºåÂ¶ÇÊûúÈòüÂàóÈÉΩÂ∑Æ‰∏çÂ§öÈïøÁöÑÊÉÖÂÜµ‰∏ãÔºå‰Ω†Â∞±Ë¶ÅÂÖ≥ÂøÉÂâçÈù¢È°æÂÆ¢ÁØÆÂ≠êÈáå‰∏úË•øÁöÑÂ§öÂ∞ë‰∫Ü„ÄÇÂ¶ÇÊûúÂâçÈù¢È°æÂÆ¢ÊØè‰∫∫ÊâãÈáåÊãøÁùÄ‰∏Ä‰∏§‰ª∂ÂïÜÂìÅÔºåÂè¶‰∏ÄÈòüÂá†‰πéÊØè‰∏Ä‰∏™‰∫∫ÈÉΩÊé®ËøôÊª°Êª°‰∏ÄËΩ¶Â≠êÁöÑÂïÜÂìÅÔºå‰Ω†ÂèØËÉΩÁü•ÈÅìË¶ÅÊéíÈÇ£‰∏ÄÈòü„ÄÇÂõ†‰∏∫ÂïÜÂìÅË∂äÂ§öÔºåÂ§ÑÁêÜÂçï‰∏™È°æÂÆ¢ÁöÑÊó∂Èó¥Â∞±‰ºöË∂ä‰πÖ„ÄÇIO‰πüÊòØÂ¶ÇÊ≠§„ÄÇ rrqm/s Âíåwrqm/sÂùóËÆæÂ§áÊúâÁõ∏Â∫îÁöÑË∞ÉÂ∫¶ÁÆóÊ≥ï„ÄÇÂ¶ÇÊûú‰∏§‰∏™IOÂèëÁîüÂú®Áõ∏ÈÇªÁöÑÊï∞ÊçÆÂùóÊó∂Ôºå‰ªñ‰ª¨ÂèØ‰ª•ÂêàÂπ∂Êàê1‰∏™IO„ÄÇ Ëøô‰∏™ÁÆÄÂçïÁöÑÂèØ‰ª•ÁêÜËß£‰∏∫Âø´ÈÄíÂëòË¶ÅÁªô‰∏Ä‰∏™18Â±ÇÁöÑÂÖ¨Âè∏ÊâÄÊúâÂëòÂ∑•ÈÄÅÂø´ÈÄíÔºåÊØè‰∏ÄÂ±ÇÈÉΩÊúâ‰∏Ä‰∫õÂåÖË£πÔºåÂØπ‰∫éÂø´ÈÄíÂëòÊù•ËØ¥ÔºåÊúÄÂ•ΩÁöÑÂäûÊ≥ïÊòØÂêå‰∏ÄÊ•ºÂ±ÇÁõ∏ËøëÁöÑ‰ΩçÁΩÆÁöÑÂåÖË£π‰∏ÄËµ∑ÊäïÈÄíÔºåÂê¶ÂàôÂ¶ÇÊûú‰∏çÈááÁî®ËøôÁßçÁÆóÊ≥ïÔºåÈááÁî®ÊúÄÂéüÂßãÁöÑÊù•‰∏Ä‰∏™ÈÄÅ‰∏Ä‰∏™ÔºàÂç≥noopÁÆóÊ≥ïÔºâÔºåÈÇ£‰πàËøô‰∏™Âø´ÈÄíÂëòÔºåÂèØËÉΩÂÖàÈÄÅ‰∫Ü‰∏Ä‰∏™ÂåÖÊã¨Âà∞18Â±ÇÔºåÂèà‰∏çÂæó‰∏çË∑ëÂà∞2Â±ÇÈÄÅÂè¶‰∏Ä‰∏™ÂåÖË£πÔºåÁÑ∂ÂêéÊúâ‰∏çÂæó‰∏çË∑ëÂà∞16Â±ÇÈÄÅÁ¨¨‰∏â‰∏™ÂåÖË£πÔºåÁÑ∂ÂêéÂåÖÂà∞1Â±ÇÈÄÅÁ¨¨‰∏â‰∏™ÂåÖË£πÔºåÈÇ£‰πàÂø´ÈÄíÂëòÁöÑËΩ®ËøπÊòØÊùÇ‰π±Êó†Á´†ÁöÑÔºå‰πüÊòØÈùûÂ∏∏‰ΩéÊïàÁöÑ„ÄÇ LinuxÂ∏∏ËßÅÁöÑË∞ÉÂ∫¶ÁÆóÊ≥ïÊúâ: noop deadline cfq 12root@node:~# cat /sys/block/sdc/queue/scheduler [noop] deadline cfq Á±ªÊØîÊÄªÁªìÊàë‰ª¨ËøòÊòØ‰ª•Ë∂ÖÊó∂Ë¥≠Áâ©‰∏∫‰æãÔºåÊØîÂ¶Ç‰∏ÄÂÆ∂‰∏âÂè£ÂéªË¥≠Áâ©ÔºåÂêÑ‰∫∫‰π∞ÂêÑ‰∫∫ÁöÑ‰∏úË•øÔºåÊúÄÁªà‰ºöÊ±áÊÄªÂà∞Êî∂Èì∂Âè∞Ôºå‰Ω†Âõ∫ÁÑ∂ÂèØ‰ª•ÊØè‰∫∫ÂêÑËá™‰ªòÂêÑËá™ÁöÑÔºå‰ΩÜÊòØ‰πüÂèØ‰ª•Ê±áÊÄª‰∏Ä‰∏ãÔºåÊääÊâÄÊúâË¥≠‰π∞ÁöÑ‰∏úË•øÊîæÂú®‰∏ÄËµ∑ÔºåÁî±‰∏Ä‰∏™‰∫∫Êù•ÂÆåÊàêÔºå‰πüÂ∞±ËØ¥Ôºå‰∏âÊ¨°Êî∂Èì∂‰∫ã‰ª∂mergeÊàê‰∫Ü‰∏ÄÊ¨°„ÄÇ Ëá≥Ê≠§ÔºåÊàë‰ª¨‰ª•Ë∂ÖÊó∂Ë¥≠Áâ©Êî∂Èì∂‰∏∫‰æãÔºå‰ªãÁªç‰∫Üavgqu-sz Á±ªÊØî‰∫éÈòü‰ºçÁöÑÈïøÂ∫¶Ôºåavgrq-sz Á±ªÊØî‰∫éÊØè‰∏™‰∫∫Ë¥≠Áâ©ËΩ¶ÈáåÁâ©ÂìÅÁöÑÂ§öÂ∞ëÔºårrqm/sÂíåwrqm/s Á±ªÊØî‰∫éÂ∞Ü‰∏ÄÂÆ∂Ë¥≠Âæó‰∏úË•øÊ±áÊÄª‰∏ÄËµ∑Ôºå‰ªòË¥π‰∏ÄÊ¨°„ÄÇËøòÊúâsvctmÂíå%util‰∏§‰∏™Ê≤°Êúâ‰ªãÁªç„ÄÇ ÊåâÁÖßÊàë‰ª¨ÁöÑÂâßÊÉÖÔºåÊàë‰ª¨Ëá™ÁÑ∂ËÄåÁÑ∂Âú∞ÂèØ‰ª•Â∞ÜsvctmÁ±ªÊØîÊàêÊî∂Èì∂ÊúçÂä°ÂëòÊúçÂä°ÊØè‰∏™ÂÆ¢Êà∑ÈúÄË¶ÅÁöÑÂπ≥ÂùáÊó∂Èó¥Ôºå%utilÁ±ªÊØîÊàêÊî∂Èì∂ÊúçÂä°ÂëòÂ∑•‰ΩúÁöÑÁπÅÂøôÁ®ãÂ∫¶„ÄÇ Ê≥®ÊÑèËøô‰∏™Á±ªÊØîÊòØÈîôËØØÁöÑÔºåÂ∞±ÊòØÂõ†‰∏∫Á±ª‰ººÁöÑÁ±ªÊØîÔºåÂÆπÊòìËÆ©‰∫∫Èô∑ÂÖ•ËØØÂå∫‰∏çËÉΩËá™Êãî„ÄÇ‰∏çËÉΩÁÆÄÂçïÂú∞Â∞ÜsvctmÁêÜËß£ÊàêÂçï‰∏™IOË¢´ÂùóËÆæÂ§áÂ§ÑÁêÜÁöÑÊúâÊïàÊó∂Èó¥ÔºåÂêåÊó∂‰∏çËÉΩÁêÜËß£Êàê%utilÂà∞‰∫Ü100% ÔºåÁ£ÅÁõòÂ∑•‰ΩúÂ∞±È•±Âíå‰∫ÜÔºå‰∏çËÉΩÁªßÁª≠ÊèêÂçá‰∫ÜÔºåËøôÊòØ‰∏§‰∏™Â∏∏ËßÅÁöÑËØØÂå∫„ÄÇ svctmÂíå%utilÊòØiostatÊúÄÂÆπÊòìÂºïËµ∑ËØØËß£ÁöÑ‰∏§‰∏™ËæìÂá∫„ÄÇ‰∏∫‰∫ÜÂáÜÁ°ÆÂú∞ËØÑ‰º∞ÂùóËÆæÂ§áÁöÑËÉΩÂäõÔºåÊàë‰ª¨Â∏åÊúõÂæóÂà∞ËøôÊ†∑‰∏Ä‰∏™Êï∞ÂÄºÔºöÂç≥‰∏Ä‰∏™io‰ªéÂèëÁªôÂùóËÆæÂ§áÂ±ÇÂà∞ÂÆåÊàêËøô‰∏™ioÁöÑÊó∂Èó¥Ôºå‰∏çÂåÖÊã¨ÂÖ∂‰ªñÂú®ÈòüÂàóÁ≠âÂæÖÁöÑÊó∂Èó¥„ÄÇ‰ªéË°®Èù¢ÁúãÔºåsvctmÂ∞±ÊòØËøô‰∏™ÂÄº„ÄÇÂÆûÈôÖ‰∏äÂπ∂ÈùûÂ¶ÇÊ≠§„ÄÇ Linux‰∏ãiostatËæìÂá∫ÁöÑsvctmÂπ∂‰∏çÂÖ∑Â§áËøôÊñπÈù¢ÁöÑÂê´‰πâÔºåËøô‰∏™ÊåáÊ†áÂ∫îËØ•ÈùûÂ∫üÂºÉ„ÄÇiostatÂíåsarÁöÑman pageÈÉΩÊúâËøôÊñπÈù¢ÁöÑË≠¶ÂëäÔºö12svctmThe average service time (in milliseconds) for I/O requests that were issued to the device. Warning! Do not trust this field any more. This field will be removed in a future sysstat version. ÈÇ£‰πàiostatËæìÂá∫‰∏≠ÁöÑsvctmÂà∞Â∫ïÊòØÊÄé‰πàÊù•ÁöÑÔºå%utilÂèàÊòØÊÄé‰πàÁÆóÂá∫Êù•ÁöÑÔºåËøõËÄåiostatÁöÑËæìÂá∫ÁöÑÂêÑ‰∏™Â≠óÊÆµÈÉΩÊòØ‰ªéÂì™ÈáåÊãøÂà∞ÁöÑ‰ø°ÊÅØÂë¢Ôºü iostatËæìÂá∫ÁöÑÊï∞ÊçÆÊù•Ê∫êdiskstatsiostatÊï∞ÊçÆÁöÑÊù•Ê∫êÊòØ Linux Êìç‰ΩúÁ≥ªÁªüÁöÑ /proc/diskstats Ê≥®ÊÑèÔºåprocfs‰∏≠ÁöÑÂâç‰∏â‰∏™Â≠óÊÆµÔºö‰∏ªËÆæÂ§áÂè∑„ÄÅ‰ªéËÆæÂ§áÂè∑„ÄÅËÆæÂ§áÂêç„ÄÇ‰ªéÁ¨¨Âõõ‰∏™Â≠óÊÆµÂºÄÂßãÔºå‰ªãÁªçÁöÑÊòØËØ•ËÆæÂ§áÁöÑÁõ∏ÂÖ≥ÁªüËÆ°Ôºö (rd_ios) : ËØªÊìç‰ΩúÁöÑÊ¨°Êï∞ (rd_merges):ÂêàÂπ∂ËØªÊìç‰ΩúÁöÑÊ¨°Êï∞„ÄÇÂ¶ÇÊûú‰∏§‰∏™ËØªÊìç‰ΩúËØªÂèñÁõ∏ÈÇªÁöÑÊï∞ÊçÆÂùóÔºåÈÇ£‰πàÂèØ‰ª•Ë¢´ÂêàÂπ∂Êàê1‰∏™„ÄÇ (rd_sectors): ËØªÂèñÁöÑÊâáÂå∫Êï∞Èáè (rd_ticks):ËØªÊìç‰ΩúÊ∂àËÄóÁöÑÊó∂Èó¥Ôºà‰ª•ÊØ´Áßí‰∏∫Âçï‰ΩçÔºâ„ÄÇÊØè‰∏™ËØªÊìç‰Ωú‰ªé__make_request()ÂºÄÂßãËÆ°Êó∂ÔºåÂà∞end_that_request_last()‰∏∫Ê≠¢ÔºåÂåÖÊã¨‰∫ÜÂú®ÈòüÂàó‰∏≠Á≠âÂæÖÁöÑÊó∂Èó¥„ÄÇ (wr_ios):ÂÜôÊìç‰ΩúÁöÑÊ¨°Êï∞ (wr_merges):ÂêàÂπ∂ÂÜôÊìç‰ΩúÁöÑÊ¨°Êï∞ (wr_sectors): ÂÜôÂÖ•ÁöÑÊâáÂå∫Êï∞Èáè (wr_ticks): ÂÜôÊìç‰ΩúÊ∂àËÄóÁöÑÊó∂Èó¥Ôºà‰ª•ÊØ´Áßí‰∏∫Âçï‰ΩçÔºâ (in_flight): ÂΩìÂâçÊú™ÂÆåÊàêÁöÑI/OÊï∞Èáè„ÄÇÂú®I/OËØ∑Ê±ÇËøõÂÖ•ÈòüÂàóÊó∂ËØ•ÂÄºÂä†1ÔºåÂú®I/OÁªìÊùüÊó∂ËØ•ÂÄºÂáè1„ÄÇ Ê≥®ÊÑèÔºöÊòØI/OËØ∑Ê±ÇËøõÂÖ•ÈòüÂàóÊó∂ÔºåËÄå‰∏çÊòØÊèê‰∫§ÁªôÁ°¨ÁõòËÆæÂ§áÊó∂ (io_ticks)ËØ•ËÆæÂ§áÁî®‰∫éÂ§ÑÁêÜI/OÁöÑËá™ÁÑ∂Êó∂Èó¥(wall-clock time) (time_in_queue): ÂØπÂ≠óÊÆµ#10(io_ticks)ÁöÑÂä†ÊùÉÂÄº Ëøô‰∫õÂ≠óÊÆµÂ§ßÂ§öÊù•Ëá™ÂÜÖÊ†∏ÁöÑÂ¶Ç‰∏ãÊï∞ÊçÆÔºö123456789include/linux/genhd.hstruct disk_stats { unsigned long sectors[2]; /* READs and WRITEs */ unsigned long ios[2]; unsigned long merges[2]; unsigned long ticks[2]; unsigned long io_ticks; unsigned long time_in_queue;}; Èô§‰∫Üin_flightÊù•Ëá™Ôºö12345part_in_flight(hd), static inline int part_in_flight(struct hd_struct *part){ return atomic_read(&part->in_flight[0]) + atomic_read(&part->in_flight[1]);} ÂÜÖÊ†∏Áõ∏ÂÖ≥ÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö1234567891011121314151617181920while ((hd = disk_part_iter_next(&piter))) { cpu = part_stat_lock(); part_round_stats(cpu, hd); part_stat_unlock(); seq_printf(seqf, "%4d %7d %s %lu %lu %llu " "%u %lu %lu %llu %u %u %u %u\n", MAJOR(part_devt(hd)), MINOR(part_devt(hd)), disk_name(gp, hd->partno, buf), part_stat_read(hd, ios[READ]), part_stat_read(hd, merges[READ]), (unsigned long long)part_stat_read(hd, sectors[READ]), jiffies_to_msecs(part_stat_read(hd, ticks[READ])), part_stat_read(hd, ios[WRITE]), part_stat_read(hd, merges[WRITE]), (unsigned long long)part_stat_read(hd, sectors[WRITE]), jiffies_to_msecs(part_stat_read(hd, ticks[WRITE])), part_in_flight(hd), jiffies_to_msecs(part_stat_read(hd, io_ticks)), jiffies_to_msecs(part_stat_read(hd, time_in_queue)) ); io_ticks and time_in_queueËøôÈáåÈù¢Â§ßÈÉ®ÂàÜÂ≠óÊÆµÈÉΩÊòØÂæàÂÆπÊòìÁêÜËß£ÁöÑÔºåÁ®çÂæÆÈöæÁêÜËß£ÁöÑÂú®‰∫éio_ticks„ÄÇÂàùÁúã‰πã‰∏ãÔºåÊòéÊòéÂ∑≤ÁªèÊúâ‰∫Ürd_ticksÂíåwr_ticks ‰∏∫‰ªÄ‰πàËøòÈúÄ‰∏Ä‰∏™io_ticks„ÄÇÊ≥®ÊÑèrd_ticksÂíåwr_ticksÊòØÊääÊØè‰∏Ä‰∏™IOÊ∂àËÄóÊó∂Èó¥Á¥ØÂä†Ëµ∑Êù•Ôºå‰ΩÜÊòØÁ°¨ÁõòËÆæÂ§á‰∏ÄËà¨ÂèØ‰ª•Âπ∂Ë°åÂ§ÑÁêÜÂ§ö‰∏™IOÔºåÂõ†Ê≠§Ôºård_ticksÂíåwr_ticks‰πãÂíå‰∏ÄËà¨‰ºöÊØîËá™ÁÑ∂Êó∂Èó¥Ôºàwall-clock timeÔºâË¶ÅÂ§ß„ÄÇËÄåio_ticks ‰∏çÂÖ≥ÂøÉÈòüÂàó‰∏≠ÊúâÂ§öÂ∞ë‰∏™IOÂú®ÊéíÈòüÔºåÂÆÉÂè™ÂÖ≥ÂøÉËÆæÂ§áÊúâIOÁöÑÊó∂Èó¥„ÄÇÂç≥‰∏çËÄÉËôëIOÊúâÂ§öÂ∞ëÔºåÂè™ËÄÉËôëIOÊúâÊ≤°Êúâ„ÄÇÂú®ÂÆûÈôÖËøêÁÆó‰∏≠Ôºåin_flight‰∏çÊòØ0ÁöÑÊó∂ÂÄô‰øùÊåÅËÆ°Êó∂ÔºåËÄåin_flight Á≠â‰∫é0ÁöÑÊó∂ÂÄôÔºåÊó∂Èó¥‰∏çÁ¥ØÂä†Âà∞io_ticks„ÄÇ ‰∏ã‰∏Ä‰∏™ÊØîËæÉÈöæÁêÜËß£ÁöÑÊòØtime_in_queueËøô‰∏™ÂÄºÔºåÂÆÉÁöÑËÆ°ÁÆóÊòØÂΩìÂâçIOÊï∞ÈáèÔºàÂç≥in_flightÁöÑÂÄºÔºâ‰πò‰ª•Ëá™ÁÑ∂Êó∂Èó¥Èó¥Èöî„ÄÇË°®Èù¢ÁúãËØ•ÂèòÈáèÁöÑÂêçÂ≠óÂè´time_in_queueÔºå‰ΩÜÊòØÂÆûÈôÖ‰∏äÔºåÂπ∂‰∏çÂè™ÊòØÂú®ÈòüÂàó‰∏≠Á≠âÂæÖÁöÑÊó∂Èó¥„ÄÇ Êúâ‰∫∫‰∏çÁêÜËß£time_in_queueÔºå‰ΩÜÊòØÊàëÁõ∏‰ø°ËØªËøáÂ∞èÂ≠¶ Âê¨Ëøá‰∏ãÈù¢ËøôÂè•ËØùÁöÑÂ∞èÊúãÂèãÈÉΩ‰ºöÁêÜËß£time_in_queueÔºö Âõ†‰∏∫‰Ω†‰∏äËØæËÆ≤ËØùÔºå ËÆ©ËÄÅÂ∏àÊâπËØÑ‰Ω†5ÂàÜÈíüÔºåÁè≠ÈáåÊúâ50‰∫∫Ôºå50‰∏™‰∫∫‰Ω†Â∞±Êµ™Ë¥π‰∫ÜÂÖ®Áè≠250ÂàÜÈíü„ÄÇ ËøôÊÆµËØùÈùûÂ∏∏ÂΩ¢Ë±°Âú∞‰ªãÁªç‰∫Ütime_in_queueÁöÑËÆ°ÁÆóÊ≥ïÂàôÔºåÂç≥Ëá™ÁÑ∂Êó∂Èó¥Âè™ËøáÂéª‰∫Ü5ÂàÜÈíüÔºå‰ΩÜÊòØÂØπ‰∫éÈòüÂàó‰∏≠ÁöÑÊâÄÊúâÂêåÂ≠¶ÔºåÂì¶‰∏çÔºåÊâÄÊúâIOÊù•ËØ¥ÔºåÈúÄË¶ÅÂä†ÊùÉËÆ°ÁÆóÔºö123456789101112131415161718static void part_round_stats_single(int cpu, struct hd_struct *part, unsigned long now){ if (now == part->stamp) return; /*Â¶ÇÊûúÈòüÂàó‰∏ç‰∏∫Á©∫ÔºåÂ≠òÂú®in_flight io*/ if (part_in_flight(part)) { /*Â∞èÂ≠¶Êï∞Â≠¶ËÄÅÂ∏àÁöÑÁÆóÊ≥ïÔºånow-part->stamp ‰πò‰ª•Áè≠Á∫ß‰∫∫Êï∞ÔºåÂì¶‰∏çÔºåÊòØ‰πò‰ª•ÈòüÂàó‰∏≠Á≠âÂæÖÁöÑioËØ∑Ê±Ç‰∏™Êï∞*/ __part_stat_add(cpu, part, time_in_queue, part_in_flight(part) * (now - part->stamp)); /*Â¶ÇÂÆûÁöÑËÆ∞ÂΩïÔºåÂõ†‰∏∫ÊâπËØÑË∞ÉÁöÆÂ≠¶ÁîüÔºåÊµ™Ë¥π‰∫Ü5ÂàÜÈíü„ÄÇio‰∏çÊòØÁ©∫ÁöÑÊó∂Èó¥Â¢ûÂä†now - part->stamp*/ __part_stat_add(cpu, part, io_ticks, (now - part->stamp)); } part->stamp = now;} Ëøô‰∏™ËÆ°ÁÆóÁöÑÊñπÊ≥ïÂæàÁÆÄÂçïÔºö ÂΩìËØ∑Ê±ÇÈòüÂàó‰∏∫Á©∫ÁöÑÊó∂ÂÄô io_ticks‰∏çÂ¢ûÂä† time_in_queue‰∏çÂ¢ûÂä† part->stamp Êõ¥Êñ∞‰∏∫now ÂΩìËØ∑Ê±ÇÈòüÂàó‰∏çÊòØÁ©∫ÁöÑÊó∂ÂÄô io_ticksÂ¢ûÂä†Ôºå Â¢ûÂä†Èáè‰∏∫ now - part->timestamp time_in_queueÂ¢ûÂä†ÔºåÂ¢ûÂä†Èáè‰∏∫ Âú®ÈòüÂàó‰∏≠IOÁöÑ‰∏™Êï∞‰πò‰ª• (now - part->stamp) part->stamp Êõ¥Êñ∞‰∏∫now Ê≥®ÊÑèË∞ÉÁî®part_round_stats_singleÂáΩÊï∞ÁöÑÊó∂Êú∫Âú®‰∫é Âú®Êñ∞IOËØ∑Ê±ÇÊèíÂÖ•ÈòüÂàóÔºàË¢´mergeÁöÑ‰∏çÁÆóÔºâ ÂÆåÊàê‰∏Ä‰∏™IOËØ∑Ê±Ç Á©∫ËØ¥Â§™ËøáÊäΩË±°Ôºå‰ΩÜÊòØÊàë‰ª¨ËøòÊòØÁªôÂá∫‰∏Ä‰∏™‰æãÂ≠êÊù•‰ªãÁªçio_ticksÂíåtime_in_queueÁöÑËÆ°ÁÆó ID Time Ops in_flight stamp stamp_delta io_ticks time_in_queue 0 100 Êñ∞ËØ∑Ê±ÇÂÖ•ÈòüÂàó 0 0 Êó†ÈúÄËÆ°ÁÆó 0 0 1 100.10 Êñ∞ËØ∑Ê±ÇÂÖ•ÈòüÂàó 1 100 100.10-100 = 0.1 0.1 0.1 2 101.20 ÂÆåÊàê‰∏Ä‰∏™IOËØ∑Ê±Ç 2 100.10 101.20-100.10 = 1.1 1.2 0.1+1.1*2 = 2.3 3 103.60 ÂÆåÊàê‰∏Ä‰∏™IOËØ∑Ê±Ç 1 101.20 103.60-101.20 = 2.4 3.6 2.3+2.4*1=4.7 4 153.60 Êñ∞ËØ∑Ê±ÇÂÖ•ÈòüÂàó 0 103.60 Êó†ÈúÄËÆ°ÁÆó 3.6 4.7 5 153.90 ÂÆåÊàê‰∏Ä‰∏™IOËØ∑Ê±Ç 1 153.60 153.90 - 153.60 = 0.3 3.9 4.7+0.3 * 1= 5 Ê≥®ÊÑè‰∏äÈù¢ÊÄªÊó∂Èó¥ÊòØ53.90Êó∂Èó¥ÂÜÖÔºåÊúâ3.9ÁßíÁöÑËá™ÁÑ∂Êó∂Èó¥ÂÜÖÊòØÊúâIOÁöÑÔºåÂç≥IOÈòüÂàóÁöÑÈùûÁ©∫Êó∂Èó¥‰∏∫3.9Áßí„ÄÇ Ê≥®ÊÑèÔºåio_ticksËøô‰∏™Â≠óÊÆµË¢´iostatÁî®Êù•ËÆ°ÁÆó%utilÔºåËÄåtime_in_queueËøô‰∏™Â≠óÊÆµË¢´iostatÁî®Êù•ËÆ°ÁÆóavgqu-szÔºåÂç≥Âπ≥ÂùáÈòüÂàóÈïøÂ∫¶„ÄÇ ÂÖ∂ÂÆû‰∏çÈöæÁêÜËß£‰∫ÜÔºåÈòüÂàó‰∏≠‰∏ç‰∏∫Á©∫ÁöÑÊó∂ÂÄôÂç†ÊÄªÊó∂Èó¥ÁöÑÊØî‰æãÂç≥‰∏∫ %util /proc/diskstats‰∏≠ÂÖ∂‰ªñÊï∞ÊçÆÈ°πÁöÑÊõ¥Êñ∞Êó¢ÁÑ∂Êàë‰ª¨‰ªãÁªç‰∫Üio_ticksÂíåtime_in_queueÔºåÊàë‰ª¨‰πüÁÆÄÂçï‰ªãÁªç‰∏ãÂÖ∂‰ªñÂ≠óÊÆµÁöÑËé∑Âèñ„ÄÇÂú®ÊØè‰∏™IOÁªìÊùüÂêéÔºåÈÉΩ‰ºöË∞ÉÁî®blk_account_io_doneÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞‰ºöË¥üË¥£Êõ¥Êñ∞rd_ios/wr_ios„ÄÅrd_ticks/wr_ticks ,ÂåÖÊã¨‰ºöÊõ¥Êñ∞in_flight„ÄÇ123456789101112131415161718192021222324252627282930313233343536373839404142void blk_account_io_done(struct request *req){ /* * Account IO completion. flush_rq isn't accounted as a * normal IO on queueing nor completion. Accounting the * containing request is enough. */ if (blk_do_io_stat(req) && !(req->rq_flags & RQF_FLUSH_SEQ)) { unsigned long duration = jiffies - req->start_time; /*‰ªéreqËé∑ÂèñËØ∑Ê±ÇÁ±ªÂûãÔºöR / W*/ const int rw = rq_data_dir(req); struct hd_struct *part; int cpu; cpu = part_stat_lock(); part = req->part; /*Êõ¥Êñ∞ËØªÊàñÂÜôÊ¨°Êï∞ÔºåËá™Âä†*/ part_stat_inc(cpu, part, ios[rw]); /*Â∞ÜioÁöÑÂ≠òÊ¥ªÊó∂Èó¥ÔºåÊõ¥Êñ∞Âà∞rd_ticks or wr_ticks*/ part_stat_add(cpu, part, ticks[rw], duration); /*Êõ¥Êñ∞io_ticksÂíåtime_in_queue*/ part_round_stats(cpu, part); /*ÂØπÂ∫îinfight Âáè 1 */ part_dec_in_flight(part, rw); hd_struct_put(part); part_stat_unlock(); } }``` ##### Ê≥®ÊÑèpart_round_stats‰ºöË∞ÉÁî®‰∏ä‰∏ÄÂ∞èËäÇ‰ªãÁªçÁöÑpart_round_stats_singleÂáΩÊï∞Ôºö```cgovoid part_round_stats(int cpu, struct hd_struct *part){ /*Êó¢Ë¶ÅÊõ¥Êñ∞ÂàÜÂå∫ÁöÑÁªüËÆ°Ôºå‰πüË¶ÅÊõ¥Êñ∞Êï¥‰∏™ÂùóËÆæÂ§áÁöÑÁªüËÆ°*/ unsigned long now = jiffies; if (part->partno) part_round_stats_single(cpu, &part_to_disk(part)->part0, now); part_round_stats_single(cpu, part, now);} ËØªÂÜôÊâáÂå∫ÁöÑ‰∏™Êï∞ÁªüËÆ°ÔºåÊòØÂú®blk_account_io_completionÂáΩÊï∞‰∏≠ÂÆûÁé∞ÁöÑÔºö12345678910111213void blk_account_io_completion(struct request *req, unsigned int bytes) { if (blk_do_io_stat(req)) { const int rw = rq_data_dir(req); struct hd_struct *part; int cpu; cpu = part_stat_lock(); part = req->part; /*Âè≥Áßª9‰ΩçÔºåÁõ∏ÂΩì‰∫éÈô§‰ª•512Â≠óËäÇÔºåÂç≥‰∏Ä‰∏™ÊâáÂå∫ÁöÑÂ≠óËäÇÊï∞*/ part_stat_add(cpu, part, sectors[rw], bytes >> 9); part_stat_unlock(); } } ÂÖ≥‰∫émergeÈÉ®ÂàÜÁöÑÁªüËÆ°ÔºåÂú®blk_account_io_startÂáΩÊï∞‰∏≠ÁªüËÆ°Ôºö123456789101112131415161718192021222324252627282930void blk_account_io_start(struct request *rq, bool new_io){ struct hd_struct *part; int rw = rq_data_dir(rq); int cpu; if (!blk_do_io_stat(rq)) return; cpu = part_stat_lock(); if (!new_io) { /*Ê≥®ÊÑèÔºåmergeÁöÑIOÂ∞±‰∏ç‰ºöÂØºËá¥in_flight++*/ part = rq->part; part_stat_inc(cpu, part, merges[rw]); } else { part = disk_map_sector_rcu(rq->rq_disk, blk_rq_pos(rq)); if (!hd_struct_try_get(part)) { part = &rq->rq_disk->part0; hd_struct_get(part); } /*Êñ∞IOÔºåÊõ¥Êñ∞io_ticks and time_in_queue*/ part_round_stats(cpu, part); /*in_flight Âä†1*/ part_inc_in_flight(part, rw); rq->part = part; } part_stat_unlock();} iostat ËæìÂá∫ÁöÑËÆ°ÁÆóÊ≥®ÊÑèÔºå/proc/diskstats Â∑≤ÁªèÂ∞ÜÊâÄÊúâÁöÑÁ¥†ÊùêÈÉΩÂáÜÂ§áÂ•Ω‰∫ÜÔºåÂØπ‰∫éiostatÁ®ãÂ∫èÊù•ËØ¥ÔºåÂ∞±ÊòØÂ∞ÜÂ§ÑÁêÜËøô‰∫õÊï∞ÊçÆÔºåÁªôÂÆ¢Êà∑Â±ïÁé∞Âá∫Êõ¥ÂèãÂ•ΩÔºåÊõ¥ÊúâÊÑè‰πâÁöÑÊï∞ÂÄº„ÄÇ‰∫ãÂÆû‰∏äÔºåiostatÁöÑÊ∫êÁ†ÅÈùûÂ∏∏ÁöÑÁü≠ÔºåÂÆÉÂ±û‰∫ésysstatËøô‰∏™ÂºÄÊ∫êËΩØ‰ª∂ÔºåÊï¥‰∏™Êñá‰ª∂Â§ßÂ∞è1619Ë°å„ÄÇ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950int read_sysfs_file_stat(int curr, char *filename, char *dev_name){ FILE *fp; struct io_stats sdev; int i; unsigned int ios_pgr, tot_ticks, rq_ticks, wr_ticks; unsigned long rd_ios, rd_merges_or_rd_sec, wr_ios, wr_merges; unsigned long rd_sec_or_wr_ios, wr_sec, rd_ticks_or_wr_sec; /* Try to read given stat file */ if ((fp = fopen(filename, "r")) == NULL) return 0; i = fscanf(fp, "%lu %lu %lu %lu %lu %lu %lu %u %u %u %u", &rd_ios, &rd_merges_or_rd_sec, &rd_sec_or_wr_ios, &rd_ticks_or_wr_sec, &wr_ios, &wr_merges, &wr_sec, &wr_ticks, &ios_pgr, &tot_ticks, &rq_ticks); if (i == 11) { /* Device or partition */ sdev.rd_ios = rd_ios; sdev.rd_merges = rd_merges_or_rd_sec; sdev.rd_sectors = rd_sec_or_wr_ios; sdev.rd_ticks = (unsigned int) rd_ticks_or_wr_sec; sdev.wr_ios = wr_ios; sdev.wr_merges = wr_merges; sdev.wr_sectors = wr_sec; sdev.wr_ticks = wr_ticks; sdev.ios_pgr = ios_pgr; sdev.tot_ticks = tot_ticks; sdev.rq_ticks = rq_ticks; } else if (i == 4) { /* Partition without extended statistics */ sdev.rd_ios = rd_ios; sdev.rd_sectors = rd_merges_or_rd_sec; sdev.wr_ios = rd_sec_or_wr_ios; sdev.wr_sectors = rd_ticks_or_wr_sec; } if ((i == 11) || !DISPLAY_EXTENDED(flags)) { /* * In fact, we _don't_ save stats if it's a partition without * extended stats and yet we want to display ext stats. */ save_stats(dev_name, curr, &sdev, iodev_nr, st_hdr_iodev); } fclose(fp); return 1;} Êï∞ÊçÆÈÉΩÈááÈõÜÂà∞‰∫ÜÔºåÂâ©‰∏ãÂ∞±ÊòØËÆ°ÁÆó‰∫Ü„ÄÇÂÖ∂‰∏≠‰∏ãÈù¢Âá†È°πÁöÑËÆ°ÁÆóÊòØÈùûÂ∏∏ÁÆÄÂçïÁöÑÔºö rrqm/s wrqm/s r/s w/s rMB/s wMB/s ËøôÂá†È°πÁöÑËÆ°ÁÆóÊòØÈùûÂ∏∏ÁÆÄÂçïÁöÑÔºåÂ∞±ÊòØÈááÊ†∑‰∏§Ê¨°ÔºåÂêé‰∏ÄÊ¨°ÁöÑÂÄºÂáèÂéªÂâç‰∏ÄÊ¨°ÁöÑÂÄºÔºåÁÑ∂ÂêéÈô§‰ª•Êó∂Èó¥Èó¥ÈöîÔºåÂæóÂà∞Âπ≥ÂùáÂÄºÂç≥ÂèØ„ÄÇÂõ†‰∏∫Ëøô‰∫õ/proc/diskstats‰∏≠ÂØπÂ∫îÁöÑÂÄºÈÉΩÊòØÁ¥ØÂä†ÁöÑÔºåÂêé‰∏ÄÊ¨°ÂáèÂéªÂâç‰∏ÄÊ¨°ÔºåÂç≥ÂæóÂà∞ÈááÊ†∑Êó∂Èó¥Èó¥ÈöîÂÜÖÁöÑÊñ∞Â¢ûÈáè„ÄÇ‰∏çËµòËø∞„ÄÇ avgrq-szÁöÑËÆ°ÁÆó123456789101112/* rrq/s wrq/s r/s w/s rsec wsec rqsz qusz await r_await w_await svctm %util */ cprintf_f(2, 8, 2, S_VALUE(ioj->rd_merges, ioi->rd_merges, itv), S_VALUE(ioj->wr_merges, ioi->wr_merges, itv)); cprintf_f(2, 7, 2, S_VALUE(ioj->rd_ios, ioi->rd_ios, itv), S_VALUE(ioj->wr_ios, ioi->wr_ios, itv)); cprintf_f(4, 8, 2, S_VALUE(ioj->rd_sectors, ioi->rd_sectors, itv) / fctr, S_VALUE(ioj->wr_sectors, ioi->wr_sectors, itv) / fctr, xds.arqsz, //Ê≠§Â§ÑÊòØavgrq-sz S_VALUE(ioj->rq_ticks, ioi->rq_ticks, itv) / 1000.0);//Ê≠§Â§ÑÊòØavgqu-sz Ê≥®ÊÑèavgrq-szÊù•Ëá™xdsÁöÑargszÂèòÈáèÔºåËØ•ÂèòÈáèÊòØÈÄöËøáËØ•ÂáΩÊï∞ËÆ°ÁÆóÂæóÂà∞ÁöÑÔºö1234567891011121314151617/*Ê≥®ÊÑèsdc‰∏≠ÁöÑcÊåáÁöÑÊòØcurrentÔºåsdp‰∏≠ÁöÑpÊåáÁöÑÊòØprevious*/void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp, unsigned long long itv, struct ext_disk_stats *xds){ double tput = ((double) (sdc->nr_ios - sdp->nr_ios)) * HZ / itv; xds->util = S_VALUE(sdp->tot_ticks, sdc->tot_ticks, itv); xds->svctm = tput ? xds->util / tput : 0.0; xds->await = (sdc->nr_ios - sdp->nr_ios) ? ((sdc->rd_ticks - sdp->rd_ticks) + (sdc->wr_ticks - sdp->wr_ticks)) / ((double) (sdc->nr_ios - sdp->nr_ios)) : 0.0; xds->arqsz = (sdc->nr_ios - sdp->nr_ios) ? ((sdc->rd_sect - sdp->rd_sect) + (sdc->wr_sect - sdp->wr_sect)) / ((double) (sdc->nr_ios - sdp->nr_ios)) : 0.0;} Ê≥®ÊÑènr_iosÊù•Ëá™Â¶Ç‰∏ãËøêÁÆóÔºåÂç≥ËØªIOÂíåÂÜôIOÁöÑÂíå 12sdc.nr_ios = ioi->rd_ios + ioi->wr_ios;sdp.nr_ios = ioj->rd_ios + ioj->wr_ios; ÈÇ£‰πàxds->arqsz ÁöÑËÆ°ÁÆóÂ∞±ÊòØÂ¶Ç‰∏ãÂê´‰πâÔºö1234xds->arqsz = (ËØªÊâáÂå∫ÊÄªÊï∞ + ÂÜôÊâáÂå∫ÊÄªÊï∞)/(ËØªIOÊ¨°Êï∞+ÂÜôIOÊ¨°Êï∞)xds->arqsz = (sdc->nr_ios - sdp->nr_ios) ? ((sdc->rd_sect - sdp->rd_sect) + (sdc->wr_sect - sdp->wr_sect)) / ((double) (sdc->nr_ios - sdp->nr_ios)) : 0.0; Â•ΩÂêß„ÄÇÂèçÊ≠£ÊàëÊòØÈùûÂ∏∏‰∏çÁêÜËß£Ëøô‰ªñÂ¶àÁöÑÂíãÂõû‰∫ãüòÇ„ÄÇavgqu-szÁöÑËÆ°ÁÆóÂπ≥ÂùáÈòüÂàóÈïøÂ∫¶ÁöÑËÆ°ÁÆóÔºåËøô‰∏™ËÆ°ÁÆóÂ∞±Áî®Âà∞‰∫Üdiskstats‰∏≠time_in_queueËøô‰∏™ÂÄº„ÄÇËøô‰∏™ÂÄºÁöÑËÆ°ÁÆóÊù•Ëá™ËøôÂè•ËØùÔºö1S_VALUE(ioj->rq_ticks, ioi->rq_ticks, itv) / 1000.0) ÂÖ∂‰∏≠rq_ticksÂç≥diskstats‰∏≠ÁöÑtime_in_queue„ÄÇ Êàë‰ª¨ËÄÉËôëÂ¶Ç‰∏ãÁöÑÂú∫ÊôØÔºåÂ¶ÇÊûúIOËØ∑Ê±ÇÊúâ‰∏Ä‰∏™burstÔºåÂêå‰∏ÄÊó∂Èó¥Êù•‰∫Ü250‰∏™IOËØ∑Ê±ÇÔºåÂêéÁª≠ÂÜç‰πüÊ≤°ÊúâÊñ∞ÁöÑËØ∑Ê±ÇÂà∞Êù•„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÊØè‰∏™ËØ∑Ê±ÇÂ§ÑÁêÜÊó∂Èó¥ÈÉΩÊòØ4msÔºåÈÇ£‰πàÊâÄÊúâIOÁöÑÂπ≥ÂùáÁ≠âÂæÖÊó∂Èó¥‰∏∫Ôºö1Âπ≥ÂùáÁ≠âÂæÖÊó∂Èó¥ = Âçï‰∏™ËØ∑Ê±ÇÂ§ÑÁêÜÊó∂Èó¥*(1+2+3+4...+(ËØ∑Ê±ÇÊÄªÊï∞-1))/ËØ∑Ê±ÇÊÄªÊï∞ ÂØπ‰∫éÊàë‰ª¨Ëøô‰∏™‰æãÂ≠êËÄåË®ÄÔºåÂπ≥ÂùáÁ≠âÂæÖÊó∂Èó¥ÊòØ4*125 = 500 ms ÈÇ£‰πàÊâÄÊúâIOËä±Ë¥πÁöÑÊÄªÊó∂Èó¥‰∏∫250*500=125000ÊØ´ÁßíÔºåËøô‰∏™Êó∂Èó¥Èô§‰ª•1000ÊØ´ÁßíÔºö1125000/1000 = 125 Âç≥Âπ≥Âùá‰∏ãÊù•ÔºåÈòüÂàóÁöÑÈïøÂ∫¶ÊòØ125 ÔºåËøô‰∏™ÂÄºÂæàÊòéÊòæÊòØÁ¨¶ÂêàÁõ¥ËßÇÁöÑ„ÄÇÊéíÂú®ÈòüÂàóÊúÄÂâçÁ´ØÁöÑIOËÆ§‰∏∫ÔºåÈòüÂàóÁöÑÈïøÂ∫¶ÊòØ0ÔºåÁ¨¨2‰∏™IOËÆ§‰∏∫ÈòüÂàóÁöÑÈïøÂ∫¶ÊòØ1ÔºåÁ¨¨3‰∏™IOËÆ§‰∏∫ÈòüÂàóÁöÑÈïøÂ∫¶ÊòØ2ÔºåÊúÄÂêé‰∏Ä‰∏™ËÆ§‰∏∫ÈòüÂàóÁöÑÈïøÂ∫¶ÊòØ249„ÄÇ Êàë‰ª¨Êç¢‰∏ÄÁßçÊÄùË∑ØÊù•ËÄÉËôëÔºåÂç≥diskstats‰∏≠time_in_queueÁöÑÊÄùË∑Ø„ÄÇ ÂΩìÁ¨¨‰∏Ä‰∏™IOÂÆåÊàêÁöÑÊó∂ÂÄôÔºåÈòüÂàó‰∏≠250‰∏™IOÔºå250‰∏™IOÈÉΩÁ≠â‰∫Ü4msÔºåÂç≥time_in_queue + = (2504) ÔºåÂΩìÁ¨¨‰∫å‰∏™IOÂÆåÊàêÁöÑÊó∂ÂÄôÔºåtime_in_queue += (2494)ÔºåÂΩìÊâÄÊúâIOÈÉΩÂÆåÊàêÁöÑÊó∂ÂÄôÔºåtime_in_queue = 4*(250+249+248‚Ä¶.+1)Ôºå ‚Ä¶ Ê†πÊçÆtime_in_queue/1000,ÊÆäÈÄîÂêåÂΩíÂú∞Ëé∑Âæó‰∫ÜÂπ≥ÂùáÈòüÂàóÈïøÂ∫¶„ÄÇ await„ÄÅr_waitÂèäw_waitÁöÑËÆ°ÁÆó123456789void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp, unsigned long long itv, struct ext_disk_stats *xds){ ... xds->await = (sdc->nr_ios - sdp->nr_ios) ? ((sdc->rd_ticks - sdp->rd_ticks) + (sdc->wr_ticks - sdp->wr_ticks)) / ((double) (sdc->nr_ios - sdp->nr_ios)) : 0.0; ...} Ëøô‰∏™Ê≤°Âï•Â•ΩËØ¥ÁöÑ‰∫ÜÔºö1await = ((ÊâÄÊúâËØªIOÁöÑÊó∂Èó¥)+(ÊâÄÊúâÂÜôIOÁöÑÊó∂Èó¥))/((ËØªËØ∑Ê±ÇÁöÑ‰∏™Êï∞) + (ÂÜôËØ∑Ê±ÇÁöÑ‰∏™Êï∞)) Ê≥®ÊÑè‰∏ÄÁÇπÂ∞±Ë°å‰∫ÜÔºåËøô‰∏™ÊâÄÊúâËØªIOÁöÑÊó∂Èó¥ÂíåÊâÄÊúâÂÜôIOÁöÑÊó∂Èó¥ÔºåÈÉΩÊòØÂåÖÊã¨IOÂú®ÈòüÂàóÁöÑÊó∂Èó¥Âú®ÂÜÖÁöÑ„ÄÇ‰∏çËÉΩ‰∏ÄÂé¢ÊÉÖÊÑøÂú∞ËÆ§‰∏∫ÔºåÊòØÁ£ÅÁõòÊéßÂà∂Âô®Â§ÑÁêÜËØ•IOÁöÑÊó∂Èó¥„ÄÇ Ê≥®ÊÑèÔºåËÉΩ‰∏çËÉΩËØ¥ÔºåawaitÊØîËæÉÈ´òÔºåÊâÄ‰ª•Ê≠¶Êñ≠Âú∞Âà§ÂÆöËøôÂùóÁõòÁöÑËÉΩÂäõÂæàËèúÔºüÁ≠îÊ°àÊòØ‰∏çËÉΩ„ÄÇawaitËøô‰∏™ÂÄº‰∏çËÉΩÂèçÊò†Á°¨ÁõòËÆæÂ§áÁöÑÊÄßËÉΩ„ÄÇawaitÁöÑËøô‰∏™ÂÄº‰∏çËÉΩÂèçÊò†Á°¨ÁõòËÆæÂ§áÁöÑÊÄßËÉΩÔºåawaitËøô‰∏™ÂÄº‰∏çËÉΩÂèçÊò†Á°¨ÁõòËÆæÂ§áÁöÑÊÄßËÉΩÔºåÈáçË¶ÅÁöÑËØùËÆ≤‰∏âÈÅç„ÄÇ Êàë‰ª¨ËÄÉËôë‰∏§ÁßçIOÁöÑÊ®°Âûã 250‰∏™IOËØ∑Ê±ÇÂêåÊó∂ËøõÂÖ•Á≠âÂæÖÈòüÂàó 250‰∏™IOËØ∑Ê±ÇÂêåÊó∂ËøõÂÖ•Á≠âÂæÖÈòüÂàó Á¨¨‰∏ÄÁßçÊÉÖÂÜµawaitÈ´òËææ500msÔºåÁ¨¨‰∫å‰∏™ÊÉÖÂÜµawaitÂè™Êúâ4msÔºå‰ΩÜÊòØÈÉΩÊòØÂêå‰∏ÄÂùóÁõò„ÄÇ ‰ΩÜÊòØÊ≥®ÊÑèawaitÊòØÁõ∏ÂΩìÈáçË¶ÅÁöÑ‰∏Ä‰∏™ÂèÇÊï∞ÔºåÂÆÉË°®Êòé‰∫ÜÁî®Êà∑ÂèëËµ∑ÁöÑIOËØ∑Ê±ÇÁöÑÂπ≥ÂùáÂª∂ËøüÔºö1wait = IO Âπ≥ÂùáÂ§ÑÁêÜÊó∂Èó¥ + IOÂú®ÈòüÂàóÁöÑÂπ≥ÂùáÁ≠âÂæÖÊó∂Èó¥ Âõ†Ê≠§ÔºåËøô‰∏™ÊåáÊ†áÊòØÊØîËæÉÈáçË¶ÅÁöÑ‰∏Ä‰∏™ÊåáÊ†áüò≥„ÄÇ %util ÂíåÁ£ÅÁõòËÆæÂ§áÈ•±ÂíåÂ∫¶Ê≥®ÊÑèÔºå%utilÊòØÊúÄÂÆπÊòìËÆ©‰∫∫‰∫ßÁîüËØØËß£ÁöÑ‰∏Ä‰∏™ÂèÇÊï∞„ÄÇÂæàÂ§öÂàùÂ≠¶ËÄÖÁúãÂà∞%util Á≠â‰∫é100%Â∞±ËØ¥Á°¨ÁõòËÉΩÂäõÂà∞È°∂‰∫ÜÔºåËøôÁßçËØ¥Ê≥ïÊòØÈîôËØØÁöÑüò®„ÄÇ%utilÊï∞ÊçÆÊ∫êËá™diskstats‰∏≠ÁöÑio_ticksÔºåËøô‰∏™ÂÄºÂπ∂‰∏çÂÖ≥ÂøÉÁ≠âÂæÖÂú®ÈòüÈáåÈáåÈù¢IOÁöÑ‰∏™Êï∞ÔºåÂÆÉÂè™ÂÖ≥ÂøÉÈòüÂàó‰∏≠ÊúâÊ≤°ÊúâIO„ÄÇ ÂíåË∂ÖÊó∂ÊéíÈòüÁªìË¥¶Ëøô‰∏™Á±ªÊØîÊúÄÊú¨Ë¥®ÁöÑÂå∫Âà´Âú®‰∫éÔºåÁé∞‰ª£Á°¨ÁõòÈÉΩÊúâÂπ∂Ë°åÂ§ÑÁêÜÂ§ö‰∏™IOÁöÑËÉΩÂäõÔºå‰ΩÜÊòØÊî∂Èì∂ÂëòÊ≤°Êúâ„ÄÇÊî∂Èì∂ÂëòÊó†Ê≥ïÂÅöÂà∞ÂêåÊó∂Â§ÑÁêÜ10‰∏™È°æÂÆ¢ÁöÑÁªìË¥¶‰ªªÂä°ËÄåÊ∂àËÄóÁöÑÊÄªÊó∂Èó¥‰∏éÂ§ÑÁêÜ‰∏Ä‰∏™È°æÂÆ¢ÁªìË¥¶‰ªªÂä°Áõ∏Â∑ÆÊó†Âá†„ÄÇ‰ΩÜÊòØÁ£ÅÁõòÂèØ‰ª•„ÄÇÊâÄ‰ª•ÔºåÂç≥‰Ωø%utilÂà∞‰∫Ü100%Ôºå‰πüÂπ∂‰∏çÊÑèÂë≥ÁùÄËÆæÂ§áÈ•±Âíå‰∫Ü„ÄÇ ÊúÄÁÆÄÂçïÁöÑ‰æãÂ≠êÊòØÔºåÊüêÁ°¨ÁõòÂ§ÑÁêÜÂçï‰∏™IOËØ∑Ê±ÇÈúÄË¶Å0.1ÁßíÔºåÊúâËÉΩÂäõÂêåÊó∂Â§ÑÁêÜ10‰∏™„ÄÇ‰ΩÜÊòØÂΩì10‰∏™ËØ∑Ê±Ç‰æùÊ¨°Êèê‰∫§ÁöÑÊó∂ÂÄôÔºåÈúÄË¶Å1ÁßíÈíüÊâçËÉΩÂÆåÊàêËøô10%ÁöÑËØ∑Ê±ÇÔºåÔºåÂú®1ÁßíÁöÑÈááÊ†∑Âë®ÊúüÈáåÔºå%utilËææÂà∞‰∫Ü100%„ÄÇ‰ΩÜÊòØÂ¶ÇÊûú10‰∏™ËØ∑‰∏ÄÊ¨°ÊÄßÊèê‰∫§ÁöÑËØùÔºå Á°¨ÁõòÂèØ‰ª•Âú®0.1ÁßíÂÜÖÂÖ®ÈÉ®ÂÆåÊàêÔºåËøôÊó∂ÂÄôÔºå%utilÂè™Êúâ10%„ÄÇ Âõ†Ê≠§ÔºåÂú®‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠Ôºå‰∏ÄÁßí‰∏≠10‰∏™IOÔºåÂç≥IOPS=10ÁöÑÊó∂ÂÄôÔºå%utilÂ∞±ËææÂà∞‰∫Ü100%ÔºåËøôÂπ∂‰∏çËÉΩË°®ÊòéÔºåËØ•ÁõòÁöÑIOPSÂ∞±Âè™ËÉΩÂà∞10Ôºå‰∫ãÂÆû‰∏äÔºåÁ∫µ‰Ωø%utilÂà∞‰∫Ü100%ÔºåÁ°¨ÁõòÂèØËÉΩ‰ªçÁÑ∂ÊúâÂæàÂ§ßÁöÑ‰ΩôÂäõÂ§ÑÁêÜÊõ¥Â§öÁöÑËØ∑Ê±ÇÔºåÂç≥Âπ∂Êú™ËææÂà∞È•±ÂíåÁöÑÁä∂ÊÄÅ„ÄÇ ‰∏ã‰∏ÄÂ∞èËäÇÊúâ4Âº†ÂõæÔºåÂèØ‰ª•ÁúãÂà∞ÂΩìIOPS‰∏∫1000ÁöÑÊó∂ÂÄô%util‰∏∫100%Ôºå‰ΩÜÊòØÂπ∂‰∏çÊÑèÂë≥ÁùÄËØ•ÁõòÁöÑIOPSÂ∞±Âú®1000ÔºåÂÆûÈôÖ‰∏ä2000Ôºå3000,5000ÁöÑIOPSÈÉΩÂèØ‰ª•ËææÂà∞„ÄÇÊ†πÊçÆ%util 100%Êó∂ÁöÑ r/s Êàñw/s Êù•Êé®ÁÆóÁ£ÅÁõòÁöÑIOPSÊòØ‰∏çÂØπÁöÑ„ÄÇ ÈÇ£‰πàÊúâÊ≤°Êúâ‰∏Ä‰∏™ÊåáÊ†áÁî®Êù•Ë°°ÈáèÁ°¨ÁõòËÆæÂ§áÁöÑÈ•±ÂíåÁ®ãÂ∫¶Âë¢„ÄÇÂæàÈÅóÊÜæÔºåiostatÊ≤°Êúâ‰∏Ä‰∏™ÊåáÊ†áÂèØ‰ª•Ë°°ÈáèÁ£ÅÁõòËÆæÂ§áÁöÑÈ•±ÂíåÂ∫¶„ÄÇ svctmÁöÑËÆ°ÁÆóÂØπ‰∫éiostatËøô‰∏™ÂäüËÉΩËÄåË®ÄÔºå%utilÂõ∫ÁÑ∂‰ºöÁªô‰∫∫Â∏¶Êù•‰∏ÄÂÆöÁöÑËØØËß£ÂíåËã¶Êâ∞Ôºå‰ΩÜÊòØsvctmÁªô‰∫∫Â∏¶Êù•ÁöÑËØØËß£Êõ¥Â§ö„ÄÇ‰∏ÄÁõ¥‰ª•Êù•Ôºå‰∫∫‰ª¨Â∏åÊúõ‰∫ÜËß£ÂùóËÆæÂ§áÂ§ÑÁêÜÂçï‰∏™IOÁöÑservice timeÔºåËøô‰∏™ÊåáÊ†áÁõ¥Êé•Âú∞ÂèçÂ∫î‰∫ÜÁ°¨ÁõòÁöÑËÉΩÂäõ„ÄÇ ÂõûÂà∞Ë∂ÖÂ∏ÇÊî∂Èì∂Ëøô‰∏™Á±ªÊØî‰∏≠ÔºåÂ¶ÇÊûúÊî∂Èì∂ÂëòÊòØ‰∏™ËÄÅÊâãÔºåÊìç‰ΩúÊµÅÔºåÊïàÁéáÂæàÈ´òÔºåÈÇ£‰πàÂ§ßÂÆ∂ËÇØÂÆöÊõ¥ÊÑøÊÑèÊéíËøô‰∏ÄÈòü„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÊî∂Èì∂ÂëòÊòØ‰∏™Êñ∞ÊâãÔºåÂêÑÁßçÊìç‰Ωú‰∏çÁÜüÊÇâÔºåÂä®‰ΩúÊÖ¢ÔºåÊïàÁéáÂæà‰ΩéÔºåÈÇ£‰πàÂêåÊ†∑Â§öÁöÑ‰ªªÂä°ÔºåÂ∞±‰ºöËä±Ë¥πÊõ¥ÈïøÁöÑÊó∂Èó¥„ÄÇÂõ†Ê≠§IOÁöÑÂπ≥Âùáservice timeÔºà‰∏çÂåÖÊã¨ÊéíÈòüÊó∂Èó¥ÔºâÊòØÈùûÂ∏∏ÊúâÊÑè‰πâÁöÑ„ÄÇ ‰ΩÜÊòØservice timeÂíåiostatÊó†ÂÖ≥ÔºåiostatÊ≤°Êúâ‰ªª‰Ωï‰∏Ä‰∏™ÂèÇÊï∞ËÉΩÂ§üÊèê‰æõËøôÊñπÈù¢ÁöÑ‰ø°ÊÅØ„ÄÇËÄåsvctmËøô‰∏™ËæìÂá∫Áªô‰∫Ü‰∫∫‰ª¨ËøôÁßçÁæéÂ•ΩÁöÑÊúüÂæÖÔºåÂç¥Âè™ËÉΩËÆ©‰∫∫Á©∫Ê¨¢Âñú„ÄÇ ‰ªéÁé∞Âú®Ëµ∑ÔºåÊàë‰ª¨ËÆ∞‰ΩèÔºåÊàë‰ª¨‰∏çËÉΩ‰ªésvctm‰∏≠ÂæóÂà∞Ëá™Â∑±ÊúüÂæÖÁöÑservice timeËøô‰∏™ÂÄºÔºåËøô‰∏™ÂÄºÂÖ∂ÂÆûÂπ∂Ê≤°Êúâ‰ªÄ‰πàÊÑè‰πâÔºå‰∫ãÂÆû‰∏äÔºåËøô‰∏™ÂÄº‰∏çÊòØÁã¨Á´ãÁöÑÔºåÂÆÉÊòØÊ†πÊçÆÂÖ∂‰ªñÂÄºËÆ°ÁÆóÂá∫Êù•ÁöÑ„ÄÇ12345678910void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp, unsigned long long itv, struct ext_disk_stats *xds) { double tput = ((double) (sdc->nr_ios - sdp->nr_ios)) * HZ / itv; xds->util = S_VALUE(sdp->tot_ticks, sdc->tot_ticks, itv); xds->svctm = tput ? xds->util / tput : 0.0; ...} Â¶ÇÊûú‰∏Ä‰∏™ÁõòÁöÑËÉΩÂäõÂæàÂº∫ÊÇçÔºåÈöèÊú∫Â∞èIOÔºà4KÔºâfioÊµãËØï‰∏≠Êàë‰ª¨‰ºöÁúãÂà∞Â¶Ç‰∏ãÁé∞Ë±°ÔºöÂΩìIOPS‰∏∫1000ÁöÑÊó∂ÂÄôÔºåiostaËæìÂá∫ÁöÑsvctm‰∏∫1(ms)ÔºåÂΩìIOPS‰∏∫2000ÁöÑÊó∂ÂÄôÔºåiostatËæìÂá∫ÁöÑsvctm‰∏∫0.5(ms),ÂΩìIOPS‰∏∫3000ÁöÑÊó∂ÂÄôÔºåiostatËæìÂá∫ÁöÑsvctm‰∏∫0.33„ÄÇÂéüÂõ†ÂÖ∂ÂÆûÊó†‰ªñÔºåÂõ†‰∏∫ËøôÁßçÊÉÖÂÜµ‰∏ã%utilÈÉΩÊòØ100%ÔºåÂç≥ÂΩìÈááÊ†∑Âë®ÊúüÊòØ1ÁßíÁöÑÊó∂ÂÄôÔºåÁî®Êª°‰∫Ü1ÁßíÔºåtputÂ∞±ÊòØfioÊåáÂÆöÁöÑ‚Äìrate-iops Âç≥1000„ÄÅ2000„ÄÅ3000ÔºåÂõ†Ê≠§ÁÆóÂá∫Êù•svctm‰∏∫ÂØπÂ∫îÁöÑ1„ÄÅ0.5„ÄÅ0.33„ÄÇ Ê≥®ÊÑè‰∏äÈù¢ÁöÑÁõòsdgÊòØiSCSIÔºåÂ≠òÂÇ®Á©∫Èó¥ÊòØÁî±ÂàÜÂ∏ÉÂºèÂ≠òÂÇ®Êèê‰æõÔºå‰∏çË¶ÅÈóÆÊàë‰∏∫‰ªÄ‰πàÂçï‰∏™ÁõòÈöèÊú∫IOPSËÉΩÊó†ÂéãÂäõÁöÑÂà∞5000Ôºâ Âõ†Ê≠§‰ªéËøô‰∏™‰æãÂ≠êÁúãÔºåÊääiostatÁöÑËæìÂá∫‰∏≠ÁöÑsvctmÁúã‰ΩúÊòØIOÁöÑÂ§ÑÁêÜÊó∂Èó¥ÊòØÁõ∏ÂΩì‰∏çÈù†Ë∞±ÁöÑ„ÄÇ‰∏∫‰∫ÜÈò≤Ê≠¢Â∏¶Êù•ÁöÑËØØËß£ÔºåÂèØ‰ª•Áõ¥Êé•ÂøΩÁï•Ëøô‰∏™ÂèÇÊï∞„ÄÇ Êó¢ÁÑ∂svctm‰∏çËÉΩÂèçÊò†IOÂ§ÑÁêÜÊó∂Èó¥ÔºåÈÇ£‰πàÊúâÊ≤°Êúâ‰∏Ä‰∏™ÂèÇÊï∞ÂèØ‰ª•ÊµãÈáèÂùóËÆæÂ§áÁöÑIOÂπ≥ÂùáÂ§ÑÁêÜÊó∂Èó¥Âë¢ÔºüÂæàÈÅóÊÜæiostatÊòØÂÅö‰∏çÂà∞ÁöÑ„ÄÇ‰ΩÜÊòØÂè™Ë¶ÅÊÄùÊÉ≥‰∏çÊªëÂù°ÔºåÂäûÊ≥ïÊÄªÊØîÂõ∞ÈöæÂ§öÔºåblktraceËøô‰∏™Á•ûÂô®ÂèØËÉΩÂæóÂà∞Ëøô‰∏™ËÆæÂ§áÁöÑIOÂπ≥ÂùáÂ§ÑÁêÜÊó∂Èó¥„ÄÇ Êé•‰∏ãÊù•Êàë‰ª¨Â∞±ÂèØ‰ª•ËøõÂÖ•Âè¶‰∏Ä‰∏™Â§©Âú∞üòá„ÄÇ Â∞æÂ£∞iostatËÉΩÂ§üÊèê‰æõÁªôÊàë‰ª¨ÁöÑ‰ø°ÊÅØÂ∞±Ëøô‰πàÂ§ö‰∫ÜÔºåÈÄöËøáÂàÜÊûêÊàë‰ª¨ÊúüÂæÖËÉΩÂ§üÂæóÂà∞ÂùóËÆæÂ§áÂ§ÑÁêÜIOÁöÑÊó∂Èó¥ÔºåËøôÂ∞±Ë¶ÅÈù†blocktraceËøô‰∏™Â∑•ÂÖ∑‰∫Ü„ÄÇblktraceÂèØ‰ª•ËÆ≤IOË∑ØÂæÑÂàÜÊÆµÔºåÂàÜÂà´ÁªüËÆ°ÂêÑÊÆµÁöÑÊ∂àËÄóÁöÑÊó∂Èó¥„ÄÇ Êú¨ÊñáÂ§ßÈáèÂèÇËÄÉvmunixÁöÑÂÆπÊòìË¢´ËØØËØªÁöÑIOSTATÔºå‰ª•ÂèäÊ∑±ÂÖ•ÂàÜÊûêdiskstatsÔºåÂÖ∂‰∏≠Á¨¨‰∫åÁØáÊñáÁ´†ÁªôÂá∫‰∫Ü‰∏Ä‰∏™ÂæàËØ¶ÁªÜÁöÑIO PATHÁöÑÊµÅÁ®ãÂõæÔºåÈùûÂ∏∏ÊúâÁî®„ÄÇÁ¨¨‰∫åÁØáÊñáÁ´†‰∏≠ÈöèÁùÄ‰ª£Á†ÅÊºîËøõÊúâ‰∏Ä‰∫õÂèòÂåñÔºåÊú¨ÊñáÈááÁî®ÁöÑÊØîËæÉÊñ∞ÁöÑLinux Kernel codeÂÅö‰ªãÁªçÔºåÂêåÊó∂ÊºîÁÆóio_ticksÂíåtime_in_queueÈÉ®ÂàÜÁ¨¨‰∫åÁØáÊñáÁ´†‰πüÊúâÈîôËØØÔºå‰πü‰∏ÄÂπ∂‰øÆÊ≠£‰∫Ü„ÄÇ‰∏çËøáÁëï‰∏çÊé©ÁëúÔºåËøô‰∏§ÁØáÈÉΩÊòØÈùûÂ∏∏Ê£íÁöÑÊñáÁ´†„ÄÇÂêëÂâçËæàËá¥Êï¨„ÄÇ Êú¨ÊñáÊù•Ëá™‰∫éBean Li document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gdisk_Â∏∏Áî®Êìç‰Ωú]]></title>
    <url>%2F2019%2F03%2F11%2Fgdisk-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[ÂâçË®Ä‰º†ÁªüÁöÑËÄÅÁâåÁöÑÂàÜÂå∫Â∑•ÂÖ∑ÊòØfdiskÔºå‰ΩÜÊòØfdiskÂá∫ÈÅìÂ§™Êó©ÔºåÂè™ÊîØÊåÅMBRÔºàMaster Boot RecordÔºâÔºåÂπ∂‰∏çÊîØÊåÅGPTÔºàGUID Partition TableÔºâÔºåÊó†Ê≥ïÊìç‰ΩúË∂ÖËøá2TÁöÑÁ£ÅÁõòÔºåÂõ†Ê≠§gdisk partedÁ≠âÂàÜÂå∫Â∑•ÂÖ∑Ê®™Á©∫Âá∫‰∏ñ„ÄÇgdiskÂíåpartedÈÉΩÊõæÁªèÁî®ËøáÔºå‰ΩÜÊòØÊàëÊõ¥ÂñúÊ¨¢gdiskÔºåÂõ†‰∏∫‰ΩøÁî®‰∏äÔºågdisk ‰∏äÊâøfdiskÔºåÊ≤°ÊúâÂ§™Â§öÁöÑÂ≠¶‰π†Ë¥üÊãÖ„ÄÇÂè¶Â§ñÊàë‰ª¨QAÊµãÂá∫ËøáÔºåpartedÊñπÂºèÂàÜÂå∫ÔºåÂú®Êüê‰∫õ‰ΩøÁî®‰∏ä‰ºöÊúâÈóÆÈ¢ò„ÄÇ‰ΩøÁî®ÊñπÊ≥ïÈ¶ñÂÖàÔºåÊàëÊúâ‰∏Ä‰∏™sddÔºå‰Ωú‰∏∫ÊàëÊìç‰ΩúÁöÑÂØπË±°„ÄÇ1234567891011121314151617root@test:~# lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTfd0 2:0 1 4K 0 disk sda 8:0 0 40G 0 disk ‚îú‚îÄsda1 8:1 0 30.5M 0 part ‚îú‚îÄsda2 8:2 0 488.3M 0 part ‚îú‚îÄsda3 8:3 0 31.1G 0 part /‚îú‚îÄsda4 8:4 0 8G 0 part [SWAP]‚îî‚îÄsda5 8:5 0 387.8M 0 part sdb 8:16 0 50G 0 disk ‚îú‚îÄsdb1 8:17 0 4G 0 part ‚îî‚îÄsdb2 8:18 0 46G 0 part /data/osd.4sdc 8:32 0 50G 0 disk ‚îú‚îÄsdc1 8:33 0 4G 0 part ‚îî‚îÄsdc2 8:34 0 46G 0 part /data/osd.5sdd 8:48 0 500G 0 disk sr0 11:0 1 1.6G 0 rom Êü•Áúãhelp‰ø°ÊÅØËøõÂÖ•‰∫§‰∫íÊ®°Âºè‰πãÂêéÔºåËæìÂÖ•hÂèØ‰ª•Êü•ÁúãÂ∏ÆÂä©‰ø°ÊÅØ123456789101112131415161718192021222324252627282930root@test:~# gdisk /dev/sddGPT fdisk (gdisk) version 0.8.1Partition table scan: MBR: protective BSD: not present APM: not present GPT: presentFound valid GPT with protective MBR; using GPT.Command (? for help): h b back up GPT data to a filec change a partition's named delete a partitioni show detailed information on a partitionl list known partition typesn add a new partitiono create a new empty GUID partition table (GPT)p print the partition tableq quit without saving changesr recovery and transformation options (experts only)s sort partitionst change a partition's type codev verify diskw write table to disk and exitx extra functionality (experts only)? print this menuCommand (? for help): Êü•ÁúãÂàÜÂå∫Ë°®‰ø°ÊÅØÂæàÊòéÊòæÔºåÂÅöÂá∫Ê≤°ÊúâÂàÜÂå∫ÔºåÊâÄ‰ª•ÂàÜÂå∫Ë°®‰∏∫Á©∫,ÂêéÈù¢ÂàõÂª∫ÂàÜÂå∫‰πãÂêéÔºåÂèØ‰ª•ÈÄöËøápÂëΩ‰ª§Êü•ÁúãÂàÜÂå∫‰ø°ÊÅØ123456789101112Command (? for help): pDisk /dev/sdd: 1048576000 sectors, 500.0 GiBLogical sector size: 512 bytesDisk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F306F33Partition table holds up to 128 entriesFirst usable sector is 34, last usable sector is 104857566Partitions will be aligned on 2048-sector boundariesTotal free space is 1048575330 sectors (500.0 GiB)Number Start (sector) End (sector) Size Code NameCommand (? for help): ÂàõÂª∫ÂàÜÂå∫ÊâìÁÆóÂ∞Ü500GÁöÑÁ©∫Èó¥ÂàíÂàÜÊàê2‰∏™ÂàÜÂå∫ÔºåÂàÜÂà´ÊòØ100GÂíå400GÔºö ÂàõÂª∫ÂàÜÂå∫ÊòØÁî®ÂëΩ‰ª§nÔºå‰Ω†ÈúÄË¶ÅÈÄâÊã©1.ÂàÜÂå∫number2.Ëµ∑ÂßãÊâáÂå∫3.ÁªìÊùüÊâáÂå∫ Ëµ∑ÂßãÊâáÂå∫ÂèØ‰ª•Êï≤ÂõûËΩ¶ÈÄâÊã©ÈªòËÆ§ÂÄºÔºåËÄåÁªìÊùüÊâáÂå∫Áî®Ôºã100GËøôÁßçÊñπÂºèÊù•ÂÜ≥ÂÆöÂàÜÂå∫Â§ßÂ∞è‰∏∫100G ÂàÜÂå∫ÂêéÔºåÂèØ‰ª•Áî®pÂëΩ‰ª§Êü•ÁúãÊúÄÊñ∞ÁöÑÂàÜÂå∫Ë°®123456789101112131415161718192021222324252627282930313233343536373839404142434445Command (? for help): n Partition number (1-128, default 1): 1First sector (34-1048575660, default = 34) or {+-}size{KMGTP}: Information: Moved requested sector from 34 to 2048 inorder to align on 2048-sector boundaries.Use 'l' on the experts' menu to adjust alignmentLast sector (2048-1048575660, default = 1048575660) or {+-}size{KMGTP}: +100GCurrent type is 'Linux filesystem'Hex code or GUID (L to show codes, Enter = 8300): Changed type of partition to 'Linux filesystem'Command (? for help): pDisk /dev/sdd: 1048576000 sectors, 500.0 GiBLogical sector size: 512 bytesDisk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33Partition table holds up to 128 entriesFirst usable sector is 34, last usable sector is 104857566Partitions will be aligned on 2048-sector boundariesTotal free space is 83886013 sectors (40.0 GiB)Number Start (sector) End (sector) Size Code Name 1 2048 20973567 100.0 GiB 8300 Linux filesystemCommand (? for help): nPartition number (2-128, default 2): 2First sector (34-104857566, default = 20973568) or {+-}size{KMGTP}: Last sector (20973568-104857566, default = 104857566) or {+-}size{KMGTP}: Current type is 'Linux filesystem'Hex code or GUID (L to show codes, Enter = 8300): Changed type of partition to 'Linux filesystem'Command (? for help): pDisk /dev/sdd: 1048576000 sectors, 500.0 GiBLogical sector size: 512 bytesDisk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33Partition table holds up to 128 entriesFirst usable sector is 34, last usable sector is 1048575660Partitions will be aligned on 2048-sector boundariesTotal free space is 2014 sectors (1007.0 KiB)Number Start (sector) End (sector) Size Code Name 1 2048 209735677 100.0 GiB 8300 Linux filesystem 2 209735678 1048575660 400.0 GiB 8300 Linux filesystemCommand (? for help): ËÆæÁΩÆÂàÜÂå∫Ê†áÁ≠æ‰ø°ÊÅØpartlabelÊúâ‰∫õÊó∂ÂÄôÔºåÁ£ÅÁõòÁöÑÁõòÁ¨¶‰ºöÊºÇÁßªÔºå‰ΩøÁî®sdxËøôÁßçÊñπÂºèÊù•ÂàÜËæ®Á£ÅÁõòÊòØ‰∏çÈù†Ë∞±Ôºå‰ΩøÁî®lableËøôÁßçÊñπÂºèÊòØÂèØÈù†ÁöÑ„ÄÇÈÇ£‰πàÂ¶Ç‰ΩïÂàõÂª∫ÂàÜÂå∫Ê†áÁ≠æÂë¢Ôºüc ÊòØÁî®Êù•ËÆæÁΩÆpartlableÁöÑ1234567891011121314151617181920Command (? for help): c Partition number (1-2): 1Enter name: test1Command (? for help): cPartition number (1-2): 2Enter name: test2Command (? for help): pDisk /dev/sdd: 1048576000 sectors, 500.0 GiBLogical sector size: 512 bytesDisk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33Partition table holds up to 128 entriesFirst usable sector is 34, last usable sector is 1048575660Partitions will be aligned on 2048-sector boundariesTotal free space is 2014 sectors (1007.0 KiB)Number Start (sector) End (sector) Size Code Name 1 2048 209735677 100.0 GiB 8300 bean_part1 2 209735678 1048575660 400.0 GiB 8300 bean_part2 ‰øùÂ≠òÂàÜÂå∫‰ø°ÊÅØÊàë‰ª¨Â∞ÜÁ£ÅÁõòÂàÜÊàê‰∫Ü2‰∏™Âå∫ÔºåÁªôÊØè‰∏Ä‰∏™ÂàÜÂå∫Ë¥¥‰∏ä‰∫ÜpartlabelÔºå‰ΩÜÊòØÈÄÄÂá∫gdisk‰πãÂâçÂøÖÈ°ª‰øùÂ≠òÔºåÂê¶ÂàôÂâçÂäüÂ∞ΩÂºÉ„ÄÇ123456789Command (? for help): wFinal checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTINGPARTITIONS!!Do you want to proceed? (Y/N): yOK; writing new GUID partition table (GPT).The operation has completed successfully.root@test:~# ÊïàÊûúÊÑâÂø´Âú∞Êü•ÁúãÂàÜÂå∫ÊïàÊûúÂêßÔºö1234567891011121314151617181920212223242526root@test:~# lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTfd0 2:0 1 4K 0 disk sda 8:0 0 40G 0 disk ‚îú‚îÄsda1 8:1 0 30.5M 0 part ‚îú‚îÄsda2 8:2 0 488.3M 0 part ‚îú‚îÄsda3 8:3 0 31.1G 0 part /‚îú‚îÄsda4 8:4 0 8G 0 part [SWAP]‚îî‚îÄsda5 8:5 0 387.8M 0 part sdb 8:16 0 50G 0 disk ‚îú‚îÄsdb1 8:17 0 4G 0 part ‚îî‚îÄsdb2 8:18 0 46G 0 part /data/osd.4sdc 8:32 0 50G 0 disk ‚îú‚îÄsdc1 8:33 0 4G 0 part ‚îî‚îÄsdc2 8:34 0 46G 0 part /data/osd.5sdd 8:48 0 500G 0 disk ‚îú‚îÄsdd1 8:49 0 100G 0 part ‚îî‚îÄsdd2 8:50 0 400G 0 part sr0 11:0 1 1.6G 0 rom root@test:~# ll /dev/disk/by-partlabel/total 0drwxr-xr-x 2 root root 180 Apr 1 22:23 ./drwxr-xr-x 9 root root 180 Apr 1 21:34 ../lrwxrwxrwx 1 root root 10 Apr 1 22:23 test1 -> ../../sdd1lrwxrwxrwx 1 root root 10 Apr 1 22:23 test2 -> ../../sdd2... document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Â≠òÂÇ®ÁöÑÊÄßËÉΩ]]></title>
    <url>%2F2019%2F03%2F11%2F%E5%AD%98%E5%82%A8%E7%9A%84%E6%80%A7%E8%83%BD%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄÊØîÂ¶ÇÊàëÊÉ≥ÊµãËØï400Ë∑ØÂπ∂ÂèëÂÜô10GÁöÑÂ§ßÊñá‰ª∂Ôºå‰∏ÄÂÖ±ÂÜôÂÖ•2000‰∏™Êñá‰ª∂1seq 1 2000 |xargs -P 400 -I {} dd if=/dev/zero of=file_{} bs=1M count=10240 oflag=direct Ê≥®:xargs ÂèÇÊï∞‰∏≠ -P ÈÄâÈ°πÁõ∏ÂΩìÈÄÜÂ§©Ôºå‰øùÊåÅ400Ë∑ØÂπ∂Âèë„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÈúÄË¶ÅÂ§öÂè∞ÊµãËØïÊú∫ÔºåÊØîÂ¶ÇÂ§öÂè∞clientÊú∫ÈÄöËøáNFSÊµãËØïÂÜôÂÖ•ÔºåÊÄé‰πàÂäûÔºüÂÖ∂ÂÆûÊàë‰ª¨ÈúÄË¶ÅÁöÑÊòØÂ∞Üxargs ÈÄÜÂ§©ÁöÑËÉΩÂäõÊâ©Â±ïÂà∞Â§öÂè∞Êú∫Âô®„ÄÇparallel‰Ωú‰∏∫‰∏ªËßíÔºåÊòØÊó∂ÂÄôÁôªÂú∫‰∫ÜÂÆâË£ÖÊ≠•È™§ÂÆâË£Ö parallel ÂåÖ1234# Ubunt/Dabinsudo apt-get install parallel# Linuxyum install parallel ‰øÆÊîπparallelÁöÑÈÖçÁΩÆÊñá‰ª∂ÁÆÄÂçïÂú∞ËØ¥ÔºåÂ∞±ÊòØÂà†Èô§‚Äìtollef12cat /etc/parallel/config--tollef ÊµãËØïÂèØÁî®ÊÄßÂèØ‰ª•Áî®ÁÆÄÂçïÁöÑsleepÂëΩ‰ª§Êù•ÊµãËØïparallelÁöÑÂèØÁî®ÊÄßÔºö12seq 1 100 ÔΩúparallel -j 2 -S 10.16.17.17 -S 10.16.17.169 sleep {}# ÂèÇÊï∞ -j Ë°®Á§∫ÊØèÊ¨°ÂàÜÂèëÂá†‰∏™jobÔºåÊØîÂ¶ÇÊú¨‰æãÂ≠ê‰∏≠ÔºåÊØèÊ¨°Âèë‰∏§‰∏™‰ªªÂä°ÔºåÂç≥ÊØèÂè∞Êú∫Âô®‰∏ä‰ºöÊúâ‰∏§‰∏™sleep‰ªªÂä°Âú®Ë∑ë„ÄÇ Ê≥®ÊÑèËäÇÁÇπ‰πãÈó¥ÈúÄË¶ÅËÆæÁΩÆsshÊó†ÈúÄËæìÂÖ•ÂØÜÁ†Å document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰∏ÄÊù°SQLÊü•ËØ¢ËØ≠Âè•ÊòØÂ¶Ç‰ΩïÊâßË°åÁöÑÔºü]]></title>
    <url>%2F2019%2F01%2F28%2FstudyMySQL-01%2F</url>
    <content type="text"><![CDATA[ÊØîÂ¶ÇÔºå‰Ω†Êúâ‰∏™ÊúÄÁÆÄÂçïÁöÑË°®ÔºåË°®ÈáåÂè™Êúâ‰∏Ä‰∏™IDÂ≠óÊÆµÔºåÂú®ÊâßË°å‰∏ãÈù¢Ëøô‰∏™Êü•ËØ¢ËØ≠Âè•Êó∂Ôºö1mysql> SELECT * FROM T WHERE ID=10; ÁúãÂà∞ÁöÑÂè™ÊòØËæìÂÖ•‰∏ÄÊù°ËØ≠Âè•ÔºåËøîÂõû‰∏Ä‰∏™ÁªìÊûúÔºåÂç¥‰∏çÁü•ÈÅìËøôÊù°ËØ≠Âè•Âú®MySQLÂÜÖÈÉ®ÁöÑÊâßË°åËøáÁ®ã„ÄÇ ÊâÄ‰ª•‰∏ÄËµ∑ÊääMySQLÊãÜËß£‰∏Ä‰∏ãÔºåÁúãÁúãÈáåÈù¢ÈÉΩÊúâÂì™‰∫õ‚ÄùÈõ∂‰ª∂‚ÄùÔºåÂ∏åÊúõÂÄüÁî±Ëøô‰∏™ÊãÜËß£ËøáÁ®ãÔºåÂØπMySQLÊúâÊõ¥Ê∑±ÂÖ•ÁöÑÁêÜËß£„ÄÇËøôÊ†∑ÂΩìÁ¢∞Âà∞MySQLÁöÑ‰∏Ä‰∫õÂºÇÂ∏∏ÊàñËÄÖÈóÆÈ¢òÊó∂ÔºåÂ∞±ËÉΩÂ§üÁõ¥Êà≥Êú¨Ë¥®ÔºåÊõ¥‰∏∫Âø´ÈÄüÂú∞ÂÆö‰ΩçÂπ∂Ëß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ ‰∏ãÈù¢ÁöÑÊòØMySQLÁöÑÂü∫Êú¨Êû∂ÊûÑÁ§∫ÊÑèÂõæÔºå‰ªé‰∏≠ÂèØ‰ª•Ê∏ÖÊ•öÂú∞ÁúãÂà∞SQLËØ≠Âè•Âú®MySQLÁöÑÂêÑ‰∏™ÂäüËÉΩÊ®°Âùó‰∏≠ÁöÑÊâßË°åËøáÁ®ã„ÄÇ Â§ß‰ΩìÊù•ËØ¥ÔºåMySQLÂèØ‰ª•ÂàÜ‰∏∫ServerÂ±ÇÂíåÂ≠òÂÇ®ÂºïÊìéÂ±Ç‰∏§ÈÉ®ÂàÜ„ÄÇ ServerÂ±ÇÂåÖÊã¨ËøûÊé•Âô®„ÄÅÊü•ËØ¢ÁºìÂ≠ò„ÄÅÂàÜÊûêÂô®„ÄÅ‰ºòÂåñÂô®„ÄÅÊâßË°åÂô®Á≠âÔºåÊ∂µÁõñMySQLÁöÑÂ§ßÂ§öÊï∞Ê†∏ÂøÉÊúçÂä°ÂäüËÉΩÔºå‰ª•ÂèäÊâÄÊúâÁöÑÂÜÖÁΩÆÂáΩÊï∞ÔºàÂ¶ÇÊó•Êúü„ÄÅÊó∂Èó¥„ÄÅÊï∞Â≠¶ÂíåÂä†ÂØÜÂáΩÊï∞Á≠âÔºâÔºåÊâÄÊúâË∑®Â≠òÂÇ®ÂºïÊìéÁöÑÂäüËÉΩÈÉΩÂú®Ëøô‰∏ÄÂ±ÇÂÆûÁé∞ÔºåÊØîÂ¶ÇÂ≠òÂÇ®ËøáÁ®ã„ÄÅËß¶ÂèëÂô®„ÄÅËßÜÂõæÁ≠â„ÄÇ ËÄåÂ≠òÂÇ®ÂºïÊìéÂ±ÇË¥üË¥£Êï∞ÊçÆÁöÑÂ≠òÂÇ®ÂíåÊèêÂèñ„ÄÇÂÖ∂Êû∂ÊûÑÊ®°ÂºèÊòØÊèí‰ª∂ÂºèÁöÑÔºåÊîØÊåÅInnoDB„ÄÅMyISAM„ÄÅMemoryÁ≠âÂ§ö‰∏™Â≠òÂÇ®ÂºïÊìé„ÄÇÁé∞Âú®ÊúÄÂ∏∏Áî®ÁöÑÂ≠òÂÇ®ÂºïÊìéÊòØInnoDBÔºåÂÆÉ‰ªéMySQL 5.5.5ÁâàÊú¨ÂºÄÂßãÊàê‰∏∫‰∫ÜÈªòËÆ§Â≠òÂÇ®ÂºïÊìé„ÄÇ ‰πüÂ∞±ÊòØËØ¥Ôºå‰Ω†ÊâßË°åcreate tableÂª∫Ë°®ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú‰∏çÊåáÂÆöÂºïÊìéÁ±ªÂûãÔºåÈªòËÆ§‰ΩøÁî®ÁöÑÂ∞±ÊòØInnoDB„ÄÇ‰∏çËøáÔºå‰Ω†‰πüÂèØ‰ª•ÈÄöËøáÊåáÂÆöÂ≠òÂÇ®ÂºïÊìéÁöÑÁ±ªÂûãÊù•ÈÄâÊã©Âà´ÁöÑÂºïÊìéÔºåÊØîÂ¶ÇÂú®create tableËØ≠Âè•‰∏≠‰ΩøÁî®engine=memory, Êù•ÊåáÂÆö‰ΩøÁî®ÂÜÖÂ≠òÂºïÊìéÂàõÂª∫Ë°®„ÄÇ‰∏çÂêåÂ≠òÂÇ®ÂºïÊìéÁöÑË°®Êï∞ÊçÆÂ≠òÂèñÊñπÂºè‰∏çÂêåÔºåÊîØÊåÅÁöÑÂäüËÉΩ‰πü‰∏çÂêåÔºåÂú®ÂêéÈù¢ÁöÑÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨‰ºöËÆ®ËÆ∫Âà∞ÂºïÊìéÁöÑÈÄâÊã©„ÄÇ ‰ªéÂõæ‰∏≠‰∏çÈöæÁúãÂá∫Ôºå‰∏çÂêåÁöÑÂ≠òÂÇ®ÂºïÊìéÂÖ±Áî®‰∏Ä‰∏™ServerÂ±ÇÔºå‰πüÂ∞±ÊòØ‰ªéËøûÊé•Âô®Âà∞ÊâßË°åÂô®ÁöÑÈÉ®ÂàÜ„ÄÇ‰Ω†ÂèØ‰ª•ÂÖàÂØπÊØè‰∏™ÁªÑ‰ª∂ÁöÑÂêçÂ≠óÊúâ‰∏™Âç∞Ë±°ÔºåÊé•‰∏ãÊù•Êàë‰ºöÁªìÂêàÂºÄÂ§¥ÊèêÂà∞ÁöÑÈÇ£Êù°SQLËØ≠Âè•ÔºåÂ∏¶‰Ω†Ëµ∞‰∏ÄÈÅçÊï¥‰∏™ÊâßË°åÊµÅÁ®ãÔºå‰æùÊ¨°Áúã‰∏ãÊØè‰∏™ÁªÑ‰ª∂ÁöÑ‰ΩúÁî®„ÄÇ ËøûÊé•Âô®Á¨¨‰∏ÄÊ≠•ÂÖàËøûÊé•Âà∞Ëøô‰∏™Êï∞ÊçÆÂ∫ì‰∏äÔºåËøôÊó∂ÂÄôÊé•ÂæÖ‰Ω†ÁöÑÂ∞±ÊòØËøûÊé•Âô®„ÄÇËøûÊé•Âô®Ë¥üË¥£Ë∑üÂÆ¢Êà∑Á´ØÂª∫Á´ãËøûÊé•„ÄÅËé∑ÂèñÊùÉÈôê„ÄÅÁª¥ÊåÅÂíåÁÆ°ÁêÜËøûÊé•„ÄÇËøûÊé•ÂëΩ‰ª§‰∏ÄËà¨ÊòØËøô‰πàÂÜôÁöÑÔºö1mysql -h$ip -P$port -u$user -p ËæìÂÆåÂëΩ‰ª§‰πãÂêéÔºå‰Ω†Â∞±ÈúÄË¶ÅÂú®‰∫§‰∫íÂØπËØùÈáåÈù¢ËæìÂÖ•ÂØÜÁ†Å„ÄÇËôΩÁÑ∂ÂØÜÁ†Å‰πüÂèØ‰ª•Áõ¥Êé•Ë∑üÂú®-pÂêéÈù¢ÂÜôÂú®ÂëΩ‰ª§Ë°å‰∏≠Ôºå‰ΩÜËøôÊ†∑ÂèØËÉΩ‰ºöÂØºËá¥‰Ω†ÁöÑÂØÜÁ†ÅÊ≥ÑÈú≤„ÄÇÂ¶ÇÊûú‰Ω†ËøûÁöÑÊòØÁîü‰∫ßÊúçÂä°Âô®ÔºåÂº∫ÁÉàÂª∫ËÆÆ‰Ω†‰∏çË¶ÅËøô‰πàÂÅö„ÄÇ ËøûÊé•ÂëΩ‰ª§‰∏≠ÁöÑmysqlÊòØÂÆ¢Êà∑Á´ØÂ∑•ÂÖ∑ÔºåÁî®Êù•Ë∑üÊúçÂä°Á´ØÂª∫Á´ãËøûÊé•„ÄÇÂú®ÂÆåÊàêÁªèÂÖ∏ÁöÑTCPÊè°ÊâãÂêéÔºåËøûÊé•Âô®Â∞±Ë¶ÅÂºÄÂßãËÆ§ËØÅ‰Ω†ÁöÑË∫´‰ªΩÔºåËøô‰∏™Êó∂ÂÄôÁî®ÁöÑÂ∞±ÊòØ‰Ω†ËæìÂÖ•ÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†Å„ÄÇ * Â¶ÇÊûúÁî®Êà∑ÂêçÊàñÂØÜÁ†Å‰∏çÂØπÔºå‰Ω†Â∞±‰ºöÊî∂Âà∞‰∏Ä‰∏™"Access denied for user"ÁöÑÈîôËØØÔºåÁÑ∂ÂêéÂÆ¢Êà∑Á´ØÁ®ãÂ∫èÁªìÊùüÊâßË°å„ÄÇ * Â¶ÇÊûúÁî®Êà∑ÂêçÂØÜÁ†ÅËÆ§ËØÅÈÄöËøáÔºåËøûÊé•Âô®‰ºöÂà∞ÊùÉÈôêË°®ÈáåÈù¢Êü•Âá∫‰Ω†Êã•ÊúâÁöÑÊùÉÈôê„ÄÇ‰πãÂêéÔºåËøô‰∏™ËøûÊé•ÈáåÈù¢ÁöÑÊùÉÈôêÂà§Êñ≠ÈÄªËæëÔºåÈÉΩÂ∞Ü‰æùËµñ‰∫éÊ≠§Êó∂ËØªÂà∞ÁöÑÊùÉÈôê„ÄÇ ËøôÂ∞±ÊÑèÂë≥ÁùÄÔºå‰∏Ä‰∏™Áî®Êà∑ÊàêÂäüÂª∫Á´ãËøûÊé•ÂêéÔºåÂç≥‰Ωø‰Ω†Áî®ÁÆ°ÁêÜÂëòË¥¶Âè∑ÂØπËøô‰∏™Áî®Êà∑ÁöÑÊùÉÈôêÂÅö‰∫Ü‰øÆÊîπÔºå‰πü‰∏ç‰ºöÂΩ±ÂìçÂ∑≤ÁªèÂ≠òÂú®ËøûÊé•ÁöÑÊùÉÈôê„ÄÇ‰øÆÊîπÂÆåÊàêÂêéÔºåÂè™ÊúâÂÜçÊñ∞Âª∫ÁöÑËøûÊé•Êâç‰ºö‰ΩøÁî®Êñ∞ÁöÑÊùÉÈôêËÆæÁΩÆ„ÄÇ ËøûÊé•ÂÆåÊàêÂêéÔºåÂ¶ÇÊûú‰Ω†Ê≤°ÊúâÂêéÁª≠ÁöÑÂä®‰ΩúÔºåËøô‰∏™ËøûÊé•Â∞±Â§Ñ‰∫éÁ©∫Èó≤Áä∂ÊÄÅÔºå‰Ω†ÂèØ‰ª•Âú®show processlistÂëΩ‰ª§‰∏≠ÁúãÂà∞ÂÆÉ„ÄÇÊñáÊú¨‰∏≠Ëøô‰∏™ÂõæÊòØshow processlistÁöÑÁªìÊûúÔºåÂÖ∂‰∏≠ÁöÑCommandÂàóÊòæÁ§∫‰∏∫‚ÄúSleep‚ÄùÁöÑËøô‰∏ÄË°åÔºåÂ∞±Ë°®Á§∫Áé∞Âú®Á≥ªÁªüÈáåÈù¢Êúâ‰∏Ä‰∏™Á©∫Èó≤ËøûÊé•„ÄÇ ÂÆ¢Êà∑Á´ØÂ¶ÇÊûúÂ§™ÈïøÊó∂Èó¥Ê≤°Âä®ÈùôÔºåËøûÊé•Âô®Â∞±‰ºöËá™Âä®Â∞ÜÂÆÉÊñ≠ÂºÄ„ÄÇËøô‰∏™Êó∂Èó¥ÊòØÁî±ÂèÇÊï∞ wait_timeout ÊéßÂà∂ÁöÑÔºåÈªòËÆ§ÂÄºÊòØ8Â∞èÊó∂„ÄÇ Â¶ÇÊûúÂú®ËøûÊé•Ë¢´Êñ≠ÂºÄ‰πãÂêéÔºåÂÆ¢Êà∑Á´ØÂÜçÊ¨°ÂèëÈÄÅËØ∑Ê±ÇÁöÑËØùÔºåÂ∞±‰ºöÊî∂Âà∞‰∏Ä‰∏™ÈîôËØØÊèêÈÜíÔºö Lost connection to MySQL server during query„ÄÇËøôÊó∂ÂÄôÂ¶ÇÊûú‰Ω†Ë¶ÅÁªßÁª≠ÔºåÂ∞±ÈúÄË¶ÅÈáçËøûÔºåÁÑ∂ÂêéÂÜçÊâßË°åËØ∑Ê±Ç‰∫Ü„ÄÇ Êï∞ÊçÆÂ∫ìÈáåÈù¢ÔºåÈïøËøûÊé•ÊòØÊåáËøûÊé•ÊàêÂäüÂêéÔºåÂ¶ÇÊûúÂÆ¢Êà∑Á´ØÊåÅÁª≠ÊúâËØ∑Ê±ÇÔºåÂàô‰∏ÄÁõ¥‰ΩøÁî®Âêå‰∏Ä‰∏™ËøûÊé•„ÄÇÁü≠ËøûÊé•ÂàôÊòØÊåáÊØèÊ¨°ÊâßË°åÂÆåÂæàÂ∞ëÁöÑÂá†Ê¨°Êü•ËØ¢Â∞±Êñ≠ÂºÄËøûÊé•Ôºå‰∏ãÊ¨°Êü•ËØ¢ÂÜçÈáçÊñ∞Âª∫Á´ã‰∏Ä‰∏™„ÄÇ Âª∫Á´ãËøûÊé•ÁöÑËøáÁ®ãÈÄöÂ∏∏ÊòØÊØîËæÉÂ§çÊùÇÁöÑÔºåÊâÄ‰ª•ÊàëÂª∫ËÆÆ‰Ω†Âú®‰ΩøÁî®‰∏≠Ë¶ÅÂ∞ΩÈáèÂáèÂ∞ëÂª∫Á´ãËøûÊé•ÁöÑÂä®‰ΩúÔºå‰πüÂ∞±ÊòØÂ∞ΩÈáè‰ΩøÁî®ÈïøËøûÊé•„ÄÇ ‰ΩÜÊòØÂÖ®ÈÉ®‰ΩøÁî®ÈïøËøûÊé•ÂêéÔºåÂèØËÉΩ‰ºöÂèëÁé∞ÔºåÊúâ‰∫õÊó∂ÂÄôMySQLÂç†Áî®ÂÜÖÂ≠òÊ∂®ÂæóÁâπÂà´Âø´ÔºåËøôÊòØÂõ†‰∏∫MySQLÂú®ÊâßË°åËøáÁ®ã‰∏≠‰∏¥Êó∂‰ΩøÁî®ÁöÑÂÜÖÂ≠òÊòØÁÆ°ÁêÜÂú®ËøûÊé•ÂØπË±°ÈáåÈù¢ÁöÑ„ÄÇËøô‰∫õËµÑÊ∫ê‰ºöÂú®ËøûÊé•Êñ≠ÂºÄÁöÑÊó∂ÂÄôÊâçÈáäÊîæ„ÄÇÊâÄ‰ª•Â¶ÇÊûúÈïøËøûÊé•Á¥ØÁßØ‰∏ãÊù•ÔºåÂèØËÉΩÂØºËá¥ÂÜÖÂ≠òÂç†Áî®Â§™Â§ßÔºåË¢´Á≥ªÁªüÂº∫Ë°åÊùÄÊéâÔºàOOMÔºâÔºå‰ªéÁé∞Ë±°ÁúãÂ∞±ÊòØMySQLÂºÇÂ∏∏ÈáçÂêØ‰∫Ü„ÄÇ ÊÄé‰πàËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÂë¢Ôºü‰Ω†ÂèØ‰ª•ËÄÉËôë‰ª•‰∏ã‰∏§ÁßçÊñπÊ°à„ÄÇ *ÂÆöÊúüÊñ≠ÂºÄÈïøËøûÊé•„ÄÇ‰ΩøÁî®‰∏ÄÊÆµÊó∂Èó¥ÔºåÊàñËÄÖÁ®ãÂ∫èÈáåÈù¢Âà§Êñ≠ÊâßË°åËøá‰∏Ä‰∏™Âç†Áî®ÂÜÖÂ≠òÁöÑÂ§ßÊü•ËØ¢ÂêéÔºåÊñ≠ÂºÄËøûÊé•Ôºå‰πãÂêéË¶ÅÊü•ËØ¢ÂÜçÈáçËøû„ÄÇ *Â¶ÇÊûú‰Ω†Áî®ÁöÑÊòØ MySQL 5.7ÊàñÊõ¥Êñ∞ÁâàÊú¨ÔºåÂèØ‰ª•Âú®ÊØèÊ¨°ÊâßË°å‰∏Ä‰∏™ÊØîËæÉÂ§ßÁöÑÊìç‰ΩúÂêéÔºåÈÄöËøáÊâßË°å mysql_reset_connection Êù•ÈáçÊñ∞ÂàùÂßãÂåñËøûÊé•ËµÑÊ∫ê„ÄÇËøô‰∏™ËøáÁ®ã‰∏çÈúÄË¶ÅÈáçËøûÂíåÈáçÊñ∞ÂÅöÊùÉÈôêÈ™åËØÅÔºå‰ΩÜÊòØ‰ºöÂ∞ÜËøûÊé•ÊÅ¢Â§çÂà∞ÂàöÂàöÂàõÂª∫ÂÆåÊó∂ÁöÑÁä∂ÊÄÅ„ÄÇ Êü•ËØ¢ÁºìÂ≠òËøûÊé•Âª∫Á´ãÂÆåÊàêÂêéÔºåÂ∞±ÂèØ‰ª•ÊâßË°å SELECT ËØ≠Âè•‰∫Ü„ÄÇÊâßË°åÈÄªËæëÂ∞±‰ºöÊù•Âà∞Á¨¨‰∫åÊ≠•ÔºöÊü•ËØ¢ÁºìÂ≠ò„ÄÇ MySQLÊãøÂà∞‰∏Ä‰∏™Êü•ËØ¢ËØ∑Ê±ÇÂêéÔºå‰ºöÂÖàÂà∞Êü•ËØ¢ÁºìÂ≠òÁúãÁúãÔºå‰πãÂâçÊòØ‰∏çÊòØÊâßË°åËøáËøôÊù°ËØ≠Âè•„ÄÇ‰πãÂâçÊâßË°åËøáÁöÑËØ≠Âè•ÂèäÂÖ∂ÁªìÊûúÂèØËÉΩ‰ºö‰ª• key-value ÂØπÁöÑÂΩ¢ÂºèÔºåË¢´Áõ¥Êé•ÁºìÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇkeyÊòØÊü•ËØ¢ÁöÑËØ≠Âè•ÔºåvalueÊòØÊü•ËØ¢ÁöÑÁªìÊûú„ÄÇÂ¶ÇÊûú‰Ω†ÁöÑÊü•ËØ¢ËÉΩÂ§üÁõ¥Êé•Âú®Ëøô‰∏™ÁºìÂ≠ò‰∏≠ÊâæÂà∞keyÔºåÈÇ£‰πàËøô‰∏™valueÂ∞±‰ºöË¢´Áõ¥Êé•ËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇ Â¶ÇÊûúËØ≠Âè•‰∏çÂú®Êü•ËØ¢ÁºìÂ≠ò‰∏≠ÔºåÂ∞±‰ºöÁªßÁª≠ÂêéÈù¢ÁöÑÊâßË°åÈò∂ÊÆµ„ÄÇÊâßË°åÂÆåÊàêÂêéÔºåÊâßË°åÁªìÊûú‰ºöË¢´Â≠òÂÖ•Êü•ËØ¢ÁºìÂ≠ò‰∏≠„ÄÇ‰Ω†ÂèØ‰ª•ÁúãÂà∞ÔºåÂ¶ÇÊûúÊü•ËØ¢ÂëΩ‰∏≠ÁºìÂ≠òÔºåMySQL‰∏çÈúÄË¶ÅÊâßË°åÂêéÈù¢ÁöÑÂ§çÊùÇÊìç‰ΩúÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•ËøîÂõûÁªìÊûúÔºåËøô‰∏™ÊïàÁéá‰ºöÂæàÈ´ò„ÄÇ ‰ΩÜÊòØÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÊàë‰ºöÂª∫ËÆÆ‰Ω†‰∏çË¶Å‰ΩøÁî®Êü•ËØ¢ÁºìÂ≠òÔºå‰∏∫‰ªÄ‰πàÂë¢ÔºüÂõ†‰∏∫Êü•ËØ¢ÁºìÂ≠òÂæÄÂæÄÂºäÂ§ß‰∫éÂà©„ÄÇ Êü•ËØ¢ÁºìÂ≠òÁöÑÂ§±ÊïàÈùûÂ∏∏È¢ëÁπÅÔºåÂè™Ë¶ÅÊúâÂØπ‰∏Ä‰∏™Ë°®ÁöÑÊõ¥Êñ∞ÔºåËøô‰∏™Ë°®‰∏äÊâÄÊúâÁöÑÊü•ËØ¢ÁºìÂ≠òÈÉΩ‰ºöË¢´Ê∏ÖÁ©∫„ÄÇÂõ†Ê≠§ÂæàÂèØËÉΩ‰Ω†Ë¥πÂä≤Âú∞ÊääÁªìÊûúÂ≠òËµ∑Êù•ÔºåËøòÊ≤°‰ΩøÁî®Âë¢ÔºåÂ∞±Ë¢´‰∏Ä‰∏™Êõ¥Êñ∞ÂÖ®Ê∏ÖÁ©∫‰∫Ü„ÄÇÂØπ‰∫éÊõ¥Êñ∞ÂéãÂäõÂ§ßÁöÑÊï∞ÊçÆÂ∫ìÊù•ËØ¥ÔºåÊü•ËØ¢ÁºìÂ≠òÁöÑÂëΩ‰∏≠Áéá‰ºöÈùûÂ∏∏‰Ωé„ÄÇÈô§Èùû‰Ω†ÁöÑ‰∏öÂä°Â∞±ÊòØÊúâ‰∏ÄÂº†ÈùôÊÄÅË°®ÔºåÂæàÈïøÊó∂Èó¥Êâç‰ºöÊõ¥Êñ∞‰∏ÄÊ¨°„ÄÇÊØîÂ¶ÇÔºå‰∏Ä‰∏™Á≥ªÁªüÈÖçÁΩÆË°®ÔºåÈÇ£ËøôÂº†Ë°®‰∏äÁöÑÊü•ËØ¢ÊâçÈÄÇÂêà‰ΩøÁî®Êü•ËØ¢ÁºìÂ≠ò„ÄÇ Â•ΩÂú®MySQL‰πüÊèê‰æõ‰∫ÜËøôÁßç‚ÄúÊåâÈúÄ‰ΩøÁî®‚ÄùÁöÑÊñπÂºè„ÄÇ‰Ω†ÂèØ‰ª•Â∞ÜÂèÇÊï∞query_cache_typeËÆæÁΩÆÊàêDEMANDÔºåËøôÊ†∑ÂØπ‰∫éÈªòËÆ§ÁöÑSQLËØ≠Âè•ÈÉΩ‰∏ç‰ΩøÁî®Êü•ËØ¢ÁºìÂ≠ò„ÄÇËÄåÂØπ‰∫é‰Ω†Á°ÆÂÆöË¶Å‰ΩøÁî®Êü•ËØ¢ÁºìÂ≠òÁöÑËØ≠Âè•ÔºåÂèØ‰ª•Áî®SQL_CACHEÊòæÂºèÊåáÂÆöÔºåÂÉè‰∏ãÈù¢Ëøô‰∏™ËØ≠Âè•‰∏ÄÊ†∑Ôºö1234mysql> SELECT SQL_CACHE * FROM T WHERE ID=10;------------------------------------------------Ê≥®: MySQL 8.0ÁâàÊú¨Áõ¥Êé•Â∞ÜÊü•ËØ¢ÁºìÂ≠òÁöÑÊï¥ÂùóÂäüËÉΩÂà†Êéâ‰∫ÜÔºå‰πüÂ∞±ÊòØËØ¥8.0ÂºÄÂßãÂΩªÂ∫ïÊ≤°ÊúâËøô‰∏™ÂäüËÉΩ‰∫Ü„ÄÇ ÂàÜÊûêÂô®Â¶ÇÊûúÊ≤°ÊúâÂëΩ‰∏≠Êü•ËØ¢ÁºìÂ≠òÔºåÂ∞±Ë¶ÅÂºÄÂßãÁúüÊ≠£ÊâßË°åËØ≠Âè•‰∫Ü„ÄÇÈ¶ñÂÖàÔºåMySQLÈúÄË¶ÅÁü•ÈÅì‰Ω†Ë¶ÅÂÅö‰ªÄ‰πàÔºåÂõ†Ê≠§ÈúÄË¶ÅÂØπSQLËØ≠Âè•ÂÅöËß£Êûê„ÄÇ ÂàÜÊûêÂô®ÂÖà‰ºöÂÅö‚ÄúËØçÊ≥ïÂàÜÊûê‚Äù„ÄÇ‰Ω†ËæìÂÖ•ÁöÑÊòØÁî±Â§ö‰∏™Â≠óÁ¨¶‰∏≤ÂíåÁ©∫Ê†ºÁªÑÊàêÁöÑ‰∏ÄÊù°SQLËØ≠Âè•ÔºåMySQLÈúÄË¶ÅËØÜÂà´Âá∫ÈáåÈù¢ÁöÑÂ≠óÁ¨¶‰∏≤ÂàÜÂà´ÊòØ‰ªÄ‰πàÔºå‰ª£Ë°®‰ªÄ‰πà„ÄÇ MySQL‰ªé‰Ω†ËæìÂÖ•ÁöÑ‚ÄùSELECT/select‚ÄùËøô‰∏™ÂÖ≥ÈîÆÂ≠óËØÜÂà´Âá∫Êù•ÔºåËøôÊòØ‰∏Ä‰∏™Êü•ËØ¢ËØ≠Âè•„ÄÇÂÆÉ‰πüË¶ÅÊääÂ≠óÁ¨¶‰∏≤‚ÄúT‚ÄùËØÜÂà´Êàê‚ÄúË°®ÂêçT‚ÄùÔºåÊääÂ≠óÁ¨¶‰∏≤‚ÄúID‚ÄùËØÜÂà´Êàê‚ÄúÂàóID‚Äù„ÄÇ ÂÅöÂÆå‰∫ÜËøô‰∫õËØÜÂà´‰ª•ÂêéÔºåÂ∞±Ë¶ÅÂÅö‚ÄúËØ≠Ê≥ïÂàÜÊûê‚Äù„ÄÇÊ†πÊçÆËØçÊ≥ïÂàÜÊûêÁöÑÁªìÊûúÔºåËØ≠Ê≥ïÂàÜÊûêÂô®‰ºöÊ†πÊçÆËØ≠Ê≥ïËßÑÂàôÔºåÂà§Êñ≠‰Ω†ËæìÂÖ•ÁöÑËøô‰∏™SQLËØ≠Âè•ÊòØÂê¶Êª°Ë∂≥MySQLËØ≠Ê≥ï„ÄÇ Â¶ÇÊûú‰Ω†ÁöÑËØ≠Âè•‰∏çÂØπÔºåÂ∞±‰ºöÊî∂Âà∞‚ÄúYou have an error in your SQL syntax‚ÄùÁöÑÈîôËØØÊèêÈÜíÔºåÊØîÂ¶Ç‰∏ãÈù¢Ëøô‰∏™ËØ≠Âè•selectÂ∞ëÊâì‰∫ÜÂºÄÂ§¥ÁöÑÂ≠óÊØç‚Äús‚Äù„ÄÇ123mysql> elect * from t where ID=1;ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'elect * from t where ID=1' at line 1 ‰∏ÄËà¨ËØ≠Ê≥ïÈîôËØØ‰ºöÊèêÁ§∫Á¨¨‰∏Ä‰∏™Âá∫Áé∞ÈîôËØØÁöÑ‰ΩçÁΩÆÔºåÊâÄ‰ª•‰Ω†Ë¶ÅÂÖ≥Ê≥®ÁöÑÊòØÁ¥ßÊé•‚Äúuse near‚ÄùÁöÑÂÜÖÂÆπ„ÄÇ ‰ºòÂåñÂô®ÁªèËøá‰∫ÜÂàÜÊûêÂô®ÔºåMySQLÂ∞±Áü•ÈÅì‰Ω†Ë¶ÅÂÅö‰ªÄ‰πà‰∫Ü„ÄÇÂú®ÂºÄÂßãÊâßË°å‰πãÂâçÔºåËøòË¶ÅÂÖàÁªèËøá‰ºòÂåñÂô®ÁöÑÂ§ÑÁêÜ„ÄÇ ‰ºòÂåñÂô®ÊòØÂú®Ë°®ÈáåÈù¢ÊúâÂ§ö‰∏™Á¥¢ÂºïÁöÑÊó∂ÂÄôÔºåÂÜ≥ÂÆö‰ΩøÁî®Âì™‰∏™Á¥¢ÂºïÔºõÊàñËÄÖÂú®‰∏Ä‰∏™ËØ≠Âè•ÊúâÂ§öË°®ÂÖ≥ËÅîÔºàjoinÔºâÁöÑÊó∂ÂÄôÔºåÂÜ≥ÂÆöÂêÑ‰∏™Ë°®ÁöÑËøûÊé•È°∫Â∫è„ÄÇÊØîÂ¶Ç‰Ω†ÊâßË°å‰∏ãÈù¢ËøôÊ†∑ÁöÑËØ≠Âè•ÔºåËøô‰∏™ËØ≠Âè•ÊòØÊâßË°å‰∏§‰∏™Ë°®ÁöÑjoinÔºö 1mysql> select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20 * Êó¢ÂèØ‰ª•ÂÖà‰ªéË°®t1ÈáåÈù¢ÂèñÂá∫c=10ÁöÑËÆ∞ÂΩïÁöÑIDÂÄºÔºåÂÜçÊ†πÊçÆIDÂÄºÂÖ≥ËÅîÂà∞Ë°®t2ÔºåÂÜçÂà§Êñ≠t2ÈáåÈù¢dÁöÑÂÄºÊòØÂê¶Á≠â‰∫é20„ÄÇ * ‰πüÂèØ‰ª•ÂÖà‰ªéË°®t2ÈáåÈù¢ÂèñÂá∫d=20ÁöÑËÆ∞ÂΩïÁöÑIDÂÄºÔºåÂÜçÊ†πÊçÆIDÂÄºÂÖ≥ËÅîÂà∞t1ÔºåÂÜçÂà§Êñ≠t1ÈáåÈù¢cÁöÑÂÄºÊòØÂê¶Á≠â‰∫é10„ÄÇ Ëøô‰∏§ÁßçÊâßË°åÊñπÊ≥ïÁöÑÈÄªËæëÁªìÊûúÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰ΩÜÊòØÊâßË°åÁöÑÊïàÁéá‰ºöÊúâ‰∏çÂêåÔºåËÄå‰ºòÂåñÂô®ÁöÑ‰ΩúÁî®Â∞±ÊòØÂÜ≥ÂÆöÈÄâÊã©‰ΩøÁî®Âì™‰∏Ä‰∏™ÊñπÊ°à„ÄÇ ‰ºòÂåñÂô®Èò∂ÊÆµÂÆåÊàêÂêéÔºåËøô‰∏™ËØ≠Âè•ÁöÑÊâßË°åÊñπÊ°àÂ∞±Á°ÆÂÆö‰∏ãÊù•‰∫ÜÔºåÁÑ∂ÂêéËøõÂÖ•ÊâßË°åÂô®Èò∂ÊÆµ„ÄÇÂ¶ÇÊûú‰Ω†ËøòÊúâ‰∏Ä‰∫õÁñëÈóÆÔºåÊØîÂ¶Ç‰ºòÂåñÂô®ÊòØÊÄé‰πàÈÄâÊã©Á¥¢ÂºïÁöÑÔºåÊúâÊ≤°ÊúâÂèØËÉΩÈÄâÊã©ÈîôÁ≠âÁ≠âÔºåÊ≤°ÂÖ≥Á≥ªÔºåÊàë‰ºöÂú®ÂêéÈù¢ÁöÑÊñáÁ´†‰∏≠ÂçïÁã¨Â±ïÂºÄËØ¥Êòé‰ºòÂåñÂô®ÁöÑÂÜÖÂÆπ ÊâßË°åÂô®MySQLÈÄöËøáÂàÜÊûêÂô®Áü•ÈÅì‰∫Ü‰Ω†Ë¶ÅÂÅö‰ªÄ‰πàÔºåÈÄöËøá‰ºòÂåñÂô®Áü•ÈÅì‰∫ÜËØ•ÊÄé‰πàÂÅöÔºå‰∫éÊòØÂ∞±ËøõÂÖ•‰∫ÜÊâßË°åÂô®Èò∂ÊÆµÔºåÂºÄÂßãÊâßË°åËØ≠Âè•„ÄÇ ÂºÄÂßãÊâßË°åÁöÑÊó∂ÂÄôÔºåË¶ÅÂÖàÂà§Êñ≠‰∏Ä‰∏ã‰Ω†ÂØπËøô‰∏™Ë°®TÊúâÊ≤°ÊúâÊâßË°åÊü•ËØ¢ÁöÑÊùÉÈôêÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±‰ºöËøîÂõûÊ≤°ÊúâÊùÉÈôêÁöÑÈîôËØØÔºåÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ123mysql> select * from T where ID=10;ERROR 1142 (42000): SELECT command denied to user 'b'@'localhost' for table 'T' Â¶ÇÊûúÊúâÊùÉÈôêÔºåÂ∞±ÊâìÂºÄË°®ÁªßÁª≠ÊâßË°å„ÄÇÊâìÂºÄË°®ÁöÑÊó∂ÂÄôÔºåÊâßË°åÂô®Â∞±‰ºöÊ†πÊçÆË°®ÁöÑÂºïÊìéÂÆö‰πâÔºåÂéª‰ΩøÁî®Ëøô‰∏™ÂºïÊìéÊèê‰æõÁöÑÊé•Âè£„ÄÇ ÊØîÂ¶ÇÊàë‰ª¨Ëøô‰∏™‰æãÂ≠ê‰∏≠ÁöÑË°®T‰∏≠ÔºåIDÂ≠óÊÆµÊ≤°ÊúâÁ¥¢ÂºïÔºåÈÇ£‰πàÊâßË°åÂô®ÁöÑÊâßË°åÊµÅÁ®ãÊòØËøôÊ†∑ÁöÑÔºö Ë∞ÉÁî®InnoDBÂºïÊìéÊé•Âè£ÂèñËøô‰∏™Ë°®ÁöÑÁ¨¨‰∏ÄË°åÔºåÂà§Êñ≠IDÂÄºÊòØ‰∏çÊòØ10ÔºåÂ¶ÇÊûú‰∏çÊòØÂàôË∑≥ËøáÔºåÂ¶ÇÊûúÊòØÂàôÂ∞ÜËøôË°åÂ≠òÂú®ÁªìÊûúÈõÜ‰∏≠Ôºõ Ë∞ÉÁî®ÂºïÊìéÊé•Âè£Âèñ‚Äú‰∏ã‰∏ÄË°å‚ÄùÔºåÈáçÂ§çÁõ∏ÂêåÁöÑÂà§Êñ≠ÈÄªËæëÔºåÁõ¥Âà∞ÂèñÂà∞Ëøô‰∏™Ë°®ÁöÑÊúÄÂêé‰∏ÄË°å„ÄÇ ÊâßË°åÂô®Â∞Ü‰∏äËø∞ÈÅçÂéÜËøáÁ®ã‰∏≠ÊâÄÊúâÊª°Ë∂≥Êù°‰ª∂ÁöÑË°åÁªÑÊàêÁöÑËÆ∞ÂΩïÈõÜ‰Ωú‰∏∫ÁªìÊûúÈõÜËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇ Ëá≥Ê≠§ÔºåËøô‰∏™ËØ≠Âè•Â∞±ÊâßË°åÂÆåÊàê‰∫Ü„ÄÇ ÂØπ‰∫éÊúâÁ¥¢ÂºïÁöÑË°®ÔºåÊâßË°åÁöÑÈÄªËæë‰πüÂ∑Æ‰∏çÂ§ö„ÄÇÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî®ÁöÑÊòØ‚ÄúÂèñÊª°Ë∂≥Êù°‰ª∂ÁöÑÁ¨¨‰∏ÄË°å‚ÄùËøô‰∏™Êé•Âè£Ôºå‰πãÂêéÂæ™ÁéØÂèñ‚ÄúÊª°Ë∂≥Êù°‰ª∂ÁöÑ‰∏ã‰∏ÄË°å‚ÄùËøô‰∏™Êé•Âè£ÔºåËøô‰∫õÊé•Âè£ÈÉΩÊòØÂºïÊìé‰∏≠Â∑≤ÁªèÂÆö‰πâÂ•ΩÁöÑ„ÄÇ ‰Ω†‰ºöÂú®Êï∞ÊçÆÂ∫ìÁöÑÊÖ¢Êü•ËØ¢Êó•Âøó‰∏≠ÁúãÂà∞‰∏Ä‰∏™ rows_examined ÁöÑÂ≠óÊÆµÔºåË°®Á§∫Ëøô‰∏™ËØ≠Âè•ÊâßË°åËøáÁ®ã‰∏≠Êâ´Êèè‰∫ÜÂ§öÂ∞ëË°å„ÄÇËøô‰∏™ÂÄºÂ∞±ÊòØÂú®ÊâßË°åÂô®ÊØèÊ¨°Ë∞ÉÁî®ÂºïÊìéËé∑ÂèñÊï∞ÊçÆË°åÁöÑÊó∂ÂÄôÁ¥ØÂä†ÁöÑ„ÄÇ Âú®Êúâ‰∫õÂú∫ÊôØ‰∏ãÔºåÊâßË°åÂô®Ë∞ÉÁî®‰∏ÄÊ¨°ÔºåÂú®ÂºïÊìéÂÜÖÈÉ®ÂàôÊâ´Êèè‰∫ÜÂ§öË°åÔºåÂõ†Ê≠§ÂºïÊìéÊâ´ÊèèË°åÊï∞Ë∑ürows_examinedÂπ∂‰∏çÊòØÂÆåÂÖ®Áõ∏ÂêåÁöÑ„ÄÇÊàë‰ª¨ÂêéÈù¢‰ºö‰∏ìÈó®Êúâ‰∏ÄÁØáÊñáÁ´†Êù•ËÆ≤Â≠òÂÇ®ÂºïÊìéÁöÑÂÜÖÈÉ®Êú∫Âà∂ÔºåÈáåÈù¢‰ºöÊúâËØ¶ÁªÜÁöÑËØ¥Êòé„ÄÇ Â∞èÁªì‰ªãÁªç‰∫ÜMySQLÁöÑSQLÈÄªËæëÊû∂ÊûÑÔºåÂ∏åÊúõÂØπ‰∏Ä‰∏™SQLËØ≠Âè•ÂÆåÊï¥ÊâßË°åÊµÅÁ®ãÁöÑÂêÑ‰∏™Èò∂ÊÆµÊúâ‰∫Ü‰∏Ä‰∏™ÂàùÊ≠•ÁöÑÂç∞Ë±°„ÄÇÊàëÂè™ÊòØÁî®‰∏Ä‰∏™Êü•ËØ¢ÁöÑ‰æãÂ≠êÂ∞ÜÂêÑ‰∏™ÁéØËäÇËøá‰∫Ü‰∏ÄÈÅç„ÄÇ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQLÂ≠¶‰π†Á¨îËÆ∞</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Èù¢ËØï]]></title>
    <url>%2F2019%2F01%2F28%2F%E9%9D%A2%E8%AF%95%2F</url>
    <content type="text"><![CDATA[Â•ΩÁî∑‰∫∫Â∞±ÊòØÊàë, ÊàëÂ∞±ÊòØÂ•ΩÁî∑‰∫∫ÔºÅÊàëÂ∞±ÊòØÁéãÊù∞Ê∞ë ^_^ ËÉΩËØ¥ËØ¥‰Ω†‰ª¨Ëøô‰∏™‰∏öÂä°ÁöÑÈÄªËæë‰ª•ÂèäÊï∞ÊçÆÂ∫ìÊÄé‰πàËÆæËÆ°ÂêóÔºüÁ≠îÔºöÂú®Â∑•‰Ωú‰∏≠ÈÅáÂà∞ËøáÁöÑÈöæÁÇπÈóÆÈ¢òÊúâÂì™‰∫õÔºüËÉΩËØ¥ËØ¥‰ª£Ë°®ÊÄßÂá†‰∏™ÂêóÔºüÁ≠îÔºöMySQL ÂºÇÂú∞ÂÜóÁÅæÊÄé‰πàÂÅöÔºüÁ≠îÔºö###‰∏öÂä°Êï∞ÊçÆÂ¢ûÈïøÈáèÊòØÂ§öÂ∞ëGÔºåÊï∞ÊçÆÂ∫ìÊÄé‰πàÁõëÊéßÊï∞ÊçÆÂ¢ûÈïøÈáèÔºü Á≠îÔºöÂàÜÂ∫ìÂàÜË°®ÈÄªËæëÁÆÄÂçïËØ¥‰∏ãÔºüÂ¢ûÈáèÊÄé‰πàËß£ÂÜ≥ÔºüÁ≠îÔºökafka‰ºö‰∏¢Êï∞ÊçÆÂêóÔºü‰∏∫‰ªÄ‰πàÂõû‰∏¢Êï∞ÊçÆÔºüÁ≠îÔºö‰ºö‰∏¢Êï∞ÊçÆMySQL Â§á‰ªΩÊÄé‰πàÂÅöÔºü Â§á‰ªΩÊ†°È™åÊÄé‰πàÂÅöÔºüÁ≠îÔºö‰ΩøÁî®‰∏≠Èó¥‰ª∂‰πãÂêéÁöÑÊû∂ÊûÑÔºåÊï∞ÊçÆÂ∫ìÁöÑ‰∫ãÂä°ÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºü‰∏éÁ®ãÂ∫èÁõ¥Êé•ÈìæÊé•Êï∞ÊçÆÂ∫ì‰ΩøÁî®ÁöÑ‰∫ãÂä°Âå∫Âà´ÊòØ‰ªÄ‰πàÔºüÁ≠îÔºö‰πãÂâçÂàÜË°®‰∫Ü16Âº†ÔºåÂú®‰ΩøÁî®‰∏ÄÂÆöÊó∂Èó¥Â§üÂèëÁé∞16Âº†Ë°®Â∑≤Áªè‰∏çÊª°Ë∂≥‰∫ÜÔºåÈÇ£ÊÄé‰πàÊâ©ÂÆπÔºåÊâ©ÂÆπ‰πãÂêéÊï∞ÊçÆÊÄé‰πàÂêåÊ≠•ËøáÊù•ÔºüÁ≠îÔºöÁ®ãÂ∫è‰∏≠ÁöÑÂêçËØç Á∫øÁ®ãÂíåÂçèÁ®ãÂêÑÊòØ‰ªÄ‰πàÊÑèÊÄùÔºüÁ≠îÔºöÊúâÊ≤°ÊúâÁúãËøáMySQLÊ∫êÁ†ÅÔºüÈÇ£‰∏ª‰ªéÂêåÊ≠•ÁöÑÂ∫ïÂ±ÇÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºüÂ∫ïÂ±ÇÁöÑÁΩëÁªú‰º†ËæìÊ®°ÂºèÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºüÁ≠îÔºöinnobackupexÊØîÂÜ∑Êã∑Ë¥ùÁöÑ‰ºòÂäøÊòØ‰ªÄ‰πàÔºüÁ≠îÔºöÊï∞ÊçÆÂ∫ìÁöÑRCÂíåRR‰∫ãÂä°Á∫ßÂà´Âå∫Âà´ÊòØ‰ªÄ‰πàÔºüÁ≠îÔºöMySQL ÁöÑ SQLÂÆ°Ê†∏ÊÄé‰πàÂÅöÔºüÁ≠îÔºöÁõëÊéßÊÄé‰πàÂÅöÁöÑÔºüÈÉΩÁõëÊéßÂì™‰∫õÊåáÊ†áÔºüÁ≠îÔºöÁ≥ªÁªüÊÄé‰πà‰ºòÂåñÔºüÁ≠îÔºöMySQL GTIDÂ§çÂà∂Êó∂ÂÄôÔºåÂèëÁîüÈóÆÈ¢òÔºåÂø´ÈÄüËß£ÂÜ≥„ÄÇ‰∏∫‰Ωï‰∏çÁî®Êâæbinlog file numberÂíå binlogbpositionÁÇπ„ÄÇÂ∞±ËÉΩÁõ¥Êé•change master to NewMaster ÔºüÁ≠îÔºöÂ∑•‰Ωú‰∏≠Âá∫Áé∞ÊïÖÈöúÔºå‰Ω†ÁöÑÂà§Êñ≠Â§ÑÁêÜÊÄùË∑ØÊòØ‰ªÄ‰πàÔºüÁ≠îÔºöÊúçÂä°Âô®Êú∫Âô®Á™ÅÁÑ∂Ê≠ªÊú∫ÈáçÂêØÔºåÊÄé‰πàÊéíÊü•ÈóÆÈ¢òÔºüÁ≠îÔºöÁªüËÆ°‰∏Ä‰∏™logÊó•ÂøóÊñá‰ª∂‰∏≠ÔºåÊúÄÂêé‰∏Ä‰∏™Â≠óÊÆµÊòØÊâãÊú∫Âè∑ÔºåÂèñÊâãÊú∫Âè∑ÁöÑÊúÄÂêéÂõõ‰ΩçÊï∞Â≠óÁªüËÆ°Âá∫Áé∞ÁöÑÊ¨°Êï∞ÔºåÂÄíÂ∫èÁé∞ÂÆûÊâìÂç∞Âá∫Êù•„ÄÇÁ≠îÔºöMySQL ÂçäÂêåÊ≠•‰ºö‰∏¢Êï∞ÊçÆÂêóÔºüÁ≠îÔºöMySQL ‰∏ª‰ªéÂéüÁêÜÔºåÊòØ‰∏ªÊé®ÈÄÅbinlogËøòÊòØ‰ªéËé∑ÂèñbinlogÔºüÁ≠îÔºöÊÄé‰πàÂÅöÊâçËÉΩ‰øùËØÅMySQL ‰∏ç‰∏¢Êï∞ÊçÆÔºüÁ≠îÔºöMySQL IBP‰∏≠ÁöÑLRUÁöÑÂéüÁêÜÁ≠îÔºöph-ost ÂÆûÁé∞ÂéüÁêÜÁ≠îÔºöpt-oscÂíågh-ost ÁöÑÂå∫Âà´Á≠îÔºöMHA Êû∂ÊûÑ‰∏≠ÊúâÊ≤°ÊúâÂÅö‰∫åÊ¨°ÂºÄÂèëÔºüMHAÊúâ‰ªÄ‰πàÁº∫ÁÇπÔºüÂú®‰ΩøÁî®MHAÊû∂ÊûÑÔºåÁΩëÁªúÊäñÂä®‰∫ÜÂèëÁîüÂàáÊç¢‰∫ÜÊÄé‰πàÂäûÔºüÊÄé‰πàÈò≤Ê≠¢Ëøô‰∏™ÈóÆÈ¢òÂèëÁîüÔºüÁ≠îÔºöMySQL Ê∏ÖÈô§‰∏â‰∏™Â∞èÊó∂ÁöÑbinlogÔºüÁ≠îÔºö1mysql> PURGE MASTER LOGS BEFORE DATE_SUB(NOW(), INTERVAL 3 HOUR); MySQL binlogÊñá‰ª∂ÈáåÈù¢ÈÉΩÊúâ‰ªÄ‰πàÂÜÖÂÆπÔºüÁ≠îÔºöbinlogÁî±‰∏ÄÁ≥ªÂàóÁöÑbinlog eventÊûÑÊàê„ÄÇÊØè‰∏™binlog eventÂåÖÂê´headerÂíådata‰∏§ÈÉ®ÂàÜ„ÄÇ headerÈÉ®ÂàÜÊèê‰æõÁöÑÊòØeventÁöÑÂÖ¨ÂÖ±ÁöÑÁ±ªÂûã‰ø°ÊÅØÔºåÂåÖÊã¨eventÁöÑÂàõÂª∫Êó∂Èó¥ÔºåÊúçÂä°Âô®Á≠âÁ≠â„ÄÇ dataÈÉ®ÂàÜÊèê‰æõÁöÑÊòØÈíàÂØπËØ•eventÁöÑÂÖ∑‰Ωì‰ø°ÊÅØÔºåÂ¶ÇÂÖ∑‰ΩìÊï∞ÊçÆÁöÑ‰øÆÊîπ ‰ªémysql5.0ÁâàÊú¨ÂºÄÂßãÔºåbinlogÈááÁî®ÁöÑÊòØv4ÁâàÊú¨ÔºåÁ¨¨‰∏Ä‰∏™eventÈÉΩÊòØformat_desc event Áî®‰∫éÊèèËø∞binlogÊñá‰ª∂ÁöÑÊ†ºÂºèÁâàÊú¨ÔºåËøô‰∏™Ê†ºÂºèÂ∞±ÊòØeventÂÜôÂÖ•binlogÊñá‰ª∂ÁöÑÊ†ºÂºè„ÄÇÂÖ≥‰∫é‰πãÂâçÁâàÊú¨ÁöÑbinlogÊ†ºÂºèÔºåÂèØ‰ª•ÂèÇËßÅbinary-log-versionsÊé•‰∏ãÊù•ÁöÑeventÂ∞±ÊòØÊåâÁÖß‰∏äÈù¢ÁöÑÊ†ºÂºèÁâàÊú¨ÂÜôÂÖ•ÁöÑeventÊúÄÂêé‰∏Ä‰∏™rotate eventÁî®‰∫éËØ¥Êòé‰∏ã‰∏Ä‰∏™binlogÊñá‰ª∂„ÄÇbinlogÁ¥¢ÂºïÊñá‰ª∂ÊòØ‰∏Ä‰∏™ÊñáÊú¨Êñá‰ª∂ÔºåÂÖ∂‰∏≠ÂÜÖÂÆπ‰∏∫ÂΩìÂâçÁöÑbinlogÊñá‰ª∂ÂàóË°®„ÄÇÊØîÂ¶Ç‰∏ãÈù¢Â∞±ÊòØ‰∏Ä‰∏™mysql-bin.indexÊñá‰ª∂ÁöÑÂÜÖÂÆπ„ÄÇÊé•‰∏ãÊù•ÂàÜÊûê‰∏ãÂá†ÁßçÂ∏∏ËßÅÁöÑeventÔºåÂÖ∂‰ªñÁöÑeventÁ±ªÂûãÂèØ‰ª•ÂèÇËßÅÂÆòÊñπÊñáÊ°£„ÄÇ format_desc event ‰∏ãÈù¢ÊòØÊàëÂú®FLUSH LOGS‰πãÂêéÊñ∞Âª∫ÁöÑ‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑbinlogÊñá‰ª∂mysql-bin.000053Ôºå‰ªébinlogÁ¨¨‰∏Ä‰∏™event‰πüÂ∞±ÊòØformat_desc eventÂºÄÂßãÂàÜÊûê ÂâçÈù¢4‰∏™Â≠óËäÇÊòØÂõ∫ÂÆöÁöÑmagic number,ÂÄº‰∏∫0x6e6962fe„ÄÇÊé•ÁùÄÊòØ‰∏Ä‰∏™format_desc eventÔºåÂÖàÁúã‰∏ã19‰∏™Â≠óËäÇÁöÑheader„ÄÇËøô19‰∏™Â≠óËäÇ‰∏≠Ââç4‰∏™Â≠óËäÇ0x567fb2b8ÊòØÊó∂Èó¥Êà≥ÔºåÁ¨¨5‰∏™Â≠óËäÇ0x0fÊòØevent typeÔºåÊé•ÁùÄ4‰∏™Â≠óËäÇ0x00000004ÊòØserver_idÔºåÂÜçÊé•ÁùÄ4‰∏™Â≠óËäÇ0x00000067ÊòØÈïøÂ∫¶103ÔºåÁÑ∂ÂêéÁöÑ4‰∏™Â≠óËäÇ0x0000006bÊòØ‰∏ã‰∏Ä‰∏™eventÁöÑËµ∑Âßã‰ΩçÁΩÆ107ÔºåÊé•ÁùÄÁöÑ2‰∏™Â≠óËäÇÁöÑ0x0001ÊòØflagÔºà1‰∏∫LOG_EVENT_BINLOG_IN_USE_FÔºåÊ†áËØÜbinlogËøòÊ≤°ÊúâÂÖ≥Èó≠ÔºåbinlogÂÖ≥Èó≠ÂêéÔºåflag‰ºöË¢´ËÆæÁΩÆ‰∏∫0ÔºâÔºåËøôÊ†∑4+1+4+4+4+2=19‰∏™Â≠óËäÇÁöÑÂÖ¨ÂÖ±Â§¥Â∞±ÂÆå‰∫Ü(extra_headersÊöÇÊó∂Ê≤°ÊúâÁî®Âà∞)„ÄÇÁÑ∂ÂêéÊòØËøô‰∏™eventÁöÑdataÈÉ®ÂàÜÔºåeventÁöÑdataÂàÜ‰∏∫Fixed dataÂíåVariable data‰∏§ÈÉ®ÂàÜÔºåÂÖ∂‰∏≠Fixed dataÊòØeventÁöÑÂõ∫ÂÆöÈïøÂ∫¶ÂíåÊ†ºÂºèÁöÑÊï∞ÊçÆÔºåVariable dataÂàôÊòØÈïøÂ∫¶ÂèòÂåñÁöÑÊï∞ÊçÆÔºåÊØîÂ¶Çformat_desc eventÁöÑFixed dataÈïøÂ∫¶ÊòØ0x54=84‰∏™Â≠óËäÇ„ÄÇ‰∏ãÈù¢Áúã‰∏ãËøô84=2+50+4+1+27‰∏™Â≠óËäÇÁöÑÂàÜÈÖçÔºöÂºÄÂßãÁöÑ2‰∏™Â≠óËäÇ0x0004‰∏∫binlogÁöÑÁâàÊú¨Âè∑4ÔºåÊé•ÁùÄÁöÑ50‰∏™Â≠óËäÇ‰∏∫mysql-serverÁâàÊú¨ÔºåÂ¶ÇÊàëÁöÑÁâàÊú¨ÊòØ5.5.46-0ubuntu0.14.04.2-logÔºå‰∏éSELECT version();Êü•ÁúãÁöÑÁªìÊûú‰∏ÄËá¥„ÄÇÊé•‰∏ãÊù•4‰∏™Â≠óËäÇÊòØbinlogÂàõÂª∫Êó∂Èó¥ÔºåËøôÈáåÊòØ0ÔºõÁÑ∂ÂêéÁöÑ1‰∏™Â≠óËäÇ0x13ÊòØÊåá‰πãÂêéÊâÄÊúâeventÁöÑÂÖ¨ÂÖ±Â§¥ÈïøÂ∫¶ÔºåËøôÈáåÈÉΩÊòØ19ÔºõÊé•ÁùÄÁöÑ27‰∏™Â≠óËäÇ‰∏≠ÊØè‰∏™Â≠óËäÇ‰∏∫mysqlÂ∑≤Áü•ÁöÑeventÔºàÂÖ±27‰∏™ÔºâÁöÑFixed dataÁöÑÈïøÂ∫¶ÔºõÂèØ‰ª•ÂèëÁé∞format_desc eventËá™Ë∫´ÁöÑVariable dataÈÉ®ÂàÜ‰∏∫Á©∫„ÄÇ rotate event Êé•ÁùÄÊàë‰ª¨‰∏çÂÅöÈ¢ùÂ§ñÊìç‰ΩúÔºåÁõ¥Êé•FLUSH LOGSÔºåÂèØ‰ª•ÁúãÂà∞‰∏Ä‰∏™rotate eventÔºåÈô§‰∫Üformat_desc eventÁöÑflag‰ªé0x0001ÂèòÊàê‰∫Ü0x0000„ÄÇÁÑ∂Âêé‰ªé0x567fb3c2ÂºÄÂßãÊòØ‰∏Ä‰∏™rotate event„ÄÇ‰æùÁÖßÂâçÈù¢ÁöÑÂàÜÊûêÔºåÂâçÈù¢19‰∏™Â≠óËäÇ‰∏∫eventÁöÑheaderÔºåÂÖ∂event typeÊòØ0x04ÔºåÈïøÂ∫¶‰∏∫0x2b=43Ôºå‰∏ã‰∏Ä‰∏™eventËµ∑Âßã‰ΩçÁΩÆ‰∏∫0x96=150ÔºåÁÑ∂ÂêéÊòØflag‰∏∫0x0000ÔºåÊé•ÁùÄÊòØevent dataÈÉ®ÂàÜÔºåÈ¶ñÂÖàÁöÑ8‰∏™Â≠óËäÇ‰∏∫Fixed dataÈÉ®ÂàÜÔºåËÆ∞ÂΩïÁöÑÊòØ‰∏ã‰∏Ä‰∏™binlogÁöÑ‰ΩçÁΩÆÂÅèÁßª4ÔºåËÄå‰Ωô‰∏ãÊù•ÁöÑ43-19-8=16‰∏™Â≠óËäÇ‰∏∫Variable dataÈÉ®ÂàÜÔºåËÆ∞ÂΩïÁöÑÊòØ‰∏ã‰∏Ä‰∏™binlogÁöÑÊñá‰ª∂Âêçmysql-bin.000054„ÄÇÂØπÁÖßmysqlbinlog -vv mysql-bin.000053ÂèØ‰ª•È™åËØÅ„ÄÇ query event Âà∑Êñ∞binlogÔºåËÆæÁΩÆbinlog_format=statementÔºåÂàõÂª∫‰∏Ä‰∏™Ë°®CREATE TABLEtt(ivarchar(100) DEFAULT NULL) ENGINE=InnoDB, ÁÑ∂ÂêéÂú®ÊµãËØïË°®tt‰∏≠ÊèíÂÖ•‰∏ÄÊù°Êï∞ÊçÆinsert into tt values(‚Äòabc‚Äô)Ôºå‰ºö‰∫ßÁîü3‰∏™eventÔºåÂåÖÊã¨2‰∏™query eventÂíå1‰∏™xid event„ÄÇÂÖ∂‰∏≠2‰∏™query eventÂàÜÂà´ÊòØBEGIN‰ª•ÂèäINSERT ËØ≠Âè•ÔºåËÄåxid eventÂàôÊòØ‰∫ãÂä°Êèê‰∫§ËØ≠Âè•Ôºàxid eventÊòØÊîØÊåÅXAÁöÑÂ≠òÂÇ®ÂºïÊìéÊâçÊúâÁöÑÔºåÂõ†‰∏∫ÊµãËØïË°®ttÊòØinnodbÂºïÊìéÁöÑÔºåÊâÄ‰ª•‰ºöÊúâ„ÄÇÂ¶ÇÊûúÊòØmyisamÂºïÊìéÁöÑË°®Ôºå‰πü‰ºöÊúâBEGINÂíåCOMMIT,Âè™‰∏çËøáCOMMIT‰ºöÊòØ‰∏Ä‰∏™query eventËÄå‰∏çÊòØxid eventÔºâ„ÄÇ ÊäõÂºÄformat_desc eventÔºå‰ªé0000006bÂºÄÂßãÂàÜÊûêÁ¨¨‰∏Ä‰∏™query event„ÄÇÂ§¥ÈÉ®Ë∑ü‰πãÂâçÁöÑevent‰∏ÄÊ†∑ÔºåÂè™ÊòØquery eventÁöÑtype‰∏∫0x02ÔºåÈïøÂ∫¶‰∏∫0x44=64Ôºå‰∏ã‰∏Ä‰∏™event‰ΩçÁΩÆ‰∏∫0xaf=175„ÄÇflag‰∏∫8ÔºåÊé•ÁùÄÊòØdataÈÉ®ÂàÜÔºå‰ªéformat_desc eventÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅìquery eventÁöÑFixed dataÈÉ®ÂàÜ‰∏∫13‰∏™Â≠óËäÇÔºåÂõ†Ê≠§‰πüÂèØ‰ª•ÁÆóÂá∫Variable dataÈÉ®ÂàÜ‰∏∫64-19-13=32Â≠óËäÇ„ÄÇ Fixed dataÔºöÈ¶ñÂÖàÁöÑ4‰∏™Â≠óËäÇ0x00000026‰∏∫ÊâßË°åËØ•ËØ≠Âè•ÁöÑthread idÔºåÊé•‰∏ãÊù•ÁöÑ4‰∏™Â≠óËäÇÊòØÊâßË°åÁöÑÊó∂Èó¥0(‰ª•Áßí‰∏∫Âçï‰Ωç)ÔºåÊé•‰∏ãÊù•ÁöÑ1‰∏™Â≠óËäÇ0x04ÊòØËØ≠Âè•ÊâßË°åÊó∂ÁöÑÈªòËÆ§Êï∞ÊçÆÂ∫ìÂêçÂ≠óÁöÑÈïøÂ∫¶ÔºåÊàëËøôÈáåÊï∞ÊçÆÂ∫ìÊòØtestÔºåÊâÄ‰ª•ÈïøÂ∫¶‰∏∫4.Êé•ÁùÄÁöÑ2‰∏™Â≠óËäÇ0x0000ÊòØÈîôËØØÁ†ÅÔºàÊ≥®ÔºöÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÈîôËØØÁ†ÅÊòØ0Ë°®Á§∫Ê≤°ÊúâÈîôËØØÔºå‰ΩÜÊòØÂú®‰∏Ä‰∫õÈùû‰∫ãÂä°ÊÄßË°®Â¶ÇmyisamË°®ÊâßË°åINSERT‚Ä¶SELECTËØ≠Âè•Êó∂ÂèØËÉΩÊèíÂÖ•ÈÉ®ÂàÜÊï∞ÊçÆÂêéÈÅáÂà∞duplicate-keyÈîôËØØ‰ºö‰∫ßÁîüÈîôËØØÁ†Å1062ÔºåÊàñËÄÖÊòØ‰∫ãÂä°ÊÄßË°®Âú®INSERT‚Ä¶SELECTÂá∫Èîô‰∏ç‰ºöÊèíÂÖ•ÈÉ®ÂàÜÊï∞ÊçÆÔºå‰ΩÜÊòØÂú®ÊâßË°åËøáÁ®ã‰∏≠CTRL+CÁªàÊ≠¢ËØ≠Âè•‰πüÂèØËÉΩËÆ∞ÂΩïÈîôËØØÁ†Å„ÄÇslave dbÂú®Â§çÂà∂Êó∂‰ºöÊâßË°åÂêéÊ£ÄÊü•ÈîôËØØÁ†ÅÊòØÂê¶‰∏ÄËá¥ÔºåÂ¶ÇÊûú‰∏ç‰∏ÄËá¥ÔºåÂàôÂ§çÂà∂ËøáÁ®ã‰ºö‰∏≠Ê≠¢Ôºâ,Êé•ÁùÄ2‰∏™Â≠óËäÇ0x001a‰∏∫Áä∂ÊÄÅÂèòÈáèÂùóÁöÑÈïøÂ∫¶26„ÄÇ Variable dataÔºö‰ªé0x001a‰πãÂêéÁöÑ26‰∏™Â≠óËäÇ‰∏∫Áä∂ÊÄÅÂèòÈáèÂùóÔºàËøô‰∏™ÊöÇÊó∂ÂÖà‰∏çÁÆ°ÔºâÔºåÁÑ∂ÂêéÊòØÈªòËÆ§Êï∞ÊçÆÂ∫ìÂêçtestÔºå‰ª•0x00ÁªìÂ∞æÔºåÁÑ∂ÂêéÊòØsqlËØ≠Âè•BEGINÔºåÊé•‰∏ãÊù•Â∞±ÊòØÁ¨¨2‰∏™query eventÁöÑÂÜÖÂÆπ‰∫Ü„ÄÇ Á¨¨‰∫å‰∏™query event‰∏éÁ¨¨‰∏Ä‰∏™Ê†ºÂºè‰∏ÄÊ†∑ÔºåÂè™ÊòØÊâßË°åËØ≠Âè•ÂèòÊàê‰∫Üinsert into tt values(‚Äòabc‚Äô)„ÄÇ Á¨¨‰∏â‰∏™xid event‰∏∫COMMITËØ≠Âè•„ÄÇÂâç19‰∏™Â≠óËäÇÊòØÈÄöÁî®Â§¥ÈÉ®ÔºåtypeÊòØ16„ÄÇdataÈÉ®ÂàÜ‰∏≠Fixed data‰∏∫Á©∫ÔºåËÄåvariable data‰∏∫8‰∏™Â≠óËäÇÔºåËøô8‰∏™Â≠óËäÇ0x000000008aÊòØ‰∫ãÂä°ÁºñÂè∑ÔºàÊ≥®ÊÑè‰∫ãÂä°ÁºñÂè∑‰∏ç‰∏ÄÂÆöÊòØÂ∞èÁ´ØÂ≠óËäÇÂ∫èÔºåÂõ†‰∏∫ÊòØ‰ªéÂÜÖÂ≠ò‰∏≠Êã∑Ë¥ùÂà∞Á£ÅÁõòÁöÑÔºåÊâÄ‰ª•Ëøô‰∏™Â≠óËäÇÂ∫èË∑üÊú∫Âô®Áõ∏ÂÖ≥Ôºâ„ÄÇ 0x0000006b-0x000000ae‰∏∫query eventÔºåËØ≠Âè•ÊòØBEGIN,ÂâçÈù¢Â∑≤ÁªèÂàÜÊûêËøá„ÄÇ table_map event 0x0000000afÂºÄÂßã‰∏∫table_map event„ÄÇÈô§ÂéªÂ§¥ÈÉ®19‰∏™Â≠óËäÇÔºåFixed data‰∏∫8‰∏™Â≠óËäÇÔºåÂâçÈù¢6‰∏™Â≠óËäÇ0x32=50‰∏∫table idÔºåÊé•ÁùÄ2‰∏™Â≠óËäÇ0x0001‰∏∫flags„ÄÇ Variable dataÈÉ®ÂàÜÔºåÈ¶ñÂÖà1‰∏™Â≠óËäÇ0x04‰∏∫Êï∞ÊçÆÂ∫ìÂêçtestÁöÑÈïøÂ∫¶ÔºåÁÑ∂Âêé5‰∏™Â≠óËäÇÊòØÊï∞ÊçÆÂ∫ìÂêçtest+ÁªìÊùüÁ¨¶„ÄÇÊé•ÁùÄ1‰∏™Â≠óËäÇ0x04‰∏∫Ë°®ÂêçÈïøÂ∫¶ÔºåÊé•ÁùÄ5‰∏™Â≠óËäÇ‰∏∫Ë°®Âêçtrow+ÁªìÊùüÁ¨¶„ÄÇÊé•ÁùÄ1‰∏™Â≠óËäÇ0x02‰∏∫ÂàóÁöÑÊï∞ÁõÆ„ÄÇËÄåÂêéÊòØ2‰∏™ÂàóÁöÑÁ±ªÂûãÂÆö‰πâÔºåÂàÜÂà´ÊòØ0x03Âíå0x0fÔºàÂàóÁöÑÁ±ªÂûãMYSQL_TYPE_LONG‰∏∫0x03ÔºåMYSQL_TYPE_VARCHAR‰∏∫0x0f)„ÄÇÊé•ÁùÄÊòØÂàóÁöÑÂÖÉÊï∞ÊçÆÂÆö‰πâÔºåÈ¶ñÂÖà0x02Ë°®Á§∫ÂÖÉÊï∞ÊçÆÈïøÂ∫¶‰∏∫2ÔºåÂõ†‰∏∫MYSQL_TYPE_LONGÊ≤°ÊúâÂÖÉÊï∞ÊçÆÔºåËÄåMYSQL_TYPE_VARCHARÂÖÉÊï∞ÊçÆÈïøÂ∫¶‰∏∫2„ÄÇÊé•ÁùÄÁöÑ0x000aÂ∞±ÊòØMYSQL_TYPE_VARCHARÁöÑÂÖÉÊï∞ÊçÆÔºåË°®Á§∫Êàë‰ª¨Âú®ÂÆö‰πâË°®Êó∂ÁöÑvarcharÂ≠óÊÆµcÈïøÂ∫¶‰∏∫10ÔºåÊúÄÂêé‰∏Ä‰∏™Â≠óËäÇ0x02‰∏∫Êé©Á†ÅÔºåË°®Á§∫Á¨¨‰∏Ä‰∏™Â≠óÊÆµi‰∏çËÉΩ‰∏∫NULL„ÄÇÂÖ≥‰∫éÂàóÁöÑÁ±ªÂûã‰ª•ÂèäÂÖÉÊï∞ÊçÆÁ≠âÊõ¥ËØ¶ÁªÜÁöÑ‰ø°ÊÅØÂèØ‰ª•ÂèÇËßÅÂÆòÊñπËµÑÊñô write_rows event ‰ªé0x000000ddÂºÄÂßã‰∏∫write_rows eventÔºåÈô§ÂéªÂ§¥ÈÉ®19‰∏™Â≠óËäÇÔºåÂâç6‰∏™Â≠óËäÇ0x32‰πüÊòØtable idÔºåÁÑ∂Âêé‰∏§‰∏™Â≠óËäÇ0x0001‰∏∫flags„ÄÇÊé•ÁùÄÁöÑ1‰∏™Â≠óËäÇ0x02‰∏∫Ë°®‰∏≠ÂàóÁöÑÊï∞ÁõÆ„ÄÇÁÑ∂Âêé1‰∏™Â≠óËäÇ0xffÂêÑ‰∏™bitÊ†áËØÜÂêÑÂàóÊòØÂê¶Â≠òÂú®ÂÄºÔºåËøôÈáåË°®Á§∫ÈÉΩÂ≠òÂú®„ÄÇ Êé•ÁùÄÁöÑÂ∞±ÊòØÊèíÂÖ•ÁöÑÂêÑË°åÊï∞ÊçÆ‰∫Ü„ÄÇÁ¨¨1‰∏™Â≠óËäÇ0xfeÁöÑÂêÑ‰∏™bitÊ†áËØÜËØ•Ë°åÂèòÂåñ‰πãÂêéÂêÑÂàóÊòØÂê¶‰∏∫NULLÔºå‰∏∫NULLËÆ∞‰∏∫1.ËøôÈáåË°®Á§∫Á¨¨1Âàó‰∏ç‰∏∫NULLÔºåÂõ†‰∏∫Á¨¨‰∏ÄË°åÊï∞ÊçÆÊèíÂÖ•ÁöÑÊòØ(1,NULL)„ÄÇÊé•‰∏ãÊù•ÊòØÂêÑÂàóÁöÑÊï∞ÊçÆÔºåÁ¨¨‰∏ÄÂàóÊòØMYSQL_TYPE_LONG,ÈïøÂ∫¶‰∏∫4‰∏™Â≠óËäÇÔºåÊâÄ‰ª•0x00000001Â∞±ÊòØËøô‰∏™ÂÄº„ÄÇÁ¨¨‰∫åÂàóÊòØNULL‰∏çÂç†Â≠óËäÇ„ÄÇÊé•‰∏ãÊù•ÊòØÁ¨¨‰∫åË°åÔºåÂÖàÊòØ0xfcÊ†áËØÜ‰∏§ÂàóÈÉΩ‰∏ç‰∏∫NULLÔºåÂÖàËØªÂèñÁ¨¨‰∏ÄÂàóÁöÑ4‰∏™Â≠óËäÇ0x00000002‰πüÂ∞±ÊòØÊàë‰ª¨ÊèíÂÖ•ÁöÑÊï∞Â≠ó2ÔºåÁÑ∂ÂêéËØªÂèñÁ¨¨‰∫åÂàóÔºåÂÖàÊòØ‰∏Ä‰∏™Â≠óËäÇÁöÑÈïøÂ∫¶0x01ÔºåÁÑ∂ÂêéÊòØÂÜÖÂÆπ0x61‰πüÂ∞±ÊòØÂ≠óÁ¨¶‚Äôa‚Äô„ÄÇÂà∞Ê≠§Ôºåwrite_rows event‰πüÂ∞±ÂàÜÊûêÂÆå‰∫Ü„ÄÇrowsÁõ∏ÂÖ≥ÁöÑeventËøòÊúâupdate_rows eventÂíådelete_rows eventÁ≠âÔºåÊ¨≤‰∫ÜËß£Êõ¥Â§öÂèØ‰ª•ÂèÇËßÅÂÆòÊñπÊñáÊ°£„ÄÇ intvar event intvar eventÂú®binlog_format=statementÊó∂‰ΩøÁî®Âà∞ÔºåÁî®‰∫éËá™Â¢ûÈîÆÁ±ªÂûãauto_incrementÔºåÂçÅÂàÜÈáçË¶Å„ÄÇintval eventÁöÑFixed dataÈÉ®ÂàÜ‰∏∫Á©∫ÔºåËÄåVariable dataÈÉ®ÂàÜ‰∏∫9‰∏™Â≠óËäÇÔºåÁ¨¨1‰∏™Â≠óËäÇÁî®‰∫éÊ†áËØÜËá™Â¢û‰∫ã‰ª∂Á±ªÂûã LAST_INSERT_ID_EVENT = 1 or INSERT_ID_EVENT = 2Ôºå‰Ωô‰∏ãÁöÑ8‰∏™Â≠óËäÇ‰∏∫Ëá™Â¢ûID„ÄÇ ÂàõÂª∫‰∏Ä‰∏™ÊµãËØïË°® create table tinc (i int auto_increment primary key, c varchar(10)) engine=innodb;ÔºåÁÑ∂ÂêéÊâßË°å‰∏Ä‰∏™ÊèíÂÖ•ËØ≠Âè•INSERT INTO tinc(c) values(‚Äòabc‚Äô);Â∞±ÂèØ‰ª•ÁúãÂà∞intvar event‰∫ÜÔºåËøôÈáåÁöÑËá™Â¢û‰∫ã‰ª∂Á±ªÂûã‰∏∫INSERT_ID_EVENT„ÄÇËÄåÂ¶ÇÊûúÁî®ËØ≠Âè•INSERT INTO tinc(i, c) VALUES(LAST_INSERT_ID()+1, ‚Äòabc‚Äô)ÔºåÂàôÂèØ‰ª•ÁúãÂà∞Ëá™Â¢û‰∫ã‰ª∂Á±ªÂûã‰∏∫LAST_INSERT_ID_EVENTÁöÑintvar event„ÄÇ ÂèÇËÄÉËµÑÊñô‰∏∫ÂÆòÊñπËµÑÊñô Êï∞ÊçÆÂ∫ìÂä†ÈîÅÊòØ‰ªÄ‰πàÊ†∑ÁöÑÊµÅÁ®ãÔºüÁ≠îÔºöË°®Á∫ßÈîÅÂÆöÔºàtable-levelÔºâ* Ë°®Á∫ßÂà´ÁöÑÈîÅÂÆöÊòØMySQLÂêÑÂ≠òÂÇ®ÂºïÊìé‰∏≠ÊúÄÂ§ßÈ¢óÁ≤íÂ∫¶ÁöÑÈîÅÂÆöÊú∫Âà∂„ÄÇËØ•ÈîÅÂÆöÊú∫Âà∂ÊúÄÂ§ßÁöÑÁâπÁÇπÊòØÂÆûÁé∞ÈÄªËæëÈùûÂ∏∏ÁÆÄÂçïÔºåÂ∏¶Êù•ÁöÑÁ≥ªÁªüË¥üÈù¢ÂΩ±ÂìçÊúÄÂ∞è„ÄÇÊâÄ‰ª•Ëé∑ÂèñÈîÅÂíåÈáäÊîæÈîÅÁöÑÈÄüÂ∫¶ÂæàÂø´„ÄÇÁî±‰∫éË°®Á∫ßÈîÅ‰∏ÄÊ¨°‰ºöÂ∞ÜÊï¥‰∏™Ë°®ÈîÅÂÆöÔºåÊâÄ‰ª•ÂèØ‰ª•ÂæàÂ•ΩÁöÑÈÅøÂÖçÂõ∞Êâ∞Êàë‰ª¨ÁöÑÊ≠ªÈîÅÈóÆÈ¢ò„ÄÇÂΩìÁÑ∂ÔºåÈîÅÂÆöÈ¢óÁ≤íÂ∫¶Â§ßÊâÄÂ∏¶Êù•ÊúÄÂ§ßÁöÑË¥üÈù¢ÂΩ±ÂìçÂ∞±ÊòØÂá∫Áé∞ÈîÅÂÆöËµÑÊ∫ê‰∫âÁî®ÁöÑÊ¶ÇÁéá‰πü‰ºöÊúÄÈ´òÔºåËá¥‰ΩøÂπ∂Â§ßÂ∫¶Â§ßÊâìÊäòÊâ£„ÄÇ‰ΩøÁî®Ë°®Á∫ßÈîÅÂÆöÁöÑ‰∏ªË¶ÅÊòØMyISAMÔºåMEMORYÔºåCSVÁ≠â‰∏Ä‰∫õÈùû‰∫ãÂä°ÊÄßÂ≠òÂÇ®ÂºïÊìé„ÄÇ Ë°åÁ∫ßÈîÅÂÆöÔºàrow-levelÔºâ* Ë°åÁ∫ßÈîÅÂÆöÊúÄÂ§ßÁöÑÁâπÁÇπÂ∞±ÊòØÈîÅÂÆöÂØπË±°ÁöÑÈ¢óÁ≤íÂ∫¶ÂæàÂ∞èÔºå‰πüÊòØÁõÆÂâçÂêÑÂ§ßÊï∞ÊçÆÂ∫ìÁÆ°ÁêÜËΩØ‰ª∂ÊâÄÂÆûÁé∞ÁöÑÈîÅÂÆöÈ¢óÁ≤íÂ∫¶ÊúÄÂ∞èÁöÑ„ÄÇÁî±‰∫éÈîÅÂÆöÈ¢óÁ≤íÂ∫¶ÂæàÂ∞èÔºåÊâÄ‰ª•ÂèëÁîüÈîÅÂÆöËµÑÊ∫ê‰∫âÁî®ÁöÑÊ¶ÇÁéá‰πüÊúÄÂ∞èÔºåËÉΩÂ§üÁªô‰∫àÂ∫îÁî®Á®ãÂ∫èÂ∞ΩÂèØËÉΩÂ§ßÁöÑÂπ∂ÂèëÂ§ÑÁêÜËÉΩÂäõËÄåÊèêÈ´ò‰∏Ä‰∫õÈúÄË¶ÅÈ´òÂπ∂ÂèëÂ∫îÁî®Á≥ªÁªüÁöÑÊï¥‰ΩìÊÄßËÉΩ„ÄÇËôΩÁÑ∂ËÉΩÂ§üÂú®Âπ∂ÂèëÂ§ÑÁêÜËÉΩÂäõ‰∏äÈù¢ÊúâËæÉÂ§ßÁöÑ‰ºòÂäøÔºå‰ΩÜÊòØË°åÁ∫ßÈîÅÂÆö‰πüÂõ†Ê≠§Â∏¶Êù•‰∫Ü‰∏çÂ∞ëÂºäÁ´Ø„ÄÇÁî±‰∫éÈîÅÂÆöËµÑÊ∫êÁöÑÈ¢óÁ≤íÂ∫¶ÂæàÂ∞èÔºåÊâÄ‰ª•ÊØèÊ¨°Ëé∑ÂèñÈîÅÂíåÈáäÊîæÈîÅÈúÄË¶ÅÂÅöÁöÑ‰∫ãÊÉÖ‰πüÊõ¥Â§öÔºåÂ∏¶Êù•ÁöÑÊ∂àËÄóËá™ÁÑ∂‰πüÂ∞±Êõ¥Â§ß‰∫Ü„ÄÇÊ≠§Â§ñÔºåË°åÁ∫ßÈîÅÂÆö‰πüÊúÄÂÆπÊòìÂèëÁîüÊ≠ªÈîÅ„ÄÇ‰ΩøÁî®Ë°åÁ∫ßÈîÅÂÆöÁöÑ‰∏ªË¶ÅÊòØInnoDBÂ≠òÂÇ®ÂºïÊìé„ÄÇ È°µÁ∫ßÈîÅÂÆöÔºàpage-levelÔºâ* È°µÁ∫ßÈîÅÂÆöÊòØMySQL‰∏≠ÊØîËæÉÁã¨ÁâπÁöÑ‰∏ÄÁßçÈîÅÂÆöÁ∫ßÂà´ÔºåÂú®ÂÖ∂‰ªñÊï∞ÊçÆÂ∫ìÁÆ°ÁêÜËΩØ‰ª∂‰∏≠‰πüÂπ∂‰∏çÊòØÂ§™Â∏∏ËßÅ„ÄÇÈ°µÁ∫ßÈîÅÂÆöÁöÑÁâπÁÇπÊòØÈîÅÂÆöÈ¢óÁ≤íÂ∫¶‰ªã‰∫éË°åÁ∫ßÈîÅÂÆö‰∏éË°®Á∫ßÈîÅ‰πãÈó¥ÔºåÊâÄ‰ª•Ëé∑ÂèñÈîÅÂÆöÊâÄÈúÄË¶ÅÁöÑËµÑÊ∫êÂºÄÈîÄÔºå‰ª•ÂèäÊâÄËÉΩÊèê‰æõÁöÑÂπ∂ÂèëÂ§ÑÁêÜËÉΩÂäõ‰πüÂêåÊ†∑ÊòØ‰ªã‰∫é‰∏äÈù¢‰∫åËÄÖ‰πãÈó¥„ÄÇÂè¶Â§ñÔºåÈ°µÁ∫ßÈîÅÂÆöÂíåË°åÁ∫ßÈîÅÂÆö‰∏ÄÊ†∑Ôºå‰ºöÂèëÁîüÊ≠ªÈîÅ„ÄÇÂú®Êï∞ÊçÆÂ∫ìÂÆûÁé∞ËµÑÊ∫êÈîÅÂÆöÁöÑËøáÁ®ã‰∏≠ÔºåÈöèÁùÄÈîÅÂÆöËµÑÊ∫êÈ¢óÁ≤íÂ∫¶ÁöÑÂáèÂ∞èÔºåÈîÅÂÆöÁõ∏ÂêåÊï∞ÊçÆÈáèÁöÑÊï∞ÊçÆÊâÄÈúÄË¶ÅÊ∂àËÄóÁöÑÂÜÖÂ≠òÊï∞ÈáèÊòØË∂äÊù•Ë∂äÂ§öÁöÑÔºåÂÆûÁé∞ÁÆóÊ≥ï‰πü‰ºöË∂äÊù•Ë∂äÂ§çÊùÇ„ÄÇ‰∏çËøáÔºåÈöèÁùÄÈîÅÂÆöËµÑÊ∫êÈ¢óÁ≤íÂ∫¶ÁöÑÂáèÂ∞èÔºåÂ∫îÁî®Á®ãÂ∫èÁöÑËÆøÈóÆËØ∑Ê±ÇÈÅáÂà∞ÈîÅÁ≠âÂæÖÁöÑÂèØËÉΩÊÄß‰πü‰ºöÈöè‰πãÈôç‰ΩéÔºåÁ≥ªÁªüÊï¥‰ΩìÂπ∂ÂèëÂ∫¶‰πüÈöè‰πãÊèêÂçá„ÄÇ‰ΩøÁî®È°µÁ∫ßÈîÅÂÆöÁöÑ‰∏ªË¶ÅÊòØBerkeleyDBÂ≠òÂÇ®ÂºïÊìé„ÄÇ ÊÄªÁöÑÊù•ËØ¥ÔºåMySQLËøô3ÁßçÈîÅÁöÑÁâπÊÄßÂèØÂ§ßËá¥ÂΩíÁ∫≥Â¶Ç‰∏ãÔºö Ë°®Á∫ßÈîÅÔºöÂºÄÈîÄÂ∞èÔºåÂä†ÈîÅÂø´Ôºõ‰∏ç‰ºöÂá∫Áé∞Ê≠ªÈîÅÔºõÈîÅÂÆöÁ≤íÂ∫¶Â§ßÔºåÂèëÁîüÈîÅÂÜ≤Á™ÅÁöÑÊ¶ÇÁéáÊúÄÈ´òÔºåÂπ∂ÂèëÂ∫¶ÊúÄ‰ΩéÔºõ Ë°åÁ∫ßÈîÅÔºöÂºÄÈîÄÂ§ßÔºåÂä†ÈîÅÊÖ¢Ôºõ‰ºöÂá∫Áé∞Ê≠ªÈîÅÔºõÈîÅÂÆöÁ≤íÂ∫¶ÊúÄÂ∞èÔºåÂèëÁîüÈîÅÂÜ≤Á™ÅÁöÑÊ¶ÇÁéáÊúÄ‰ΩéÔºåÂπ∂ÂèëÂ∫¶‰πüÊúÄÈ´òÔºõ È°µÈù¢ÈîÅÔºöÂºÄÈîÄÂíåÂä†ÈîÅÊó∂Èó¥Áïå‰∫éË°®ÈîÅÂíåË°åÈîÅ‰πãÈó¥Ôºõ‰ºöÂá∫Áé∞Ê≠ªÈîÅÔºõÈîÅÂÆöÁ≤íÂ∫¶Áïå‰∫éË°®ÈîÅÂíåË°åÈîÅ‰πãÈó¥ÔºåÂπ∂ÂèëÂ∫¶‰∏ÄËà¨„ÄÇÈÄÇÁî®Ôºö‰ªéÈîÅÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåË°®Á∫ßÈîÅÊõ¥ÈÄÇÂêà‰∫é‰ª•Êü•ËØ¢‰∏∫‰∏ªÔºåÂè™ÊúâÂ∞ëÈáèÊåâÁ¥¢ÂºïÊù°‰ª∂Êõ¥Êñ∞Êï∞ÊçÆÁöÑÂ∫îÁî®ÔºåÂ¶ÇWebÂ∫îÁî®ÔºõËÄåË°åÁ∫ßÈîÅÂàôÊõ¥ÈÄÇÂêà‰∫éÊúâÂ§ßÈáèÊåâÁ¥¢ÂºïÊù°‰ª∂Âπ∂ÂèëÊõ¥Êñ∞Â∞ëÈáè‰∏çÂêåÊï∞ÊçÆÔºåÂêåÊó∂ÂèàÊúâÂπ∂ÂèëÊü•ËØ¢ÁöÑÂ∫îÁî®ÔºåÂ¶Ç‰∏Ä‰∫õÂú®Á∫ø‰∫ãÂä°Â§ÑÁêÜÔºàOLTPÔºâÁ≥ªÁªü„ÄÇInnoDBÈîÅÂÆöÊ®°ÂºèÂèäÂÆûÁé∞Êú∫Âà∂InnoDBÁöÑË°åÁ∫ßÈîÅÂÆöÂêåÊ†∑ÂàÜ‰∏∫‰∏§ÁßçÁ±ªÂûãÔºåÂÖ±‰∫´ÈîÅÂíåÊéí‰ªñÈîÅÔºåËÄåÂú®ÈîÅÂÆöÊú∫Âà∂ÁöÑÂÆûÁé∞ËøáÁ®ã‰∏≠‰∏∫‰∫ÜËÆ©Ë°åÁ∫ßÈîÅÂÆöÂíåË°®Á∫ßÈîÅÂÆöÂÖ±Â≠òÔºåInnoDB‰πüÂêåÊ†∑‰ΩøÁî®‰∫ÜÊÑèÂêëÈîÅÔºàË°®Á∫ßÈîÅÂÆöÔºâÁöÑÊ¶ÇÂøµÔºå‰πüÂ∞±Êúâ‰∫ÜÊÑèÂêëÂÖ±‰∫´ÈîÅÂíåÊÑèÂêëÊéí‰ªñÈîÅËøô‰∏§Áßç„ÄÇÂΩì‰∏Ä‰∏™‰∫ãÂä°ÈúÄË¶ÅÁªôËá™Â∑±ÈúÄË¶ÅÁöÑÊüê‰∏™ËµÑÊ∫êÂä†ÈîÅÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÈÅáÂà∞‰∏Ä‰∏™ÂÖ±‰∫´ÈîÅÊ≠£ÈîÅÂÆöÁùÄËá™Â∑±ÈúÄË¶ÅÁöÑËµÑÊ∫êÁöÑÊó∂ÂÄôÔºåËá™Â∑±ÂèØ‰ª•ÂÜçÂä†‰∏Ä‰∏™ÂÖ±‰∫´ÈîÅÔºå‰∏çËøá‰∏çËÉΩÂä†Êéí‰ªñÈîÅ„ÄÇ‰ΩÜÊòØÔºåÂ¶ÇÊûúÈÅáÂà∞Ëá™Â∑±ÈúÄË¶ÅÈîÅÂÆöÁöÑËµÑÊ∫êÂ∑≤ÁªèË¢´‰∏Ä‰∏™Êéí‰ªñÈîÅÂç†Êúâ‰πãÂêéÔºåÂàôÂè™ËÉΩÁ≠âÂæÖËØ•ÈîÅÂÆöÈáäÊîæËµÑÊ∫ê‰πãÂêéËá™Â∑±ÊâçËÉΩËé∑ÂèñÈîÅÂÆöËµÑÊ∫êÂπ∂Ê∑ªÂä†Ëá™Â∑±ÁöÑÈîÅÂÆö„ÄÇËÄåÊÑèÂêëÈîÅÁöÑ‰ΩúÁî®Â∞±ÊòØÂΩì‰∏Ä‰∏™‰∫ãÂä°Âú®ÈúÄË¶ÅËé∑ÂèñËµÑÊ∫êÈîÅÂÆöÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÈÅáÂà∞Ëá™Â∑±ÈúÄË¶ÅÁöÑËµÑÊ∫êÂ∑≤ÁªèË¢´Êéí‰ªñÈîÅÂç†Áî®ÁöÑÊó∂ÂÄôÔºåËØ•‰∫ãÂä°ÂèØ‰ª•ÈúÄË¶ÅÈîÅÂÆöË°åÁöÑË°®‰∏äÈù¢Ê∑ªÂä†‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊÑèÂêëÈîÅ„ÄÇÂ¶ÇÊûúËá™Â∑±ÈúÄË¶Å‰∏Ä‰∏™ÂÖ±‰∫´ÈîÅÔºåÈÇ£‰πàÂ∞±Âú®Ë°®‰∏äÈù¢Ê∑ªÂä†‰∏Ä‰∏™ÊÑèÂêëÂÖ±‰∫´ÈîÅ„ÄÇËÄåÂ¶ÇÊûúËá™Â∑±ÈúÄË¶ÅÁöÑÊòØÊüêË°åÔºàÊàñËÄÖÊüê‰∫õË°åÔºâ‰∏äÈù¢Ê∑ªÂä†‰∏Ä‰∏™Êéí‰ªñÈîÅÁöÑËØùÔºåÂàôÂÖàÂú®Ë°®‰∏äÈù¢Ê∑ªÂä†‰∏Ä‰∏™ÊÑèÂêëÊéí‰ªñÈîÅ„ÄÇÊÑèÂêëÂÖ±‰∫´ÈîÅÂèØ‰ª•ÂêåÊó∂Âπ∂Â≠òÂ§ö‰∏™Ôºå‰ΩÜÊòØÊÑèÂêëÊéí‰ªñÈîÅÂêåÊó∂Âè™ËÉΩÊúâ‰∏Ä‰∏™Â≠òÂú®„ÄÇÊâÄ‰ª•ÔºåÂèØ‰ª•ËØ¥InnoDBÁöÑÈîÅÂÆöÊ®°ÂºèÂÆûÈôÖ‰∏äÂèØ‰ª•ÂàÜ‰∏∫ÂõõÁßçÔºöÂÖ±‰∫´ÈîÅÔºàSÔºâÔºåÊéí‰ªñÈîÅÔºàXÔºâÔºåÊÑèÂêëÂÖ±‰∫´ÈîÅÔºàISÔºâÂíåÊÑèÂêëÊéí‰ªñÈîÅÔºàIXÔºâÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãË°®Ê†ºÊù•ÊÄªÁªì‰∏äÈù¢ËøôÂõõÁßçÊâÄÁöÑÂÖ±Â≠òÈÄªËæëÂÖ≥Á≥ªÔºö Â¶ÇÊûú‰∏Ä‰∏™‰∫ãÂä°ËØ∑Ê±ÇÁöÑÈîÅÊ®°Âºè‰∏éÂΩìÂâçÁöÑÈîÅÂÖºÂÆπÔºåInnoDBÂ∞±Â∞ÜËØ∑Ê±ÇÁöÑÈîÅÊéà‰∫àËØ•‰∫ãÂä°ÔºõÂèç‰πãÔºåÂ¶ÇÊûú‰∏§ËÄÖ‰∏çÂÖºÂÆπÔºåËØ•‰∫ãÂä°Â∞±Ë¶ÅÁ≠âÂæÖÈîÅÈáäÊîæ„ÄÇ ÊÑèÂêëÈîÅÊòØInnoDBËá™Âä®Âä†ÁöÑÔºå‰∏çÈúÄÁî®Êà∑Âπ≤È¢Ñ„ÄÇÂØπ‰∫éUPDATE„ÄÅDELETEÂíåINSERTËØ≠Âè•ÔºåInnoDB‰ºöËá™Âä®ÁªôÊ∂âÂèäÊï∞ÊçÆÈõÜÂä†Êéí‰ªñÈîÅÔºàX)ÔºõÂØπ‰∫éÊôÆÈÄöSELECTËØ≠Âè•ÔºåInnoDB‰∏ç‰ºöÂä†‰ªª‰ΩïÈîÅÔºõ‰∫ãÂä°ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãËØ≠Âè•ÊòæÁ§∫ÁªôËÆ∞ÂΩïÈõÜÂä†ÂÖ±‰∫´ÈîÅÊàñÊéí‰ªñÈîÅ„ÄÇ12ÂÖ±‰∫´ÈîÅÔºàSÔºâÔºöSELECT * FROM table_name WHERE ... LOCK IN SHARE MODEÊéí‰ªñÈîÅÔºàX)ÔºöSELECT * FROM table_name WHERE ... FOR UPDATE Áî®SELECT ‚Ä¶ IN SHARE MODEËé∑ÂæóÂÖ±‰∫´ÈîÅÔºå‰∏ªË¶ÅÁî®Âú®ÈúÄË¶ÅÊï∞ÊçÆ‰æùÂ≠òÂÖ≥Á≥ªÊó∂Êù•Á°ÆËÆ§ÊüêË°åËÆ∞ÂΩïÊòØÂê¶Â≠òÂú®ÔºåÂπ∂Á°Æ‰øùÊ≤°Êúâ‰∫∫ÂØπËøô‰∏™ËÆ∞ÂΩïËøõË°åUPDATEÊàñËÄÖDELETEÊìç‰Ωú„ÄÇ ‰ΩÜÊòØÂ¶ÇÊûúÂΩìÂâç‰∫ãÂä°‰πüÈúÄË¶ÅÂØπËØ•ËÆ∞ÂΩïËøõË°åÊõ¥Êñ∞Êìç‰ΩúÔºåÂàôÂæàÊúâÂèØËÉΩÈÄ†ÊàêÊ≠ªÈîÅÔºåÂØπ‰∫éÈîÅÂÆöË°åËÆ∞ÂΩïÂêéÈúÄË¶ÅËøõË°åÊõ¥Êñ∞Êìç‰ΩúÁöÑÂ∫îÁî®ÔºåÂ∫îËØ•‰ΩøÁî®SELECT‚Ä¶ FOR UPDATEÊñπÂºèËé∑ÂæóÊéí‰ªñÈîÅ„ÄÇInnoDBË°åÈîÅÂÆûÁé∞ÊñπÂºè InnoDBË°åÈîÅÊòØÈÄöËøáÁªôÁ¥¢Âºï‰∏äÁöÑÁ¥¢ÂºïÈ°πÂä†ÈîÅÊù•ÂÆûÁé∞ÁöÑÔºåÂè™ÊúâÈÄöËøáÁ¥¢ÂºïÊù°‰ª∂Ê£ÄÁ¥¢Êï∞ÊçÆÔºåInnoDBÊâç‰ΩøÁî®Ë°åÁ∫ßÈîÅÔºåÂê¶ÂàôÔºåInnoDBÂ∞Ü‰ΩøÁî®Ë°®ÈîÅ Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåË¶ÅÁâπÂà´Ê≥®ÊÑèInnoDBË°åÈîÅÁöÑËøô‰∏ÄÁâπÊÄßÔºå‰∏çÁÑ∂ÁöÑËØùÔºåÂèØËÉΩÂØºËá¥Â§ßÈáèÁöÑÈîÅÂÜ≤Á™ÅÔºå‰ªéËÄåÂΩ±ÂìçÂπ∂ÂèëÊÄßËÉΩ„ÄÇ‰∏ãÈù¢ÈÄöËøá‰∏Ä‰∫õÂÆûÈôÖ‰æãÂ≠êÊù•Âä†‰ª•ËØ¥Êòé„ÄÇ Ôºà1ÔºâÂú®‰∏çÈÄöËøáÁ¥¢ÂºïÊù°‰ª∂Êü•ËØ¢ÁöÑÊó∂ÂÄôÔºåInnoDBÁ°ÆÂÆû‰ΩøÁî®ÁöÑÊòØË°®ÈîÅÔºåËÄå‰∏çÊòØË°åÈîÅ„ÄÇ Ôºà2ÔºâÁî±‰∫éMySQLÁöÑË°åÈîÅÊòØÈíàÂØπÁ¥¢ÂºïÂä†ÁöÑÈîÅÔºå‰∏çÊòØÈíàÂØπËÆ∞ÂΩïÂä†ÁöÑÈîÅÔºåÊâÄ‰ª•ËôΩÁÑ∂ÊòØËÆøÈóÆ‰∏çÂêåË°åÁöÑËÆ∞ÂΩïÔºå‰ΩÜÊòØÂ¶ÇÊûúÊòØ‰ΩøÁî®Áõ∏ÂêåÁöÑÁ¥¢ÂºïÈîÆÔºåÊòØ‰ºöÂá∫Áé∞ÈîÅÂÜ≤Á™ÅÁöÑ„ÄÇ Ôºà3ÔºâÂΩìË°®ÊúâÂ§ö‰∏™Á¥¢ÂºïÁöÑÊó∂ÂÄôÔºå‰∏çÂêåÁöÑ‰∫ãÂä°ÂèØ‰ª•‰ΩøÁî®‰∏çÂêåÁöÑÁ¥¢ÂºïÈîÅÂÆö‰∏çÂêåÁöÑË°åÔºåÂè¶Â§ñÔºå‰∏çËÆ∫ÊòØ‰ΩøÁî®‰∏ªÈîÆÁ¥¢Âºï„ÄÅÂîØ‰∏ÄÁ¥¢ÂºïÊàñÊôÆÈÄöÁ¥¢ÂºïÔºåInnoDBÈÉΩ‰ºö‰ΩøÁî®Ë°åÈîÅÊù•ÂØπÊï∞ÊçÆÂä†ÈîÅ„ÄÇ Ôºà4ÔºâÂç≥‰æøÂú®Êù°‰ª∂‰∏≠‰ΩøÁî®‰∫ÜÁ¥¢ÂºïÂ≠óÊÆµÔºå‰ΩÜÊòØÂê¶‰ΩøÁî®Á¥¢ÂºïÊù•Ê£ÄÁ¥¢Êï∞ÊçÆÊòØÁî±MySQLÈÄöËøáÂà§Êñ≠‰∏çÂêåÊâßË°åËÆ°ÂàíÁöÑ‰ª£‰ª∑Êù•ÂÜ≥ÂÆöÁöÑÔºåÂ¶ÇÊûúMySQLËÆ§‰∏∫ÂÖ®Ë°®Êâ´ÊèèÊïàÁéáÊõ¥È´òÔºåÊØîÂ¶ÇÂØπ‰∏Ä‰∫õÂæàÂ∞èÁöÑË°®ÔºåÂÆÉÂ∞±‰∏ç‰ºö‰ΩøÁî®Á¥¢ÂºïÔºåËøôÁßçÊÉÖÂÜµ‰∏ãInnoDBÂ∞Ü‰ΩøÁî®Ë°®ÈîÅÔºåËÄå‰∏çÊòØË°åÈîÅ„ÄÇÂõ†Ê≠§ÔºåÂú®ÂàÜÊûêÈîÅÂÜ≤Á™ÅÊó∂ÔºåÂà´Âøò‰∫ÜÊ£ÄÊü•SQLÁöÑÊâßË°åËÆ°ÂàíÔºå‰ª•Á°ÆËÆ§ÊòØÂê¶ÁúüÊ≠£‰ΩøÁî®‰∫ÜÁ¥¢Âºï„ÄÇ 3.Èó¥ÈöôÈîÅÔºàNext-KeyÈîÅÔºâ ÂΩìÊàë‰ª¨Áî®ËåÉÂõ¥Êù°‰ª∂ËÄå‰∏çÊòØÁõ∏Á≠âÊù°‰ª∂Ê£ÄÁ¥¢Êï∞ÊçÆÔºåÂπ∂ËØ∑Ê±ÇÂÖ±‰∫´ÊàñÊéí‰ªñÈîÅÊó∂ÔºåInnoDB‰ºöÁªôÁ¨¶ÂêàÊù°‰ª∂ÁöÑÂ∑≤ÊúâÊï∞ÊçÆËÆ∞ÂΩïÁöÑÁ¥¢ÂºïÈ°πÂä†ÈîÅÔºõ ÂØπ‰∫éÈîÆÂÄºÂú®Êù°‰ª∂ËåÉÂõ¥ÂÜÖ‰ΩÜÂπ∂‰∏çÂ≠òÂú®ÁöÑËÆ∞ÂΩïÔºåÂè´ÂÅö‚ÄúÈó¥ÈöôÔºàGAP)‚ÄùÔºåInnoDB‰πü‰ºöÂØπËøô‰∏™‚ÄúÈó¥Èöô‚ÄùÂä†ÈîÅÔºåËøôÁßçÈîÅÊú∫Âà∂Â∞±ÊòØÊâÄË∞ìÁöÑÈó¥ÈöôÈîÅÔºàNext-KeyÈîÅÔºâ nnoDB‰ΩøÁî®Èó¥ÈöôÈîÅÁöÑÁõÆÁöÑÔºö Èò≤Ê≠¢ÂπªËØªÔºå‰ª•Êª°Ë∂≥Áõ∏ÂÖ≥ÈöîÁ¶ªÁ∫ßÂà´ÁöÑË¶ÅÊ±Ç„ÄÇÂØπ‰∫é‰∏äÈù¢ÁöÑ‰æãÂ≠êÔºåË¶ÅÊòØ‰∏ç‰ΩøÁî®Èó¥ÈöôÈîÅÔºåÂ¶ÇÊûúÂÖ∂‰ªñ‰∫ãÂä°ÊèíÂÖ•‰∫ÜempidÂ§ß‰∫é100ÁöÑ‰ªª‰ΩïËÆ∞ÂΩïÔºåÈÇ£‰πàÊú¨‰∫ãÂä°Â¶ÇÊûúÂÜçÊ¨°ÊâßË°å‰∏äËø∞ËØ≠Âè•ÔºåÂ∞±‰ºöÂèëÁîüÂπªËØªÔºõ ‰∏∫‰∫ÜÊª°Ë∂≥ÂÖ∂ÊÅ¢Â§çÂíåÂ§çÂà∂ÁöÑÈúÄË¶Å„ÄÇ ÂæàÊòæÁÑ∂ÔºåÂú®‰ΩøÁî®ËåÉÂõ¥Êù°‰ª∂Ê£ÄÁ¥¢Âπ∂ÈîÅÂÆöËÆ∞ÂΩïÊó∂ÔºåÂç≥‰ΩøÊüê‰∫õ‰∏çÂ≠òÂú®ÁöÑÈîÆÂÄº‰πü‰ºöË¢´Êó†ËæúÁöÑÈîÅÂÆöÔºåËÄåÈÄ†ÊàêÂú®ÈîÅÂÆöÁöÑÊó∂ÂÄôÊó†Ê≥ïÊèíÂÖ•ÈîÅÂÆöÈîÆÂÄºËåÉÂõ¥ÂÜÖÁöÑ‰ªª‰ΩïÊï∞ÊçÆ„ÄÇÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãËøôÂèØËÉΩ‰ºöÂØπÊÄßËÉΩÈÄ†ÊàêÂæàÂ§ßÁöÑÂç±ÂÆ≥„ÄÇ Èô§‰∫ÜÈó¥ÈöôÈîÅÁªôInnoDBÂ∏¶Êù•ÊÄßËÉΩÁöÑË¥üÈù¢ÂΩ±Âìç‰πãÂ§ñÔºåÈÄöËøáÁ¥¢ÂºïÂÆûÁé∞ÈîÅÂÆöÁöÑÊñπÂºèËøòÂ≠òÂú®ÂÖ∂‰ªñÂá†‰∏™ËæÉÂ§ßÁöÑÊÄßËÉΩÈöêÊÇ£Ôºö ÂΩìQueryÊó†Ê≥ïÂà©Áî®Á¥¢ÂºïÁöÑÊó∂ÂÄôÔºåInnoDB‰ºöÊîæÂºÉ‰ΩøÁî®Ë°åÁ∫ßÂà´ÈîÅÂÆöËÄåÊîπÁî®Ë°®Á∫ßÂà´ÁöÑÈîÅÂÆöÔºåÈÄ†ÊàêÂπ∂ÂèëÊÄßËÉΩÁöÑÈôç‰ΩéÔºõ ÂΩìQuery‰ΩøÁî®ÁöÑÁ¥¢ÂºïÂπ∂‰∏çÂåÖÂê´ÊâÄÊúâËøáÊª§Êù°‰ª∂ÁöÑÊó∂ÂÄôÔºåÊï∞ÊçÆÊ£ÄÁ¥¢‰ΩøÁî®Âà∞ÁöÑÁ¥¢ÂºïÈîÆÊâÄÂè™ÊÉ≥ÁöÑÊï∞ÊçÆÂèØËÉΩÊúâÈÉ®ÂàÜÂπ∂‰∏çÂ±û‰∫éËØ•QueryÁöÑÁªìÊûúÈõÜÁöÑË°åÂàóÔºå‰ΩÜÊòØ‰πü‰ºöË¢´ÈîÅÂÆöÔºåÂõ†‰∏∫Èó¥ÈöôÈîÅÈîÅÂÆöÁöÑÊòØ‰∏Ä‰∏™ËåÉÂõ¥ÔºåËÄå‰∏çÊòØÂÖ∑‰ΩìÁöÑÁ¥¢ÂºïÈîÆÔºõ ÂΩìQueryÂú®‰ΩøÁî®Á¥¢ÂºïÂÆö‰ΩçÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú‰ΩøÁî®ÁöÑÁ¥¢ÂºïÈîÆ‰∏ÄÊ†∑‰ΩÜËÆøÈóÆÁöÑÊï∞ÊçÆË°å‰∏çÂêåÁöÑÊó∂ÂÄôÔºàÁ¥¢ÂºïÂè™ÊòØËøáÊª§Êù°‰ª∂ÁöÑ‰∏ÄÈÉ®ÂàÜÔºâÔºå‰∏ÄÊ†∑‰ºöË¢´ÈîÅÂÆö„ÄÇÂõ†Ê≠§ÔºåÂú®ÂÆûÈôÖÂ∫îÁî®ÂºÄÂèë‰∏≠ÔºåÂ∞§ÂÖ∂ÊòØÂπ∂ÂèëÊèíÂÖ•ÊØîËæÉÂ§öÁöÑÂ∫îÁî®ÔºåÊàë‰ª¨Ë¶ÅÂ∞ΩÈáè‰ºòÂåñ‰∏öÂä°ÈÄªËæëÔºåÂ∞ΩÈáè‰ΩøÁî®Áõ∏Á≠âÊù°‰ª∂Êù•ËÆøÈóÆÊõ¥Êñ∞Êï∞ÊçÆÔºåÈÅøÂÖç‰ΩøÁî®ËåÉÂõ¥Êù°‰ª∂„ÄÇËøòË¶ÅÁâπÂà´ËØ¥ÊòéÁöÑÊòØÔºåInnoDBÈô§‰∫ÜÈÄöËøáËåÉÂõ¥Êù°‰ª∂Âä†ÈîÅÊó∂‰ΩøÁî®Èó¥ÈöôÈîÅÂ§ñÔºåÂ¶ÇÊûú‰ΩøÁî®Áõ∏Á≠âÊù°‰ª∂ËØ∑Ê±ÇÁªô‰∏Ä‰∏™‰∏çÂ≠òÂú®ÁöÑËÆ∞ÂΩïÂä†ÈîÅÔºåInnoDB‰πü‰ºö‰ΩøÁî®Èó¥ÈöôÈîÅ„ÄÇÈÄöÂ∏∏Êù•ËØ¥ÔºåÊ≠ªÈîÅÈÉΩÊòØÂ∫îÁî®ËÆæËÆ°ÁöÑÈóÆÈ¢òÔºåÈÄöËøáË∞ÉÊï¥‰∏öÂä°ÊµÅÁ®ã„ÄÅÊï∞ÊçÆÂ∫ìÂØπË±°ËÆæËÆ°„ÄÅ‰∫ãÂä°Â§ßÂ∞èÔºå‰ª•ÂèäËÆøÈóÆÊï∞ÊçÆÂ∫ìÁöÑSQLËØ≠Âè•ÔºåÁªùÂ§ßÈÉ®ÂàÜÊ≠ªÈîÅÈÉΩÂèØ‰ª•ÈÅøÂÖç„ÄÇ‰∏ãÈù¢Â∞±ÈÄöËøáÂÆû‰æãÊù•‰ªãÁªçÂá†ÁßçÈÅøÂÖçÊ≠ªÈîÅÁöÑÂ∏∏Áî®ÊñπÊ≥ïÔºö Âú®Â∫îÁî®‰∏≠ÔºåÂ¶ÇÊûú‰∏çÂêåÁöÑÁ®ãÂ∫è‰ºöÂπ∂ÂèëÂ≠òÂèñÂ§ö‰∏™Ë°®ÔºåÂ∫îÂ∞ΩÈáèÁ∫¶ÂÆö‰ª•Áõ∏ÂêåÁöÑÈ°∫Â∫èÊù•ËÆøÈóÆË°®ÔºåËøôÊ†∑ÂèØ‰ª•Â§ßÂ§ßÈôç‰Ωé‰∫ßÁîüÊ≠ªÈîÅÁöÑÊú∫‰ºö„ÄÇ Âú®Á®ãÂ∫è‰ª•ÊâπÈáèÊñπÂºèÂ§ÑÁêÜÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú‰∫ãÂÖàÂØπÊï∞ÊçÆÊéíÂ∫èÔºå‰øùËØÅÊØè‰∏™Á∫øÁ®ãÊåâÂõ∫ÂÆöÁöÑÈ°∫Â∫èÊù•Â§ÑÁêÜËÆ∞ÂΩïÔºå‰πüÂèØ‰ª•Â§ßÂ§ßÈôç‰ΩéÂá∫Áé∞Ê≠ªÈîÅÁöÑÂèØËÉΩ„ÄÇ Âú®‰∫ãÂä°‰∏≠ÔºåÂ¶ÇÊûúË¶ÅÊõ¥Êñ∞ËÆ∞ÂΩïÔºåÂ∫îËØ•Áõ¥Êé•Áî≥ËØ∑Ë∂≥Â§üÁ∫ßÂà´ÁöÑÈîÅÔºåÂç≥Êéí‰ªñÈîÅÔºåËÄå‰∏çÂ∫îÂÖàÁî≥ËØ∑ÂÖ±‰∫´ÈîÅÔºåÊõ¥Êñ∞Êó∂ÂÜçÁî≥ËØ∑Êéí‰ªñÈîÅÔºåÂõ†‰∏∫ÂΩìÁî®Êà∑Áî≥ËØ∑Êéí‰ªñÈîÅÊó∂ÔºåÂÖ∂‰ªñ‰∫ãÂä°ÂèØËÉΩÂèàÂ∑≤ÁªèËé∑Âæó‰∫ÜÁõ∏ÂêåËÆ∞ÂΩïÁöÑÂÖ±‰∫´ÈîÅÔºå‰ªéËÄåÈÄ†ÊàêÈîÅÂÜ≤Á™ÅÔºåÁîöËá≥Ê≠ªÈîÅ„ÄÇ Âú®REPEATABLE-READÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÂ¶ÇÊûú‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂ÂØπÁõ∏ÂêåÊù°‰ª∂ËÆ∞ÂΩïÁî®SELECT‚Ä¶FOR UPDATEÂä†Êéí‰ªñÈîÅÔºåÂú®Ê≤°ÊúâÁ¨¶ÂêàËØ•Êù°‰ª∂ËÆ∞ÂΩïÊÉÖÂÜµ‰∏ãÔºå‰∏§‰∏™Á∫øÁ®ãÈÉΩ‰ºöÂä†ÈîÅÊàêÂäü„ÄÇÁ®ãÂ∫èÂèëÁé∞ËÆ∞ÂΩïÂ∞ö‰∏çÂ≠òÂú®ÔºåÂ∞±ËØïÂõæÊèíÂÖ•‰∏ÄÊù°Êñ∞ËÆ∞ÂΩïÔºåÂ¶ÇÊûú‰∏§‰∏™Á∫øÁ®ãÈÉΩËøô‰πàÂÅöÔºåÂ∞±‰ºöÂá∫Áé∞Ê≠ªÈîÅ„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÂ∞ÜÈöîÁ¶ªÁ∫ßÂà´ÊîπÊàêREAD COMMITTEDÔºåÂ∞±ÂèØÈÅøÂÖçÈóÆÈ¢ò„ÄÇ ÂΩìÈöîÁ¶ªÁ∫ßÂà´‰∏∫READ COMMITTEDÊó∂ÔºåÂ¶ÇÊûú‰∏§‰∏™Á∫øÁ®ãÈÉΩÂÖàÊâßË°åSELECT‚Ä¶FOR UPDATEÔºåÂà§Êñ≠ÊòØÂê¶Â≠òÂú®Á¨¶ÂêàÊù°‰ª∂ÁöÑËÆ∞ÂΩïÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±ÊèíÂÖ•ËÆ∞ÂΩï„ÄÇÊ≠§Êó∂ÔºåÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÊèíÂÖ•ÊàêÂäüÔºåÂè¶‰∏Ä‰∏™Á∫øÁ®ã‰ºöÂá∫Áé∞ÈîÅÁ≠âÂæÖÔºåÂΩìÁ¨¨1‰∏™Á∫øÁ®ãÊèê‰∫§ÂêéÔºåÁ¨¨2‰∏™Á∫øÁ®ã‰ºöÂõ†‰∏ªÈîÆÈáçÂá∫ÈîôÔºå‰ΩÜËôΩÁÑ∂Ëøô‰∏™Á∫øÁ®ãÂá∫Èîô‰∫ÜÔºåÂç¥‰ºöËé∑Âæó‰∏Ä‰∏™Êéí‰ªñÈîÅ„ÄÇËøôÊó∂Â¶ÇÊûúÊúâÁ¨¨3‰∏™Á∫øÁ®ãÂèàÊù•Áî≥ËØ∑Êéí‰ªñÈîÅÔºå‰πü‰ºöÂá∫Áé∞Ê≠ªÈîÅ„ÄÇÂØπ‰∫éËøôÁßçÊÉÖÂÜµÔºåÂèØ‰ª•Áõ¥Êé•ÂÅöÊèíÂÖ•Êìç‰ΩúÔºåÁÑ∂ÂêéÂÜçÊçïËé∑‰∏ªÈîÆÈáçÂºÇÂ∏∏ÔºåÊàñËÄÖÂú®ÈÅáÂà∞‰∏ªÈîÆÈáçÈîôËØØÊó∂ÔºåÊÄªÊòØÊâßË°åROLLBACKÈáäÊîæËé∑ÂæóÁöÑÊéí‰ªñÈîÅ„ÄÇ ‰ªÄ‰πàÊó∂ÂÄô‰ΩøÁî®Ë°®ÈîÅÂØπ‰∫éInnoDBË°®ÔºåÂú®ÁªùÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÈÉΩÂ∫îËØ•‰ΩøÁî®Ë°åÁ∫ßÈîÅÔºåÂõ†‰∏∫‰∫ãÂä°ÂíåË°åÈîÅÂæÄÂæÄÊòØÊàë‰ª¨‰πãÊâÄ‰ª•ÈÄâÊã©InnoDBË°®ÁöÑÁêÜÁî±„ÄÇ‰ΩÜÂú®‰∏™Âà´ÁâπÊÆä‰∫ãÂä°‰∏≠Ôºå‰πüÂèØ‰ª•ËÄÉËôë‰ΩøÁî®Ë°®Á∫ßÈîÅÔºö * ‰∫ãÂä°ÈúÄË¶ÅÊõ¥Êñ∞Â§ßÈÉ®ÂàÜÊàñÂÖ®ÈÉ®Êï∞ÊçÆÔºåË°®ÂèàÊØîËæÉÂ§ßÔºåÂ¶ÇÊûú‰ΩøÁî®ÈªòËÆ§ÁöÑË°åÈîÅÔºå‰∏ç‰ªÖËøô‰∏™‰∫ãÂä°ÊâßË°åÊïàÁéá‰ΩéÔºåËÄå‰∏îÂèØËÉΩÈÄ†ÊàêÂÖ∂‰ªñ‰∫ãÂä°ÈïøÊó∂Èó¥ÈîÅÁ≠âÂæÖÂíåÈîÅÂÜ≤Á™ÅÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÂèØ‰ª•ËÄÉËôë‰ΩøÁî®Ë°®ÈîÅÊù•ÊèêÈ´òËØ•‰∫ãÂä°ÁöÑÊâßË°åÈÄüÂ∫¶„ÄÇ * ‰∫ãÂä°Ê∂âÂèäÂ§ö‰∏™Ë°®ÔºåÊØîËæÉÂ§çÊùÇÔºåÂæàÂèØËÉΩÂºïËµ∑Ê≠ªÈîÅÔºåÈÄ†ÊàêÂ§ßÈáè‰∫ãÂä°ÂõûÊªö„ÄÇËøôÁßçÊÉÖÂÜµ‰πüÂèØ‰ª•ËÄÉËôë‰∏ÄÊ¨°ÊÄßÈîÅÂÆö‰∫ãÂä°Ê∂âÂèäÁöÑË°®Ôºå‰ªéËÄåÈÅøÂÖçÊ≠ªÈîÅ„ÄÅÂáèÂ∞ëÊï∞ÊçÆÂ∫ìÂõ†‰∫ãÂä°ÂõûÊªöÂ∏¶Êù•ÁöÑÂºÄÈîÄ„ÄÇ ÂΩìÁÑ∂ÔºåÂ∫îÁî®‰∏≠Ëøô‰∏§Áßç‰∫ãÂä°‰∏çËÉΩÂ§™Â§öÔºåÂê¶ÂàôÔºåÂ∞±Â∫îËØ•ËÄÉËôë‰ΩøÁî®MyISAMË°®‰∫Ü„ÄÇ * Âú®InnoDB‰∏ãÔºå‰ΩøÁî®Ë°®ÈîÅË¶ÅÊ≥®ÊÑè‰ª•‰∏ã‰∏§ÁÇπ„ÄÇ * ‰ΩøÁî®LOCK TABLESËôΩÁÑ∂ÂèØ‰ª•ÁªôInnoDBÂä†Ë°®Á∫ßÈîÅÔºå‰ΩÜÂøÖÈ°ªËØ¥ÊòéÁöÑÊòØÔºåË°®ÈîÅ‰∏çÊòØÁî±InnoDBÂ≠òÂÇ®ÂºïÊìéÂ±ÇÁÆ°ÁêÜÁöÑÔºåËÄåÊòØÁî±ÂÖ∂‰∏ä‰∏ÄÂ±Ç‚îÄ‚îÄMySQL ServerË¥üË¥£ÁöÑÔºå‰ªÖÂΩìautocommit=0„ÄÅInnoDB_table_locks=1ÔºàÈªòËÆ§ËÆæÁΩÆÔºâÊó∂ÔºåInnoDBÂ±ÇÊâçËÉΩÁü•ÈÅìMySQLÂä†ÁöÑË°®ÈîÅÔºåMySQL Server‰πüÊâçËÉΩÊÑüÁü•InnoDBÂä†ÁöÑË°åÈîÅÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÔºåInnoDBÊâçËÉΩËá™Âä®ËØÜÂà´Ê∂âÂèäË°®Á∫ßÈîÅÁöÑÊ≠ªÈîÅÔºåÂê¶ÂàôÔºåInnoDBÂ∞ÜÊó†Ê≥ïËá™Âä®Ê£ÄÊµãÂπ∂Â§ÑÁêÜËøôÁßçÊ≠ªÈîÅ * Âú®Áî® LOCK TABLESÂØπInnoDBË°®Âä†ÈîÅÊó∂Ë¶ÅÊ≥®ÊÑèÔºåË¶ÅÂ∞ÜAUTOCOMMITËÆæ‰∏∫0ÔºåÂê¶ÂàôMySQL‰∏ç‰ºöÁªôË°®Âä†ÈîÅÔºõ‰∫ãÂä°ÁªìÊùüÂâçÔºå‰∏çË¶ÅÁî®UNLOCK TABLESÈáäÊîæË°®ÈîÅÔºåÂõ†‰∏∫UNLOCK TABLES‰ºöÈöêÂê´Âú∞Êèê‰∫§‰∫ãÂä°ÔºõCOMMITÊàñROLLBACKÂπ∂‰∏çËÉΩÈáäÊîæÁî®LOCK TABLESÂä†ÁöÑË°®Á∫ßÈîÅÔºåÂøÖÈ°ªÁî®UNLOCK TABLESÈáäÊîæË°®ÈîÅ SQL‰ºòÂåñÊÄé‰πàÂÅöÔºüSQLÊâßË°åËøáÁ®ãÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºü‰ªéclientÂèëËµ∑ËØ∑Ê±ÇÂà∞Êï∞ÊçÆÂ∫ìÊâßË°åSQLÂú®ËøîÂõûÊï∞ÊçÆÊµÅÁ®ãÊòØ‰ªÄ‰πàÔºüÁ≠îÔºö ËøûÊé• ÂÆ¢Êà∑Á´ØÂèëËµ∑‰∏ÄÊù°QueryËØ∑Ê±ÇÔºåÁõëÂê¨ÂÆ¢Êà∑Á´ØÁöÑ‚ÄôËøûÊé•ÁÆ°ÁêÜÊ®°Âùó‚ÄôÊé•Êî∂ËØ∑Ê±Ç Â∞ÜËØ∑Ê±ÇËΩ¨ÂèëÂà∞‚ÄôËøûÊé•Ëøõ/Á∫øÁ®ãÊ®°Âùó‚Äô Ë∞ÉÁî®‚ÄôÁî®Êà∑Ê®°Âùó‚ÄôÊù•ËøõË°åÊéàÊùÉÊ£ÄÊü• ÈÄöËøáÊ£ÄÊü•ÂêéÔºå‚ÄôËøûÊé•Ëøõ/Á∫øÁ®ãÊ®°Âùó‚Äô‰ªé‚ÄôÁ∫øÁ®ãËøûÊé•Ê±†‚Äô‰∏≠ÂèñÂá∫Á©∫Èó≤ÁöÑË¢´ÁºìÂ≠òÁöÑËøûÊé•Á∫øÁ®ãÂíåÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÂØπÊé•ÔºåÂ¶ÇÊûúÂ§±Ë¥•ÂàôÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËøûÊé•ËØ∑Ê±ÇÂ§ÑÁêÜ ÂÖàÊü•ËØ¢ÁºìÂ≠òÔºåÊ£ÄÊü•QueryËØ≠Âè•ÊòØÂê¶ÂÆåÂÖ®ÂåπÈÖçÔºåÊé•ÁùÄÂÜçÊ£ÄÊü•ÊòØÂê¶ÂÖ∑ÊúâÊùÉÈôêÔºåÈÉΩÊàêÂäüÂàôÁõ¥Êé•ÂèñÊï∞ÊçÆËøîÂõû ‰∏ä‰∏ÄÊ≠•ÊúâÂ§±Ë¥•ÂàôËΩ¨‰∫§Áªô‚ÄôÂëΩ‰ª§Ëß£ÊûêÂô®‚ÄôÔºåÁªèËøáËØçÊ≥ïÂàÜÊûêÔºåËØ≠Ê≥ïÂàÜÊûêÂêéÁîüÊàêËß£ÊûêÊ†ë Êé•‰∏ãÊù•ÊòØÈ¢ÑÂ§ÑÁêÜÈò∂ÊÆµÔºåÂ§ÑÁêÜËß£ÊûêÂô®Êó†Ê≥ïËß£ÂÜ≥ÁöÑËØ≠‰πâÔºåÊ£ÄÊü•ÊùÉÈôêÁ≠âÔºåÁîüÊàêÊñ∞ÁöÑËß£ÊûêÊ†ë ÂÜçËΩ¨‰∫§ÁªôÂØπÂ∫îÁöÑÊ®°ÂùóÂ§ÑÁêÜ Â¶ÇÊûúÊòØSELECTÊü•ËØ¢Ëøò‰ºöÁªèÁî±‚ÄôÊü•ËØ¢‰ºòÂåñÂô®‚ÄôÂÅöÂ§ßÈáèÁöÑ‰ºòÂåñÔºåÁîüÊàêÊâßË°åËÆ°Âàí Ê®°ÂùóÊî∂Âà∞ËØ∑Ê±ÇÂêéÔºåÈÄöËøá‚ÄôËÆøÈóÆÊéßÂà∂Ê®°Âùó‚ÄôÊ£ÄÊü•ÊâÄËøûÊé•ÁöÑÁî®Êà∑ÊòØÂê¶ÊúâËÆøÈóÆÁõÆÊ†áË°®ÂíåÁõÆÊ†áÂ≠óÊÆµÁöÑÊùÉÈôê ÊúâÂàôË∞ÉÁî®‚ÄôË°®ÁÆ°ÁêÜÊ®°Âùó‚ÄôÔºåÂÖàÊòØÊü•Áúãtable cache‰∏≠ÊòØÂê¶Â≠òÂú®ÔºåÊúâÂàôÁõ¥Êé•ÂØπÂ∫îÁöÑË°®ÂíåËé∑ÂèñÈîÅÔºåÂê¶ÂàôÈáçÊñ∞ÊâìÂºÄË°®Êñá‰ª∂ Ê†πÊçÆË°®ÁöÑmetaÊï∞ÊçÆÔºåËé∑ÂèñË°®ÁöÑÂ≠òÂÇ®ÂºïÊìéÁ±ªÂûãÁ≠â‰ø°ÊÅØÔºåÈÄöËøáÊé•Âè£Ë∞ÉÁî®ÂØπÂ∫îÁöÑÂ≠òÂÇ®ÂºïÊìéÂ§ÑÁêÜ ‰∏äËø∞ËøáÁ®ã‰∏≠‰∫ßÁîüÊï∞ÊçÆÂèòÂåñÁöÑÊó∂ÂÄôÔºåËã•ÊâìÂºÄÊó•ÂøóÂäüËÉΩÔºåÂàô‰ºöËÆ∞ÂΩïÂà∞Áõ∏Â∫î‰∫åËøõÂà∂Êó•ÂøóÊñá‰ª∂‰∏≠ÁªìÊûú QueryËØ∑Ê±ÇÂÆåÊàêÂêéÔºåÂ∞ÜÁªìÊûúÈõÜËøîÂõûÁªô‚ÄôËøûÊé•Ëøõ/Á∫øÁ®ãÊ®°Âùó‚Äô ËøîÂõûÁöÑ‰πüÂèØ‰ª•ÊòØÁõ∏Â∫îÁöÑÁä∂ÊÄÅÊ†áËØÜÔºåÂ¶ÇÊàêÂäüÊàñÂ§±Ë¥•Á≠â ËøûÊé•Ëøõ/Á∫øÁ®ãÊ®°Âùó‚ÄôËøõË°åÂêéÁª≠ÁöÑÊ∏ÖÁêÜÂ∑•‰ΩúÔºåÂπ∂ÁªßÁª≠Á≠âÂæÖËØ∑Ê±ÇÊàñÊñ≠ÂºÄ‰∏éÂÆ¢Êà∑Á´ØÁöÑËøûÊé• Â∞èÁªìÁî®Êà∑Ê®°ÂùóÊ†°È™åÁî®Êà∑,ÁÑ∂ÂêéÂéªÁ∫øÁ®ãËøûÊé•Ê±†ÊãøÁ∫øÁ®ã(ËøûÊé•Ë∂≥Â§üÁöÑËØù),ÊâæÂëΩ‰ª§ÂàÜÂèëÂô®,Âà∞Êü•ËØ¢ÁºìÂ≠òÊ®°ÂùóÊü•SQLËØ≠Âè•,Â¶ÇÊûúÊ≤°Êúâ,Ëµ∞ÂëΩ‰ª§Ëß£ÊûêÂô®,ÁÑ∂ÂêéËÆøÈóÆÊéßÂà∂Ê®°Âùó,ËÆæÂÆöÁî®Êà∑ÁöÑÊùÉÈôê,ËÆæÂÆöÂ•ΩÂêéËµ∞Ë°®ÁÆ°ÁêÜÊ®°Âùó,Ëé∑ÂèñÈîÅÂíåÁºìÂ≠ò,ÁÑ∂ÂêéËé∑ÂèñÂêÑÁßç‰ø°ÊÅØ,Â≠òÂÇ®ÁöÑÊñπÂºè:Â≠òÂÇ®ÂºïÊìé,‰ªéÂ≠òÂÇ®ÂºïÊìéËé∑ÂèñÊï∞ÊçÆ,ÁÑ∂ÂêéËøîÂõû Êï∞ÊçÆÂ∫ì‰∫ãÂä°ACIDÁâπÊÄßÁ≠îÔºöÊï∞ÊçÆÂ∫ì‰∫ãÂä°ACIDÁâπÊÄß,Êï∞ÊçÆÂ∫ì‰∫ãÂä°ÁöÑ4‰∏™ÁâπÊÄßÔºö ÂéüÂ≠êÊÄß(Atomic): ‰∫ãÂä°‰∏≠ÁöÑÂ§ö‰∏™Êìç‰ΩúÔºå‰∏çÂèØÂàÜÂâ≤ÔºåË¶Å‰πàÈÉΩÊàêÂäüÔºåË¶Å‰πàÈÉΩÂ§±Ë¥•Ôºõ All or Nothing. ‰∏ÄËá¥ÊÄß(Consistency): ‰∫ãÂä°Êìç‰Ωú‰πãÂêé, Êï∞ÊçÆÂ∫ìÊâÄÂ§ÑÁöÑÁä∂ÊÄÅÂíå‰∏öÂä°ËßÑÂàôÊòØ‰∏ÄËá¥ÁöÑ; ÊØîÂ¶Ça,bË¥¶Êà∑Áõ∏‰∫íËΩ¨Ë¥¶‰πãÂêéÔºåÊÄªÈáëÈ¢ù‰∏çÂèòÔºõ ÈöîÁ¶ªÊÄß(Isolation): Â§ö‰∏™‰∫ãÂä°‰πãÈó¥Â∞±ÂÉèÊòØ‰∏≤Ë°åÊâßË°å‰∏ÄÊ†∑Ôºå‰∏çÁõ∏‰∫íÂΩ±Âìç; ÊåÅ‰πÖÊÄß(Durability): ‰∫ãÂä°Êèê‰∫§ÂêéË¢´ÊåÅ‰πÖÂåñÂà∞Ê∞∏‰πÖÂ≠òÂÇ®.ÈöîÁ¶ªÊÄß,ÂÖ∂‰∏≠ÈöîÁ¶ªÊÄßÂàÜ‰∏∫‰∫ÜÂõõÁßçÔºö READ UNCOMMITTEDÔºöÂèØ‰ª•ËØªÂèñÊú™Êèê‰∫§ÁöÑÊï∞ÊçÆÔºåÊú™Êèê‰∫§ÁöÑÊï∞ÊçÆÁß∞‰∏∫ËÑèÊï∞ÊçÆÔºåÊâÄ‰ª•ÂèàÁß∞ËÑèËØª„ÄÇÊ≠§Êó∂ÔºöÂπªËØªÔºå‰∏çÂèØÈáçÂ§çËØªÂíåËÑèËØªÂùáÂÖÅËÆ∏Ôºõ READ COMMITTEDÔºöÂè™ËÉΩËØªÂèñÂ∑≤ÁªèÊèê‰∫§ÁöÑÊï∞ÊçÆÔºõÊ≠§Êó∂ÔºöÂÖÅËÆ∏ÂπªËØªÂíå‰∏çÂèØÈáçÂ§çËØªÔºå‰ΩÜ‰∏çÂÖÅËÆ∏ËÑèËØªÔºåÊâÄ‰ª•RCÈöîÁ¶ªÁ∫ßÂà´Ë¶ÅÊ±ÇËß£ÂÜ≥ËÑèËØªÔºõ REPEATABLE READÔºöÂêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠Â§öÊ¨°ÊâßË°åÂêå‰∏Ä‰∏™select,ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÊ≤°ÊúâÂèëÁîüÊîπÂèòÔºõÊ≠§Êó∂ÔºöÂÖÅËÆ∏ÂπªËØªÔºå‰ΩÜ‰∏çÂÖÅËÆ∏‰∏çÂèØÈáçÂ§çËØªÂíåËÑèËØªÔºåÊâÄ‰ª•RRÈöîÁ¶ªÁ∫ßÂà´Ë¶ÅÊ±ÇËß£ÂÜ≥‰∏çÂèØÈáçÂ§çËØªÔºõ SERIALIZABLE: ÂπªËØªÔºå‰∏çÂèØÈáçÂ§çËØªÂíåËÑèËØªÈÉΩ‰∏çÂÖÅËÆ∏ÔºåÊâÄ‰ª•serializableË¶ÅÊ±ÇËß£ÂÜ≥ÂπªËØªÔºõÂä†Âº∫ÁêÜËß£Ôºö ËÑèËØªÔºöÂèØ‰ª•ËØªÂèñÊú™Êèê‰∫§ÁöÑÊï∞ÊçÆ„ÄÇRC Ë¶ÅÊ±ÇËß£ÂÜ≥ËÑèËØªÔºõ ‰∏çÂèØÈáçÂ§çËØªÔºöÂêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠Â§öÊ¨°ÊâßË°åÂêå‰∏Ä‰∏™select, ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÂèëÁîü‰∫ÜÊîπÂèò(Ë¢´ÂÖ∂ÂÆÉ‰∫ãÂä°updateÂπ∂‰∏îÊèê‰∫§)Ôºõ ÂèØÈáçÂ§çËØªÔºöÂêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠Â§öÊ¨°ÊâßË°åÂêå‰∏Ä‰∏™select, ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÊ≤°ÊúâÂèëÁîüÊîπÂèò(‰∏ÄËà¨‰ΩøÁî®MVCCÂÆûÁé∞)ÔºõRRÂêÑÁ∫ßÁ∫ßÂà´Ë¶ÅÊ±ÇËææÂà∞ÂèØÈáçÂ§çËØªÁöÑÊ†áÂáÜÔºõ ÂπªËØªÔºöÂêå‰∏Ä‰∏™‰∫ãÂä°‰∏≠Â§öÊ¨°ÊâßË°åÂêå‰∏Ä‰∏™select, ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆË°åÂèëÁîüÊîπÂèò„ÄÇ‰πüÂ∞±ÊòØË°åÊï∞ÂáèÂ∞ëÊàñËÄÖÂ¢ûÂä†‰∫Ü(Ë¢´ÂÖ∂ÂÆÉ‰∫ãÂä°delete/insertÂπ∂‰∏îÊèê‰∫§)„ÄÇSERIALIZABLEË¶ÅÊ±ÇËß£ÂÜ≥ÂπªËØªÈóÆÈ¢òÔºõ ËøôÈáå‰∏ÄÂÆöË¶ÅÂå∫ÂàÜ ‰∏çÂèØÈáçÂ§çËØª Âíå ÂπªËØªÔºö ‰∏çÂèØÈáçÂ§çËØªÁöÑÈáçÁÇπÊòØ‰øÆÊîπ: ÂêåÊ†∑ÁöÑÊù°‰ª∂ÁöÑselect, ‰Ω†ËØªÂèñËøáÁöÑÊï∞ÊçÆ, ÂÜçÊ¨°ËØªÂèñÂá∫Êù•ÂèëÁé∞ÂÄº‰∏ç‰∏ÄÊ†∑‰∫Ü ÂπªËØªÁöÑÈáçÁÇπÂú®‰∫éÊñ∞Â¢ûÊàñËÄÖÂà†Èô§: ÂêåÊ†∑ÁöÑÊù°‰ª∂ÁöÑselect, Á¨¨1Ê¨°ÂíåÁ¨¨2Ê¨°ËØªÂá∫Êù•ÁöÑËÆ∞ÂΩïÊï∞‰∏ç‰∏ÄÊ†∑ ‰ªéÁªìÊûú‰∏äÊù•Áúã, ‰∏§ËÄÖÈÉΩÊòØ‰∏∫Â§öÊ¨°ËØªÂèñÁöÑÁªìÊûú‰∏ç‰∏ÄËá¥„ÄÇ‰ΩÜÂ¶ÇÊûú‰Ω†‰ªéÂÆûÁé∞ÁöÑËßíÂ∫¶Êù•Áúã, ÂÆÉ‰ª¨ÁöÑÂå∫Âà´Â∞±ÊØîËæÉÂ§ßÔºö ÂØπ‰∫éÂâçËÄÖ, Âú®RC‰∏ãÂè™ÈúÄË¶ÅÈîÅ‰ΩèÊª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩïÔºåÂ∞±ÂèØ‰ª•ÈÅøÂÖçË¢´ÂÖ∂ÂÆÉ‰∫ãÂä°‰øÆÊîπÔºå‰πüÂ∞±ÊòØ select for update, select in share mode; RRÈöîÁ¶ª‰∏ã‰ΩøÁî®MVCCÂÆûÁé∞ÂèØÈáçÂ§çËØªÔºõ ÂØπ‰∫éÂêéËÄÖ, Ë¶ÅÈîÅ‰ΩèÊª°Ë∂≥Êù°‰ª∂ÁöÑËÆ∞ÂΩïÂèäÊâÄÊúâËøô‰∫õËÆ∞ÂΩï‰πãÈó¥ÁöÑgapÔºå‰πüÂ∞±ÊòØÈúÄË¶Å gap lock„ÄÇ ËÄåANSI SQLÊ†áÂáÜÊ≤°Êúâ‰ªéÈöîÁ¶ªÁ®ãÂ∫¶ËøõË°åÂÆö‰πâÔºåËÄåÊòØÂÆö‰πâ‰∫Ü‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÔºåÂêåÊó∂ÂÆö‰πâ‰∫Ü‰∏çÂêå‰∫ãÂä°ÈöîÁ¶ªÁ∫ßÂà´Ëß£ÂÜ≥ÁöÑ‰∏âÂ§ßÂπ∂ÂèëÈóÆÈ¢òÔºö Isolation Level Dirty Read Unrepeatable Read Phantom Read Read UNCOMMITTED YES YES YES READ COMMITTED NO YES YES READ REPEATABLE NO NO YES SERIALIZABLE NO NO NO MySQL ‰∏≠RCÂíåRRÈöîÁ¶ªÁ∫ßÂà´ÁöÑÂå∫Âà´MySQLÊï∞ÊçÆÂ∫ì‰∏≠ÈªòËÆ§ÈöîÁ¶ªÁ∫ßÂà´‰∏∫RRÔºå‰ΩÜÊòØÂÆûÈôÖÊÉÖÂÜµÊòØ‰ΩøÁî®RC Âíå RRÈöîÁ¶ªÁ∫ßÂà´ÁöÑÈÉΩ‰∏çÂ∞ë„ÄÇÂ•ΩÂÉèÊ∑òÂÆù„ÄÅÁΩëÊòìÈÉΩÊòØ‰ΩøÁî®ÁöÑ RC ÈöîÁ¶ªÁ∫ßÂà´„ÄÇÈÇ£‰πàÂú®MySQL‰∏≠ RC Âíå RRÊúâ‰ªÄ‰πàÂå∫Âà´Âë¢ÔºüÊàë‰ª¨ËØ•Â¶Ç‰ΩïÈÄâÊã©Âë¢Ôºü‰∏∫‰ªÄ‰πàMySQLÂ∞ÜRR‰Ωú‰∏∫ÈªòËÆ§ÁöÑÈöîÁ¶ªÁ∫ßÂà´Âë¢ÔºüRC ‰∏é RR Âú®ÈîÅÊñπÈù¢ÁöÑÂå∫Âà´ ÊòæÁÑ∂ RR ÊîØÊåÅ gap lock(next-key lock)ÔºåËÄåRCÂàôÊ≤°Êúâgap lock„ÄÇÂõ†‰∏∫MySQLÁöÑRRÈúÄË¶Ågap lockÊù•Ëß£ÂÜ≥ÂπªËØªÈóÆÈ¢ò„ÄÇËÄåRCÈöîÁ¶ªÁ∫ßÂà´ÂàôÊòØÂÖÅËÆ∏Â≠òÂú®‰∏çÂèØÈáçÂ§çËØªÂíåÂπªËØªÁöÑ„ÄÇÊâÄ‰ª•RCÁöÑÂπ∂Âèë‰∏ÄËà¨Ë¶ÅÂ•Ω‰∫éRRÔºõ RC ÈöîÁ¶ªÁ∫ßÂà´ÔºåÈÄöËøá where Êù°‰ª∂ËøáÊª§‰πãÂêéÔºå‰∏çÁ¨¶ÂêàÊù°‰ª∂ÁöÑËÆ∞ÂΩï‰∏äÁöÑË°åÈîÅÔºå‰ºöÈáäÊîæÊéâ(ËôΩÁÑ∂ËøôÈáåÁ†¥Âùè‰∫Ü‚Äú‰∏§Èò∂ÊÆµÂä†ÈîÅÂéüÂàô‚Äù)Ôºõ‰ΩÜÊòØRRÈöîÁ¶ªÁ∫ßÂà´ÔºåÂç≥‰Ωø‰∏çÁ¨¶ÂêàwhereÊù°‰ª∂ÁöÑËÆ∞ÂΩïÔºå‰πü‰∏ç‰ºöÊòØÂê¶Ë°åÈîÅÂíågap lockÔºõÊâÄ‰ª•‰ªéÈîÅÊñπÈù¢Êù•ÁúãÔºåRCÁöÑÂπ∂ÂèëÂ∫îËØ•Ë¶ÅÂ•Ω‰∫éRRÔºõÂè¶Â§ñ insert into t select ‚Ä¶ from s where ËØ≠Âè•Âú®sË°®‰∏äÁöÑÈîÅ‰πüÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ ‰∏§‰∏™Âπ∂Âèë‰∫ãÂä°AÔºåBÊâßË°åÁöÑÊó∂Èó¥Â∫èÂàóÂ¶Ç‰∏ã(AÂÖà‰∫éBÂºÄÂßãÔºåBÂÖà‰∫éAÁªìÊùü)1234567A1: start transaction;B1: start transaction;A2: select * from t;B2: insert into t values (4, wangwu);A3: select * from t;B3: commit;A4: select * from t; 123456789101112ÊèêÈóÆ1ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØÂèØÈáçÂ§çËØªRRÔºå‰∫ãÂä°A‰∏≠ÁöÑ‰∏âÊ¨°Êü•ËØ¢ÔºåA2, A3, A4ÂàÜÂà´ËØªÂà∞‰ªÄ‰πàÁªìÊûúÈõÜÔºüÂõûÁ≠îÔºöRR‰∏ã(1)A2ËØªÂà∞ÁöÑÁªìÊûúÈõÜËÇØÂÆöÊòØ{1, 2, 3}ÔºåËøôÊòØ‰∫ãÂä°AÁöÑÁ¨¨‰∏Ä‰∏™readÔºåÂÅáËÆæ‰∏∫Êó∂Èó¥TÔºõ(2)A3ËØªÂà∞ÁöÑÁªìÊûúÈõÜ‰πüÊòØ{1, 2, 3}ÔºåÂõ†‰∏∫BËøòÊ≤°ÊúâÊèê‰∫§Ôºõ(3)A4ËØªÂà∞ÁöÑÁªìÊûúÈõÜËøòÊòØ{1, 2, 3}ÔºåÂõ†‰∏∫‰∫ãÂä°BÊòØÂú®Êó∂Èó¥T‰πãÂêéÊèê‰∫§ÁöÑÔºåA4ÂæóËØªÂà∞ÂíåA2‰∏ÄÊ†∑ÁöÑËÆ∞ÂΩïÔºõÊèêÈóÆ2ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØËØªÊèê‰∫§RCÔºåA2, A3, A4ÂèàÂàÜÂà´ËØªÂà∞‰ªÄ‰πàÁªìÊûúÈõÜÂë¢ÔºüÂõûÁ≠îÔºöRC‰∏ã(1)A2ËØªÂà∞ÁöÑÁªìÊûúÈõÜÊòØ{1, 2, 3}Ôºõ(2)A3ËØªÂà∞ÁöÑÁªìÊûúÈõÜ‰πüÊòØ{1, 2, 3}ÔºåÂõ†‰∏∫BËøòÊ≤°ÊúâÊèê‰∫§Ôºõ(3)A4ËØªÂà∞ÁöÑÁªìÊûúÈõÜËøòÊòØ{1, 2, 3, 4}ÔºåÂõ†‰∏∫‰∫ãÂä°BÂ∑≤ÁªèÊèê‰∫§ ‰ªçÁÑ∂ÊòØ‰∏äÈù¢ÁöÑ‰∏§‰∏™‰∫ãÂä°ÔºåÂè™ÊòØAÂíåBÂºÄÂßãÊó∂Èó¥Á®çÊúâ‰∏çÂêå(BÂÖà‰∫éAÂºÄÂßãÔºåBÂÖà‰∫éAÁªìÊùü)12345678910111213B1: start transaction;A1: start transaction;A2: select * from t;B2: insert into t values (4, wangwu);A3: select * from t;B3: commit;A4: select * from t;ÊèêÈóÆ3ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØÂèØÈáçÂ§çËØªRRÔºå‰∫ãÂä°A‰∏≠ÁöÑ‰∏âÊ¨°Êü•ËØ¢ÔºåA2, A3, A4ÂàÜÂà´ËØªÂà∞‰ªÄ‰πàÁªìÊûúÈõÜÔºüÊèêÈóÆ4ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØËØªÊèê‰∫§RCÔºåA2, A3, A4ÁöÑÁªìÊûúÈõÜÂèàÊòØ‰ªÄ‰πàÂë¢ÔºüÂõûÁ≠îÔºö‰∫ãÂä°ÁöÑÂºÄÂßãÊó∂Èó¥‰∏ç‰∏ÄÊ†∑Ôºå‰∏ç‰ºöÂΩ±Âìç‚ÄúÂø´ÁÖßËØª‚ÄùÁöÑÁªìÊûúÔºåÊâÄ‰ª•ÁªìÊûúÈõÜÂíåcase 1‰∏ÄÊ†∑„ÄÇ ‰ªçÁÑ∂ÊòØÂπ∂ÂèëÁöÑ‰∫ãÂä°A‰∏éB(AÂÖà‰∫éBÂºÄÂßãÔºåBÂÖà‰∫éAÁªìÊùü)12345678910A1: start transaction;B1: start transaction;B2: insert into t values (4, wangwu);B3: commit;A2: select * from t;ÊèêÈóÆ5ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØÂèØÈáçÂ§çËØªRRÔºå‰∫ãÂä°A‰∏≠ÁöÑA2Êü•ËØ¢ÔºåÁªìÊûúÈõÜÊòØ‰ªÄ‰πàÔºüÊèêÈóÆ6ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØËØªÊèê‰∫§RCÔºåA2ÁöÑÁªìÊûúÈõÜÂèàÊòØ‰ªÄ‰πàÂë¢ÔºüÂõûÁ≠îÔºöÂú®RR‰∏ãÔºåA2ÊòØ‰∫ãÂä°AÁöÑÁ¨¨‰∏Ä‰∏™readÔºåÂÅáËÆæ‰∏∫Êó∂Èó¥TÔºåÂÆÉËÉΩËØªÂèñÂà∞T‰πãÂâçÊèê‰∫§‰∫ãÂä°ÂÜôÂÖ•ÁöÑÊï∞ÊçÆË°åÔºåÊïÖÁªìÊûúÈõÜ‰∏∫{1, 2, 3, 4}„ÄÇÂú®RC‰∏ãÔºåÊ≤°ÊúâÁñëÈóÆÔºå‰∏ÄÂÆöÊòØ{1, 2, 3, 4}„ÄÇ ‰∫ãÂä°ÂºÄÂßãÁöÑÊó∂Èó¥ÂÜçÊç¢‰∏Ä‰∏ã(BÂÖà‰∫éAÂºÄÂßãÔºåBÂÖà‰∫éAÁªìÊùü)12345678910B1: start transaction;A1: start transaction;B2: insert into t values (4, wangwu);B3: commit;A2: select * from t;ÊèêÈóÆ7ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØÂèØÈáçÂ§çËØªRRÔºå‰∫ãÂä°A‰∏≠ÁöÑA2Êü•ËØ¢ÔºåÁªìÊûúÈõÜÊòØ‰ªÄ‰πàÔºüÊèêÈóÆ8ÔºöÂÅáËÆæ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´ÊòØËØªÊèê‰∫§RCÔºåA2ÁöÑÁªìÊûúÈõÜÂèàÊòØ‰ªÄ‰πàÂë¢ÔºüÂõûÁ≠îÔºö‰∫ãÂä°ÁöÑÂºÄÂßãÊó∂Èó¥‰∏ç‰∏ÄÊ†∑Ôºå‰∏ç‰ºöÂΩ±Âìç‚ÄúÂø´ÁÖßËØª‚ÄùÁöÑÁªìÊûúÔºåÊâÄ‰ª•ÁªìÊûúÈõÜÂíåcase 3‰∏ÄÊ†∑„ÄÇ ÊÄªÁªìÔºö RR‰∏ãÔºå‰∫ãÂä°Âú®Á¨¨‰∏Ä‰∏™ReadÊìç‰ΩúÊó∂Ôºå‰ºöÂª∫Á´ãRead View RC‰∏ãÔºå‰∫ãÂä°Âú®ÊØèÊ¨°ReadÊìç‰ΩúÊó∂ÔºåÈÉΩ‰ºöÂª∫Á´ãRead View ÊÄé‰πàÈíàÂØπÊï∞ÊçÆÂ∫ì‰∏≠Êüê‰∏ÄÂº†Ë°®‰∏≠ÁöÑ‰∏ÄÊù°Êï∞ÊçÆ‰∏äÈîÅÔºüÁ≠îÔºö12mysql> SELECT * FROM T1 WHERE ID = 1 FOR UPDATE;mysql> SELECT * FROM T1 WHERE ID = 1 LOCK IN SHARE MODE; Ë°åÈîÅÁöÑ‰∏âÁßçÊ®°ÂºèÔºåËÆ≤ËÆ≤ÊòØ‰ªÄ‰πàÔºüÁ≠îÔºöInnoDBÊúâ‰∏âÁßçË°åÈîÅÁöÑÁÆóÊ≥ïÔºö Record LockÔºöÂçï‰∏™Ë°åËÆ∞ÂΩï‰∏äÁöÑÈîÅ„ÄÇ Gap LockÔºöÈó¥ÈöôÈîÅÔºåÈîÅÂÆö‰∏Ä‰∏™ËåÉÂõ¥Ôºå‰ΩÜ‰∏çÂåÖÊã¨ËÆ∞ÂΩïÊú¨Ë∫´„ÄÇGAPÈîÅÁöÑÁõÆÁöÑÔºåÊòØ‰∏∫‰∫ÜÈò≤Ê≠¢Âêå‰∏Ä‰∫ãÂä°ÁöÑ‰∏§Ê¨°ÂΩìÂâçËØªÔºåÂá∫Áé∞ÂπªËØªÁöÑÊÉÖÂÜµ„ÄÇ Next-Key LockÔºö1+2ÔºåÈîÅÂÆö‰∏Ä‰∏™ËåÉÂõ¥ÔºåÂπ∂‰∏îÈîÅÂÆöËÆ∞ÂΩïÊú¨Ë∫´„ÄÇÂØπ‰∫éË°åÁöÑÊü•ËØ¢ÔºåÈÉΩÊòØÈááÁî®ËØ•ÊñπÊ≥ïÔºå‰∏ªË¶ÅÁõÆÁöÑÊòØËß£ÂÜ≥ÂπªËØªÁöÑÈóÆÈ¢ò„ÄÇ innobackupexÂéüÁêÜËØ¥‰∏Ä‰∏ãÁ≠îÔºö innobackupex Âú®ÂêØÂä®ÂêéÔºå‰ºöÂÖà fork ‰∏Ä‰∏™ËøõÁ®ãÔºåÂêØÂä® xtrabackupËøõÁ®ãÔºåÁÑ∂ÂêéÂ∞±Á≠âÂæÖ xtrabackup Â§á‰ªΩÂÆå ibd Êï∞ÊçÆÊñá‰ª∂Ôºõ xtrabackup Âú®Â§á‰ªΩ InnoDB Áõ∏ÂÖ≥Êï∞ÊçÆÊó∂ÔºåÊòØÊúâ2ÁßçÁ∫øÁ®ãÁöÑÔºå1ÁßçÊòØ redo Êã∑Ë¥ùÁ∫øÁ®ãÔºåË¥üË¥£Êã∑Ë¥ù redo Êñá‰ª∂Ôºå1ÁßçÊòØ ibd Êã∑Ë¥ùÁ∫øÁ®ãÔºåË¥üË¥£Êã∑Ë¥ù ibd Êñá‰ª∂Ôºõredo Êã∑Ë¥ùÁ∫øÁ®ãÂè™Êúâ‰∏Ä‰∏™ÔºåÂú® ibd Êã∑Ë¥ùÁ∫øÁ®ã‰πãÂâçÂêØÂä®ÔºåÂú® ibd Á∫øÁ®ãÁªìÊùüÂêéÁªìÊùü„ÄÇxtrabackup ËøõÁ®ãÂºÄÂßãÊâßË°åÂêéÔºåÂÖàÂêØÂä® redo Êã∑Ë¥ùÁ∫øÁ®ãÔºå‰ªéÊúÄÊñ∞ÁöÑ checkpoint ÁÇπÂºÄÂßãÈ°∫Â∫èÊã∑Ë¥ù redo Êó•ÂøóÔºõÁÑ∂ÂêéÂÜçÂêØÂä® ibd Êï∞ÊçÆÊã∑Ë¥ùÁ∫øÁ®ãÔºåÂú® xtrabackup Êã∑Ë¥ù ibd ËøáÁ®ã‰∏≠Ôºåinnobackupex ËøõÁ®ã‰∏ÄÁõ¥Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅÔºàÁ≠âÂæÖÊñá‰ª∂Ë¢´ÂàõÂª∫Ôºâ„ÄÇ xtrabackup Êã∑Ë¥ùÂÆåÊàêidbÂêéÔºåÈÄöÁü• innobackupexÔºàÈÄöËøáÂàõÂª∫Êñá‰ª∂ÔºâÔºåÂêåÊó∂Ëá™Â∑±ËøõÂÖ•Á≠âÂæÖÔºàredo Á∫øÁ®ã‰ªçÁÑ∂ÁªßÁª≠Êã∑Ë¥ùÔºâ; innobackupex Êî∂Âà∞ xtrabackup ÈÄöÁü•ÂêéÔºåÊâßË°åFLUSH TABLES WITH READ LOCK (FTWRL)ÔºåÂèñÂæó‰∏ÄËá¥ÊÄß‰ΩçÁÇπÔºåÁÑ∂ÂêéÂºÄÂßãÂ§á‰ªΩÈùû InnoDB Êñá‰ª∂ÔºàÂåÖÊã¨ frm„ÄÅMYD„ÄÅMYI„ÄÅCSV„ÄÅopt„ÄÅparÁ≠âÔºâ„ÄÇÊã∑Ë¥ùÈùû InnoDB Êñá‰ª∂ËøáÁ®ã‰∏≠ÔºåÂõ†‰∏∫Êï∞ÊçÆÂ∫ìÂ§Ñ‰∫éÂÖ®Â±ÄÂè™ËØªÁä∂ÊÄÅÔºåÂ¶ÇÊûúÂú®‰∏öÂä°ÁöÑ‰∏ªÂ∫ìÂ§á‰ªΩÁöÑËØùÔºåË¶ÅÁâπÂà´Â∞èÂøÉÔºåÈùû InnoDB Ë°®Ôºà‰∏ªË¶ÅÊòØMyISAMÔºâÊØîËæÉÂ§öÁöÑËØùÊï¥Â∫ìÂè™ËØªÊó∂Èó¥Â∞±‰ºöÊØîËæÉÈïøÔºåËøô‰∏™ÂΩ±Âìç‰∏ÄÂÆöË¶ÅËØÑ‰º∞Âà∞„ÄÇ ÂΩì innobackupex Êã∑Ë¥ùÂÆåÊâÄÊúâÈùû InnoDB Ë°®Êñá‰ª∂ÂêéÔºåÈÄöÁü• xtrabackupÔºàÈÄöËøáÂà†Êñá‰ª∂Ôºâ ÔºåÂêåÊó∂Ëá™Â∑±ËøõÂÖ•Á≠âÂæÖÔºàÁ≠âÂæÖÂè¶‰∏Ä‰∏™Êñá‰ª∂Ë¢´ÂàõÂª∫ÔºâÔºõ xtrabackup Êî∂Âà∞ innobackupex Â§á‰ªΩÂÆåÈùû InnoDB ÈÄöÁü•ÂêéÔºåÂ∞±ÂÅúÊ≠¢ redo Êã∑Ë¥ùÁ∫øÁ®ãÔºåÁÑ∂ÂêéÈÄöÁü• innobackupexredo log Êã∑Ë¥ùÂÆåÊàêÔºàÈÄöËøáÂàõÂª∫Êñá‰ª∂ÔºâÔºõ innobackupex Êî∂Âà∞ redo Â§á‰ªΩÂÆåÊàêÈÄöÁü•ÂêéÔºåÂ∞±ÂºÄÂßãËß£ÈîÅÔºåÊâßË°å UNLOCK TABLESÔºõ ÊúÄÂêé innobackupex Âíå xtrabackup ËøõÁ®ãÂêÑËá™ÂÆåÊàêÊî∂Â∞æÂ∑•‰ΩúÔºåÂ¶ÇËµÑÊ∫êÁöÑÈáäÊîæ„ÄÅÂÜôÂ§á‰ªΩÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÁ≠âÔºåinnobackupex Á≠âÂæÖ xtrabackup Â≠êËøõÁ®ãÁªìÊùüÂêéÈÄÄÂá∫„ÄÇ Âú®‰∏äÈù¢ÊèèËø∞ÁöÑÊñá‰ª∂Êã∑Ë¥ùÔºåÈÉΩÊòØÂ§á‰ªΩËøõÁ®ãÁõ¥Êé•ÈÄöËøáÊìç‰ΩúÁ≥ªÁªüËØªÂèñÊï∞ÊçÆÊñá‰ª∂ÁöÑÔºåÂè™Âú®ÊâßË°å SQL ÂëΩ‰ª§Êó∂ÂíåÊï∞ÊçÆÂ∫ìÊúâ‰∫§‰∫íÔºåÂü∫Êú¨‰∏çÂΩ±ÂìçÊï∞ÊçÆÂ∫ìÁöÑËøêË°åÔºåÂú®Â§á‰ªΩÈùû InnoDB Êó∂‰ºöÊúâ‰∏ÄÊÆµÊó∂Èó¥Âè™ËØªÔºàÂ¶ÇÊûúÊ≤°ÊúâMyISAMË°®ÁöÑËØùÔºåÂè™ËØªÊó∂Èó¥Âú®Âá†ÁßíÂ∑¶Âè≥ÔºâÔºåÂú®Â§á‰ªΩ InnoDB Êï∞ÊçÆÊñá‰ª∂Êó∂ÔºåÂØπÊï∞ÊçÆÂ∫ìÂÆåÂÖ®Ê≤°ÊúâÂΩ±ÂìçÔºåÊòØÁúüÊ≠£ÁöÑÁÉ≠Â§á„ÄÇInnoDB ÂíåÈùû InnoDB Êñá‰ª∂ÁöÑÂ§á‰ªΩÈÉΩÊòØÈÄöËøáÊã∑Ë¥ùÊñá‰ª∂Êù•ÂÅöÁöÑÔºå‰ΩÜÊòØÂÆûÁé∞ÁöÑÊñπÂºè‰∏çÂêåÔºåÂâçËÄÖÊòØ‰ª•page‰∏∫Á≤íÂ∫¶ÂÅöÁöÑ(xtrabackup)ÔºåÂêéËÄÖÊòØ cp ÊàñËÄÖ tar ÂëΩ‰ª§(innobackupex)Ôºåxtrabackup Âú®ËØªÂèñÊØè‰∏™pageÊó∂‰ºöÊ†°È™å checksum ÂÄºÔºå‰øùËØÅÊï∞ÊçÆÂùóÊòØ‰∏ÄËá¥ÁöÑÔºåËÄå innobackupex Âú® cp MyISAM Êñá‰ª∂Êó∂Â∑≤ÁªèÂÅö‰∫ÜflushÔºàFTWRLÔºâÔºåÁ£ÅÁõò‰∏äÁöÑÊñá‰ª∂‰πüÊòØÂÆåÊï¥ÁöÑÔºåÊâÄ‰ª•ÊúÄÁªàÂ§á‰ªΩÈõÜÈáåÁöÑÊï∞ÊçÆÊñá‰ª∂ÈÉΩÊòØÂÜôÂÖ•ÂÆåÊï¥ÁöÑ„ÄÇ ÂØπNoSQLÊúâ‰∫ÜËß£ÂêóÔºümongoDBÂâØÊú¨ÈõÜÈÄâ‰∏æÊµÅÁ®ã‰ªÄ‰πàÔºüÁ≠îÔºöMongodbÂ§çÂà∂ÈõÜÁî±‰∏ÄÁªÑMongodÂÆû‰æãÔºàËøõÁ®ãÔºâÁªÑÊàêÔºåÂåÖÂê´‰∏Ä‰∏™PrimaryËäÇÁÇπÂíåÂ§ö‰∏™SecondaryËäÇÁÇπÔºåMongodb DriverÔºàÂÆ¢Êà∑Á´ØÔºâÁöÑÊâÄÊúâÊï∞ÊçÆÈÉΩÂÜôÂÖ•PrimaryÔºåSecondary‰ªéPrimaryÂêåÊ≠•ÂÜôÂÖ•ÁöÑÊï∞ÊçÆÔºå‰ª•‰øùÊåÅÂ§çÂà∂ÈõÜÂÜÖÊâÄÊúâÊàêÂëòÂ≠òÂÇ®Áõ∏ÂêåÁöÑÊï∞ÊçÆÈõÜÔºåÊèê‰æõÊï∞ÊçÆÁöÑÈ´òÂèØÁî®„ÄÇ PrimaryÈÄâ‰∏æ Â§çÂà∂ÈõÜÈÄöËøáreplSetInitiateÂëΩ‰ª§ÔºàÊàñmongo shellÁöÑrs.initiate()ÔºâËøõË°åÂàùÂßãÂåñÔºåÂàùÂßãÂåñÂêéÂêÑ‰∏™ÊàêÂëòÈó¥ÂºÄÂßãÂèëÈÄÅÂøÉË∑≥Ê∂àÊÅØÔºåÂπ∂ÂèëËµ∑PriamryÈÄâ‰∏æÊìç‰ΩúÔºåËé∑Âæó„ÄéÂ§ßÂ§öÊï∞„ÄèÊàêÂëòÊäïÁ•®ÊîØÊåÅÁöÑËäÇÁÇπÔºå‰ºöÊàê‰∏∫PrimaryÔºåÂÖ∂‰ΩôËäÇÁÇπÊàê‰∏∫Secondary„ÄÇ Â§ßÂ§öÊï∞„ÄèÁöÑÂÆö‰πâ ÂÅáËÆæÂ§çÂà∂ÈõÜÂÜÖÊäïÁ•®ÊàêÂëòÔºàÂêéÁª≠‰ªãÁªçÔºâÊï∞Èáè‰∏∫NÔºåÂàôÂ§ßÂ§öÊï∞‰∏∫ N/2 + 1ÔºåÂΩìÂ§çÂà∂ÈõÜÂÜÖÂ≠òÊ¥ªÊàêÂëòÊï∞Èáè‰∏çË∂≥Â§ßÂ§öÊï∞Êó∂ÔºåÊï¥‰∏™Â§çÂà∂ÈõÜÂ∞ÜÊó†Ê≥ïÈÄâ‰∏æÂá∫PrimaryÔºåÂ§çÂà∂ÈõÜÂ∞ÜÊó†Ê≥ïÊèê‰æõÂÜôÊúçÂä°ÔºåÂ§Ñ‰∫éÂè™ËØªÁä∂ÊÄÅ„ÄÇ ÁâπÊÆäÁöÑSecondary Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºåÂ§çÂà∂ÈõÜÁöÑSeconary‰ºöÂèÇ‰∏éPrimaryÈÄâ‰∏æÔºàËá™Ë∫´‰πüÂèØËÉΩ‰ºöË¢´ÈÄâ‰∏∫PrimaryÔºâÔºåÂπ∂‰ªéPrimaryÂêåÊ≠•ÊúÄÊñ∞ÂÜôÂÖ•ÁöÑÊï∞ÊçÆÔºå‰ª•‰øùËØÅ‰∏éPrimaryÂ≠òÂÇ®Áõ∏ÂêåÁöÑÊï∞ÊçÆ„ÄÇ SecondaryÂèØ‰ª•Êèê‰æõËØªÊúçÂä°ÔºåÂ¢ûÂä†SecondaryËäÇÁÇπÂèØ‰ª•Êèê‰æõÂ§çÂà∂ÈõÜÁöÑËØªÊúçÂä°ËÉΩÂäõÔºåÂêåÊó∂ÊèêÂçáÂ§çÂà∂ÈõÜÁöÑÂèØÁî®ÊÄß„ÄÇÂè¶Â§ñÔºåMongodbÊîØÊåÅÂØπÂ§çÂà∂ÈõÜÁöÑSecondaryËäÇÁÇπËøõË°åÁÅµÊ¥ªÁöÑÈÖçÁΩÆÔºå‰ª•ÈÄÇÂ∫îÂ§öÁßçÂú∫ÊôØÁöÑÈúÄÊ±Ç„ÄÇ ÁâπÊÆäÁöÑSecondary Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºåÂ§çÂà∂ÈõÜÁöÑSeconary‰ºöÂèÇ‰∏éPrimaryÈÄâ‰∏æÔºàËá™Ë∫´‰πüÂèØËÉΩ‰ºöË¢´ÈÄâ‰∏∫PrimaryÔºâÔºåÂπ∂‰ªéPrimaryÂêåÊ≠•ÊúÄÊñ∞ÂÜôÂÖ•ÁöÑÊï∞ÊçÆÔºå‰ª•‰øùËØÅ‰∏éPrimaryÂ≠òÂÇ®Áõ∏ÂêåÁöÑÊï∞ÊçÆ„ÄÇ SecondaryÂèØ‰ª•Êèê‰æõËØªÊúçÂä°ÔºåÂ¢ûÂä†SecondaryËäÇÁÇπÂèØ‰ª•Êèê‰æõÂ§çÂà∂ÈõÜÁöÑËØªÊúçÂä°ËÉΩÂäõÔºåÂêåÊó∂ÊèêÂçáÂ§çÂà∂ÈõÜÁöÑÂèØÁî®ÊÄß„ÄÇÂè¶Â§ñÔºåMongodbÊîØÊåÅÂØπÂ§çÂà∂ÈõÜÁöÑSecondaryËäÇÁÇπËøõË°åÁÅµÊ¥ªÁöÑÈÖçÁΩÆÔºå‰ª•ÈÄÇÂ∫îÂ§öÁßçÂú∫ÊôØÁöÑÈúÄÊ±Ç Arbiter ArbiterËäÇÁÇπÂè™ÂèÇ‰∏éÊäïÁ•®Ôºå‰∏çËÉΩË¢´ÈÄâ‰∏∫PrimaryÔºåÂπ∂‰∏î‰∏ç‰ªéPrimaryÂêåÊ≠•Êï∞ÊçÆ„ÄÇ ÊØîÂ¶Ç‰Ω†ÈÉ®ÁΩ≤‰∫Ü‰∏Ä‰∏™2‰∏™ËäÇÁÇπÁöÑÂ§çÂà∂ÈõÜÔºå1‰∏™PrimaryÔºå1‰∏™SecondaryÔºå‰ªªÊÑèËäÇÁÇπÂÆïÊú∫ÔºåÂ§çÂà∂ÈõÜÂ∞Ü‰∏çËÉΩÊèê‰æõÊúçÂä°‰∫ÜÔºàÊó†Ê≥ïÈÄâÂá∫PrimaryÔºâÔºåËøôÊó∂ÂèØ‰ª•ÁªôÂ§çÂà∂ÈõÜÊ∑ªÂä†‰∏Ä‰∏™ArbiterËäÇÁÇπÔºåÂç≥‰ΩøÊúâËäÇÁÇπÂÆïÊú∫Ôºå‰ªçËÉΩÈÄâÂá∫Primary„ÄÇ ArbiterÊú¨Ë∫´‰∏çÂ≠òÂÇ®Êï∞ÊçÆÔºåÊòØÈùûÂ∏∏ËΩªÈáèÁ∫ßÁöÑÊúçÂä°ÔºåÂΩìÂ§çÂà∂ÈõÜÊàêÂëò‰∏∫ÂÅ∂Êï∞Êó∂ÔºåÊúÄÂ•ΩÂä†ÂÖ•‰∏Ä‰∏™ArbiterËäÇÁÇπÔºå‰ª•ÊèêÂçáÂ§çÂà∂ÈõÜÂèØÁî®ÊÄß„ÄÇ Priority0 Priority0ËäÇÁÇπÁöÑÈÄâ‰∏æ‰ºòÂÖàÁ∫ß‰∏∫0Ôºå‰∏ç‰ºöË¢´ÈÄâ‰∏æ‰∏∫Primary„ÄÇ ÊØîÂ¶Ç‰Ω†Ë∑®Êú∫ÊàøA„ÄÅBÈÉ®ÁΩ≤‰∫Ü‰∏Ä‰∏™Â§çÂà∂ÈõÜÔºåÂπ∂‰∏îÊÉ≥ÊåáÂÆöPrimaryÂøÖÈ°ªÂú®AÊú∫ÊàøÔºåËøôÊó∂ÂèØ‰ª•Â∞ÜBÊú∫ÊàøÁöÑÂ§çÂà∂ÈõÜÊàêÂëòPriorityËÆæÁΩÆ‰∏∫0ÔºåËøôÊ†∑PrimaryÂ∞±‰∏ÄÂÆö‰ºöÊòØAÊú∫ÊàøÁöÑÊàêÂëò„ÄÇÔºàÊ≥®ÊÑèÔºöÂ¶ÇÊûúËøôÊ†∑ÈÉ®ÁΩ≤ÔºåÊúÄÂ•ΩÂ∞Ü„ÄéÂ§ßÂ§öÊï∞„ÄèËäÇÁÇπÈÉ®ÁΩ≤Âú®AÊú∫ÊàøÔºåÂê¶ÂàôÁΩëÁªúÂàÜÂå∫Êó∂ÂèØËÉΩÊó†Ê≥ïÈÄâÂá∫PrimaryÔºâ Vote0 Mongodb 3.0ÈáåÔºåÂ§çÂà∂ÈõÜÊàêÂëòÊúÄÂ§ö50‰∏™ÔºåÂèÇ‰∏éPrimaryÈÄâ‰∏æÊäïÁ•®ÁöÑÊàêÂëòÊúÄÂ§ö7‰∏™ÔºåÂÖ∂‰ªñÊàêÂëòÔºàVote0ÔºâÁöÑvoteÂ±ûÊÄßÂøÖÈ°ªËÆæÁΩÆ‰∏∫0ÔºåÂç≥‰∏çÂèÇ‰∏éÊäïÁ•®„ÄÇ Hidden HiddenËäÇÁÇπ‰∏çËÉΩË¢´ÈÄâ‰∏∫‰∏ªÔºàPriority‰∏∫0ÔºâÔºåÂπ∂‰∏îÂØπDriver‰∏çÂèØËßÅ„ÄÇ Âõ†HiddenËäÇÁÇπ‰∏ç‰ºöÊé•ÂèóDriverÁöÑËØ∑Ê±ÇÔºåÂèØ‰ΩøÁî®HiddenËäÇÁÇπÂÅö‰∏Ä‰∫õÊï∞ÊçÆÂ§á‰ªΩ„ÄÅÁ¶ªÁ∫øËÆ°ÁÆóÁöÑ‰ªªÂä°Ôºå‰∏ç‰ºöÂΩ±ÂìçÂ§çÂà∂ÈõÜÁöÑÊúçÂä°„ÄÇ Delayed DelayedËäÇÁÇπÂøÖÈ°ªÊòØHiddenËäÇÁÇπÔºåÂπ∂‰∏îÂÖ∂Êï∞ÊçÆËêΩÂêé‰∏éPrimary‰∏ÄÊÆµÊó∂Èó¥ÔºàÂèØÈÖçÁΩÆÔºåÊØîÂ¶Ç1‰∏™Â∞èÊó∂Ôºâ„ÄÇ Âõ†DelayedËäÇÁÇπÁöÑÊï∞ÊçÆÊØîPrimaryËêΩÂêé‰∏ÄÊÆµÊó∂Èó¥ÔºåÂΩìÈîôËØØÊàñËÄÖÊó†ÊïàÁöÑÊï∞ÊçÆÂÜôÂÖ•PrimaryÊó∂ÔºåÂèØÈÄöËøáDelayedËäÇÁÇπÁöÑÊï∞ÊçÆÊù•ÊÅ¢Â§çÂà∞‰πãÂâçÁöÑÊó∂Èó¥ÁÇπ„ÄÇ Êï∞ÊçÆÂêåÊ≠• Primary‰∏éSecondary‰πãÈó¥ÈÄöËøáoplogÊù•ÂêåÊ≠•Êï∞ÊçÆÔºåPrimary‰∏äÁöÑÂÜôÊìç‰ΩúÂÆåÊàêÂêéÔºå‰ºöÂêëÁâπÊÆäÁöÑlocal.oplog.rsÁâπÊÆäÈõÜÂêàÂÜôÂÖ•‰∏ÄÊù°oplogÔºåSecondary‰∏çÊñ≠ÁöÑ‰ªéPrimaryÂèñÊñ∞ÁöÑoplogÂπ∂Â∫îÁî®„ÄÇ Âõ†oplogÁöÑÊï∞ÊçÆ‰ºö‰∏çÊñ≠Â¢ûÂä†Ôºålocal.oplog.rsË¢´ËÆæÁΩÆÊàê‰∏∫‰∏Ä‰∏™cappedÈõÜÂêàÔºåÂΩìÂÆπÈáèËææÂà∞ÈÖçÁΩÆ‰∏äÈôêÊó∂Ôºå‰ºöÂ∞ÜÊúÄÊóßÁöÑÊï∞ÊçÆÂà†Èô§Êéâ„ÄÇÂè¶Â§ñËÄÉËôëÂà∞oplogÂú®Secondary‰∏äÂèØËÉΩÈáçÂ§çÂ∫îÁî®ÔºåoplogÂøÖÈ°ªÂÖ∑ÊúâÂπÇÁ≠âÊÄßÔºåÂç≥ÈáçÂ§çÂ∫îÁî®‰πü‰ºöÂæóÂà∞Áõ∏ÂêåÁöÑÁªìÊûú„ÄÇ oplogÈáåÂêÑ‰∏™Â≠óÊÆµÁöÑÂê´‰πâÂ¶Ç‰∏ã tsÔºö Êìç‰ΩúÊó∂Èó¥ÔºåÂΩìÂâçtimestamp + ËÆ°Êï∞Âô®ÔºåËÆ°Êï∞Âô®ÊØèÁßíÈÉΩË¢´ÈáçÁΩÆ hÔºöÊìç‰ΩúÁöÑÂÖ®Â±ÄÂîØ‰∏ÄÊ†áËØÜ vÔºöoplogÁâàÊú¨‰ø°ÊÅØ opÔºöÊìç‰ΩúÁ±ªÂûã iÔºöÊèíÂÖ•Êìç‰Ωú uÔºöÊõ¥Êñ∞Êìç‰Ωú dÔºöÂà†Èô§Êìç‰Ωú cÔºöÊâßË°åÂëΩ‰ª§ÔºàÂ¶ÇcreateDatabaseÔºådropDatabaseÔºâ nÔºöÁ©∫Êìç‰ΩúÔºåÁâπÊÆäÁî®ÈÄî nsÔºöÊìç‰ΩúÈíàÂØπÁöÑÈõÜÂêà oÔºöÊìç‰ΩúÂÜÖÂÆπÔºåÂ¶ÇÊûúÊòØÊõ¥Êñ∞Êìç‰Ωú o2ÔºöÊìç‰ΩúÊü•ËØ¢Êù°‰ª∂Ôºå‰ªÖupdateÊìç‰ΩúÂåÖÂê´ËØ•Â≠óÊÆµSecondaryÂàùÊ¨°ÂêåÊ≠•Êï∞ÊçÆÊó∂Ôºå‰ºöÂÖàËøõË°åinit syncÔºå‰ªéPrimaryÔºàÊàñÂÖ∂‰ªñÊï∞ÊçÆÊõ¥Êñ∞ÁöÑSecondaryÔºâÂêåÊ≠•ÂÖ®ÈáèÊï∞ÊçÆÔºåÁÑ∂Âêé‰∏çÊñ≠ÈÄöËøátailable cursor‰ªéPrimaryÁöÑlocal.oplog.rsÈõÜÂêàÈáåÊü•ËØ¢ÊúÄÊñ∞ÁöÑoplogÂπ∂Â∫îÁî®Âà∞Ëá™Ë∫´„ÄÇ T1Êó∂Èó¥Ôºå‰ªéPrimaryÂêåÊ≠•ÊâÄÊúâÊï∞ÊçÆÂ∫ìÁöÑÊï∞ÊçÆÔºàlocalÈô§Â§ñÔºâÔºåÈÄöËøálistDatabases + listCollections + cloneCollectionÊïèÂëΩ‰ª§ÁªÑÂêàÂÆåÊàêÔºåÂÅáËÆæT2Êó∂Èó¥ÂÆåÊàêÊâÄÊúâÊìç‰Ωú„ÄÇ ‰ªéPrimaryÂ∫îÁî®[T1-T2]Êó∂Èó¥ÊÆµÂÜÖÁöÑÊâÄÊúâoplogÔºåÂèØËÉΩÈÉ®ÂàÜÊìç‰ΩúÂ∑≤ÁªèÂåÖÂê´Âú®Ê≠•È™§1Ôºå‰ΩÜÁî±‰∫éoplogÁöÑÂπÇÁ≠âÊÄßÔºåÂèØÈáçÂ§çÂ∫îÁî®„ÄÇ Ê†πÊçÆPrimaryÂêÑÈõÜÂêàÁöÑindexËÆæÁΩÆÔºåÂú®Secondary‰∏ä‰∏∫Áõ∏Â∫îÈõÜÂêàÂàõÂª∫index„ÄÇÔºàÊØè‰∏™ÈõÜÂêà_idÁöÑindexÂ∑≤Âú®Ê≠•È™§1‰∏≠ÂÆåÊàêÔºâ„ÄÇ oplogÈõÜÂêàÁöÑÂ§ßÂ∞èÂ∫îÊ†πÊçÆDBËßÑÊ®°ÂèäÂ∫îÁî®ÂÜôÂÖ•ÈúÄÊ±ÇÂêàÁêÜÈÖçÁΩÆÔºåÈÖçÁΩÆÂæóÂ§™Â§ßÔºå‰ºöÈÄ†ÊàêÂ≠òÂÇ®Á©∫Èó¥ÁöÑÊµ™Ë¥πÔºõÈÖçÁΩÆÂæóÂ§™Â∞èÔºåÂèØËÉΩÈÄ†ÊàêSecondaryÁöÑinit sync‰∏ÄÁõ¥Êó†Ê≥ïÊàêÂäü„ÄÇÊØîÂ¶ÇÂú®Ê≠•È™§1ÈáåÁî±‰∫éDBÊï∞ÊçÆÂ§™Â§ö„ÄÅÂπ∂‰∏îoplogÈÖçÁΩÆÂ§™Â∞èÔºåÂØºËá¥oplog‰∏çË∂≥‰ª•Â≠òÂÇ®[T1, T2]Êó∂Èó¥ÂÜÖÁöÑÊâÄÊúâoplogÔºåËøôÂ∞±SecondaryÊó†Ê≥ï‰ªéPrimary‰∏äÂêåÊ≠•ÂÆåÊï¥ÁöÑÊï∞ÊçÆÈõÜ„ÄÇÁªÜËØ¥PrimaryÈÄâ‰∏æPrimaryÈÄâ‰∏æÈô§‰∫ÜÂú®Â§çÂà∂ÈõÜÂàùÂßãÂåñÊó∂ÂèëÁîüÔºåËøòÊúâÂ¶Ç‰∏ãÂú∫ÊôØ Â§çÂà∂ÈõÜË¢´reconfig SecondaryËäÇÁÇπÊ£ÄÊµãÂà∞PrimaryÂÆïÊú∫Êó∂Ôºå‰ºöËß¶ÂèëÊñ∞PrimaryÁöÑÈÄâ‰∏æ ÂΩìÊúâPrimaryËäÇÁÇπ‰∏ªÂä®stepDownÔºà‰∏ªÂä®ÈôçÁ∫ß‰∏∫SecondaryÔºâÊó∂Ôºå‰πü‰ºöËß¶ÂèëÊñ∞ÁöÑPrimaryÈÄâ‰∏æPrimaryÁöÑÈÄâ‰∏æÂèóËäÇÁÇπÈó¥ÂøÉË∑≥„ÄÅ‰ºòÂÖàÁ∫ß„ÄÅÊúÄÊñ∞ÁöÑoplogÊó∂Èó¥Á≠âÂ§öÁßçÂõ†Á¥†ÂΩ±Âìç„ÄÇËäÇÁÇπÈó¥ÂøÉË∑≥Â§çÂà∂ÈõÜÊàêÂëòÈó¥ÈªòËÆ§ÊØè2s‰ºöÂèëÈÄÅ‰∏ÄÊ¨°ÂøÉË∑≥‰ø°ÊÅØÔºåÂ¶ÇÊûú10sÊú™Êî∂Âà∞Êüê‰∏™ËäÇÁÇπÁöÑÂøÉË∑≥ÔºåÂàôËÆ§‰∏∫ËØ•ËäÇÁÇπÂ∑≤ÂÆïÊú∫ÔºõÂ¶ÇÊûúÂÆïÊú∫ÁöÑËäÇÁÇπ‰∏∫PrimaryÔºåSecondaryÔºàÂâçÊèêÊòØÂèØË¢´ÈÄâ‰∏∫PrimaryÔºâ‰ºöÂèëËµ∑Êñ∞ÁöÑPrimaryÈÄâ‰∏æ„ÄÇËäÇÁÇπ‰ºòÂÖàÁ∫ß ÊØè‰∏™ËäÇÁÇπÈÉΩÂÄæÂêë‰∫éÊäïÁ•®Áªô‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑËäÇÁÇπ ‰ºòÂÖàÁ∫ß‰∏∫0ÁöÑËäÇÁÇπ‰∏ç‰ºö‰∏ªÂä®ÂèëËµ∑PrimaryÈÄâ‰∏æ ÂΩìPrimaryÂèëÁé∞Êúâ‰ºòÂÖàÁ∫ßÊõ¥È´òSecondaryÔºåÂπ∂‰∏îËØ•SecondaryÁöÑÊï∞ÊçÆËêΩÂêéÂú®10sÂÜÖÔºåÂàôPrimary‰ºö‰∏ªÂä®ÈôçÁ∫ßÔºåËÆ©‰ºòÂÖàÁ∫ßÊõ¥È´òÁöÑSecondaryÊúâÊàê‰∏∫PrimaryÁöÑÊú∫‰ºö„ÄÇOptime Êã•ÊúâÊúÄÊñ∞optimeÔºàÊúÄËøë‰∏ÄÊù°oplogÁöÑÊó∂Èó¥Êà≥ÔºâÁöÑËäÇÁÇπÊâçËÉΩË¢´ÈÄâ‰∏∫‰∏ª„ÄÇ ÁΩëÁªúÂàÜÂå∫ Âè™ÊúâÊõ¥Â§ßÂ§öÊï∞ÊäïÁ•®ËäÇÁÇπÈó¥‰øùÊåÅÁΩëÁªúËøûÈÄöÔºåÊâçÊúâÊú∫‰ºöË¢´ÈÄâPrimaryÔºõÂ¶ÇÊûúPrimary‰∏éÂ§ßÂ§öÊï∞ÁöÑËäÇÁÇπÊñ≠ÂºÄËøûÊé•ÔºåPrimary‰ºö‰∏ªÂä®ÈôçÁ∫ß‰∏∫Secondary„ÄÇÂΩìÂèëÁîüÁΩëÁªúÂàÜÂå∫Êó∂ÔºåÂèØËÉΩÂú®Áü≠Êó∂Èó¥ÂÜÖÂá∫Áé∞Â§ö‰∏™PrimaryÔºåÊïÖDriverÂú®ÂÜôÂÖ•Êó∂ÔºåÊúÄÂ•ΩËÆæÁΩÆ„ÄéÂ§ßÂ§öÊï∞ÊàêÂäü„ÄèÁöÑÁ≠ñÁï•ÔºåËøôÊ†∑Âç≥‰ΩøÂá∫Áé∞Â§ö‰∏™PrimaryÔºå‰πüÂè™Êúâ‰∏Ä‰∏™PrimaryËÉΩÊàêÂäüÂÜôÂÖ•Â§ßÂ§öÊï∞„ÄÇ ËØ¥ËØ¥TCPÂçèËÆÆÊµÅÁ®ãÁ≠îÔºö Â≠óÊÆµ Âê´‰πâ URG Á¥ßÊÄ•ÊåáÈíàÊòØÂê¶ÊúâÊïà„ÄÇ‰∏∫1ÔºåË°®Á§∫Êüê‰∏Ä‰ΩçÈúÄË¶ÅË¢´‰ºòÂÖàÂ§ÑÁêÜ ACK Á°ÆËÆ§Âè∑ÊòØÂê¶ÊúâÊïàÔºå‰∏ÄËà¨ÁΩÆ‰∏∫1„ÄÇ PSH ÊèêÁ§∫Êé•Êî∂Á´ØÂ∫îÁî®Á®ãÂ∫èÁ´ãÂç≥‰ªéTCPÁºìÂÜ≤Âå∫ÊääÊï∞ÊçÆËØªËµ∞„ÄÇ RST ÂØπÊñπË¶ÅÊ±ÇÈáçÊñ∞Âª∫Á´ãËøûÊé•ÔºåÂ§ç‰Ωç„ÄÇ SYN ËØ∑Ê±ÇÂª∫Á´ãËøûÊé•ÔºåÂπ∂Âú®ÂÖ∂Â∫èÂàóÂè∑ÁöÑÂ≠óÊÆµËøõË°åÂ∫èÂàóÂè∑ÁöÑÂàùÂßãÂÄºËÆæÂÆö„ÄÇÂª∫Á´ãËøûÊé•ÔºåËÆæÁΩÆ‰∏∫1 FIN Â∏åÊúõÊñ≠ÂºÄËøûÊé•„ÄÇ TCP Êè°Êâã Á¨¨‰∏ÄÊ¨°Êè°Êâã ÂÆ¢Êà∑Á´ØÂèëÈÄÅÊï∞ÊçÆÂåÖÂà∞ÊúçÂä°Âô®,(Âú®Ê≠§ËøûÊé•ËØ∑Ê±ÇÊä•ÊñáÊÆµ‰∏≠ÁöÑÂêåÊ≠•‰ΩçSYN=1,Á°ÆËÆ§ACK=0,Ë°®Á§∫ËøôÊòØ‰∏Ä‰∏™TCPËøûÊé•ËØ∑Ê±ÇÊï∞ÊçÆÊä•Êñá,Â∫èÂè∑seq=x,Ë°®Á§∫‰º†ËæìÊï∞ÊçÆÊó∂ÁöÑËµ∑ÂßãÂ∫èÂè∑ÊòØx)Ê≠§Êó∂,ÂÆ¢Êà∑Á´ØËøõÂÖ•SYN_SENTÁä∂ÊÄÅ,Á≠âÂæÖÊúçÂä°Âô®Á°ÆËÆ§ Á¨¨‰∫åÊ¨°Êè°Êâã ÊúçÂä°Âô®Êî∂Âà∞ËøûÊé•ËØ∑Ê±ÇÊä•ÊñáÊÆµÂêéÔºåËã•ÂêåÊÑèÂª∫Á´ãËøûÊé•,ÂàôÂêëÂÆ¢Êà∑Á´ØÂèëÈÄÅÁ°ÆËÆ§Êä•ÊñáÊÆµ„ÄÇÊ≠§Êó∂ÊúçÂä°Âô®ËøõÂÖ•SYN_RECVÁä∂ÊÄÅ„ÄÇÔºàÂÖ∂‰∏≠Á°ÆËÆ§Êä•ÊñáÊÆµ‰∏≠ÔºåÊ†áËØÜ‰ΩçSYN=1ÔºåACK=1ÔºåË°®Á§∫ËøôÊòØ‰∏Ä‰∏™TCPËøûÊé•ÂìçÂ∫îÊï∞ÊçÆÊä•ÊñáÔºåÂπ∂Âê´ÊúçÂä°Á´ØÁöÑÂàùÂßãÂ∫èÂè∑seq(ÊúçÂä°Âô®)=yÔºå‰ª•ÂèäÊúçÂä°Âô®ÂØπÂÆ¢Êà∑Á´ØÂàùÂßãÂ∫èÂè∑ÁöÑÁ°ÆËÆ§Âè∑ack(ÊúçÂä°Âô®)=seq(ÂÆ¢Êà∑Á´Ø)+1=x+1Ôºâ„ÄÇ Á¨¨‰∏âÊ¨°Êè°Êâã ÂÆ¢Êà∑Á´ØÂÜçÊ¨°ÂêëÊúçÂä°Âô®ÂèëÈÄÅ‰∏Ä‰∏™Â∫èÂàóÂè∑(seq=x+1)ÔºåÁ°ÆËÆ§Âè∑‰∏∫ack(ÂÆ¢Êà∑Á´Ø)=y+1ÔºåÊ≠§ÂåÖÂèëÈÄÅÂÆåÊØïÔºåÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®ËøõÂÖ•ESTAB_LISHED(TCPËøûÊé•ÊàêÂäü)Áä∂ÊÄÅÔºåÂÆåÊàê‰∏âÊ¨°Êè°Êâã„ÄÇ TCPÈáäÊîæ Á¨¨‰∏ÄÊ¨°Êå•Êâã È¶ñÂÖàÔºåÂÆ¢Êà∑Á´ØÂèëÈÄÅ‰∏Ä‰∏™FINÔºåÁî®Êù•ÂÖ≥Èó≠ÂÆ¢Êà∑Á´ØÂà∞ÊúçÂä°Âô®ÁöÑÊï∞ÊçÆ‰º†ÈÄÅÔºåÁÑ∂ÂêéÁ≠âÂæÖÊúçÂä°Âô®ÁöÑÁ°ÆËÆ§„ÄÇÂÖ∂‰∏≠ÁªàÊ≠¢Ê†áÂøó‰ΩçFIN=1ÔºåÂ∫èÂàóÂè∑seq=u„ÄÇ Á¨¨‰∫åÊ¨°Êå•Êâã ÊúçÂä°Âô®Êî∂Âà∞Ëøô‰∏™FINÔºåÂÆÉÂèëÈÄÅ‰∏Ä‰∏™ACKÔºåÁ°ÆËÆ§ack‰∏∫Êî∂Âà∞ÁöÑÂ∫èÂè∑Âä†‰∏Ä„ÄÇ Á¨¨‰∏âÊ¨°Êå•Êâã ÂÖ≥Èó≠ÊúçÂä°Âô®Âà∞ÂÆ¢Êà∑Á´ØÁöÑËøûÊé•ÔºåÂèëÈÄÅ‰∏Ä‰∏™FINÁªôÂÆ¢Êà∑Á´Ø„ÄÇ Á¨¨ÂõõÊ¨°Êå•Êâã ÂÆ¢Êà∑Á´ØÊî∂Âà∞FINÂêéÔºåÂπ∂ÂèëÂõû‰∏Ä‰∏™ACKÊä•ÊñáÁ°ÆËÆ§ÔºåÂπ∂Â∞ÜÁ°ÆËÆ§Â∫èÂè∑seqËÆæÁΩÆ‰∏∫Êî∂Âà∞Â∫èÂè∑Âä†‰∏Ä„ÄÇÈ¶ñÂÖàËøõË°åÂÖ≥Èó≠ÁöÑ‰∏ÄÊñπÂ∞ÜÊâßË°å‰∏ªÂä®ÂÖ≥Èó≠ÔºåËÄåÂè¶‰∏ÄÊñπÊâßË°åË¢´Âä®ÂÖ≥Èó≠„ÄÇ TCP Êå•ÊâãÊÄªÁªìÂÆ¢Êà∑Á´ØÂèëÈÄÅFINÂêéÔºåËøõÂÖ•ÁªàÊ≠¢Á≠âÂæÖÁä∂ÊÄÅÔºåÊúçÂä°Âô®Êî∂Âà∞ÂÆ¢Êà∑Á´ØËøûÊé•ÈáäÊîæÊä•ÊñáÊÆµÂêéÔºåÂ∞±Á´ãÂç≥ÁªôÂÆ¢Êà∑Á´ØÂèëÈÄÅÁ°ÆËÆ§ÔºåÊúçÂä°Âô®Â∞±ËøõÂÖ•CLOSE_WAITÁä∂ÊÄÅÔºåÊ≠§Êó∂TCPÊúçÂä°Âô®ËøõÁ®ãÂ∞±ÈÄöÁü•È´òÂ±ÇÂ∫îÁî®ËøõÁ®ãÔºåÂõ†ËÄå‰ªéÂÆ¢Êà∑Á´ØÂà∞ÊúçÂä°Âô®ÁöÑËøûÊé•Â∞±ÈáäÊîæ‰∫Ü„ÄÇÊ≠§Êó∂ÊòØ‚ÄúÂçäÂÖ≥Èó≠Áä∂ÊÄÅ‚ÄùÔºåÂç≥ÂÆ¢Êà∑Á´Ø‰∏çÂèØ‰ª•ÂèëÈÄÅÁªôÊúçÂä°Âô®ÔºåÊúçÂä°Âô®ÂèØ‰ª•ÂèëÈÄÅÁªôÂÆ¢Êà∑Á´Ø„ÄÇÊ≠§Êó∂ÔºåÂ¶ÇÊûúÊúçÂä°Âô®Ê≤°ÊúâÊï∞ÊçÆÊä•ÂèëÈÄÅÁªôÂÆ¢Êà∑Á´ØÔºåÂÖ∂Â∫îÁî®Á®ãÂ∫èÂ∞±ÈÄöÁü•TCPÈáäÊîæËøûÊé•ÔºåÁÑ∂ÂêéÂèëÈÄÅÁªôÂÆ¢Êà∑Á´ØËøûÊé•ÈáäÊîæÊï∞ÊçÆÊä•ÔºåÂπ∂Á≠âÂæÖÁ°ÆËÆ§„ÄÇÂÆ¢Êà∑Á´ØÂèëÈÄÅÁ°ÆËÆ§ÂêéÔºåËøõÂÖ•TIME_WAITÁä∂ÊÄÅÔºå‰ΩÜÊòØÊ≠§Êó∂TCPËøûÊé•ËøòÊ≤°ÊúâÈáäÊîæÔºåÁÑ∂ÂêéÁªèËøáÁ≠âÂæÖËÆ°Êó∂Âô®ËÆæÁΩÆÁöÑ2MSLÂêéÔºåÊâçËøõÂÖ•Âà∞CLOSEÁä∂ÊÄÅ„ÄÇ MySQLÁöÑ Double Writer(ÂèåÂÜô)ÊòØ‰ªÄ‰πàÔºüÁ≠îÔºöÊúâ‰∏Ä‰∏™double write bufferÔºåÂ§ßÂ∞è‰∏∫2M„ÄÇÂè¶‰∏ÄÈÉ®ÂàÜÊòØÁâ©ÁêÜÁ£ÅÁõò‰∏äibdataÁ≥ªÁªüË°®Á©∫Èó¥‰∏≠Â§ßÂ∞è‰∏∫2MBÔºåÂÖ±128‰∏™ËøûÁª≠ÁöÑPageÔºåÊó¢2‰∏™ÂàÜÂå∫„ÄÇÂÖ∂‰∏≠120‰∏™Áî®‰∫éÊâπÈáèÂÜôËÑèÔºåÂè¶Â§ñ8‰∏™Áî®‰∫éSingle Page Flush„ÄÇÂÅöÂå∫ÂàÜÁöÑÂéüÂõ†ÊòØÊâπÈáèÂà∑ËÑèÊòØÂêéÂè∞Á∫øÁ®ãÂÅöÁöÑÔºå‰∏çÂΩ±ÂìçÂâçÂè∞Á∫øÁ®ã„ÄÇËÄåSingle page flushÊòØÁî®Êà∑Á∫øÁ®ãÂèëËµ∑ÁöÑÔºåÈúÄË¶ÅÂ∞ΩÂø´ÁöÑÂà∑ËÑèÂπ∂ÊõøÊç¢Âá∫‰∏Ä‰∏™Á©∫Èó≤È°µÂá∫Êù•„ÄÇÂØπ‰∫éÊâπÈáèÂà∑ËÑèÔºåÊØèÊ¨°ÊâæÂà∞‰∏Ä‰∏™ÂèØÂÅöflushÁöÑpageÔºåÂØπÂÖ∂ÊåÅÊúâS lockÔºåÁÑ∂ÂêéÂ∞ÜËØ•pageÊã∑Ë¥ùÂà∞dblwr‰∏≠ÔºåÂΩìdblwrÊª°ÂêéËÄÖ‰∏ÄÊ¨°ÊâπÈáèÂà∑ËÑèÁªìÊùüÊó∂ÔºåÂ∞Üdblwr‰∏≠ÁöÑpageÂÖ®ÈÉ®Âà∑Âà∞ibdata‰∏≠ÔºåÊ≥®ÊÑèËøôÊòØÂêåÊ≠•ÂÜôÊìç‰ΩúÔºõÁÑ∂ÂêéÂÜçÂî§ÈÜíÂêéÂè∞IOÁ∫øÁ®ãÂéªÂÜôÊï∞ÊçÆÈ°µ„ÄÇÂΩìÂêéÂè∞IOÁ∫øÁ®ãÂÆåÊàêÂÜôÊìç‰ΩúÂêéÔºå‰ºöÂéªÊõ¥Êñ∞dblwr‰∏≠ÁöÑËÆ°Êï∞‰ª•ËÖæÂá∫Á©∫Èó¥ÔºåÈáäÊîæblock‰∏äÁöÑSÈîÅÔºåÂÆåÊàêÂÜôÂÖ•„ÄÇ ÂØπ‰∫éSingle Page FlushÔºåÂàôÂÅöÁöÑÊòØÂêåÊ≠•ÂÜôÊìç‰ΩúÔºåÂú®ÊåëÂá∫‰∏Ä‰∏™ÂèØ‰ª•Âà∑ËÑèÁöÑpageÂêéÔºåÂÖàÂä†ÂÖ•Âà∞dblwr‰∏≠ÔºåÂà∑Âà∞ibdataÔºåÁÑ∂ÂêéÂÜôÂà∞Áî®Êà∑Ë°®Á©∫Èó¥ÔºåÂÆåÊàêÂêéÔºå‰ºöÂØπËØ•Áî®Êà∑Ë°®Á©∫Èó¥ÂÅö‰∏ÄÊ¨°fsyncÊìç‰Ωú„ÄÇ Single Page FlushÂú®buffer pool‰∏≠free page‰∏çÂ§üÊó∂Ëß¶ÂèëÔºåÈÄöÂ∏∏Áî±ÂâçÂè∞Á∫øÁ®ãÂèëËµ∑ÔºåÁî±‰∫éÊØèÊ¨°single page flushÈÉΩ‰ºöÂØºËá¥‰∏ÄÊ¨°fsyncÊìç‰ΩúÔºåÂú®Â§ßÂπ∂ÂèëË¥üËΩΩ‰∏ãÔºåÂ¶ÇÊûúÂ§ßÈáèÁ∫øÁ®ãÂéªÂÅöflushÔºåÂæàÊòæÁÑ∂‰ºö‰∫ßÁîü‰∏•ÈáçÁöÑÊÄßËÉΩ‰∏ãÈôç„ÄÇPerconaÂú®5.6ÁâàÊú¨‰∏≠ÂÅö‰∫Ü‰ºòÂåñÔºåÂèØ‰ª•ÈÄâÊã©Áî±ÂêéÂè∞Á∫øÁ®ãlru managerÊù•ÂÅöÈ¢ÑÂà∑ÔºåÈÅøÂÖçÁî®Êà∑Á∫øÁ®ãÈô∑ÂÖ•ÂÖ∂‰∏≠„ÄÇ Â¶ÇÊûúÂèëÁîü‰∫ÜÊûÅÁ´ØÊÉÖÂÜµÔºàÊñ≠ÁîµÔºâCrash RecoveryÔºåInnoDBÂÜçÊ¨°ÂêØÂä®ÂêéÔºåÂèëÁé∞‰∫Ü‰∏Ä‰∏™PageÊï∞ÊçÆÂ∑≤ÁªèÊçüÂùèÔºåÈÇ£‰πàÊ≠§Êó∂Â∞±ÂèØ‰ª•‰ªédouble write buffer‰∏≠ËøõË°åÊï∞ÊçÆÊÅ¢Â§ç‰∫Ü„ÄÇËß¶ÂèëÊï∞ÊçÆÁºìÂÜ≤Ê±†‰∏≠ÁöÑËÑèÈ°µËøõË°åÂà∑Êñ∞Âà∞data fileÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏çÁõ¥Êé•ÂÜôÁ£ÅÁõòÔºåËÄåÊòØ‰ºöÈÄöËøámemcpyÂáΩÊï∞Â∞ÜËÑèÈ°µÂÖàÂ§çÂà∂Âà∞ÂÜÖÂ≠ò‰∏≠ÁöÑdouble write bufferÔºå‰πãÂêéÈÄöËøádouble write bufferÂÜçÂàÜ‰∏§Ê¨°„ÄÅÊØèÊ¨°1MBÈ°∫Â∫èÂÜôÂÖ•ÂÖ±‰∫´Ë°®Á©∫Èó¥ÁöÑÁâ©ÁêÜÁ£ÅÁõò‰∏ä„ÄÇÁÑ∂ÂêéÈ©¨‰∏äË∞ÉÁî®fsyncÂáΩÊï∞ÔºåÂêåÊ≠•ËÑèÈ°µËøõÁ£ÅÁõò‰∏ä„ÄÇÁî±‰∫éÂú®Ëøô‰∏™ËøáÁ®ã‰∏≠Ôºådouble writeÈ°µÁöÑÂ≠òÂÇ®Êó∂ËøûÁª≠ÁöÑÔºåÂõ†Ê≠§ÂÜôÂÖ•Á£ÅÁõò‰∏∫È°∫Â∫èÂÜôÔºåÊÄßËÉΩÂæàÈ´òÔºõÂÆåÊàêdouble writeÂêéÔºåÂÜçÂ∞ÜËÑèÈ°µÂÜôÂÖ•ÂÆûÈôÖÁöÑÂêÑ‰∏™Ë°®Á©∫Èó¥Êñá‰ª∂„ÄÇ MySQL ÂçäÂêåÊ≠•‰∏≠5.7ÊØî5.6ÁöÑ‰ºòÁÇπÊòØÈÇ£‰∫õÂë¢ÔºüÁ≠îÔºöÂçäÂêåÊ≠•Â§çÂà∂ÔºåÊôÆÈÄöÁöÑreplicationÔºåÂç≥mysqlÁöÑÂºÇÊ≠•Â§çÂà∂Ôºå‰æùÈù†mysql‰∫åËøõÂà∂Êó•Âøó‰πüÂç≥binary logËøõË°åÊï∞ÊçÆÂ§çÂà∂„ÄÇÊØîÂ¶Ç‰∏§Âè∞Êú∫Âô®Ôºå‰∏ÄÂè∞‰∏ªÊú∫(master)ÔºåÂè¶Â§ñ‰∏ÄÂè∞ÊòØ‰ªéÊú∫(slave)„ÄÇ Ê≠£Â∏∏ÁöÑÂ§çÂà∂‰∏∫Ôºö‰∫ãÂä°‰∏ÄÔºàt1ÔºâÂÜôÂÖ•binlog bufferÔºõdumper Á∫øÁ®ãÈÄöÁü•slaveÊúâÊñ∞ÁöÑ‰∫ãÂä°t1Ôºõbinlog buffer ËøõË°åcheckpointÔºõslaveÁöÑioÁ∫øÁ®ãÊé•Êî∂Âà∞t1Âπ∂ÂÜôÂÖ•Âà∞Ëá™Â∑±ÁöÑÁöÑrelay logÔºõslaveÁöÑsqlÁ∫øÁ®ãÂÜôÂÖ•Âà∞Êú¨Âú∞Êï∞ÊçÆÂ∫ì„ÄÇ ËøôÊó∂ÔºåmasterÂíåslaveÈÉΩËÉΩÁúãÂà∞ËøôÊù°Êñ∞ÁöÑ‰∫ãÂä°ÔºåÂç≥‰ΩømasterÊåÇ‰∫ÜÔºåslaveÂèØ‰ª•ÊèêÂçá‰∏∫Êñ∞ÁöÑmaster„ÄÇ ÂºÇÂ∏∏ÁöÑÂ§çÂà∂‰∏∫Ôºö‰∫ãÂä°‰∏ÄÔºàt1ÔºâÂÜôÂÖ•binlog bufferÔºõdumper Á∫øÁ®ãÈÄöÁü•slaveÊúâÊñ∞ÁöÑ‰∫ãÂä°t1Ôºõbinlog buffer ËøõË°åcheckpointÔºõslaveÂõ†‰∏∫ÁΩëÁªú‰∏çÁ®≥ÂÆöÔºå‰∏ÄÁõ¥Ê≤°ÊúâÊî∂Âà∞t1Ôºõmaster ÊåÇÊéâÔºåslaveÊèêÂçá‰∏∫Êñ∞ÁöÑmasterÔºåt1‰∏¢Â§±„ÄÇ ÂæàÂ§ßÁöÑÈóÆÈ¢òÊòØÔºö‰∏ªÊú∫Âíå‰ªéÊú∫‰∫ãÂä°Êõ¥Êñ∞ÁöÑ‰∏çÂêåÊ≠•ÔºåÂ∞±ÁÆóÊòØÊ≤°ÊúâÁΩëÁªúÊàñËÄÖÂÖ∂‰ªñÁ≥ªÁªüÁöÑÂºÇÂ∏∏ÔºåÂΩì‰∏öÂä°Âπ∂Âèë‰∏äÊù•Êó∂ÔºåslaveÂõ†‰∏∫Ë¶ÅÈ°∫Â∫èÊâßË°åmasterÊâπÈáè‰∫ãÂä°ÔºåÂØºËá¥ÂæàÂ§ßÁöÑÂª∂Ëøü„ÄÇ ‰∏∫‰∫ÜÂº•Ë°•‰ª•‰∏äÂá†ÁßçÂú∫ÊôØÁöÑ‰∏çË∂≥Ôºåmysql‰ªé5.5ÂºÄÂßãÊé®Âá∫‰∫ÜÂçäÂêåÊ≠•„ÄÇÂç≥Âú®masterÁöÑdumperÁ∫øÁ®ãÈÄöÁü•slaveÂêéÔºåÂ¢ûÂä†‰∫Ü‰∏Ä‰∏™ackÔºåÂç≥ÊòØÂê¶ÊàêÂäüÊî∂Âà∞t1ÁöÑÊ†áÂøóÁ†Å„ÄÇ‰πüÂ∞±ÊòØdumperÁ∫øÁ®ãÈô§‰∫ÜÂèëÈÄÅt1Âà∞slaveÔºåËøòÊâøÊãÖ‰∫ÜÊé•Êî∂slaveÁöÑackÂ∑•‰Ωú„ÄÇÂ¶ÇÊûúÂá∫Áé∞ÂºÇÂ∏∏ÔºåÊ≤°ÊúâÊî∂Âà∞ackÔºåÈÇ£‰πàÂ∞ÜËá™Âä®ÈôçÁ∫ß‰∏∫ÊôÆÈÄöÁöÑÂ§çÂà∂ÔºåÁõ¥Âà∞ÂºÇÂ∏∏‰øÆÂ§ç„ÄÇ Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÂçäÂêåÊ≠•Â∏¶Êù•ÁöÑÊñ∞ÈóÆÈ¢òÔºö Â¶ÇÊûúÂºÇÂ∏∏ÂèëÁîüÔºå‰ºöÈôçÁ∫ß‰∏∫ÊôÆÈÄöÁöÑÂ§çÂà∂„ÄÇ ÈÇ£‰πà‰ªéÊú∫Âá∫Áé∞Êï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÂá†Áéá‰ºöÂáèÂ∞ëÔºåÂπ∂‰∏çÊòØÂÆåÂÖ®Ê∂àÂ§±„ÄÇ ‰∏ªÊú∫dumperÁ∫øÁ®ãÊâøÊãÖÁöÑÂ∑•‰ΩúÂèòÂ§ö‰∫ÜÔºåËøôÊ†∑ÊòæÁÑ∂‰ºöÈôç‰ΩéÊï¥‰∏™Êï∞ÊçÆÂ∫ìÁöÑÊÄßËÉΩ„ÄÇ Âú®MySQL 5.5Âíå5.6‰ΩøÁî®after_commitÁöÑÊ®°Âºè‰∏ã, Âç≥Â¶ÇÊûúslave Ê≤°ÊúâÊî∂Âà∞‰∫ãÂä°Ôºå‰πüÂ∞±ÊòØËøòÊ≤°ÊúâÂÜôÂÖ•Âà∞relay log ‰πãÂâçÔºåÁΩëÁªúÂá∫Áé∞ÂºÇÂ∏∏ÊàñËÄÖ‰∏çÁ®≥ÂÆöÔºåÊ≠§Êó∂ÂàöÂ•ΩmasterÊåÇ‰∫ÜÔºåÁ≥ªÁªüÂàáÊç¢Âà∞‰ªéÊú∫Ôºå‰∏§ËæπÁöÑÊï∞ÊçÆÂ∞±‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥„ÄÇ Âú®Ê≠§ÊÉÖÂÜµ‰∏ãÔºåslave‰ºöÂ∞ë‰∏Ä‰∏™‰∫ãÂä°ÁöÑÊï∞ÊçÆ„ÄÇ MySQL 5.7 ‰∏ª‰ªé‰∏ÄËá¥ÊÄßÂä†Âº∫ÔºåÊîØÊåÅÂú®‰∫ãÂä°commitÂâçÁ≠âÂæÖACKÊñ∞ÁâàÊú¨ÁöÑsemi sync Â¢ûÂä†‰∫Ürpl_semi_sync_master_wait_point= AFTER_SYNC;ÂèÇÊï∞, Êù•ÊéßÂà∂ÂçäÂêåÊ≠•Ê®°Âºè‰∏ã‰∏ªÂ∫ìÂú®ËøîÂõûÁªô‰ºöËØù‰∫ãÂä°ÊàêÂäü‰πãÂâçÊèê‰∫§‰∫ãÂä°ÁöÑÊñπÂºè„ÄÇËØ•ÂèÇÊï∞Êúâ‰∏§‰∏™ÂÄº:12AFTER_COMMIT: masterÂ∞ÜÊØè‰∏™‰∫ãÂä°ÂÜôÂÖ•binlog ,‰º†ÈÄíÂà∞slave Âà∑Êñ∞Âà∞Á£ÅÁõò(relay log)ÔºåÂêåÊó∂‰∏ªÂ∫ìÊèê‰∫§‰∫ãÂä°„ÄÇmasterÁ≠âÂæÖslave ÂèçÈ¶àÊî∂Âà∞relay logÔºåÂè™ÊúâÊî∂Âà∞ACKÂêémasterÊâçÂ∞Ücommit OKÁªìÊûúÂèçÈ¶àÁªôÂÆ¢Êà∑Á´Ø„ÄÇAFTER_SYNC(5.7Áã¨Êúâ): master Â∞ÜÊØè‰∏™‰∫ãÂä°ÂÜôÂÖ•binlog , ‰º†ÈÄíÂà∞slave Âà∑Êñ∞Âà∞Á£ÅÁõò(relay log)„ÄÇmasterÁ≠âÂæÖslave ÂèçÈ¶àÊé•Êî∂Âà∞relay logÁöÑack‰πãÂêéÔºåÂÜçÊèê‰∫§‰∫ãÂä°Âπ∂‰∏îËøîÂõûcommit OKÁªìÊûúÁªôÂÆ¢Êà∑Á´Ø„ÄÇ Âç≥‰Ωø‰∏ªÂ∫ìcrashÔºåÊâÄÊúâÂú®‰∏ªÂ∫ì‰∏äÂ∑≤ÁªèÊèê‰∫§ÁöÑ‰∫ãÂä°ÈÉΩËÉΩ‰øùËØÅÂ∑≤ÁªèÂêåÊ≠•Âà∞slaveÁöÑrelay log‰∏≠„ÄÇ ÊîØÊåÅÂèëÈÄÅbinlogÂíåÊé•ÂèóACKÁöÑÂºÇÊ≠•Âåñ ÊóßÁâàÊú¨ÁöÑsemi sync ÂèóÈôê‰∫édump thread ÔºåÂéüÂõ†ÊòØdump thread ÊâøÊãÖ‰∫Ü‰∏§‰ªΩ‰∏çÂêå‰∏îÂèàÂçÅÂàÜÈ¢ëÁπÅÁöÑ‰ªªÂä°Ôºö‰º†ÈÄÅbinlog Áªôslave ÔºåËøòÈúÄË¶ÅÁ≠âÂæÖslaveÂèçÈ¶à‰ø°ÊÅØÔºåËÄå‰∏îËøô‰∏§‰∏™‰ªªÂä°ÊòØ‰∏≤Ë°åÁöÑÔºådump thread ÂøÖÈ°ªÁ≠âÂæÖ slave ËøîÂõû‰πãÂêéÊâç‰ºö‰º†ÈÄÅ‰∏ã‰∏Ä‰∏™ events ‰∫ãÂä°„ÄÇdump thread Â∑≤ÁÑ∂Êàê‰∏∫Êï¥‰∏™ÂçäÂêåÊ≠•ÊèêÈ´òÊÄßËÉΩÁöÑÁì∂È¢à„ÄÇÂú®È´òÂπ∂Âèë‰∏öÂä°Âú∫ÊôØ‰∏ãÔºåËøôÊ†∑ÁöÑÊú∫Âà∂‰ºöÂΩ±ÂìçÊï∞ÊçÆÂ∫ìÊï¥‰ΩìÁöÑTPS „ÄÇ without_ack_receiving_thread ‰∏∫‰∫ÜËß£ÂÜ≥‰∏äËø∞ÈóÆÈ¢òÔºåÂú®5.7ÁâàÊú¨ÁöÑsemi sync Ê°ÜÊû∂‰∏≠ÔºåÁã¨Á´ãÂá∫‰∏Ä‰∏™ ack collector thread Ôºå‰∏ìÈó®Áî®‰∫éÊé•Êî∂slave ÁöÑÂèçÈ¶à‰ø°ÊÅØ„ÄÇËøôÊ†∑master ‰∏äÊúâ‰∏§‰∏™Á∫øÁ®ãÁã¨Á´ãÂ∑•‰ΩúÔºåÂèØ‰ª•ÂêåÊó∂ÂèëÈÄÅbinlog Âà∞slave ÔºåÂíåÊé•Êî∂slaveÁöÑÂèçÈ¶à„ÄÇ ÊéßÂà∂‰∏ªÂ∫ìÊé•ÂèóSLAVEÂÜô‰∫ãÂä°ÊàêÂäüÂèçÈ¶àÊï∞Èáè„ÄÇ MySQL 5.7 Êñ∞Â¢û‰∫ÜSET GLOBAL rpl_semi_sync_master_wait_for_slave_count= N;ÂèÇÊï∞ÔºåÂèØ‰ª•Áî®Êù•ÊéßÂà∂‰∏ªÂ∫ìÊé•ÂèóÂ§öÂ∞ë‰∏™slaveÂÜô‰∫ãÂä°ÊàêÂäüÂèçÈ¶àÔºåÁªôÈ´òÂèØÁî®Êû∂ÊûÑÂàáÊç¢Êèê‰æõ‰∫ÜÁÅµÊ¥ªÊÄß„ÄÇÂΩìcountÂÄº‰∏∫2Êó∂ÔºåmasterÈúÄÁ≠âÂæÖ‰∏§‰∏™slaveÁöÑack„ÄÇ Binlog ‰∫íÊñ•ÈîÅÊîπËøõ ÊóßÁâàÊú¨ÂçäÂêåÊ≠•Â§çÂà∂Âú®‰∏ªÊèê‰∫§binlogÁöÑÂÜô‰ºöËØùÂíådump threadËØªbinlogÁöÑÊìç‰ΩúÈÉΩ‰ºöÂØπbinlogÊ∑ªÂä†‰∫íÊñ•ÈîÅÔºåÂØºËá¥binlogÊñá‰ª∂ÁöÑËØªÂÜôÊòØ‰∏≤Ë°åÂåñÁöÑÔºåÂ≠òÂú®Âπ∂ÂèëÂ∫¶ÁöÑÈóÆÈ¢ò„ÄÇ binlog_mutex_after_tuning MySQL 5.7 ÂØπbinlog lockËøõË°å‰∫Ü‰ª•‰∏ã‰∏§ÊñπÈù¢‰ºòÂåñ: ÁßªÈô§‰∫Üdump threadÂØπbinlogÁöÑ‰∫íÊñ•ÈîÅ Âä†ÂÖ•‰∫ÜÂÆâÂÖ®ËæπÈôÖ‰øùËØÅbinlogÁöÑËØªÂÆâÂÖ® ÁªÑÊèê‰∫§ MySQL 5.7 ÂºïÂÖ•‰∫ÜÊñ∞ÁöÑÂèòÈáèslave-parallel-typeÔºåÂÖ∂ÂèØ‰ª•ÈÖçÁΩÆÁöÑÂÄºÊúâ: DATABASE Ôºà5.7‰πãÂâçÈªòËÆ§ÂÄºÔºâÔºåÂü∫‰∫éÂ∫ìÁöÑÂπ∂Ë°åÂ§çÂà∂ÊñπÂºè LOGICAL_CLOCK Ôºà5.7Êñ∞Â¢ûÂÄºÔºâÔºåÂü∫‰∫éÁªÑÊèê‰∫§ÁöÑÂπ∂Ë°åÂ§çÂà∂ÊñπÂºèÔºõ MySQLÁöÑRPO Âíå RTO ÂêçËØçÊòØ‰ªÄ‰πàÊÑèÊÄùÔºüÁ≠îÔºöRPO: ÊÅ¢Â§çÁÇπÁõÆÊ†á ÊÅ¢Â§çÁÇπÁõÆÊ†áÊòØÊåá‰ºÅ‰∏öÁöÑÊçüÂ§±ÂÆπÈôêÔºöÂú®ÂØπ‰∏öÂä°ÈÄ†ÊàêÈáçÂ§ßÊçüÂÆ≥‰πãÂâçÂèØËÉΩ‰∏¢Â§±ÁöÑÊï∞ÊçÆÈáè„ÄÇËØ•ÁõÆÊ†áË°®Á§∫‰∏∫‰ªé‰∏¢Â§±‰∫ã‰ª∂Âà∞ÊúÄËøë‰∏ÄÊ¨°Âú®ÂâçÂ§á‰ªΩÁöÑÊó∂Èó¥Â∫¶Èáè„ÄÇRTO: ÊÅ¢Â§çÊó∂Èó¥ÁõÆÊ†á RTOÊåáÁöÑÊòØÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•‰∏≠Êñ≠ÊàñÂÖ≥Èó≠Â§öÂ∞ëÊó∂Èó¥ËÄå‰∏ç‰ºöÂØπ‰∏öÂä°ÈÄ†ÊàêÈáçÂ§ßÊçüÂÆ≥„ÄÇÊúâ‰∫õÂ∫îÁî®Á®ãÂ∫èÂèØËÉΩ‰ºöÂÅúÊú∫Êï∞Â§©ËÄå‰∏ç‰ºö‰∫ßÁîü‰∏•ÈáçÁöÑÂêéÊûú„ÄÇËÄå‰∏Ä‰∫õÈ´ò‰ºòÂÖàÁ∫ßÁöÑÂ∫îÁî®Á®ãÂ∫èÂè™ËÉΩÂÅú‰∏ãÊù•Âá†ÁßíÈíüÔºåÂê¶ÂàôÂ∞Ü‰ºöËÆ©‰ºÅ‰∏öÂíåÂÆ¢Êà∑Èöæ‰ª•Â∫îÂØπÔºåÂπ∂ÂØºËá¥‰∏öÂä°‰∏¢Â§±„ÄÇ ÊØîÂ¶Ç‰∏Ä‰∏™Êìç‰ΩúÔºåBegin;insert into‚Ä¶.; commit; Ëøô‰πàÊìç‰Ωú„ÄÇTPS ÊòØÂá†ÔºüQPS ÊòØÂá†?Á≠îÔºöÊàëÁêÜËß£ÁöÑÊòØQPS‰∏≠ÂåÖÂê´TPSÔºåÊâÄ‰ª•QPS ÊòØ3ÔºåTPS ÊòØ1. InnoDBÁöÑ MVCC Âíå READ VIEW ÁªôÊàëËÆ≤Ëß£‰∏ãÔºüÁ≠îÔºöMVCC ÊòØmultiversion concurrency controlÁöÑÁÆÄÁß∞Ôºå‰πüÂ∞±ÊòØÂ§öÁâàÊú¨Âπ∂ÂèëÊéßÂà∂ÔºåÊòØ‰∏™ÂæàÂü∫Êú¨ÁöÑÊ¶ÇÂøµ„ÄÇMVCCÁöÑ‰ΩúÁî®ÊòØËÆ©‰∫ãÂä°Âú®Âπ∂Ë°åÂèëÁîüÊó∂ÔºåÂú®‰∏ÄÂÆöÈöîÁ¶ªÁ∫ßÂà´ÂâçÊèê‰∏ãÔºåÂèØ‰ª•‰øùËØÅÂú®Êüê‰∏™‰∫ãÂä°‰∏≠ËÉΩÂÆûÁé∞‰∏ÄËá¥ÊÄßËØªÔºå‰πüÂ∞±ÊòØËØ•‰∫ãÂä°ÂêØÂä®Êó∂Ê†πÊçÆÊüê‰∏™Êù°‰ª∂ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÔºåÁõ¥Âà∞‰∫ãÂä°ÁªìÊùüÊó∂ÔºåÂÜçÊ¨°ÊâßË°åÁõ∏ÂêåÊù°‰ª∂ÔºåËøòÊòØËØªÂà∞Âêå‰∏Ä‰ªΩÊï∞ÊçÆÔºå‰∏ç‰ºöÂèëÁîüÂèòÂåñÔºà‰∏ç‰ºöÁúãÂà∞Ë¢´ÂÖ∂‰ªñÂπ∂Ë°å‰∫ãÂä°‰øÆÊîπÁöÑÊï∞ÊçÆÔºâ„ÄÇread view InnoDB MVCC‰ΩøÁî®ÁöÑÂÜÖÈÉ®Âø´ÁÖßÁöÑÊÑèÊÄù„ÄÇÂú®‰∏çÂêåÁöÑÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºå‰∫ãÂä°ÂêØÂä®Êó∂ÔºàÊúâ‰∫õÊÉÖÂÜµ‰∏ãÔºåÂèØËÉΩÊòØSQLËØ≠Âè•ÂºÄÂßãÊó∂ÔºâÁúãÂà∞ÁöÑÊï∞ÊçÆÂø´ÁÖßÁâàÊú¨ÂèØËÉΩ‰πü‰∏çÂêå„ÄÇÂú®RR„ÄÅRC„ÄÅRUÔºàREAD UNCOMMITTEDÔºâÁ≠âÂá†‰∏™ÈöîÁ¶ªÁ∫ßÂà´‰∏ã‰ºöÁî®Âà∞ read view„ÄÇ‰ΩïÊó∂ÂàõÂª∫read view ÂÖ∂ÂÆûÔºåÊàë‰ª¨‰ªé‰∏äÈù¢ÁöÑËß£ÈáäÂ∑≤ÁªèÊòéÁôΩ‰∫ÜÔºåÂú®RCÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÊòØÊØè‰∏™SELECTÈÉΩ‰ºöËé∑ÂèñÊúÄÊñ∞ÁöÑread viewÔºõËÄåÂú®RRÈöîÁ¶ªÁ∫ßÂà´‰∏ãÔºåÂàôÊòØÂΩì‰∫ãÂä°‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™SELECTËØ∑Ê±ÇÊâçÂàõÂª∫read viewMySQL mysqldump ÂÆûÁé∞ÁöÑÂéüÁêÜÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºüÁ≠îÔºö FLUSH /!40101 LOCAL / TABLES FLUSH TABLES WITH READ LOCK ÊâßË°åflush tablesÊìç‰ΩúÔºåÂπ∂Âä†‰∏Ä‰∏™ÂÖ®Â±ÄËØªÈîÅÔºåÂæàÂ§öÁ´•ÈûãÂèØËÉΩ‰ºöÂ•ΩÂ•áÔºåËøô‰∏§‰∏™ÂëΩ‰ª§Ë≤å‰ººÊòØÈáçÂ§çÁöÑÔºå‰∏∫‰ªÄ‰πà‰∏çÂú®Á¨¨‰∏ÄÊ¨°ÊâßË°åflush tablesÊìç‰ΩúÁöÑÊó∂ÂÄôÂä†‰∏äÈîÅ‰∫ÜÔºåÂÖ∂ÂÆûÔºåËøôÊ†∑ÂÅöÁöÑÂéüÂõ†Âú®‰∫éÂèØ‰ª•Â∞ΩÈáèÂáèÂ∞ëÂä†ÈîÅÁöÑÂΩ±Âìç„ÄÇÂä†‰∏äÂÖ®Â±ÄËØªÈîÅÔºåÂè™ÂÖÅËÆ∏ËØªÔºå‰∏çÂÖÅËÆ∏Êõ¥Êñ∞Êìç‰Ωú„ÄÇ SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ËÆæÁΩÆÂΩìÂâç‰ºöËØùÁöÑ‰∫ãÂä°ÈöîÁ¶ªÁ≠âÁ∫ß‰∏∫RRÔºåRRÂèØÈÅøÂÖç‰∏çÂèØÈáçÂ§çËØªÂíåÂπªËØª„ÄÇ START TRANSACTION /!40100 WITH CONSISTENT SNAPSHOT / Ëé∑ÂèñÂΩìÂâçÊï∞ÊçÆÂ∫ìÁöÑÂø´ÁÖßÔºåËøô‰∏™ÊòØÁî±mysqldump‰∏≠‚Äìsingle-transactionÂÜ≥ÂÆöÁöÑ„ÄÇ Ëøô‰∏™Âè™ÈÄÇÁî®‰∫éÊîØÊåÅ‰∫ãÂä°ÁöÑË°®ÔºåÂú®MySQL‰∏≠ÔºåÂè™ÊúâInnodb„ÄÇ Ê≥®ÊÑèÔºöSTART TRANSACTION Âíå START TRANSACTION WITH CONSISTENT SNAPSHOT Âπ∂‰∏ç‰∏ÄÊ†∑Ôºå START TRANSACTION WITH CONSISTENT SNAPSHOT ÊòØÂºÄÂêØ‰∫ãÂä°ÁöÑ‰∏ÄËá¥ÊÄßÂø´ÁÖß„ÄÇ RC ‰∏ãÁöÑ START TRANSACTION WITH CONSISTENT SNAPSHOT Áõ∏ÂΩì‰∫éRR‰∏ãÁöÑSTART TRANSACTION„ÄÇ ‰∏çÊòéÁôΩ‰∫ãÂä°ÁöÑÁ´•ÈûãÂèØËÉΩËßâÂæóËøôÁÇπ‰ºöÊØîËæÉÁªïÔºåÂÖ∂ÂÆûÊâÄË∞ìÁöÑ‰∏çÂèØÈáçÂ§çËØªÂíåÂπªËØªÂèØÁÆÄÂçïÁêÜËß£‰∏∫ÔºåÂú®Âêå‰∏Ä‰∏™‰∫ãÂä°ÂÜÖÔºå‰∏§Ê¨°SELECTÁöÑÁªìÊûúÂπ∂‰∏çÁõ∏Âêå„ÄÇ ‰πãÊâÄ‰ª•Ë¶Å‰ΩøÁî®START TRANSACTION WITH CONSISTENT SNAPSHOTÔºåÂõ†‰∏∫ÊØè‰∏™Ë°®ÁöÑÂ§á‰ªΩÊó∂Èó¥Âπ∂‰∏çÁõ∏ÂêåÔºåËøôÂ∞±Ë¶ÅÊ±ÇÂú®ÂØπÁ¨¨‰∏ÄÂº†Ë°®ËøõË°åÂ§á‰ªΩÁöÑÊúüÈó¥ÔºåÂØπÁ¨¨‰∫å‰∏™Ë°®ËøõË°åÁöÑÊìç‰ΩúÔºåÂπ∂‰∏ç‰ºöÂèçÊò†Âà∞Á¨¨‰∫åÂº†Ë°®ÂºÄÂßãÂ§á‰ªΩÊó∂ÊâßË°åÁöÑSELECTÊìç‰Ωú‰∏≠„ÄÇÔºàÊ≥®ÔºömysqldumpÂ§á‰ªΩÁöÑÂ∫ïÂ±ÇÂÆûÁé∞Âç≥ÊòØselect * from tabÔºâ„ÄÇËÄåËøôÁî®START TRANSACTIONÂ∞±Êó†Ê≥ïÂÆûÁé∞„ÄÇ SHOW MASTER STATUS Ëøô‰∏™ÊòØÁî±‚Äìmaster-dataÂÜ≥ÂÆöÁöÑÔºåËÆ∞ÂΩï‰∫ÜÂºÄÂßãÂ§á‰ªΩÊó∂ÔºåbinlogÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÂåÖÊã¨MASTER_LOG_FILEÂíåMASTER_LOG_POS UNLOCK TABLES Á≠âËÆ∞ÂΩïÂÆåÊàêÂêéÔºåÂ∞±Á´ãÂç≥ÈáäÊîæ‰∫ÜÔºåÂõ†‰∏∫Áé∞Âú®Â∑≤ÁªèÂú®‰∏Ä‰∏™‰∫ãÂä°‰∏≠‰∫ÜÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂÜç‰øÆÊîπÊï∞ÊçÆÂ∑≤ÁªèÊó†ÊâÄË∞ìÔºåÂú®Êú¨Á∫øÁ®ã‰∏≠Â∑≤ÁªèÊòØÂèØÈáçÂ§çËØªÔºåËøô‰πüÊòØËøô‰∏ÄÊ≠•ÂøÖÈ°ªÂú®19 rows‰πãÂêéÁöÑÂéüÂõ†ÔºåÂ¶ÇÊûú20 rowsÂíå21 rowsÈÉΩÂú®19 rows‰πãÂâçÁöÑËØùÂ∞±‰∏çË°å‰∫ÜÔºåÂõ†‰∏∫ËøôÊó∂‰∫ãÂä°ËøòÊ≤°ÂºÄÂêØÔºå‰∏ÄÊó¶ÈáäÊîæÔºåÂÖ∂‰ªñÁ∫øÁ®ãÁ´ãÂç≥Â∞±ÂèØ‰ª•Êõ¥ÊîπÊï∞ÊçÆÔºå‰ªéËÄåÊó†Ê≥ï‰øùËØÅÂæóÂà∞‰∫ãÂä°ÂºÄÂêØÊó∂ÊúÄÂáÜÁ°ÆÁöÑposÁÇπ Â§á‰ªΩÁöÑÊ†∏ÂøÉÊòØSELECT /!40001 SQL_NO_CACHE / * FROM test1ËØ≠Âè•„ÄÇ ËØ•ËØ≠Âè•‰ºöÊü•ËØ¢Âà∞Ë°®test1ÁöÑÊâÄÊúâÊï∞ÊçÆÔºåÂú®Â§á‰ªΩÊñá‰ª∂‰∏≠‰ºöÁîüÊàêÁõ∏Â∫îÁöÑinsertËØ≠Âè•„ÄÇ ÂÖ∂‰∏≠SQL_NO_CACHEÁöÑ‰ΩúÁî®ÊòØÊü•ËØ¢ÁöÑÁªìÊûúÂπ∂‰∏ç‰ºöÁºìÂ≠òÂà∞Êü•ËØ¢ÁºìÂ≠ò‰∏≠„ÄÇ SHOW CREATE DATABASE IF NOT EXISTS testÔºåshow create table test1 ÁîüÊàêÂàõÂ∫ìËØ≠Âè•ÂíåÂàõË°®ËØ≠Âè•„ÄÇ SHOW TRIGGERS LIKE ‚Äòtest1‚Äô ÂèØ‰ª•ÁúãÂá∫ÔºåÂ¶ÇÊûú‰∏çÂä†-RÂèÇÊï∞ÔºåÈªòËÆ§ÊòØ‰ºöÂ§á‰ªΩËß¶ÂèëÂô®ÁöÑ„ÄÇ SHOW FUNCTION STATUS WHERE Db = ‚Äòtest‚ÄôSHOW CREATE FUNCTION mycat_seq_currvalSHOW PROCEDURE STATUS WHERE Db = ‚Äòtest‚Äô Áî®‰∫éÂ§á‰ªΩÂ≠òÂÇ®ËøáÁ®ãÂíåÂáΩÊï∞„ÄÇ ËÆæÁΩÆSAVEPOINTÔºåÁÑ∂ÂêéÂ§á‰ªΩÂÆåÊØè‰∏™Ë°®ÂêéÂÜçÂõûÊªöÂà∞ËØ•SAVEPOINT„ÄÇÂõ†‰∏∫ÂâçÈù¢ÈÄöËøáSTART TRANSACTION WITH CONSISTENT SNAPSHOTÂºÄÂêØÁöÑ‰∫ãÂä°Âè™ËÉΩÈÄöËøácommitÊàñËÄÖrollbackÊù•ÁªìÊùüÔºåËÄå‰∏çÊòØROLLBACK TO SAVEPOINT sp„ÄÇPSÔºöËøôÊ†∑ÂÅö‰∏ç‰ºöÈòªÂ°ûÂú®Â§á‰ªΩÊúüÈó¥ÂØπÂ∑≤ÁªèÂ§á‰ªΩË°®ÁöÑddlÊìç‰ΩúÔºåÂÖ∑‰ΩìÂèØËßÅ‰∏ãÈù¢ÁöÑ‚ÄúÂêéÁª≠Ë°•ÂÖÖ‚ÄùÁ¨¨‰∏âÁÇπ„ÄÇ ÊÄªÁªìÔºö mysqldumpÁöÑÊú¨Ë¥®ÊòØÈÄöËøáselect * from tabÊù•Ëé∑ÂèñË°®ÁöÑÊï∞ÊçÆÁöÑ„ÄÇ START TRANSACTION /!40100 WITH CONSISTENT SNAPSHOT /ÂøÖÈ°ªÊîæÂà∞FLUSH TABLES WITH READ LOCKÂíåUNLOCK TABLES‰πãÈó¥ÔºåÊîæÂà∞‰πãÂâç‰ºöÈÄ†ÊàêSTART TRANSACTION /!40100 WITH CONSISTENT SNAPSHOT /ÂíåFLUSH TABLES WITH READ LOCK‰πãÈó¥ÊâßË°åÁöÑDMLËØ≠Âè•‰∏¢Â§±ÔºåÊîæÂà∞‰πãÂêéÔºå‰ºöÈÄ†Êàê‰ªéÂ∫ìÈáçÂ§çÊèíÂÖ•Êï∞ÊçÆ„ÄÇ mysqldumpÂè™ÈÄÇÂêàÊîæÂà∞‰∏öÂä°‰ΩéÂ≥∞ÊúüÂÅöÔºåÂ¶ÇÊûúÂ§á‰ªΩÁöÑËøáÁ®ã‰∏≠Êï∞ÊçÆÊìç‰ΩúÂæàÈ¢ëÁπÅÔºå‰ºöÈÄ†ÊàêUndoË°®Á©∫Èó¥Ë∂äÊù•Ë∂äÂ§ßÔºåundoË°®Á©∫Èó¥ÈªòËÆ§ÊòØÊîæÂà∞ÂÖ±‰∫´Ë°®Á©∫Èó¥‰∏≠ÁöÑÔºåËÄåibdataÁöÑÁâπÊÄßÊòØ‰∏ÄÊó¶Â¢ûÂ§ßÔºåÂ∞±‰∏ç‰ºöÊî∂Áº©„ÄÇ mysqldumpÁöÑÊïàÁéáËøòÊòØÊØîËæÉ‰Ωé‰∏ãÔºåSTART TRANSACTION /!40100 WITH CONSISTENT SNAPSHOT /Âè™ËÉΩÁ≠âÂà∞ÊâÄÊúâË°®Â§á‰ªΩÂÆåÂêéÊâçÁªìÊùüÔºåÂÖ∂ÂÆûÊïàÁéáÊØîËæÉÈ´òÁöÑÂÅöÊ≥ïÊòØÂ§á‰ªΩÂÆå‰∏ÄÂº†Ë°®Â∞±Êèê‰∫§‰∏ÄÊ¨°ÔºåËøôÊ†∑ÂèØÂ∞ΩÂø´ÈáäÊîæUndoË°®Á©∫Èó¥Âø´ÁÖßÂç†Áî®ÁöÑÁ©∫Èó¥„ÄÇ‰ΩÜËøôÊ†∑ÂÅöÔºåÂ∞±Êó†Ê≥ïÂÆûÁé∞ÂØπÊâÄÊúâË°®ÁöÑ‰∏ÄËá¥ÊÄßÂ§á‰ªΩ„ÄÇ mysqldump single-transactionÊÄé‰πàÂÆûÁé∞Ëé∑ÂèñInnoDBË°®ÁöÑ‰∏ÄËá¥ÊÄßÂ§á‰ªΩÔºüÁ≠îÔºö SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ÊâπÊ≥®Ôºö‚Äìsingle-transactionÂèÇÊï∞ÁöÑ‰ΩúÁî®ÔºåËÆæÁΩÆ‰∫ãÂä°ÁöÑÈöîÁ¶ªÁ∫ßÂà´‰∏∫ÂèØÈáçÂ§çËØªÔºåÂç≥REPEATABLE READÔºåËøôÊ†∑ËÉΩ‰øùËØÅÂú®‰∏Ä‰∏™‰∫ãÂä°‰∏≠ÊâÄÊúâÁõ∏ÂêåÁöÑÊü•ËØ¢ËØªÂèñÂà∞ÂêåÊ†∑ÁöÑÊï∞ÊçÆÔºå‰πüÂ∞±Â§ßÊ¶Ç‰øùËØÅ‰∫ÜÂú®dumpÊúüÈó¥ÔºåÂ¶ÇÊûúÂÖ∂‰ªñinnodbÂºïÊìéÁöÑÁ∫øÁ®ã‰øÆÊîπ‰∫ÜË°®ÁöÑÊï∞ÊçÆÂπ∂Êèê‰∫§ÔºåÂØπËØ•dumpÁ∫øÁ®ãÁöÑÊï∞ÊçÆÂπ∂Êó†ÂΩ±ÂìçÔºåÁÑ∂ËÄåËøô‰∏™Ëøò‰∏çÂ§üÔºåËøòÈúÄË¶ÅÁúã‰∏ã‰∏ÄÊù° START TRANSACTION /!40100 WITH CONSISTENT SNAPSHOT / ËøôÊó∂ÂºÄÂêØ‰∏Ä‰∏™‰∫ãÂä°ÔºåÂπ∂‰∏îËÆæÁΩÆWITH CONSISTENT SNAPSHOT‰∏∫Âø´ÁÖßÁ∫ßÂà´ÔºàÂ¶ÇÊûúmysqlÁâàÊú¨È´ò‰∫éÊüê‰∏Ä‰∏™ÁâàÊú¨ÂÄºÔºåÊàëËøò‰∏çÂ§ßÊ∏ÖÊ•ö40100‰ª£Ë°®‰ªÄ‰πàÁâàÊú¨Ôºâ„ÄÇÊÉ≥Ë±°‰∏Ä‰∏ãÔºåÂ¶ÇÊûúÂè™ÊòØÂèØÈáçÂ§çËØªÔºåÈÇ£‰πàÂú®‰∫ãÂä°ÂºÄÂßãÊó∂ËøòÊ≤°dumpÊï∞ÊçÆÊó∂ÔºåËøôÊó∂ÂÖ∂‰ªñÁ∫øÁ®ã‰øÆÊîπÂπ∂Êèê‰∫§‰∫ÜÊï∞ÊçÆÔºåÈÇ£‰πàËøôÊó∂Á¨¨‰∏ÄÊ¨°Êü•ËØ¢ÂæóÂà∞ÁöÑÁªìÊûúÊòØÂÖ∂‰ªñÁ∫øÁ®ãÊèê‰∫§ÂêéÁöÑÁªìÊûúÔºåËÄåWITH CONSISTENT SNAPSHOTËÉΩÂ§ü‰øùËØÅÂú®‰∫ãÂä°ÂºÄÂêØÁöÑÊó∂ÂÄôÔºåÁ¨¨‰∏ÄÊ¨°Êü•ËØ¢ÁöÑÁªìÊûúÂ∞±ÊòØ‰∫ãÂä°ÂºÄÂßãÊó∂ÁöÑÊï∞ÊçÆAÔºåÂç≥‰ΩøËøôÊó∂ÂÖ∂‰ªñÁ∫øÁ®ãÂ∞ÜÂÖ∂Êï∞ÊçÆ‰øÆÊîπ‰∏∫BÔºåÊü•ÁöÑÁªìÊûú‰æùÁÑ∂ÊòØA PaxosÂçèËÆÆÂíåRaftÂçèËÆÆÁ≠îÔºöÂú®ÂàÜÂ∏ÉÂºè‰∏≠Êàë‰ª¨ÈùûÂ∏∏ÈùûÂ∏∏ÁúãÈáçÁöÑÊúâ‰∏ÄËà¨ÁΩë‰∏äÁªèÂ∏∏ËØ¥ÁöÑ‰∏â‰∏™ÁÇπÔºåCAP ÔºÅÂç≥ÔºöC (Consistency ‰∏ÄËá¥ÊÄß)„ÄÅA (Availability ÂèØÁî®ÊÄß)„ÄÅP (Partition)Ôºõ‰πüÂ∞±ÊòØÊàë‰ª¨ÁªèÂ∏∏ÊâÄËØ¥ÁöÑ„ÄêCAPÂéüÁêÜ„ÄëÔºõËÄåÂú®‰∏ÄËá¥ÊÄß‰∏≠Êàë‰ª¨ÊúâÈùûÂ∏∏ÈùûÂ∏∏Ê≥®ÈáçÂõõ‰∏™ÁÇπÔºå ACID ÔºÅ Âç≥ÔºöA (Atomicity ÂéüÂ≠êÊÄß)„ÄÅC (Consistency ‰∏ÄËá¥ÊÄß)„ÄÅ I (Isolation ÈöîÁ¶ªÊÄß)„ÄÅ D (Durability ÊåÅ‰πÖÊÄß)Ôºå‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑ„ÄêACIDÂéüÂàô„ÄëÊòØÁöÑ‰∏ÄËá¥ÊÄßÂéüÂàô‰∏≠ÁöÑ‰∏ÄÁßç RaftRaftÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºè‰∏ÄËá¥ÊÄßÂçèËÆÆÔºèÁÆóÊ≥ïÔºåÊòØReplicated And Fault TolerantÁöÑÁº©ÂÜô„ÄÇÂú®raft‰∏≠È¶ñÂÖàÂÖ∑Â§á‰∫Ü‰∏âÁßçËßíËâ≤Ôºö Leader (È¢ÜÂØºËÄÖ) CandidateÔºàÂÄôÈÄâËÄÖÔºâ FollowerÔºàËøΩÈöèËÄÖÔºâ ÈÄöÂ∏∏ÂÜçÂÅöÂÜ≥Á≠ñ‰πãÂâçÈúÄË¶ÅÈÄâ‰∏æÂá∫‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑLeaderÊù•ÁÆÄÂåñÂêéÁª≠ÁöÑÂÜ≥Á≠ñËøáÁ®ã„ÄÇLeaderÂÜ≥ÂÆö‰∫ÜlogÁöÑÊèê‰∫§Ôºå‰∏î logÂè™ËÉΩÊòØLeader ÊÉ≥followerÂçïÂêëÊèê‰∫§„ÄÇ Leader (È¢ÜÂØºËÄÖ)ÔºöË¥üË¥£Êé•Êî∂ÂÆ¢Êà∑Á´ØÁöÑLogÔºåÂπ∂ÂàÜÂèëÁªôÂÖ∂‰ªñËäÇÁÇπ„ÄÇ Candidate ÔºàÂÄôÈÄâËÄÖÔºâÔºöÂèëËµ∑ÈÄâ‰∏æËØ∑Ê±ÇÔºåÁ´û‰∫âLeader„ÄÇ Follower ÔºàËøΩÈöèËÄÖÔºâÔºöË¥üË¥£Êé•Êî∂LeaderÂèëÈÄÅËøáÊù•ÁöÑLogÔºåÂπ∂Âà∑Êñ∞‰øùÂ≠ò„ÄÇ Raft ÂàÜ‰∏∫‰∏§‰∏™ËøáÁ®ã: ÈÄâ‰∏æLeader Êó•ÂøóÂêåÊ≠•„ÄÇ RaftÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ LeaderÁöÑÈÄâ‰∏æËøáÁ®ã LogÁöÑÂ§çÂà∂ÊñπÊ°à Êï∞ÊçÆÂÆâÂÖ®ÔºàÂÖ∂ÂÆûÂ∞±ÊòØ‰∏ÄËá¥ÊÄßÔºâ PaxosÔºàLamportÔºâÔºöÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÁöÑËäÇÁÇπÈÄö‰ø°Â≠òÂú®‰∏§ÁßçÊ®°ÂûãÔºöÂÖ±‰∫´ÂÜÖÂ≠òÔºàShared memoryÔºâÂíåÊ∂àÊÅØ‰º†ÈÄíÔºàMessages passingÔºâ„ÄÇ Âü∫‰∫éÊ∂àÊÅØ‰º†ÈÄíÈÄö‰ø°Ê®°ÂûãÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºå‰∏çÂèØÈÅøÂÖçÁöÑ‰ºöÂèëÁîü‰ª•‰∏ãÈîôËØØÔºöËøõÁ®ãÂèØËÉΩ‰ºöÊÖ¢„ÄÅË¢´ÊùÄÊ≠ªÊàñËÄÖÈáçÂêØÔºåÊ∂àÊÅØÂèØËÉΩ‰ºöÂª∂Ëøü„ÄÅ‰∏¢Â§±„ÄÅÈáçÂ§çÔºåÂú®Âü∫Á°ÄPaxosÂú∫ÊôØ‰∏≠ÔºåÂÖà‰∏çËÄÉËôëÂèØËÉΩÂá∫Áé∞Ê∂àÊÅØÁØ°ÊîπÂç≥ÊãúÂç†Â∫≠ÈîôËØØÁöÑÊÉÖÂÜµ„ÄÇ PaxosÁÆóÊ≥ïËß£ÂÜ≥ÁöÑÈóÆÈ¢òÊòØÂú®‰∏Ä‰∏™ÂèØËÉΩÂèëÁîü‰∏äËø∞ÂºÇÂ∏∏ÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠Â¶Ç‰ΩïÂ∞±Êüê‰∏™ÂÄºËææÊàê‰∏ÄËá¥Ôºå‰øùËØÅ‰∏çËÆ∫ÂèëÁîü‰ª•‰∏ä‰ªª‰ΩïÂºÇÂ∏∏ÔºåÈÉΩ‰∏ç‰ºöÁ†¥ÂùèÂÜ≥ËÆÆÁöÑ‰∏ÄËá¥ÊÄß„ÄÇ ‰∏ªË¶ÅÊúâ‰∏âÁ±ªËäÇÁÇπ: ÊèêËÆÆËÄÖÔºàProposerÔºâÔºöÊèêÂá∫ÊèêÊ°àÁ≠âÂæÖÂ§ßÂÆ∂ËÆ§ÂèØËØ•ÊèêÊ°à‰∏∫ÂÜ≥ËÆÆ„ÄÇ(Á≥ªÁªü‰∏≠ÁöÑÊèêÊ°àÈÉΩÊã•Êúâ‰∏Ä‰∏™Ëá™Â¢ûÁöÑÂîØ‰∏ÄÊèêÊ°àÂè∑Ôºå) Êé•ÂèóËÄÖÔºàAcceptorÔºâÔºöË¥üË¥£ÂØπÊèêÊ°àËøõË°åÊäïÁ•®ÔºåËÆ§ÂèØÊèêÊ°à„ÄÇ Â≠¶‰π†ËÄÖÔºàLearnerÔºâÔºöËé∑ÂèñÊâπÂáÜÁöÑÁªìÊûú ÔºàÂ≠¶‰π†acceptorÊâÄËÆ§ÂèØÁöÑÁªìÊûúÔºâÔºåÂπ∂Â∏ÆÂøô‰º†Êí≠Ôºå‰∏çÂèÇ‰∏éÊäïÁ•®ËøáÁ®ã„ÄÇ PaxosÁöÑÊµÅÁ®ãÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµ: ÂáÜÂ§áÈò∂ÊÆµ Êèê‰∫§Èò∂ÊÆµ ÂáÜÂ§áÈò∂ÊÆµÔºö proposerÂêëÁΩëÁªúÂÜÖË∂ÖËøáÂçäÊï∞ÁöÑacceptorÂèëÈÄÅprepareÊ∂àÊÅØ (Âç≥ÔºöÊèê‰∫§Ëá™Â∑±ÁöÑÊèêÊ°àÁºñÂè∑) acceptorÊ≠£Â∏∏ÊÉÖÂÜµ‰∏ãÂõûÂ§çpromiseÊ∂àÊÅØÔºàÊé•ÂèóËÄÖÊó∂ÂèØ‰øùÂ≠òÊî∂Âà∞ËøáÁöÑÊèêÊ°àÁöÑÊúÄÂ§ßÁºñÂè∑ÂíåËÆ§ÂèØÁöÑÊúÄÂ§ßÊèêÊ°àÔºåÂ¶ÇÊûúÊî∂Âà∞ÁöÑÊèêÊ°àÂè∑ÊØîËá™Â∑±‰øùÁïôÁöÑÊúÄÂ§ßÊèêÊ°àÂè∑ËøòÂ§ßÔºåÂàôËøîÂõûËá™Â∑±Â∑≤ËÆ§ÂèØÁöÑÊèêÊ°àÂè∑ÔºõÂ¶ÇÊûú‰ªéÊú™ËÆ§ÂèØËøáÊèêÊ°àÔºåÂàôËøîÂõûÁ©∫ÔºåÂπ∂Êõ¥Êñ∞ÂΩìÂâç‰øùÂ≠òÁöÑÊúÄÂ§ßÊèêÊ°àÂè∑ÔºåÂπ∂ËØ¥Êòé‰∏çÂÜçËÆ§ÂèØÂ∞è‰∫éÊúÄÂ§ßÊèêÊ°àÂè∑ÁöÑÊèêÊ°àÔºâ Êèê‰∫§Èò∂ÊÆµÔºö Âú®ÊúâË∂≥Â§üÂ§öacceptorÂõûÂ§çpromiseÊ∂àÊÅØÊó∂ÔºåproposerÂèëÈÄÅacceptÊ∂àÊÅØÔºàÂ¶ÇÊûúÊèêÊ°àËÄÖÊî∂Âà∞Â§ßÂ§öÊï∞ÁöÑÂõûÂ§çÔºåÂàôÂèëÈÄÅÂ∏¶ÊúâÂàöÊâçÊèêÊ°àÂè∑ÁöÑÊé•Âèó accept ‰ø°ÊÅØ„ÄÇ /proc/sys/net/ipv4/ip_forward# sed -i '/net.ipv4.ip_forward/ s/\(.*= \).*/\11/' /etc/sysctl.conf Âú®InnoDBÂºïÊìé‰∏≠Ôºå16k PAGE SIZE, InnoDBÁöÑÈùûÂè∂Â≠êËäÇÁÇπÊúÄÂ§öËÉΩÊîæÂ§öÂ∞ë‰∏™INTÁöÑPrimary Keys,ËÉΩÁî® 16K/4 Êù•‰º∞ÁÆóÂêóÔºüÁ≠îÔºöÂú®InnoDBÂºïÊìé‰∏≠ÔºåÊØè‰∏Ä‰∏™pageÈ¢ÑÁïô1/6Á©∫Èó≤Á©∫Èó¥ÔºåÂÜçÂáèÂéªÂ§¥Â∞æÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºåÂ∞±ÊòØ 16338*15/16*1024/4„ÄÇÂ∞±ÊòØÂ§ßÊ¶ÇÁöÑÁªìÊûú„ÄÇÊ≥®: 16338 ÊòØÂéªÊéâ Â§¥Â∞æÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÂêéÁöÑÂ§ßÂ∞è„ÄÇ ÂèÇËÄÉÂÆòÊñπËµÑÊñô ËØ¥‰∏ÄËØ¥‰∏â‰∏™ËåÉÂºèÁ≠îÔºöÁ¨¨‰∏ÄËåÉÂºè(1NF): Êï∞ÊçÆÂ∫ìË°®‰∏≠ÁöÑÂ≠óÊÆµÈÉΩÊòØÂçï‰∏ÄÂ±ûÊÄßÁöÑ,‰∏çÂèØÂÜçÂàÜ. Ëøô‰∏™Âçï‰∏ÄÂ±ûÊÄßÁî±Âü∫Êú¨Á±ªÂûãÊûÑÊàê, ÂåÖÊã¨Êï¥Âûã/ÂÆûÊï∞/Â≠óÁ¨¶Âûã/ÈÄªËæëÊÄß/Êó•ÊúüÂûãÁ≠â. Á¨¨‰∫åËåÉÂºè(2NF): Êï∞ÊçÆÂ∫ìË°®‰∏≠‰∏çÂ≠òÂú®ÈùûÂÖ≥ÈîÆÂ≠óÊÆµÂØπ‰ªª‰∏ÄÂÄôÈÄâÂÖ≥ÈîÆÂ≠óÊÆµÁöÑÈÉ®ÂàÜÂáΩÊï∞‰æùËµñ(ÈÉ®ÂàÜÂáΩÊï∞‰æùËµñÊåáÁöÑÊòØÂ≠òÂú®ÁªÑÂêàÂÖ≥ÈîÆÂ≠óÊÆµ‰∏≠ÁöÑÊüê‰∫õÂ≠óÊÆµÂÜ≥ÂÆöÈùûÂÖ≥ÈîÆÂ≠óÊÆµÁöÑÊÉÖÂÜµ), ‰πüÂç≥ÊâÄÊúâÈùûÂÖ≥ÈîÆÂ≠óÊÆµÈÉΩÂÆåÂÖ®‰æùËµñ‰∫é‰ªªÊÑè‰∏ÄÁªÑÂÄôÈÄâÂÖ≥ÈîÆÂ≠ó. Á¨¨‰∏âËåÉÂºè(3NF): Âú®Á¨¨‰∫åËåÉÂºèÁöÑÂü∫Á°Ä‰∏äÔºåÊï∞ÊçÆË°®‰∏≠Â¶ÇÊûú‰∏çÂ≠òÂú®ÈùûÂÖ≥ÈîÆÂ≠óÊÆµÂØπ‰ªª‰∏ÄÂÄôÈÄâÂÖ≥ÈîÆÂ≠óÊÆµÁöÑ‰º†ÈÄíÂáΩÊï∞‰æùËµñÂàôÁ¨¶ÂêàÁ¨¨‰∏âËåÉÂºè. ÊâÄË∞ì‰º†ÈÄíÂáΩÊï∞‰æùËµñ, ÊåáÁöÑÊòØÂ¶ÇÊûúÂ≠òÂú® ‚ÄòA -> B -> C‚Äô ÁöÑÂÜ≥ÂÆöÂÖ≥Á≥ª, ÂàôC‰º†ÈÄíÂáΩÊï∞‰æùËµñ‰∫éA. Âõ†Ê≠§, Êª°Ë∂≥Á¨¨‰∏âËåÉÂºèÁöÑÊï∞ÊçÆÂ∫ìË°®Â∫îËØ•‰∏çÂ≠òÂú®Â¶Ç‰∏ã‰æùËµñÂÖ≥Á≥ª: ÂÖ≥ÈîÆÂ≠óÊÆµ -> ÈùûÂÖ≥ÈîÆÂ≠óÊÆµx -> ÈùûÂÖ≥ÈîÆÂ≠óÊÆµy document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL Èù¢ËØïÁ¨îËÆ∞</category>
      </categories>
      <tags>
        <tag>MySQL Èù¢ËØïÁ¨îËÆ∞</tag>
      </tags>
  </entry>
</search>
